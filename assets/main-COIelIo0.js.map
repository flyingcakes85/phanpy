{"version":3,"mappings":";i0CAAA,IAAIA,GAAmBC,GAEvB,SAASA,GAASC,EAAIC,EAAMC,EAAW,CACrC,IAAIC,EAAU,KACVC,EAAc,KAEdC,EAAQ,UAAW,CACjBF,IACF,aAAaA,CAAO,EAEpBC,EAAc,KACdD,EAAU,KAEd,EAEIG,EAAQ,UAAW,CACrB,IAAIC,EAAOH,EACXC,EAAK,EAEDE,GACFA,EAAI,CAER,EAEIC,EAAkB,UAAW,CAC/B,GAAI,CAACP,EACH,OAAOD,EAAG,MAAM,KAAM,SAAS,EAGjC,IAAIS,EAAU,KACVC,EAAO,UACPC,EAAUT,GAAa,CAACC,EAkB5B,GAjBAE,EAAK,EAELD,EAAc,UAAW,CACvBJ,EAAG,MAAMS,EAASC,CAAI,CACxB,EAEAP,EAAU,WAAW,UAAW,CAG9B,GAFAA,EAAU,KAEN,CAACQ,EAAS,CACZ,IAAIJ,EAAOH,EACX,OAAAA,EAAc,KAEPG,EAAI,CACb,CACF,EAAGN,CAAI,EAEHU,EACF,OAAOP,EAAW,CAEtB,EAEA,OAAAI,EAAgB,OAASH,EACzBG,EAAgB,MAAQF,EAEjBE,CACT,EClDC,SAAUI,EAAQC,EAAU,CAEzB,aAGI,OAAOD,EAAO,aAAgB,aAE9BA,EAAO,YAAc,SAAUE,EAAOC,EAAQ,CAE1CA,EAASA,GAAU,CAAE,QAAS,GAAO,WAAY,GAAO,OAAQ,MAAS,EAEzE,IAAIC,EAAMH,EAAS,YAAY,aAAa,EAC5C,OAAAG,EAAI,gBAAgBF,EAAOC,EAAO,QAASA,EAAO,WAAYA,EAAO,MAAM,EACpEC,CACX,EAEAJ,EAAO,YAAY,UAAYA,EAAO,MAAM,WAGhDC,EAAS,iBAAiB,aAAcI,EAAkB,EAAK,EAC/DJ,EAAS,iBAAiB,YAAaK,EAAiB,EAAK,EAC7DL,EAAS,iBAAiB,WAAYM,EAAgB,EAAK,EAE3D,IAAIC,EAAQ,KACRC,EAAQ,KACRC,EAAQ,KACRC,EAAQ,KACRC,EAAW,KACXC,EAAU,KACVC,EAAa,EAOjB,SAASP,EAAeQ,EAAG,CAGvB,GAAIF,IAAYE,EAAE,OAElB,KAAIC,EAAiB,SAASC,EAAoBJ,EAAS,uBAAwB,IAAI,EAAG,EAAE,EACxFK,EAAYD,EAAoBJ,EAAS,kBAAmB,IAAI,EAChEM,EAAe,SAASF,EAAoBJ,EAAS,qBAAsB,KAAK,EAAG,EAAE,EACrFO,EAAW,KAAK,IAAG,EAAKR,EACxBS,EAAY,GACZC,EAAiBP,EAAE,gBAAkBA,EAAE,SAAW,GA4BtD,GA1BIG,IAAc,OACdF,EAAiB,KAAK,MAAOA,EAAiB,IAAOf,EAAS,gBAAgB,YAAY,GAE1FiB,IAAc,OACdF,EAAiB,KAAK,MAAOA,EAAiB,IAAOf,EAAS,gBAAgB,WAAW,GAGzF,KAAK,IAAIS,CAAK,EAAI,KAAK,IAAIC,CAAK,EAC5B,KAAK,IAAID,CAAK,EAAIM,GAAkBI,EAAWD,IAC3CT,EAAQ,EACRW,EAAY,cAGZA,EAAY,gBAIf,KAAK,IAAIV,CAAK,EAAIK,GAAkBI,EAAWD,IAChDR,EAAQ,EACRU,EAAY,YAGZA,EAAY,eAIhBA,IAAc,GAAI,CAElB,IAAIE,EAAY,CACZ,IAAKF,EAAU,QAAQ,UAAW,EAAE,EACpC,WAAYC,EAAe,CAAC,GAAK,IAAI,WAAa,SAClD,QAASR,EACT,OAAQ,SAASN,EAAO,EAAE,EAC1B,KAAM,UAAUc,EAAe,CAAC,GAAK,IAAI,SAAW,GAAI,EAAE,EAC1D,OAAQ,SAASb,EAAO,EAAE,EAC1B,KAAM,UAAUa,EAAe,CAAC,GAAK,IAAI,SAAW,GAAI,EAAE,CAC1E,EAGYT,EAAQ,cAAc,IAAI,YAAY,SAAU,CAAE,QAAS,GAAM,WAAY,GAAM,OAAQU,CAAS,CAAE,CAAC,EAGvGV,EAAQ,cAAc,IAAI,YAAYQ,EAAW,CAAE,QAAS,GAAM,WAAY,GAAM,OAAQE,CAAS,CAAE,CAAC,CAC5G,CAGAf,EAAQ,KACRC,EAAQ,KACRG,EAAW,KACf,CAMA,SAASP,EAAiBU,EAAG,CAGrBA,EAAE,OAAO,aAAa,mBAAmB,IAAM,SAEnDF,EAAUE,EAAE,OAEZH,EAAW,KAAK,IAAG,EACnBJ,EAAQO,EAAE,QAAQ,CAAC,EAAE,QACrBN,EAAQM,EAAE,QAAQ,CAAC,EAAE,QACrBL,EAAQ,EACRC,EAAQ,EACRG,EAAaC,EAAE,QAAQ,OAC3B,CAOA,SAAST,EAAgBS,EAAG,CAExB,GAAI,GAACP,GAAS,CAACC,GAEf,KAAIe,EAAMT,EAAE,QAAQ,CAAC,EAAE,QACnBU,EAAMV,EAAE,QAAQ,CAAC,EAAE,QAEvBL,EAAQF,EAAQgB,EAChBb,EAAQF,EAAQgB,EACpB,CASA,SAASR,EAAoBS,EAAIC,EAAeC,EAAc,CAG1D,KAAOF,GAAMA,IAAOzB,EAAS,iBAAiB,CAE1C,IAAI4B,EAAiBH,EAAG,aAAaC,CAAa,EAElD,GAAIE,EACA,OAAOA,EAGXH,EAAKA,EAAG,UACZ,CAEA,OAAOE,CACX,CAEJ,GAAE,OAAQ,QAAQ,ECpKH,SAASE,GAAkB1C,EAAKA,IAAM,CAAC,EAAG2C,EAAO,GAAI,CAClE,MAAMC,EAAgBC,EAAO7C,CAAE,EAC/B8C,EAAU,IAAM,CACdF,EAAcG,QAAU/C,CAC1B,EAAG,CAAC2C,CAAI,CAAC,EAETG,EAAU,IAAM,CACd,MAAME,EAAyBA,IAAM,CACnC,MAAMC,EAASpC,SAASoC,QAAUpC,SAASqC,kBAAoB,SAC/DC,EAAY,SAAAF,CAAA,CACZL,EACF,gBAAC,oCAAAI,CAAA,EAEDnC,IAASuC,6BAAiB,oBAA2C,GACrE,ICLJ,MAAMC,GAAoB,IAAO,EAC3BC,GAAgB,IAEtBC,GAAeC,GAAK,SAA2B,CAAEC,YAAW,EAAG,CAC7D,KAAM,CAAEC,KAAGC,KAIL,CAACC,EAASC,CAAU,EAAIC,EAAS,EAAI,EACrCC,EAAiBlB,IACvBH,GAAmBkB,GAAY,CAC7BI,aAAaD,EAAehB,OAAO,EAC/Ba,EACFC,EAAW,EAAI,EAEfE,EAAehB,QAAUkB,WAAW,IAAM,CACxCJ,EAAW,EAAK,CAClB,EAAGP,EAAa,CAEpB,CAAC,EAED,MAAMY,EAA0B,MAAOC,EAAOC,EAAUC,IAAqB,CAC3E,GAAIC,EAAOC,kBAAmB,CAC5B,MAAMC,EAAwBL,EAAMM,GAAGC,cACpCC,KAAK,CACJC,MAAO,EACPC,QAASP,EAAOC,kBAAkBO,GACnC,EACAC,SACG,CAAEC,MAAON,GAAkB,MAAMF,EAAsBS,OAC7D,GAAIP,GAAeQ,OACjB,GAAIb,EACFC,EAAOa,qBAAuB,OACzB,CACL,IAAIC,EACJ,GAAI,CAIFA,GAHgB,MAAMjB,EAAMM,GAAGY,QAAQC,MAAM,CAC3CC,SAAU,gBACX,IACqBb,eAAeU,UACvC,MAAY,CAAC,CACTA,EACFd,EAAOa,qBAAuBT,EAAc,CAAC,EAAEI,KAAOM,EAEtDd,EAAOa,qBAAuB,EAElC,CAEJ,CACF,EAEArC,EAAU,IAAM,CACd,IAAI0C,EACAC,EACAC,EACJ,GAAIjC,GAAcG,EAAS,CACzB,KAAM,CAAEO,QAAOwB,YAAWvB,YAAawB,MACtC,SAAY,CAEX,MAAM1B,EAAwBC,EAAOC,CAAQ,EAE7C,IAAIyB,EAAe,GAEfF,IACFF,EAAgBxB,WAAW,IAAM,EAC9B,SAAY,CACX,GAAI,CACF4B,EAAe,GACfL,EAAMG,EAAUG,KAAKC,aAAaC,YAClC7C,wBAEE,GADF,CAAAqC,GACM,CAACA,EAAK,MACNS,EAACrC,QAAS,gBACdT,gBACI8C,gBACF9C,GACoCmB,EAClC4B,qBAAe,GAChB,MACH,CACA5B,EAAOa,EAAuB,CAEhChC,MACU,iBACV0C,EAAe1B,EAAAC,EAAA,GACfjB,IAAe,EAGjB,IACEA,IAAY,EAEVe,IAA6C,CAC/B,UAClB,CAAAsB,GAAA,cACC,EAAAA,OACe,aACtBC,CAAA,EACF,cAAGC,CAAA,CACL,CACA,GAAA9B,EAAOH,CAAM,GACX+B,QAAKW,EAAc,EACnBX,EAAM,KACNxB,UAAayB,KAAa,MAC1BW,sBAAcV,UAAiBW,EAAA,aAAAC,GAAA,CACjCA,IAAAhC,EAAA,WAAAgC,EACF,CAAG,EAAC1C,SAASH,GAGb,EACA,OAAA8C,KAAwBC,GAAM,WAC5BC,GAAc1D,GAAe2D,CAC7BvD,IACMsD,EAAA,QAMa,WAAAA,EAAA,QAChB,WACLD,EAAA,EALMA,EAAiBG,EASnB,GACEH,iBAAgB7E,GAAA,IAClB,CAAAA,EAAA,UAAO,CAAAA,EAAA,cACL,MAAAiF,EAAkBF,EAAQD,mBAC1BnC,EAAA,SAAW,UAAY,CAAAsC,EAErBJ,IAAgB,KAClBK,EAAAD,EAEJ,CACD,WAGDE,EAOIxC,CACAyC,GAAU,SAJV,CAKwBF,EAAG,UAAqB,mBAACA,0BAAG,OCnIpDG,GAA2BC,GAC/B,MAAO9C,EAAO+C,IAAqB,CACjC,MAAMC,EAAmBhD,EAAMM,GAAG2C,SAC/BC,QAAQH,CAAgB,EACxBI,SAAS3C,KAAK,CACbC,MAAO,EACP2C,gBAAiB,GACjBC,gBAAiB,GAClB,EACAzC,SACG,CAAEC,SAAU,MAAMmC,EAAiBlC,OACzC,OAAOD,GAAS,EAClB,EACA,CAAEyC,OAAQ,GAAM,CAClB,EAEA,SAAwBC,IAAgB,CACtC,KAAM,CAAEhE,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAC/B,CAAEH,SAAUyB,KAGZ,CAACiC,EAAUC,CAAW,EAAIhE,EAAS,EAAK,EACxC,CAACiE,EAAaC,CAAc,EAAIlE,EAAS,EAAE,EAC3C,CAACmE,EAAcC,CAAe,EAAIpE,EAAS,EAAK,EAChDqE,EAAYtF,EAAO,IAAI,EACvBuF,EAAUvF,EAAO,IAAI,EAErBwF,EAAaV,EAAWW,SAASC,oBAAsB,eAE7D,SAASC,EAAa7G,EAAG,CAGvB,GAAIA,EAAE8G,KAAO9G,EAAE8G,IAAIC,gBAAkB,IAAK,OAE1C,GAAIf,EAAWgB,cAAcC,UAAW,CACtCtE,EAAOqE,cAAcC,UAAY,GACjCC,KACA,MACF,CAEA,MAAMC,EAAsBjI,SAASkI,iBAAiB,mBAAmB,EAEnEC,EACJ,CAACX,GAAcS,EAAoB5D,SAAW,EAC1C+D,KAAKC,MAAMJ,EAAoB,CAAC,EAAE9D,KAAK,EACvCmE,OAEFxH,EAAEyH,SACWC,GAAYL,CAAI,IAG7B1E,EAAOgF,YAAcN,GAAQ,KAG/BH,KACAvE,EAAOgF,YAAcN,GAAQ,GAEjC,CAEAlC,GAAW,aAAc0B,EAAc,CACrCe,OAAQ,GACRC,gBAAkB7H,GACC,CAAC,CAACd,SAAS4I,cAAc,sBAAsB,GAC7C9H,EAAE+H,SAAW/H,EAAEgI,SAAWhI,EAAEiI,MACjD,CACD,EAGD,MAAMC,EAAgBC,GACpB,IAAM,CACJhC,EAAY,EAAI,CAClB,EACA,CACEiC,UAAW,IAEf,EAEMC,EAAmBC,GAAY,SAAY,CAC/C,GAAI,CACF/B,EAAgB,EAAI,EACpB,MAAMhB,EAAmBgD,KACzB,GAAI,CAAChD,EACH,OAEF,MAAMiD,EAAQ,MAAMnD,GAAyB7C,EAAO+C,CAAgB,EACpEc,EAAemC,CAAK,CACtB,MAAgB,CAChB,SACEjC,EAAgB,EAAK,CACvB,CACF,EAAG,CAAC/D,CAAK,CAAC,EAGJiG,EAAoBH,GAAaI,GAAS,CAC9Cf,GAAY,CACVgB,cAAeD,EAChB,EACDvC,EAAY,EAAK,CACnB,EAAG,EAAE,EAELhF,SAAU,IAAM,CACV+E,GACFmC,GAEJ,EAAG,CAACA,EAAkBnC,CAAQ,CAAC,EAG7B0C,EAAAC,EAAA,CAAAC,UACEC,EAAA,UACEC,IAAKxC,EACLyC,KAAK,SACL9F,GAAG,iBACH+F,QAASrC,EACTsC,cAAgBnJ,GAAM,CACpBA,EAAEoJ,iBACFjD,EAAY,EAAI,CAClB,EAAE,GACE+B,IACJmB,MAAO,GAAGrD,EAAWgB,cAAcC,UAAY,MAAQ,EAAE,IACvDjB,EAAWgB,cAAcsC,WAAa,UAAY,EAAE,IAClDtD,EAAWgB,cAAcuC,gBAAkB,QAAU,EAAE,GAAGT,SAE9DC,EAACS,EAAI,CAACC,KAAK,QAAQC,KAAK,KAAKC,IAAGzE,EAAE,CAAA/B,GAAA,SAAS,CAAC,CAAG,EACzC,EACRyF,EAACgB,GAAc,CACbZ,IAAKvC,EACLoD,MAAO3D,EAAW,OAASsB,OAC3BsC,UAAWtD,EACXuD,QAASA,IAAM5D,EAAY,EAAK,EAChC6D,UAAU,MACVC,IAAK,EACLC,eAAc,GACdC,OAAQ,CACNC,OAAQlL,SAASmL,MAEnBC,mBAAoBC,KACpBC,eAAgB,CACdC,MAAO,CACLC,OAAQ,IAEVxB,QAASA,IAAM,CACbzC,EAAQrF,SAASuJ,aACnB,GAEFC,iBAAkB,IAAI9B,SAAA,CAEtBF,EAACiC,GAAQ,CAACC,GAAG,MAAKhC,SAAA,CAChBC,EAACS,EAAI,CAACC,KAAK,WAAY,EAAE,IACzBV,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA6B,EACzB,CAAC,EACC,EACV4F,EAACiC,KAAa,EACdjC,EAACkC,GAAQ,CACPC,MAAM,MACNlB,UAAU,MACVmB,MAAO,GACPC,SAAU9E,GAAgBF,EAAY7C,SAAW,EACjD8H,MACEzC,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAACS,EAAI,CAACC,KAAK,UAAW,EAAE,IACxBV,EAAA,QAAMuC,UAAU,YAAWxC,SACzBC,EAAAgC,EAAA,CAAA5H,GAAA,SAA2B,EACvB,EACLmD,EAAe,IAAMyC,EAACS,EAAI,CAACC,KAAK,gBAAiB,CAAC,EACnD,EACHX,SAEA1C,EAAY7C,OAAS,GACpB6C,EAAYmF,IAAK7C,GAAS,CACxB,MAAM8C,EAAc,IAAIC,KAAK/C,EAAKgD,SAAS,EACrCC,EAAcF,KAAK1G,MAAQyG,EAAYI,UAAY,MAEzD,OACE7C,EAAC8C,GAAQ,CAAe3C,QAASA,IAAMT,EAAkBC,CAAI,EAAEI,SAC7DF,EAAA,SAAAE,UACEC,EAAA,OAAKM,MAAM,iBAAgBP,SAAEgD,GAAWpD,CAAI,EAAO,EACnDE,EAAA,QAAM0C,UAAU,qBAAoBxC,SAAA,CAEjC6C,GACC/C,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAACgD,GAAY,CAACC,SAAUR,EAAaS,OAAO,QAAS,EAAE,IAAI,IACzD,GAAG,EACL,EAEJlD,EAAA,QACEuC,UAAU,UACVY,SAAUV,EAAYW,cACtBC,MAAOZ,EAAYa,iBAAiBvD,SAEnCwD,GAAa5D,EAAKgD,SAAS,EACxB,CAAC,EACH,CAAC,EACF,GAnBMhD,EAAKvF,EAoBV,CAEd,CAAC,EACK,CAAC,EACG,CAAC,EACjB,CAEN,CCvNA,SAASoJ,GAAe,CAAEC,OAAMC,MAAK,EAAG,CACtC,OACE1D,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAAoJ,OACYC,QAAuBC,WAAA,CAAAC,EAAjC5D,EAAA,QAAgB,EAAC6D,EAAM7D,EAAA,QAAgB,EAAC,CACnC,CAEX,CAEA,MAAA8D,GAAehL,GAAK,UAAiC,CACnD,KAAM,CAAEE,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAErC,SAASoH,GAAU,CACjBpH,EAAOmK,0BAA4B,EACrC,CAEA3H,UACE,IACA,IAAM,CACJ3D,4BAAkB,EAClBmB,GACF,OACA,GACEiF,gBAAQ5H,GACgB,kCACAA,EAAA,SAAa+M,WAAcC,QACG/E,GAK1D,EAAAjC,EAAA,2BAAA+C,EAAAkE,GAAA,CAEA,QAAAlD,EAEWA,kBAAiBjB,uCACjB3F,MAAG,QAAoCkG,SAAM,KAAQ6D,SAAS,CAAAnE,EAAA,UAAID,cAC7DG,MAAK,cAASI,QAAMU,EAAcb,SAASa,KAAQjB,SACnDW,MAAYvE,CAAE,aAAO,EAAC,GAAG6D,EAAA,UACzB,SACRA,EAAA,MAAAD,WACEiC,EAAA,CAAAjC,WACE,IAAgC,GAC9BC,EAAA,QACE,SACRA,EAAA,SAAAD,WACE,SAAAA,kBAEK5D,EAESA,CAAE,cAA0B,KAAA6D,EAAA,OAClCoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAAY,KAAA6D,EAAA,OACpBoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAAgB,KAAA6D,EAAA,OACxBoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAA6B,KAAA6D,EAAAgC,EAAA,CACrCoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAe,EAAe,EAAC,EAC1B,CAEX,OACA7D,EACQA,CAAE,cAAiC,KAAA6D,EAAAgC,EAAA,CACzCoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAe,EAAe,EAAC,EAC1B,CAEX,OACA7D,EACQA,CAAE,cAAiB,KAAA6D,EAAA,OACzBoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAAoB,KAAA6D,EAAAgC,EAAA,CAC5BoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAe,EAAgB,EAAC,EAC3B,CAEX,OACAA,EAAAgC,EAAA,CACEqC,YACEjK,WAAA,CAAAuJ,SAAA,IAEO,GAAC,KAED3D,EAAA,OAEToE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAAwB,KAAA6D,EAAAgC,EAAA,CAChCoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAa,EAAwB,EAAC,EACjC,CAEX,OACA7D,EACQA,CAAE,cAAoC,KAAA6D,EAAAgC,EAAA,CAC5CoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAW,EAAgB,EAAC,EACvB,CAEX,OACA7D,EACQA,CAAE,cAAyC,KAAA6D,EAAA,OACjDoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAA6C,KAAA6D,EAAA,OACrDoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAAmB,KAAA6D,EAAA,OAC3BoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAAgC,0BACxCoG,OAAWP,EAAA,CACXoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAe,EAAe,EAAC,EAC1B,CAEX,OACA7D,EACQA,CAAE,cAAY,KAAA6D,EAAAgC,EAAA,CACpBoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAc,EAAC6D,EAAG7D,EAAA,QAAe,EAACsE,EAAItE,EAAA,QAAW,EAClC,EAAC,EACX,CAEX,OACA7D,EACQA,CAAE,cAAS,KAAA6D,EAAA,OACjBoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAAQ,KAAA6D,EAAA,OAChBoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAAqB,0BAC7BoG,OAAWP,EAAA,CACXoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAe,EAAe,EAAC,EAC1B,CAEX,OACA7D,EACQA,CAAE,cAAmB,KAAA6D,EAAAgC,EAAA,CAC3BoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAW,EAAgB,EAAC,EACvB,CAEX,OACA7D,EACQA,CAAE,cAAQ,KAAA6D,EAAAgC,EAAA,CAChBoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAe,EAAe,EAAC,EAC1B,CAEX,OACA7D,EACQA,CAAE,cAAQ,KAAA6D,EAAA,OAChBoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAAW,KAAA6D,EAAA,OACnBoE,SAAM,KAAK,EAAM,CACnB,OACAjI,EACQA,CAAE,cAAoB,KAAA6D,EAAAgC,EAAA,CAC5BoC,GACEpE,SAAA5F,WAAA,CAAAuJ,UAAA,IAAAC,EACE5D,EAAA,QAAe,EAAC6D,EAAG7D,EAAA,QAAa,EAAe,EAAC,EAC3C,CAEX,OACA7D,EACQA,CAAE,cAAa,KAAA6D,EAAAwD,GAAA,CACrBY,SAAsBX,KAAK,KAAS,EAAK,CAC3C,OACAtH,EACQA,CAAE,cAAsB,KAAA6D,EAAAwD,GAAA,CAC9BY,SAAsBX,KAAK,KAAS,GAAK,MAC1C,OAAAY,EACMA,YAAQ9B,UAAW6B,QAAK,SAC/B,CAAApE,EAAA,MAAAD,QACMO,SAAOiC,IAAUxC,OAAEsE,CAAW,SAClCD,CAAA,EAAArE,CAAKqE,EAASC,CAAC,IAElB,EACI,EAAC,CACH,EACF,EACJ,GC5NPE,GAAU,IAAI,IAIdC,GAAS,IAAI,QAIbC,GAAW,IAAI,QAIfC,GAAa,IAAI,QAIjBC,GAAgB,IAAI,QAIpBC,GAAoB,IAAI,QAIxBC,GAAY,IAAI,QAIhBC,GAAU,IAAI,QAIdC,GAAY,IAAI,QAIhBC,GAAU,IAAI,QAIpB,IAAIC,GAIAC,GAAU,EACVC,GAAU,EAId,MAAMC,GAAM,WAINC,GAAM,WAMNC,GAAM,WAKNC,GAAmBC,GAAc,CACnC,MAAMC,EAAWC,GAAYF,CAAS,EAElCC,GACAA,EAAS,QAAS7N,GAAO+N,GAAQ/N,CAAE,CAAC,CAE5C,EAKMgO,GAAiBC,GAAY,CAC/BA,EAAQ,QAAStK,GAAU,CACnBA,EAAM,SAAW0J,IACjBa,GAAY,EACZtB,GAAO,IAAIjJ,EAAM,MAAM,GACvBwK,GAAUxK,EAAM,MAAM,CAC9B,CAAC,CACL,EAKA,SAASyK,GAAYpO,EAAI,CACrB,MAAMqO,EAAOrO,EAAG,sBAAqB,EAC/BsO,EAAkDjB,IAAK,aAAgB,EACvEkB,EAAkDlB,IAAK,cAAiB,EAC9E,OAAOgB,EAAK,OAAS,GAAKA,EAAK,IAAME,GAAMF,EAAK,MAAQ,GAAKA,EAAK,KAAOC,CAC7E,CAKA,SAASE,GAAgBxO,EAAI,CACzB,MAAMyO,EAAc1B,GAAc,IAAI/M,CAAE,EACkByO,GAAY,WAAU,EAChF,IAAIJ,EAAOzB,GAAO,IAAI5M,CAAE,EACpB0O,EAAc,EAClB,MAAMC,EAAS,EACVN,IACDA,EAAOO,GAAU5O,CAAE,EACnB4M,GAAO,IAAI5M,EAAIqO,CAAI,GAEvB,KAAM,CAAE,YAAAQ,EAAa,aAAAC,CAAY,EAAKzB,GAOhC0B,EANc,CAChBV,EAAK,IAAMM,EACXE,GAAeR,EAAK,KAAOM,EAASN,EAAK,OACzCS,GAAgBT,EAAK,IAAMM,EAASN,EAAK,QACzCA,EAAK,KAAOM,CACpB,EAES,IAAKK,GAAO,GAAI,GAAK,KAAK,MAAMA,CAAE,CAAC,IAAI,EACvC,KAAK,GAAG,EACPC,EAAW,IAAI,qBAAqB,IAAM,CAC5C,EAAEP,EAAc,GAAKP,GAAUnO,CAAE,CACrC,EAAG,CACC,KAAAqN,GACA,UAAW,EACX,WAAA0B,CACR,CAAK,EACDE,EAAS,QAAQjP,CAAE,EACnB+M,GAAc,IAAI/M,EAAIiP,CAAQ,CAClC,CAMA,SAASd,GAAUnO,EAAIvC,EAAW,GAAM,CACpC,aAAa0P,GAAU,IAAInN,CAAE,CAAC,EAC9B,MAAMkP,EAAkBC,GAAWnP,CAAE,EAC/BoP,EAAQ3R,EACR4R,GAASH,CAAe,EACpB,IACAA,EAAgB,SACpB,EACN/B,GAAU,IAAInN,EAAI,WAAW,SAAY,CACrC,MAAMsP,EAAmBxC,GAAW,IAAI9M,CAAE,EAC1C,GAAI,CACA,MAA2EsP,GAAiB,SAC5F1C,GAAO,IAAI5M,EAAI4O,GAAU5O,CAAE,CAAC,EAC5BwO,GAAgBxO,CAAE,CACtB,MACM,CAEN,CACJ,EAAGoP,CAAK,CAAC,CACb,CAIA,SAASlB,IAAe,CACpB,aAAaf,GAAU,IAAIE,EAAI,CAAC,EAChCF,GAAU,IAAIE,GAAM,WAAW,IAAM,CACjCV,GAAQ,QAAS4C,GAAWC,GAAQD,EAASvP,GAAOyP,GAAY,IAAMtB,GAAUnO,CAAE,CAAC,CAAC,CAAC,CACzF,EAAG,GAAG,CAAC,CACX,CASA,SAAS0P,GAAK1P,EAAI,CACd,WAAW,IAAM,CACbiN,GAAU,IAAIjN,EAAI,YAAY,IAAMyP,GAAYtB,GAAU,KAAK,KAAMnO,CAAE,CAAC,EAAG,GAAI,CAAC,CACpF,EAAG,KAAK,MAAM,IAAO,KAAK,OAAM,CAAE,CAAC,CACvC,CAKA,SAASyP,GAAYE,EAAU,CACvB,OAAO,qBAAwB,WAC/B,oBAAoB,IAAMA,GAAU,EAGpC,sBAAsB,IAAMA,GAAU,CAE9C,CAIA,IAAIC,GAIJ,MAAMC,GAAmB,OAAO,OAAW,KAAe,mBAAoB,OAI1EA,KACAxC,GAAO,SAAS,gBAChB,IAAI,iBAAiBM,EAAe,EACpCiC,GAAS,IAAI,eAAe5B,EAAa,EACzC,OAAO,iBAAiB,SAAU,IAAM,CACpCT,GAAU,OAAO,QACjBD,GAAU,OAAO,OACrB,CAAC,EACDsC,GAAO,QAAQvC,EAAI,GAQvB,SAASS,GAAYF,EAAW,CAU5B,OATsBA,EAAU,OAAO,CAACkC,EAAOC,IACpC,CACH,GAAGD,EACH,GAAG,MAAM,KAAKC,EAAS,UAAU,EACjC,GAAG,MAAM,KAAKA,EAAS,YAAY,CAC/C,EACO,EAAE,EAE0C,MAAOC,GAASA,EAAK,WAAa,UAAU,EAEhF,GACJpC,EAAU,OAAO,CAACC,EAAUkC,IAAa,CAE5C,GAAIlC,IAAa,GACb,MAAO,GACX,GAAIkC,EAAS,kBAAkB,QAAS,CAEpC,GADAtG,GAAOsG,EAAS,MAAM,EAClB,CAAClC,EAAS,IAAIkC,EAAS,MAAM,EAAG,CAChClC,EAAS,IAAIkC,EAAS,MAAM,EAC5B,QAASE,EAAI,EAAGA,EAAIF,EAAS,OAAO,SAAS,OAAQE,IAAK,CACtD,MAAMC,EAAQH,EAAS,OAAO,SAAS,KAAKE,CAAC,EAC7C,GAAKC,EAEL,IAAIzC,MAAOyC,EACP,MAAO,GAEXzG,GAAOsG,EAAS,OAAQG,CAAK,EAC7BrC,EAAS,IAAIqC,CAAK,EACtB,CACJ,CACA,GAAIH,EAAS,aAAa,OACtB,QAASE,EAAI,EAAGA,EAAIF,EAAS,aAAa,OAAQE,IAAK,CACnD,MAAMC,EAAQH,EAAS,aAAaE,CAAC,EACrC,GAAIxC,MAAOyC,EACP,MAAO,GAEPA,aAAiB,UACjBrC,EAAS,IAAIqC,CAAK,EAClBzG,GAAOsG,EAAS,OAAQG,CAAK,EAC7BrD,GAAS,IAAIqD,EAAO,CAChBH,EAAS,gBACTA,EAAS,WACrC,CAAyB,EAET,CAER,CACA,OAAOlC,CACX,EAAG,IAAI,GAAK,CAChB,CAMA,SAASpE,GAAOzJ,EAAIkQ,EAAO,CACnB,CAACA,GAAS,EAAE1C,MAAOxN,GACnB,OAAO,eAAeA,EAAIwN,GAAK,CAAE,MAAOxN,EAAI,EACvCkQ,GAAS,EAAE1C,MAAO0C,IACvB,OAAO,eAAeA,EAAO1C,GAAK,CAAE,MAAOxN,EAAI,CACvD,CAMA,SAAS+N,GAAQ/N,EAAI,CACjB,IAAImQ,EAAIC,EACR,MAAMC,EAAYrQ,EAAG,YACfsQ,EAAc1D,GAAO,IAAI5M,CAAE,EAC7BqQ,GAAaxD,GAAS,IAAI7M,CAAE,GAC5B6M,GAAS,OAAO7M,CAAE,IAChBmQ,EAAKrD,GAAW,IAAI9M,CAAE,KAAO,MAAQmQ,IAAO,OAAS,OAASA,EAAG,aAAe,cACjFC,EAAKtD,GAAW,IAAI9M,CAAE,KAAO,MAAQoQ,IAAO,QAAkBA,EAAG,OAAM,GAExE1C,MAAO1N,EACPuQ,GAAIvQ,CAAE,EAEDsQ,GAAeD,EACpBG,GAAOxQ,CAAE,EAEJsQ,GAAe,CAACD,EACrBI,GAAOzQ,CAAE,EAGTuQ,GAAIvQ,CAAE,CAEd,CAMA,SAAS0Q,GAAIC,EAAK,CACd,OAAO,OAAOA,EAAI,QAAQ,aAAc,EAAE,CAAC,CAC/C,CAMA,SAASC,GAAgB5Q,EAAI,CACzB,IAAI6Q,EAAI7Q,EAAG,cACX,KAAO6Q,GAAG,CACN,GAAIA,EAAE,YAAcA,EAAE,UAClB,MAAO,CAAE,EAAGA,EAAE,WAAY,EAAGA,EAAE,SAAS,EAE5CA,EAAIA,EAAE,aACV,CACA,MAAO,CAAE,EAAG,EAAG,EAAG,CAAC,CACvB,CAMA,SAASjC,GAAU5O,EAAI,CACnB,MAAMqO,EAAOrO,EAAG,sBAAqB,EAC/B,CAAE,EAAA8Q,EAAG,EAAAC,GAAMH,GAAgB5Q,CAAE,EACnC,MAAO,CACH,IAAKqO,EAAK,IAAM0C,EAChB,KAAM1C,EAAK,KAAOyC,EAClB,MAAOzC,EAAK,MACZ,OAAQA,EAAK,MACrB,CACA,CASA,SAAS2C,GAAmBhR,EAAIiR,EAAWC,EAAW,CAClD,IAAIC,EAAYF,EAAU,MACtBG,EAAaH,EAAU,OACvBI,EAAUH,EAAU,MACpBI,EAAWJ,EAAU,OACzB,MAAMK,EAAS,iBAAiBvR,CAAE,EAElC,GADeuR,EAAO,iBAAiB,YAAY,IACpC,cAAe,CAC1B,MAAMC,EAAWd,GAAIa,EAAO,UAAU,EAClCb,GAAIa,EAAO,aAAa,EACxBb,GAAIa,EAAO,cAAc,EACzBb,GAAIa,EAAO,iBAAiB,EAC1BE,EAAWf,GAAIa,EAAO,WAAW,EACnCb,GAAIa,EAAO,YAAY,EACvBb,GAAIa,EAAO,gBAAgB,EAC3Bb,GAAIa,EAAO,eAAe,EAC9BJ,GAAaM,EACbJ,GAAWI,EACXL,GAAcI,EACdF,GAAYE,CAChB,CACA,MAAO,CAACL,EAAWE,EAASD,EAAYE,CAAQ,EAAE,IAAI,KAAK,KAAK,CACpE,CAMA,SAASnC,GAAWnP,EAAI,CACpB,OAAOwN,MAAOxN,GAAMkN,GAAQ,IAAIlN,EAAGwN,EAAG,CAAC,EACjCN,GAAQ,IAAIlN,EAAGwN,EAAG,CAAC,EACnB,CAAE,SAAU,IAAK,OAAQ,aAAa,CAChD,CAMA,SAASkE,GAAU1R,EAAI,CACnB,GAAIwN,MAAOxN,EACP,OAAOA,EAAGwN,EAAG,CAErB,CAMA,SAASmE,GAAU3R,EAAI,CACnB,MAAMyJ,EAASiI,GAAU1R,CAAE,EAC3B,OAAOyJ,EAAS2D,GAAQ,IAAI3D,CAAM,EAAI,EAC1C,CAMA,SAAS+F,GAAQD,KAAWqC,EAAW,CACnCA,EAAU,QAASjC,GAAaA,EAASJ,EAAQrC,GAAQ,IAAIqC,CAAM,CAAC,CAAC,EACrE,QAASU,EAAI,EAAGA,EAAIV,EAAO,SAAS,OAAQU,IAAK,CAC7C,MAAMC,EAAQX,EAAO,SAAS,KAAKU,CAAC,EAChCC,GACA0B,EAAU,QAASjC,GAAaA,EAASO,EAAOhD,GAAQ,IAAIgD,CAAK,CAAC,CAAC,CAE3E,CACJ,CAIA,SAAS2B,GAAeC,EAAc,CAClC,OAAI,MAAM,QAAQA,CAAY,EACnBA,EACJ,CAACA,CAAY,CACxB,CAIA,SAASzC,GAAS0C,EAAQ,CACtB,OAAO,OAAOA,GAAW,UAC7B,CAMA,SAASvB,GAAOxQ,EAAI,CAChB,MAAMiR,EAAYrE,GAAO,IAAI5M,CAAE,EACzBkR,EAAYtC,GAAU5O,CAAE,EAC9B,GAAI,CAAC2R,GAAU3R,CAAE,EACb,OAAO4M,GAAO,IAAI5M,EAAIkR,CAAS,EACnC,GAAI9C,GAAYpO,CAAE,EAAG,CAEjB4M,GAAO,IAAI5M,EAAIkR,CAAS,EACxB1C,GAAgBxO,CAAE,EAClB,MACJ,CACA,IAAIgS,EACJ,GAAI,CAACf,EACD,OACJ,MAAMgB,EAAkB9C,GAAWnP,CAAE,EACrC,GAAI,OAAOiS,GAAoB,WAAY,CACvC,IAAIC,EAAYjB,EAAU,KAAOC,EAAU,KACvCiB,EAAWlB,EAAU,IAAMC,EAAU,IACzC,MAAMkB,EAAanB,EAAU,KAAOA,EAAU,OAASC,EAAU,KAAOA,EAAU,OAC9DD,EAAU,IAAMA,EAAU,QAAUC,EAAU,IAAMA,EAAU,SAE/D,IACfiB,EAAW,GACXC,GAAc,IACdF,EAAY,GAChB,KAAM,CAACf,EAAWE,EAASD,EAAYE,CAAQ,EAAIN,GAAmBhR,EAAIiR,EAAWC,CAAS,EACxFmB,EAAQ,CACV,UAAW,aAAaH,CAAS,OAAOC,CAAQ,KAC5D,EACcG,EAAM,CACR,UAAW,iBACvB,EACYnB,IAAcE,IACdgB,EAAM,MAAQ,GAAGlB,CAAS,KAC1BmB,EAAI,MAAQ,GAAGjB,CAAO,MAEtBD,IAAeE,IACfe,EAAM,OAAS,GAAGjB,CAAU,KAC5BkB,EAAI,OAAS,GAAGhB,CAAQ,MAE5BU,EAAYhS,EAAG,QAAQ,CAACqS,EAAOC,CAAG,EAAG,CACjC,SAAUL,EAAgB,SAC1B,OAAQA,EAAgB,MACpC,CAAS,CACL,KACK,CACD,KAAM,CAACM,CAAS,EAAIV,GAAeI,EAAgBjS,EAAI,SAAUiR,EAAWC,CAAS,CAAC,EACtFc,EAAY,IAAI,UAAUO,CAAS,EACnCP,EAAU,KAAI,CAClB,CACAlF,GAAW,IAAI9M,EAAIgS,CAAS,EAC5BpF,GAAO,IAAI5M,EAAIkR,CAAS,EACxBc,EAAU,iBAAiB,SAAU7D,GAAU,KAAK,KAAMnO,EAAI,EAAK,EAAG,CAClE,KAAM,EACd,CAAK,CACL,CAKA,SAASuQ,GAAIvQ,EAAI,CACT0N,MAAO1N,GACP,OAAOA,EAAG0N,EAAG,EACjB,MAAMwD,EAAYtC,GAAU5O,CAAE,EAC9B4M,GAAO,IAAI5M,EAAIkR,CAAS,EACxB,MAAMe,EAAkB9C,GAAWnP,CAAE,EACrC,GAAI,CAAC2R,GAAU3R,CAAE,EACb,OACJ,GAAIoO,GAAYpO,CAAE,EAAG,CAEjBwO,GAAgBxO,CAAE,EAClB,MACJ,CACA,IAAIgS,EACJ,GAAI,OAAOC,GAAoB,WAC3BD,EAAYhS,EAAG,QAAQ,CACnB,CAAE,UAAW,aAAc,QAAS,CAAC,EACrC,CAAE,UAAW,cAAe,QAAS,EAAG,OAAQ,EAAG,EACnD,CAAE,UAAW,WAAY,QAAS,CAAC,CAC/C,EAAW,CACC,SAAUiS,EAAgB,SAAW,IACrC,OAAQ,SACpB,CAAS,MAEA,CACD,KAAM,CAACM,CAAS,EAAIV,GAAeI,EAAgBjS,EAAI,MAAOkR,CAAS,CAAC,EACxEc,EAAY,IAAI,UAAUO,CAAS,EACnCP,EAAU,KAAI,CAClB,CACAlF,GAAW,IAAI9M,EAAIgS,CAAS,EAC5BA,EAAU,iBAAiB,SAAU7D,GAAU,KAAK,KAAMnO,EAAI,EAAK,EAAG,CAClE,KAAM,EACd,CAAK,CACL,CAMA,SAASwS,GAAQxS,EAAIuR,EAAQ,CACzB,IAAIpB,EACJnQ,EAAG,OAAM,EACT4M,GAAO,OAAO5M,CAAE,EAChB6M,GAAS,OAAO7M,CAAE,EAClB8M,GAAW,OAAO9M,CAAE,GACnBmQ,EAAKpD,GAAc,IAAI/M,CAAE,KAAO,MAAQmQ,IAAO,QAAkBA,EAAG,WAAU,EAC/E,WAAW,IAAM,CAIb,GAHI1C,MAAOzN,GACP,OAAOA,EAAGyN,EAAG,EACjB,OAAO,eAAezN,EAAI0N,GAAK,CAAE,MAAO,GAAM,aAAc,GAAM,EAC9D6D,GAAUvR,aAAc,YACxB,UAAW8J,KAASyH,EAChBvR,EAAG,MAAM8J,CAAK,EAAI,EAG9B,EAAG,CAAC,CACR,CAKA,SAAS2G,GAAOzQ,EAAI,CAChB,IAAImQ,EACJ,GAAI,CAACtD,GAAS,IAAI7M,CAAE,GAAK,CAAC4M,GAAO,IAAI5M,CAAE,EACnC,OACJ,KAAM,CAACyS,EAAM9P,CAAI,EAAIkK,GAAS,IAAI7M,CAAE,EACpC,OAAO,eAAeA,EAAIyN,GAAK,CAAE,MAAO,GAAM,aAAc,GAAM,EAClE,MAAMiF,EAAS,OAAO,QAChBC,EAAS,OAAO,QAYtB,GAXIhQ,GACAA,EAAK,YACLA,EAAK,sBAAsB,QAC3BA,EAAK,WAAW,aAAa3C,EAAI2C,CAAI,EAEhC8P,GAAQA,EAAK,WAClBA,EAAK,WAAW,YAAYzS,CAAE,GAG7BmQ,EAAKuB,GAAU1R,CAAE,KAAO,MAAQmQ,IAAO,QAAkBA,EAAG,YAAYnQ,CAAE,EAE3E,CAAC2R,GAAU3R,CAAE,EACb,OAAOwS,GAAQxS,CAAE,EACrB,KAAM,CAAC4S,EAAKC,EAAMC,EAAOC,CAAM,EAAIC,GAAehT,CAAE,EAC9CkP,EAAkBC,GAAWnP,CAAE,EAC/BiR,EAAYrE,GAAO,IAAI5M,CAAE,GAC3B0S,IAAWpF,IAAWqF,IAAWpF,KACjC0F,GAAajT,EAAI0S,EAAQC,EAAQzD,CAAe,EAEpD,IAAI8C,EACAkB,EAAa,CACb,SAAU,WACV,IAAK,GAAGN,CAAG,KACX,KAAM,GAAGC,CAAI,KACb,MAAO,GAAGC,CAAK,KACf,OAAQ,GAAGC,CAAM,KACjB,OAAQ,IACR,cAAe,OACf,gBAAiB,SACjB,OAAQ,KAChB,EACI,GAAI,CAAC1D,GAASH,CAAe,EACzB,OAAO,OAAOlP,EAAG,MAAOkT,CAAU,EAClClB,EAAYhS,EAAG,QAAQ,CACnB,CACI,UAAW,WACX,QAAS,CACzB,EACY,CACI,UAAW,aACX,QAAS,CACzB,CACA,EAAW,CACC,SAAUkP,EAAgB,SAC1B,OAAQ,UACpB,CAAS,MAEA,CACD,KAAM,CAACqD,EAAWrF,CAAO,EAAI2E,GAAe3C,EAAgBlP,EAAI,SAAUiR,CAAS,CAAC,EAC7B/D,GAAQ,aAAgB,KAC3EgG,EACuDhG,GAAQ,YACvDgG,EACR,OAAO,OAAOlT,EAAG,MAAOkT,CAAU,GAEtClB,EAAY,IAAI,UAAUO,CAAS,EACnCP,EAAU,KAAI,CAClB,CACAlF,GAAW,IAAI9M,EAAIgS,CAAS,EAC5BA,EAAU,iBAAiB,SAAU,IAAMQ,GAAQxS,EAAIkT,CAAU,EAAG,CAChE,KAAM,EACd,CAAK,CACL,CAeA,SAASD,GAAajT,EAAI0S,EAAQC,EAAQzD,EAAiB,CACvD,MAAMiE,EAAe7F,GAAUoF,EACzBU,EAAe7F,GAAUoF,EACzBU,EAAe,SAAS,gBAAgB,MAAM,eAMpD,GALuB,iBAAiBhG,EAAI,EAAE,iBACvB,WACnB,SAAS,gBAAgB,MAAM,eAAiB,QAEpD,OAAO,SAAS,OAAO,QAAU8F,EAAc,OAAO,QAAUC,CAAY,EACxE,CAACpT,EAAG,cACJ,OACJ,MAAMuP,EAASvP,EAAG,cAClB,IAAIsT,EAAa/D,EAAO,aACpBgE,EAAYhE,EAAO,YACvB,MAAMiE,EAAc,YAAY,IAAG,EAGnC,SAASC,GAAe,CACpB,sBAAsB,IAAM,CACxB,GAAI,CAACpE,GAASH,CAAe,EAAG,CAC5B,MAAMwE,EAASJ,EAAa/D,EAAO,aAC7BoE,EAASJ,EAAYhE,EAAO,YAC9BiE,EAActE,EAAgB,SAC9B,YAAY,IAAG,GACf,OAAO,SAAS,CACZ,KAAM,OAAO,QAAUyE,EACvB,IAAK,OAAO,QAAUD,CAC9C,CAAqB,EACDJ,EAAa/D,EAAO,aACpBgE,EAAYhE,EAAO,YACnBkE,EAAY,GAGZ,SAAS,gBAAgB,MAAM,eAAiBJ,CAExD,CACJ,CAAC,CACL,CACAI,EAAY,CAChB,CAMA,SAAST,GAAehT,EAAI,CACxB,IAAImQ,EACJ,MAAMc,EAAYrE,GAAO,IAAI5M,CAAE,EACzB,CAAC8S,EAAK,CAAIC,CAAM,EAAI/B,GAAmBhR,EAAIiR,EAAWrC,GAAU5O,CAAE,CAAC,EACzE,IAAI4T,EAAe5T,EAAG,cACtB,KAAO4T,IACF,iBAAiBA,CAAY,EAAE,WAAa,UACzCA,aAAwB,kBAC5BA,EAAeA,EAAa,cAE3BA,IACDA,EAAe,SAAS,MAC5B,MAAMC,EAAe,iBAAiBD,CAAY,EAC5CE,EAAe,CAAChH,GAAW,IAAI9M,CAAE,KAAOmQ,EAAKrD,GAAW,IAAI9M,CAAE,KAAO,MAAQmQ,IAAO,OAAS,OAASA,EAAG,aAAe,WACxHvB,GAAUgF,CAAY,EACtBhH,GAAO,IAAIgH,CAAY,EACvBhB,EAAM,KAAK,MAAM3B,EAAU,IAAM6C,EAAa,GAAG,EACnDpD,GAAImD,EAAa,cAAc,EAC7BhB,EAAO,KAAK,MAAM5B,EAAU,KAAO6C,EAAa,IAAI,EACtDpD,GAAImD,EAAa,eAAe,EACpC,MAAO,CAACjB,EAAKC,EAAMC,EAAOC,CAAM,CACpC,CAQA,SAASgB,GAAY/T,EAAI+R,EAAS,GAAI,CAClC,GAAIlC,IAAoBD,IAKhB,EAJe,OAAO,WAAW,kCAAkC,EACxB,SAC3C,CAACP,GAAS0C,CAAM,GAChB,CAACA,EAAO,gCACsB,CAC9B3E,GAAQ,IAAIpN,CAAE,EACV,iBAAiBA,CAAE,EAAE,WAAa,UAClC,OAAO,OAAOA,EAAG,MAAO,CAAE,SAAU,WAAY,EAEpDwP,GAAQxP,EAAImO,GAAWuB,GAAOsE,GAA4DpE,IAAO,QAAQoE,CAAO,CAAC,EAC7G3E,GAAS0C,CAAM,EACf7E,GAAQ,IAAIlN,EAAI+R,CAAM,EAGtB7E,GAAQ,IAAIlN,EAAI,CACZ,SAAU,IACV,OAAQ,cACR,GAAG+R,CACvB,CAAiB,EAEL,MAAMkC,EAAK,IAAI,iBAAiBtG,EAAe,EAC/CsG,EAAG,QAAQjU,EAAI,CAAE,UAAW,EAAI,CAAE,EAClCgN,GAAkB,IAAIhN,EAAIiU,CAAE,EAC5BtH,GAAQ,IAAI3M,CAAE,CAClB,CAgEJ,OA9DmB,OAAO,OAAO,CAC7B,OAAQA,EACR,OAAQ,IAAM,CACVoN,GAAQ,IAAIpN,CAAE,CAClB,EACA,QAAS,IAAM,CACXoN,GAAQ,OAAOpN,CAAE,EAEjBwP,GAAQxP,EAAKgQ,GAAS,CAClB,MAAM,EAAIlD,GAAW,IAAIkD,CAAI,EAC7B,GAAI,CACsC,GAAE,OAAM,CAClD,MACM,CAAE,CACRlD,GAAW,OAAOkD,CAAI,EACtB,MAAMkE,EAAI/G,GAAU,IAAI6C,CAAI,EACxBkE,GACA,aAAaA,CAAC,EAClB/G,GAAU,OAAO6C,CAAI,EACrB,MAAMC,EAAIhD,GAAU,IAAI+C,CAAI,EACxBC,GACA,cAAcA,CAAC,EACnBhD,GAAU,OAAO+C,CAAI,CACzB,CAAC,CACL,EACA,UAAW,IAAM5C,GAAQ,IAAIpN,CAAE,EAC/B,QAAS,IAAM,CACXoN,GAAQ,OAAOpN,CAAE,EACjB2M,GAAQ,OAAO3M,CAAE,EACjBkN,GAAQ,OAAOlN,CAAE,EACjB,MAAMiU,EAAKjH,GAAkB,IAAIhN,CAAE,EACKiU,GAAG,WAAU,EACrDjH,GAAkB,OAAOhN,CAAE,EAC3BwP,GAAQxP,EAAKgQ,GAAS,CAE8BJ,IAAO,UAAUI,CAAI,EAErE,MAAMmE,EAAIrH,GAAW,IAAIkD,CAAI,EAC7B,GAAI,CACsCmE,GAAE,OAAM,CAClD,MACM,CAAE,CACRrH,GAAW,OAAOkD,CAAI,EAEtB,MAAMoE,EAAKrH,GAAc,IAAIiD,CAAI,EACOoE,GAAG,WAAU,EACrDrH,GAAc,OAAOiD,CAAI,EAEzB,MAAMC,EAAIhD,GAAU,IAAI+C,CAAI,EACxBC,GACA,cAAcA,CAAC,EACnBhD,GAAU,OAAO+C,CAAI,EACrB,MAAMkE,EAAI/G,GAAU,IAAI6C,CAAI,EACxBkE,GACA,aAAaA,CAAC,EAClB/G,GAAU,OAAO6C,CAAI,EAErBpD,GAAO,OAAOoD,CAAI,EAClBnD,GAAS,OAAOmD,CAAI,CACxB,CAAC,CACL,CACR,CAAK,CAEL,CChyBA,SAASqE,GAAenH,EAAS,CAC7B,MAAM8G,EAAUzT,EAAO,IAAI,EACrB,CAAC+T,EAAYC,CAAa,EAAI/S,EAAQ,EACtCgT,EAAcpH,GAAY,CACxBkH,IACAlH,EAAUkH,EAAW,SAAWA,EAAW,QAAO,EAE1D,EACA9T,SAAU,IAAM,CACRwT,EAAQ,mBAAmB,aAC3BO,EAAcR,GAAYC,EAAQ,QAAS9G,GAAW,EAAE,CAAC,CACjE,EAAG,EAAE,EACL1M,EAAU,IACC,IAAM,CACT,IAAI2P,GACHA,EAA6DmE,GAAW,WAAa,MAAQnE,IAAO,QAAkBA,EAAG,KAAKmE,CAAU,CAC7I,EACD,CAACA,CAAU,CAAC,EACR,CAACN,EAASQ,CAAU,CAC/B,CC3BA,SAASC,GAAQC,EAAK,CACpB,OAAQ,IAAMA,EAAIC,SAAS,EAAE,GAAGC,MAAM,EAAE,CAC1C,CACO,SAASC,IAAW,CACzB,IAAIC,EAAQ,IAAIC,YAAY,EAAM,EAClCzW,cAAO0W,OAAOC,gBAAgBH,CAAK,EAC5BI,MAAMC,KAAKL,EAAOL,EAAO,EAAEW,KAAK,EAAE,CAC3C,CACA,SAASC,GAAOC,EAAO,CAGrB,MAAMC,EADU,IAAIC,YAAW,EACVC,OAAOH,CAAK,EACjC,OAAOhX,OAAO0W,OAAOU,OAAOC,OAAO,UAAWJ,CAAI,CACpD,CACA,SAASK,GAAgBzB,EAAG,CAC1B,IAAIxD,EAAM,GACV,MAAMkF,EAAQ,IAAIC,WAAW3B,CAAC,EACxB4B,EAAMF,EAAMG,WAClB,QAAS/F,EAAI,EAAGA,EAAI8F,EAAK9F,IACvBU,GAAOsF,OAAOC,aAAaL,EAAM5F,CAAC,CAAC,EAErC,OAAOkG,KAAKxF,CAAG,EAAEyF,QAAQ,MAAO,GAAG,EAAEA,QAAQ,MAAO,GAAG,EAAEA,QAAQ,MAAO,EAAE,CAC5E,CACO,eAAeC,GAAsBC,EAAG,CAC7C,MAAMC,EAAS,MAAMlB,GAAOiB,CAAC,EAC7B,OAAOV,GAAgBW,CAAM,CAC/B,CAGO,eAAeC,GAAa,CAAEC,aAAY,EAAG,CAClD,GAAI,CAACA,EAAa,MAAO,GACzB,GAAI,CACF,MAAMC,EAAM,MAAM1T,MAChB,WAAWyT,CAAW,yCACxB,EACA,MAAI,CAACC,EAAIC,IAAMD,EAAIE,SAAW,IAAY,GAEtCC,GADS,MAAMH,EAAIG,KAAI,GAClBC,kCAAkCC,SAAS,MAAM,CAE5D,MAAY,CACV,MAAO,EACT,CACF,CAGAzY,OAAO0Y,wBAA0BX,6ZC3C3B,CACJY,OACAC,mBAAoBC,GACpBC,eAAgBC,EAClB,EAAIC,GAEEC,GAAS,yBAWTC,GAAWH,GACbA,GAAQjR,cAAc2Q,SAASU,SAASC,QAAQ,EAChD,GACEC,GAAkBF,SAASG,OAASH,SAASI,SAC7CC,GAAeb,IAAO,CAACO,GAAWG,GAAkBN,GAE1D,eAAsBU,GAAoB,CAAEtB,aAAY,EAAG,CACzD,MAAMuB,EAAqB,IAAIC,gBAAgB,CAC7CC,YAAaf,GACbgB,cAAeL,GACfM,OAAQb,GACRc,QAAShB,GACV,EAYDxW,OADyB,MAVI,MAAMmC,MACjC,WAAWyT,CAAW,eACtB,CACE6B,OAAQ,OACRC,QAAS,CACP,eAAgB,qCAElB7O,KAAMsO,EAAmBrD,UAAS,CAEtC,GACoDkC,MACxC,CAAoB,eAAA2B,GAAA,CAChC,YAAA/B,EACF,UAAAgC,EAEA,WAAAC,EAAA,EAA8C,EAC5CjC,CACAgC,aACAC,EAAa,MAAArC,GAAAsC,CAAA,EACZla,EAAA,qBACD,UAAAga,EACA,sBAAsB,OACtB,iBACEA,gBACAG,qBACAC,QAAgBC,GACFhB,OACdiB,KAAe,yBAEhB,CADQxB,+CACRoB,CAAA,CACD,CACA,kBAAoClC,CACpC,YAAAA,EACF,UAAAgC,EAEA,WAAAC,EAAA,EAA0C,EACxCjC,CACAgC,6BACAC,YACC,MAAAnB,GACD,aAAMyB,GAEJC,cAAO1B,SACOO,qCAEC,WAAArB,CAAA,oBAAAuC,EAAA,YAEjB,CACA,kBAAyB,CACzB,YAAAvC,EACF,UAAAgC,EAEA,cAAAS,EACEzC,OACAgC,iBACAS,CACAC,6BACAC,YACC,aAAAtB,GACD,WAAMrZ,qBACJga,MAGAU,yCAKED,GACFza,EAAO4a,OAAO,gBAAiBH,CAAa,EAS5C,MAPiB,uBAAAzC,CAAA,gBACjBhY,OAAO4a,OACT,SACA,eAAMC,mCAAkE,EAEtEf,OAAS,cAET,MACsB,CAExB,eAAkBgB,GAAoB1C,CACtChW,cAAY,UAAA4X,EAAY,cAAAS,EACxB,MAAAM,CACF,GAEA,IACE/C,6BACAgC,YACAS,gBACAM,OACF,CAAG,EASW,OARR,uBAAA/C,CAAA,iBACF,OAAMhY,OACJga,SACAS,oDAED,KAAAza,EAAA,WAED,UAAMgb,EAAoE,IAE/D,SACPC,EAAA,CAAgB,eAClB,4BAAAA,CAAA,EACAhQ,EAAsB,CACX,CC9GjB,MAAMiQ,GAAerb,OAAOsb,WAAW,4BAA4B,EAAEC,QAErE,SAASC,GAAS,CAAE1Q,SAAQ,EAAG,CAC7B,KAAM,CAAEhI,KAAGC,KACL,CAAEQ,SAAUyB,KAEZwB,EAAWiV,KACXC,EAAiBpS,KACjBqS,EAAqBnV,EAASlC,OAAS,EAEvC,CAACsX,EAAGC,CAAM,EAAIC,GAAYtJ,GAAMA,EAAI,EAAG,CAAC,EACxC,CAACuJ,CAAkB,EAAIhG,KAE7B,OACEpM,EAAA,OAAKzF,GAAG,qBAAqBkG,MAAM,QAAQ4R,SAAS,KAAInS,SAAA,CACrD,CAAC,CAACiB,GACDhB,EAAA,UAAQE,KAAK,SAASI,MAAM,cAAcH,QAASa,EAAQjB,SACzDC,EAACS,EAAI,CAACC,KAAK,IAAIE,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EACzB,EAEV4F,EAAA,UAAQM,MAAM,cAAaP,SACzBC,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAsB,EACpB,EACE,EACR4F,EAAA,QAAAD,SACEF,EAAA,WAAAE,UACEC,EAAA,MAAIM,MAAM,gBAAgBL,IAAKgS,EAAmBlS,SAC/CrD,EAAS8F,IAAI,CAAC2P,EAAStK,IAAM,CAC5B,MAAMuK,EAAYD,EAAQvW,KAAKxB,KAAOwX,EAChCS,EAAYxK,IAAM,EAClByK,EAAc,CAACH,EAAQI,YAC7B,OACE1S,EAAA,MAAAE,UACEF,EAAA,OAAAE,SAAA,CACG8R,GACC7R,EAAA,QAAMM,MAAO,WAAW8R,EAAY,aAAe,EAAE,GAAGrS,SACtDC,EAACS,EAAI,CAACC,KAAK,eAAeE,IAAGzE,EAAE,CAAA/B,GAAA,SAAS,CAAC,CAAG,EACxC,EAER4F,EAACwS,GAAM,CACLC,IAAKN,EAAQvW,KAAK8W,aAClB/R,KAAK,MACLgS,WAAY,SAAY,CACtB,GAAIP,EACF,GAAI,CACF,MAAMxW,EAAO,MAAMnC,EAAMM,GAAG2C,SACzBC,QAAQwV,EAAQvW,KAAKxB,EAAE,EACvBQ,QACHnC,EAAQma,OACRT,GAAQvW,CAAOA,EACfiX,GACAd,MAAO,CACT,CAAa,CACf,GACF/R,EAAA8S,GAAA,CACD,QACAA,EAAQ,MAELjB,KAEM,KAAGM,SAAQvW,8DACDoI,KAGZ,SACAmO,GAENY,YAAQ,IAEN,SAAIT,KAAa,qBAAAH,EAAA,cACf9C,KACQ+C,gBACY,GAAAD,EAAA,iBAAAA,EAAA,eAEtBa,GAAOb,EAAA,SACLa,kBACgB,CAClB,EACF,IACAnT,EAAA,OACC,MACLA,UAAKS,SAAM,CAAAgS,GAAAtS,EAAA,QAASD,YAEVO,SAAMN,EAAAgC,EAAA,CAAKjC,WACf,KAAwBsS,GAAAR,GAAAhS,EAAAC,EAAA,CACpB,SAEPuS,GAAaR,QACZ9R,YACQO,SAAMN,EAAAgC,EAAA,CAAKjC,WACf,KAAqB,SACZkT,GAAA,CACX,MAEJpT,MACEsC,WAAMnC,EAAA,UACNkT,cACUhT,MAAK,oBAASI,SAAMN,EAAAS,EAAA,CAAmBV,YACvCW,KAAK,IAAOC,MAAYxE,CAAE,aAAM,EAAC,GAAI,SACrC,CAAA0V,GAAAhS,EAAAC,EAAA,CACTC,SAEA8R,OACC9R,SACEF,GAACiD,EACCT,YAAU+P,IACKD,EAAA,SACba,iBACA3D,EACF,UAAArP,EAAAS,EAAA,CAAEV,eAEG,GAACW,IAAKV,EAAAgC,EAAA,CAAY,GAAE,QACzB,EAAA5H,CAAA,GAAqC,CAAAmX,IAAA,CAAAa,GAAA,CAAAE,GAAAzS,EAAAiC,GAAA,MAErCyP,cAAiBa,OAAa,EAACE,GAE7Ba,OAAM,SACN9R,SAAO,CAAArB,EAAAS,EAAA,CAAQV,eAEV,GAACW,EAAK,QAAY,SACvBV,EAAAgC,EAAA,CAAAjC,WACE,KAAsC,GACjCC,EAAAiC,GAAA,OACCpC,EAEZG,GAACiC,CACD,QAEHa,OACU3C,YAAM,GAAAgS,EAAA,iBAAAA,EAAA,aACbvY,EACF,UAAAoG,EAAAS,EAAA,CAAEV,WAEG,GAACW,EAAK,QAAQ,SACnBV,EAAAgC,EAAA,CAAAjC,WACE,KAA2B,GACtBC,EAAAiC,GAAA,IAAA4P,GAAAhS,EAAAC,EAAA,UAERmC,MACA4P,CACC9R,SACEF,GAACiD,EACCT,YAAUgQ,GACDlS,OAAM0H,EAAA,GAEbnL,EAAS0W,SAAW,EACpB1W,IAAiByV,EACjBU,GACAd,EACF,UAAA/R,EAAAS,EAAA,CAAEV,mBAEG,GAACW,EAAK,QAAgB,SAC3BV,EAAAgC,EAAA,CAAAjC,WACE,KAA4B,GACvBF,EAAAiD,GAAA,CACC,SACTA,KACCT,YAAe,GACNlC,OAAM0H,EAAA,GAEbnL,EAAS0W,OAAOvL,EAAI,IAAAsK,CAAA,EACpBzV,GAAS0W,CAAW,EACpBP,GACAd,EACF,UAAA/R,EAAAS,EAAA,CAAEV,eAEG,GAACW,EAAK,QAAY,SACvBV,EAAAgC,EAAA,CAAAjC,WACE,KAAqB,GAChBF,EAAAiD,GAAA,CACC,SACTA,OAAQ+E,IAAAnL,EAAA,SACP2F,YAAUwF,GACD1H,OAAM0H,EAAA,GAEbnL,EAAS0W,OAAOvL,EAAI,IAAAsK,CAAA,EACpBzV,GAAS0W,CAAW,EACpBP,GACAd,EACF,UAAA/R,EAAAS,EAAA,CAAEV,iBAEG,GAACW,EAAK,QAAc,SACzBV,EAAAgC,EAAA,CAAAjC,WACE,KAAuB,GAClBC,EAAAiC,GAAA,OACCpC,EACVG,GAACiC,CACD,QAEHoR,GACCC,aAAOzT,EAAAC,EAAA,CACPyT,cACEzT,CAAAC,WACO,GAACW,EAAK,QAAQ,SACnBV,EAAAgC,EAAA,CAAAjC,YACE3F,OAAA,CAAAC,IAAA,WAGuB,YAAAsJ,WAAA,CAAAC,MADrB,gBAAY,CAEN,EAAC,GAEF,GACF,SACP,CAAAwO,GAAAE,EAEJjQ,kBAAW+P,SACXoB,iBAAkB,UACG,CAGnB,YAAMrC,cACJ9C,YAAa8D,SACb9B,cAAW8B,EAAQsB,aACnB3C,QAAeqB,WAAQuB,GAEzBhX,EAAC,OAAAmL,EAAA,GACDnL,GAAS0W,CAAW,EACpBP,IAEIc,GAAA,gCAAAxB,EAAA,SAEFwB,WACQC,IAAQC,iBAGoB,MACpC,CACF,CAAa,oCACbxE,EACF,UAAArP,EAAAS,EAAA,CAAEV,WAEG,GAACW,EAAK,QAAQ,SACnBV,EAAAgC,EAAA,CAAAjC,WACE,KAAsB,GACjB,EAAAoS,GAAA,WAAAtS,EAAA,OACI,MACVsS,SACI7R,SAAM,CAAAN,EAAAS,EAAA,CAAQV,kBACZ,GAACW,EAAK,QAAe,SAC1BV,EAAAgC,EAAA,CAAAjC,YACE3F,OAAA,CAAAC,KAAA8X,EAAA,YAC+C,YAAAxO,OAAA,CAAAC,SAC5CZ,WAAY,EAAmBL,CAAY,EAAC,GACxC,EAAC,CACH,GAEV,GACK,EACLwP,EAAC,UACJ,GAEPnS,EAAA,KACC,SACJH,EAAAiU,GAAA,CAAA/T,YACQgC,MAAG,gBAASzB,QAAMU,EAAgBb,SAASa,MAAQjB,WAClD,GAACW,IAAKV,EAAA,QAAQ,SACnBA,EAAAgC,EAAA,CAAAjC,WACE,KAAqC,EAChC,GACH8R,GAAA7R,EAAA,KACL,SACF6R,UACC7R,CAAAD,WACEiC,EAAA,CAAAjC,YACE3F,WAAA,CAAAuJ,QAAA,IACqB,EAAC,EAEf,GACF3D,EAAA,KACN,SAELA,EAAA,UAAAD,cAEIG,MAAK,QACLI,QAAM,IAAA1G,EAAA,4BACNuG,SAASA,EAAOvG,EAAOma,CAAiChU,WAExD,IAA2B,EAAC,CACtB,EACN,GACG,EACJ,CCrTb,MAAAiU,GAAe,8lCCQTC,GAAa,CACjB,QAAS,UACT,QAAS,UACT,QAAS,OACX,EAEA,SAAwBC,IAAe,CACrC,KAAM,CAAEC,QAASC,KAGXC,EAAmBC,GAAQ,IACxBC,GAAQ/R,IAAKgS,GAAS,CAG3B,MAAMC,EAAiBR,GAAWO,CAAI,GAAKA,EAAKxG,QAAQ,YAAa,EAAE,EAEjE0G,EAASC,GAAgB,CAC7B5D,KAAM0D,EACNG,OAAQJ,EACRK,SAAUC,GAASC,QAAYC,EAAEjE,OAASyD,CAAI,GAAGS,WAClD,EAIKC,EAAUP,GAAgB,CAC9B5D,KAAM0D,EACNG,OAAQT,EAAKS,OACbC,SAAUC,GAASC,QAAYC,EAAEjE,OAASyD,CAAI,GAAGW,KAClD,EAED,MAAO,CACLpE,KAAMyD,EACNC,iBACAS,UACAR,SAEJ,CAAC,EAAEU,KAAK,CAACrJ,EAAGsJ,IAAM,CAEhB,MAAMC,EAAQvJ,EAAEmJ,QAAQK,cAAcF,EAAEH,QAASf,EAAKS,MAAM,EAC5D,OAAIU,IAAU,EAAUA,EAEpBvJ,EAAEgF,KAAOsE,EAAEtE,KAAa,GACxBhF,EAAEgF,KAAOsE,EAAEtE,KAAa,EACrB,CACT,CAAC,EACA,EAAE,EAEL,OACElR,EAAA,SAAOS,MAAM,gBAAeP,SAAA,CAAC,KACxB,IACHF,EAAA,UACES,MAAM,QACNhG,MAAO6Z,EAAKS,QAAUY,GACtBC,SAAWxe,GAAM,CACf0c,GAAM+B,MAAMC,IAAI,OAAQ1e,EAAEoK,OAAO/G,KAAK,EACtCsb,GAAa3e,EAAEoK,OAAO/G,KAAK,CAC7B,EAAEyF,SAAA,CAEDsU,EAAiB7R,IAAI,CAAC,CAAEuO,OAAM0D,iBAAgBC,YAAa,CAE1D,MAAMmB,EAASlB,GAAgB,CAC7B5D,KAAM0D,EACNG,OAAQT,EAAKS,OACbC,SAAUC,GAASC,QAAYC,EAAEjE,OAASA,CAAI,GAAGoE,KAClD,EAED,OACEnV,EAAA,UACE1F,MAAOyW,EACP,uBAAsB0D,EAAe1U,SAJtB,CAAC,CAAC8V,GAAUA,IAAWnB,EAOxB,GAAGA,CAAM,MAAMmB,CAAM,GAAKnB,GAFnC3D,CAGC,CAEZ,CAAC,EACwB7B,MA0BxB,EACK,CAAC,EACJ,CAEX,CChFA,SAAS4G,GAA8BC,EAAc,CACnD,KAAM,CAAEtc,SAAUyB,GAAG,EACrB,OAAOzB,EAAMM,GAAGic,KAAKD,aAAaE,OAAOF,CAAY,CACvD,CAEA,SAASG,IAA+B,CACtC,KAAM,CAAEzc,SAAUyB,GAAG,EACrB,OAAOzB,EAAMM,GAAGic,KAAKD,aAAanb,MAAK,CACzC,CAEA,SAASub,GAA8BJ,EAAc,CACnD,KAAM,CAAEtc,SAAUyB,GAAG,EACrB,OAAOzB,EAAMM,GAAGic,KAAKD,aAAaK,OAAOL,CAAY,CACvD,CAEA,SAASM,IAAgC,CACvC,KAAM,CAAE5c,SAAUyB,GAAG,EACrB,OAAOzB,EAAMM,GAAGic,KAAKD,aAAa1N,OAAM,CAC1C,CAKO,SAASiO,IAAkB,CAChC,MAAO,kBAAmBC,WAAa,gBAAiBrgB,MAC1D,CAEO,SAASsgB,IAAkB,CAEhC,OAAOD,UAAUE,cAAcD,gBAAe,CAChD,CAEA,eAAeE,IAAkB,CAC/B,MAAMC,EAAe,MAAMH,GAAe,EACpCT,EAAeY,EACjB,MAAMA,EAAaC,YAAYF,gBAAe,EAC9CjY,OACJ,MAAO,CAAEkY,eAAcZ,eACzB,CAEA,SAASc,GAAsBC,EAAc,CAC3C,MAAMC,EAAU,IAAIC,QAAQ,EAAKF,EAAatc,OAAS,GAAM,CAAC,EACxDyc,EAAS,GAAGH,CAAY,GAAGC,CAAO,GACrC/I,QAAQ,KAAM,GAAG,EACjBA,QAAQ,KAAM,GAAG,EAEdkJ,EAAUhhB,OAAOihB,KAAKF,CAAM,EAC5BG,EAAc,IAAI1J,WAAWwJ,EAAQ1c,MAAM,EAEjD,QAASqN,EAAI,EAAGA,EAAIqP,EAAQ1c,OAAQ,EAAEqN,EACpCuP,EAAYvP,CAAC,EAAIqP,EAAQG,WAAWxP,CAAC,EAGvC,OAAOuP,CACT,CAKO,eAAeE,IAAmB,CACvC,GAAI,CAAChB,GAAe,EAAI,OACxB,KAAM,CAAEP,cAAa,EAAI,MAAMW,GAAe,EAC9C,IAAIa,EAAsB,KAC1B,GAAI,CACFA,EAAsB,MAAMrB,GAA4B,CAC1D,OAASsB,EAAK,CACZ,GAAI,wBAAuBxT,KAAKwT,EAAIC,OAAO,EAIzC,MAAMD,CAEV,CAGED,SACA,MAAAG,EAAAH,EAAA,WAAAxB,EAAA,gBAEF4B,EAAAJ,EAAA,YAAAK,EACA,GAAIL,GACF,MAAMG,UAAY,uCAAoC3B,EAEtD,IAAA4B,EAGA,wEAWW,CAAAJ,EAAA,CAEP7T,QAAMkU,KACR,GAAEA,EAAA,CACF,KAAM,CACN,qBAAAC,CACA,EAAA9B,EAAA,QACA+B,EAAAjB,GAAAe,CAAA,aACAG,EAAA,eAAAF,CAAA,aAEA,KADAC,IAAAC,GAKJ,YAAAhC,EAAA,cAEIA,IAAY,MAAKwB,wCAAqB,CAExC,CACA,uBAcMI,qBACF,CACA,CACA,eAAM5B,GAA0B,CAChC,KAAA5I,EACF,OAAA6K,CACF,GACEvf,OAAa,SACf,IACF,aAAAke,gBAEA,QAAAD,GAAA,EACAa,EAAA,KACA,GAAAxB,EACA,IACAwB,EAAA,MAAApB,GAAA,CACA,KAAAhJ,EACA,OAAA6K,CACA,SAGuBT,YAAqB,aAAAxB,EAC9C,KAAA5I,EAEO,OAAA6K,EAAwC,CAAY,KAClD,CAAyCA,aAAS,IAAAJ,EAAA,uCACzD7B,EAAKO,MAAiBK,EAAE,uBACpB,mBAAEA,qBAAYE,GAAAe,CAAA,CAAE7B,GAAcwB,EAASb,MAAiBZ,GAAA,CACxDyB,eAEAxB,OACF,OAAAiC,GAGIA,CACF,MAAE,CACF,aAAAjC,EACF,oBAAAwB,CACE,CACA,CACAA,mBAA4BzB,QACd,cACZ3I,CACA6K,cACF,QAAEtB,GAAA,EACFX,IACF,MAAAM,GAAA,EACD,MAAMN,EAAA,cAEL,2ZCvLEkC,GAAoB,GACpBC,GAAa,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EACxC,CACJlJ,eAAgBC,GAChBkJ,0BAA2BC,GAC3BC,2BAA4BC,GAC5BC,uBAAwBC,GACxBC,qBAAsBC,EACxB,EAAIxJ,GAEEyJ,GAAkBC,OAAO/S,QAAQgT,GAAUC,EAAE,EAAEtW,IAAI,CAAC,CAACuO,EAAMoE,CAAI,KAAO,CAC1EpE,OACAoE,MACF,EAAE,EAEI4D,GAAuB,gBAE7B,SAASC,GAAS,CAAEhY,SAAQ,EAAG,CAC7B,KAAM,CAAEhI,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAC/Bqf,EAAetF,GAAM+B,MAAM7B,IAAI,OAAO,GAAK,OAC3CqF,EAAe/gB,IACfghB,EACJlc,EAAWW,SAASwb,kCAAoC,KACpDC,EAAuBC,KACvBC,EAA2B5E,GAAgB0E,CAAoB,EAC/DG,EAAkB7F,GAAM+B,MAAM7B,IAAI,UAAU,GAAKoE,GAEjD,CAACwB,EAAOC,CAAQ,EAAItgB,EAASugB,IAAgB,EAC7C,CAAElgB,QAAOmgB,gBAAelgB,YAAawB,KAiBrC,CAAC2e,EAAaC,CAAc,EAAI1gB,EACpCua,GAAM+B,MAAM7B,IAAI,sBAAsB,GAAK,EAC7C,EAEMkG,EAAqBN,EAAM,4BAA4B,IAAM,UAEnE,OACE5Z,EAAA,OACEzF,GAAG,qBACHkG,MAAM,QACN4R,SAAS,KACTxQ,MAAO,CACL,sBAAuB,GAAG8X,CAAe,MACzCzZ,SAAA,CAED,CAAC,CAACiB,GACDhB,EAAA,UAAQE,KAAK,SAASI,MAAM,cAAcH,QAASa,EAAQjB,SACzDC,EAACS,EAAI,CAACC,KAAK,IAAIE,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EACzB,EAEV4F,EAAA,UAAAD,SACEC,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAsB,EACpB,EACE,EACRyF,EAAA,QAAAE,UACEC,EAAA,WAAAD,SACEF,EAAA,MAAAE,UACEF,EAAA,MAAAE,UACEC,EAAA,OAAAD,SACEC,EAAA,SAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAwB,EACnB,EACJ,EACL4F,EAAA,OAAAD,SACEC,EAAA,QACEC,IAAKiZ,EACLc,QAAU/iB,GAAM,CACdwB,iBAAa,EAEb,MAAMwhB,EADW,aAAAf,EAAA,SACIgB,WAAShB,EACxBiB,WAAQF,gBACd,GAAAE,IAAahkB,OAASikB,CAEtBC,YAAc,OAAQ,sBACpBA,MAAKC,EAAUjS,SAAO,cAAqB,qCAG3CkS,IAGAA,EAAIA,KAAa,IAEjB,6DAEMC,QAAarkB,IAGnBqkB,OAAWpT,aACTqT,EAAS,KACV,CACHJ,EAAO,4BAAAF,IAAA,SACLE,EAAKC,UAAUI,OAAO,UAAAP,IAAYA,MAAU,EAC5CE,MAAKC,EAAUI,SAAO,cAAqB,mCAAM,EAGjDH,IAGAA,EAAIA,KAAa,cACfA,EAAYpF,QAAOgF,IAAA,QAAAI,EAAA,wBAAAA,EAAA,wBAKrB,6DAEMC,QAAarkB,IAGnBqkB,OAAWpT,EACTqT,EAAS,CAEb,2EAAAN,IAAA,oBAAAA,CAAA,EACAhkB,IACG4I,OAMH4U,SAAc,WAAQ,EAEtBA,GAAO,kBAAAwG,CAAA,CACyB,EAElC,SAAAta,EAAA,OAAEE,oBAEGO,SAAM,CAAAT,EAAA,SAAaE,SACtBF,GAAA,SAAAE,aAEIG,KAAK,QACLiV,MAAK,QACL7a,eAAM2e,IAAA,oBAEP,SACDjZ,EAAAgC,EAAA,CAAAjC,WACE,KAAmB,GACdF,EAAA,SACF,SACP,CAAAG,EAAA,SAAAD,aAEIG,KAAK,QACLiV,MAAK,OACL7a,eAAM2e,IAAA,mBAEP,SACDjZ,EAAAgC,EAAA,CAAAjC,WACE,KAAkB,GACbF,EAAA,SACF,SACP,CAAAG,EAAA,SAAAD,aAEIG,KAAK,QACLiV,MAAK,OACL7a,eAAM2e,IAAA,SAAAA,IAAA,SACN0B,UAGD,SACD3a,EAAAgC,EAAA,CAAAjC,WACE,KAAkB,EAAC,CACd,EACD,EACL,EAAC,CACF,GACFF,EAAA,MACJ,SACJ,CAAAG,EAAA,OAAAD,SACEC,EAAA,SAAAD,WACEiC,EAAA,CAAAjC,WACE,IAAuB,GAClBF,EAAA,OACJ,MACLA,cAAKS,SAAM,CAAAN,EAAA,QAAaD,OAChB2B,SAAOwW,GAAA,IAA0B,SAAAlY,EAAAgC,EAAA,CAAEjC,WACvC,KAEO,IAAAC,EAAA,SACH,KAAE,QAENE,OAAK,GACL0a,IAAK1C,GAAWA,GAAC,UACjB2C,KAAK3C,IACL4C,MAAKtB,EACLlf,aACAL,SAAKhD,GAAA,CACLwe,QAAWxe,SAAMA,EAAA,iBACTqD,SAAQygB,gBACd,kBAAsBX,wBAEtBC,IAAWW,GAEXrH,SAAcsE,gBAEdtE,GAAO,qBAAA1c,EAAA,aACqC,CAC5C,GACF,IAAA+I,EAAA,QACD,MACDA,CAAM0B,SAAOwW,MAAA,WAA8C,SAAAlY,EAAAgC,EAAA,CAAEjC,WAC3D,KAEOC,EAAA,YACH,GACNA,QAAU5F,SAAG8d,GAAA,IAAAvX,GAAAX,EAAA,iBAET,EAAQ1F,CAAOqG,EAAK,CACrB,EAAC,CACO,GACPd,EAAA,MACJ,SACJ,CAAAA,EAAA,QAAAE,SACEF,GAAA,SAAAE,SACEC,EAAAgC,EAAA,CAAAjC,WACE,KAA8B,IAAAC,EAAA,SACzB,SACPA,EAAA,KAAAD,0CAEIoT,OAAK,SACL9R,eACA4Z,SAAIjb,EAAAgC,EAAA,CAAUjC,WAEd,IAAoC,EAAC,CACpC,GACGC,EAAAkU,GAAA,OAEM,EACb,GACH0F,GAAA/Z,EAAAC,EAAA,CACG,SACR8Z,QACC/Z,CAAAE,SACEC,EAAAgC,EAAA,CAAAjC,WACE,KAAqBC,EAAA,WACnB,SACJH,EAAA,MAAAE,YACE,MAAAA,SACEF,GAAA,SAAAE,4BACSmb,SAAI,CAAAlb,EAAAgC,EAAA,CAAuBjC,WAChC,GAAA3F,IAAA4F,EAAAS,EAAA,CAAgC,KAAE,QAC5BC,MAAgBvE,CAAE,cAAS,qBAAEmE,CAAM,GAAgBT,EAAA,UACpD,GACPA,wBACEzF,MAAGqf,EAAA,wCACHnf,SAAOmf,GAAM,CACbhE,MACE,MAAAnb,CAAM,EAAEA,mBAAY+G,CACnB,IACC,MAAI5H,EAAA,+BACF,OAAMA,CACJ0hB,QAAQ7gB,CAAA,CACGA,GAEb,MAAC8gB,EAAA,CACD,GAAA3B,EACE,6BAAGA,GAELnf,IAAA,YACA8gB,gCAAyB,YAEzB1B,EAAA0B,CAAA,EACA1B,GAAS0B,CAAQ,EACjBC,KACSlf,CAAC,cAA4B,MAAC,SAElCA,CAAC,cAAqC,CAC3C1D,IAAe,EACjB,SACC,CAAAuH,EAAA,UACL,eAAED,SAEFC,EAAAgC,EAAA,CAAQ1H,WAAM,CAAQyF,CACpB,GAAA3F,EAAA,gBAAoB,WACd,SACR4F,EAAAgC,EAAA,CAAQ1H,WAAM,CAAUyF,CACtB,GAAA3F,EAAA,gBAA0B,UACpB,SACR4F,EAAAgC,EAAA,CAAQ1H,WAAM,CAASyF,CACrB,MAAuB,GAACub,GACjB,GAAAzb,EAAA,eACF,CAAAA,EAAA,SAEVyb,iCACCvb,SACEF,GAAAmC,EAAA,CAAOkZ,GAAI,SAA4Bnb,QACrCC,EAAAgC,CAAA5H,KAAA,QAA4B,IAAE+B,EACXyE,CAAGzE,YAAE,QAAQ,eAAC,IAAEmE,WAAM,CAAa,GAAG,6BACpD,MACPT,EAAA,SAAA4Z,EAAA,0CACErf,SAAG2f,EACHzf,SACEyf,IAIF1X,MACAoT,OACE,EAAAxe,EAAM,iBAAEqD,IAAY+G,CACnB,MAAA5H,EAAY,+BACP,QACF,aAAeiD,CAA2B,CAChC,GACQpC,MAChB8gB,EAAA,CACD,GAAA3B,EACD,+BAAiBnf,CAAA,EACZmf,EACH2B,CAAA,EACFC,GAAAD,CAAA,EACA1B,GAAS0B,EAET/e,CAASF,YAAC,QAAwB,CAAC,MAAAA,EAEnCof,CAAKpf,YAAC,GAAiC,IACvC1D,EAAe,SACjB,CAAAuH,EAAA,UACF,MAAG,SACL,SAAA+Z,EAAEha,SAEFC,EAAAgC,EAAA,CAAQ1H,WAAM,CAAS+H,CAAU0X,GAAmBha,WAClDiC,CAAA,2BAA8B+X,EACxB,SACR/Z,EAAAgC,EAAA,CAAQ1H,WAAM,CAAY+H,CAAU0X,GAAmBha,WACrDiC,CAAA,wBAAsChC,EAAAgC,EAAA,CAExChC,WAAA,CAAQ1F,CAAM,EAAQyF,CACpB,MAAgC,EACzB,GAAAF,EACF,WAEZ,4BACC,CAAAG,EAAAS,EAAA,CAENZ,KAAA,QAAGS,IAAMnE,EACDuE,CAAaE,GAAGzE,WAAE,MAAA/B,aAAA,GAAQ,IAAA4F,EAAA,SAAC,SAAAA,EAAAgC,EAAA,CAAE1B,YAAuB,OAC1DN,CAAAD,UACE,EAAA1F,WAAA,CAAAX,SAOkC,gBAAAA,CAAA,IAAAiK,OAAA,SAAAC,cALhC,EAC2B,CAClB,EACH,GAGH,GAAC,GAAA5D,EACC,eACDA,EAAAgC,EAAA,CACN,YACJ,CAEJ,GAAAjC,YACEiC,CAAA,SAAAnC,EAAA,MAAyB,UAAAG,EAAA,MAE3BA,MAAA,QAAAD,WACE,SAAAA,SACEC,GAAA,SAAIM,KAAM,WAAOP,UACf,qBAAAA,SACEC,GAAA,CACEE,EAAK,qBAAAjJ,EAAA,cACLukB,CAA6BC,GAC7BhG,MAAWxe,EAAM,CACf2C,WAAuC4hB,EACzC,GAEF,GAAAxb,EAAA5F,KAAA,OAA0C,iBACrCyF,EAAA,SAETG,SAAA,CAAAA,EAAA,SAAIM,KAAM,WAAOP,UACf,wBAAAA,SACEC,GAAA,CACEE,EAAK,wBAAAjJ,EAAA,cACLukB,CAA6BE,GAC7BjG,MAAWxe,EAAM,CACf2C,WAA0C4hB,EAC5C,GAEF,KAAAphB,IAAAyF,EAAA,YAA8B,iBACzB,CAAAA,EAAA,SAER,SAAEyY,WACDzY,CAAIS,KAAM,WAAOP,QACfF,EAAA,4BAAAE,SACEC,GAAA,CACEE,KAAK,CACLsb,SAA6BG,EAC7BlG,SACE7b,EAAM,4BAAA4hB,EAAEA,MAAcna,+CAEtB,CACEzH,WAAgBwf,CAAmC,GACrD,UACF,IACDvZ,EAAE,MACHmC,CAAA,qBAAA/E,EAAA,+DAA+B,CAAA+C,EAAA,OAEjCH,WAAA,kBACS,CAAAG,EAAAgC,GAIJjC,WAEH,CAAAA,QACE,UAAAA,SACE,GAAA3F,SAAA,CAAA6C,EAAA,4BAA2B,MAC3B4C,OACSsZ,MAAkB,EAEzBzX,SAAOzK,GAAA,CAAEyT,EAAO,0CAAAzT,EAAA,kBAAO,EACvBwe,SAAWxe,YAAM,CACf2C,MAAOgE,GAET,SAAAoC,EAAAgC,EAAA,CAAEjC,YAEMzF,OAAM,CAAEyF,0BACd,MAAAC,EAAAuZ,mBAC4C,YACrC,aACD,EACRvZ,GAAA,IAAAwU,GAAA,CAAQnS,QAAQsS,GAAA,CAAA5U,OAAC,KAChB4Y,eACC,KACa5H,IACX8D,OAAUL,KACX,OAAAA,EAAA,IACD,KACazD,kBACHyD,SAAKzD,CACd,MAAAyD,EAAA,KACD,SAAMoH,MAAuB/F,MAAWnB,KACxC,EACE,GAAoB3D,GACsB8E,EAClC,GAAA7V,EAEV,SAAAH,EAAA,aACK,6BACJ,CAAAG,EAAAgC,EAAA,CAEThC,YACKM,OAAM,CAAmBP,IAC5BiC,SAAA,0CAAA3H,QAAA,OAEI4C,kBACS,SAAA0b,GAAA,IAAAnE,GAAA,CAKbxU,MAAA6V,EAAAlB,GAAA,CAAKrU,KAAMkU,EAAA,KAAiBzU,SACzB4Y,MACC,KACa5H,IACX8D,OAAUL,KACX,OAAAA,EAAA,IACD,KACazD,kBACHyD,QAAKzD,CACd,UAAA/Q,EAAA,SACD,KAAM4b,WACN,QACE3e,EAAA,kDAAAuX,EAAA,MAAAzU,SACEC,GAAA,CACEE,KAAK,UAGL,EACAuV,SACE+F,EAAQA,wDACR5hB,EAAI4hB,SAAS,gCAAAve,EAAA,gDAAA8T,OAAAyD,EAAA,KAGX,CAEA5a,SAAgBiiB,UAGd,SACJ,CAAAnH,EAAA,IAAA7U,EAAA,QACF,yBACC,SACF+b,QACC,CAAA7b,EAEE,GAAMO,CAAM,GAA4B,EAAQ,GAInD,GAAAN,EACI,WAEV,gBAAC,SACEA,EAAA,SAERA,WAAAgC,EAAA,CAAG1B,GAAM,SAAeP,QACtBA,uBACE,EAAA1F,WAAA,CAAA0e,SAQyB,gDAAApV,OAAA,SAAAC,cALvB,EACO,CACE,EACH,EAGH,GAAA5D,EAAC,SAAAH,EAAA,gBAEC,CAAAA,EAAA,SACF,UAAAG,EAAA,SAETA,KAAA,WACAD,QACEF,EAAA,sCAAAE,SACEC,GAAA,4BACEE,SAAKjJ,GAAA,CACLukB,EACEve,sCAAoB6e,gBAEtBzZ,CAA+BsZ,GAC/BlG,MAAWxe,EAAM,CACf2C,WACW4hB,EACb,IACDxb,EAAE,IACHA,CAAA,+BAAsCA,EAAA,SAExCA,WAAAgC,EAAA,CAAG1B,GAAM,SAAeP,WACtB,CAAAA,QACEiC,GAAA,KAE4B,GAAC,GAEtB,GACF,KAAC0W,IACNkB,GAAA/Z,EAAA,YACA,iBACF,CAAAA,EAAA,SAGT,SAAE6Y,WAAiBkB,CACdtZ,KAAM,WAAOP,QACfF,EAAA,2BAAAE,SACEC,GAAA,CACEE,EAAK,2BAAAjJ,EAAA,cACLukB,CAA6BO,GAC7BtG,MAAWxe,EAAM,CACf2C,WAA6C4hB,EAC/C,IACDxb,EAAE,MACHgC,CAAA,2CAAsChC,EAAA,SAExCA,WAAAgC,EAAA,CAAK1B,GAAM,SAA2BP,WACpC,CAAAA,QACEiC,CAAA,qCAAA2B,OAAA,SAAAC,cAGE,EACO,CACE,EACH,EAGH,GAAC,KAAA4U,IAKCoB,GAAA/Z,EAAA,YACF,QAAC,SACJ,CAAAA,EAAA,SAGT,SAAE2Y,WAAmBoB,CAChBtZ,KAAM,WAAOP,QACfF,EAAA,2BAAAE,SACEC,GAAA,CACEE,EAAK,2BAAAjJ,EAAA,cACLukB,CAA6BQ,GAC7BvG,MAAWxe,EAAM,CACf2C,WAA6C4hB,GAC/C,IAAAxb,EAAAS,EAAA,CACD,KAAE,YACHrG,MAAA,qBAAyC,EACpC,GAACsG,QAAK,OAAYJ,4BAA0B,SAAGN,EAAA,SAEtDA,WAAAgC,EAAA,CAAK1B,GAAM,SAA2BP,CACpC,EACE,GAAAC,EAAA5F,MAAA,OAEO,4BAAC,SACH4F,EAAA,SAETA,WAAAgC,EAAA,CAAK1B,GAAM,SAA2BP,WACpC,CAAAA,QACEiC,CAAA,8CAAA2B,OAAA,SAAAC,cAEE,EACO,CACE,EACH,EAGH,GAAC,GAAAgW,GAEC/Z,EAAA,YACF,QAAC,SACJ,CAAAA,EAAA,SAGT+Z,oBACC,CAAItZ,KAAM,WAAOP,QACfF,EAAA,2CAAAE,SACEC,GAAA,CACEE,EAAK,2CAAAjJ,EAAA,cACLukB,CACsBS,GAEtBxG,MAAWxe,EAAM,CACf2C,WACW4hB,GACb,IAAAxb,EAAAS,EAAA,CACD,KAAE,QACHrG,MAAA,qBAA0D,EACrD,GAACsG,QAAK,OAAQJ,4BAA0B,SAAGN,EAAA,SAElDA,WAAAgC,EAAA,CAAK1B,GAAM,SAA2BP,WACpC,CAAAA,SACEiC,GAAA,KAEO,GAAAhC,EAAC,aAID,4BAAC,SACHA,EAAA,SAETA,WAAAgC,EAAA,CAAK1B,GAAM,SAA2BP,CACpC,EACE,MAAAF,EAGO,YACF,QAAC,SACJ,CAAAA,EAAA,SAGVA,SAAA,CAAAG,EAAA,SAAIM,KAAM,WAAOP,QACfF,EAAA,mBAAAE,SACEC,GAAA,CACEE,EAAK,mBAAAjJ,EAAA,cACLukB,CAA6BU,GAC7BzG,MAAWxe,EAAM,CACf2C,YACF,YACC,EAAAoG,EACHA,OAAAgC,CAAA,sBAAA2B,EAAAC,EAEE5D,EAAA,aAAMM,SAAM,IAEN,GADa,GAAAN,EAAIA,MAAA,CAAgB,MAAC,qCAElCA,EAAA,SAEVA,WAAAgC,EAAA,CAAK1B,GAAM,SAA2BP,CACpC,EACE,MAAA6Z,GAGO5Z,EAAA,eACFA,EAAA,UACH,cAEP4Z,cACC7Z,YACE,CACEG,EAAK,cACLI,EAAM,eACNH,EACEvG,SAAOuiB,IAAa,CACpBviB,WAAsB,CACxB,GAEA,KAA2B,GAAAggB,GACrB5Z,EAAAoc,GAAA,SAAApb,CAEX,GACChB,EAAA,MACG,SACR4Z,IAAiB5Z,CAA0BgB,YAAmB,CAC/D,GAAAjB,YACEiC,CAAA,UAAAnC,EAAA,OAAmB,OAErBA,QAAA,OAAAE,SACEF,OACE6B,IAAO,EACL2a,WAAS,KACTC,WAAU,SACVpb,UAAK,GACO,SACZqb,GAAY,OACZC,OACF,OAAEzc,WAGA0c,OAAKzI,KACLpT,MAAI,CACJ8J,YAAM,MACNC,cAAO,SACPjJ,WAAO,UACLgb,aAAa,GACE,GACfC,QAAY,UACZC,GAAc,KAChB,kBACD,EACD/c,IAAAG,EAAA,KAAAD,oCACEA,eAAY,QACZC,GAAA,CACEmT,iBAAK,EAEL8H,EAAI,iCACJ9a,EACElJ,SAAEoJ,SACFzG,UAAOijB,MAAc7a,EAAA,CACvB,YAAEjC,WACH,CAGDC,IAAA,IAAK,CACL,yCAAA2D,OAAA,SAAAC,cACE,GACO,EACLvC,MAAO,CACP4Z,KAAI,mCAGH,eAACpX,QAEJ5M,GAAA,CACEkc,iBAAK,EAEL8H,EAAI,qCACJ9a,CACElJ,EACA2C,CAAqB,GACvB,GAGC,GAAAiG,EAAC,cACE,CAAAG,EAAA,KACJ,2CAERH,OAAA,SAAAE,eAEIoT,SAAKnT,EAAAgC,EAAA,CACLX,WAAO,CACP4Z,CAAI,GAAUlb,YAEdiC,MAAA,oDAAqB,SACpB,IAAE,WAGHmR,SAAKnT,EAAAgC,EAAA,CACLX,WAAO,CACP4Z,CAAI,GAAUlb,YAEdiC,MAAA,2CAAoB,SACnB,IAAE,WAGHmR,SAAK,YACL9R,QAAO,IAAArB,EAAA,KACPib,KAAI,2DAAUlb,gBAGb,IAAE,WAGHoT,SAAKnT,EAAAgC,EAAA,CACLX,WAAO,CACP4Z,CAAI,GAAUlb,YAEdiC,MAAA,MAAAoW,GAAA,OAAwB,SACvB,IAAE,WAEFjF,SAAMiF,KAAoB/W,WAAO,CAAS4Z,CAAI,EAAUlb,CACzD,GAAAF,EAAA,cAA4B,CAAAoP,IAAApP,EAAAC,EAAA,CAC1B,UAAAE,EAAAgC,EAAA,CAGJnC,GAAA,SAAAE,OACGkP,CACClP,KACEC,QAAAgC,eAAA,uBAAA3H,WAAA,CAAAuJ,EAEGqL,SAAQjB,CAA8C,sBAAArK,CAAA,CADvD,GAAA3D,EAAMM,KAAM,OAAAN,EAA2BgC,EAAA,IAAC,gBAG1ChC,CAGJA,IAAAgC,OAAA,0BAAA3H,SAAA,KAAA2F,EAAA,UAuBI,mDAAMM,OAAM,SAAkBP,eAG1BoT,eACA9R,SAAO,qCACP4Z,CAAI,GAAUlb,IAED,EAAkC,EAAI,WAGvD,GAAMC,EAAA,QACP,sBAAA2D,EAAAC,EAjCD5D,EAAA,SAAMM,YAAoC,uBAACuD,SAC3C,GACE3D,KAAK,KACLI,MAAM,sEACNwc,QAAQ7lB,GAAA,CACR0J,SAAK,aAILR,UAAUlJ,UAAM,UAAAA,EAAA,cACZoK,GAAO0b,EAGPxG,CACAla,WAASF,GAAC,OAAAE,GAAuBF,GAEjC1D,GAAQukB,QACR3gB,CAASF,GAAC,GAA+B,CAAC,GAC5C,GACF,SAqGwC,CACxC,GACF,EAGJ,CAoDV,SAAAigB,GAAwB,CACtB,QAAApb,CAAuB,EACzB,CACF,MAEA,EAAAic,CAAkC,EAAEjc,KAAQ,GAAG,CAAAsV,GAAA,cAC7C,KAAM,CAAEtd,YAAGC,KACNqd,IAAmB,EAAAld,EAAO,WAEzB8jB,EAAA/kB,EAAA,EAAEuB,YAAawB,GAAIiiB,CAAA,EAAA/jB,EAAA,IACnBgkB,EAAoBjlB,IAC1BC,QACA,SAAOilB,CACPC,EAAOC,SAAaJ,EACpB,IACA/kB,KAAU,CACP,aAAA2d,EACCuH,qBACA,EAAI,MAAAhG,GAAA,EACF,GAAAC,GAAM,QAAAA,EAAA,iBAAExB,MAAcwB,MAAwB,OAAAiG,EAE5CjG,QAGAkG,IACAL,EAAM,QAAApF,EAAA,KAAEwF,CAAQxF,YAAWT,UAC3B9e,cAAmC8e,UACnC6F,MAAkB/kB,MAAU2f,GAC5B,OAAM,QAAAwF,CAAA,YAAAE,EAAApjB,CAAA,KAAEmL,uBAAayX,UAAY7kB,aACjCT,EAAM+lB,QAAWlY,IAGjBmT,EACE,CACA0E,EAAI1lB,UACFA,SAAG4jB,CACL,4BAAAhE,EAAA,SACF2F,EAAC,IAEHG,SAAW,SAAS9F,CAAA,EAEpB/e,SAAgB,CAChB,CACE0kB,IAAmB,MAEnB5B,QAAM/D,IAAgBA,UAAG,OAC3B3X,EAAA,QACAyd,MAAkB,SACpB,KACF,WAAG,KACA,MAAAjjB,EAAA,gCAAA6iB,EAAA,YAEyB,EAAA7iB,EAAA,kBAG5B,CACO6iB,aACW7iB,EAAA,OACdd,OAAW,CACHc,QAASue,IAAOgF,QAChBP,wBACAhnB,QAAS,CAAAgE,EAAA,OACb8S,OAAM,EAAA9S,EAAA,sBACW2d,kBACfwF,KAAQ,EAAAnjB,EAAA,KACNwjB,QAAS,CAACxjB,EAACA,OACXyjB,WAAazjB,MAAOyjB,CACHC,CACAC,EACQC,MACjB5jB,EAAOiN,OACf8O,OAAU/b,KAAO+b,oBACjB5H,EAAQ,KAAEnU,OAAOmU,GAGvB0P,IAFI,OAAA7nB,EAAA,YAAA0H,CAAA,CAOJ6a,GACE,MAAIuF,EAAaX,EAAa,UAAAnnB,EAAA,YAC5B+nB,GAAmBZ,EAAU,EAC/BW,EACED,eACFG,GAAAhoB,CAAA,CACD,SAAAmhB,GAAA,CACK2G,QAIJ9jB,CACAgjB,WAAoBA,CACpBhnB,CACD,CAEGgnB,GAEA5kB,GAAcpC,CAAA,QAAiBmhB,GAAA,CAC/B8G,QAIGC,CACC9lB,GAAQukB,QACRzB,CAAK0B,KAAmDqB,GAAC,QAAA9G,GAAA,CAC3D,MAACyF,EAEHoB,CACE5lB,WACA8iB,CAAK0B,IAAC,MAAkD,EAAC,SAC1D,CAAAjd,EAAA,eACHA,EAAAgC,EAAA,CACF,WACEsc,EACE7lB,gBACA8iB,WAAK0B,gCAAC,CAAApd,EAAA,mBAAAG,EAAA,SAAkD,gBAAC,SAAAwe,GAAAjB,EAC1D,oBACH,QAAAF,EACI,eAAApmB,GAAA,CACR,MAEA+I,SAAA,IACEgC,OAAA,GAAAwZ,EAAA,CAAuC,MAAAiD,EAAA,uCAEzCA,IAAA,YACE,OAEI,IACEze,IAAA,UACO,MAAAid,EAEA,CACII,YAEP,CAAM,EACN,MAEEI,EAAmB,EAAMiB,CAEvBjB,CAA0B,OAC5Bzd,EAAOgC,EAAA,CACLyb,YACA,QACElC,IAAK0B,kBACHA,EAAA,CAA+E,GACjF,SACF,CACF,EACF,CACEQ,iBACF,MAAAR,EAED,CACH,aAOM,EACE3iB,CACAgI,MAAK2a,mBAAE,CAAQ,YAAC,CAElB,GACE3iB,OAAO0F,EAAA,UACPsC,MAAK2a,2BAAE,aAAiB,GAACjd,EAAA,UAC3B,KACA,SACE1F,SAAOkkB,GAAAjB,GAAA,CAAAF,CAAA,EACFJ,IAAE,GAAAjd,EAAA,6CAAW,MAAC,OAErBwC,MACA,EAAoBlI,UAAagI,SAClCtC,EAAA,OAAC,+BAAA2D,WAAA,OAAAC,oBAnBJ,SACO5D,EAAA,MACLqC,SAAUmc,EAkBJ,gBAAC,MAAAvB,EAGb,CACQ,YACC,CACE,EACT,CACQ,MAACI,YAAmBtd,MAE5Bkd,EAAmCld,CACtB,YACT,CAEI,EACEzF,CACAgI,MAAK2a,iBAAE,CAAU,YAAC,CAEpB,EACE3iB,CACAgI,MAAK2a,iBAAE,CAAO,YAAC,CAEjB,EACE3iB,CACAgI,MAAK2a,wBAAE,CAAQ,YAAC,CAElB,EACE3iB,CACAgI,MAAK2a,eAAE,CAAS,YAAC,CAEnB,EACE3iB,CACAgI,MAAK2a,iBAAE,CAAiB,YAAC,CAE3B,EACE3iB,CACAgI,MAAK2a,iBAAE,CAAO,YAAC,CAEjB,GACE3iB,OAAO0F,EAAA,MACPsC,SAAK2a,gCAAE,gBAAA7iB,KAAAsjB,EAAA,MAAY,MAAAA,EAAA,OAAC,EACtB,EACA,EACS,EACFT,QAAEjd,EAAA,oCAAWA,EAAA,cAACA,EAAAgC,EAAA,IACpB,SAED,WAAAjC,CACE,EAAAC,EAAAD,IACE,GAAOG,mBAAKxG,CAAA,YAAuBY,GACvB,EACP0F,EAAA,QAEV,EACC,EACD,EAAC,CACH,EAGL,EAAW,GAAAA,EAAaD,KACtB,yBACE,SAAA3F,EAAA,kBAAAuJ,IAAA,aAGO,WAAC5B,CAA+B,EAAA/B,EAAIG,OAASa,CAE5C,EADQ,EAAC,GAGV,EACN,CCpvCnB,MAAM2d,GAAYA,IAAM,CACtB,IAAIC,EAAQrlB,WAAW,IAAM,CAC3B,MAAMslB,EAAU1oB,SAAS2oB,eAAe,SAAS,EACjD,GAAID,EAAS,CAEX,MAAME,EAAgBF,EAAQ9f,cAAc,uBAAuB,EACnE,GAAIggB,EACFA,EAAcC,MAAK,MACd,CAEL,MAAMC,EAAqBnS,MAAMC,KAC/B8R,EAAQxgB,iBAAiB,iBAAiB,CAC5C,EAAE0W,KAAMmK,GACaA,EAAOC,sBAAqB,EAC7B1U,MAAQ,CAC3B,EACGwU,EACFA,EAAmBD,MAAK,EAGxBH,EAAQ9f,cAAc,iBAAiB,GAAGigB,QAAK,CAEnD,CACF,KAAO,CACL,MAAMI,EAASjpB,SAASkI,iBAAiB,sBAAsB,EAC/D,GAAI+gB,GAAQ5kB,OAAQ,CAElB,MAAM6kB,EAAQD,EAAOA,EAAO5kB,OAAS,CAAC,EAChC8kB,EACJD,EAAMtgB,cAAc,iBAAiB,GAAKsgB,EAC5C,GAAIC,EAAmB,CACrBA,EAAkBN,MAAK,EACvB,MACF,CACF,CAEA,GADiB7oB,SAAS4I,cAAc,gBAAgB,EAC1C,OAEd,MAAMwgB,EAAQppB,SAASkI,iBAAiB,iBAAiB,EACnDmhB,EAAOD,EAAMA,EAAM/kB,OAAS,CAAC,EAC/BglB,GAAQA,EAAKtN,WAAa,IAC5BzZ,QAAQma,CAEV,CACF,OACF,MAAO,iBAAAgM,CAAA,CACP,ECxCa,SAASa,GAAkBnqB,EAAI,CAC5C,GAAI,CAACA,EAAI,OACT,MAAM+Z,EAAWqQ,GAAW,EACtBC,EAAqBxnB,EAAOkX,EAASI,QAAQ,EACnDrX,EAAU,IAAM,CAMZunB,EAAmBtnB,SACnBgX,EAASI,WAAakQ,EAAmBtnB,SAEzC/C,IAAE,CAEN,EAAG,CAAC+Z,EAASI,SAAUna,CAAE,CAAC,CAC5B,CCnBA,SAASsqB,GAAkB,CAAEC,OAAMnmB,UAAS,EAAG,CAE7C,GAAI,CAAComB,EAAUC,CAAM,EAAIF,EAAKG,MAAM,GAAG,EAClCD,IAAQA,EAASrmB,GACtB,MAAMumB,EAAcC,GAASC,QAAQN,CAAI,EACzC,OACEhgB,EAAA,OAAKS,MAAM,cAAaP,UACtBF,EAAA,QAAMS,MAAM,gBAAgB+C,MAAO4c,EAAYlgB,UAC7CC,EAAA,KAAGM,MAAM,kBAAiBP,SAAE+f,EAAY,EACxC9f,EAAA,QAAMM,MAAM,YAAWP,SAAC,IAAO,EAC/BC,EAAA,KAAGM,MAAM,gBAAeP,SAAEggB,EAAU,CAAC,EACjC,EACNlgB,EAAA,OAAKS,MAAM,gBAAeP,UACxBF,EAAA,QAAMS,MAAM,KAAIP,UACdC,EAAA,QAAMM,MAAM,8BAA+B,EAAC,IAACN,EAAAgC,EAAA,CAAA5H,GAAA,SAAsB,CAAC,EAChE,EAAE,IACRyF,EAAA,QAAMS,MAAM,KAAIP,UACdC,EAAA,QAAMM,MAAM,4BAA6B,EAAE,IAC3CN,EAAAgC,EAAA,CAAA5H,GAAA,SAAgC,CAAC,EAC7B,CAAC,EACJ,CAAC,EACH,CAET,CCjBA,MAAMgmB,GAA0B,CAC9B,aACA,YACA,YACA,YAAY,EAERC,GAA8BD,GAAwBpT,KAAK,GAAG,EAEpE,SAASsT,GAAoB,CAAEnL,OAAM7a,QAAO+H,WAAUke,MAAO1Y,CAAE,EAAG,CAChE,KAAM,CAAC2Y,EAAUC,CAAW,EAAIrnB,EAAS,CAAC,CAACkB,CAAK,EAChD,OACEuF,EAAA,MAAAE,UACEC,EAAA,MAAAD,SACEC,EAAA,SACEE,KAAK,OACLiV,KAAM,qBAAqBtN,CAAC,UAC5B/P,aAAcqd,EACd9S,WACAqe,UAAW,IACXC,SAAUH,EACVI,IAAI,OACJC,aAAa,OACd,EACC,EACJ7gB,EAAA,MAAAD,SACEC,EAAA,SACEE,KAAK,OACLiV,KAAM,qBAAqBtN,CAAC,WAC5B/P,aAAcwC,EACd+H,WACAqe,UAAW,IACXjL,SAAWxe,GAAMwpB,EAAY,CAAC,CAACxpB,EAAE6pB,cAAcxmB,KAAK,EACpDsmB,IAAI,OACJC,aAAa,OACd,EACC,CAAC,EACH,CAER,CAEA,SAASE,GAAiB,CAAE/f,UAAUA,IAAM,CAAC,CAAE,EAAG,CAChD,KAAM,CAAEhI,KAAGC,KACL,CAAEQ,SAAUyB,KACZ,CAAC8lB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAAC+Y,EAAS8O,CAAU,EAAI7nB,EAAS,IAAI,EACrC,CAAC8nB,EAAeC,CAAgB,EAAI/nB,EAAS,IAAI,EACjD,CAACgoB,EAAeC,CAAgB,EAAIjoB,EAAS,IAAI,EAEvDhB,EAAU,IAAM,EACb,SAAY,CACX,GAAI,CACF,MAAMkpB,EAAM,MAAM7nB,EAAMM,GAAG2C,SAAS6kB,oBACpCN,EAAWK,CAAG,EACdhE,EAAW,SAAS,CACtB,MAAY,CACV7kB,SAAe,CACf6kB,CAAkB,IACpB,EACF,EAAG,EACL,KAAK,CAEL7kB,cACA,OAAA0iB,EAAQqG,SAAarG,UAAQsG,MAAQC,CAAO,KAAAC,EAC5C,OAAAC,CAAM,EAAED,MAAMC,YAAsB,IAAAH,EAAA,EACpC,KAAMI,QAEN,IAAMC,CACU,GAAE5hB,GAAM,GAAAkhB,EAAA,EAAS3O,KAAKgP,QAAQ,IAAIL,CAC3B,GAAElhB,EAAM,EAASuS,EAAK2O,QAAe,KAAO,QAEnE,IAAMW,CACU,GAAE7hB,GAAM,GAAAghB,EAAA,EAASzO,KAAKiP,QAAQ,IAAIR,CAC3B,GAAEhhB,EAAM,SAAcghB,SAAe,MAAO,QAGnE,4BACO5gB,SAAM,GAAAU,GAAAhB,EAAA,UAAQ5F,KAAG,6BAEV8F,QAAKc,EAASV,SAAMN,EAAAS,EAAA,CAAcN,SAAiBJ,MAC1Ca,CAAGzE,YAAE,GAAO,GAAC6D,EAAA,UAAC,SAAEA,EAAA,KAGnCA,WAAAgC,EAAA,CAAAjC,WACE,CAAAA,CACE,KAAAC,EAA0B,QAAC,SAC1BghB,IAAA,UAAAhhB,EAAA,KAELA,MAAA,WAAAD,SACGihB,KAAY,CACR1gB,OAAM,GAAUP,CACV,GAACiiB,SAAM,UAAE/qB,GAAA,CACfA,EAEH4I,eAAA,UACmB,aAAA5I,EAAA,QACboJ,IAAe,cACX4Z,IAAeC,YAAW7Y,EAC1BqgB,EAASzH,EAAa,kBAAQ,EAC9BwH,IAASxH,IAASpG,MAAI,EACtB2N,EAAuB3N,EAAkB,6DACzC8N,EAAgB9N,GACtBoO,EAAMA,QACJJ,IAGF,eACAI,WAAgCC,0CAAU,MAClC/M,EAAO+M,EAAM/M,wBACnBoL,GAAUA,GAAUjmB,MAEAA,CAAQ4nB,MAAqB3B,CAAA,MACjD4B,GAAoB7nB,GAAO,EAAAA,EAEzB6nB,GAA+B7nB,EACjC,QAAA4nB,GAAA,CACDA,EAAA,OAAAA,EAAA,QAEDC,WAEID,IAAc,SAChB,CACD,IAEA,MAAAE,EAAY,MAAA3oB,EAAA,+BACP,OAAA4oB,EACF,OAAMD,EACJV,cACAD,OACAD,qBACAG,IACAQ,CACD,gBACD1pB,QAAQma,CACR5R,EAAU,OACRF,EAAO,OACPqR,YAASiQ,GAGX3pB,GAAQ6Y,QACRiK,CAAgBpf,GAAI,MAA2B,SAAC,CAAA0D,EAAA,aAClD,+BACF,SAAG,CAAAA,EAAA,SACL,UAAAG,EAAAgC,EAAA,CAAEjC,WAEF,CAAKO,MAAMN,EAAA,SAA8BD,YACvCA,cACE3F,OAAAimB,GAA4B,SAC5BrgB,GAAA,CACEE,MAAKoiB,EAAArrB,EAAA,gBACLke,GAAKmN,EAAA,CACLC,MAAQlC,2BACSmC,CAAA,CACf,CACA,CACE,GACArB,YAAqB,MACvB,oCACF,CAAAO,EAAA1hB,EAAA,OACA,mBAEJH,SAAA,IAAKS,QAAM,KAA0BP,EAClC2hB,eACC,CACEphB,iBAAMyhB,EACN7P,WAAS,EAEPtY,EAAwB,SACtB6oB,QAAkBV,KAClBW,EACF,OACF,IAAE3iB,QAEF,OAAU2hB,eAAQ9gB,GAAIf,EAAAC,EAAA,CAAE,SAAE,CAAAE,EAAAS,EAAA,CACvB,KAEL,cAAKH,IAAM,OAEZ4gB,mBACCnhB,SACEC,IAAMU,QAAK,KACXV,EAAA,gBACEM,iBAAMyhB,EACN7P,WAAS,EAEPtY,EAAwB,SACtB6oB,QAAkBV,KAClBW,EACF,OACF,GAAE3iB,CAEF,GAAUmhB,GAAmB,GAAArhB,EAAI,aAC7B,wCAET,CAAAA,EAAA,SACG,UAAAG,EAAAgC,EAAA,CAERnC,GAAA,SAAKS,MAAMN,EAAA,SAA8BD,YACvCA,cACE3F,OAAAimB,GAA6B,SAC7BrgB,GAAA,CACEE,MAAKoiB,EAAArrB,EAAA,gBACLke,GAAKmN,EAAA,CACLC,MAAQlC,2BACSmC,CAAA,CACf,CACA,CACE,GACAnB,YAAqB,MACvB,oCACF,CAAAI,EAAAzhB,EAAA,OACA,mBAEJH,SAAA,IAAKS,QAAM,KAA0BP,EAClC0hB,eACC,CACEnhB,iBAAMwhB,EACN5P,WAAS,EAEPtY,EAAwB,SACtB6oB,QAAkBX,KAClBY,EACF,OACF,IAAE3iB,QAEF,OAAU0hB,eAAQ7gB,GAAIf,EAAAC,EAAA,CAAE,SAAE,CAAAE,EAAAS,EAAA,CACvB,KAEL,cAAKH,IAAM,OAEZ8gB,mBACCrhB,SACEC,IAAMU,QAAK,KACXV,EAAA,gBACEM,iBAAMwhB,EACN5P,WAAS,EAEPtY,EAAwB,SACtB6oB,QAAkBX,KAClBY,EACF,OACF,GAAE3iB,CAEF,GAAUqhB,GAAmB,GAAAphB,EAAI,cAC7BH,EAAA,kBAET,CAAAG,EAAAgC,EAAA,CACG,YAERhC,QAAA,SAAAD,KACEF,OAAAE,oBACE3F,aAAAonB,EAAkB,UAClBxhB,GACEE,SAAK8gB,IAAA,UACL7L,WACArd,aAAc0pB,QACdd,CAAW,EACW,GAAA1gB,EACtB4gB,IAAI,UACJC,UAAa,CAAM,SACnB,CAAA7gB,EAAAgC,EAAA,CACG,YAEThC,IAAA,YAAAD,aACE4hB,EAAA5hB,YACE3F,UAAA,IAAiB,KACjB4F,IACElI,aAAc6pB,UACdxM,UAAK,EACLuL,CAAW,EACN,GAAA1gB,OACiB,SAClBA,EAAAgC,EAAA,CAAM,GACV,SACG,EACN,EAEHhC,EAAA,SAAAD,MACE,UAAAC,EAAA,SAA0B,SAAAH,EAAA,MAE5BA,SAAA,CAAAG,EAAA,MAAY6hB,cAAoB9hB,GAC9BC,QAAA,CAAAD,CACE,CAAAA,SACEC,CAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAmB,EACjB,EACJ,EACE,GAAA4F,EAAA5F,QAAA,UAAqB,YAAC,OACnB,WAAAwnB,EAAA,QACH,OAAA9P,EAAAjK,IAAA,CAEN7H,KAAA,CAAAD,UACgBvF,QAAQmoB,EAAyB,EAAKngB,EAC9CqF,IAAM,GACR,OAAM7H,EAAAsgB,GAAA,CAAEnL,OAAW7a,QAAW,MAAIsnB,EAClC,SACGtB,aAAmB,EAElBnL,IACA7a,GACOuN,cACGmZ,CAAY,SACvB,CAAAhhB,EAAA,UAEL,KACF,SACM,cAEVH,SAAAmhB,IAAA,UAAAjhB,QACEC,IAAA,CACEE,IAAK,CACLI,EACA+B,SAAU2e,IAAY,YAEpBhgB,EAAU,GACZhB,EAAA,UAAED,cAEF,SAAAihB,IAAA,mBAAoBhhB,EAAAgC,EAAA,CAEtBhC,WAAA,CAAQE,CAAK,EAASmC,CAAsB,GAC1C,KAAkB,EACX,CC/TvB,MAAMugB,GAAqB,GAE3B,SAASC,GAAa,CACpBC,UAAW1oB,EACXwB,OACAmnB,OAAO,GACPC,4BAA4B,EAC9B,EAAG,CACD,KAAM,CAAEvpB,SAAUyB,KACZ+nB,EAAwB9qB,IACxB,CAAC+qB,EAAqBC,CAAsB,EAAI/pB,EAAS,SAAS,EAClE,CAACgqB,EAAcC,CAAe,EAAIjqB,EAAS,EAAE,EAC7C,CAACkqB,EAAkBC,CAAmB,EAAInqB,EAAS,EAAE,EAiCvB,OAhCpChB,EAAU,IAAM,CACTorB,GAAS,wBAAwB,GACjCT,IACJ,SAAY,CACXI,EAAuB,SAAS,EAChC,GAAI,CACF,MAAMzmB,EAAW,MAAMjD,EAAMM,GAAG2C,SAASC,QAAQvC,CAAE,EAAEgpB,aAAanpB,KAAK,CACrEC,MAAO0oB,GACR,EACDnqB,MAAY,QAAE2qB,EAAc1mB,WAAU,MACtC,CACEymB,KACAA,EAAA,WACF,gBACAE,EAAwB,wBACxBF,kBACA5pB,MAAW,SACT0pB,EAA6C,KAC3CQ,EAAU,MACVC,EAAO,MAAAC,GAAAjnB,EAAA4mB,CAAA,EACRM,KACGA,CAAA,CAMN,MAAIA,CACFL,EAAoBK,QAAa,CACnC,IAEAnrB,UACA0qB,EAA8BJ,GAAAK,EAAA,SAAAL,GAE/B/iB,EAAA,OACL,MAAI+iB,mBAEJ,SAAMc,QAAab,CAIf,+BAEJ,SACEnjB,EAAA,OAAKS,MAAM,yBAAkBP,MACtBO,SAAM,CAAAN,EAAA,MAAwBD,WACjCiC,EAAA,CAAK1B,GAAM,SAAyBL,OAAKgjB,CAAsBljB,IAC7DC,QAAA,CACE,KAAA3F,IAAA,UAAA2F,EAAA,WAA8BpE,WAAKkkB,SAAQ9f,EAAA8jB,GAAA,CAAQ,UACjD,CAEF,GAAGxjB,EAAM,SAAAN,EAAA,MAAUD,sBACVqjB,EAAA,mCAAOA,EAAA,IAAAjR,GAAAnS,EAAA,MAAE,SAAAA,EAAA+jB,GAAA,CAEhBX,oBAEO,GAEJrjB,WAEFqjB,MACCrjB,aACGgkB,EAAY5R,EAAA,KAEXA,QACS,GAAAnS,EACTgkB,KAAW,MACXC,yBAAyC,WAC1CjiB,EAAA,CAEJ,YACC,CAEJ,EAAG1B,CAAM,EACP,KAzCR,IAyC2C,CC7FjD,MAAM4jB,GAAgB,IAAO,GACvBC,GAAU,KAAU,GAAK,IAElBC,GAAa7nB,GACxB,SAAY,CACV,KAAM,CAAE9C,SAAUyB,GAAG,EACfmpB,EAAQ,MAAM5qB,EAAMM,GAAGsqB,MAAMpqB,KAAI,EACvCoqB,SAAMjP,KAAK,CAACrJ,EAAGsJ,IAAMtJ,EAAE1I,MAAMkS,cAAcF,EAAEhS,KAAK,CAAC,EAE/CghB,EAAM7pB,QACRjB,WAAW,IAAM,CAEfoa,GAAMxB,QAAQwD,IAAI,QAAS,CACzB0O,QACAC,UAAW5hB,KAAK1G,IAAG,CACrB,CAAC,CACH,EAAG,CAAC,EAGCqoB,CACT,EACA,CACEtnB,OAAQmnB,EACV,CACF,EAEO,eAAeK,IAAW,CAC/B,GAAI,CACF,KAAM,CAAEF,QAAOC,aAAc3Q,GAAMxB,QAAQ0B,IAAI,OAAO,GAAK,GAC3D,OAAKwQ,GAAO7pB,QACRkI,KAAK1G,MAAQsoB,EAAYH,IAE3BC,GAAU,EACHC,GAJkB,MAAMD,GAAU,CAO7C,MAAY,CACV,MAAO,EACT,CACF,CAEO,MAAMI,GAAYjoB,GACtBnC,GAAO,CACN,KAAM,CAAEX,SAAUyB,GAAG,EACrB,OAAOzB,EAAMM,GAAGsqB,MAAM1nB,QAAQvC,CAAE,EAAEQ,MAAK,CACzC,EACA,CACEmC,OAAQmnB,EACV,CACF,EAEO,eAAeO,GAAQrqB,EAAI,CAChC,KAAM,CAAEiqB,SAAU1Q,GAAMxB,QAAQ0B,IAAI,OAAO,GAAK,GAChDpb,MAAW,OAAC,CAAE4rB,4BAAQ,GAAAK,EAAA,OAAAA,CACtB,CACE,IACA,OAAIA,GAAStqB,CAAA,CACf,OACA,OAAI,MAGF,eAAWuqB,GAAAvqB,EAAA,CAEf,OADE,MAAAqqB,GAAArqB,CAAA,IACF,SAEA,CACE,SAAawqB,GAAcxqB,EAAG,CAC9B,MACF,MAAAiqB,CAEA,EAAA1Q,GAAO,QAASiR,WAAa3qB,GAAM,GACjCoqB,GAAM,SAAEA,UAAOA,EAAG1Q,KAAMxB,GAAOkD,IAAKtJ,EAAA,MAAQ,cAAMsJ,EAAA,QAClD1B,GAAI0Q,QAAO7pB,IAAQ,SACjB6pB,QACAA,UAAa,KAAG,IAAKtY,CACrB4H,GAEE2Q,CACA,SAAAO,GAAA5qB,EAAA,CACJ,MACF,MAAAoqB,CAEA,EAAA1Q,GAAO,QAASkR,WAAeA,GAAK,GAClC,GAAAR,GAAM,QAAEA,oCAAU1Q,IAAMxB,KACpBkS,EAAK9D,CAAE/lB,EAAQP,EACjBoqB,EAAM9D,KAAK,CAAG8D,cAAkB,cAAcpqB,OAAQ,GACtD0Z,GAAI4M,QAAY,IAAE,SAChB8D,QACAA,UAAa,KAAG,IAAKtY,CACrB4H,GAEE2Q,CACF,CACF,SAAAQ,GAAAC,EAAA,CACF,MACF,MAAAV,CAEA,EAAA1Q,GAAO,QAASmR,WAAeA,GAACC,GAC9B,GAAAV,GAAM,QAAEA,iCAAU1Q,IAAMxB,KACpBkS,EAAK,OAAQ9D,EAAE,GACjB5M,GAAM4M,QAAQ8D,IAAMW,QAAS,CACzBzE,QACF8D,UAAa9D,KAAK,IAAG,CACrB5M,GAEE2Q,CACF,CCxGN,SAASW,GAAmB,CAAEC,eAAc,EAAG,CAC7C,KAAM,CAAElsB,KAAGC,KACX,OACE+G,EAACS,EAAI,CACHC,KAAK,SACLC,KAAK,KACLL,MAAO,wBAAwB4kB,EAAgB,gBAAkB,EAAE,GACnE7hB,MAAKlH,EAAE,CAAA/B,GAAA,SAAmD,CAAC,CAC5D,CAEL,CCLA,SAAS+qB,GAAY,CAAElrB,OAAM+G,SAAQ,EAAG,CACtC,KAAM,CAAEhI,KAAGC,KACL,CAAEQ,SAAUyB,KACZ,CAAC8lB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1CgsB,EAAW,CAAC,CAACnrB,EACborB,EAAeltB,IACfmtB,EAAwBntB,IACxBotB,EAAoBptB,IAC1BC,EAAU,IAAM,CACVgtB,IACFC,EAAahtB,QAAQiC,MAAQL,EAAKoJ,MAClCiiB,EAAsBjtB,QAAQiC,MAAQL,EAAKurB,cACvCD,EAAkBltB,UACpBktB,EAAkBltB,QAAQmjB,QAAUvhB,EAAKwrB,WAG/C,EAAG,CAACL,CAAQ,CAAC,EACb,MAAMM,EACJlC,GAAS,0BAA0B,GACnCA,GAAS,4BAA4B,EAEvC,OACE3jB,EAAA,OAAKS,MAAM,QAAOP,SAAA,CACf,CAAC,CAACiB,GACDhB,EAAA,UAAQE,KAAK,SAASI,MAAM,cAAcH,QAASa,EAAQjB,SACzDC,EAACS,EAAI,CAACC,KAAK,IAAIE,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EACzB,EACP,IACH4F,EAAA,UAAAD,SACEC,EAAA,MAAAD,SAAa5D,EAARipB,EAAW,CAAAhrB,GAAA,UAAe,CAAAA,GAAA,SAAJ,CAAe,CAAK,EACzC,EACR4F,EAAA,QAAAD,SACEF,EAAA,QACES,MAAM,YACNqlB,SAAW1uB,GAAM,CACfA,EAAEoJ,iBAEF,MAAM4Z,EAAW,IAAIC,SAASjjB,EAAEoK,MAAM,EAChCgC,EAAQ4W,EAASpG,IAAI,OAAO,EAC5B2R,EAAgBvL,EAASpG,IAAI,gBAAgB,EAC7C4R,EAAYxL,EAASpG,IAAI,WAAW,IAAM,KAChDpb,EAAQma,SAAI,YACVvP,CACAmiB,IACAC,MACDL,EACD9H,EAAW,MAAS7jB,EAAA,iBAAAQ,EAAA,YAEnB,MAAAoJ,EACK,eAAAmiB,EACEI,WAEJ,GAC4DA,EACxDviB,yBACAwiB,QACAJ,iBACD,UAAAA,CAAA,CACH,EAC2CnI,EACvCja,eACAwiB,CAAgBL,MAChBC,UACF,KAACG,CAAA,CACH,EAEAntB,eAAYmtB,CACZtI,EACAtc,GAAU4kB,CAAA,EAER3rB,GAAM2rB,EAGRrsB,IACE,MAAI6rB,CACFP,WAA0B,MACrB1oB,EAAPipB,EAEA,CACE,aAIJ7J,CACUpf,YAHV1D,CAIM,EAAsB,IAAC0D,WACvB,CAAA6D,EAAA,sCAAwBH,EAAA,aAC9B,aACF,UAAAG,EAAAgC,EAAA,CACC,YACL,MAAAhC,EAAA,SAAED,IAEFC,EAAKM,KAAM,OAAeP,gBACjBmb,KAAI,QAAYnb,SACrBC,GAAA5F,SAAA4mB,IAAA,UAAkB,IAAE,MACpB,EACE/gB,CAAKolB,EACA,GAAArlB,EACL5F,MAAG,OACH+a,gBAAK,SACLwL,EAAQ,gBACc,KACtBC,iBAAU,SACV,GACG,SAAAI,IAAA,UAEThhB,SAAA,CAAAA,EAAA,UAAKM,MAAM,OAAeP,WACxBiC,EAAA,CACE/B,GAAKqlB,SACLnQ,CAAK,CACLwL,aAAQ,kBACwB5gB,SAEhCC,EAAAgC,EAAA,CAAQ1H,WAAM,CAAMyF,CAClB,GAAA3F,EAAA,gBAA0C,OACpC,SACR4F,EAAAgC,EAAA,CAAQ1H,WAAM,CAAUyF,CACtB,KAA6C,GAAC2lB,GAEhD1lB,EAAA,aAAQ1F,gBAAM,SAAMyF,UAClBiC,CAAA,MAAA5H,cAAA,SAAgC,CAAA4F,EAAA,SACzB,IAAAulB,EACH,gBAETG,iBACMplB,SAAM0gB,IAAA,UAAejhB,QACxBklB,GAAA,CAAO3kB,cAAM,GAAaP,QACxBC,EAAA,CACEC,WAAKslB,EACLrlB,CAAK,EACA,GAAAL,QACKmhB,CAAY,MACrB,mBACgB,SAACkE,YAAa,MAAI,SACrC,SAAAlE,IAAA,mBAA0D7kB,EAAAipB,EAIhEvlB,CAAKS,GAAM,WAEEnE,YADX,CACc,GAAMipB,GAAAplB,EAAAqT,GAAA,CAAC,SAAAlX,4CAAG,sBAAAA,EAAS,CAEhCipB,WACa,CACY,EAEtB5R,aACAD,WAAYpX,aAAE,IAAA/B,MAAAX,EAAA,iBAAAQ,EAAA,aAAmBqjB,EAAA,WAACtc,IAAA,OACnB,SAGbsc,GAEC,WAAY,KACPwH,GAAA7qB,EAAA,GACF,IACAqjB,OACAtc,EAAU,eACRF,EAEFvH,CACEurB,WAAuB,CACrB,EAEJrsB,CACA6kB,IACA/B,EAAKpf,0BAAC,uCAAwB6kB,IAAA,mBAAChhB,EAAAgC,EAAA,CACjC,YACF,CAAG,CACL,GAAEjC,CAEF,GACO,EACC,GACgB,EAEtB,CChLlB,SAAS+lB,GAAoB,CAAEhD,YAAW9hB,SAAQ,EAAG,CACnD,KAAM,CAAEhI,KAAGC,KACL,CAAEQ,SAAUyB,KACZ,CAAC8lB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAACirB,EAAO0B,CAAQ,EAAI3sB,EAAS,EAAE,EAC/B,CAAC4sB,EAAwBC,CAAyB,EAAI7sB,EAAS,EAAE,EACjE,CAAC8sB,EAAanU,CAAM,EAAIC,GAAYgD,GAAMA,EAAI,EAAG,CAAC,EAExD5c,EAAU,IAAM,CACdklB,EAAW,SAAS,GACnB,SAAY,CACX,GAAI,CACF,MAAM+G,EAAQ,MAAME,KACpBwB,EAAS1B,CAAK,EACd,MAAM2B,EAAyB,MAAMvsB,EAAMM,GAAG2C,SAC3CC,QAAQmmB,CAAS,EACjBuB,MAAMpqB,OACTxB,EAAY0tB,CAAA,EAAA7I,EAAE+G,gBAAO2B,CAAuB1I,EAAC,QAC7C2I,CACA3I,IAAoB,GACtB4I,CAASjvB,CAAG,EACVwB,QAAe2tB,CAAA,EAAAhtB,EAAA,IACfkkB,eAAW,CAAO,MACpB,QACF,GAAG,4BACL,SAAI4I,GAAWllB,GAAChB,EAAA,UAEhB,KAAOqmB,SAEP,oBACO/lB,QAAMU,EAAQ5G,SAAG4F,EAAAS,EAAA,MAA2B,IAErCP,IAAK/D,EAA6BgE,CAAiBJ,GACzDC,QAAK,CAAM,CAAO7D,OAAE,mBAAA6D,EAAA,eAAOA,EAAAgC,EAAA,CAAC,YAAG,EACzB,CAEV,GAAAjC,SACE,UAAAA,GACEiC,OAAA,EAAAhC,EAAA,uCAAmCqkB,EAAA,IAAApqB,GAAA,CACjC,MAAAqsB,EAAAN,EAAA,KAAAO,KAAA,KAAAtsB,EAAA,IAEN4F,OAAAG,EAAA,eACGqkB,EAAM7pB,UACD8F,KAAM,SAAiBP,MACxBskB,SAAWpqB,EAAS,eACnB,aAAe+rB,UAGf,QACE,KAAAjmB,WACE,GACEG,SAAK,CACLI,GAAO,CACG0gB,QACD7gB,EAAM,iBAAAlG,EAAA,qBACbqjB,WAAoB,CAAAwF,CAAA,CACpB,CAAC,EAEG,MAAIwD,EAAQ,iBAAArsB,EAAA,qBACV,YAAeoqB,CACZ1nB,CACgB,GAGrBoV,EAAA,CACE,MAAMtY,CAEa6jB,EACfkJ,OAAa1D,EAAS,MACvB3mB,EAAAmqB,EAGLvU,IACO9a,QACPwB,EAGQ0D,CACF,YAHNmhB,CAGM,CAA6B,CAACnhB,MAC9B,SAAA/B,GAAAqG,EAAA,MAAwB,mBAC9B,OACFT,EAAA,QACF,SAAG/F,EAAA,MACL,IAEK,EAAM,EAAmB,GAAA+mB,IAC9B,UAAAhhB,EAAA,sBAAYqD,SAAarD,EAAA8jB,GAAA,QACnB,IACN,GAEP9C,IAAA,QAAAhhB,EAAA,KACC,MACFghB,WACC1gB,SAAMN,EAAAgC,EAAA,CAAUjC,WACV,EAAO,GAAEC,EAAA,KACf,MACDghB,WACC1gB,SAAMN,EAAAgC,EAAA,CAAUjC,WACjB,KAAmCF,EAAA,UAClC,KAEHG,SAAGM,MAAM,SAAUP,YACjBiC,EAAA,aAAAgf,IAAA,mBAAuB,CAAAhhB,EAAAS,EAAA,CAG3BZ,KAAA,OACEK,KAAK,IACLI,MAAMN,EAAA,QACNG,SAASA,EAAMimB,cACO,CAAUrmB,CAE3B,EAACW,CAAK,GAAY,GAAG2lB,GAC1BrmB,EAAAkE,GAAA,SAAAnE,IACE3F,WAAAnD,EAAA,eAAAmvB,EAAsB,GACjB,EAEL,SACLC,KACCrmB,SACkB,KACd,QAAMqB,GAAayf,CACjBsF,qBACFrU,EAAA,EACAhS,EAEU,GACV9F,CAA4BA,EAE1B,GACE8X,EAAO,CCpIvB,SAAS0U,GAAiB,CACxBtU,UACAwP,KAAM+E,EACNC,uBAAuBA,IAAM,CAAC,EAC9B3lB,UAAUA,IAAM,CAAC,CACnB,EAAG,CACD,KAAM,CAAEhI,KAAGC,KACL,CAAEQ,SAAUyB,KACZ,CAAC8lB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1CwtB,EAAczuB,EAAO,IAAI,EAE/BC,SAAU,IAAM,CACd,IAAIwmB,EACJ,OAAIgI,EAAYvuB,SAAW,CAACquB,IAC1B9H,EAAQrlB,WAAW,IAAM,CACvBqtB,EAAYvuB,QAAQ2mB,SACtB,EAAG,GAAG,GAED,IAAM,CACX1lB,aAAaslB,CAAK,CACpB,CACF,EAAG,EAAE,EAGH/e,EAAA,OAAKS,MAAM,QAAQlG,GAAG,yBAAwB2F,SAAA,CAC3C,CAAC,CAACiB,GACDhB,EAAA,UAAQE,KAAK,SAASI,MAAM,cAAcH,QAASa,EAAQjB,SACzDC,EAACS,EAAI,CAACC,KAAK,IAAIE,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EACzB,EAEV4F,EAAA,UAAAD,SACEC,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAAuJ,EAGMuO,GAAS2N,UAAY3N,GAAS0N,MAAIlc,WAAA,CAAAC,EADtC5D,EAAA,QAAMM,MAAM,eAEN,EAAC,CACF,EACN,EACG,EACRN,EAAA,QAAAD,SACEF,EAAA,QACE8lB,SAAW1uB,GAAM,CACfA,EAAEoJ,iBAEF,MAAMshB,EADW,IAAIzH,SAASjjB,EAAEoK,MAAM,EAChBwS,IAAI,MAAM,EAC5B8N,GAAMkF,SAAWH,GAAaG,SAChCvJ,EAAW,SAAS,GACnB,SAAY,CACX,GAAI,CACF,MAAMwJ,EAAkB,MAAMrtB,EAAMM,GAAG2C,SACpCC,QAAQwV,GAAS/X,EAAE,EACnBunB,KAAK1L,OAAO,CACX8Q,QAASpF,EACV,EACHlpB,EAAQma,WACR0K,EAAoBwJ,CAAA,EACpBH,GACA3lB,SAAQ,GACE,SACVvI,kBAAe0D,EAEfof,CAAgBpf,YAAI,GAAgC,KACtD,EACC,SACL,CAAA6D,EAAA,YACF,IAAA4mB,EAAE7mB,YAGAE,SAAK2mB,cACLzR,WACA9S,SAAU2e,CAAY,GACtBJ,EAAI,UAAM7gB,SAET2mB,aAEH7mB,KAAA,SAAAE,cAEIG,SAAK8gB,IAAA,UACL1gB,QAAM,UAENH,EACEa,WAAUgB,EAAA,CACZ,YAAEjC,CAEF,GAAA3F,EAAA,iBAAoB,CAAA4F,EAAA8jB,GAAA,CAEtBjkB,OAAA,GAAAE,OAAAihB,IACG8C,SAAM,GAAC9B,WAAM,CAACzpB,SAAQyoB,IAAY,UAAY,KAC/ChhB,SAAQqC,SAAU2e,IAAY,CAAW9gB,GAAK,SAAQH,CACpD,MAA8B,GACvB,EACJ,GACA,EACL,CC/Fd,SAASinB,GAAmB,CAAErF,OAAMC,SAAQ5gB,SAAQ,EAAG,CACrD,KAAM,CAAEhI,KAAGC,KACLguB,EACJrF,GACIpf,IAAI,CAAC,CAAE2S,OAAM7a,WAAY,GAAG6a,CAAI;AAAA,EAAK+R,GAAY5sB,CAAK,CAAC,EAAE,EAC1D0S,KAAK;;AAAA,CAAM,GAAK,GAEfma,EAAOD,GAAYvF,CAAI,GAAKsF,EAAa;;AAAA,EAAOA,CAAU,GAAK,IAErE,OACEpnB,EAAA,OAAKS,MAAM,QAAOP,SAAA,CACf,CAAC,CAACiB,GACDhB,EAAA,UAAQE,KAAK,SAASI,MAAM,cAAcH,QAASa,EAAQjB,SACzDC,EAACS,EAAI,CAACC,KAAK,IAAIE,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EACzB,EAEV4F,EAAA,UAAAD,SACEC,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA4B,EAC1B,EACE,EACRyF,EAAA,QAAAE,UACEC,EAAA,KACE0B,MAAO,CACL0lB,WAAY,YACZrnB,SAEDonB,EACA,EACHnnB,EAACqnB,GAAgB,CAACC,eAAc,GAACH,OAAa,CAAC,EAC3C,CAAC,EACJ,CAET,CCdA,MAAMI,GAAiB,CACrB,IACA,KACA,KACA,KAAU,EACV,KAAU,GACV,KAAU,GAAK,EACf,KAAU,GAAK,EACf,KAAU,GAAK,GACf,CAAG,EAECC,GAAwB,CAC5B,EAAG,CAAAptB,GAAA,UACH,IAAKqtB,GAAa,EAAG,QAAQ,EAC7B,KAAOA,GAAa,GAAI,QAAQ,EAChC,KAAOA,GAAa,EAAG,MAAM,EAC7B,MAAQA,GAAa,EAAG,MAAM,EAC9B,MAAQA,GAAa,EAAG,KAAK,EAC7B,OAASA,GAAa,EAAG,KAAK,EAC9B,OAASA,GAAa,EAAG,MAAM,EAC/B,OAAUA,GAAa,GAAI,KAAK,CAClC,EAEA,SAASC,GAAe,CACtB9rB,OACAlC,WACAiuB,aACA/N,gBACA+M,uBAAuBA,IAAM,CAAC,EAC9BiB,qBAAqBA,IAAM,CAAC,EAC5BC,mBAAmB,GACnBC,qBAAqB,GACrBC,wBAAwBA,IAAM,CAAC,CACjC,EAAG,CACD,GAAI,CAACnsB,EAAM,OAAO,KAClB,KAAM,CAAEkW,IAAG9Y,KAAGC,KACR,CACJQ,MAAOuuB,EACPtuB,SAAUuuB,EACVrO,cAAesO,GACbhtB,KACEitB,EAAezuB,IAAauuB,EAE5B,CAACG,EAAqBC,CAAsB,EAAIjvB,EAAS,SAAS,EAClE,CAAC6qB,EAAcqE,CAAe,EAAIlvB,EAAS,IAAI,EAE/C,CAAEgB,KAAIylB,OAAMpN,MAAKqN,WAAUyI,SAAQC,eAAc7G,OAAMC,SAAQ6G,SACnE7sB,EACIknB,EAAY3qB,EAAOiC,CAAE,EAErB,CACJsuB,YACAC,kBACAC,YACAC,aACAC,WACAC,YACAC,SACAC,sBACAC,YACAC,iBACAC,YACAzH,KAAM0H,IACJpF,GAAgB,GAEd,CAACqF,EAAaC,EAAc,EAAInwB,EAAS,IAAI,EAC7C,CAACowB,GAAQC,EAAS,EAAIrwB,EAAS,EAAK,EAEpCswB,GAAmB7J,EAAKlR,SAAS,GAAG,EAAIkR,EAAO,GAAGA,CAAI,IAAInmB,CAAQ,GAElEiwB,GAAuBnG,GAAS,wBAAwB,EAE9DprB,EAAU,IAAM,CACd,GAAIwD,EAAM,CACR,MAAMgW,GAAiBpS,KACvB,IAAIoqB,IACH,SAAY,CACX,GAAIzB,GAAgBvO,EAClBgQ,GAAYxvB,UACH,CAAC+tB,GAAgBD,EAAsB,CAEhD,MAAM2B,GAAkBjuB,EAAKikB,KAAKlR,SAAS,GAAG,EAC9C,GAAI,CACF,MAAMmb,GAAU,MAAM9B,EAAa+B,GAAGC,OAAO/vB,KAAK,CAChDgwB,EAAGJ,GAAkBjuB,EAAKikB,KAAO,GAAGjkB,EAAKkkB,QAAQ,IAAIpmB,CAAQ,GAC7DwG,KAAM,WACNhG,MAAO,EACPgwB,QAAS,GACV,EACDzxB,GAAY,kBACZmxB,MAAqBpvB,SAAQ,MAC3BovB,GAAYE,GAAQptB,SAAYtC,IACE,MACpC,GAEA3B,cAAe,GACjBmZ,KAAAgY,GAAA,CACFH,GAAA,IAEA,MAEA,CAEEA,UAAcG,GACdvB,EAAA,WACF,MAAA1E,EAAAqE,EAAA,iCAEAlF,MAAUzqB,CAIVgwB,GAEA,IAEIjuB,MAAKwvB,GAAS,MAAAjG,EAIlB,GAFA0E,EAAA,WAEIzE,GAAA,QACF,SAAsBA,GAAMD,GAC5BlrB,MACA4vB,EAAuB,CAEnBzE,aAAcppB,GAChB,UAAAovB,EACAtB,EACA3B,CAAqB,MAAE1C,GAAc2F,SAAW,IAClD,CAEAnxB,MAAe,GACf4vB,OACFzsB,GAAA4tB,IACFW,GAAGvuB,CAAA,CAEP,EAAG,CAACA,EAAMge,KAEVxhB,SAAgBgwB,IAAA,UACVxsB,IAAgBwuB,EAAA,EAAAhxB,EAAA,IAClB+wB,IAAkBE,EAAA,EAAAjxB,EAAA,IACpB,CAAAkxB,GAAAC,EAAA,EAAAnxB,EAAA,IACEwC,IAAM4tB,EAAO,EAAApwB,EAAA,IAEjB,IAEA,aAAAoxB,GACA,aAAA9X,EACA,EAAA9W,EACA,QAAA4uB,IAAczE,gBAAuB,KAAAyE,EAAA,IAEjC9X,IAAA,sBAAAA,EAAA,IAAE8X,OACDA,IAAgB,CACnB,SAAI9X,SAAiB,CACnB8X,gBACF,UAAA3qB,EAAA,QACF,UAAAgpB,EAAA7oB,EAAA,cAGEF,MAAAC,SACEF,EAAAmC,EAAA,CAAK1B,GAAM,SAASP,CAClB,CAAAA,IACG8oB,EACC7oB,QAAA,CAAMM,MAAM,gBAAKP,SACfC,EAAAgC,EAAA,CAAA5H,GAAA,SAAyB,QAExB,EAACouB,GACJxoB,EAAA,CAAOM,SAAM,GAAeP,CAC1B,EAAA1F,WAAA,CAAAuJ,EAGKL,SAAailB,CACZiC,UAAU,CACX,EAAC,KAAAzqB,SAHJ,IAAAgpB,GAAAhpB,EAAA,cAAMM,aAAM,SAINN,EAAAgC,EAAA,CAAC,YACF,EACF,KAEPhC,EAAO,OAERgpB,CACO1oB,MAAM,aAAYP,SACtBC,EAAAgC,EAAA,CAAA5H,GAAA,SAAmB,EACf,EAGN,GAAMkG,MAAM,cAAYP,UACtB,YAAAspB,IAAArpB,EAAA,eAAqB,SAExB,yBACK,MACRH,GAGMK,GAAK,SACC,EACD/D,aAAEouB,GAAA,SAAc,OAAC,SAAAvqB,EAAA,iBACbG,EACPoqB,EAA4B,GAC9BrC,GAAAsB,IAAAxpB,EAAA,UACA4gB,KAAI,SAAM7gB,cAEV,QAAAA,IAAOspB,CAAkBzvB,EAAA,iBAG5BsuB,OAEGhoB,MAAKwS,GACLpS,eAAMkqB,WACGrqB,EAAM,cAAA0f,EAAA,GAAAA,CAAA,IAAAnmB,CAAA,GACbE,eAAO8wB,EAAkB,CACjBjY,EACCC,SACPiY,IAAgBH,MAChBI,SAAwD,IACxDC,EAEJ,CAAE9qB,GAEFC,QAAK,CAAM,CAAY7D,OAAE8W,GAAA,QAAA7Y,CAAA,OAAS,eAAE,eAAE,CAG1CyF,MAACoT,QAEW9c,IAASmL,CACnB,EACgB,MACdI,SAAO,2BAELC,OAAQ,WACV3B,EAAA,UACF,cACAmC,MAAM,SACN2oB,SAASC,GACTC,SAAShrB,EAAAS,EAAA,CACTyS,aACUhT,KAAK,IAASI,IAAMnE,EAA2B4D,CAC/CW,GAAK,SAAa,CAAOvE,KAAE,aAAAlF,IAAA,CAAMyxB,GAAAzxB,GAAA,OAAC,UAAG,IACrC,MAAAg0B,GAAA,MAAAjD,EAAA,oBAAAlF,EAAA,sBAEVoI,GAAej0B,EAAM,CACfyxB,MAAazxB,EAEf,GAAC,CAEG,EAGAwB,iBAAqC4rB,EAAKvkB,EAAA,CAC1CimB,YAAS1B,GAAK,aACJ,CACV5rB,IACF,aACC,WAAA6wB,GAAA,MAAAzJ,CAAA,IACL,CACF,GAGE9f,SACEF,GAACiD,YAEGlE,YAAY,UACVusB,EAAanpB,EAAA,IACXwM,SACF,QACD,SAAAsR,CAAA,EACD/f,WAEDU,CAAKC,EAAKV,EAAA,QACXA,MAAA,eAAAD,CACE,MAAA+f,KAC+Chd,GAAA,SAAAa,KAAAymB,GAArC,KAAY,SAAgC,CAAApqB,EAAAS,EAAA,MAAC,cAChDT,EAAA,QACF,SAAAA,EAAAgC,EAAA,CAETnC,GAACiD,QAAQ,EAELsnB,GAAyB,GAC3B5G,GAAA,mCAAA3jB,EAAAiD,GAAA,CAAE/C,YAEFC,CAAMU,GAAK,GAAW,EACtB,SAAAX,KACEiC,CAAA,gBAA2BhC,EAAA,QACtB,SAAA7D,EAAAktB,IAKHkB,WAA4B,EAI9BvqB,YACc7D,CAJd,CAIiB,MAAAusB,GAAmB,EAAAzE,GAAApkB,EAAAC,EAAA,UAAC3D,oBAAGksB,EAAA,sBAAkB,IAAC,MAAApN,GAAA,MAAA+M,EAAA,oBAAAlF,EAAA,iBACpD,QAAA8F,CAAA,CAGVF,EAEG7oB,IAACiD,EAAQmY,EAAA,IACQ,WACboN,gBAAuBlsB,EAEjB,CACF,GAAM8e,gBAGO2N,CACV,SAAA9I,CACH,CACAuI,CACAhsB,IAEM,CAAAjC,GAAA,SAAAC,OAAA,CAAAylB,WAAuC,CAAU,CAAC,CAAA3jB,iBAClDlF,EAAA,EAAAoxB,EAAA,aAAAvI,EAAyC,SAAU,CAAA9f,EAAAS,EAAA,MACzD,iBACFT,SAAY,CACVub,SAAOpf,EAADlF,EAER,CACC,aAIL+I,YACY7D,CAJZ,CAKM,MAAA0D,EAAuBiD,GAAA,SAAC3G,4BACxB,IAAA/B,CAAsB,MAAA6gB,GAAA,MAAA+M,EAAA,oBAAAlF,EAAA,iBAAC,SAAA6F,EAAA,CACtB,EAER7lB,MAAQmY,EAAA,IACQ,WACboN,qBAAgClsB,EAE1B,CACF,GAAM8e,gBAGQ0N,CACX,SAAA7I,CACH,CACAuI,CACAhsB,IAEM,CAAAjC,GAAA,SAAAC,OAAA,CAAAylB,WAAyB,CAAU,CAAC,CAAA3jB,iBACpClF,EAAA,EAAAoxB,EAAA,aAAAvI,EAAyB,SAAW,CAAA9f,EAAAS,EAAA,MAC1C,WACFT,SAAY,CACVub,SAAOpf,EAADlF,GAER,CACC,aAIL+I,YACiB7D,CAJjB,CAIoB,MAAgB,GAAAwtB,IAACxtB,wBAAG,yBAAe,CAAC,GAAAitB,GAAA,CACjD,MAAAtC,GAAA,MAAAkB,EAAA,oBAAAsB,GAAA,IAAAlvB,CAAA,UACEkuB,EAAAxB,EAAA,EAGd6C,EAAwBjB,cAENvsB,EAEZ,CACK,YACEitB,OAAU,CACNtC,UAINwB,CACAD,CACAhsB,EAASF,YACP2qB,GAAA,MAAAkB,EAAA,oBAAAsB,GAAA,IAAAlvB,CAAA,QAAAkuB,EAAAxB,EAAA,EAAAuB,EAAA,WAAAhsB,GAAAyjB,EAAqD,CACvD,YACF,OAAO,CACCgH,UAINwB,CACAD,CACAhsB,EAASF,OACP,CAAAksB,EAAA,SAAAe,GAAA/sB,GAAAyjB,EAA+C,CACjD,YACF,QACO7oB,UACPwB,CACA4vB,CACA,GACWlsB,KACP,CAAA9B,YAAA,OAAAylB,CAAiC,SAAAA,CAAA,CAAkB,CACrD,CACF,CACW3jB,KACP,YAAA6D,EAAA3F,EAAA,mBAAAylB,GAA+B3jB,EAA/B2jB,GAAiD,CACnD,GACF,UAGJ/f,CAEIW,GAAK,SAJP,CAKKvE,IACL0rB,GAAA8B,IAAA,CAAA7B,GAAAjoB,EAAAiD,GAAA,aAAAilB,EAAA,aAA0B,CAAA/nB,EAAAS,EAAA,CAAC,KAAAtE,0BAC3B,SAAA6D,EAAAgC,EAAA,CAAA5H,GAAA,SAAoB,EAAC,GACjB,EAEXytB,SAGa1nB,QAASA,IAAM4nB,CAA4BhoB,GAC9C,KAAmB,SACxB,CAAAC,EAAAS,EAAA,CAAAV,WACE,GAAA3F,GAAA,OAAAyF,EAAAC,EAAA,UAAoC,CAAAD,EAAA,SAC/B,kBAIZ6oB,UACC7oB,IAACiD,IACU3C,QACPkqB,cAAsBrqB,EAAI,QAC5B,2BAAED,SAEDU,GAAI,IAAAxG,OAAA,kBAACyG,EAAK,CAAQ,EAClB2jB,EAAM7pB,SACLuF,2BACSO,SAAM+jB,GAAA,QAAWtkB,CACtB,GAAAC,EAAA,iBACAA,EAAAgC,GACA,GAAM1B,QAAM,EACgC,GACrC,GAAAN,EAETA,GAAA,OAAA2pB,IAAa,CAAA7B,GAAAjoB,EAAAC,EAAA,aAAsBukB,GAAM7pB,SAAe,IAAAutB,EAAA,aAG1D,CAAA/nB,EAAAS,EAAA,CAAAV,kBACE,GAAA3F,EAAA4H,EAAA,IAAmC,SAC/B,CACP,EACO,EAEZhC,EAACiC,KAAa,CAAC,EACf,EAAApC,EAEF8pB,IAEE5pB,YACEF,CAAUM,SAAe4nB,aAAsB2B,EAAI,GAAE3pB,IAC7CW,UAAK,oBAAA0qB,EAAA,EAAe/uB,GAC1B2F,EAAqC,CAEvChC,GAACiC,QAAc,CAIZ,EAEL,MAAMmpB,CACN/uB,GAAIF,EAEFE,CAASF,YAAC,GAAe,EAAC,UACnBlF,EAAGwJ,EAAA,CACVhI,WACA4D,aAASF,mBAAC,WAAA6D,EAAA5F,KAAA,IAAAyF,EAAA,cAAuB,kCAAC,cAAAypB,GAAA,MAAAI,EAAA,EACpC,GACF,KAAE3pB,KAEDU,CAAI,KAACC,EAAW,OACjBb,SAAA,SAAAE,GACEC,EAAAgC,CAAA,oBACAhC,QAAA,CACA,MAAMM,oBAAM,SAAiCP,GACzCupB,EAAqC,GAClC,GACDzpB,EAAA,OACA,MACVA,kBAAUsT,SAAMV,OAAKpR,QAAO,KAAQtB,IAC5BW,UAAK,oBAAA+R,CAAA,EACXzS,GAAA7D,EAAgC4D,CAA8B,YAEhE,CAAW,CAAiBA,MAC1BF,IACWM,EAGLoW,CACAla,WAASF,GAAC,GAAa,SAAC,CAAA6D,EAAAS,EAAA,CAC1B,WACEhI,aACA4D,WAASF,gBAAC,iBAAqB,kCAAAsW,CAAC,IAClC5S,EAAAiD,GAAA,CACF,aAAE/C,IAEIW,UAAK,OACXV,KAAA,CAAAD,CACE,OAAkB,MAAA5D,EAGrBoa,CAEG9D,YAES,EAEL,CACE8D,EAAgB,SACd9D,WACD,mBACS,CACVha,SAAQ6Y,IAAO,CACfiK,WAAKpf,KAAC,MAAA0D,EAA+BiD,GAAA,SAAC,KAAAlJ,EACxC,iBACF,KAAA6Y,EAAE1S,SAEIW,eAAK8pB,GAAS,QACpB3K,EAAA,cAAAA,EAAA,GAAAA,CAAA,IAAAnmB,CAAA,GAAAqG,eACEiC,EAAA,GAAoB,SACf,CAAAhC,EAAAS,EAAA,CAEV,cACA,EACLZ,EAACiD,iBACU3C,EAAM6B,EAAA,CACbpI,WAAyB,EACjB6Y,GACCC,KACPiY,GAAgBH,cAChBI,MAAuB,IAAO/K,EAAOhgB,EAAOiD,GAAIpJ,CAAQ,QACxDmxB,KACFxC,EAAA,YACF,UAAEtoB,GAAA,CAES,MAAA+mB,GAAA,MAAAkB,EAAA,oBAAAsB,GAAA,IAAAlvB,CAAA,WACX4F,EAAA8mB,EAAA,EAAA/mB,EACE,WAAA1D,GAAAF,EACK,CAEN8nB,YAECjkB,OAACiC,CAGY9B,UACPkoB,CACA,CACE,GACEzuB,EAAMktB,sBAAkB,GAAMkB,OAG9BvvB,wBAAwBquB,SACxBwB,OACAD,EAAuB,QACvBhsB,CAASF,MAAC,SAAA/B,GAAAqG,EAAA,iBAAAT,EAAA,OAAA8f,UAAqB9f,EAAAgC,EAAA,IAAC,gBAAC,CACjCpI,UACAA,EACF,WAAY,CACVnB,IAAQ6Y,OAAO,CACf+W,oBAA8B,CAChC,EACC,CACL,EAAEtoB,EAEG,GAACW,EAAKwB,GAAA,CAAQ,cACnB,oCACE,4BAAA7H,OAAA,MAAAylB,SAC8CjgB,EAAAC,EAAA,UAAA6D,GAAAlD,EAAA,YAArC,GAAAT,EAAMM,OAAM,OAAgC,YAAC,SAAAN,EAAAgC,EAAA,CAC/C,YACF,QAGRE,UAAQ,EAEPmpB,WAAY,CACZpqB,EAAUjB,EAAA,QACD,qBACF,EAEL,CAAAD,CACO,GAACW,EAAK,QAAQ,MACnB,CAAMJ,aAAM,QACV,UAAAN,EAAAS,EAAA,CAAApG,WAAA,GAAAylB,KAC4C,sBAAAnc,CAAA,GAArC,GAAY,SAAgC3D,EAAA,aAAC,qBAC7CunB,GAAA,IAAA+D,IAAAtrB,EAAA8C,GAAA,CACH,QACN,KACEpB,EAAO,YACL6pB,UACF,IAAExrB,MAEFC,GAAK,MAAAgoB,EAAA,oBAAAsB,GAAA,IAAAlvB,CAAA,QAAM,SAAAkxB,EAAA,CACXtrB,EAAMU,EAAKomB,EAAA,EAAkBuB,EAAA,WACxBhsB,GAAAF,GAIA,YACRorB,QAEYpnB,EAAM,OAAAqnB,GAAA8D,EAAA,cAAA9D,GAAA8D,EAAA,IAAAxZ,EAAA0V,GAAA8D,EAAA,GACbjD,UACA,CACE,CACE,GAGUzuB,EACJ0xB,gCACF1xB,EAAC,+BACLnB,MAAQma,CACR0V,EAAgBxB,SAChBuB,KACSlsB,CACP,YAAA/B,OAAA,CAAAC,UAAA,CAIuC,CAACylB,EAJrB,CAKlB,IAEHlmB,EACAA,gBAAO4xB,GAAsBC,qCAE7BhzB,EACA4vB,WAAuB,CACvBhsB,WAASF,wCAAC0D,EAAAC,EAAA,WAAAE,EAAAS,EAAA,iBAAAT,EAAA,OAAA8f,UAA4B9f,EAAAgC,EAAA,aAAC,OAAC,CAC1C,SAAA8d,CAAA,EAEJ,YAAE/f,IAED,OAAOynB,CAIX,qBACE,EAIK,CACVlU,CAAO,CACPE,EAAkB,CAClBD,EACE,QAAAxT,IACEC,CAAKqoB,EAAM,YAAU,SACrB,CAAAtoB,IACE3F,MAAA0sB,GAAA,MAAAkB,EAAA,oBAAAsB,GAAA,IAAAlvB,CAAA,wBAAAC,EAAAysB,EAAA,EAAAuB,EAAAvI,WAC8CzjB,GAAAF,EAAAyH,CAA/BtD,YAAsC,QAAC,SAAAwf,CAAA,CAE/C,CACF,CACP,IAEK3f,sBAAM,eACbkoB,wBAAgC,SAC/B,MAAY,CACXA,EAAI,QACF,CAGA5vB,IAIA6vB,EACAD,eACAhsB,aAASF,sBAAC6D,EAAAgC,EAAA,iBAAA8d,QAAa,SAAwB,WAAC,CAAAgJ,EAChDlvB,kBACAA,UAAO4xB,KACT,YACE/yB,aACA4vB,cACF,YACC,QACL,SAAAvI,CAAA,EAEMpf,WAAK,CACXV,IAAA,QAAAD,MACEiC,cAAA,GAA8B,CACzB,EAGXhC,EAAY,CACVsT,EACAoY,UAAU5C,CACVvV,kBACE,EACO,kBAAM,iBACXvT,IAAA,CAAAqoB,EACErmB,SAAA,gBAAA3H,CAAA,GAAAylB,GAC6C,MAAAgH,GAAA,MAAAkB,EAAA,oBAAAsB,GAAA,IAAAlvB,CAAA,YAAAuJ,EAAAmjB,EAAA,EAAAljB,EAArC,WAAAvH,GAAYF,EAAiC,CAC9C,YACF,QACP,SAAA2jB,CAAA,CAEO,CACE,CACb,CACAtM,YACSrT,GAAM,MAAA6nB,EAAA,oBAAAsB,GAAA,IAAAlvB,CAAA,UAIbiuB,IAAgC,EAC/BA,EAAY,WACPhsB,GAAAF,EAEA,CAGA1D,GAAQma,SACR0V,QACAD,UACAhsB,CAASF,GAAC,CAAAvC,EAAAS,sBAAA,WAAAT,EAAA,sBAAAkmB,eAAuB,CAAAuI,EAAC,SAACS,EACrCzsB,GAAOF,EAIL1D,CACA6vB,YACAD,QACAhsB,UAASF,EAAC,GAAAE,GAAAyjB,EAAsB,CAAC,YACnC,kBAEAlmB,CAA6B6xB,CAE7BhzB,EAEA,CACE4D,IAASF,WAAC2sB,EAAAjpB,EAAAC,EAAA,UAAA1F,GAAAqG,EAAA,kBAAAT,EAAA,OAAA8f,UAA+B9f,EAAAgC,EAAA,IAAC,gBAAC,CAC7C,SAAA8d,CACEzjB,EAASF,cAAC6D,EAAA,+BAAA8f,EAA6B,GAAC,GAAAjgB,EAACC,EAAA,UAC3C,CAAAE,EAAAS,EAAA,CACF,aACF,EAAGT,EAAA,QACL,SAAAA,EAAAgC,EAAA,CAAEjC,GAED+oB,SACC/oB,OACEC,CAAMU,UAAK,EACXX,YACE3F,EAAA4F,EAAA,QAAA3F,MAAA,eAAAylB,EAC+C,KAArC,EAAY,GAAAjgB,EAAciD,GAAkB,WAAC,iBAChD,KAAClJ,EACH,iBACP,QAEFkG,GAAAlE,CAAA,CACO,EAAM,SACXoE,GAAAS,EAAA,MAAAV,MACE,GAAAC,EAAA5F,OAAA,UAAAC,EAAA2H,EAAA,IAAA8d,gBAC6C,CAAAnc,UAAA,EAArC,WAAMrD,CAAM,EAAgCN,EAAA,QAAC,qBAC9C,EACF,CACP,EAEO,CACbH,CAAS,EACP0C,CAAU,GACVpC,GAAeqpB,IAAA7B,GAAAnE,GAAA,2BAAA3jB,EAAAC,EAAA,CACblG,UAAO+xB,KAAkB,IAAA9rB,EAAAiD,GAAA,aACdwmB,CACX1B,EAAA,GACF,EAAE7nB,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,SAAQ,EACnBV,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,aAAA0lB,GAC8C,KAAAnc,CAAA,IAAAsgB,GAArCmE,IAAA,WAAApoB,EAAA8jB,GAAA,UAAY,KAAAG,GAAgC,CAAAwE,GAAAzoB,EAAAqT,GAAA,SAACqV,GAAAQ,EAAA,aAC/ClpB,EAAA,iBACF7D,EAAA+sB,EAIZhB,CAIGnoB,WAEW,EAGLA,CAEIW,YAAe,OACrB,CAAAX,IACEC,MAAAgC,EAAA,UALA4lB,CAMK,GACE,kBAuBhB,SACI,YAEG5F,SAAM+I,kBAIU7B,YACtB3V,cAEcpX,OACNusB,GAAAQ,EAAA9uB,GAAA,MAAA4tB,EAAA,oBAAAlF,EAAA,oBAA2B3mB,mDAC3B2qB,KAAA1sB,EAAA0sB,EAAA,EAAAzsB,GAAAsvB,IAAA,CAAA7B,GAAAhB,GAAA,WAAAljB,EAAgCkc,8BAAWuI,EAAA,UAC3C,OAAApxB,GAAA,CAERuc,UACArR,EAAM,QACNE,KAEEgmB,EACA,SAACroB,EAAY,UACX,KAAI,SACF,SAAI8mB,uBAEJ,qBAA4BoC,EAAA,YAQ1BpC,YAEY,SAEd4B,EAAO7oB,EAAAC,EAAA,CACLgnB,mBAAkB,CAGpB,SAAA9mB,EAAAgC,EAAA,CAEA,GAAI8kB,QACFwB,EAGA,GAAAtoB,EACE6nB,QAKAE,cACF,YACF,CACAM,GAAgC,KACtBxoB,EAAAC,EAAA,CACVyb,SAAO,CAAAvb,EAAA,QACPqoB,aAAuB,CACzB,YACC,EACL,EAAAroB,EAAA,QAAED,SAEFC,EAAAgC,EAAA,CACO,YACL1B,CAAoD,CACpD,EAAqD,CACrD+B,IAAU0oB,KAAQhrB,SAEjB2oB,KACC7oB,CAAAE,WACE,GAAAA,aACEiC,CAAA,SAAAhC,EAAAgC,EAAA,CAAuB,YACnB,CACN,EAAAjC,CACE,GAAA5D,EAAwB,CAE1B,GACA+sB,QACF,CACE,CACE,KAAuB,GAEzB,KAAA0C,IACE5pB,KAAA,aAAA5H,CAAAgwB,GAAuB,KAClB,SACPpqB,EACAuoB,GACFzoB,CAAA,KAAA6hB,EACO,OAAAC,EAAM,QAAQ,IACnB5hB,GAAA,KACE,KAAA6rB,IAAA7rB,EAAAkE,GAAA,aAAoB,CAAAmmB,GACf,KACNluB,yBAEH2mB,EAAA,gBAAA1oB,IAAAiwB,GAAA,KAAQ,KAAAC,IAACtqB,EAAAkE,GAAA,SAEL,KAACqmB,GAEZ,KAEA,SACFqB,KACA1nB,SACUlD,EACPopB,QACF,qBAAA0B,IAAA,CAAE/rB,EAEDinB,GACCrF,EACAC,oBACyC,EAAE,CAC5C,EAIG,CAEFyI,eAA2B,GAC7B,CAAA5X,EAAA,aAAE1S,MAED+lB,SAAmB,IAAAiG,SACG1zB,KACrB2I,CAA0C,KAAAgrB,EAC1C,SAAAvc,CAIE,EACJzO,EACEupB,YAAwB,MAAK,6BAC/B1qB,EAAAC,EAAA,UAAEC,GAED0mB,QAAgB,MACftU,qBAASvW,SACHytB,wBACN1C,cAAuB1C,QACrBqE,UAA4B,GAE9B,EAC4C,CC36BxD,MAAM2D,GAAQ,GAERC,GAAuB,IAAO,GAAK,GAEzC,SAASC,GAAuBvC,EAAWnwB,EAAO,CAChD,OAAOA,EAAMM,GAAG2C,SAAS0vB,kBAAkBxxB,MAAM,CAC/CR,GAAI,CAACwvB,CAAS,EACf,CACH,CACA,MAAMyC,GAA4B9vB,GAAK4vB,GAAwB,CAC7DpvB,OAAQmvB,EACV,CAAC,EAED,eAAeI,GAAkBxJ,EAAWrpB,EAAO,CACjD,MAAM8yB,EAAgB9yB,EAAMM,GAAG2C,SAC5BC,QAAQmmB,CAAS,EACjBlmB,SAAS3C,KAAK,CACbC,MAAO,GACR,EACAG,SACAE,OAEG,CAAED,MAAOsC,GAAa,MAAM2vB,EAClC9zB,GACA,MAAM+zB,EAAQ,OACZC,UAAO7vB,EACP8vB,UACAC,SACAC,OAAQ,GAEV,OAAAhwB,EAAA,QAAA4R,GAAA,CAOA5R,EAASwK,OACPolB,WACQI,mDACRJ,EAAA,UAIQG,+CACRH,EAAA,SAKAA,EAAO,WACCE,GAET9vB,EAAA,SAGD4vB,oBAAqB,iCAAA5vB,IAAA,8BAKrB4vB,CAEA/zB,CACA,MAAAo0B,GAAOL,OACT,OAAAN,EACA,GACEnvB,GAAQmvB,IACT,IAED,WAAMY,OACA,EACF,MAAQC,CACR,MAAO,EACT,CACE,EACFC,GAAA,KACFpzB,EAAA,oBACO,iBACLA,eAEEqzB,cAAgB,QAAgB,OAAA9F,CAAA,OACtB,CAAEA,IAAS+F,GAAO,EAC1B,SAAU,SAAA/F,CAAA,GAER9X,CAAwB,CAC1B,EACF,SACF8d,GAAA,CACF,QAAAhb,EAEA,aAAAib,EAASD,IAAY,CACnBhb,EACAib,aAAsB,SAAA1zB,EACtBiuB,gBACAjuB,uBACAkgB,CACAiO,MACF,KAAG1T,EACD,EAAAhY,CAAM,EAAEgY,KAAMnb,SACd,cAAMkvB,CAAA,EAAEzuB,IAAOmgB,UAAesO,GAC5BxuB,CACD,MAAAsuB,EACD,SAAMC,CAAA,EAAExuB,KAAqBC,GAAUuuB,gBAAoB/sB,EAAI,OAAAiX,GAAA,SACzD,CAAC6O,GAAS1D,MAAuB,KAASnL,CAAA,EAC1Ckb,EAAkBlb,GAAY,IAAAzY,IAAAuuB,EAAA,CAAAvuB,EAAAuuB,CAAA,GACpC7vB,EAAOwD,IAAM0xB,CAEb,GAAMC,IAKNn1B,EAAU+Z,CAAM,EACd,MACEmb,CACAhQ,EAAA,YACF,UACAA,IACC,MAAAkQ,EAAY,MAAAJ,EAAA,EACXxzB,EAAI,YAAA4zB,EAAA,MAAA9zB,CAAA,IAAA8zB,EACFF,EAAM1xB,GACNhC,WAAmBgC,CACnB0xB,MAAQ1xB,CACR0hB,MAAW,IACD,QACV7kB,CACA60B,IACAhQ,OAAW8P,CAAO,QACpB,CACF,KAAAvN,EACF,OAAA4B,EAEA,aAAA/O,EACEmN,MACA4B,YACA/O,cACA+a,SACA9qB,SACA6e,iBACAkM,iBACA9L,QAGA+L,8BAGAvzB,OACAouB,gBACAD,MACA5G,WACAiM,WACAnb,QACAqN,QACA+N,oBACApF,UACAqF,MACAC,CACF,OAAArM,EACA,aAAA8I,EACA,EAAI5uB,GAAA,IAAE8lB,8BAAQ8I,8BAAiB5uB,EAAS6lB,EACpCuM,GAAW,GACTvM,GAAW,sBAA2B/O,CAAG,IAC3CgP,GAASD,IAGQ/O,MACjB8W,GAAAlV,GAAA,IAAAla,IAAAoF,GAAA,GAAApF,CAAA,GAAAhC,EACF,KACF,MAAA61B,EAAA,GAAAryB,GAAA,IAAAA,GAAA,UAAAA,GAAA,MAAAA,GAAA,QAAAA,GAAA,cAAAA,GAAA,aAAAA,GAAA,KAEA,GAAM4tB,OAAiByE,GAEvB71B,MAAUsE,GAAMiV,GAAA,EACd,IAAMsc,MASNvxB,GAAI8sB,YAAsByE,CAClBvxB,QAAWiV,OAAY,IAAAuc,GAAA,cAAAx0B,IACzBy0B,QAAUvyB,EACdc,GAAS0K,GAEL+K,GACAgc,IACFtb,GAAAnW,EAAA,CAEF,CACEjE,QAAYiB,IACZmZ,SAAanW,GAAQ+V,CAAA,EACvB,CAAA2b,GAAAC,EAAA,EAAAj1B,EAAA,IACFk1B,GAAAn2B,EAAA,EACEqxB,GAAuBrxB,EAAA,IAE3B,eAAMo2B,KAA+B,EAE/BC,GAACJ,IAAoBC,WAE3BC,WAA0Bn2B,EAAO,oBAAAiC,CAAA,kBAC3Bq0B,QACN,aAEIH,eAAkBj2B,GAAmBqE,QAClCC,OAEQsvB,GAAP/xB,KAEDG,EAAO,OAAAyvB,GACZ,MACA,MAAAxvB,EACA,EAAIkvB,GACJ,IAAIkF,MAEJ,GAAAF,EAAM,CAAEl0B,UAAM,GAAIwvB,CACd4E,GAAW,MAAAj1B,EAAA,qCAGX+0B,MACF,EACA,MAAI,CACFpC,CAAoEqC,GAC3D,QAAAE,KAAA,iBAAAD,GACR,IAAAD,GAAA,WAAAn0B,GAAA,OAAA4zB,IAAA,CAAAO,GAAA,aAAAG,OAAA,KAAAV,GAAA,WACMj3B,IAAG,SAACy3B,GAAAp0B,GAAA,OAAA4zB,IAAA,CAAAO,GAAA,aAAAG,OAAA,KAAAV,GAAA,MAEbQ,OASF,GAAA5E,GACE4E,QAKA,CAGF,CAAO,MACLG,GAAG/E,mBACI4E,MACT,OAAAF,GAAA,CAAAK,GAAA,WACFA,GAAA,QAAAp1B,EAAA,oBAAAW,CAAA,kBAEMy0B,QACN,aAEIA,MAAkBx2B,GAAmBqE,QAClCC,MAEQsvB,CAED,MACZ6C,GAAAnH,EAAA,MAAA7T,GACAib,GAAgBr1B,EAAMm1B,KAAkBx2B,OAAQkC,GAAK,MAAAH,CAAA,GACrD,CAAAgyB,GAAOtC,UACT,CAAAkF,GAAAC,EAAA,EAAA71B,EAAA,EAEM01B,MAAiChb,eACjCib,QAA6Br1B,MAE7Bw1B,GAAoBC,SAAwB/1B,CAClD,GAAM,CACN,MAAOg2B,SAAqBC,GAA0Bj2B,EAAS4uB,CAAS,EACxEmH,GAAyBG,GAACN,YAAcvC,YAExC,MAAMyC,EACJ,EACEK,GAAkB,SAAMlD,CAIxB5zB,KACA02B,IACEG,WAEJ,IACE72B,QAAcxB,MAAC41B,GAAAzyB,EAAAX,CAAA,EACjBw1B,GAAAzC,CAAA,EACF6C,GAAA,UAEA,OACEA,GAAS,QACTA,EACA,EACE1I,GAAoBkG,KACpBoC,eACAI,YAAgC,KAEhC52B,EAAe,YACf42B,GAAuBzF,EAAO,EAChC,CAAAjC,GAAAiG,EAAA,GACF2B,GAAA,EAGKtL,EAAc2F,SAAgB4F,EAAAjwB,GAAA6iB,GAAA,CAC3BA,OAAcsG,IAChBwG,KACAt1B,EAAK+tB,YAAciG,QAAgBl0B,CAAG,IAAA0oB,EAEjB,GACrBhoB,EAAAV,CAAA,GACF+1B,GAAApC,GAAAlb,GAAA,oBAAAA,CAAA,EAEDwV,IACH,EAAAvuB,EAAA,IAEMo2B,GAAkBjwB,EACrB6iB,EAAehpB,EAAA,IACd,OAAIgpB,IAAkBhoB,CACpB3B,SAAQma,UACR0a,SAAQlL,KACRxoB,MAAO8C,qBAAY0lB,IAAiB1oB,UAAc0oB,gBACpD,OAEDhoB,mBACHg0B,GAAA,GAEMqB,mBAAcpC,GAAuB,GAErC,mBAAkBzF,GAAkB,CAAIxuB,EAExC,mBAAC0uB,GAAoBC,EAE3B,EACEhoB,SACEF,KAAA,SAAAA,EAAA,OACEqS,iBACA5R,SAAO,CAAAN,EAAA,KACP0B,SAAO1B,EAAAgC,EAAA,CACL,WAAwC,CACxC,CAAwC,CACxC,EAAAqrB,EAAArtB,EAAoBouB,KACpB,SAAAqB,UACF,KAAAtd,EAAEpS,OAEDihB,SACM1gB,IAAM,WAAUP,SACnBC,CAAA,CAAAD,IACEC,OAAAgC,CAAA5H,MAAA,gBAAqC,SAAA+X,CAAA,CACpC,CAED,GAAApS,MACG0vB,CACC,SAAStd,OAAS9Q,OAAgB4Z,OAAI,SAAUlb,eAE7C,SAEH,CAAAC,EAAAgC,EAAA,CAAM1B,WAAM,CAAeP,QAAEoS,GAAc,gBAI/CnS,EAAA,CAAAD,CACE,GAAS0S,OAAY,UAAA5S,EAAAC,EAAA,UAAa,CAAAE,EAAA,mBAAUD,EAC1CC,GAAA,4BAAkCA,EAAK,EAAM,GAAUH,EAAG,iBACzD,CAAAA,EAAA,OAEN,aAGJmhB,SAAY,CAAAhhB,EAAA,KACXD,SACE,oBAAAA,QACGgkB,CAAaC,SAAW,yCAAO0L,EAAQ,CAAE,EAAA7vB,EAAA,OAE5CA,MAAA,uBAAAE,SACEF,GAAA,OAAKS,MAAM,mBAAMP,SACfC,GAAA,OAAAD,sBACAC,SAAA,CAAAA,EAAA,KAAAD,MAAG,qBAA0C,eAE/CF,EAAAG,EAAA,KAAKM,SAAM,SAAsBP,EAC/B,CAAKO,IAAM,OAAkBP,sBACtBO,SAAM,CAAAN,EAAA,KAAeD,2BACrBO,SAAM,SAAoBP,MAAC,CAAM,SACpC,eAAAA,CAAG,EAAM,CAAI,GACVF,EACLA,MAAA,OAAKS,QAAM,SAAeP,GACxBC,MAAA,UAAS,CAAAA,EAAA,QAAoBD,SAAC,KAAO,EACrCC,SAAA,IAAAD,QAAG,CAAW,SAAI,CAAAC,EAAA,QACd,cAERH,WAAA,EAAKS,IAAM,OAAOP,SAChBF,GAAA,QAAAE,SACEC,IAAA,GAAAD,QAAM,GAAE,CACV,GACA,GAAAF,EAAAE,MACEC,CAAA,MAAAD,UAAM,SAAS,CAAAC,EAAA,OACjB,IAAAA,EAAA,cACAH,UAAA,SAAAE,EACEC,SAAA,MAAAD,SAAQ,MAAO,SACX,YACF,SAAAC,EAAAS,EAAA,CAERZ,KAAA,QAAKS,KAAM,IAASP,CAElB,CAAMO,CAAM,EAASP,CACnB,GAAa,GAAe,GAAAnE,GAASyG,IAAQ,UAAAtC,QAC1CU,MAAI,uBAAM,SAAQE,GAAK,cAAKX,EAAAgC,EAAA,CAAC,GACxB,SACH,QACH,YAAAwf,CAAA,EAIV5lB,WACEkE,GACGE,EAAEyoB,OACD,CAAW,CAAe1oB,CACxB,GAAAA,KACEiC,CAAA,QAAAymB,EAAA,SAAA/uB,EAAA,QAAA8nB,IACiBvqB,EAAA,kBAAA0M,cAAA8kB,CAAA,CAAI,GAAC,IAEf,CAAA/G,GAAA,sBAAAA,CAAA,GAAA1hB,EAAA,OAAC,IAEVA,EAAa,IACXmS,GAASsW,MACT/uB,oDACAyG,GAAUlJ,CACN04B,qBACF/1B,SAAOijB,MAAc4L,GACvBxxB,EAAA,WAAAuzB,IAIH9I,SAAW,gBAAgB1d,aAAW,EAEhC0d,gBAEEzqB,EAAA,aACL+2B,GAEF4B,SAAU34B,IAAMuzB,GAEZvzB,EAAA,OAAMoK,OAAOob,CACI+N,EAEfvzB,YAAEoK,YACFpK,UAASwlB,CAAMiF,EACjB,+BACF,IACEzqB,SAAeuzB,iFACVqF,GAAAC,GAAA,iBACHzuB,mBAAc,GAClB,EACFyuB,GAAA,MAAA74B,EAAA,aACA84B,UAAY94B,EAAA,cACZ+4B,GAAS/4B,sBAAM,GACXoK,aAAOiZ,SAAc,KACvB,MAAI2V,GAAA,GAmDAC,GAjDah6B,iBAAOi6B,OACdA,EACJh6B,OAASi6B,gBAAcn5B,EAAA,OAAQ,MAAAg5B,GAAA,EAAAA,KAAA,OAAAJ,GAAA,eAAA54B,EAAA,cAAAg5B,QAAA,OAAAJ,GAAA,aAAA54B,EAAA,aAAAg5B,GAAAh5B,EAAA,cAAAg5B,QAAA,YAAA9iB,IAAA,CACnC,IAAM0iB,KACJQ,KACDhb,GAAA,EACDya,GAAOplB,EACPolB,QAAOnlB,KAAWtJ,MAAOsJ,aACrB2lB,WACAC,OAAUt5B,GAAEoK,GAahBgU,IAAM4a,SACNlkB,IAAMykB,MACJX,GAsBA,MAAIY,GAAItjB,GAAA,SACR,MAAIkI,CAAI1Z,GAAA+0B,GAAAD,GAAAC,GAAArb,GAAAqb,GAAA3kB,GAAA2kB,EAAA,CACR,GACoBvjB,IAAK3S,IAAa,CACpCmB,MAAKwR,MAAMkI,GAAAtJ,EAAA,EAAA4kB,GAAAC,EAAA,EACXH,MAAKtjB,UAAS,KAACsjB,EAAA,KAAApb,EAAA,KAAAtJ,EAAA,GACfsJ,GACAtJ,GAAemkB,EAAA,OACjB,CACA,CACA,CAIgB,GAAAlwB,EAEjB,UACD,SAAMkwB,EAAYM,EAAOhuB,GAAKouB,CAC5B,aAAUH,WAAWE,yBAAgB,iBACrC,mBAAgB,CAClB,SAAC3wB,EAAA+jB,GAAA,CACDsK,UACA51B,WAAc+3B,kBAAQN,aAAW,GACvB,CACV,EAEJ,UAAAlwB,EAAA,OAGJA,MAAA,mBAAAD,SACG4nB,KACO,QAMJzU,UACE,CAAAnT,CACe,GACXoS,KAASvW,SACTlC,KACAsqB,QAAWnE,EAAA,kBAAAA,CAAA,OAAAA,CAAA,IAAAnmB,CAAA,GACXyG,IAAgB,8BAAA0wB,CAAA,EACjBx0B,GAAAF,EAEJ4D,CAEU,YACS,CAAC8f,CAAYnmB,OAAqB2C,GAAAF,GAI5C00B,WAGN,CACEta,EACAla,CAASF,WAAC,CAAA6D,EAAAS,EAAA,MAAArG,MAAA,GAAA4F,EAAe,iBAACA,EAAAgC,EAAA,YAE1BvJ,EACA4D,GAASF,iBAAC,KAAAvC,EAAAQ,gBAAA,MAAuBqY,EAAC,MAAAC,EACpC,eAAA8X,GACF,QAAA3K,EAAA,cAAAA,EAAA,GAAAA,CAAA,IAAAnmB,CAAA,GAAEqG,eAEDU,EAAI,CAAY,EACjB,SAAAV,KACEiC,CAAA,gBAAyBhC,EAAA,QACpB,SAAAA,EAAAgC,EAAA,CAETnC,GAACiD,QAAQ,EAELlJ,GAAyB,GAAAiG,EACvBsnB,GAAM1U,MACNqe,EAAOpe,OACPiY,SAAgBH,SAChBI,KAAcjc,CAES,KACvBkc,UAAgBmC,GAClBhtB,EAAA,QACF,SAAAA,EAAAgC,EAAA,CAAEjC,WAEG,CAACW,CAAK,CAAU,EACrB,GAAAX,KACEiC,IAAAnC,EAAAiD,GAAA,cAAAlJ,EAAqB,gBAChB,mBAETiG,KAACiD,QAAe2P,MAAKpR,CAAO,CACrB,EAAgB,SACrB,CAAArB,EAAAS,EAAA,CAAAV,WACE,GAAA3F,EAAA,iBAAyC4F,EAAAgC,EAAA,CACpC,YAEThC,CACS,GAELpG,SAAOm3B,KAAiBlxB,EAAAiD,GAAA,cAEpBlJ,EACEsG,eAAM,kBACDwS,EACN,aAEL,IAAA8X,EAAA,CACF,EAEK,EAAY,SACjB,CAAAxqB,EAAAS,EAAA,CAAAV,YACE,GAAA3F,EAAA,iBAAgC4F,EAAAgC,EAAA,CAC3B,YAEP,CACS,GAELpI,MAAwB4vB,IAAAhG,GAAA,2BAAA3jB,EAAAC,EAAA,gBAEpB,IAAAD,EAAAiD,GAAA,SACE5C,IAAM,CAAA0nB,EACD4C,KAGX,UAAAxqB,EAAAS,EAAA,CACF,cAAEV,IAEFC,OAACS,CAAKC,SAAKV,EAAAgC,EAAA,CACXhC,GAAA,SAAAD,CACE,EAAA3F,CAAA,GAAiC,EAAC,CAC7B,KAGV8tB,IAGG,QAAAnoB,EAEW,SAAArG,EAELkuB,kBAAuB,SACzB,IAEK,GAAA5nB,EAAA,MAAM,OAAU,iBACrB,cAAAD,MACE,GAAAF,EAAA,iBAA0B,GAAAguB,GAAA7tB,EAAA,cACrB,eACEA,EAAAgC,EAAA,CAEd,YACE,CAEM,GACXmQ,KAASvW,UACTlC,YACAsqB,YAAWvjB,EAAA,CACXuwB,UAAQ,CACT,MAAAhxB,EAAAgC,EAAA,CAGLhC,GAAA,SAAKM,EAAM,CAAiB,IAAAqtB,GAAY9tB,EAAA,QACxCA,MAAA,eACI,CAACguB,KACKvtB,KAAM,QAAKP,UACfiC,CAAA5H,GAAA,SAAyB,GACrB,EAEP4F,EAAEytB,OACKntB,MAAM,OAAKP,WACV,QAAMkxB,GAAA,CAAO,SAAEjxB,CAAA,2BAAwB,CAG/C,OAAE2tB,GACDhM,EAAA,CAAMrhB,QAAM,CAAKP,CACV,CAAM,GAASF,EAAC,MAACmC,CAAA,sCAAoB,CAAA4f,GAAA,UAAA5hB,EAAA,OAgB9CA,MAAA,mBACEM,SAAMshB,EAAA,MACNhB,gBAEElnB,aAAUuuB,EACXpgB,KAAAhI,EAAA,OACDqxB,uBAAyBC,GAAA,wBACvBC,WAA+B1D,iBAAQ,UAAA1tB,EAAAqxB,GAAA,CACzC,KAAAlc,EAEF,OAAAuY,CAAA,CAAW,QAAAyD,IAAAnxB,EAAAS,EAAA,MACRmhB,eACMthB,KAAM,IAAkBP,IAC1B6hB,EAAoBtnB,CAAO62B,YAC1B,CAEwC,CAGtCvQ,EAAI,CAAM7gB,QAEVF,CAAAE,wBACGsxB,CAAUlK,OAAMhS,OAAMuY,SAAiB,CAEjC,CACE,GACA,EAAAvY,EACLvU,EAAGzE,4BAAE,SAAA/B,GAAA00B,GAAA,UAAU,KAACC,GAAA,QAEnB,KACA,WACH,KACEmC,sBAAyB,CACvBE,eAAgC1D,UAClC,CACA,YAEL,EAGM,cAAA4D,GAAOvxB,WAEdmS,yBAAUsX,GAAA,kBACNuF,eAGFx1B,CACEK,GAAO23B,QAAsB,CACvB,EACJC,MAAOr1B,KAAE,WAAW,GAAAiwB,GAAA,QAAApsB,EAAA,cAAC,uCACrByxB,SAAeH,OACf53B,sDACAg4B,GAA0BlI,OACrBxpB,KACD,CACJ2xB,MAAW5D,aAAe5xB,aACtB,GAAAy1B,EAAA,gBAAAA,EAAA,gBAAAA,GAAA,MAA8D,EAC9DnzB,GACNuB,EAAAgC,EAAA,CACF,GAAI,SACN,aAEGoqB,CAAkB5xB,EACb8F,KAAMuxB,CAAA,EAA6B9xB,gBACvC,EAAY,WACTqsB,CACQ,IACAwF,OAASlf,CACd/R,MAAKkxB,CAAA,GACyC,WACpCD,CAEb,MAAAC,CAAA,CACG,EAGV,EAAAz3B,CAAA,GAAAC,KAAA,OAKSy3B,gBAA4B,WAQA,GAACD,WAZf,KAAAluB,eAAA,CAAAC,sBAGjB,CAAMP,QAAOwuB,GAQPxuB,GAAOwuB,kBAEP,EAIV,cAAAE,GAEJlyB,WACES,yBAAMkpB,GAAA,iBACNtX,UAAU6b,GAAA5xB,GAIR5C,GAAW,QACTK,CAA6B,EAC3B43B,MAAOr1B,KAAI,EACL,SAEN,CAAA6D,EAAAgC,EAAA,IAAC,gBACDyvB,CAAeM,EACfr4B,sBAGI,EACsByC,gBACtB,cAAA/B,CAAA,EAA8D,CAC9DqE,GACNuB,EAAA,YACFA,EAAI8uB,GAAA,CACN,sBAAE/uB,MAEF,SAAAC,EAAAgC,EAAA,CAAA3H,YAAA,QAKsC23B,QAJf,EAAAF,GAAAlE,CAAA,EAAAjqB,eAAA,EAGjB,WAAaquB,CAAe,EAEtBhyB,EAAA,QAAC,MAAA4tB,CAAA,CAKb5tB,EAEFA,EAAC8uB,SAAS,CACRxuB,MAAMstB,CAAA,CACFmB,EASJ,KAAA10B,KAAA2F,EAAA,aAKS8xB,gBAA2B,aAQblE,CAAa,GAACA,SAZf,QAAAjqB,KAAAhB,EAAA,CAAAiB,SAGhB,IAAagqB,EAEP,WAMN,GAAMvqB,SAAOuqB,CAEP,SAAAjrB,CAAA,CAAC,EAIZ,CACQ,CAET,EAAKrC,CAAM,GACT,KAAA0uB,IAAAhvB,EAAA8uB,GAAA,IAAAC,GAAA,6BAG6B,QAExB,OAAC,SAAAprB,QAAA,OAAAC,mBAHJ,SAAMX,QAAUN,OAIV,kCAACsvB,EAAApyB,EAAA,OACF,sBAEV,MAAAyb,GAAA,EAAAnf,EAGF6yB,CAEKD,YACE,cAMM,UAAAC,GAAA,sBAAA7a,EAAA,gBAEJ8a,MAAgB,SAAI,CAEtBxwB,KAGNuwB,GAAA,QAAAA,GAAA,sBAAA7a,EAAA,gBAAW,kBACE,GAAA6a,GAAA,OAAAA,GAAA,sBAAA7a,EAAA,gBACR8d,eACC,CACQ,EACN5uB,aACuBlH,2DACjB,KAAAA,EAGS,CACR,GAAC0H,SAEyC,OACzCnC,CACF,GAACstB,GAAA,UAAAA,GAAA,sBAAA7a,EAAA,gBAAC7P,eAEyC,GAE3C,GAAC0qB,GAAA,QAAAA,GAAA,sBAAA7a,EAAA,gBAAC+d,eAEyC,GAE3C,GAAClD,GAAA,OAAAA,GAAA,sBAAA7a,EAAA,gBAAC,gBAAQ,EAAChY,GACX,UAAA6D,EAAA,gBAAAgvB,GAAA,sBAAAmD,GAAA,EAE2C,CAE3C,GAAC,SAACtuB,QAGAnC,KAAO,MACR,EAAAstB,GAAA,kBAAC1qB,KACasoB,kBAEblrB,KAAO,kBACR,EAAAstB,GAAA,MAAC,EAAAA,GAAA,MAAQ,EAAAA,GAAA,kBAAC,CAGjB,EAAAjvB,GACGivB,EACG,CAAA50B,GAAA,SAAAC,OAAA,CAAAuJ,EAAOorB,GAAavC,MAAK5oB,EAErBmrB,GAAaoD,MAGoCA,CAIpCA,CAEe3F,WACXuC,CAAavC,0BAAwC2F,SAAiB,CAAApD,GAAA,aAAAhvB,EAAA,OAG1F,oEAACmyB,CAAArgB,+CACF,GAAA1X,GAAA,WAAA4F,EAAA,aAAA3F,sDAAA,MAAO20B,CAAavC,eAEHuC,GAAavC,2BAAK,GAClCuC,GAAA,UAAAhvB,EAAA,OAAC,2DAERH,MAAA,CAAKS,eAAM,GAAA0uB,GAAA,OAAAA,GAAA,aAEP,GACE1uB,GAAM,UAAAN,EAAA,OACN0B,MAAO,4DAMP,kBAAAstB,GAAA,OAAAA,GAAA,aAIF,EACE1uB,CAAM,GACNoB,QAAO,+BAIA,SAEP,CAAA7B,EAAA,QACD,MAEFmvB,KAEG1uB,SAAM,CAAAN,EAAA,QACN0B,MAAO,kEAEFstB,CAIL,YACD,CAEFA,CACC,GACE1uB,IAAMT,EAAA,QACN6B,MAAO,wBAEFstB,CAIL,4DAEH,MAAAhvB,EAAAgC,EAAA,CAEHnC,GAAA,SAAKS,EAAM,CAAuBP,YAChCF,EAAA,QAAMS,MAAM,KAAIP,UACdC,EAAA,QAAMM,MAAM,qDAAyD,EAAE,IACvEN,EAAAgC,EAAA,CAAA5H,GAAA,SAAsB,CAAC,EACnB,EAAEyF,EACRA,OAAA,CAAMS,MAAM,KAAIP,UACdC,EAAA,QAAMM,MAAM,qDAAuD,EAAE,IACrEN,EAAAgC,EAAA,CAAA5H,GAAA,SAAqB,CAAC,EAClB,EAEJ,GAAY,GAAA4F,EAAID,MACdC,CAAA,MAAMM,gBAAM,SAAwDN,EACpEA,EAAAgC,CAAA,GAAA5H,QAAA,EAAqB,EAGzB,EAAY,EACV,IAAAquB,GAAMnoB,QAAM,8BACZ,SAAAN,EAAA5F,MAAA,uCAAqB,OAChB,EAAA40B,GAAA,SACHhvB,EAAA,aAGRA,yBAAA,SAAWH,EAAA,UAAeE,cACxB,sCAAqCqvB,KAAA,UAClC,aAEJG,GAAA,CACF,EAGP9G,UACAzoB,EAAA,OAAW,4BAAAovB,KAAA,yBAAsBrvB,EAC/BC,EAAAgC,EAAA,CACE1B,GAAM,SACN/H,EAAQ,GAAEy2B,EAAajvB,CAEvB,EAAW,EACT,GACO,GAAAC,EAAA,SACC,eACIovB,CAAwB,KAAAxzB,EAEhC2zB,WAAmB,WAAA5H,EACrB,cAAA/N,EAEA,qBAAA+M,GAEsD,gBAAA6I,EAGtD,mBAAA5H,EAAA,iBAAAC,EAAkC,mBAAAC,EAK5B,sBAAAC,EACL,EACF,GAER/nB,EAAA6iB,GAAA,CACG,UACNzoB,EAAA2F,OACiB,KACbnE,4BACAlC,kCACAiuB,GACA/N,QACA+M,cACA6I,OACA5H,KACAC,SACAC,cACAC,EAA6C,MAAAjnB,EAEzC,QACP+hB,EAAY,EACXC,MACAlnB,MACAmnB,IAAM+E,oBAOb,EACE,CAEG,EACJ9mB,CACE4mB,EAAwB,CAC1B,MAAE7nB,GAEDghB,EAAgB,YACL,CAAAplB,EAAA80B,EAAApb,CAAA,SAAAgd,EAAEvxB,8BAAOqR,UAAmB,IACpCyV,IACAyK,MACE7C,KACF8C,EACFD,EAAA,IACDC,EAEJ,WAAAA,CAAA,EACD,CAAA32B,EAAA80B,EAAApb,EAAAid,CAAA,CAEN,CCjnCA,SAASC,GAAa,CAAEpgB,UAASzY,SAAU84B,EAAcxxB,SAAQ,EAAG,CAClE,KAAM,CAAEhI,KAAGC,KACL,CAAEQ,QAAOC,WAAUkgB,iBAAkB1e,GAAI,CAAExB,SAAU84B,EAAc,EACnEnF,EAAW,OAAOlb,GAAY,SAEpC/Z,SAAU,IAAM,CACTi1B,IACHzzB,EAAO8C,SAAS,GAAGyV,EAAQ/X,EAAE,IAAIV,CAAQ,EAAE,EAAIyY,EAEnD,EAAG,CAACA,CAAO,CAAC,EAEZsN,GAAkBze,CAAO,EAGvBnB,EAAA,OACES,MAAM,QAQNP,SAAA,CAEC,CAAC,CAACiB,GACDhB,EAAA,UAAQE,KAAK,SAASI,MAAM,oBAAoBH,QAASa,EAAQjB,SAC/DC,EAACS,EAAI,CAACC,KAAK,IAAIE,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EACzB,EAEV4F,EAACmtB,GAAW,CACVzzB,WACAkgB,gBACAzH,UACAib,aAAc,SAAY,CACxB,GAAIC,EACF,GAAI,CAKF,OAJa,MAAM5zB,EAAMM,GAAG2C,SAAS+1B,OAAO,CAC1C5S,KAAM1N,EACNugB,eAAgB,GACjB,CAEH,MAAY,CACV,MAAMC,EAAS,MAAMl5B,EAAMswB,GAAGC,OAAO/vB,KAAK,CACxCgwB,EAAG9X,EACHjS,KAAM,WACNhG,MAAO0f,EAAgB,EAAI,GAC3BsQ,QAAStQ,EACV,EACD,GAAI+Y,EAAOj2B,SAASlC,OAAQ,CAC1B,MAAMo4B,EAAwBD,EAAOj2B,SAASqY,KAC3ChJ,GAAMA,EAAE0G,MAAQN,GAAWA,EAAQ0gB,WAAW9mB,EAAE0G,GAAG,CACtD,EACA,GAAImgB,EACF,OAAOA,CAEX,CACA,GAAI,6BAA6B5uB,KAAKmO,CAAO,EAAG,CAC9C,MAAM2gB,EAAaC,IAAIv0B,MAAM2T,CAAO,EACpC,GAAI2gB,EAAY,CACd,KAAM,CAAExjB,WAAUG,YAAaqjB,EACzBjT,EACJpQ,EAASzB,QAAQ,MAAO,EAAE,EAAEA,QAAQ,MAAO,EAAE,EAC7C,IACAsB,EACIqjB,EAAS,MAAMl5B,EAAMswB,GAAGC,OAAO/vB,KAAK,CACxCgwB,EAAGpK,EACH3f,KAAM,WACNhG,MAAO,EACPgwB,QAAStQ,EACV,EACD,GAAI+Y,EAAOj2B,SAASlC,OAClB,OAAOm4B,EAAOj2B,SAAS,CAAC,CAE5B,CACF,CACF,KAEA,QAAOyV,CAEX,EACD,CAAC,EACC,CAET,CC/EA,SAAS6gB,GAAO,CAAEhyB,SAAQ,EAAG,CAC3B,KAAM,CAAEhI,KAAGC,KACL,CAAEQ,SAAUyB,KACZ,CAAC8lB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAAC65B,EAAQC,CAAS,EAAI95B,EAAS,EAAE,EACjC,CAAC8sB,EAAanU,CAAM,EAAIC,GAAYgD,GAAMA,EAAI,EAAG,CAAC,EAExD5c,EAAU,IAAM,CACdklB,EAAW,SAAS,GACnB,SAAY,CACX,GAAI,CACF,MAAMlZ,EAAO,MAAM+uB,GAAGF,OAAO7uB,OAC7B,GAAIA,EAAK5J,OAAQ,CACf,MAAM44B,EAAKC,KACLC,EAAUlvB,EAAKmvB,UAAgBx1B,EAAI80B,WAAWO,CAAE,CAAC,EACvD,GAAIE,EAAQ94B,OAAQ,CAClB,MAAMy4B,EAAS,MAAME,GAAGF,OAAOO,QAAQF,CAAO,EAC9CL,EAAO7d,KACL,CAACrJ,EAAGsJ,IAAM3S,KAAKlE,MAAM6W,EAAEiP,SAAS,EAAI5hB,KAAKlE,MAAMuN,EAAEuY,SAAS,CAC5D,EACA4O,EAAUD,CAAM,CAClB,MACEC,EAAU,EAAE,CAEhB,MACEA,EAAU,EAAE,EAEd5V,EAAW,SAAS,CACtB,MAAY,CACV7kB,SAAe,CACf6kB,CAAkB,IACpB,EACF,CAAA4I,CAAG,GACL,MAAIA,EAAY+M,GAAA,SAEhB,OAAMQ,SAEN,cACOnzB,SAAM,GAAAU,GAAAhB,EAAA,wBAECE,MAAK,cAASI,QAAMU,EAAcb,SAASa,KAAQjB,SACnDW,MAAYvE,CAAE,aAAO,EAAC,GAAG0D,EAAA,UACzB,SAEV,CAAAA,EAAA,MAAAE,SACEF,GAAAmC,EAAA,CAAAjC,WACE,GAAA3F,IAAA4F,EAAA8jB,GAAA,CAA2B,OAC3B9jB,GAAQgiB,OAAMhB,IAAA,WAACzoB,CAAoB,GAAak7B,GAAAzzB,EAAA,OAC9C,MACHyzB,gBACMnzB,SAAMN,EAAAgC,EAAA,CAAejC,WACxB,KAGO,GAEVC,EAAA,QACK,SACRyzB,EAAA5zB,EAAAC,EAAA,CAAAC,SACG0zB,QACC5zB,CAAAE,oBACMO,SAAM2yB,EAAA,IAAAS,GAAA,CAAa3zB,MAEnB,UAAAukB,EAAQA,MAAWvmB,cAAKotB,UAAawI,SAASC,EAAUF,cACxD,OAAMG,QACN,UACEh0B,EAAA,OAAAE,wBACOO,SAAM,CAAAT,EAAA,KAAiBE,SAC1BF,GAAAY,EAAA,CAAAV,OACGU,QAAI,QAACC,KAAMizB,GAAoB,GAAShzB,IAAKd,EAAA,QAAK,SACnDA,GAAA8zB,GAAA9zB,EAAAC,EAAA,UACI,CAAC6zB,UACD5zB,qBACQO,SAAM,KAAAqzB,EAAA,gBAAc5zB,OAAC,GACvB4zB,CAAoB,GAClBpwB,GACNswB,CAAM,KAGkB,GACvB7zB,EAAAqT,GAAA,CACN,aACFA,SAAW,CACVE,aACE,CAAAxT,WACE,KAAiC,kBAC7B,SAERyT,YACArR,SAAM6e,IAAA,UACN3e,YAAU2e,WACK,CACZ,IACC,MAAImS,GAAA,WAAAp1B,CAAA,EAGFgU,EAAMohB,CACNphB,MAAO,SAGF5V,CAAC,cAAyC,CAAC,IAClD,EAEJ,SAAA6D,EAAA,UAAED,cAGAG,MAAK,cACLI,SAAM0gB,IAAA,UACN3e,SAAU2e,IAAY,CAAUjhB,WAEhC,IAAqB,EAAC,CAChB,GACIC,EAAA,UACX,KACLA,SACEE,SAAK8gB,IAAA,UACL3e,mBACA/B,QAAM,gBAGAV,EACJ,GAAIk0B,cAEFxW,GADFA,EAAaljB,SAAMw5B,EACjBtW,EACA,GAAIqW,CACF/zB,EAAI,MAAAnG,EAAA,oBAAAk6B,EAAA,WACF/zB,eAKA2b,CAAKpf,YAAC,GAAAmhB,EAAiC,WAAC,MACxCA,CACA,GACFsW,EACF,IACIA,EAAO,MAAAn6B,EAAA,oBAAAm6B,EAAA,WACT,MAAI,CACFE,QAIAr7B,CACA8iB,GAAKpf,YAACmhB,EAAA,WACNA,WAAW,CAAS,CAGtB,OACF,aACAA,cACF,cAAA1d,EACA1J,aAAqB,EACnBi1B,EACAvrB,iBACAk0B,eAEFl6B,SAAOgF,KAAc,CACrBhF,OAAoB,CACtB,GAAEmG,CAEQ,EAAAukB,CAACoP,GAAe,GAAAT,EACnB,UAAAjzB,EAAA,cA/FFskB,EAgGLjR,GAAA,CAEP,aAAArT,EAAA,QAEFizB,SAAOz4B,EAASwH,GACfjC,GACEC,QAAY,CACVuT,CACE,GACE,oCAAgCyN,IAAA,UAAC,QAC7B,MAERxN,YACUwN,SAAY,MAEnB,MAAAmS,GAAY,eAAAF,EAAA,IAAAS,KAAA,MAGXpW,EAAW,SAAS,EACpBvL,EAAI,CACF,OAGAuL,SAGA7kB,GAAQ6Y,QACRiK,CAAKpf,KAAC,aAA0C,EAChDmhB,oBAAkB,MACpB,SAEF,MAAG,eACL,SAAA0D,IAAA,UAAEjhB,WAEFiC,EAAA,CACE9B,GAAK,SACLI,CAAM,EACgB,EAEtB,MAAAN,EAAyB,cACnBA,EAAAgC,EAAA,CAAC,GACE,SACZ,CACJ,CACD,CAEF,GACE,GAA8B,SAC7B+xB,GAAA,OAAAL,CAEA,EACJ,CAET,MAEA,EAAAzW,CAAmB,EAAEyW,KAAS,CAC5B,YAAAvI,EAAQnyB,iBACR,EAAA06B,EAAQvI,CAAawI,SAASC,cAAM,KAAAtsB,EACpC,iBAAAmb,CAAM,EAAEjU,EAAQwlB,uBAAa1sB,cAAMmb,UAAqB0I,UAClD8I,EAAgBnvB,GAAStK,KAC/B,GAAM05B,GAAWzR,OACjB,MAAM0R,IAAoB/5B,8BAC1B,GAAMg6B,UACN,KAAMC,CACJ,KAAA/R,CACA,EAAAgS,EAEA,OADY,oBAAAhS,CAAA,CACN,GAAEA,aAASgS,KACjB,SAAMC,QAAgBC,CACtB,MAAOD,aACLL,SAAUzR,IAAiB5iB,EAAA,OAC/B,MACEC,oBAAAu0B,EAAA,iBAAAt0B,QACE,CAAKO,aAAM,OAAA+zB,CAAA,KAAYt0B,GAGjBO,SAAO,CAAA2zB,GAAAj0B,EAAoBq0B,QAEzBA,OAEM,IAAApX,EAGPld,CAEiBW,GAAK,SAAUuc,IAAEiX,GAAAr0B,EAAA,kBAAAG,EAAAS,EAAA,CAAM,kBAAC,IAAAwc,EAExCld,CACQW,GAAK,SAAgBuc,IAAE,IAAAjd,EAAA,kBAAAyiB,GAAA,SAAO,GAAC0R,GAAAn0B,EAAAS,EAAA,CAAC,KAAI,QAC1C,MAGH0zB,CAAkBzzB,GAAK,SAAWuc,IAAE,GAAApd,EAAAzF,MAAA,OAAO,2BAAC,GAAA45B,GAAAh0B,EAAA,OAAI,2BAGrDH,SAAAm0B,CAAA,CAAK1zB,OAAMN,EAAA,iCACcM,SAAMkO,CAAA,EAAoBzO,CAAEi0B,EAAW,CACjD,EAAW,EAAqBxlB,CC5QvD,SAASimB,GAAW,CAAEpa,OAAM5H,MAAK/H,QAAOC,SAAQ3J,UAAUA,IAAM,CAAC,CAAE,EAAG,CACpE,KAAM,CAAEhI,KAAGC,KACX,OACE4G,EAAA,OAAKS,MAAM,wBAAuBP,UAChCF,EAAA,OAAKS,MAAM,eAAcP,UACvBC,EAAA,UAAQE,KAAK,SAASI,MAAM,QAAQH,QAASA,IAAMa,IAAUjB,SAC3DC,EAACS,EAAI,CAACC,KAAK,IAAIE,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EACzB,EACPqY,GACC5S,EAAA,KAAGsT,KAAMV,EAAKpR,OAAO,SAAS4Z,IAAI,WAAW3a,MAAM,eAAcP,UAC/DC,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAgC,EAC5B,EAAE,IACR4F,EAACS,EAAI,CAACC,KAAK,WAAY,CAAC,EACvB,CACJ,EACE,EACLV,EAAA,OACEM,MAAM,gBACN4wB,wBAAyB,CAAEE,OAAQ/W,GACnC3Y,MAAO,CACL,UAAWgJ,EAAQ,KACnB,WAAYC,EAAS,KACrB,iBAAkB,GAAGD,CAAK,IAAIC,CAAM,GACtC,CACD,CAAC,EACC,CAET,CChBA,SAAwB+pB,GAAgB,CACtCh7B,WACAg4B,2BAA2B,GAC3BiD,SACA3zB,UAAUA,IAAM,CAAC,EACjB2wB,WACF,EAAG,CACD,KAAM,CAAE34B,KAAGC,KACL,CAAEQ,QAAOC,SAAUuuB,GAAoB/sB,KACvC05B,EAAoBl7B,EAAWA,IAAauuB,EAAkB,GAC9DhrB,EAAaC,GAAYtD,CAAM,EAE/B,CAAConB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAACy7B,EAAUC,CAAW,EAAI17B,EAAS,EAAK,EAI9C,GAFAqmB,GAAkBze,CAAO,EAErB,CAAC/D,EAAWs0B,oBACd,OAAO,KAGT,KAAM,CACJn3B,KACAo3B,UACAC,gBACA/0B,SAAUq4B,EACVC,iBACE/3B,EAAWs0B,oBAET,CAAC70B,EAAUu4B,CAAW,EAAI77B,EAC9B27B,GAAgBv6B,OAASu6B,EAAiB,EAC5C,EAEM,CAACzR,EAAkBC,CAAmB,EAAInqB,EAAS,EAAE,EAErD87B,EAAoB,MAAOx4B,GAAa,CAE5C,GADI,CAACA,GAAUlC,QACX,CAACo6B,EAAmB,OACxB,MAAMhR,EAAgB,MAAMD,GAAmBjnB,EAAU4mB,CAAgB,EACrEM,GACFL,EAAoB,CAClB,GAAGD,EACH,GAAGM,EACJ,CAEL,EAEMuR,EAAgB3G,GAAc,CAC7BiD,IACDjD,GAAa,CAAC9xB,GAAUlC,QAAQy6B,EAAY,EAAE,EAClD3X,EAAW,SAAS,GACnB,SAAY,CACX,GAAI,CACF,KAAM,CAAE8X,OAAM96B,SAAU,MAAMm3B,EAAcjD,CAAS,EACrD,GAAI1hB,MAAMuoB,QAAQ/6B,CAAK,EAAG,CACxB,GAAIk0B,EAAW,CACb,MAAM9xB,GAAW,GACjB,QAASmL,EAAI,EAAGA,EAAIvN,EAAME,OAAQqN,IAAK,CACrC,MAAMsK,EAAU7X,EAAMuN,CAAC,EACjBytB,EAAa54B,GAASqY,KAC1B,CAAChJ,EAAGwpB,IAAMxpB,EAAE3R,KAAO+X,EAAQ/X,IAAMyN,IAAM0tB,CACzC,EACKD,EAMHA,EAAWE,OAAOxf,KAAK,GAAG7D,EAAQqjB,MAAM,EALxC94B,GAASsZ,KAAK,CACZwf,OAAQ,GACR,GAAGrjB,EACJ,CAIL,CACA8iB,EAAYv4B,EAAQ,CACtB,MAGEu4B,EAAa5qB,IAAS,CACpB,MAAMorB,EAAcprB,GACpB,UAAW8H,KAAW7X,EAAO,CAC3B,MAAMg7B,EAAaG,EAAY1gB,QAAYhJ,EAAE3R,KAAO+X,EAAQ/X,EAAE,EACzDk7B,EAGHA,EAAWE,OAAOxf,KAAK,GAAG7D,EAAQqjB,MAAM,EAFxCC,EAAYzf,KAAK7D,CAAO,CAI5B,CACA,OAAOsjB,CACT,CAAC,EAEHX,EAAY,CAACM,CAAI,EAEjBF,EAAkB56B,CAAK,CACzB,MACEw6B,EAAY,EAAK,EAEnBxX,EAAW,SAAS,CACtB,MAAY,CACV7kB,SAAe,CACf6kB,CAAkB,KACpB,EAEJkR,EAAAr2B,EAAA,IAEAC,EAAMo2B,KACNp2B,GAAgB,SACVsE,GAEFy4B,EAAI1D,EAAe,EACjB0D,UAAiB,IAEnBD,EAAOx4B,CAAA,GAGTy4B,EAAO,IACLA,UAAiB,GACG,EACtB,CAAA1D,CAAA,GACFr5B,EAAIq5B,KAEJr5B,EAAgB,SACVo2B,EAAUn2B,uBAAS,KAAA+B,GAGvB+6B,EAAe3J,GACI,EACnB,CAAAvuB,EAAA,gCACF,MAAIA,IAAWuuB,YAEf,OAAM7rB,EAAO/F,MAAOgD,CAEpB,gCACOxC,MAAG,QAA6BkG,SAAM,KAAQ6D,SAAS,CAAAnE,EAAA,UAAID,cACtDG,MAAK,cAASI,QAAMU,EAAcb,SAASa,KAAQjB,SACnDW,MAAYvE,CAAE,aAAO,EAAC,GAAG6D,EAAA,UACzB,SACRA,EAAA,MAAAD,YACE5D,EAAYA,CAAI,aAAU,EAAC,GAAK0D,EAAA,QAC1B,SACR,CAAAF,GAAAK,EAAA8T,GAAA,CAAA/T,OAAArG,GAEIsG,CAAK,MAAAL,EAAA,KACHoC,MAAI,eACJzB,SAAMN,EAAA01B,GAAA,CAAc31B,OAEpBC,EAAQwO,SAAc7N,SAAK,IAAY,GAAEjE,EAAA,SAAAmD,EAAAC,EAAA,CACrC,SAEPpD,CAASlC,OAAS,CACjBuF,sBACMO,SAAM5D,EAAA,IAAAyV,GAAA,CAAepS,QACRoS,EAAYA,EAAA,IACnB8R,OAAeX,gBAAiBnR,QAAU,KAChD,OAAMpU,OAASoU,CACf,UACE6iB,GAAA7iB,EAAA,kBAAAnS,EAAA,OAAAD,wBAESO,SAAM6R,EAAA,WAAAjS,IAAAF,EAAAS,EAAA,OAGLC,OACE,SACEqd,UAAQ,SACRD,IACF,MAAM,GAAA5d,EAAA,SAERI,CAAc,GAEjBN,EAAA,OACE,MAEP,wBAAKM,SAAMN,EAAA+jB,GAAA,CAAuBhkB,UAE9BoS,aACAwjB,eACA1R,4BACAyN,EAAmD,CACpD,EACE3zB,CAAC,GACJ,GAEPijB,IAAA,UAAA6T,EAAA70B,EAAA41B,GAAA,CACC,SACH5U,GAAY,IAILmU,EAAY,CACG,EAEjB,SAAAn1B,EAAA,UAAED,cAGAG,MAAK,cACLI,QAAM,IAAA60B,EAAA,EACNh1B,WAAeg1B,GAAep1B,WAE9B,IAAwB,GAClBC,EAAA,KACF,MAERA,yBAAGM,SAAMN,EAAAgC,EAAA,CAAwBjC,WAC/B,KAAsBihB,IAAA,WAAAhhB,EAAA,KACrB,MAGLghB,WACK1gB,SAAMN,EAAA8jB,GAAA,CAAU/jB,OACjBC,EAAO,EAAO,GAAE,GAGrBghB,IAAA,UAAAhhB,EAAA,KACD,MACAghB,WACC1gB,SAAMN,EAAA8jB,GAAA,CAAU/jB,OACjBC,EAAO,EAAO,GAAEghB,IAAA,QAAAhhB,EAAA,KACf,MACDghB,WACC1gB,SAAMN,EAAAgC,EAAA,CAAUjC,WACjB,KAAoCC,EAAA,KACnC,MAEHA,yBAAGM,SAAMqxB,GAAAx1B,EACGA,CAAI,aAAiB,EAAC,IAEnC,EACI,CCrOb,SAAS05B,GAAwB,CAAEn5B,SAAUo5B,EAAkB90B,SAAQ,EAAG,CACxE,KAAM,CAAEhI,KAAGC,KACL88B,EAAmBpkB,KAEnB,CAAEqkB,oBAAqB1hB,GAAQ,IAAM,CACzC,GAAI,CAACwhB,EAAkB,MAAO,CAAEE,iBAAkB,IAElD,MAAMC,EAAc,CAAEC,UAAW,EAAGC,IAAK,GAkBzC,MAAO,CAAEH,iBAjBgBF,EACtBtzB,IAAK2P,GAAY,CAMhB,MAAM3D,EALWunB,EAAiBhhB,KAC/BhJ,GACCA,EAAEnQ,KAAKxB,KAAO+X,EAAQvW,KAAKxB,IAC3B2R,EAAEsC,cAAgB8D,EAAQ9D,WAC9B,EAC0B,YAAc,MACxC,MAAO,CACL,GAAG8D,EACHikB,SAAU5nB,EAEd,CAAC,EACA4G,KAAK,CAACrJ,EAAGsJ,IACD4gB,EAAYlqB,EAAEqqB,QAAQ,EAAIH,EAAY5gB,EAAE+gB,QAAQ,CACxD,CAEMJ,CACX,EAAG,CAACF,EAAkBC,CAAgB,CAAC,EAEjC,CAACM,EAAkBC,CAAmB,EAAIl9B,EAAS,IAAM,CAC7D,MAAMm9B,EAAmB,GACzBP,SAAiB5uB,QAAS2E,GAAM,CAC1BA,EAAEqqB,WAAa,YACjBG,EAAiBxqB,EAAEnQ,KAAKxB,GAAK2R,EAAEsC,WAAW,EAAI,GAE9CkoB,EAAiBxqB,EAAEnQ,KAAKxB,GAAK2R,EAAEsC,WAAW,EAAI,EAElD,CAAC,EACMkoB,CACT,CAAC,EAEK,CAACvV,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAE1Co9B,EAAwBA,IAAM,CAClClZ,EAAW,WAAW,EACtB,MAAMmY,EAAc,CAClB,GAAGM,EACH,GAAGD,EAAiBvC,OACjBphB,GAAYkkB,EAAiBlkB,EAAQvW,KAAKxB,GAAK+X,EAAQ9D,WAAW,CACrE,CAAC,EAEHwE,GAAa4iB,CAAW,EACxBz0B,IACApH,EAAOma,yBAA2B,GAClCna,EAAO68B,aAAe,EACxB,EAEMC,EAAgB9d,OAAOve,OAAOg8B,CAAgB,EAAE9C,OAAOoD,OAAO,EAAEn8B,OAEtE,OACEqF,EAAA,OAAKzF,GAAG,sCAAsCkG,MAAM,QAAOP,SAAA,CACxD,CAAC,CAACiB,GACDhB,EAAA,UACEE,KAAK,SACLI,MAAM,cACNH,QAASa,EACTqB,SAAU2e,IAAY,YAAYjhB,SAElCC,EAACS,EAAI,CAACC,KAAK,IAAIE,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EACzB,EAEV4F,EAAA,UAAAD,SACEC,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAuC,EACtC,EACG,EACR4F,EAAA,QAAAD,SACEF,EAAA,OAAKS,MAAM,mBAAkBP,UAC1Bi2B,EAAiBzC,OAAQxnB,GAAMA,EAAEqqB,WAAa,WAAW,EAAE57B,OAC1D,GACAwF,EAAA,OAAKM,MAAM,uBAAsBP,SAC/BF,EAAA,SAAOS,MAAM,eAAcP,UACzBC,EAAA,SACEE,KAAK,WACLsb,QACEwa,EAAiBzC,OAAQxnB,GAAMA,EAAEqqB,WAAa,WAAW,EACtD57B,OAAS,GACZw7B,EACGzC,UAAcxnB,EAAEqqB,WAAa,WAAW,EACxCQ,MAAO7qB,GAAMsqB,EAAiBtqB,EAAEnQ,KAAKxB,GAAK2R,EAAEsC,WAAW,CAAC,EAE7DoH,SAAWxe,GAAM,CACf,MAAM4/B,EAAe,CAAE,GAAGR,GACpBS,EAAe7/B,EAAEoK,OAAOma,QAC9Bwa,EAAiB5uB,QAAS2E,GAAM,CAC1BA,EAAEqqB,WAAa,cACjBS,EAAa9qB,EAAEnQ,KAAKxB,GAAK2R,EAAEsC,WAAW,EAAIyoB,EAE9C,CAAC,EACDR,EAAoBO,CAAY,CAClC,EACAx0B,SAAU2e,IAAY,YACvB,EACDhhB,EAAA,QAAMM,MAAM,eAAcP,SACxBC,EAAAgC,EAAA,CAAA5H,GAAA,SAAwB,EACpB,CAAC,EACF,EACJ,EAEP4F,EAAA,MAAIM,MAAM,gBAAeP,SACtBi2B,EAAiBxzB,IAAK2P,GAAY,CACjC,MAAMpU,EAAMoU,EAAQvW,KAAKxB,GAAK+X,EAAQ9D,YAChC0oB,EAAaV,EAAiBt4B,CAAG,EACjC,CAAEq4B,SAAU5nB,GAAW2D,EAC7B,OACEnS,EAAA,MAAAD,SACEF,EAAA,SAAOS,MAAM,eAAcP,UACzBC,EAAA,SACEE,KAAK,WACLsb,QAASub,EACTthB,SAAWxe,GAAM,CACfq/B,EAAoB,CAClB,GAAGD,EACH,CAACt4B,CAAG,EAAG9G,EAAEoK,OAAOma,QACjB,CACH,EACAnZ,SACE2e,IAAY,aAAexS,IAAW,YAEzC,EACDxO,EAACwS,GAAM,CAACC,IAAKN,EAAQvW,KAAK8W,aAAc/R,KAAK,KAAM,EACnDX,EAAA,OAAKM,MAAM,eAAcP,SACvBC,EAAC8S,GAAQ,CACPX,QAAS,CACP,GAAGA,EAAQvW,KACXikB,KAAM,IAAI7b,KAAKmO,EAAQvW,KAAKikB,IAAI,EAC5B1N,EAAQvW,KAAKikB,KACb,GAAG1N,EAAQvW,KAAKikB,IAAI,IAAI1N,EAAQ9D,WAAW,IAEjD0E,SAAQ,GACT,EACE,EACL/S,EAAA,OAAKM,MAAM,eAAcP,SACtByO,IAAW,aACVxO,EAAA,QAAMM,MAAM,gBAAeP,SACzBC,EAAAgC,EAAA,CAAA5H,GAAA,SAAsB,EAClB,EAEL,CAAC,EACD,GAlCA2D,CAmCL,CAER,CAAC,EACC,EAEJ8B,EAAA,UAAAE,UACEC,EAAA,UACEE,KAAK,SACLI,MAAM,QACNH,QAASa,EACTqB,SAAU2e,IAAY,YAAYjhB,SAElCC,EAAAgC,EAAA,CAAA5H,GAAA,SAAoB,EACd,EACR4F,EAAC8jB,GAAM,CAACvrB,OAAQyoB,IAAY,YAAc,EAC1ChhB,EAAA,UACEE,KAAK,SACLmC,SAAUq0B,IAAkB,GAAK1V,IAAY,YAC7C7gB,QAASq2B,EAAsBz2B,SAE/BC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAAq8B,gBACsB,CAGrB,EACK,CAAC,EACH,CAAC,EACN,EACD,CAAC,EACJ,CAET,CCrLA,SAAwBM,GAAqB,CAAEh2B,SAAQ,EAAG,CACxD,KAAM,CAAEhI,KAAGC,KACLyD,EAAWiV,KACX,CAACqP,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAAC08B,EAAkBmB,CAAmB,EAAI79B,EAAS,IAAI,EACvD,CAAC89B,EAAUC,CAAW,EAAI/9B,EAAS,EAAK,EAExCg+B,EAAe,SAAY,CAC/B9Z,EAAW,WAAW,EACtB,GAAI,CAOF,MAAM+Z,EAAa,CACjB36B,SAPeiV,KACiBnP,IAAK2P,GAAY,CACjD,KAAM,CAAEI,cAAa,GAAG+kB,GAASnlB,EACjC,OAAOmlB,CACT,CAAC,EAIC30B,UAAWD,KAAK1G,KAAI,EAEhByS,EAAOlQ,KAAKg5B,UAAUF,CAAU,EAEhC7U,EAAO,IAAIgV,KAAK,CAAC/oB,CAAI,EAAG,CAAEvO,KAAM,mBAAoB,EACpDuS,EAAMsgB,IAAIyB,gBAAgBhS,CAAI,EAC9BzW,EAAI5V,SAASi6B,cAAc,GAAG,EACpCrkB,EAAEoH,KAAOV,EACT,MAAMzW,MAAU0G,KACV+0B,EAAO,GAAGz7B,EAAI07B,aAAa,IAAI7pB,OAAO7R,EAAI27B,WAAa,CAAC,EAAEC,SAC9D,EACA,GACF,CAAC,IAAI/pB,OAAO7R,EAAI67B,SAAS,EAAED,SAAS,EAAG,GAAG,CAAC,IAAI/pB,OAC7C7R,EAAI87B,UACN,EAAEF,SAAS,EAAG,GAAG,CAAC,IAAI/pB,OAAO7R,EAAI+7B,YAAY,EAAEH,SAAS,EAAG,GAAG,CAAC,GAC/D7rB,EAAEisB,SAAW,YAAYP,CAAI,eAC7B1rB,EAAEksB,QACFlF,IAAImF,gBAAgBzlB,CAAG,EACvBzR,GACF,MAAY,CACVvI,KACS0D,CAAC,eAAgBmhB,EAAA,QAC1BA,CAAkB,EAEtB6a,EAAA,MAAA7V,GAAA,CAEA,GAAM6V,EACJ,CAAA7a,EAAW,aAEXA,IACA,MAAI6J,EAAA,MAAA7E,EAAA,OAEI7T,EADO,WAAW0Y,IACAA,SAExB,kBAAiB1Y,CAAM/R,yCACvBu6B,EAAmBv6B,GAEnBu6B,WAAoBv6B,CACpB4gB,UACUnhB,EAEVE,CAASF,YAAC,GAAAmhB,EAAe,UACzBA,EACF8a,EAAAnhC,GAAA,CACF,MAAAqrB,EAAArrB,EAAA,gBAEAkhC,IACE,EAiBAA,eAAgB,CAClB,sCAEA,cAEI/9B,WArBcnD,GAAA,CAClBA,EAAA,iBAEAkgC,KACElgC,EAkBEqJ,YAjBc,KAClB62B,EAAA,GAEA,EAeIkB,OAdUphC,GAAK,CACnBA,EAAA,iBAEAkgC,IAAgBlgC,EACdA,MAAEoJ,iBAAe,SACjB82B,EAAY7U,CAAA,CACZ,EASEgW,2BACAC,kCAGUr4B,QAAKc,EAASV,SAAMN,EAAAS,EAAA,CAAcN,SAAiBJ,MAC1Ca,CAAGzE,YAAE,GAAO,GAAC6D,EAAA,UAAC,SAAEA,EAAA,MAGnCA,WAAAgC,EAAA,CAAAjC,YACEA,YACE3F,EAAA4F,EAAA,SAAA2D,wBAAA,CAAAC,CACgB,CAAa,EAAkC,EAAC,GAAA/D,EACzD,QAAC,SACN,CAAAA,EAAA,WAENA,SAAA,CAAAA,EAAA,SAAAE,MACEF,8CAAAq3B,EAAA,iBAAAn3B,SACEF,IACES,SAAO,CAAAN,EAAAS,EAAA,CAGP0D,yBAAYpE,UAEP,GAACW,EAAK,KAAoBC,SAAKX,EAAAgC,EAAA,CACpChC,WAAA,CAAAD,CACE,GAAA3F,EAAA,cAAoB,OACnB,OACH,QACE8F,SAAKk4B,EACL7V,SAAOvB,IAAA,YACPvL,eACUuL,MAAY,CACf,GAAE3E,QAAS,CAAO,SAAArc,EAAA,SAE3BA,MAAA,gBAAAD,WACEiC,EAAA,CAAO1B,WAAM,CAAeP,CAC1B,KAA0B,GAAC,IACtBF,EAAA,UAAC,KACJ,SACD,MACPA,sCACEK,QAAKk3B,EACL92B,SAAM0gB,IAAA,aAAAtkB,EAAA,WACNyD,SAASi3B,MACT/0B,uBAA2DtC,UAEtD,GAACW,EAAK,KAAkBC,SAAKX,EAAAgC,EAAA,CAClChC,WAAA,CAAAD,CACE,GAAA3F,EAAA,gBAAoB4F,EAAA,SAEtBA,MAAA,gBAAAD,WACEiC,EAAA,CAAO1B,YAAqBP,OAC1BC,CAAA5F,EAAAsC,EAAA,SACkBlC,EAAM,GAGvB,GACI,GAACwF,EACJ,WACC,gBACF,SAETA,EAAA,SAAGM,SAAMN,EAAAgC,EAAA,CAAejC,WACtB,CAAAA,CACE,KAIO,GAAC+1B,GACH91B,EAAAkE,GAAA,CAAC,QACN,KAEL4xB,EACC91B,KACEgB,EACEi2B,cAAwB,CAC1B,SAAAnB,EAAE/1B,YAED81B,CACCn5B,EAAUo5B,KACV90B,CACEi2B,EAAwB,GAC1B,EACD,CC3KX,MAAMuB,GAAwB,IAE9B,SAAwBC,GAAc,CAAE73B,MAAK4T,OAAMxT,SAAQ,EAAG,CAC5D,KAAM,CAAEhI,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAC/B,CAAC0tB,EAAgBoR,CAAiB,EAAIt/B,EAAS,EAAK,EACpD+f,EAAiBG,GAA2B,EAAI,EAChDuC,EACJ5e,EAAWW,SAASie,iCAAmC,GACnD8c,EACJ,CAAC,CAACnkB,GACFA,IAAS2E,GACT,CAACyf,GAAY,CAACpkB,CAAI,EAAG,CAAC2E,CAAc,CAAC,GACrC,CAAC0C,EAAgC9G,KAC9BwR,GAAM/R,IAAS+R,GAAKqS,GAAY,CAACpkB,CAAI,EAAG,CAAC+R,CAAC,CAAC,CAC9C,EAEFnuB,SAAU,IAAM,CACd,MAAMygC,EAAaj4B,GAAKpG,OAAS,GAAKoG,GAAKpG,QAAUg+B,GACjDG,GAAqBE,GACvBH,EAAkB,EAAI,CAE1B,EAAG,CAACC,EAAmB/3B,CAAG,CAAC,EAGzBf,EAAA,OAAKS,MAAM,QAAQ6D,SAAS,KAAIpE,SAAA,CAC7B,CAAC,CAACiB,GACDhB,EAAA,UAAQE,KAAK,SAASI,MAAM,oBAAoBH,QAASa,EAAQjB,SAC/DC,EAACS,EAAI,CAACC,KAAK,IAAIE,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EACzB,EAEVyF,EAAA,UAAQS,MAAM,cAAaP,UACzBC,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA+B,EAC7B,EACJ4F,EAAA,OAAKM,MAAM,cAAaP,SACtBF,EAACoT,GAAK,CACJ9Q,MAAM,MACN+Q,WACElT,EAAA,UAAQE,KAAK,SAASI,MAAM,SAAQP,SAClCC,EAACS,EAAI,CAACC,KAAK,OAAOE,IAAGzE,EAAE,CAAA/B,GAAA,SAAM,EAAGuG,KAAK,KAAM,EACrC,EACTZ,SAAA,CAEDF,EAACiD,GAAQ,CACPT,SAAUilB,EACVnnB,QAASA,IAAM,CACbu4B,EAAkB,EAAI,CACxB,EAAE34B,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,YAAa,EACxBV,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAuB,EACnB,CAAC,EACC,EACT0+B,IACCj5B,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACb44B,GAAMn4B,EAAK4T,CAAI,CACjB,EAAEzU,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,QAAS,EACpBV,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAmB,EACf,CAAC,EACC,CACX,EACI,EACJ,CAAC,EACA,EACRyF,EAAA,QAAM2U,OAAYoM,IAAI,OAAM7gB,UAC1BC,EAAA,KACE0B,MAAO,CACL0lB,WAAY,WACZ4R,SAAU,UACVj5B,SAEDa,EACA,GACD+3B,GAAqBrR,IACrBtnB,EAACqnB,GAAgB,CACfC,iBACA2R,eAAgBzkB,EAChB2S,KAAMvmB,EACP,CACF,EACG,CAAC,EACJ,CAET,CCvGA,KAAM,KAAEga,GAAG,IAAEC,EAAG,EAAK,KCCrB,MAAMqe,GAAc,GACpB,QAAS/jB,IAAQ,CACb,UACA,SACA,SACA,WACA,QACA,OACA,SACA,YACA,MACJ,EACI+jB,GAAY,WAAW/jB,CAAI,GAAG,EAAIA,EAAK,YAAW,EAEvC,SAAAjV,GAAUi5B,EAAK,CAC1B,OAAOD,GAAY,OAAO,UAAU,SAAS,KAAKC,CAAG,CAAC,GAAK,QAC/D,CCfA,MAAAC,GAAe,CAACpjC,EAAMqjC,EAAW,OAEzBrjC,EAAK,QAAU,EAAU,MAAM,UAAU,MAAM,KAAKA,CAAI,EAGxDkK,GAAKlK,EAAK,CAAC,CAAC,GAAK,UAAYqjC,EACtBA,EACF,MAAM,EAAE,EACR,OAAQC,GAAMtjC,EAAK,CAAC,EAAEsjC,CAAC,IAAM,MAAS,EACtC,IAAKA,GAAMtjC,EAAK,CAAC,EAAEsjC,CAAC,CAAC,EAIvBtjC,EAAK,CAAC,EAAE,MAAM,CAAC,ECf1B,KAAM,CAAE,GAAAujC,GAAI,IAAA3e,GAAK,IAAAC,EAAG,EAAK,KAWzB,MAAM2e,GAAQD,GAAK,EACbE,GAAUF,GAAK,EACfG,GAAUH,GAAK,IACfI,GAAU,IAAMJ,GCbP,SAASK,GAAiBC,EAAGC,EAAG,CAC3C,IAAIrf,EAAIof,EAAE,OAEL,MAAM,QAAQA,EAAE,CAAC,CAAC,IAEnBA,EAAI,CAACA,CAAC,GAGL,MAAM,QAAQC,EAAE,CAAC,CAAC,IAEnBA,EAAIA,EAAE,IAAKpxB,GAAM,CAACA,CAAC,CAAC,GAGxB,IAAID,EAAIqxB,EAAE,CAAC,EAAE,OACTC,EAASD,EAAE,CAAC,EAAE,IAAI,CAAChoB,EAAGjK,IAAMiyB,EAAE,IAAKpxB,GAAMA,EAAEb,CAAC,CAAC,CAAC,EAC9CmyB,EAAUH,EAAE,IAAKI,GACjBF,EAAO,IAAKG,GACH,MAAM,QAAQD,CAAG,EAIfA,EAAI,OAAO,CAACluB,EAAGiJ,EAAGnN,IAAMkE,EAAIiJ,GAAKklB,EAAIryB,CAAC,GAAK,GAAI,CAAC,EAH5CqyB,EAAI,OAAO,CAACnuB,EAAGiJ,IAAMjJ,EAAIiJ,EAAIilB,EAAK,CAAC,CAIjD,CACT,EAMI,OAJIxf,IAAM,IACNuf,EAAUA,EAAQ,CAAC,GAGnBvxB,IAAM,EACCuxB,EAAQ,IAAKtxB,GAAMA,EAAE,CAAC,CAAC,EAG3BsxB,CACX,CCnCA,MAAMG,GAAe,CAEjB,GAAI,GAGJ,cAAe,MACf,GAAI,OACJ,GAAI,EACJ,GAAI,QAEJ,GAAI,WACJ,GAAI,WACJ,GAAI,UACJ,GAAI,WAEJ,GAAI,IAAQ,MACZ,IAAK,EACL,GAAI,MAAU,GAEd,YAAa,CAET,EAAG,OACH,EAAG,EACH,EAAG,OACX,EAEI,WAAY,CACR,IAAK,kBACL,IAAK,mBACL,IAAK,kBACL,IAAK,iBACL,IAAK,iBACL,IAAK,mBACL,IAAK,mBACL,IAAK,mBACL,IAAK,iBACb,EAEI,WAAY,CACR,IAAK,mBACL,IAAK,mBACL,IAAK,oBACL,IAAK,oBACL,IAAK,mBACL,IAAK,mBACL,IAAK,kBACL,IAAK,oBACL,IAAK,kBACb,EAGI,GAAI,kBACJ,GAAI,YACJ,GAAI,YAEJ,WAAY,CACR,IAAK,MACL,IAAK,OACL,IAAK,MACL,IAAK,MACL,IAAK,OACL,IAAK,OACL,IAAK,OACL,IAAK,MACL,IAAK,MACb,EAEI,YAAa,CACT,IAAK,kBACL,IAAK,mBACL,IAAK,qBACL,IAAK,oBACL,IAAK,kBACL,IAAK,mBACL,IAAK,mBACL,IAAK,kBACL,IAAK,iBACb,CACA,ECzCA,MAAMC,GAAWC,GAAW,CAExB,MAAMC,EAAO,KAAK,KAAKD,CAAM,EAC7B,OAAAA,EAAS,KAAK,IAAIA,CAAM,GAEnBA,GAAU,SACLA,EAAS,MACT,MAAQ,KAAK,IAAIA,EAAQ,EAAM,GAAG,EAAI,MAASC,CAE7D,EAEMC,GAAU,CAAC7xB,EAAGC,EAAG6xB,IAAM,CACzB,KAAM,CAAE,WAAAC,EAAY,YAAAC,EAAa,WAAAC,EAAY,YAAAC,EAAa,GAAAC,EAAI,GAAAC,EAAI,GAAAC,CAAE,EAChEC,GAEEC,EAAKJ,EAAKJ,EAAW,IAAMK,EAAKL,EAAW,IAAMM,EAAKN,EAAW,IACjES,EAAKL,EAAKJ,EAAW,IAAMK,EAAKL,EAAW,IAAMM,EAAKN,EAAW,IACjEU,EAAKN,EAAKJ,EAAW,IAAMK,EAAKL,EAAW,IAAMM,EAAKN,EAAW,IAEjEW,EACFR,EAAY,EAAIH,EAAW,IAC3BG,EAAY,EAAIH,EAAW,IAC3BG,EAAY,EAAIH,EAAW,IACzBY,EACFT,EAAY,EAAIH,EAAW,IAC3BG,EAAY,EAAIH,EAAW,IAC3BG,EAAY,EAAIH,EAAW,IACzBa,EACFV,EAAY,EAAIH,EAAW,IAC3BG,EAAY,EAAIH,EAAW,IAC3BG,EAAY,EAAIH,EAAW,IAEzBc,GACD7yB,EAAI+xB,EAAW,IAAM9xB,EAAI8xB,EAAW,IAAMD,EAAIC,EAAW,MACzDW,EAAKH,GACJO,GACD9yB,EAAI+xB,EAAW,IAAM9xB,EAAI8xB,EAAW,IAAMD,EAAIC,EAAW,MACzDY,EAAKH,GACJO,GACD/yB,EAAI+xB,EAAW,IAAM9xB,EAAI8xB,EAAW,IAAMD,EAAIC,EAAW,MACzDa,EAAKH,GAEJO,EACFH,EAAKb,EAAY,IAAMc,EAAKd,EAAY,IAAMe,EAAKf,EAAY,IAC7DiB,EACFJ,EAAKb,EAAY,IAAMc,EAAKd,EAAY,IAAMe,EAAKf,EAAY,IAC7DkB,EACFL,EAAKb,EAAY,IAAMc,EAAKd,EAAY,IAAMe,EAAKf,EAAY,IAE7D/+B,EAAIy+B,GACNsB,EAAKf,EAAW,IAAMgB,EAAKhB,EAAW,IAAMiB,EAAKjB,EAAW,GACpE,EACUlK,EAAI2J,GACNsB,EAAKf,EAAW,IAAMgB,EAAKhB,EAAW,IAAMiB,EAAKjB,EAAW,GACpE,EACUtlB,EAAI+kB,GACNsB,EAAKf,EAAW,IAAMgB,EAAKhB,EAAW,IAAMiB,EAAKjB,EAAW,GACpE,EAEI,MAAO,CAACh/B,EAAI,IAAK80B,EAAI,IAAKpb,EAAI,GAAG,CACrC,EC7FMwmB,GAAY,IAAI7lC,IAAS,CAC3BA,EAAOojC,GAAOpjC,EAAM,KAAK,EACzB,KAAM,CAAC8lC,EAAG/vB,EAAGsJ,EAAG,GAAGiiB,CAAI,EAAIthC,EACrB,CAAC+lC,EAAGC,EAAGC,CAAC,EAAIC,GAAa,CAACJ,EAAG/vB,EAAGsJ,CAAC,CAAC,EAClC,CAAC,EAAGob,EAAG0L,CAAE,EAAI5B,GAAQwB,EAAGC,EAAGC,CAAC,EAClC,MAAO,CAAC,EAAGxL,EAAG0L,EAAI,GAAI7E,EAAK,OAAS,GAAKA,EAAK,CAAC,EAAI,EAAI,CAACA,EAAK,CAAC,CAAC,EAAI,EAAG,CAC1E,EAGA,SAAS4E,GAAaE,EAAO,CAEzB,IAAIC,EAAW,CACX,CAAC,mBAAoB,mBAAqB,iBAAkB,EAC5D,CAAC,mBAAqB,kBAAmB,kBAAmB,EAC5D,CAAC,mBAAqB,mBAAqB,kBAAkB,CACrE,EACQC,EAAa,CACb,CAAC,EAAK,kBAAoB,iBAAkB,EAC5C,CAAC,EAAK,mBAAqB,kBAAmB,EAC9C,CAAC,EAAK,mBAAqB,mBAAmB,CACtD,EAEQC,EAAQ3C,GAAiB0C,EAAYF,CAAK,EAC9C,OAAOxC,GACHyC,EACAE,EAAM,IAAKvnB,GAAMA,GAAK,CAAC,CAC/B,CACA,CCRA,SAASwnB,GAAgBC,EAAW,CAChC,MAAMnC,EAAO,KAAK,KAAKmC,CAAS,EAChC,OAAAA,EAAY,KAAK,IAAIA,CAAS,GAE1BA,GAAa,OACPA,EAAY,MACZ,KAAK,KAAKA,EAAY,MAAS,MAAO,GAAG,GACnCnC,CACpB,CAEA,MAAMoC,GAAU,CAAC/gC,EAAG80B,EAAGpb,IAAM,CAEzB1Z,EAAI6gC,GAAgB7gC,EAAI,GAAG,EAC3B80B,EAAI+L,GAAgB/L,EAAI,GAAG,EAC3Bpb,EAAImnB,GAAgBnnB,EAAI,GAAG,EAE3B,KAAM,CAAE,WAAAsnB,EAAY,WAAAlC,EAAY,YAAAC,EAAa,GAAAG,EAAI,GAAAC,EAAI,GAAAC,EAAI,GAAAE,EAAI,GAAAC,EAAI,GAAAC,CAAE,EAC/DH,GAEJ,IAAItyB,EAAI/M,EAAIghC,EAAW,IAAMlM,EAAIkM,EAAW,IAAMtnB,EAAIsnB,EAAW,IAC7Dh0B,EAAIhN,EAAIghC,EAAW,IAAMlM,EAAIkM,EAAW,IAAMtnB,EAAIsnB,EAAW,IAC7DnC,EAAI7+B,EAAIghC,EAAW,IAAMlM,EAAIkM,EAAW,IAAMtnB,EAAIsnB,EAAW,IAEjE,MAAMvB,EAAKP,EAAKJ,EAAW,IAAMK,EAAKL,EAAW,IAAMM,EAAKN,EAAW,IACjEY,EAAKR,EAAKJ,EAAW,IAAMK,EAAKL,EAAW,IAAMM,EAAKN,EAAW,IACjEa,EAAKT,EAAKJ,EAAW,IAAMK,EAAKL,EAAW,IAAMM,EAAKN,EAAW,IAEvE,IAAIsB,EAAIrzB,EAAI+xB,EAAW,IAAM9xB,EAAI8xB,EAAW,IAAMD,EAAIC,EAAW,IAC7DuB,EAAItzB,EAAI+xB,EAAW,IAAM9xB,EAAI8xB,EAAW,IAAMD,EAAIC,EAAW,IAC7DwB,EAAIvzB,EAAI+xB,EAAW,IAAM9xB,EAAI8xB,EAAW,IAAMD,EAAIC,EAAW,IAEjE,OAAAsB,GAAKX,EAAKH,EACVe,GAAKX,EAAKH,EACVe,GAAKX,EAAKH,EAEVzyB,EAAIqzB,EAAIrB,EAAY,IAAMsB,EAAItB,EAAY,IAAMuB,EAAIvB,EAAY,IAChE/xB,EAAIozB,EAAIrB,EAAY,IAAMsB,EAAItB,EAAY,IAAMuB,EAAIvB,EAAY,IAChEF,EAAIuB,EAAIrB,EAAY,IAAMsB,EAAItB,EAAY,IAAMuB,EAAIvB,EAAY,IAEzD,CAAChyB,EAAGC,EAAG6xB,CAAC,CACnB,EC3DMoC,GAAY,IAAI5mC,IAAS,CAC3B,KAAM,CAAC2F,EAAG80B,EAAGpb,EAAG,GAAGiiB,CAAI,EAAI8B,GAAOpjC,EAAM,KAAK,EACvC6mC,EAAMH,GAAQ/gC,EAAG80B,EAAGpb,CAAC,EAE3B,MAAO,CAAC,GADMynB,GAAaD,CAAG,EACZ,GAAIvF,EAAK,OAAS,GAAKA,EAAK,CAAC,EAAI,EAAI,CAACA,EAAK,CAAC,CAAC,EAAI,EAAG,CAC1E,EAGA,SAASwF,GAAaC,EAAK,CAEvB,MAAMC,EAAW,CACb,CAAC,iBAAmB,kBAAoB,kBAAmB,EAC3D,CAAC,kBAAoB,kBAAoB,iBAAkB,EAC3D,CAAC,kBAAoB,kBAAoB,iBAAkB,CACnE,EACUC,EAAa,CACf,CAAC,iBAAmB,kBAAoB,kBAAmB,EAC3D,CAAC,mBAAoB,kBAAqB,gBAAiB,EAC3D,CAAC,kBAAoB,kBAAoB,kBAAmB,CACpE,EAEUC,EAAMtD,GAAiBoD,EAAUD,CAAG,EAI1C,OAAOnD,GACHqD,EACAC,EAAI,IAAKloB,GAAM,KAAK,KAAKA,CAAC,CAAC,CACnC,CAEA,CCjCA,KAAM,CAAE,IAAAmoB,GAAK,IAAAC,EAAG,EAAK,KAEfC,GAAU,IAAIrnC,IAAS,CAQzB,GAAI,CAACuwB,EAAGvR,EAAGsoB,CAAC,EAAIlE,GAAOpjC,EAAM,KAAK,EAClC,OAAI,MAAMsnC,CAAC,IAAGA,EAAI,GAClBA,EAAIA,EAAI5D,GACD,CAACnT,EAAG6W,GAAIE,CAAC,EAAItoB,EAAGmoB,GAAIG,CAAC,EAAItoB,CAAC,CACrC,ECXMuoB,GAAY,IAAIvnC,IAAS,CAC3BA,EAAOojC,GAAOpjC,EAAM,KAAK,EACzB,KAAM,CAACuwB,EAAGvR,EAAGsoB,EAAG,GAAGhG,CAAI,EAAIthC,EACrB,CAAC8lC,EAAG/vB,EAAGowB,CAAE,EAAIkB,GAAQ9W,EAAGvR,EAAGsoB,CAAC,EAC5B,CAAC,EAAG7M,EAAGpb,CAAC,EAAIwmB,GAAUC,EAAG/vB,EAAGowB,CAAE,EACpC,MAAO,CAAC,EAAG1L,EAAGpb,EAAG,GAAIiiB,EAAK,OAAS,GAAKA,EAAK,CAAC,EAAI,EAAI,CAACA,EAAK,CAAC,CAAC,EAAI,EAAG,CACzE,ECTM,CAAE,KAAAkG,GAAM,MAAAC,GAAO,MAAAC,EAAK,EAAK,KAEzBC,GAAU,IAAI3nC,IAAS,CACzB,KAAM,CAACuwB,EAAGxa,EAAGsJ,CAAC,EAAI+jB,GAAOpjC,EAAM,KAAK,EAC9Bgf,EAAIwoB,GAAKzxB,EAAIA,EAAIsJ,EAAIA,CAAC,EAC5B,IAAIioB,GAAKG,GAAMpoB,EAAGtJ,CAAC,EAAI4tB,GAAU,KAAO,IACxC,OAAI+D,GAAM1oB,EAAI,GAAK,IAAM,IAAGsoB,EAAI,OAAO,KAChC,CAAC/W,EAAGvR,EAAGsoB,CAAC,CACnB,ECLMM,GAAY,IAAI5nC,IAAS,CAC3B,KAAM,CAAC2F,EAAG80B,EAAGpb,EAAG,GAAGiiB,CAAI,EAAI8B,GAAOpjC,EAAM,KAAK,EACvC,CAACuwB,EAAGxa,EAAGowB,CAAE,EAAIS,GAAUjhC,EAAG80B,EAAGpb,CAAC,EAC9B,CAACymB,EAAG9mB,EAAGsoB,CAAC,EAAIK,GAAQpX,EAAGxa,EAAGowB,CAAE,EAClC,MAAO,CAACL,EAAG9mB,EAAGsoB,EAAG,GAAIhG,EAAK,OAAS,GAAKA,EAAK,CAAC,EAAI,EAAI,CAACA,EAAK,CAAC,CAAC,EAAI,EAAG,CACzE,sZCeM,CAAE/e,uBAAwBC,EAAgB,EAAItJ,GAEpD,SAAS2uB,GAAW,CAClBpb,mBACAqb,WACApkC,WACA8a,OACA+L,QAAQ,EACRvf,UAAUA,IAAM,CAAC,CACnB,EAAG,CACD,KAAM,CAAEhI,KAAGC,KACL,CAAC+nB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C2kC,EAAc5lC,EAAO,IAAI,EAEzB,CAAC6lC,EAAcC,CAAe,EAAI7kC,EAASmnB,CAAK,EAChD2d,EAAoB/lC,EAAO,IAAI,EACrCgmC,GAAgB,IAAM,CACpBD,EAAkB7lC,SAAS+lC,gBAY7B,EAAG,EAAE,EACL,MAAMC,EAAelmC,EAAO2lC,CAAQ,EACpC1lC,EAAU,IAAM,CACd,MAAMkmC,EAAa/d,EAAQwd,EAAY1lC,QAAQkmC,YACzCC,EAAoBH,EAAahmC,UAAYylC,EAC/CU,MAAgCnmC,QAAUylC,GAC9CC,EAAY1lC,QAAQ2mB,QACpB+e,EAAY1lC,QAAQomC,SAAS,CAC3Bh0B,KAAM6zB,GAAcI,KAAU,GAAK,GACnCjb,SAAU+a,EAAoB,OAAS,SACxC,CACH,EAAG,CAACje,EAAOud,CAAQ,CAAC,EAEpB,KAAM,CAACa,EAAcC,CAAe,EAAIxlC,EAAS,EAAI,EAErDhB,EAAU,IAAM,CACd,IAAIymC,EAAe5nC,GAAM,CACvB+J,EAAQ/J,EAAG+mC,EAAcvb,EAAkBsb,CAAW,CACxD,EACA,OAAIA,EAAY1lC,SACd0lC,EAAY1lC,QAAQK,iBAAiB,cAAemmC,CAAW,EAE1D,IAAM,CACPd,EAAY1lC,SACd0lC,EAAY1lC,QAAQymC,oBAAoB,cAAeD,CAAW,CAEtE,CACF,EAAG,CAACb,EAAcvb,CAAgB,CAAC,EAEnCrmB,GACE,MACCnF,GAAM,CACL+J,EAAQ/J,EAAG+mC,EAAcvb,EAAkBsb,CAAW,CACxD,EACA,CACEj/B,gBAAkB7H,GACC,CAAC,CAACd,SAAS4I,cAAc,sBAAsB,GAC7C9H,EAAE+H,SAAW/H,EAAEgI,SAAWhI,EAAEiI,QAAUjI,EAAEyH,SAE7DG,OAAQ,IAEV,CAACmC,EAASg9B,EAAcvb,CAAgB,CAC1C,EAEArqB,EAAU,IAAM,CACd,IAAI2mC,EAAeA,IAAM,CACvB,KAAM,CAAER,cAAaD,cAAeP,EAAY1lC,QAC1CkoB,EAAQoC,KAAK+a,MAAM/a,KAAKqc,IAAIV,CAAU,EAAIC,CAAW,EAC3DN,EAAgB1d,CAAK,CACvB,EACA,OAAIwd,EAAY1lC,SACd0lC,EAAY1lC,QAAQK,iBAAiB,SAAUqmC,EAAc,CAC3DE,QAAS,GACV,EAEI,IAAM,CACPlB,EAAY1lC,SACd0lC,EAAY1lC,QAAQymC,oBAAoB,SAAUC,CAAY,CAElE,CACF,EAAG,EAAE,EAEL3mC,EAAU,IAAM,CACd,IAAIwmB,EAAQrlB,WAAW,IAAM,CAC3BwkC,EAAY1lC,SAAS2mB,SACvB,EAAG,GAAG,EACN,MAAO,IAAM1lB,aAAaslB,CAAK,CACjC,EAAG,EAAE,EAEL,MAAMsgB,EAAgB5qB,GAAQ,IACrBmO,GAAkBjgB,IAAK28B,GAAU,CACtC,KAAM,CAAEC,YAAaD,EACrB,GAAIC,EAAU,CACZ,MAAMC,EAAeC,GAAwBF,CAAQ,EACrD,OAAOxB,GAAUyB,CAAY,CAC/B,CACA,OAAO,IACT,CAAC,EACA,CAAC5c,CAAgB,CAAC,EACf8c,EAAoBjrB,GAAQ,IACzB4qB,GAAe18B,IAAKg9B,GACrBA,EACK,CACLC,MAAOlC,GAAU,CAAC,IAAM,IAAMiC,EAAQ,CAAC,CAAC,CAAC,EACzCE,KAAMnC,GAAU,CAAC,IAAM,IAAMiC,EAAQ,CAAC,CAAC,CAAC,EACxCG,QAASpC,GAAU,CAAC,GAAKiC,EAAQ,CAAC,EAAGA,EAAQ,CAAC,CAAC,CAAC,GAG7C,IACR,CACF,EACKI,EAAuBtrB,GAAQ,IAAM,CAEzC,MAAMurB,EAAQ,IAAMN,EAAkB/kC,OAChCg2B,EAAS+O,EAAkB/8B,IAAI,CAACouB,EAAO/oB,IAAM,CACjD,MAAMoC,EAAQpC,EAAIg4B,EAAQ3+B,EACpBgJ,GAAOrC,EAAI,GAAKg4B,EAAQ3+B,EAC9B,OAAI0vB,GAAO6O,OAAS7O,GAAO8O,KAClB,CACLD,MAAO;AAAA,sBACK7O,EAAM6O,OAAOzyB,KAAK,GAAG,CAAC,KAAK/C,CAAK;AAAA,sBAChC2mB,EAAM6O,OAAOzyB,KAAK,GAAG,CAAC,KAAK9C,CAAG;AAAA,gBAE1Cw1B,KAAM;AAAA,sBACM9O,EAAM8O,MAAM1yB,KAAK,GAAG,CAAC,KAAK/C,CAAK;AAAA,sBAC/B2mB,EAAM8O,MAAM1yB,KAAK,GAAG,CAAC,KAAK9C,CAAG;AAAA,iBAKtC,CACLu1B,MAAO;AAAA,4BACax1B,CAAK;AAAA,4BACLC,CAAG;AAAA,cAEvBw1B,KAAM;AAAA,4BACcz1B,CAAK;AAAA,4BACLC,CAAG;AAAA,cAG3B,CAAC,EACK41B,EAAgBtP,EAAOhuB,IAAKouB,GAAUA,EAAM6O,KAAK,EAAEzyB,KAAK,IAAI,EAC5D+yB,EAAevP,EAAOhuB,IAAKouB,GAAUA,EAAM8O,IAAI,EAAE1yB,KAAK,IAAI,EAChE,MAAO,CACLyyB,MAAOK,EACPJ,KAAMK,EAEV,EAAG,CAACR,CAAiB,CAAC,EAEtB,IAAIS,EAAW7nC,EAAO,IAAI,EAC1BC,SAAU,IACD,IAAM,CACX4nC,EAAS3nC,SAAS4nC,aACpB,EACC,EAAE,EAEL9B,GAAgB,IAAM,CACpB,MAAM+B,EAAeX,EAAkBvB,CAAY,EACnD,IAAImC,EACAC,EACJ,GAAIF,EAAc,CAChB,MAAM/lB,EAAQxG,GAAM+B,MAAM7B,IAAI,OAAO,EACrC,GAAIsG,EAAO,CACT,MAAMkmB,EAAa,OAAOH,EAAa/lB,CAAK,EAAEnN,KAAK,GAAG,CAAC,IACvDvU,EAAQma,SAAI,uEAAEytB,IAAYD,EAAAD,EAAA,QAC1BA,EAAQhqC,UAINiqC,MACAD,QAAgBE,yEAClBA,EAAA,OAAAH,EAAAI,CAAA,eACFH,EAAO,2DAAAG,CAAA,MACLH,IAIAC,IAAmB,QACnB3nC,EAAQma,QAAIytB,EAAEA,CACdF,CAGA,UAAIA,CACFC,OACAD,UAAMI,EACR,CACF,EACF,CAAAvC,EAAAuB,CAAA,GACA1/B,EAAO,MAAM,CAEX,iDAAwB4iB,GAAA,SACtB0d,SAAMI,SAAUH,CAClB,IAAArC,EACF,aACEC,uBAAcuB,KAElB,iBAEIj/B,QAAOrJ,GAAA,EAAsE8I,SAE7E,qCAAA9I,EAAA,oCAAAA,EAAA,0CACEgJ,EAAK89B,QAEL,EACAz9B,MAAMmiB,EAAA,UACNtiB,qBAAgB,QACd,0BACqBqgC,SAInBx/B,yBAAWg9B,GAAgCD,IAE/C,EACAr8B,GAEM,SACE++B,GAAsB,KAAAtB,EAAAt3B,IAAA,CACtB,UAA2B+3B,WAAsBH,UACjD,gBAAgDC,+BAIjD,wBAAAgB,EAAA,qBACN3gC,uBAEkByC,SAAkB,oBACnC,sBACEigB,SAAiBjoB,MAAe+kC,aAClC,uBACE,QAAAmB,EAAA,2BACEpgC,GACAoB,SACEg/B,IACI,UACoBxC,EAAmByB,KAAiB,+BAI/B,SAAOe,cAGN,CAMhCv8B,EAEAlE,SAAK4H,CAAMm2B,iBAAeE,WAAoB,CAC9C/9B,cAKE,MAAOkB,YACLu9B,UACF,aACFhlC,EAAA,kBAECulC,EAAEA,YAECj/B,MAAK,CAEL3H,EACA4H,SAASA,GAAM,QACbvG,MAAO+mC,YAAe,SACfxB,KAAMyB,GACXpsB,UACF,uBACF,KAAAA,EAAEzU,WAEIO,SAAM6+B,EAAA,aAAWp/B,CAAC,GAASC,EACjCA,GAAA,OAAAm/B,EAAY,aAAiB3qB,SAAgB,GACpCosB,IACF,KAGL,GAAA/gC,EAACs/B,aAAc0B,wBAAY,OAACrsB,YAAc,CAAAxU,EAAA,iBA9BrC5F,EA+BR,UAER,cAEHyF,MAAA,kBAAKS,QAAMrJ,GAAA+J,EAAA/J,EAAA+mC,EAAAvb,EAAAsb,CAAA,WAAiCY,KAAa5+B,KACvDC,IAAAD,MAGIO,IACUrJ,QAC8C,CAGnD,CAAM,EAAOkF,QAAE,SAAA6D,EAAA,uCAAOyiB,GAAA,KAAA0c,EAAAt3B,IAAA7H,EAAA,eAAC,SAAC,SAAE6H,IAAAm2B,EACzB,sBAAAn2B,IAAAm2B,EAAA,cAETvb,YACOniB,iBAAM,oBACTmiB,EAGGviB,MAAKuK,EAAAszB,EAAA,oBAAAl2B,GAAA62B,GAAA,UACK72B,QAAMm2B,QAChB19B,EAAO,iBAAsB09B,CAC7B79B,OACIE,iBACFpJ,EACA,EAEA8mC,cACAA,aAA6B,KAAEtzB,QAAMgZ,GAAU,EAAU,EAC3D0b,EAAA,OAAEp/B,WAEDU,IAAI,iBAAM,CAAAZ,EAAAoT,GAAA,UAAa,aAAQ,MAAG,SAAE,SAAC,IAbjCksB,gBAkBX,aAEFp/B,WACEF,EAACoT,SAAK,CACJ+X,cACA7oB,MAAM,kBACN2oB,SAAS9qB,EAAAS,EAAA,CACTS,KAAK,QACL4/B,MAEU5gC,CAAcI,GAAM,SACrB,CAAM,EAAWnE,YAAE,CAAA0D,EAAAiC,GAAA,MAAA1H,EAAA4jC,CAAA,cAAAvb,EAAAub,CAAA,aAAM,yBAAC,SAAC,MAAE7hC,EAErC4D,IAIG0iB,QACgChQ,CAE5B,EAENpP,SAAKlH,sBAAE6D,EAAA,iBAAAA,EAAAgC,EAAA,CAAmC,YAAC,EAACjC,EAEvC,GAACW,GAAK,GAAQ,IACnBV,KAAAH,EAAAiU,GAAA,IAAA/T,SACEiC,CAAA,WAAA87B,CAAA,0EAAAE,EAAA,eAAA5jC,yCAAA,SAAiC,CAAAyF,EAAA,QAAC,MAC7B,wBA4CN,CAAAG,EAAAgC,EAAA,CACI,GACP,QACK,GACC,GAAGtI,CAGC,CAER4G,KAAM,GAQNP,CAEA,GAAY,GAAA0iB,GACVziB,OAAAgC,GAAAnC,EAAA,2CAA4B,SACvB,CAETG,EAAA,eACD,SACI,wBAERyiB,WAAkBjoB,EACZ8F,QAAMrJ,GAAA,kBAA6B0nC,EAAa5+B,kBACnD,EACEG,EAAK,gBACLI,EAAM,uBACE09B,UAAiB,aAAAA,EAAA,IAAAU,GAAA,QACzBv+B,SAAUlJ,QACRA,EACAA,EACA8mC,cACAA,kBAA6B,IAC3BtzB,EAKD,CACH,YAEK,CAAM,EAAgBtO,oBAAE,eAAA/B,kBAAA,OAAU4jC,IAAAvb,EAAA,iBAACxrB,GAAA,CAAGA,EAAA,iBAE7C+I,kBAAA,EACEE,EAAK,gBACLI,EAAM,kBACN/H,KAAQylC,UAAiBvb,aAAiBjoB,EAAS,IAAAkkC,GAAA,QACnDv+B,SAAUlJ,QACRA,EACAA,EACA8mC,cACAA,mBAA6B,IAC3BtzB,EAKD,CACH,YAEK,CAAM,EAAiBtO,MAAE,GC/d1C,SAAwB4kC,GAAc,CAAEtuB,MAAKuuB,WAAUhgC,SAAQ,EAAG,CAChE,KAAM,CAAEhI,KAAGC,KACX,GAAI,CAACwZ,EAAK,OAAO,KAEjB,IAAIwuB,EAAaxuB,EACjB,GAAI,CACF,MAAMsZ,EAASgH,IAAIv0B,MAAMiU,CAAG,EACtByuB,EAAWnV,EAAOmV,SAClB5xB,EAAWyc,EAAOzc,SAClBgoB,EAAO7kB,EAAIjG,MAAMuf,EAAOvc,OAAOhV,MAAM,EAC3CymC,EACEphC,EAAAC,EAAA,CAAAC,SAAA,CACGmhC,EAAS,KAAElhC,EAAA,UAAAD,SAASuP,EAAiB,EACrCgoB,CAAI,EACL,CAEN,MAAY,CAAC,CAEb,MAAM6J,EAAaA,IAAM,CACvB,GAAI,CACF5qB,UAAU6qB,UAAUC,UAAU5uB,CAAG,EACjCpW,GAASF,EAAC,CAAA/B,GAAA,SAAa,CAAC,CAC1B,MAAY,CACV3B,KACS0D,CAAC,cAAqB,CAAC,EAEpCmlC,EAAA,KAEA,GAAMA,iBAAcA,UAAM,UACxB,IAAA7uB,CAA0C,GAAO,GAAG,CAClD,UAAI,OACF8D,KAAgB,EAAE9D,MAAK,EAEvBha,EAAe,OACjBoH,EAAA,OACF,0BACF,qBAEA,cACOS,SAAM,GAAAU,GAAAhB,EAAA,UAAoB5F,KAAG,SAAkB+J,4BACjDnD,EACSd,SAAKF,EAAAS,EAAA,CAASH,KAAM,IAAcH,MAClCO,CAASE,GAAGzE,UAAE,KAAA6D,EAAO,gBAAC,cAAC,SAAEA,EAAA,MAGnCA,WAAAgC,EAAA,CAAQ1B,GAAM,SAAaP,CACzB,EACE,GAAAF,EAAA,iBAAwB,GAAAmhC,GAAAnhC,EAAAC,EAAA,CACtB,UAAAD,EAAA,KAENA,MAAA,qBACKmhC,MACDjhC,mBACKO,KAAM,KAAWP,OACjBU,CAAI,GAACC,QAAK,OAAcC,QAAS,SAAKqgC,IAAQ,CAEjDhhC,KAAA,aAAKM,CAAM,EAAOP,CACX,GAAAC,EAACU,IAAK,OAAc,WAAC,SACtBugC,CAAA,CACN,EAEJ,GAAG3gC,WAAM,UAAUP,GAAEkhC,UAAe,cAEtCphC,MAAA,QAAAE,QACEC,EAAQE,SAAKF,EAAAgC,EAAA,CAAS1B,WAAM,CAAQH,CAASa,GAAQjB,SACnDiC,CAAA,iBAAoBhC,EAAA,UACd,KACRA,SAAMM,MAAM,SAAU,QACtB6gC,EAAQjhC,SAAKF,EAAAS,EAAA,CAASH,KAAM,OAASH,MAC7BO,CAAYE,GAAGzE,UAAE,eAAM,kCAAAsW,CAAC,IAAGzS,EAAA,UAC3B,KACPuW,SAA2C9D,eAAK,QAC/C6uB,EAAQphC,SAAKF,EAAAS,EAAA,CAASH,KAAM,QAASH,MAC7BO,CAAaE,GAAGzE,UAAE,KAAA6D,EAAQ,WAAC,SAAC,KAAEyS,EAC9B,OAEV,SACEnS,0BACA6S,QAAMV,EACNpR,SAAOrB,EAAAgC,EAAA,CACPiZ,GAAI,SACJ9a,CAASa,EAAQjB,CAEjB,KAAkB,CC1D5B,MAAMwhC,GAAU,CAAE,QAAS,GAAI,MAAO,EAAE,EACxC,SAASC,GAAa,EAAG,CACrB,GAAI,CAAC,OAAO,cAAc,CAAC,EACvB,MAAM,IAAI,MAAM,qBAAqB,CAAC,EAAE,CAChD,CACA,SAASC,GAAgBC,EAAK,CAC1B,GAAI,CAAC,OAAO,cAAcA,CAAG,GAAKA,EAAM,GAAKA,EAAM,GAC/C,MAAM,IAAI,MAAM,mBAAmBA,CAAG,2BAA2B,CACzE,CACA,SAASC,GAAIr1B,EAAKs1B,EAAK,CACnB,OAAOt1B,EAAI,SAAS,CAAC,EAAE,SAASs1B,EAAK,GAAG,CAC5C,CACA,SAASC,GAAI91B,EAAGsJ,EAAG,CACf,MAAMsd,EAAS5mB,EAAIsJ,EACnB,OAAOsd,GAAU,EAAIA,EAAStd,EAAIsd,CACtC,CACA,SAASmP,GAAQtnC,EAAQunC,EAAK,CAC1B,OAAO,IAAI,MAAMvnC,CAAM,EAAE,KAAKunC,CAAG,CACrC,CAMA,SAASC,MAAmBC,EAAQ,CAChC,IAAIt0B,EAAM,EACV,UAAW0H,KAAK4sB,EACZt0B,EAAM,KAAK,IAAIA,EAAK0H,EAAE,MAAM,EAChC,MAAM/G,EAAM,GACZ,QAASzG,EAAI,EAAGA,EAAI8F,EAAK9F,IACrB,UAAWwN,KAAK4sB,EACRp6B,GAAKwN,EAAE,QAEX/G,EAAI,KAAK+G,EAAExN,CAAC,CAAC,EAGrB,OAAO,IAAI,WAAWyG,CAAG,CAC7B,CACA,SAAS4zB,GAAWC,EAAKC,EAAS7hB,EAAO,CACrC,GAAIA,EAAQ,GAAKA,EAAQ6hB,EAAQ,OAASD,EAAI,OAC1C,MAAO,GACX,QAASt6B,EAAI,EAAGA,EAAIu6B,EAAQ,OAAQv6B,IAChC,GAAIu6B,EAAQv6B,CAAC,IAAMs6B,EAAI5hB,EAAQ1Y,CAAC,EAC5B,MAAO,GACf,MAAO,EACX,CAEA,SAASw6B,IAAO,CACZ,IAAIA,EACAC,EAAY,IAChB,MAAO,CACH,IAAIC,EAAOjoC,EAAO,CACVioC,GAASD,IAEbD,EAAO/nC,EACPgoC,EAAYC,EAChB,EACA,IAAK,IAAMF,EACX,MAAO,IAAMC,CACrB,CACA,CAEA,SAASE,GAASA,EAAU,CACxB,MAAO,CACH,IAAMC,GAASD,EAAS,SAASC,CAAI,EACrC,OAASC,GAAU,CACf,GAAI,CAAC,MAAM,QAAQA,CAAK,GAAMA,EAAM,QAAU,OAAOA,EAAM,CAAC,GAAM,SAC9D,MAAM,IAAI,MAAM,kDAAkD,EACtE,OAAOA,EAAM,IAAKC,GAAW,CACzB,GAAI,OAAOA,GAAW,SAClB,MAAM,IAAI,MAAM,uCAAuCA,CAAM,EAAE,EACnE,MAAMpiB,EAAQiiB,EAAS,QAAQG,CAAM,EACrC,GAAIpiB,IAAU,GACV,MAAM,IAAI,MAAM,oBAAoBoiB,CAAM,eAAeH,CAAQ,EAAE,EACvE,OAAOjiB,CACX,CAAC,CACL,EACA,OAASqiB,GAAW,CAChB,GAAI,CAAC,MAAM,QAAQA,CAAM,GAAMA,EAAO,QAAU,OAAOA,EAAO,CAAC,GAAM,SACjE,MAAM,IAAI,MAAM,qDAAqD,EACzE,OAAOA,EAAO,IAAK/6B,GAAM,CAErB,GADA25B,GAAa35B,CAAC,EACVA,EAAI,GAAKA,GAAK26B,EAAS,OACvB,MAAM,IAAI,MAAM,iCAAiC36B,CAAC,eAAe26B,EAAS,MAAM,GAAG,EACvF,OAAOA,EAAS36B,CAAC,CACrB,CAAC,CACL,CACR,CACA,CACO,MAAMg7B,EAAO,CAChB,OAAO,KAAKliC,EAAMzG,EAAO,CAGrB,GAFI,OAAOyG,GAAS,WAChBA,EAAO,CAAE,OAAQA,EAAM,MAAOA,CAAI,GAClC,CAAC,OAAO,cAAcA,EAAK,MAAM,GAAKA,EAAK,SAAW,IACtD,MAAM,IAAI,MAAM,0BAA0BA,EAAK,MAAM,KAAK,OAAOA,EAAK,MAAM,GAAG,EACnF,GAAI,CAAC,OAAO,cAAcA,EAAK,KAAK,GAAKA,EAAK,QAAU,IACpD,MAAM,IAAI,MAAM,yBAAyBA,EAAK,KAAK,KAAK,OAAOA,EAAK,KAAK,GAAG,EAChF,OAAIzG,IAAU,SAEVyG,EAAO,CACH,MAAO,KAAK,IAAIA,EAAK,MAAOzG,EAAM,KAAK,EACvC,OAAQ,KAAK,IAAIyG,EAAK,OAAQzG,EAAM,MAAM,CAC1D,GAEeyG,CACX,CACA,OAAO,WAAWmiC,EAAG,CAEjBA,EAAIA,EAAE,QAAQ,QAAS,EAAE,EAAE,QAAQ,QAAS,EAAE,EAC9C,MAAMC,EAAQD,EAAE,MAAM,OAAO,aAAavB,GAAQ,OAAO,CAAC,EACpD52B,EAASo4B,EAAM,OACf51B,EAAO,IAAI,MAAMxC,CAAM,EAC7B,IAAID,EACJ,UAAWs4B,KAAQD,EAAO,CACtB,MAAM9I,EAAM+I,EAAK,MAAM,EAAE,EAAE,IAAKn7B,GAAM,CAClC,GAAIA,IAAM,IACN,MAAO,GACX,GAAIA,IAAM,IACN,MAAO,GACX,GAAIA,IAAM,IAEV,MAAM,IAAI,MAAM,qCAAqCA,CAAC,EAAE,CAC5D,CAAC,EACD,GAAI6C,GAASuvB,EAAI,SAAWvvB,EACxB,MAAM,IAAI,MAAM,gDAAgDA,CAAK,QAAQuvB,EAAI,MAAM,EAAE,EAC7FvvB,EAAQuvB,EAAI,OACZ9sB,EAAK,KAAK8sB,CAAG,CACjB,CACA,OAAKvvB,IACDA,EAAQ,GACL,IAAIm4B,GAAO,CAAE,OAAAl4B,EAAQ,MAAAD,CAAK,EAAIyC,CAAI,CAC7C,CACA,KACA,OACA,MACA,YAAYxM,EAAMwM,EAAM,CACpB,KAAM,CAAE,OAAAxC,EAAQ,MAAAD,CAAK,EAAKm4B,GAAO,KAAKliC,CAAI,EAC1C,KAAK,KAAOwM,GAAQ,MAAM,KAAK,CAAE,OAAQxC,CAAM,EAAI,IAAMm3B,GAAQp3B,EAAO,MAAS,CAAC,EAClF,KAAK,OAASC,EACd,KAAK,MAAQD,CACjB,CACA,MAAMjC,EAAG,CACL,OAAO,KAAK,KAAKA,EAAE,CAAC,EAAEA,EAAE,CAAC,CAC7B,CACA,SAASA,EAAG,CACR,MAAO,IAAKA,EAAE,GAAKA,EAAE,EAAI,KAAK,OAAS,GAAKA,EAAE,GAAKA,EAAE,EAAI,KAAK,MAClE,CACA,KAAKw6B,EAAQ,CACT,GAAI,CAACA,EACD,MAAO,CAAE,OAAQ,KAAK,OAAQ,MAAO,KAAK,KAAK,EACnD,KAAM,CAAE,EAAAv6B,EAAG,EAAAC,CAAC,EAAK,KAAK,GAAGs6B,CAAM,EAC/B,MAAO,CAAE,OAAQ,KAAK,OAASt6B,EAAG,MAAO,KAAK,MAAQD,CAAC,CAC3D,CACA,GAAGsM,EAAG,CAGF,GAFI,OAAOA,GAAM,WACbA,EAAI,CAAE,EAAGA,EAAG,EAAGA,CAAC,GAChB,CAAC,OAAO,cAAcA,EAAE,CAAC,EACzB,MAAM,IAAI,MAAM,qBAAqBA,EAAE,CAAC,EAAE,EAC9C,GAAI,CAAC,OAAO,cAAcA,EAAE,CAAC,EACzB,MAAM,IAAI,MAAM,qBAAqBA,EAAE,CAAC,EAAE,EAE9C,OAAAA,EAAE,EAAI6sB,GAAI7sB,EAAE,EAAG,KAAK,KAAK,EACzBA,EAAE,EAAI6sB,GAAI7sB,EAAE,EAAG,KAAK,MAAM,EACnBA,CACX,CAEA,KAAKA,EAAGrU,EAAMrG,EAAO,CACjB,KAAM,CAAE,EAAAoO,EAAG,EAAAC,CAAC,EAAK,KAAK,GAAGqM,CAAC,EACpB,CAAE,OAAArK,EAAQ,MAAAD,CAAK,EAAKm4B,GAAO,KAAKliC,EAAM,KAAK,KAAK,CAAE,EAAA+H,EAAG,EAAAC,CAAC,CAAE,CAAC,EAC/D,QAASu6B,EAAO,EAAGA,EAAOv4B,EAAQu4B,IAC9B,QAASC,EAAO,EAAGA,EAAOz4B,EAAOy4B,IAE7B,KAAK,KAAKx6B,EAAIu6B,CAAI,EAAEx6B,EAAIy6B,CAAI,EACxB,OAAO7oC,GAAU,WACXA,EAAM,CAAE,EAAG6oC,EAAM,EAAGD,CAAI,EAAI,KAAK,KAAKv6B,EAAIu6B,CAAI,EAAEx6B,EAAIy6B,CAAI,CAAC,EACzD7oC,EAGlB,OAAO,IACX,CAEA,SAAS0a,EAAGrU,EAAMrL,EAAI,CAClB,OAAO,KAAK,KAAK0f,EAAGrU,EAAM,CAACqU,EAAGouB,KAC1B9tC,EAAG0f,EAAGouB,CAAG,EACFA,EACV,CACL,CAEA,MAAMpuB,EAAGrH,EAAKrT,EAAO,CACjB,OAAO,KAAK,KAAK0a,EAAG,CAAE,MAAOrH,EAAK,OAAQ,CAAC,EAAIrT,CAAK,CACxD,CACA,MAAM0a,EAAGrH,EAAKrT,EAAO,CACjB,OAAO,KAAK,KAAK0a,EAAG,CAAE,MAAO,EAAG,OAAQrH,CAAG,EAAIrT,CAAK,CACxD,CAEA,OAAO+oC,EAAS,EAAG/oC,EAAO,CACtB,MAAMqQ,EAAS,KAAK,OAAS,EAAI04B,EAC3B34B,EAAQ,KAAK,MAAQ,EAAI24B,EACzBn1B,EAAI4zB,GAAQuB,EAAQ/oC,CAAK,EACzB,EAAI,MAAM,KAAK,CAAE,OAAQ+oC,CAAM,EAAI,IAAMvB,GAAQp3B,EAAOpQ,CAAK,CAAC,EACpE,OAAO,IAAIuoC,GAAO,CAAE,OAAAl4B,EAAQ,MAAAD,CAAK,EAAI,CAAC,GAAG,EAAG,GAAG,KAAK,KAAK,IAAK7C,GAAM,CAAC,GAAGqG,EAAG,GAAGrG,EAAG,GAAGqG,CAAC,CAAC,EAAG,GAAG,CAAC,CAAC,CAClG,CAEA,MAAM8G,EAAGsuB,EAAI,CACT,OAAO,KAAK,KAAKtuB,EAAGsuB,EAAG,KAAI,EAAI,CAAC,CAAE,EAAA56B,EAAG,EAAAC,CAAC,IAAO26B,EAAG,KAAK36B,CAAC,EAAED,CAAC,CAAC,CAC9D,CAEA,UAAUsM,EAAGrU,EAAO,KAAK,KAAI,EAAI,CAC7B,MAAMsF,EAAO,IAAI48B,GAAOA,GAAO,KAAKliC,EAAM,KAAK,KAAK,KAAK,GAAGqU,CAAC,CAAC,CAAC,CAAC,EAChE,YAAK,KAAKA,EAAGrU,EAAM,CAAC,CAAE,EAAA+H,EAAG,EAAAC,CAAC,EAAIy6B,IAASn9B,EAAK,KAAK0C,CAAC,EAAED,CAAC,EAAI06B,CAAI,EACtDn9B,CACX,CAEA,SAAU,CACN,KAAM,CAAE,OAAA0E,EAAQ,MAAAD,CAAK,EAAK,KAE1B,OADY,IAAIm4B,GAAO,CAAE,OAAQn4B,EAAO,MAAOC,EAAQ,EAC5C,KAAK,CAAE,EAAG,EAAG,EAAG,GAAK,IAAU,CAAC,CAAE,EAAAjC,EAAG,EAAAC,KAAQ,KAAK,KAAKD,CAAC,EAAEC,CAAC,CAAC,CAC3E,CAEA,MAAM46B,EAAQ,CACV,GAAI,CAAC,OAAO,cAAcA,CAAM,GAAKA,EAAS,KAC1C,MAAM,IAAI,MAAM,yBAAyBA,CAAM,EAAE,EACrD,KAAM,CAAE,OAAA54B,EAAQ,MAAAD,CAAK,EAAK,KAE1B,OADY,IAAIm4B,GAAO,CAAE,OAAQU,EAAS54B,EAAQ,MAAO44B,EAAS74B,EAAO,EAC9D,KAAK,CAAE,EAAG,EAAG,EAAG,GAAK,IAAU,CAAC,CAAE,EAAAhC,EAAG,EAAAC,CAAC,IAAO,KAAK,KAAK,KAAK,MAAMA,EAAI46B,CAAM,CAAC,EAAE,KAAK,MAAM76B,EAAI66B,CAAM,CAAC,CAAC,CACrH,CACA,OAAQ,CAEJ,OADY,IAAIV,GAAO,KAAK,KAAI,CAAE,EACvB,KAAK,CAAE,EAAG,EAAG,EAAG,CAAC,EAAI,KAAK,KAAI,EAAI,CAAC,CAAE,EAAAn6B,EAAG,EAAAC,KAAQ,KAAK,KAAKA,CAAC,EAAED,CAAC,CAAC,CAC9E,CAEA,aAAc,CACV,KAAK,SAAS,EAAG,IAAU,CAACoJ,EAAGsxB,IAAQ,CACnC,GAAI,OAAOA,GAAQ,UACf,MAAM,IAAI,MAAM,sBAAsB,OAAOA,CAAG,EAAE,CAC1D,CAAC,CACL,CAEA,UAAW,CACP,OAAO,KAAK,KACP,IAAK,GAAM,EAAE,IAAK7N,GAAOA,IAAM,OAAY,IAAMA,EAAI,IAAM,GAAI,EAAE,KAAK,EAAE,CAAC,EACzE,KAAK,OAAO,aAAagM,GAAQ,OAAO,CAAC,CAClD,CACA,SAAU,CACN,KAAM,CAAE,OAAA52B,EAAQ,MAAAD,EAAO,KAAAyC,CAAI,EAAK,KAChC,IAAIq2B,EAAM,GAGV,QAAS76B,EAAI,EAAGA,EAAIgC,EAAQhC,GAAK,EAAG,CAChC,QAASD,EAAI,EAAGA,EAAIgC,EAAOhC,IAAK,CAC5B,MAAM+6B,EAAQt2B,EAAKxE,CAAC,EAAED,CAAC,EACjBg7B,EAAS/6B,EAAI,GAAKgC,EAAS,GAAOwC,EAAKxE,EAAI,CAAC,EAAED,CAAC,EACjD,CAAC+6B,GAAS,CAACC,EACXF,GAAO,IACF,CAACC,GAASC,EACfF,GAAO,IACFC,GAAS,CAACC,EACfF,GAAO,IACFC,GAASC,IACdF,GAAO,IACf,CACAA,GAAO,OAAO,aAAajC,GAAQ,OAAO,CAC9C,CACA,OAAOiC,CACX,CACA,QAAS,CACL,MAAMG,EAAK,OAAO,aAAapC,GAAQ,KAAK,EACtCqC,EAAQD,EAAK,MACbE,EAAUF,EAAK,WAAaC,EAC5BE,EAASH,EAAK,SAAWC,EAC/B,OAAO,KAAK,KACP,IAAK/7B,GAAMA,EAAE,IAAK0tB,GAAOA,EAAIuO,EAASD,CAAQ,EAAE,KAAK,EAAE,CAAC,EACxD,KAAK,OAAO,aAAatC,GAAQ,OAAO,CAAC,CAClD,CACA,MAAMwC,EAAW,GAAM,CACnB,IAAIP,EAAM,qBAAqB,KAAK,KAAK,IAAI,KAAK,MAAM,wCAEpDQ,EAAW,GACXC,EACJ,YAAK,SAAS,EAAG,IAAU,CAACC,EAAOnC,IAAQ,CACvC,GAAI,CAACA,EACD,OACJ,KAAM,CAAE,EAAAr5B,EAAG,EAAAC,CAAC,EAAKu7B,EACjB,GAAI,CAACH,EAAU,CACXP,GAAO,YAAY96B,CAAC,QAAQC,CAAC,4BAC7B,MACJ,CAIA,IAAI8R,EAAI,IAAI/R,CAAC,IAAIC,CAAC,GAGlB,GAAIs7B,EAAW,CAEX,MAAME,EAAO,IAAIz7B,EAAIu7B,EAAU,CAAC,IAAIt7B,EAAIs7B,EAAU,CAAC,GAC/CE,EAAK,QAAU1pB,EAAE,SACjBA,EAAI0pB,EACZ,CAIA,MAAMC,EAAK17B,EAAI,GAAK,IAAIA,CAAC,GAAK,MAG9Bs7B,GAAY,GAAGvpB,CAAC,OAAO2pB,CAAE,IACzBH,EAAYC,CAChB,CAAC,EACGH,IACAP,GAAO,YAAYQ,CAAQ,OAC/BR,GAAO,SACAA,CACX,CACA,OAAQ,CAGJ,MAAMa,EAASx8B,GAAM,CAACA,EAAI,IAAOA,IAAM,EAAK,GAAI,EAC1Cy8B,EAAO,CAAC,GAAGD,EAAM,KAAK,KAAK,EAAG,GAAGA,EAAM,KAAK,MAAM,CAAC,EACnDl3B,EAAO,GACb,KAAK,SAAS,EAAG,IAAU,CAAC2E,EAAGsxB,IAAQj2B,EAAK,KAAK,EAAEi2B,IAAQ,GAAK,CAAC,EACjE,MAAMmB,EAAI,IAEJ92B,EAAQ,CACV,GAAM,GAAM,GAAM,GAAM,GAAM,GAAM,GAAG62B,EAAM,IAAM,EAAM,EAAM,IAAM,IAAM,IAC3E,GAAGxC,GAAQ,IAAS,CAAI,EAAG,GAAM,EAAM,EAAM,EAAM,EAAM,GAAGwC,EAAM,EAAM,CACpF,EACcE,EAAa,KAAK,MAAMr3B,EAAK,OAASo3B,CAAC,EAE7C,QAAS18B,EAAI,EAAGA,EAAI28B,EAAY38B,IAC5B4F,EAAM,KAAK82B,EAAI,EAAG,IAAM,GAAGp3B,EAAK,MAAMo3B,EAAI18B,EAAG08B,GAAK18B,EAAI,EAAE,EAAE,IAAKA,GAAM,CAACA,CAAC,CAAC,EAE5E,OAAA4F,EAAM,KAAMN,EAAK,OAASo3B,EAAK,EAAG,IAAM,GAAGp3B,EAAK,MAAMq3B,EAAaD,CAAC,EAAE,IAAK18B,GAAM,CAACA,CAAC,CAAC,EACpF4F,EAAM,KAAK,EAAM,IAAM,EAAM,EAAI,EAC1B,IAAI,WAAWA,CAAK,CAC/B,CACA,QAAQg3B,EAAQ,GAAO,CACnB,KAAM,CAAE,OAAA95B,EAAQ,MAAAD,GAAU,KAAK,KAAI,EAC7ByC,EAAO,IAAI,WAAWxC,EAASD,GAAS+5B,EAAQ,EAAI,EAAE,EAC5D,IAAI58B,EAAI,EACR,QAASc,EAAI,EAAGA,EAAIgC,EAAQhC,IACxB,QAASD,EAAI,EAAGA,EAAIgC,EAAOhC,IAAK,CAC5B,MAAMpO,EAAU,KAAK,KAAKqO,CAAC,EAAED,CAAC,EAAI,EAAI,IACtCyE,EAAKtF,GAAG,EAAIvN,EACZ6S,EAAKtF,GAAG,EAAIvN,EACZ6S,EAAKtF,GAAG,EAAIvN,EACPmqC,IACDt3B,EAAKtF,GAAG,EAAI,IACpB,CAEJ,MAAO,CAAE,OAAA8C,EAAQ,MAAAD,EAAO,KAAAyC,CAAI,CAChC,CACJ,CAIO,MAAMu3B,GAAS,CAAC,MAAO,SAAU,WAAY,MAAM,EAE7CC,GAAW,CAAC,UAAW,eAAgB,OAAQ,QAAS,KAAK,EAGpEC,GAAQ,CAEV,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAE5F,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,IACtH,EAEMC,GAAkB,CAEpB,IAAK,CAAC,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EACnK,OAAQ,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EACvK,SAAU,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EACzK,KAAM,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,CACzK,EAEMC,GAAa,CAEf,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAC7I,OAAQ,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EACzJ,SAAU,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAC9J,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,CAC/J,EACMlpC,GAAO,CACT,KAAM,CACF,OAAS8lC,GAAQ,GAAK,GAAKA,EAAM,GACjC,OAAS/gC,IAAUA,EAAO,IAAM,CACxC,EACI,SAAW+gC,GAAQ,KAAK,OAAOA,EAAM,GAAK,EAAE,EAE5C,kBAAkBA,EAAK,CACnB,GAAIA,IAAQ,EACR,MAAO,GACX,MAAM+B,EAAQ,EACRsB,EAAOnpC,GAAK,KAAK,OAAO8lC,CAAG,EAAI+B,EAAQ,EACvCuB,EAAWD,EAAOtB,EAClBwB,EAAQ,KAAK,KAAKD,EAAW,EAAE,EACrC,IAAIE,EAAW,KAAK,MAAMF,EAAWC,CAAK,EACtCC,EAAW,EACXA,GAAY,EACNF,EAAWC,EAAS,GAAKA,IAC/BC,GAAY,GAChB,MAAM52B,EAAM,CAACm1B,CAAK,EAClB,QAAShpB,EAAI,EAAGA,EAAIwqB,EAAOxqB,IACvBnM,EAAI,KAAKy2B,GAAQE,EAAQxqB,GAAKyqB,CAAQ,EAC1C,OAAA52B,EAAI,KAAKy2B,CAAI,EACNz2B,CACX,EACA,OAAQ,CACJ,IAAK,EACL,OAAQ,EACR,SAAU,EACV,KAAM,CACd,EACI,WAAY,MACZ,WAAW62B,EAAKC,EAAS,CACrB,MAAMj4B,EAAQvR,GAAK,OAAOupC,CAAG,GAAK,EAAKC,EACvC,IAAIt5B,EAAIqB,EACR,QAAStF,EAAI,EAAGA,EAAI,GAAIA,IACpBiE,EAAKA,GAAK,GAAOA,GAAK,GAAK,KAC/B,OAASqB,GAAQ,GAAMrB,GAAKlQ,GAAK,UACrC,EACA,YAAY8lC,EAAK,CACb,IAAI51B,EAAI41B,EACR,QAAS75B,EAAI,EAAGA,EAAI,GAAIA,IACpBiE,EAAKA,GAAK,GAAOA,GAAK,IAAM,KAChC,OAAQ41B,GAAO,GAAM51B,CACzB,EACA,SAAU,CACN,QAAS02B,GAAS,YAAY,EAC9B,YAAaA,GAAS,+CAA+C,CAC7E,EACI,WAAWd,EAAKxhC,EAAM,CAQlB,MAPc,CACV,QAAS,CAAC,GAAI,GAAI,EAAE,EACpB,aAAc,CAAC,EAAG,GAAI,EAAE,EACxB,KAAM,CAAC,EAAG,GAAI,EAAE,EAChB,MAAO,CAAC,EAAG,GAAI,EAAE,EACjB,IAAK,CAAC,EAAG,EAAG,CAAC,CACzB,EACqBA,CAAI,EAAEtE,GAAK,SAAS8lC,CAAG,CAAC,CACzC,EACA,SAAU,CACN,QAAS,OACT,aAAc,OACd,KAAM,OACN,MAAO,OACP,IAAK,MACb,EACI,SAASA,EAAKyD,EAAK,CACf,MAAM13B,EAAQm3B,GAAMlD,EAAM,CAAC,EACrB2D,EAAQR,GAAgBM,CAAG,EAAEzD,EAAM,CAAC,EACpC4D,EAAYR,GAAWK,CAAG,EAAEzD,EAAM,CAAC,EACnC6D,EAAW,KAAK,MAAM93B,EAAQ63B,CAAS,EAAID,EAC3CG,EAAcF,EAAa73B,EAAQ63B,EACzC,MAAO,CACH,MAAAD,EACA,UAAAC,EACA,YAAAE,EACA,SAAAD,EACA,UAAW93B,EAAQ43B,EAAQC,GAAa,EACxC,OAAQD,EAAQE,GAAYD,EAAYA,EAAYE,CAChE,CACI,CACJ,EACMC,GAAW,CACb,CAAC/8B,EAAGC,KAAOD,EAAIC,GAAK,GAAK,EACzB,CAAC+8B,EAAI/8B,IAAMA,EAAI,GAAK,EACpB,CAACD,EAAGi9B,IAAOj9B,EAAI,GAAK,EACpB,CAACA,EAAGC,KAAOD,EAAIC,GAAK,GAAK,EACzB,CAACD,EAAGC,KAAO,KAAK,MAAMA,EAAI,CAAC,EAAI,KAAK,MAAMD,EAAI,CAAC,GAAK,GAAK,EACzD,CAACA,EAAGC,IAAQD,EAAIC,EAAK,EAAOD,EAAIC,EAAK,GAAM,EAC3C,CAACD,EAAGC,KAASD,EAAIC,EAAK,EAAOD,EAAIC,EAAK,GAAM,GAAK,EACjD,CAACD,EAAGC,MAASD,EAAIC,GAAK,EAAOD,EAAIC,EAAK,GAAM,GAAK,CACrD,EAEMi9B,GAAK,CACP,QAAUC,GAAW,CACjB,MAAMC,EAAMhE,GAAQ,IAAK,CAAC,EACpBlvB,EAAMkvB,GAAQ,IAAK,CAAC,EAC1B,QAASj6B,EAAI,EAAGa,EAAI,EAAGb,EAAI,IAAKA,IAC5Bi+B,EAAIj+B,CAAC,EAAIa,EACTkK,EAAIlK,CAAC,EAAIb,EACTa,IAAM,EACFA,EAAI,MACJA,GAAKm9B,GAEb,MAAO,CAAE,IAAAC,EAAK,IAAAlzB,CAAG,CACrB,GAAG,GAAK,EACR,IAAMlK,GAAMk9B,GAAG,OAAO,IAAIl9B,CAAC,EAC3B,IAAIA,EAAG,CACH,GAAIA,IAAM,EACN,MAAM,IAAI,MAAM,uBAAuBA,CAAC,EAAE,EAC9C,OAAOk9B,GAAG,OAAO,IAAIl9B,CAAC,EAAI,GAC9B,EACA,IAAIA,EAAGC,EAAG,CACN,OAAID,IAAM,GAAKC,IAAM,EACV,EACJi9B,GAAG,OAAO,KAAKA,GAAG,OAAO,IAAIl9B,CAAC,EAAIk9B,GAAG,OAAO,IAAIj9B,CAAC,GAAK,GAAG,CACpE,EACA,IAAK,CAACD,EAAGC,IAAMD,EAAIC,EACnB,IAAK,CAACD,EAAGzR,IAAM2uC,GAAG,OAAO,IAAKA,GAAG,OAAO,IAAIl9B,CAAC,EAAIzR,EAAK,GAAG,EACzD,IAAIyR,EAAG,CACH,GAAIA,IAAM,EACN,MAAM,IAAI,MAAM,2BAA2BA,CAAC,EAAE,EAClD,OAAOk9B,GAAG,OAAO,IAAI,IAAMA,GAAG,OAAO,IAAIl9B,CAAC,CAAC,CAC/C,EACA,WAAWq9B,EAAM,CACb,GAAIA,EAAK,QAAU,EACf,MAAM,IAAI,MAAM,+BAA+B,EACnD,GAAIA,EAAK,CAAC,IAAM,EACZ,OAAOA,EAEX,IAAI,EAAI,EACR,KAAO,EAAIA,EAAK,OAAS,GAAKA,EAAK,CAAC,GAAK,EAAG,IACxC,CACJ,OAAOA,EAAK,MAAM,CAAC,CACvB,EACA,SAASC,EAAQC,EAAa,CAC1B,GAAID,EAAS,EACT,MAAM,IAAI,MAAM,+BAA+BA,CAAM,EAAE,EAC3D,GAAIC,GAAe,EACf,MAAO,CAAC,CAAC,EACb,IAAIC,EAAepE,GAAQkE,EAAS,EAAG,CAAC,EACxC,OAAAE,EAAa,CAAC,EAAID,EACXL,GAAG,WAAWM,CAAY,CACrC,EACA,OAASn6B,GAAMA,EAAE,OAAS,EAC1B,YAAa,CAACA,EAAGi6B,IAAWj6B,EAAE65B,GAAG,OAAO75B,CAAC,EAAIi6B,CAAM,EACnD,QAAQj6B,EAAGsJ,EAAG,CACV,GAAItJ,EAAE,CAAC,IAAM,GAAKsJ,EAAE,CAAC,IAAM,EACvB,MAAO,CAAC,CAAC,EACb,MAAM/G,EAAMwzB,GAAQ/1B,EAAE,OAASsJ,EAAE,OAAS,EAAG,CAAC,EAC9C,QAASxN,EAAI,EAAGA,EAAIkE,EAAE,OAAQlE,IAC1B,QAAS0tB,EAAI,EAAGA,EAAIlgB,EAAE,OAAQkgB,IAC1BjnB,EAAIzG,EAAI0tB,CAAC,EAAIqQ,GAAG,IAAIt3B,EAAIzG,EAAI0tB,CAAC,EAAGqQ,GAAG,IAAI75B,EAAElE,CAAC,EAAGwN,EAAEkgB,CAAC,CAAC,CAAC,EAG1D,OAAOqQ,GAAG,WAAWt3B,CAAG,CAC5B,EACA,cAAcvC,EAAGo6B,EAAQ,CACrB,GAAIA,GAAU,EACV,MAAO,CAAC,CAAC,EACb,GAAIA,GAAU,EACV,OAAOp6B,EACX,MAAMuC,EAAMwzB,GAAQ/1B,EAAE,OAAQ,CAAC,EAC/B,QAASlE,EAAI,EAAGA,EAAIkE,EAAE,OAAQlE,IAC1ByG,EAAIzG,CAAC,EAAI+9B,GAAG,IAAI75B,EAAElE,CAAC,EAAGs+B,CAAM,EAChC,OAAOP,GAAG,WAAWt3B,CAAG,CAC5B,EACA,gBAAgBvC,EAAGi6B,EAAQC,EAAa,CACpC,GAAID,EAAS,EACT,MAAM,IAAI,MAAM,oCAAoC,EACxD,GAAIC,GAAe,EACf,MAAO,CAAC,CAAC,EACb,MAAM33B,EAAMwzB,GAAQ/1B,EAAE,OAASi6B,EAAQ,CAAC,EACxC,QAASn+B,EAAI,EAAGA,EAAIkE,EAAE,OAAQlE,IAC1ByG,EAAIzG,CAAC,EAAI+9B,GAAG,IAAI75B,EAAElE,CAAC,EAAGo+B,CAAW,EACrC,OAAOL,GAAG,WAAWt3B,CAAG,CAC5B,EACA,QAAQvC,EAAGsJ,EAAG,CACV,GAAItJ,EAAE,CAAC,IAAM,EACT,OAAOsJ,EACX,GAAIA,EAAE,CAAC,IAAM,EACT,OAAOtJ,EACX,IAAIq6B,EAAUr6B,EACVs6B,EAAShxB,EACT+wB,EAAQ,OAASC,EAAO,SACxB,CAACD,EAASC,CAAM,EAAI,CAACA,EAAQD,CAAO,GACxC,IAAIE,EAAUxE,GAAQuE,EAAO,OAAQ,CAAC,EAClCE,EAAaF,EAAO,OAASD,EAAQ,OACrCtD,EAAIuD,EAAO,MAAM,EAAGE,CAAU,EAClC,QAAS1+B,EAAI,EAAGA,EAAIi7B,EAAE,OAAQj7B,IAC1By+B,EAAQz+B,CAAC,EAAIi7B,EAAEj7B,CAAC,EACpB,QAASA,EAAI0+B,EAAY1+B,EAAIw+B,EAAO,OAAQx+B,IACxCy+B,EAAQz+B,CAAC,EAAI+9B,GAAG,IAAIQ,EAAQv+B,EAAI0+B,CAAU,EAAGF,EAAOx+B,CAAC,CAAC,EAC1D,OAAO+9B,GAAG,WAAWU,CAAO,CAChC,EACA,cAAcn5B,EAAMq5B,EAAS,CACzB,MAAMhD,EAAM,MAAM,KAAKr2B,CAAI,EAC3B,QAAStF,EAAI,EAAGA,EAAIsF,EAAK,OAASq5B,EAAQ,OAAS,EAAG3+B,IAAK,CACvD,MAAM4+B,EAAMjD,EAAI37B,CAAC,EACjB,GAAI4+B,IAAQ,EAEZ,QAASlR,EAAI,EAAGA,EAAIiR,EAAQ,OAAQjR,IAC5BiR,EAAQjR,CAAC,IAAM,IACfiO,EAAI37B,EAAI0tB,CAAC,EAAIqQ,GAAG,IAAIpC,EAAI37B,EAAI0tB,CAAC,EAAGqQ,GAAG,IAAIY,EAAQjR,CAAC,EAAGkR,CAAG,CAAC,EAEnE,CACA,OAAOjD,EAAI,MAAMr2B,EAAK,OAASq5B,EAAQ,OAAS,EAAGhD,EAAI,MAAM,CACjE,EACA,YAAYwC,EAAQ,CAChB,IAAIvV,EAAI,CAAC,CAAC,EACV,QAAS5oB,EAAI,EAAGA,EAAIm+B,EAAQn+B,IACxB4oB,EAAImV,GAAG,QAAQnV,EAAG,CAAC,EAAGmV,GAAG,IAAI,EAAG/9B,CAAC,CAAC,CAAC,EACvC,OAAO4oB,CACX,EACA,SAASsV,EAAMh6B,EAAG,CACd,GAAIA,GAAK,EACL,OAAO65B,GAAG,YAAYG,EAAM,CAAC,EACjC,IAAIz3B,EAAMy3B,EAAK,CAAC,EAChB,QAASl+B,EAAI,EAAGA,EAAIk+B,EAAK,OAAQl+B,IAC7ByG,EAAMs3B,GAAG,IAAIA,GAAG,IAAI75B,EAAGuC,CAAG,EAAGy3B,EAAKl+B,CAAC,CAAC,EACxC,OAAOyG,CACX,EAEA,UAAUvC,EAAGsJ,EAAGqxB,EAAG,CAEXd,GAAG,OAAO75B,CAAC,EAAI65B,GAAG,OAAOvwB,CAAC,IAC1B,CAACtJ,EAAGsJ,CAAC,EAAI,CAACA,EAAGtJ,CAAC,GAClB,IAAI46B,EAAQ56B,EACRpQ,EAAI0Z,EACJuxB,EAAQ,CAAC,CAAC,EACV5tC,EAAI,CAAC,CAAC,EAEV,KAAO,EAAI4sC,GAAG,OAAOjqC,CAAC,GAAK+qC,GAAG,CAC1B,IAAIG,EAAYF,EACZG,EAAYF,EAGhB,GAFAD,EAAQhrC,EACRirC,EAAQ5tC,EACJ2tC,EAAM,CAAC,IAAM,EACb,MAAM,IAAI,MAAM,gBAAgB,EACpChrC,EAAIkrC,EACJ,IAAI5c,EAAI,CAAC,CAAC,EACV,MAAM8c,EAAanB,GAAG,IAAIe,EAAM,CAAC,CAAC,EAClC,KAAOf,GAAG,OAAOjqC,CAAC,GAAKiqC,GAAG,OAAOe,CAAK,GAAKhrC,EAAE,CAAC,IAAM,GAAG,CACnD,MAAMqrC,EAAapB,GAAG,OAAOjqC,CAAC,EAAIiqC,GAAG,OAAOe,CAAK,EAC3CM,EAAQrB,GAAG,IAAIjqC,EAAE,CAAC,EAAGorC,CAAU,EACrC9c,EAAI2b,GAAG,QAAQ3b,EAAG2b,GAAG,SAASoB,EAAYC,CAAK,CAAC,EAChDtrC,EAAIiqC,GAAG,QAAQjqC,EAAGiqC,GAAG,gBAAgBe,EAAOK,EAAYC,CAAK,CAAC,CAClE,CAGA,GAFAhd,EAAI2b,GAAG,QAAQ3b,EAAG2c,CAAK,EACvB5tC,EAAI4sC,GAAG,QAAQ3b,EAAG6c,CAAS,EACvBlB,GAAG,OAAOjqC,CAAC,GAAKiqC,GAAG,OAAOe,CAAK,EAC/B,MAAM,IAAI,MAAM,sBAAsBhrC,CAAC,YAAYgrC,CAAK,EAAE,CAClE,CACA,MAAMO,EAAmBtB,GAAG,YAAY5sC,EAAG,CAAC,EAC5C,GAAIkuC,GAAoB,EACpB,MAAM,IAAI,MAAM,wBAAwB,EAC5C,MAAMC,EAAUvB,GAAG,IAAIsB,CAAgB,EACvC,MAAO,CAACtB,GAAG,cAAc5sC,EAAGmuC,CAAO,EAAGvB,GAAG,cAAcjqC,EAAGwrC,CAAO,CAAC,CACtE,CACJ,EACA,SAASC,GAAGC,EAAU,CAClB,MAAO,CACH,OAAOt6B,EAAM,CACT,MAAMjB,EAAI85B,GAAG,YAAYyB,CAAQ,EAC3BC,EAAM,MAAM,KAAKv6B,CAAI,EAC3B,OAAAu6B,EAAI,KAAK,GAAGx7B,EAAE,MAAM,EAAG,EAAE,EAAE,KAAK,CAAC,CAAC,EAC3B,WAAW,KAAK85B,GAAG,cAAc0B,EAAKx7B,CAAC,CAAC,CACnD,EACA,OAAO/J,EAAI,CACP,MAAMuM,EAAMvM,EAAG,MAAK,EACdgkC,EAAOH,GAAG,WAAW,MAAM,KAAK7jC,CAAE,CAAC,EAEzC,IAAIwlC,EAAWzF,GAAQuF,EAAU,CAAC,EAC9BG,EAAW,GACf,QAAS3/B,EAAI,EAAGA,EAAIw/B,EAAUx/B,IAAK,CAC/B,MAAM4/B,EAAM7B,GAAG,SAASG,EAAMH,GAAG,IAAI/9B,CAAC,CAAC,EACvC0/B,EAASA,EAAS,OAAS,EAAI1/B,CAAC,EAAI4/B,EAChCA,IAAQ,IACRD,EAAW,GACnB,CACA,GAAI,CAACA,EACD,OAAOl5B,EACXi5B,EAAW3B,GAAG,WAAW2B,CAAQ,EACjC,MAAMG,EAAW9B,GAAG,SAASyB,EAAU,CAAC,EAClC,CAACM,EAAcC,CAAc,EAAIhC,GAAG,UAAU8B,EAAUH,EAAUF,CAAQ,EAE1EQ,EAAY/F,GAAQ8D,GAAG,OAAO+B,CAAY,EAAG,CAAC,EACpD,IAAI1wC,EAAI,EACR,QAAS4Q,EAAI,EAAGA,EAAI,KAAO5Q,EAAI4wC,EAAU,OAAQhgC,IACzC+9B,GAAG,SAAS+B,EAAc9/B,CAAC,IAAM,IACjCggC,EAAU5wC,GAAG,EAAI2uC,GAAG,IAAI/9B,CAAC,GAEjC,GAAI5Q,IAAM4wC,EAAU,OAChB,MAAM,IAAI,MAAM,kCAAkC,EACtD,QAAShgC,EAAI,EAAGA,EAAIggC,EAAU,OAAQhgC,IAAK,CACvC,MAAMigC,EAAMx5B,EAAI,OAAS,EAAIs3B,GAAG,IAAIiC,EAAUhgC,CAAC,CAAC,EAChD,GAAIigC,EAAM,EACN,MAAM,IAAI,MAAM,mCAAmC,EACvD,MAAMC,EAAYnC,GAAG,IAAIiC,EAAUhgC,CAAC,CAAC,EACrC,IAAImgC,EAAc,EAClB,QAASzS,EAAI,EAAGA,EAAIsS,EAAU,OAAQtS,IAC9B1tB,IAAM0tB,IAEVyS,EAAcpC,GAAG,IAAIoC,EAAapC,GAAG,IAAI,EAAGA,GAAG,IAAIiC,EAAUtS,CAAC,EAAGwS,CAAS,CAAC,CAAC,GAEhFz5B,EAAIw5B,CAAG,EAAIlC,GAAG,IAAIt3B,EAAIw5B,CAAG,EAAGlC,GAAG,IAAIA,GAAG,SAASgC,EAAgBG,CAAS,EAAGnC,GAAG,IAAIoC,CAAW,CAAC,CAAC,CACnG,CACA,OAAO15B,CACX,CACR,CACA,CAEA,SAAS25B,GAAWvG,EAAKyD,EAAK,CAC1B,KAAM,CAAE,MAAAE,EAAO,YAAAG,EAAa,UAAAF,EAAW,SAAAC,EAAU,MAAA9Y,CAAK,EAAK7wB,GAAK,SAAS8lC,EAAKyD,CAAG,EAC3E+C,EAAKd,GAAG/B,CAAK,EACnB,MAAO,CACH,OAAO53B,EAAO,CAEV,MAAMw0B,EAAS,GACTkG,EAAY,GAClB,QAAStgC,EAAI,EAAGA,EAAIy9B,EAAWz9B,IAAK,CAChC,MAAMugC,EAAUvgC,EAAI29B,EACd73B,EAAM43B,GAAY6C,EAAU,EAAI,GACtCnG,EAAO,KAAKx0B,EAAM,SAAS,EAAGE,CAAG,CAAC,EAClCw6B,EAAU,KAAKD,EAAG,OAAOz6B,EAAM,SAAS,EAAGE,CAAG,CAAC,CAAC,EAChDF,EAAQA,EAAM,SAASE,CAAG,CAC9B,CACA,MAAM06B,EAAYrG,GAAgB,GAAGC,CAAM,EACrCqG,EAAStG,GAAgB,GAAGmG,CAAS,EACrC75B,EAAM,IAAI,WAAW+5B,EAAU,OAASC,EAAO,MAAM,EAC3D,OAAAh6B,EAAI,IAAI+5B,CAAS,EACjB/5B,EAAI,IAAIg6B,EAAQD,EAAU,MAAM,EACzB/5B,CACX,EACA,OAAOnB,EAAM,CACT,GAAIA,EAAK,SAAWsf,EAChB,MAAM,IAAI,MAAM,gCAAgCtf,EAAK,MAAM,WAAWsf,CAAK,EAAE,EACjF,MAAMwV,EAAS,GACf,QAASp6B,EAAI,EAAGA,EAAIy9B,EAAWz9B,IAAK,CAChC,MAAMugC,EAAUvgC,EAAI29B,EACpBvD,EAAO,KAAK,IAAI,WAAWoD,EAAQE,GAAY6C,EAAU,EAAI,EAAE,CAAC,CACpE,CAEA,IAAIN,EAAM,EACV,QAASjgC,EAAI,EAAGA,EAAI09B,EAAU19B,IAC1B,QAAS0tB,EAAI,EAAGA,EAAI+P,EAAW/P,IAC3B0M,EAAO1M,CAAC,EAAE1tB,CAAC,EAAIsF,EAAK26B,GAAK,EAGjC,QAASvS,EAAIiQ,EAAajQ,EAAI+P,EAAW/P,IACrC0M,EAAO1M,CAAC,EAAEgQ,CAAQ,EAAIp4B,EAAK26B,GAAK,EAEpC,QAASjgC,EAAI09B,EAAU19B,EAAI09B,EAAWF,EAAOx9B,IACzC,QAAS0tB,EAAI,EAAGA,EAAI+P,EAAW/P,IAAK,CAChC,MAAM6S,EAAU7S,EAAIiQ,EACpBvD,EAAO1M,CAAC,EAAE1tB,GAAKugC,EAAU,EAAI,EAAE,EAAIj7B,EAAK26B,GAAK,CACjD,CAIJ,MAAMx5B,EAAM,GACZ,UAAWoV,KAASue,EAChB3zB,EAAI,KAAK,GAAG,MAAM,KAAK45B,EAAG,OAAOxkB,CAAK,CAAC,EAAE,MAAM,EAAG,CAAC2hB,CAAK,CAAC,EAC7D,OAAO,WAAW,KAAK/2B,CAAG,CAC9B,CACR,CACA,CAGA,SAASi6B,GAAa7G,EAAKyD,EAAKC,EAASphC,EAAO,GAAO,CACnD,MAAMrD,EAAO/E,GAAK,KAAK,OAAO8lC,CAAG,EACjC,IAAIrsB,EAAI,IAAIwtB,GAAOliC,EAAO,CAAC,EAG3B,MAAM6nC,EAAS,IAAI3F,GAAO,CAAC,EAAE,KAAK,EAAG,EAAG,EAAI,EAAE,OAAO,EAAG,EAAK,EAAE,OAAO,EAAG,EAAI,EAAE,OAAO,EAAG,EAAK,EAC9FxtB,EAAIA,EACC,MAAM,EAAGmzB,CAAM,EACf,MAAM,CAAE,EAAG,CAACA,EAAO,MAAO,EAAG,CAAC,EAAIA,CAAM,EACxC,MAAM,CAAE,EAAG,EAAG,EAAG,CAACA,EAAO,QAAUA,CAAM,EAC9CnzB,EAAIA,EAAE,UAAU,EAAG1U,CAAI,EAEvB,MAAMwB,EAAQ,IAAI0gC,GAAO,CAAC,EAAE,KAAK,EAAG,EAAG,EAAI,EAAE,OAAO,EAAG,EAAK,EAAE,OAAO,EAAG,EAAI,EACtE4F,EAAW7sC,GAAK,kBAAkB8lC,CAAG,EAC3C,UAAW/4B,KAAK8/B,EACZ,UAAW//B,KAAK+/B,EACRpzB,EAAE,KAAK1M,CAAC,EAAED,CAAC,IAAM,QAErB2M,EAAE,MAAM,CAAE,EAAG3M,EAAI,EAAG,EAAGC,EAAI,GAAKxG,CAAK,EAI7CkT,EAAIA,EACC,MAAM,CAAE,EAAG,EAAG,EAAG,CAAC,EAAI,IAAU,CAAC,CAAE,EAAA3M,CAAC,EAAI06B,IAASA,IAAQ,OAAY16B,EAAI,GAAK,EAAI06B,CAAI,EACtF,MAAM,CAAE,EAAG,EAAG,EAAG,CAAC,EAAI,IAAU,CAAC,CAAE,EAAAz6B,CAAC,EAAIy6B,IAASA,IAAQ,OAAYz6B,EAAI,GAAK,EAAIy6B,CAAI,EAE3F,CACI,MAAMsF,EAAO9sC,GAAK,WAAWupC,EAAKC,CAAO,EACnCuD,EAAU9gC,GAAM,CAAC7D,IAAU0kC,GAAQ7gC,EAAK,IAAM,EAEpD,QAASA,EAAI,EAAGA,EAAI,EAAGA,IACnBwN,EAAE,KAAKxN,CAAC,EAAE,CAAC,EAAI8gC,EAAO9gC,CAAC,EAG3B,QAASA,EAAI,EAAGA,EAAI,EAAGA,IACnBwN,EAAE,KAAKxN,EAAI,CAAC,EAAE,CAAC,EAAI8gC,EAAO9gC,CAAC,EAC/B,QAASA,EAAI,EAAGA,EAAI,GAAIA,IACpBwN,EAAE,KAAK1U,EAAO,GAAKkH,CAAC,EAAE,CAAC,EAAI8gC,EAAO9gC,CAAC,EAEvC,QAASA,EAAI,EAAGA,EAAI,EAAGA,IACnBwN,EAAE,KAAK,CAAC,EAAE1U,EAAOkH,EAAI,CAAC,EAAI8gC,EAAO9gC,CAAC,EACtC,QAASA,EAAI,EAAGA,EAAI,EAAGA,IACnBwN,EAAE,KAAK,CAAC,EAAE,GAAKxN,EAAI,EAAI,CAAC,EAAI8gC,EAAO9gC,CAAC,EACxC,QAASA,EAAI,EAAGA,EAAI,GAAIA,IACpBwN,EAAE,KAAK,CAAC,EAAE,GAAKxN,EAAI,CAAC,EAAI8gC,EAAO9gC,CAAC,EACpCwN,EAAE,KAAK1U,EAAO,CAAC,EAAE,CAAC,EAAI,CAACqD,CAC3B,CAEA,GAAI09B,GAAO,EAAG,CACV,MAAMgH,EAAO9sC,GAAK,YAAY8lC,CAAG,EACjC,QAAS75B,EAAI,EAAGA,EAAI,GAAIA,GAAK,EAAG,CAC5B,MAAM+gC,EAAM,CAAC5kC,IAAU0kC,GAAQ7gC,EAAK,IAAM,EACpCa,EAAI,KAAK,MAAMb,EAAI,CAAC,EACpBc,EAAKd,EAAI,EAAKlH,EAAO,EAAI,EAE/B0U,EAAE,KAAK3M,CAAC,EAAEC,CAAC,EAAIigC,EACfvzB,EAAE,KAAK1M,CAAC,EAAED,CAAC,EAAIkgC,CACnB,CACJ,CACA,OAAOvzB,CACX,CAEA,SAASwzB,GAAOC,EAAK1D,EAAS9vC,EAAI,CAC9B,MAAMqL,EAAOmoC,EAAI,OACX1G,EAAUqD,GAASL,CAAO,EAEhC,IAAIxkB,EAAM,GACNjY,EAAIhI,EAAO,EAEf,QAASooC,EAAUpoC,EAAO,EAAGooC,EAAU,EAAGA,GAAW,EAAG,CAGpD,IAFIA,GAAW,IACXA,EAAU,IACNpgC,GAAKiY,EAAK,CACd,QAAS2U,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAAG,CAC3B,MAAM7sB,EAAIqgC,EAAUxT,EAChBuT,EAAI,KAAKngC,CAAC,EAAED,CAAC,IAAM,QAEvBpT,EAAGoT,EAAGC,EAAGy5B,EAAQ15B,EAAGC,CAAC,CAAC,CAC1B,CACA,GAAIA,EAAIiY,EAAM,GAAKjY,EAAIiY,GAAOjgB,EAC1B,KACR,CACAigB,EAAM,CAACA,CACX,CACJ,CAGA,SAASooB,GAAWzgC,EAAK,CACrB,IAAIrI,EAAO,UACX,QAASwI,KAAKH,EACV,GAAI,CAAA3M,GAAK,SAAS,QAAQ,IAAI8M,CAAC,IAE/BxI,EAAO,eACH,CAACtE,GAAK,SAAS,YAAY,IAAI8M,CAAC,GAChC,MAAO,OAEf,OAAOxI,CACX,CAIO,SAAS+oC,GAAY1gC,EAAK,CAC7B,GAAI,OAAOA,GAAQ,SACf,MAAM,IAAI,MAAM,oCAAoC,OAAOA,CAAG,EAAE,EACpE,OAAO,IAAI,WAAW,IAAI,YAAW,EAAG,OAAOA,CAAG,CAAC,CACvD,CACA,SAAS8E,GAAOq0B,EAAKyD,EAAKh4B,EAAMjN,EAAM,CAClC,IAAIgpC,EAAU,GACVC,EAAUh8B,EAAK,OACnB,GAAIjN,IAAS,UAAW,CACpB,MAAMlH,EAAI4C,GAAK,SAAS,QAAQ,OAAOuR,EAAK,MAAM,EAAE,CAAC,EAC/Ci8B,EAAIpwC,EAAE,OACZ,QAAS6O,EAAI,EAAGA,EAAIuhC,EAAI,EAAGvhC,GAAK,EAC5BqhC,GAAWvH,GAAI3oC,EAAE6O,CAAC,EAAI,IAAM7O,EAAE6O,EAAI,CAAC,EAAI,GAAK7O,EAAE6O,EAAI,CAAC,EAAG,EAAE,EACxDuhC,EAAI,IAAM,EACVF,GAAWvH,GAAI3oC,EAAEowC,EAAI,CAAC,EAAG,CAAC,EAErBA,EAAI,IAAM,IACfF,GAAWvH,GAAI3oC,EAAEowC,EAAI,CAAC,EAAI,GAAKpwC,EAAEowC,EAAI,CAAC,EAAG,CAAC,EAElD,SACSlpC,IAAS,eAAgB,CAC9B,MAAMlH,EAAI4C,GAAK,SAAS,YAAY,OAAOuR,EAAK,MAAM,EAAE,CAAC,EACnDi8B,EAAIpwC,EAAE,OACZ,QAAS6O,EAAI,EAAGA,EAAIuhC,EAAI,EAAGvhC,GAAK,EAC5BqhC,GAAWvH,GAAI3oC,EAAE6O,CAAC,EAAI,GAAK7O,EAAE6O,EAAI,CAAC,EAAG,EAAE,EACvCuhC,EAAI,GAAK,IACTF,GAAWvH,GAAI3oC,EAAEowC,EAAI,CAAC,EAAG,CAAC,EAClC,SACSlpC,IAAS,OAAQ,CACtB,MAAMmpC,EAAOJ,GAAY97B,CAAI,EAC7Bg8B,EAAUE,EAAK,OACfH,EAAU,MAAM,KAAKG,CAAI,EACpB,IAAKxhC,GAAM85B,GAAI95B,EAAG,CAAC,CAAC,EACpB,KAAK,EAAE,CAChB,KAEI,OAAM,IAAI,MAAM,0BAA0B,EAE9C,KAAM,CAAE,SAAAyhC,CAAQ,EAAK1tC,GAAK,SAAS8lC,EAAKyD,CAAG,EACrCx3B,EAAMg0B,GAAIwH,EAASvtC,GAAK,WAAW8lC,EAAKxhC,CAAI,CAAC,EACnD,IAAIwoC,EAAO9sC,GAAK,SAASsE,CAAI,EAAIyN,EAAMu7B,EACvC,GAAIR,EAAK,OAASY,EACd,MAAM,IAAI,MAAM,mBAAmB,EAEvCZ,GAAQ,IAAI,OAAO,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGY,EAAWZ,EAAK,MAAM,CAAC,CAAC,EAE/DA,EAAK,OAAS,IACdA,GAAQ,IAAI,OAAO,EAAKA,EAAK,OAAS,CAAE,GAE5C,MAAM3xB,EAAU,mBAChB,QAASwyB,EAAM,EAAGb,EAAK,SAAWY,EAAUC,IACxCb,GAAQ3xB,EAAQwyB,EAAMxyB,EAAQ,MAAM,EAExC,MAAMtJ,EAAQ,WAAW,KAAKi7B,EAAK,MAAM,SAAS,EAAE,IAAK7gC,GAAM,CAAO,KAAKA,CAAC,EAAG,CAAC,EAChF,OAAOogC,GAAWvG,EAAKyD,CAAG,EAAE,OAAO13B,CAAK,CAC5C,CAEA,SAAS+7B,GAAO9H,EAAKyD,EAAKh4B,EAAMi4B,EAASphC,EAAO,GAAO,CACnD,MAAMqR,EAAIkzB,GAAa7G,EAAKyD,EAAKC,EAASphC,CAAI,EAC9C,IAAI6D,EAAI,EACR,MAAM4hC,EAAO,EAAIt8B,EAAK,OAStB,GARA07B,GAAOxzB,EAAG+vB,EAAS,CAAC18B,EAAGC,EAAG+gC,IAAS,CAC/B,IAAIpvC,EAAQ,GACRuN,EAAI4hC,IACJnvC,GAAU6S,EAAKtF,IAAM,CAAC,IAAO,EAAIA,EAAK,GAAM,KAAO,EACnDA,KAEJwN,EAAE,KAAK1M,CAAC,EAAED,CAAC,EAAIpO,IAAUovC,CAC7B,CAAC,EACG7hC,IAAM4hC,EACN,MAAM,IAAI,MAAM,2BAA2B,EAC/C,OAAOp0B,CACX,CACA,SAASs0B,GAAQrG,EAAI,CACjB,MAAM6D,EAAU7D,EAAG,QAAO,EAEpBsG,EAAa3P,GAAQ,CACvB,IAAI3rB,EAAM,EACV,QAASzG,EAAI,EAAGgiC,EAAO,EAAG9E,EAAO,OAAWl9B,EAAIoyB,EAAI,OAAQpyB,IACpDk9B,IAAS9K,EAAIpyB,CAAC,IACdgiC,IACIhiC,IAAMoyB,EAAI,OAAS,KAGvB4P,GAAQ,IACRv7B,GAAO,GAAKu7B,EAAO,IACvB9E,EAAO9K,EAAIpyB,CAAC,EACZgiC,EAAO,GAEX,OAAOv7B,CACX,EACA,IAAIw7B,EAAW,EACfxG,EAAG,KAAK,QAASrJ,GAAS6P,GAAYF,EAAU3P,CAAG,CAAE,EACrDkN,EAAQ,KAAK,QAASjoB,GAAY4qB,GAAYF,EAAU1qB,CAAM,CAAE,EAEhE,IAAI6qB,EAAM,EACN10B,EAAIiuB,EAAG,KACX,MAAM0G,EAAQ1G,EAAG,MAAQ,EACnB2G,EAAQ3G,EAAG,OAAS,EAC1B,QAAS56B,EAAI,EAAGA,EAAIshC,EAAOthC,IACvB,QAAS,EAAI,EAAG,EAAIuhC,EAAO,IAAK,CAC5B,MAAMC,EAAKxhC,EAAI,EACTyhC,EAAK,EAAI,EACX90B,EAAE3M,CAAC,EAAE,CAAC,IAAM2M,EAAE60B,CAAE,EAAE,CAAC,GAAK70B,EAAE60B,CAAE,EAAE,CAAC,IAAM70B,EAAE3M,CAAC,EAAEyhC,CAAE,GAAK90B,EAAE60B,CAAE,EAAE,CAAC,IAAM70B,EAAE60B,CAAE,EAAEC,CAAE,IACtEJ,GAAO,EAEf,CAGJ,MAAMK,EAAiBnQ,GAAQ,CAC3B,MAAMmQ,EAAgB,CAAC,GAAM,GAAO,GAAM,GAAM,GAAM,GAAO,EAAI,EAC3DC,EAAe,CAAC,GAAO,GAAO,GAAO,EAAK,EAC1CC,EAAK,CAAC,GAAGF,EAAe,GAAGC,CAAY,EACvCE,EAAK,CAAC,GAAGF,EAAc,GAAGD,CAAa,EAC7C,IAAI97B,EAAM,EACV,QAASzG,EAAI,EAAGA,EAAIoyB,EAAI,OAAQpyB,IACxBq6B,GAAWjI,EAAKqQ,EAAIziC,CAAC,IACrByG,GAAO,IACP4zB,GAAWjI,EAAKsQ,EAAI1iC,CAAC,IACrByG,GAAO,IAEf,OAAOA,CACX,EACA,IAAIk6B,EAAS,EACb,UAAWvO,KAAOqJ,EAAG,KACjBkF,GAAU4B,EAAcnQ,CAAG,EAC/B,UAAW/a,KAAUioB,EAAQ,KACzBqB,GAAU4B,EAAclrB,CAAM,EAIlC,IAAIsrB,EAAa,EACjBlH,EAAG,SAAS,EAAG,IAAU,CAACmH,EAAI1I,IAASyI,GAAczI,EAAM,EAAI,CAAE,EACjE,MAAM2I,EAAeF,GAAclH,EAAG,OAASA,EAAG,OAAU,IACtD5D,EAAO,GAAK,KAAK,MAAM,KAAK,IAAIgL,EAAc,EAAE,EAAI,CAAC,EAC3D,OAAOZ,EAAWC,EAAMvB,EAAS9I,CACrC,CAEA,SAASiL,GAAWjJ,EAAKyD,EAAKh4B,EAAMi4B,EAAS,CACzC,GAAIA,IAAY,OAAW,CACvB,MAAMwF,EAAWvI,GAAI,EACrB,QAASqH,EAAO,EAAGA,EAAOjE,GAAS,OAAQiE,IACvCkB,EAAS,IAAIjB,GAAQH,GAAO9H,EAAKyD,EAAKh4B,EAAMu8B,EAAM,EAAI,CAAC,EAAGA,CAAI,EAClEtE,EAAUwF,EAAS,IAAG,CAC1B,CACA,GAAIxF,IAAY,OACZ,MAAM,IAAI,MAAM,kBAAkB,EACtC,OAAOoE,GAAO9H,EAAKyD,EAAKh4B,EAAMi4B,CAAO,CACzC,CACA,SAASyF,GAAYC,EAAI,CACrB,GAAI,CAACpG,GAAO,SAASoG,CAAE,EACnB,MAAM,IAAI,MAAM,iCAAiCA,CAAE,eAAepG,EAAM,EAAE,CAClF,CACA,SAASqG,GAAiBC,EAAK,CAC3B,GAAI,CAACrG,GAAS,SAASqG,CAAG,EACtB,MAAM,IAAI,MAAM,0BAA0BA,CAAG,eAAerG,EAAQ,EAAE,EAC1E,GAAIqG,IAAQ,SAAWA,IAAQ,MAC3B,MAAM,IAAI,MAAM,aAAaA,CAAG,2BAA2B,CACnE,CACA,SAASC,GAAavB,EAAM,CACxB,GAAI,CAAC,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAAE,SAASA,CAAI,GAAK,CAACjE,GAASiE,CAAI,EAC1D,MAAM,IAAI,MAAM,gBAAgBA,CAAI,0BAA0B,CACtE,CACO,SAASwB,GAAS/jB,EAAMgkB,EAAS,MAAO7sC,EAAO,GAAI,CACtD,MAAM6mC,EAAM7mC,EAAK,MAAQ,OAAYA,EAAK,IAAM,SAChDusC,GAAY1F,CAAG,EACf,MAAMiG,EAAW9sC,EAAK,WAAa,OAAYA,EAAK,SAAW0qC,GAAW7hB,CAAI,EAC9E4jB,GAAiBK,CAAQ,EACrB9sC,EAAK,OAAS,QACd2sC,GAAa3sC,EAAK,IAAI,EAC1B,IAAIojC,EAAMpjC,EAAK,QACX6O,EAAMqK,EAAM,IAAI,MAAM,eAAe,EACzC,GAAIkqB,IAAQ,OACRD,GAAgBC,CAAG,EACnBv0B,EAAOE,GAAOq0B,EAAKyD,EAAKhe,EAAMikB,CAAQ,MAKtC,SAASvjC,EAAI,EAAGA,GAAK,GAAIA,IACrB,GAAI,CACAsF,EAAOE,GAAOxF,EAAGs9B,EAAKhe,EAAMikB,CAAQ,EACpC1J,EAAM75B,EACN,KACJ,OACO5Q,EAAG,CACNugB,EAAMvgB,CACV,CAGR,GAAI,CAACyqC,GAAO,CAACv0B,EACT,MAAMqK,EACV,IAAIlJ,EAAMq8B,GAAWjJ,EAAKyD,EAAKh4B,EAAM7O,EAAK,IAAI,EAC9CgQ,EAAI,YAAW,EACf,MAAM+0B,EAAS/kC,EAAK,SAAW,OAAY,EAAIA,EAAK,OACpD,GAAI,CAAC,OAAO,cAAc+kC,CAAM,EAC5B,MAAM,IAAI,MAAM,uBAAuB,OAAOA,CAAM,EAAE,EAI1D,GAHA/0B,EAAMA,EAAI,OAAO+0B,EAAQ,EAAK,EAC1B/kC,EAAK,QAAU,SACfgQ,EAAMA,EAAI,MAAMhQ,EAAK,KAAK,GAC1B6sC,IAAW,MACX,OAAO78B,EAAI,KACV,GAAI68B,IAAW,QAChB,OAAO78B,EAAI,QAAO,EACjB,GAAI68B,IAAW,MAChB,OAAO78B,EAAI,MAAMhQ,EAAK,QAAQ,EAC7B,GAAI6sC,IAAW,MAChB,OAAO78B,EAAI,MAAK,EACf,GAAI68B,IAAW,OAChB,OAAO78B,EAAI,OAAM,EAEjB,MAAM,IAAI,MAAM,mBAAmB68B,CAAM,EAAE,CACnD,CAEY,MAACE,GAAQ,CACjB,KAAAhJ,GACA,IAAAV,GACA,aAAA4G,GACA,QAAAzG,GACA,KAAAlmC,GACA,WAAAqsC,GACA,gBAAAxG,GACA,OAAAoH,EACJ,EC/kCA,MAAM/Y,GAAS55B,OAAOi6B,gBAClB,IAAIA,gBAAgB,EAAG,CAAC,EACxBh6B,SAASi6B,cAAc,QAAQ,EAC7BP,GAAMC,GAAOwb,WAAW,KAAM,CAClCjb,mBAAoB,EACtB,CAAC,EACDR,GAAIS,sBAAwB,GAE5B,SAAwBib,GAAO,CAC7BpkB,OACA2J,QACAnG,iBACA6gB,cAAc,GACd5gB,SACF,EAAG,CACD,MAAM6gB,EAAatzC,EAAO,IAAI,EACxB,CAACuzC,EAAeC,CAAgB,EAAIvyC,EAAS,CAAC,EAC9C,CAACwyC,EAAaC,CAAc,EAAIzyC,EAAS,EAAK,EAC9C,CAAC0yC,EAAeC,CAAgB,EAAI3yC,EAAS,EAAK,EAElD4yC,EAAuBF,EAAgB,GAAQN,EA6CrD,GA3CApzC,EAAU,IAAM,CACd,GAAIwyB,GAAW6gB,EAAWpzC,QAAS,CACjC,MAAMsS,EAAS8gC,EAAWpzC,QAAQqO,aAClCilC,EAAiBhhC,CAAM,CACzB,CACF,EAAG,CAACigB,CAAO,CAAC,EAEZxyB,EAAU,IAAM,CACd,GAAI04B,EAAO,CACT,MAAMmb,EAAM,IAAIC,MAChBD,EAAIlc,YAAc,YAClBkc,EAAIE,OAAS,IAAM,CACjBN,EAAe,EAAI,EACnB,GAAI,CACF,KAAM,CAAEnhC,QAAOC,UAAWshC,EAC1Bnc,GAAOplB,MAAQA,EACfolB,GAAOnlB,OAASA,EAChBklB,GAAIU,UAAU0b,EAAK,EAAG,CAAC,EAEvB,MAAM9+B,EADY0iB,GAAIuc,aAAa,EAAG,EAAG1hC,EAAOC,CAAM,EAC/BwC,KACjBk/B,GAAcl/B,EAAK3S,OAAS,EAClC,IAAI8xC,GAAgB,EAChBC,EAAW,GACf,QAAS1kC,GAAI,EAAGA,GAAIsF,EAAK3S,OAAQqN,IAAK,EAEpC,GADIsF,EAAKtF,EAAC,GAAK,KAAKykC,KAChBA,GAAgBD,GAAc,GAAK,CACrCE,EAAW,GACX,KACF,CAEFR,EAAiBQ,CAAQ,CAC3B,MAAY,CACVR,EAAiB,EAAK,CACxB,CACF,EACAE,EAAIO,QAAWl7B,GAAU,CACvB7Y,KACAozC,EACFI,EAAA,IAAAnb,CACAmb,MACFJ,EAAO,GACe,EACtB,CAAA/a,CAAA,GACEA,GAAM,YAEV,QAAWxc,GAAO,IAAA42B,GAAA/jB,EAAA,OAElB,IAAMslB,OAGAtH,OAAK,EACL9B,OAAQ,GACR4D,EAAO,GAEV9f,EACHslB,EAAA,OACMC,EAAkBlyC,oBAElBmyC,cAAoBf,EAAcjpB,GAAwB,GAC1DiqB,IAA0BF,EAC1BG,GAAYD,OAElB,GAAME,QAAYpkC,GAASC,EAAA,GAAAA,GAAA+jC,EAAA,SACzB,GAAIhkC,GAAcgkC,MAAqB/jC,KAAeA,GAAOikC,GAAAjkC,EAAAkkC,EAE7D,GACEjB,EACAljC,CAKA,MAAI8iC,GAAaoB,EAAAC,GAAA,EACTE,GAAWH,EAAcC,GAAa,EACtCG,IAAyBH,EACzBI,KAASN,KACTO,GAAKxkC,EAAI,GAAMqkC,EAErB,GADe,KAAMC,oBACCxP,MAAK0P,EAC3B,KACF,OAAO,GAGT,OAAAT,EAAA9jC,CAAA,EAAAD,CAAA,CAEA,EACFykC,EAAA,CAAAzkC,EAAAC,IAEMwkC,WAAqBxkC,EAAM,GAAAA,GAAA+jC,EAAA,GAC3BhkC,EAASA,EAAKgkC,GAEpBU,EAAA,CAAA1kC,EAAAC,IAEMykC,UACA1kC,GAAIgkC,EAAY,GAAA/jC,EAAO,GACvBD,KAAKgkC,KAAoB,EAG/B1I,EAAA1vB,GAAA,KAEA,IAAM0vB,KACJ,QAAI72B,EAAO,EAAAxE,EAAA+jC,EAAA/jC,IAEX,QAASA,EAAI,EAAGA,EAAI+jC,EAAU/jC,IAAK,CAE/B,GADF,CAAAwkC,EAAoBT,MACdU,EAAmBzkC,EAAIA,CAAA,WAC3B,MAAIykC,OAEEC,EAAK3kC,EAAI,GACT4kC,GAASH,EAAAzkC,EAAAC,EAAA,KAAAykC,EAAA1kC,EAAAC,EAAA,GACT4kC,GACJJ,EAAezkC,EAAGC,MAAWykC,GAAmB1kC,EAAGC,EAAKA,CAAA,EACpD6kC,EACJL,EAAezkC,EAAIC,EAAI,IAAMykC,GAAmB1kC,EAAIC,EAAI,GACpD8kC,KACJN,EAAezkC,EAAGC,OAAWykC,EAAmB1kC,EAAGC,GACrD6kC,KAGArgC,GAAIqgC,KAAUH,CAAA,IAAAC,CAAA,MAAAD,EAAA,KAAAC,CAAA,KAEdG,IACAtgC,GAAIsgC,KAAWJ,CAAA,IAAAC,CAAA,MAAAD,CAAA,IAAAC,EAAA,MAEf,CAAAC,IAAA,CAAAC,IAAA,CAAAC,GAAA,CAAAC,KACAvgC,GAAKogC,KAAUF,YAAcI,UACQ,CAGzC,OAAAtgC,CAEA,GAAAu/B,EAAOv/B,cAEPu/B,GASF,CACE,IAAEhkC,EAAG,GAAQ,CACb,EAAAgkC,EAAA,EAAEhkC,EAAGgkC,CAAW,EAAQ,CACxB,IAAEhkC,EAAGgkC,EAAA,EAAmB,EAAGiB,EAAA,IAGvBA,EAAoB,GACpBC,EAAoB,EAEpBC,IAAqBA,EAAA,EACrBC,MACAC,EAAenB,EAAciB,EAC7BG,IACAj3B,GAAU,EACVk3B,IAAiBl3B,EAAA,EAEjBm3B,IAA0Bn3B,EAAU,GAAA6T,EAAAqjB,GAAAvC,EAAA,GACpCyC,IACJzB,IACF,eAAcwB,CAEd,gBAEI5tC,QAAM,IAAAyW,CAAA,KAAAA,CAAA,IAAAm3B,CAAA,IAAAC,CAAA,GACNC,mCACAC,kBAAM,qBACN,UAAAxuC,EAAA,OAAgB,CAAoBE,SAEpCF,GAAA,KAAAE,qBACK3F,SAAG,CAAA4F,EAAA,QAAiBD,QAEnB2I,EAAE,MACFC,MAAE,IACF+B,OAAM,IACNC,YACA2jC,OAAK,eACLC,eAAO,IACP,GAAAZ,EACAa,GAAIb,IACJc,EAAId,QACL,EACD3tC,IACE0I,EAAE,IACFC,MAAE,IACF+B,OAAM,IACNC,oBACA2jC,KACAE,GAAIZ,GACJa,CAAIb,GACJ/tC,EAAA,KACD,GACHA,uBAAGzF,SAAG,CAAA4F,EAAA,QAAsBD,QAExB2I,EAAE,MACFC,MAAE,IACF+B,OAAM,IACNC,YACA2jC,OAAK,QACLC,eAAO,IACP,GAAAZ,EACAa,GAAIb,IACJc,EAAId,QACL,EACD3tC,IACE0I,EAAE,IACFC,MAAE,IACF+B,OAAM,IACNC,aACA2jC,KACAE,GAAIZ,GACJa,CAAIb,GACJjjB,GAAA9qB,EAAA,UACD,GACF8qB,YACSvwB,SAAG,CAAA4F,EAAA,kBAAWD,mBACJ2uC,aAAG,MAAgBC,kBAAa,CAAK,KACrD3uC,WAAeE,OAAK,MAAW7F,EAAO,uBAAK,SAC3C,CAAA2F,EAAA,WAAAD,cACWG,MAAK,MAAS0uC,UAAM,QAAMC,YAAU,CAAO,KACpD7uC,SAASE,MAAK,MAAS0uC,UAAM,QAAMC,YAAU,CAAO,KACpD7uC,SAASE,MAAK,MAAS0uC,UAAM,OAAMC,CAAU,EAAK,CAAG,GACjClkB,GAAA9qB,EAAA,QAChB,GAET8qB,kBACOvwB,SAAG,CAAA4F,EAAA,QAAiBD,aAEtBuuC,OAAK,QACLC,eAAO,IACP,kBAAa,QACb,yBACA,EAAAvK,CAAe,GACfl4B,EAAGk4B,KACJ,GACDhkC,wBAAG5F,SAAG00C,EAAA,IAAAhH,GAAA9nC,EAAA,OAAuBD,6BAIvBoT,IAAK,EACLzK,EAAGo/B,EAAIp/B,MACJo/B,EAAIn/B,eAAEijC,GAHQ9D,GAKpB9nC,EAAA,UACA,GACF4rC,EAAeI,IAEZqB,GAAIU,EAAeD,EAAkB,EACrCR,IAAmBQ,EACnBnyC,KAAGmyC,OAAkB,GACrBQ,GAAK,CAAA9C,GAAAxrC,EAAA,QACN,EAEF4rC,EAEGljC,EAAGqlC,EACHplC,MAAGqlC,EACHtjC,OAAOojC,EACPnjC,YAAQmjC,EACRQ,CAAK,GAERtuC,EAAA,QACG,GAERA,aACE5F,KAAG,eACHk0C,OAAK,eACLC,eAAO,IACP,kBAAa,QACb,yBACA,EAAAvK,CAAe,EACfl4B,CAAGk4B,GACHhkC,EAAA,OACE,KACNA,aAAA,GAAKmT,EAAK,KAAe,GACzBnT,mBAAG5F,SAAG00C,EAAA,IAAAhH,GAAA9nC,EAAA,OAAkBD,wBAIlBoT,IAAK,EACLzK,EAAGo/B,EAAIp/B,MACJo/B,EAAIn/B,eAAEgiB,GAHa3qB,EAKzB,KACA,KACF2qB,wBACI+e,SAAK1pC,EAAA,SAAuBD,OAE3BoT,KAAMwX,EACNjiB,EAAG,CAACqO,EAAUg4B,EACdpmC,MAAIoO,EAAUg4B,IACdrkC,SAAsBqkC,EAAQ,EAC9BpkC,2BACAqkC,cACAC,wBAAQ,EACD,GACRne,GAAA8a,GAAA5rC,EAAA,SACA,KAEJ8wB,EAEG3d,IACAzK,EAAGqlC,EACHplC,MAAGqlC,EACHtjC,OAAOojC,EACPnjC,oBAAQmjC,iBACRkB,cAAoB,UAAAlB,EAAA,UAAAA,EAAA,OAAAA,EAAA,gBACpBljB,GACEohB,mBAIH,EAEFphB,EAEGliB,EAAGgkC,EAAAuB,GACHtlC,MAAG+jC,EACHhiC,OAAOgiC,EACP/hC,SAAQ+gC,SAAc3rC,MAGpBE,MAAKwrC,+BACL4C,MAAM,kBACN/tC,wBAAM,CACN4wB,QAAyB,CAAUtG,EAAQ,EAAE,CAC9C,EAEJ,CC7VA,MAAMskB,GAAwB,CAAC,CAAC34B,UAAU44B,cAAcC,aAE/D,SAASC,GAAY,CACnBloB,OACA2J,QACAnG,iBACAC,UACA5pB,UACA6pB,gBACF,EAAG,CACD,KAAM,CAAE7xB,KAAGC,KACXR,gBAEA,gCACO6H,SAAM,CAAAT,EAAA,OAAyBE,+BAC7BO,SAAM,CAAA4uC,IAAA,OAAArkB,GAAA,WAAA7qB,EAAA,wBAECE,MAAK,SAASI,QAAMuqB,EAAS1qB,SAAS0qB,KAAe9qB,YACrDW,MAAevE,CAAE,aAAc,EAAC,GAAG6D,EAAA,aAAAgB,GAAAhB,EAAA,UACnC,KAERA,SAGQE,MAAK,SAASI,QAAMU,EAASb,SAASa,KAAQjB,SAC9CW,MAAYvE,CAAE,aAAO,EAAC,EAAC,CAAE,GAElC6D,EAAAurC,GAAA,CACE,KAAApkB,EAEHA,QACA2J,iBACAnG,YACAC,SACD,MACD,eAAKtqB,SAAM6mB,CAAA,EAAcpnB,CAAEonB,EAAW,CCrC5C,MAAMmoB,GAAqB,oBAAqBp5C,OAE3Co5C,IAEH/1C,WAAW,IAAM,CACfg2C,GAAA,WAAO,mBAAW,8CAAEhxB,MAAM,IAAM,CAAC,CAAC,CACpC,EAAG,GAAI,EAOT,MAAMixB,EAAS,CACbC,YAAYC,EAAQC,EAAQ,CAC1B,KAAKD,OAASA,EACd,KAAKC,OAASA,EACd,KAAKC,UAAUF,CAAM,CACvB,CACAE,UAAUF,EAAQ,CAChB,KAAKA,OAASA,EACd,KAAM,CAAEC,UAAW,KACnBA,EAAOE,aAAa,WAAY,EAAE,EAClCF,EAAOE,aAAa,QAAS,EAAE,EAC/BF,EAAOE,aAAa,cAAe,EAAE,EACrCF,EAAOG,UAAYJ,CACrB,CACA,MAAMK,aAAc,CAClB,GAAI,CAACx5B,UAAU44B,cAAgB,CAAC54B,UAAU44B,aAAaa,iBACrD,MAAM,IAAIC,MAAM,6BAA6B,EAE/C,OADgB,MAAM15B,UAAU44B,aAAaa,oBAE1Czc,OAAQ2c,GAAWA,EAAOC,OAAS,YAAY,EAC/C3tC,IAAKqF,IAAO,CACXuoC,SAAUvoC,EAAEuoC,SACZ9tC,MAAOuF,EAAEvF,OAAS,UAAUuF,EAAEuoC,QAAQ,IACtC,CACN,CACA,MAAMC,UAAUD,EAAU,CACxB,KAAKE,OACL,MAAMZ,EAAS,MAAMn5B,UAAU44B,aAAaC,aAAa,CACvDmB,MAAO,CAAEH,SAAU,CAAEI,MAAOJ,EAAS,CAAE,CACxC,EACD,KAAKR,UAAUF,CAAM,CACvB,CACAe,UAAU3gB,EAAQ4gB,EAAW,GAAO,CAClC,KAAM,CAAEf,UAAW,KACnB,GAAIe,SACK5gB,EAAOS,UAAUof,EAAQA,EAAOgB,YAAahB,EAAOiB,UAAU,EACvE,MAAMjwC,EAAOkwC,QAAQlB,CAAM,EAC3B,OAAO7f,EAAOS,UAAUof,EAAQhvC,EAAKgK,OAAQhK,EAAK+J,KAAK,CACzD,CACA4lC,MAAO,CACL,UAAWQ,KAAS,KAAKpB,OAAOqB,cAAmBT,MACrD,CACF,CAGA,MAAMU,GAAiB,MAAOrB,GAAW,CACvC,GAAIp5B,UAAU06B,aAAaC,MACzB,GAAI,EACiB,MAAM36B,UAAU06B,YAAYC,MAAM,CACnD/7B,KAAM,SACP,GACOvC,iBAAI,aAA6B6L,GAEzCA,MAAW/lB,EACoD,MAC9Dg3C,EAAA,2CACH,OACEj3C,OAAQukB,CACV,WAGF,MAAM0yB,CACJa,MAAO,MACG,WAAS,cAAI,GACd,OAAEY,OAAOzB,EAAAC,CAAA,GAAK,SACrByB,GAAY,SAAApwC,EAEhB,cAAAqwC,EACA,eAAApkB,CACF,GAEA,MAA0BjsB,IAASqwC,KAAepkB,KAAkBqkB,EAAAn5C,EAAA,MAC5Do5C,EAAAp5C,EAAA,MAAEa,UAAG8Y,YAAG7Y,GAAAu4C,CAAA,EAAAp4C,EAAA,IACRk4C,MAAsBl4C,EAAI,WAChChB,EAAMm5C,KACN,IAAME,EACN,OAAM,QAACC,aAAaC,MAAcL,EAAa,UAC/CM,EAAoCx4C,KAC9B,MAAC4nB,cAAgC,KAAS,uDAGhD5oB,EAAgB,qCAAAy5C,IAAA,YAEd,EACA,OAAIC,YAAQC,iBAAqBT,SAAaj5C,CAAS,EACrDu5C,KAMEN,KAIFM,GAAA,0CAEAE,OAAOC,YAAYr5C,oBACjB,SACAk5C,CACF,CAEF,CACA,MACEx5C,EACEw5C,KAGAE,MAIFE,EACFC,EACGC,EAEL95C,EA8EkBK,WA7EZ05C,UACJ,GAAIH,CACAC,sBACAC,GACAE,yCAEgB,CAClB,CAAI,GAGFA,EAAI9C,uCAAoB,8CACtB4C,EAAW,IAAIG,YAAkBC,QAASb,EAAU,SAAG,CACzD,aAAO,GACLW,+BACAH,mBAAqBM,wBACnB,IAGA,MACEC,IAAc,QACdC,IAAkBlC,EAClBmC,iBAAoB,sBAExBp1B,EAAA,UACF,GAGAizB,mBAAuBl4C,YACnBk4C,MACFA,WAAM73C,EACJ4kB,YAAW3S,CAAS,EACrB4lC,EAMqB7lC,GALhBhS,OAEJD,EAAY,6CAA4C,SAAAiS,EAAAC,CAAA,GAGxD2mC,EAAM,uDAAA5mC,EAAAC,CAAA,IAAqBgmC,GAAahmC,CAAO,MAAI4lC,YAEnD93C,GAAQma,CAAYo/B,kCAAKzB,YAAOoB,EAAA7nB,EAAA,YAG9BwnB,MAAaj5C,EAIbi5C,EAIF,IAAAqB,EAEA,MAAIrD,MAAoB,CACtBsD,IACED,EAAI,sBAAAE,CAAA,CACF,EACAA,EAAA,EACEp6C,EAAQma,IAAI,sBAAmC,CAC/C++B,MAAkC,MACpCiB,EAAA,KACF,IACEn6C,0BACFk6B,GAAA,MACFgf,EAAAhf,CAAA,CAGA,QACEigB,EACAD,eAAoCE,CAAO,CAE7CA,GACuD,MAClD,CACLv1B,EAAA,SACEk0B,EAAI,GACF,CACA,GAEEG,EACF,KAEAl5C,GAAQ6Y,IAA8B0gC,GACxCA,EAAA,KACF,EAEyCC,GAC3CA,EACD,OACH,CAEAx5C,IAAQ6Y,GACRgM,QAAkB,OAAA+zB,GAAA,WAAAA,EAAAK,CAAA,IAAAA,EAClBF,eAAc,CAAK,MACrB,mBACF,UAAA3xC,EAAA,OAEA,MAAIizC,oBACFC,YAAYjvB,GAAA,CACd,UAEA,OAAO9C,IAAM,SACX,GAAImxB,WAAgBA,CACpB,KAAIH,SACFA,MAAI1B,SACN,QAAAtvC,EACA,SAAIixC,EAAUxxC,EAAA,CACZwxC,SACF,IAAA91C,EAEA22C,CAEEE,WAKN,CACE,CAAW,CAAkBjzC,CAC3B,CAAKO,EAAM,GAAmBP,IAC5BC,QAAOA,EAAA,aAACgiB,WAAM,SAAShB,OAAwB,SAC/ChhB,EAAAgC,EAAA,CAAQ9B,GAAK,SAASI,CAAM,EAAkBU,GAAQjB,IACnDU,CAAI,SAAM,CAAAZ,EAAA,WAAIe,EAAGzE,4CAAE,CAAA6D,EAAA,aAAA5F,EAAA,YAAO,GAAC,SAAG,2BACxB,GAAAk1C,IAAAtvC,EAAA,UAEVghB,MACM1gB,MAAM,oBAAUP,UACnB,CAAAA,+BACE3F,QAAA,cAAgE,oCAC/D,UAAA4F,EAAA,QAGLH,EAAAC,wCAAAC,OACEF,eAAKI,eAAKqxC,IAAchxC,KAAM,OAA4BP,iBACxD,QAAOE,IAAKsxC,QAAU0B,0CAAYC,OAAK,eAACC,mBACvC,KAAC7D,OACQrvC,iBAAKwxC,QAAYnxC,IAAM,QAEjCT,0CACES,OAAM,eACN8tC,eAAQ,IACRY,YAAmCjvC,iBAEnC,UACE+L,EAAE,QACFyiC,0CACA,sBACAD,eAAK,IACL,YACD,iBACD,SACExiC,CAAE,GACK,GAAA9L,EACP,OAAa,MACbsuC,oBAAK,SACL,EAAAoD,GAAe7xC,EAAAC,EAAA,CAAO,SAExB,CAAAE,EAAA,KACE8L,MAAE,kBACFyiC,SAAOmD,CAAA,GACPsB,GAAahzC,EAAA,UACbsuC,KAAK,SACL,sBACD,QACD,KACExiC,EAAE,CACFyiC,KAAOmD,CAAA,CACP,CACApD,EACA,SAAArhB,EAAenb,EAAAmb,CAAA,EAAAjtB,EAAAS,EAAA,CACf,mBACE,EAERT,EAAA,CAAKM,CAAM,EAAmBP,CAE1B,GACE,EAAS,CClSzB,MAAMqzC,GAAa,CAAiB,OAAQ,QAAS,YAAa,OAAO,EAGnEC,GAAkB,CAKtBC,KAAM,CACJhxC,MAAO,CAAAlI,GAAA,UACPwmC,YAAa,CAAAxmC,GAAA,SAA2D,EAE1Em5C,MAAO,CACLjxC,MAAO,CAAAlI,GAAA,UACPwmC,YAAa,CAAAxmC,GAAA,SAAoD,EAEnEo5C,UAAW,CACTlxC,MAAO,CAAAlI,GAAA,UACPwmC,YAAa,CAAAxmC,GAAA,UACbq5C,WAAY,CAAAr5C,GAAA,SAAa,EAE3Bs5C,MAAO,CACLpxC,MAAO,CAAAlI,GAAA,UACPwmC,YAAa,CAAAxmC,GAAA,UACbu5C,aAAc,GAElB,EAEA,SAASC,GAAqBC,EAAMC,EAAa,CAC/C,GAAI,CAACD,EAAKE,cAAgB,CAACD,EAAa,OAAO,KAC/C,MAAME,EAAqBp7B,OAAOxU,KAAKyvC,EAAKE,YAAY,EACxD,GAAI,CAACC,GAAoBx5C,OAAQ,OAAO,KAExC,IAAIy5C,EAAcrb,GAAY,CAACkb,CAAW,EAAGE,EAAoB,IAAI,EACrE,GAAI,CAACC,EAAa,CAIhB,MAAMC,EAAsBF,EAAmBxxC,IAAKgS,GACpCA,EAAKwL,MAAM,WAAW,EAEjCxd,IAAI,CAAC2xC,EAAMtsC,IAAOA,IAAM,EAAIssC,EAAOA,EAAKn2C,aAAc,EACtDgP,KAAK,GAAG,CACZ,EACDinC,EAAcrb,GAAY,CAACkb,CAAW,EAAGI,EAAqB,IAAI,CACpE,CAIA,GAAID,GAAeA,EAAYtlC,SAAS,GAAG,EAAG,CAC5C,KAAM,CAAC6F,EAAM4/B,CAAM,EAAIH,EAAYj0B,MAAM,GAAG,EAC5Ci0B,EAAcz/B,EAAO4/B,EAAOC,OAAO,CAAC,EAAEC,cAAgBF,EAAO5nC,MAAM,CAAC,CACtE,CAEA,OAAOynC,CACT,CAEA,SAASM,GAAeC,EAAOV,EAAa,CAC1C,OAAKU,GAAOh6C,OACPs5C,EACEU,EAAMhyC,IAAKqxC,GAAS,CACzB,MAAMI,EAAcL,GAAqBC,EAAMC,CAAW,EAC1D,MAAO,CACL,GAAGD,EACHY,gBAAiBZ,EAAKE,eAAeE,CAAW,GAAG9sB,MAAQ,KAE/D,CAAC,EAPwBqtB,EADE,EAS7B,CAEA,SAASE,GAAY,CAAEviC,UAASxS,OAAMqB,SAAQ,EAAG,CAC/C,KAAM,CAAE8Q,IAAG9Y,IAAGmb,QAAMlb,KACd,CAAEQ,SAAUyB,KACZ,CAAC8lB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAAC0mB,EAAU60B,CAAM,EAAIxiC,EAAQ0N,KAAKG,MAAM,GAAG,EAE3C,CAAC40B,EAAiBC,CAAa,EAAIvgC,GAAQ,IAAM,CACrD,KAAM,CAAEkgC,QAAOG,UAAWG,KAE1B,MAAO,CAACP,GADSC,GAAS,GACOrgC,EAAKS,MAAM,EAAG+/B,CAAM,CACvD,EAAG,CAACxgC,EAAKS,MAAM,CAAC,EAEV,CAACmgC,EAAkBC,CAAmB,EAAI57C,EAAS,IAAI,EACvD,CAAC67C,EAAWC,CAAY,EAAI97C,EAAS,EAAK,EAE1C+7C,EAAWh9C,EAAO,IAAI,EACtB,CAACi9C,EAAUC,CAAW,EAAIj8C,EAAS,EAAK,EAE9C,OACEyG,EAAA,OAAKS,MAAM,yBAAwBP,UACjCF,EAAA,OAAKS,MAAM,eAAcP,UACvBC,EAAA,MAAAD,SAAS5D,EAAJwD,EAAO,CAAAvF,GAAA,UAAiB,CAAAA,GAAA,SAAAC,OAAA,CAAAylB,WAAoB,CAAxB,CAA0B,CAAK,EACxD9f,EAAA,UACEE,KAAK,SACLI,MAAM,eACN+B,SAAU2e,IAAY,UACtB7gB,QAASA,IAAMa,IAAUjB,SAEzBC,EAACS,EAAI,CAACC,KAAK,IAAIC,KAAK,KAAKC,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EACnC,CAAC,EACN,EACLyF,EAAA,QAAAE,UACEC,EAAA,OAAKM,MAAM,iBAAgBP,SACxBJ,EACCK,EAAC01B,GAAM,CAAClnB,OAAQ7O,EAAMgB,KAAK,IAAI20C,YAAW,GAAE,EAE5Ct1C,EAAC+jB,GAAY,CACX5R,UACA6R,WAAW,MACXuxB,gBAAe,GACf5f,UAAS,GACT6f,aAAY,GACb,EAEA,EACJ,CAAC,CAACT,GACD,CAAC1B,GAAgB0B,CAAgB,EAAEpB,cACjC9zC,EAAA,QACES,MAAM,eAEN,cAAY,OAAMP,SAAA,CAEjB+R,EACCuhC,GAAgB0B,CAAgB,EAAEtB,YAChC3hC,EAAEuhC,GAAgB0B,CAAgB,EAAEzyC,KAAK,CAC7C,EACAtC,EAAA,SAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA4B,EACvB,CAAC,GATH26C,CAUD,EAEVl1C,EAAA,QACE8lB,SAAW1uB,GAAM,CACfA,EAAEoJ,iBAEF,MAAM4Z,EAAW,IAAIC,SAASjjB,EAAEoK,MAAM,EAChCwE,EAAU+S,OAAOgF,YAAY3D,EAASpU,SAAS,EACrDpN,IAEA,SAAAg9C,EAAMA,UAAU1uB,WAAS2uB,EAAY7vC,cACjC6vC,IAAU3uB,SAAUtoB,IACxB,MAAIi3C,EAAYD,IAAMC,YAAU,eAAA7vC,CAAA,WAAA9H,CAAA,IAAAA,EAAA,8BAAAA,EAAAzD,CAAA,IAAAA,CAAA,SAC1Bq7C,GAON,SAAAF,EACEA,UACA1uB,UACA2uB,WAEFp4B,EAAA,YACA7kB,UAEA6kB,IACC,MAAA7jB,EAAY,mBACP,UAAA0Y,EAAA,GACF,UAAYpY,GAAG67C,GAAQ3/B,GAAO,WAC5B4/B,WACAC,UACAL,UACA1uB,YACA4uB,EACAD,WACFr5C,GAACF,EAAAwD,EAEDtD,CAAcF,aAAmB,CAAAA,YAAhB,CAAmB,EAAA6E,EAAkB,QAACsQ,EAAA,CACvDtQ,EAAQ,YACDsQ,GAAO,SAAAnV,EAAAwD,EAEd2d,CACAjhB,WAESF,EACsB,CAACA,YADvBA,CAED,MAA0B,EAClC,SACF,CAAA6D,EAAA,KACF,SAAG7D,EAAAwD,EACHI,YAGK5D,EACiC,CAACA,YADlCA,CAED,GAAA6D,EAAA5F,UAAA,OAAqC,oBAAC,SAAAg5C,GAAA,IAAAqC,OAAA,cAAAb,GAAA,YAAA/0C,EAAAk2C,EAAA,CAE5C/1C,SAAA,CAAAH,EAAA,SAASS,MAAM,kBAAmBP,SAC/BqzC,WAAgBqC,CAEJ11C,aACAO,KAAM,WAAiBP,QAE1BG,SAAK,GACLiV,SAAK6L,IAAA,UACL1mB,SAAOm7C,IACP90B,EAAQ1pB,EAAA,gBACE+pB,SAAY,oBACtBvL,CACEu/B,aACAE,eAAsB56C,CAAU,SAAW,KAAA0F,EAAA,SAC7C,yBAEFH,SAAAiS,EAAAuhC,GAAAoC,CAAA,eAAA11C,EAEE,GAAa,GAAA01C,IACV3jC,aAAEuhC,EAAgBoC,GAAU7U,QAAW5gC,EAAA,aAClC,uCACH,CAAAi1C,WAERQ,EAAa,OAEVn1C,MAAM,kCACG20C,SAAUl1C,qBAEdO,IAAM60C,EAAwBp1C,WACjC,KAAA8zC,EAAAhsC,IAAAhI,EAAA,SAAKS,MAAM,cAAeL,SAAKk1C,iBAC5BP,WACQt0C,KAAM,YAAAuH,CAAA,IAAa9H,QACxBC,GACEE,SAAK+0C,GAAA,CAAAG,EACLjgC,aAAmB,UACnB7a,SAAOu5C,GAAKz5C,CACZumB,eACsB,WAEpBnF,EAAQA,MACK25B,EAAA,0CACK,QAClBE,EAAO,GAMHA,CAAiB,GAAAr1C,EACnB,iBACF6zC,EAAA,iBAAAA,EAAA,MACF,GACDA,EACD7zC,GAAA,GAAoCmnB,EAAY,GAEnD,EAAAsuB,CACE,KAAA51C,EACF,iBAER,2BACOG,EAEd,KAEFH,SAAAG,EAAA,SAASM,IAAM,iBAAgBP,SAC7BC,EAAAgC,EAAA,CAAAjC,WACE,CAAOmb,CAAI,EACT,GAAAlb,EAAA5F,WAAA,WAA6B,OAAC,KACzB,IACN,KACH4F,UACEg2C,oBACAC,SAAKj1B,IAAA,UACL7L,SAAK,CAAAxV,CACF,EACH0C,CAAsB,GACtBse,KAAWhhB,oCACX,SAAAE,EAAA,SAED80C,SAAUA,WAAWE,CACtB90C,gBACEA,UACEA,eAEIG,SAAK8gB,IAAA,YACLk1B,MAAM,QACN/gC,SAAKnV,EAAAgC,EAAA,aAEJ,OACHhC,CAAAD,QACE,EAAA1F,WAAA,CAAAs6C,YACuB,KAAI,EAAC,EACrB,GAAA90C,EACF,mBACF,CAAAG,EAAA,UACN,cAGPH,SAAAmhB,IAAA,UAAAjhB,SACEC,EAAAgC,EAAA,CAAQ9B,GAAK,UAA+B,GAAUH,eACpDiC,CAAA,oBAAyB,SACnB,SACRhC,IAAA,UACEE,QAAK,UACLI,UACU0gB,cAAY,QAAA7O,EAAA,cACbhW,EAEL,CACAE,YAASF,QAAC,SAAA2jB,CAAA,IAAAA,MAAkB,CAAAzjB,GAACF,GAE7B1D,GAAQ6Y,SACRjV,OAASF,YAAC,IAAA2jB,EAA2B,SAAC9f,EAAAgC,EAAA,IAAC,SACzC,YAEF,EAAAhC,EAAA,SAAED,UAEF,CAAA3F,CAAA,GACc,OAAOkG,WAAM,MAA0B,eAAC,kBAC/C0gB,IAAA,UACD,QACRhhB,SAAA,CACEE,GAAK,CACLI,MAAM7G,EAAA,oBAAA0Y,EAAA,eACI6O,EAEJ,CACF,YACA3kB,OAASF,YAAC,SAAA2jB,IAAoB3jB,EAAE,IACzBlF,SACPwB,QACA4D,UAASF,EAAC,KAAA2jB,SAA4B9f,EAAAgC,EAAA,IAAC,oBAAC,CAC1C,EAAAhC,EAAA,SAEF,WAAED,CAEF,MAAAC,EACcA,GAAA,QAAOM,IAAM,YAA2B,GAAC,GAChD,GAEF,EAAqB,kFCnVxC,IAAI61C,GAAY,UAAW,CAG3B,IAAIC,EAAI,OAAO,aACXC,EAAe,oEACfC,EAAgB,oEAChBC,EAAiB,GAErB,SAASC,EAAahU,EAAUiU,EAAW,CACzC,GAAI,CAACF,EAAe/T,CAAQ,EAAG,CAC7B+T,EAAe/T,CAAQ,EAAI,GAC3B,QAAS36B,EAAE,EAAIA,EAAE26B,EAAS,OAAS36B,IACjC0uC,EAAe/T,CAAQ,EAAEA,EAAS,OAAO36B,CAAC,CAAC,EAAIA,CAErD,CACE,OAAO0uC,EAAe/T,CAAQ,EAAEiU,CAAS,CAC3C,CAEA,IAAIN,EAAW,CACb,iBAAmB,SAAUzT,EAAO,CAClC,GAAIA,GAAS,KAAM,MAAO,GAC1B,IAAIp0B,EAAM6nC,EAAS,UAAUzT,EAAO,EAAG,SAAS32B,EAAE,CAAC,OAAOsqC,EAAa,OAAOtqC,CAAC,CAAE,CAAC,EAClF,OAAQuC,EAAI,OAAS,EAAC,CACtB,QACA,IAAK,GAAI,OAAOA,EAChB,IAAK,GAAI,OAAOA,EAAI,MACpB,IAAK,GAAI,OAAOA,EAAI,KACpB,IAAK,GAAI,OAAOA,EAAI,GACxB,CACA,EAEE,qBAAuB,SAAUo0B,EAAO,CACtC,OAAIA,GAAS,KAAa,GACtBA,GAAS,GAAW,KACjByT,EAAS,YAAYzT,EAAM,OAAQ,GAAI,SAASniB,EAAO,CAAE,OAAOi2B,EAAaH,EAAc3T,EAAM,OAAOniB,CAAK,CAAC,EAAI,CAC7H,EAEE,gBAAkB,SAAUmiB,EAAO,CACjC,OAAIA,GAAS,KAAa,GACnByT,EAAS,UAAUzT,EAAO,GAAI,SAAS32B,EAAE,CAAC,OAAOqqC,EAAErqC,EAAE,EAAE,CAAE,CAAC,EAAI,GACzE,EAEE,oBAAqB,SAAU2qC,EAAY,CACzC,OAAIA,GAAc,KAAa,GAC3BA,GAAc,GAAW,KACtBP,EAAS,YAAYO,EAAW,OAAQ,MAAO,SAASn2B,EAAO,CAAE,OAAOm2B,EAAW,WAAWn2B,CAAK,EAAI,EAAG,CAAE,CACvH,EAGE,qBAAsB,SAAUo2B,EAAc,CAI5C,QAHID,EAAaP,EAAS,SAASQ,CAAY,EAC3CC,EAAI,IAAI,WAAWF,EAAW,OAAO,CAAC,EAEjC7uC,EAAE,EAAGgvC,EAASH,EAAW,OAAQ7uC,EAAEgvC,EAAUhvC,IAAK,CACzD,IAAIivC,EAAgBJ,EAAW,WAAW7uC,CAAC,EAC3C+uC,EAAI/uC,EAAE,CAAC,EAAIivC,IAAkB,EAC7BF,EAAI/uC,EAAE,EAAE,CAAC,EAAIivC,EAAgB,GACnC,CACI,OAAOF,CACX,EAGE,yBAAyB,SAAUF,EAAY,CAC7C,GAAIA,GAAa,KACb,OAAOP,EAAS,WAAWO,CAAU,EAGrC,QADIE,EAAI,IAAI,MAAMF,EAAW,OAAO,CAAC,EAC5B7uC,EAAE,EAAGgvC,EAASD,EAAI,OAAQ/uC,EAAEgvC,EAAUhvC,IAC7C+uC,EAAI/uC,CAAC,EAAE6uC,EAAW7uC,EAAE,CAAC,EAAE,IAAI6uC,EAAW7uC,EAAE,EAAE,CAAC,EAG7C,IAAI8qB,EAAS,GACb,OAAAikB,EAAI,QAAQ,SAAU5hC,EAAG,CACvB2d,EAAO,KAAKyjB,EAAEphC,CAAC,CAAC,CAC1B,CAAS,EACMmhC,EAAS,WAAWxjB,EAAO,KAAK,EAAE,CAAC,CAIlD,EAIE,8BAA+B,SAAU+P,EAAO,CAC9C,OAAIA,GAAS,KAAa,GACnByT,EAAS,UAAUzT,EAAO,EAAG,SAAS32B,EAAE,CAAC,OAAOuqC,EAAc,OAAOvqC,CAAC,CAAE,CAAC,CACpF,EAGE,kCAAkC,SAAU22B,EAAO,CACjD,OAAIA,GAAS,KAAa,GACtBA,GAAS,GAAW,MACxBA,EAAQA,EAAM,QAAQ,KAAM,GAAG,EACxByT,EAAS,YAAYzT,EAAM,OAAQ,GAAI,SAASniB,EAAO,CAAE,OAAOi2B,EAAaF,EAAe5T,EAAM,OAAOniB,CAAK,CAAC,EAAI,EAC9H,EAEE,SAAU,SAAUo2B,EAAc,CAChC,OAAOR,EAAS,UAAUQ,EAAc,GAAI,SAAS5qC,EAAE,CAAC,OAAOqqC,EAAErqC,CAAC,CAAE,CAAC,CACzE,EACE,UAAW,SAAU4qC,EAAcI,EAAaC,EAAgB,CAC9D,GAAIL,GAAgB,KAAM,MAAO,GACjC,IAAI9uC,EAAGvN,EACH28C,EAAoB,GACpBC,EAA4B,GAC5BC,EAAU,GACVC,EAAW,GACXC,EAAU,GACVC,EAAmB,EACnBC,EAAkB,EAClBC,EAAiB,EACjBC,EAAa,GACbC,EAAiB,EACjBC,EAAsB,EACtBC,EAEJ,IAAKA,EAAK,EAAGA,EAAKjB,EAAa,OAAQiB,GAAM,EAQ3C,GAPAT,EAAYR,EAAa,OAAOiB,CAAE,EAC7B,OAAO,UAAU,eAAe,KAAKX,EAAmBE,CAAS,IACpEF,EAAmBE,CAAS,EAAII,IAChCL,EAA2BC,CAAS,EAAI,IAG1CC,EAAaC,EAAYF,EACrB,OAAO,UAAU,eAAe,KAAKF,EAAmBG,CAAU,EACpEC,EAAYD,MACP,CACL,GAAI,OAAO,UAAU,eAAe,KAAKF,EAA2BG,CAAS,EAAG,CAC9E,GAAIA,EAAU,WAAW,CAAC,EAAE,IAAK,CAC/B,IAAKxvC,EAAE,EAAIA,EAAE2vC,EAAkB3vC,IAC7B6vC,EAAoBA,GAAoB,EACpCC,GAAyBZ,EAAY,GACvCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAIJ,IADAr9C,EAAQ+8C,EAAU,WAAW,CAAC,EACzBxvC,EAAE,EAAIA,EAAE,EAAIA,IACf6vC,EAAoBA,GAAoB,EAAMp9C,EAAM,EAChDq9C,GAAyBZ,EAAY,GACvCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFr9C,EAAQA,GAAS,CAE/B,KAAiB,CAEL,IADAA,EAAQ,EACHuN,EAAE,EAAIA,EAAE2vC,EAAkB3vC,IAC7B6vC,EAAoBA,GAAoB,EAAKp9C,EACzCq9C,GAAwBZ,EAAY,GACtCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFr9C,EAAQ,EAGV,IADAA,EAAQ+8C,EAAU,WAAW,CAAC,EACzBxvC,EAAE,EAAIA,EAAE,GAAKA,IAChB6vC,EAAoBA,GAAoB,EAAMp9C,EAAM,EAChDq9C,GAAyBZ,EAAY,GACvCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFr9C,EAAQA,GAAS,CAE/B,CACUg9C,IACIA,GAAqB,IACvBA,EAAoB,KAAK,IAAI,EAAGE,CAAe,EAC/CA,KAEF,OAAON,EAA2BG,CAAS,CACrD,KAEU,KADA/8C,EAAQ28C,EAAmBI,CAAS,EAC/BxvC,EAAE,EAAIA,EAAE2vC,EAAkB3vC,IAC7B6vC,EAAoBA,GAAoB,EAAMp9C,EAAM,EAChDq9C,GAAyBZ,EAAY,GACvCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFr9C,EAAQA,GAAS,EAKrBg9C,IACIA,GAAqB,IACvBA,EAAoB,KAAK,IAAI,EAAGE,CAAe,EAC/CA,KAGFP,EAAmBG,CAAU,EAAIG,IACjCF,EAAY,OAAOF,CAAS,CACpC,CAII,GAAIE,IAAc,GAAI,CACpB,GAAI,OAAO,UAAU,eAAe,KAAKH,EAA2BG,CAAS,EAAG,CAC9E,GAAIA,EAAU,WAAW,CAAC,EAAE,IAAK,CAC/B,IAAKxvC,EAAE,EAAIA,EAAE2vC,EAAkB3vC,IAC7B6vC,EAAoBA,GAAoB,EACpCC,GAAyBZ,EAAY,GACvCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAIJ,IADAr9C,EAAQ+8C,EAAU,WAAW,CAAC,EACzBxvC,EAAE,EAAIA,EAAE,EAAIA,IACf6vC,EAAoBA,GAAoB,EAAMp9C,EAAM,EAChDq9C,GAAyBZ,EAAY,GACvCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFr9C,EAAQA,GAAS,CAE7B,KAAe,CAEL,IADAA,EAAQ,EACHuN,EAAE,EAAIA,EAAE2vC,EAAkB3vC,IAC7B6vC,EAAoBA,GAAoB,EAAKp9C,EACzCq9C,GAAyBZ,EAAY,GACvCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFr9C,EAAQ,EAGV,IADAA,EAAQ+8C,EAAU,WAAW,CAAC,EACzBxvC,EAAE,EAAIA,EAAE,GAAKA,IAChB6vC,EAAoBA,GAAoB,EAAMp9C,EAAM,EAChDq9C,GAAyBZ,EAAY,GACvCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFr9C,EAAQA,GAAS,CAE7B,CACQg9C,IACIA,GAAqB,IACvBA,EAAoB,KAAK,IAAI,EAAGE,CAAe,EAC/CA,KAEF,OAAON,EAA2BG,CAAS,CACnD,KAEQ,KADA/8C,EAAQ28C,EAAmBI,CAAS,EAC/BxvC,EAAE,EAAIA,EAAE2vC,EAAkB3vC,IAC7B6vC,EAAoBA,GAAoB,EAAMp9C,EAAM,EAChDq9C,GAAyBZ,EAAY,GACvCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFr9C,EAAQA,GAAS,EAKrBg9C,IACIA,GAAqB,IACvBA,EAAoB,KAAK,IAAI,EAAGE,CAAe,EAC/CA,IAER,CAII,IADAl9C,EAAQ,EACHuN,EAAE,EAAIA,EAAE2vC,EAAkB3vC,IAC7B6vC,EAAoBA,GAAoB,EAAMp9C,EAAM,EAChDq9C,GAAyBZ,EAAY,GACvCY,EAAwB,EACxBF,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClDA,EAAmB,GAEnBC,IAEFr9C,EAAQA,GAAS,EAInB,OAEE,GADAo9C,EAAoBA,GAAoB,EACpCC,GAAyBZ,EAAY,EAAG,CAC1CU,EAAa,KAAKT,EAAeU,CAAgB,CAAC,EAClD,KACR,MACWC,IAEP,OAAOF,EAAa,KAAK,EAAE,CAC/B,EAEE,WAAY,SAAUf,EAAY,CAChC,OAAIA,GAAc,KAAa,GAC3BA,GAAc,GAAW,KACtBP,EAAS,YAAYO,EAAW,OAAQ,MAAO,SAASn2B,EAAO,CAAE,OAAOm2B,EAAW,WAAWn2B,CAAK,CAAE,CAAE,CAClH,EAEE,YAAa,SAAU/lB,EAAQq9C,EAAYC,EAAc,CACvD,IAAIC,EAAa,GACbx9C,EACAy9C,EAAY,EACZC,EAAW,EACXC,EAAU,EACV38C,EAAQ,GACRo3B,EAAS,GACT9qB,EACAswC,EACAzP,EAAM0P,EAAMC,EAAUC,EACtBtjC,EACA7H,EAAO,CAAC,IAAI2qC,EAAa,CAAC,EAAG,SAASD,EAAY,MAAM,CAAC,EAE7D,IAAKhwC,EAAI,EAAGA,EAAI,EAAGA,GAAK,EACtBkwC,EAAWlwC,CAAC,EAAIA,EAMlB,IAHA6gC,EAAO,EACP2P,EAAW,KAAK,IAAI,EAAE,CAAC,EACvBC,EAAM,EACCA,GAAOD,GACZD,EAAOjrC,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAW0qC,EAChB1qC,EAAK,IAAM2qC,EAAa3qC,EAAK,OAAO,GAEtCu7B,IAAS0P,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAGZ,OAAQ/9C,EAAOmuC,EAAI,CACjB,IAAK,GAID,IAHAA,EAAO,EACP2P,EAAW,KAAK,IAAI,EAAE,CAAC,EACvBC,EAAM,EACCA,GAAOD,GACZD,EAAOjrC,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAW0qC,EAChB1qC,EAAK,IAAM2qC,EAAa3qC,EAAK,OAAO,GAEtCu7B,IAAS0P,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAEdtjC,EAAIohC,EAAE1N,CAAI,EACV,MACF,IAAK,GAID,IAHAA,EAAO,EACP2P,EAAW,KAAK,IAAI,EAAE,EAAE,EACxBC,EAAM,EACCA,GAAOD,GACZD,EAAOjrC,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAW0qC,EAChB1qC,EAAK,IAAM2qC,EAAa3qC,EAAK,OAAO,GAEtCu7B,IAAS0P,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAEdtjC,EAAIohC,EAAE1N,CAAI,EACV,MACF,IAAK,GACH,MAAO,EACf,CAII,IAHAqP,EAAW,CAAC,EAAI/iC,EAChBmjC,EAAInjC,EACJ2d,EAAO,KAAK3d,CAAC,IACA,CACX,GAAI7H,EAAK,MAAQ3S,EACf,MAAO,GAMT,IAHAkuC,EAAO,EACP2P,EAAW,KAAK,IAAI,EAAEH,CAAO,EAC7BI,EAAM,EACCA,GAAOD,GACZD,EAAOjrC,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAW0qC,EAChB1qC,EAAK,IAAM2qC,EAAa3qC,EAAK,OAAO,GAEtCu7B,IAAS0P,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAGZ,OAAQtjC,EAAI0zB,EAAI,CACd,IAAK,GAIH,IAHAA,EAAO,EACP2P,EAAW,KAAK,IAAI,EAAE,CAAC,EACvBC,EAAM,EACCA,GAAOD,GACZD,EAAOjrC,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAW0qC,EAChB1qC,EAAK,IAAM2qC,EAAa3qC,EAAK,OAAO,GAEtCu7B,IAAS0P,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAGZP,EAAWE,GAAU,EAAI7B,EAAE1N,CAAI,EAC/B1zB,EAAIijC,EAAS,EACbD,IACA,MACF,IAAK,GAIH,IAHAtP,EAAO,EACP2P,EAAW,KAAK,IAAI,EAAE,EAAE,EACxBC,EAAM,EACCA,GAAOD,GACZD,EAAOjrC,EAAK,IAAMA,EAAK,SACvBA,EAAK,WAAa,EACdA,EAAK,UAAY,IACnBA,EAAK,SAAW0qC,EAChB1qC,EAAK,IAAM2qC,EAAa3qC,EAAK,OAAO,GAEtCu7B,IAAS0P,EAAK,EAAI,EAAI,GAAKE,EAC3BA,IAAU,EAEZP,EAAWE,GAAU,EAAI7B,EAAE1N,CAAI,EAC/B1zB,EAAIijC,EAAS,EACbD,IACA,MACF,IAAK,GACH,OAAOrlB,EAAO,KAAK,EAAE,CAC/B,CAOM,GALIqlB,GAAa,IACfA,EAAY,KAAK,IAAI,EAAGE,CAAO,EAC/BA,KAGEH,EAAW/iC,CAAC,EACdzZ,EAAQw8C,EAAW/iC,CAAC,UAEhBA,IAAMijC,EACR18C,EAAQ48C,EAAIA,EAAE,OAAO,CAAC,MAEtB,QAAO,KAGXxlB,EAAO,KAAKp3B,CAAK,EAGjBw8C,EAAWE,GAAU,EAAIE,EAAI58C,EAAM,OAAO,CAAC,EAC3Cy8C,IAEAG,EAAI58C,EAEAy8C,GAAa,IACfA,EAAY,KAAK,IAAI,EAAGE,CAAO,EAC/BA,IAGR,CACA,GAEE,OAAO/B,CACT,GAAC,EAI2CoC,GAAU,KACpDA,EAAA,QAAiBpC,EACR,OAAO,QAAY,KAAe,SAAW,MACtD,QAAQ,OAAO,WAAY,EAAE,EAC5B,QAAQ,WAAY,UAAY,CAC/B,OAAOA,CACX,CAAG,gCCxfH,MAAAqC,GAAe,+fCAfC,GAAe,8lBCAfC,GAAe,yjCCGTzsB,GAAQ,IACR0sB,GAAY,GAEX,eAAeC,IAAoB,CACxC,KAAM,CAAEn/C,SAAUyB,GAAG,EACf29C,EAAWp/C,EAAMM,GAAG++C,aACvB7+C,KAAK,CACJC,MAAO+xB,EACT,CAAC,EACA5xB,OAAM,EACH0+C,EAAO,GACb,IAAIC,EAAa,EACjB,EAAG,CACD,KAAM,CAAE1+C,QAAO86B,MAAK,EAAI,MAAMyjB,EAASt+C,KAAI,EAC3C,GAAI66B,GAAQ96B,GAAOE,SAAW,EAAG,MACjCu+C,EAAK/iC,KAAK,GAAG1b,CAAK,EAClB0+C,GACF,OAASA,EAAaL,IACtBI,SAAK3jC,KAAK,CAACrJ,EAAGsJ,IAAMtJ,EAAEoJ,KAAKI,cAAcF,EAAEF,IAAI,CAAC,EAChD1c,EAAQma,QAER,WAASpY,IAAQ,CAEbmZ,GAAA,4BACAA,OACEolC,UAAI,UACJz0B,EACF,EAAC,CAAC,EAENy0B,CAEA,CACF,MAAA50B,GAAA,YAEMA,eAAe80B,IAAgB,CACrC,IACE,KAAI,CACF,KAAAF,EAAQA,WAAMz0B,qCAAU,OAAI3Q,GAAMxB,QAC9B,KAAK,MAAQmS,EAASH,IAExBy0B,GAAA,EACAA,GAJ4C,MAAAA,GAAqB,CAOnE,MAAOG,CACP,MAAO9hD,EACP,CACF,CACF,MAAAiiD,GAAA,8BAEaC,GAAY/oB,GAAoB,CAC7C,IAAOmQ,EAAM4Y,SACX,GAAI5Y,EAAQ,QAAE,GAAS,gBACvB2Y,GAAI3Y,UAAgBA,EACpB2Y,QAAoB3Y,GAAO,8BAC3B,OAAA6Y,EAAkB,OACbA,WAAa5+C,OAAiBuR,KAAA,yCADN1N,ICxD/B,SAASg7C,GAAU,CAAEt5C,UAAS,EAAG,CAC/B,GAAI,OAAOA,GAAa,SAAU,OAAOA,EACzC,KAAM,CAAConB,EAAMmyB,CAAO,EAAIlgD,EAAS,EAAE,EACnChB,SAAU,IAAM,CACdmhD,QAAQrvB,QAAQnqB,CAAQ,EAAEy5C,KAAKF,CAAO,CACxC,EAAG,CAACv5C,CAAQ,CAAC,EACNonB,CACT,CCsBO,MAAMsyB,GAAkB,EAEzBC,GAAQ,CACZ,YACA,WACA,gBACA,OACA,SACA,WACA,SACA,UACA,YACA,YAEA,EAEIC,GAAY,CAChBjxB,UAAW,CAAAtuB,GAAA,UACXJ,cAAe,CAAAI,GAAA,UACfH,KAAM,CAAAG,GAAA,UACNw/C,OAAQ,CAAAx/C,GAAA,UACR4vB,OAAQ,CAAA5vB,GAAA,UACR,mBAAoB,CAAAA,GAAA,UACpBy/C,UAAW,CAAAz/C,GAAA,UACX0/C,WAAY,CAAA1/C,GAAA,UACZ2/C,QAAS,CAAA3/C,GAAA,UACT4/C,SAAU,CAAA5/C,GAAA,UACV6/C,SAAU,CAAA7/C,GAAA,SACZ,EACM8/C,GAAc,CAClBjgD,KAAM,CACJ,CACEktB,KAAM,CAAA/sB,GAAA,UACN+a,KAAM,KACNglC,YAAa,GACd,EAEHP,OAAQ,CACN,CACEzyB,KAAM,CAAA/sB,GAAA,UACN+a,KAAM,QACNjV,KAAM,YAER,CACEinB,KAAM,CAAA/sB,GAAA,UACN+a,KAAM,WACNjV,KAAM,OACNk6C,YAAa,CAAAhgD,GAAA,UACb+/C,YAAa,GACd,EAEHH,SAAU,CACR,CACE7yB,KAAM,CAAA/sB,GAAA,UACN+a,KAAM,WACNjV,KAAM,OACNk6C,YAAa,CAAAhgD,GAAA,UACb+/C,YAAa,GACd,EAEHnwB,OAAQ,CACN,CACE7C,KAAM,CAAA/sB,GAAA,UACN+a,KAAM,QACNjV,KAAM,OACNk6C,YAAa,CAAAhgD,GAAA,UACb+/C,YAAa,GACd,EAEH,mBAAoB,CAClB,CACEhzB,KAAM,IACNhS,KAAM,KACNjV,KAAM,OACNk6C,YAAa,0BACd,EAEHL,QAAS,CACP,CACE5yB,KAAM,IACNhS,KAAM,UACNjV,KAAM,OACNk6C,YAAa,CAAAhgD,GAAA,UACbgoC,QAAS,SAEX,CACEjb,KAAM,CAAA/sB,GAAA,UACN+a,KAAM,QACNjV,KAAM,YAER,CACEinB,KAAM,CAAA/sB,GAAA,UACN+a,KAAM,WACNjV,KAAM,OACNk6C,YAAa,CAAAhgD,GAAA,UACb+/C,YAAa,GACd,CAEL,EACME,GAAoB99C,GAAK,MAAO,CAAEnC,IAAG,IAAM,CAC/C,MAAM+X,EAAU,MAAMjX,KAAMzB,MAAMM,GAAG2C,SAASC,QAAQvC,CAAE,EAAEQ,QAC1D,OAAOuX,EAAQ2N,UAAY3N,EAAQ0N,MAAQ1N,EAAQqP,WACrD,CAAC,EACY84B,GAAiB,CAC5B5xB,UAAW,CACTtuB,GAAI,OACJiJ,MAAOA,CAACyO,EAAGyO,IACTA,IAAU,EAAC4R,GAAArgB,EACP,CAAA1X,GAAA,SAAM,EAAC+3B,GAAArgB,EACL,CAAE1X,GAAI,kBAAwC,EACtDmgD,KAAM,IACN75C,KAAM,QAERu5C,SAAU,CACR7/C,GAAI,WACJiJ,MAAO,CAAAjJ,GAAA,UACPmgD,KAAM,YACN75C,KAAM,MAER1G,cAAe,CACbI,GAAI,gBACJiJ,MAAO,CAAAjJ,GAAA,UACPmgD,KAAM,iBACN75C,KAAM,gBAERzG,KAAM,CACJG,GAAIA,CAAC,CAAEA,QAAUA,EAAK,OAAS,QAC/BiJ,MAAOA,CAAC,CAAEjJ,QAAUA,EAAKuqB,GAAavqB,CAAE,EAAC+3B,GAAArgB,EAAG,CAAA1X,GAAA,SAAO,EACnDmgD,KAAMA,CAAC,CAAEngD,QAAUA,EAAK,MAAMA,CAAE,GAAK,KACrCsG,KAAM,OACN85C,gBAAiBA,CAAC,CAAEpgD,QAAWA,EAAwB,GAAnB,CAAC,cAAc,CAAI,EAEzDw/C,OAAQ,CACNx/C,GAAI,SACJiJ,MAAOA,CAAC,CAAEqS,WAAaA,EAAKyc,GAAArgB,EAAG,CAAA1X,GAAA,SAAO,EAAC+3B,GAAArgB,EAAG,CAAA1X,GAAA,SAAW,EACrDqgD,SAAUA,CAAC,CAAE/gD,cAAeA,GAAYwB,KAAMxB,SAC9C6gD,KAAMA,CAAC,CAAE7kC,QAAOhc,cAAe,IAAIA,CAAQ,KAAKgc,EAAQ,KAAO,EAAE,GACjEhV,KAAMA,CAAC,CAAEgV,WAAaA,EAAQ,WAAa,SAE7CskC,SAAU,CACR5/C,GAAI,WACJiJ,MAAO,CAAAjJ,GAAA,UACPqgD,SAAUA,CAAC,CAAE/gD,cAAeA,GAAYwB,KAAMxB,SAC9C6gD,KAAMA,CAAC,CAAE7gD,cAAe,IAAIA,CAAQ,YACpCgH,KAAM,SAERspB,OAAQ,CACN5vB,GAAI,SACJiJ,MAAOA,CAAC,CAAE6tC,WAAaA,EAAQ,IAAIA,CAAK,IAAG/e,GAAArgB,EAAG,CAAA1X,GAAA,SAAQ,EACtDmgD,KAAMA,CAAC,CAAErJ,WACPA,EACI,aAAawJ,mBAAmBxJ,CAAK,CAAC,iBACtC,UACNxwC,KAAM,SACN85C,gBAAiBA,CAAC,CAAEtJ,WAAcA,EAA2B,GAAnB,CAAC,cAAc,CAAI,EAE/D,mBAAoB,CAClB92C,GAAI,mBACJiJ,MAAOg3C,GACPE,KAAMA,CAAC,CAAEngD,QAAS,MAAMA,CAAE,GAC1BsG,KAAM,QAERm5C,UAAW,CACTz/C,GAAI,YACJiJ,MAAO,CAAAjJ,GAAA,UACPmgD,KAAM,KACN75C,KAAM,YAERo5C,WAAY,CACV1/C,GAAI,aACJiJ,MAAO,CAAAjJ,GAAA,UACPmgD,KAAM,KACN75C,KAAM,SAERq5C,QAAS,CACP3/C,GAAI,UACJiJ,MAAOA,CAAC,CAAE02C,aAAcA,EACxBU,SAAUA,CAAC,CAAE/gD,cAAeA,GAAYwB,KAAMxB,SAC9C6gD,KAAMA,CAAC,CAAER,UAASrgD,WAAUylC,WAC1B,GAAGzlC,EAAW,IAAIA,CAAQ,GAAK,EAAE,MAAMqgD,EAAQ/5B,MAAM,KAAK,EAAEhT,KAAK,GAAG,CAAC,GACnEmyB,EAAQ,WAAa,EAAE,GAE3Bz+B,KAAM,UAEV,EAEA,SAASi6C,GAAkB,CAAE35C,SAAQ,EAAG,CACtC,KAAM,CAAE8Q,KAAG7Y,KACLgE,EAAaC,GAAYtD,CAAM,EAC/B,CAAEghD,aAAc39C,EAChB,CAAC49C,EAAUC,CAAW,EAAI1hD,EAAS,EAAK,EACxC,CAAC2hD,EAAkBC,CAAmB,EAAI5hD,EAAS,EAAK,EAExD,CAAC6hD,CAAmB,EAAIhvC,KAE9B,OACEpM,EAAA,OAAKzF,GAAG,+BAA+BkG,MAAM,QAAQ6D,SAAS,KAAIpE,SAAA,CAC/D,CAAC,CAACiB,GACDhB,EAAA,UAAQE,KAAK,SAASI,MAAM,cAAcH,QAASa,EAAQjB,SACzDC,EAACS,EAAI,CAACC,KAAK,IAAIE,IAAGuxB,GAAArgB,EAAE,CAAA1X,GAAA,SAAO,CAAC,CAAG,EACzB,EAEV4F,EAAA,UAAAD,SACEF,EAAA,MAAAE,SAAA,CACEC,EAACS,EAAI,CAACC,KAAK,WAAY,EAAC,IAACV,EAAAgC,EAAA,CAAA5H,GAAA,SAAuB,EAAE,IAClD4F,EAAA,OACE0B,MAAO,CACLw5C,SAAU,GACVjM,QAAS,GACTkM,cAAe,aACfp7C,SAEFC,EAAAgC,EAAA,CAAA5H,GAAA,SAAkB,EACf,CAAC,EACJ,EACE,EACRyF,EAAA,QAAAE,UACEC,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAiE,EAChE,EACH4F,EAAA,OAAKM,MAAM,sBAAqBP,SAC7B,CACC,CACEzF,MAAO,eACPgI,MAAK6vB,GAAArgB,EAAE,CAAA1X,GAAA,SAAiB,EACxBghD,OAAQ5C,IAEV,CACEl+C,MAAO,eACPgI,MAAK6vB,GAAArgB,EAAE,CAAA1X,GAAA,SAAc,EACrBghD,OAAQ1C,IAEV,CACEp+C,MAAO,eACPgI,MAAK6vB,GAAArgB,EAAE,CAAA1X,GAAA,SAAc,EACrBghD,OAAQC,GACT,EACD74C,IAAI,CAAC,CAAElI,QAAOgI,QAAO84C,YAAa,CAClC,MAAM5/B,EACJve,EAAWW,SAASC,oBAAsBvD,GACzCA,IAAU,gBACT,CAAC2C,EAAWW,SAASC,kBACzB,OACEgC,EAAA,SAAmBS,MAAOkb,EAAU,UAAY,GAAGzb,UACjDC,EAAA,SACEE,KAAK,QACLiV,KAAK,sBACL7a,QACAkhB,UACA/F,SAAWxe,GAAM,CACf2C,EAAOgE,SAASC,kBAAoB5G,EAAEoK,OAAO/G,KAC/C,EACD,EAAE,IACH0F,EAAA,OAAKyc,IAAK2+B,EAAQx6C,IAAI,GAAG8J,MAAM,KAAKC,OAAO,KAAM,EAAE,IACnD3K,EAAA,QAAAD,SAAOuC,EAAY,CAAC,GAXVhI,CAYL,CAEX,CAAC,EACE,EACJsgD,EAAUpgD,OAAS,EAClBqF,EAAAC,EAAA,CAAAC,UACEC,EAAA,MAAIM,MAAM,iBAAiBL,IAAKg7C,EAAoBl7C,SACjD66C,EAAUrnB,OAAOoD,OAAO,EAAEn0B,IAAI,CAAC84C,EAAUzzC,IAAM,CAE9C,MAAM9J,EAAM6a,OAAOve,OAAOihD,CAAQ,EAAEtuC,KAAK,GAAG,EACtC,CAAE9M,QAASo7C,EACjB,GAAI,CAAChB,GAAep6C,CAAI,EAAG,OAAO,KAClC,GAAI,CAAEQ,OAAM2C,QAAOo3C,WAAUD,mBAC3BF,GAAep6C,CAAI,EACjB,OAAOmD,GAAU,WACnBA,EAAQA,EAAMi4C,EAAUzzC,CAAC,EAEzBxE,EAAQyO,EAAEzO,CAAK,EAEb,OAAOo3C,GAAa,WACtBA,EAAWA,EAASa,EAAUzzC,CAAC,EAE/B4yC,EAAW3oC,EAAE2oC,CAAQ,EAEnB,OAAO/5C,GAAS,aAClBA,EAAOA,EAAK46C,EAAUzzC,CAAC,GAErB,OAAO2yC,GAAoB,aAC7BA,EAAkBA,EAAgBc,EAAUzzC,CAAC,GAE/C,MAAM0zC,EAAmBf,GAAiB7rC,SACxC1R,EAAWW,SAASC,iBACtB,EACA,OACEgC,EAAA,MAAAE,SAAA,CACEC,EAACS,EAAI,CAACC,OAAa,EACnBb,EAAA,QAAMS,MAAM,gBAAeP,SAAA,CACzBC,EAACq5C,GAAS,CAAAt5C,SAAEsD,EAAiB,EAC5Bo3C,GACC56C,EAAAC,EAAA,CAAAC,SAAA,CACG,IACDC,EAAA,SAAOM,MAAM,mBAAkBP,SAAE06C,EAAgB,CAAC,EAClD,EAEHc,GACCv7C,EAAA,QAAMM,MAAM,MAAKP,SACfC,EAAAgC,EAAA,CAAA5H,GAAA,SAAgD,EAC5C,CACP,EACG,EACNyF,EAAA,QAAMS,MAAM,mBAAkBP,UAC5BC,EAAA,UACEE,KAAK,SACLI,MAAM,cACN+B,SAAUwF,IAAM,EAChB1H,QAASA,IAAM,CACb,MAAMq7C,EAAe1uC,MAAMC,KAAKnT,EAAOghD,SAAS,EAChD,GAAI/yC,EAAI,EAAG,CACT,MAAM4zC,EAAO7hD,EAAOghD,UAAU/yC,EAAI,CAAC,EACnC2zC,EAAa3zC,EAAI,CAAC,EAAIyzC,EACtBE,EAAa3zC,CAAC,EAAI4zC,EAClB7hD,EAAOghD,UAAYY,CACrB,CACF,EAAEz7C,SAEFC,EAACS,EAAI,CAACC,KAAK,WAAWE,IAAGuxB,GAAArgB,EAAE,CAAA1X,GAAA,SAAS,CAAC,CAAG,EAClC,EACR4F,EAAA,UACEE,KAAK,SACLI,MAAM,cACN+B,SAAUwF,IAAM+yC,EAAUpgD,OAAS,EACnC2F,QAASA,IAAM,CACb,MAAMq7C,EAAe1uC,MAAMC,KAAKnT,EAAOghD,SAAS,EAChD,GAAI/yC,EAAIjO,EAAOghD,UAAUpgD,OAAS,EAAG,CACnC,MAAMihD,EAAO7hD,EAAOghD,UAAU/yC,EAAI,CAAC,EACnC2zC,EAAa3zC,EAAI,CAAC,EAAIyzC,EACtBE,EAAa3zC,CAAC,EAAI4zC,EAClB7hD,EAAOghD,UAAYY,CACrB,CACF,EAAEz7C,SAEFC,EAACS,EAAI,CAACC,KAAK,aAAaE,IAAGuxB,GAAArgB,EAAE,CAAA1X,GAAA,SAAW,CAAC,CAAG,EACtC,EACR4F,EAAA,UACEE,KAAK,SACLI,MAAM,cACNH,QAASA,IAAM,CACb26C,EAAY,CACVQ,WACAI,cAAe7zC,EAChB,CACH,EAAE9H,SAEFC,EAACS,EAAI,CAACC,KAAK,SAASE,IAAGuxB,GAAArgB,EAAE,CAAA1X,GAAA,SAAM,CAAC,CAAG,EAC7B,CAAC,EAUL,CAAC,GAtEA2D,CAuEL,CAER,CAAC,EACC,EACH68C,EAAUpgD,SAAW,GACpByC,EAAWW,SAASC,oBAAsB,gBACxCgC,EAAA,OAAKS,MAAM,yBAAwBP,SAAA,CACjCC,EAACS,EAAI,CAACC,KAAK,OAAQ,EAAE,IACrBV,EAAA,SAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAEO,EACF,CAAC,EACL,CACN,EACH,EAEFyF,EAAA,OAAKS,MAAM,yBAAwBP,UACjCC,EAAA,KAAAD,SACG9C,EAAWW,SAASC,oBAAsB,eAAcs0B,GAAArgB,EACrD,CAAA1X,GAAA,SAA+C,EAAC+3B,GAAArgB,EAChD,CAAA1X,GAAA,SAAmD,CAAC,CACvD,EACH4F,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAuJ,WAAA,CAAAC,EAEE5D,EAAA,OAAK,EAAC6D,EAEN7D,EAAA,KACEmT,KAAK,IACLhT,QAAUlJ,GAAM,CACdA,EAAEoJ,iBACFzG,EAAOghD,UAAY,CACjB,CACE16C,KAAM,aAER,CACEA,KAAM,gBACP,CAEL,EAGC,EAAC,CAEC,EACN,CAAC,EACD,EAEPF,EAAA,KAAGM,MAAM,gBAAeP,SACrB66C,EAAUpgD,QAAUi/C,KAClBx8C,EAAWW,SAASC,oBAAsB,eAAcs0B,GAAArgB,EACrD,CAAA1X,GAAA,SAAAC,OAAA,CAAAo/C,mBAAuB,CAAS,EAACtnB,GAAArgB,EACjC,CAAA1X,GAAA,SAAAC,OAAA,CAAAo/C,mBAAuB,CAAW,EAAC,CACxC,EACH55C,EAAA,KACE6B,MAAO,CACL2a,QAAS,OACTs/B,eAAgB,gBAChBp/B,WAAY,UACZxc,UAEFC,EAAA,UACEE,KAAK,SACLI,MAAM,QACNH,QAASA,IAAM66C,EAAoB,EAAI,EAAEj7C,SAEzCC,EAAAgC,EAAA,CAAA5H,GAAA,SAA2B,EACrB,EACRyF,EAAA,UACEK,KAAK,SACLmC,SAAUu4C,EAAUpgD,QAAUi/C,GAC9Bt5C,QAASA,IAAM26C,EAAY,EAAI,EAAE/6C,SAAA,CAEjCC,EAACS,EAAI,CAACC,KAAK,OAAQ,EAAE,IACrBV,EAAA,QAAAD,SACG9C,EAAWW,SAASC,oBAAsB,eAAcs0B,GAAArgB,EACrD,CAAA1X,GAAA,SAAa,EAAC+3B,GAAArgB,EACd,CAAA1X,GAAA,SAAe,CAAC,CAChB,CAAC,EACD,CAAC,EACR,CAAC,EACA,EACLygD,GACC76C,EAACkE,GAAK,CACJ/D,QAAUlJ,GAAM,CACVA,EAAEoK,SAAWpK,EAAE6pB,eACjBg6B,EAAY,EAAK,CAErB,EAAE/6C,SAEFC,EAAC47C,GAAY,CACXN,SAAUT,EAASS,SACnBI,cAAeb,EAASa,cACxB/1B,SAAUA,CAAC,CAAEgN,SAAQkpB,UAAW,CAC9BpjD,WACAmB,YAAaihD,EAAQ,eAAAloB,EAErB/4B,EAAO,eAAA+4B,CAAA,CACuB,EAEhC,YAAAmoB,EAAA,KACgC,GACjCC,GAAA/6C,EAAAkE,GAAA,CACI,QAER62C,eAEmB9jD,EAAA,eACd+jD,EAAmBl6B,GACQ,EAE7B,SAAA9gB,EAAA87C,GAAA,CAAE/7C,YAGA66C,mBACwC,EAAE,CAC3C,EAEJ,CAGP,MAAAmB,GAAA,CAEA,KACE9hD,CAAM,aAA0G,OAChH+vB,CAAQ,aAAsF,QAC9F+vB,CAAS,YAAqD,EAChE,SAAA6B,GAAA,CAEA,SAAAj2B,EACEA,WACAtjB,WACAi5C,gBACAI,WACA16C,CACF,KAAG,CACD,EAAA8Q,CAAM,EAAEA,KAAG7Y,EAAA,EAAAqiD,EACX7iD,IAAgC,EAAAW,EAAAkiD,GAAA,YAC1Bl2B,IAAak2B,eACb,CAACU,GAAaC,QAEd,CAACj7B,EAAS1D,CAAuB,EAASlkB,EAAA,IAChDhB,EAAOisB,IAAO0B,EACd,SAAOm2B,CACP9jD,OAAgB,OACb,IACCklB,WAAoB,EACpB,MAAI2N,EAAA,MAAA1G,GAAA,EACFjH,GAAW,EACXA,EAAM+G,UACN0B,MAAS1B,CACT/G,EAAW,QACb,CACE7kB,MACA6kB,UACF,GAAA0+B,IAAA,UACF,GAAG,CAEF,MAAAjD,EAAY,MAAAH,GAAA,EACXuD,EAAoBpD,CAAA,CACpB,MAAI,EACF,IACAoD,OAAwB,QACdhkD,EAAA,EACVM,cAAe,GACjB2sB,GAAA42B,GAAA9B,GAAA8B,CAAA,GACF,MAAGI,EAAAC,EAAA,QACDL,GAAYA,CAAA,YAEVK,OACNjkD,MACE,IAAIgtB,CAEF,QAAai3B,EAAQhkD,+BACrB6hD,GAAY8B,EAAW7mC,CAAE/N,IAAW+N,eAAMjV,sBACxCwiC,EAAMA,MAAQ0Z,EAAKr9C,GAGf2jC,EAAiD,CAEjDA,SAA2B7iC,EAC7B,UACF,+BACD,QACH,YAAAmB,GAAAhB,EAAA,UACEolB,cAEJ,oBACOhrB,QAAG4G,EAAyBV,SAAMN,EAAAS,EAAA,MAAO,IAElCP,IAAKiyB,GAAA,EAA6BhyB,CAAiBJ,GACzDC,QAAK,CAAM,CAAO8R,OAAE,mBAAA9R,EAAA,eAAOolB,EAAA+M,GAAA,EAAI,CAGnCnyB,GAAA,SACE,EAAAD,GAAKqlB,EAAW,CAAAhrB,GAAA,SAAe,CAAC0X,OAAG,+BAAcjS,EAAA,QAAC,IAAAw8C,EAAK,SAAAplD,GAAA,CAEzD+I,iBAAA,EAAMmE,MAASgJ,EAAA,aAAAlW,EAAA,QACb4I,EAAA,GACEI,EAAKo8C,kBACMplD,GAAMqD,GAAA,OAEb+F,iBACFsyB,EAAMxlB,CAAO,EAAI+M,GAAW7Y,UAAM,sCAClCsxB,KAAgBA,EAAA50B,CAAA,0BAEd40B,GACAA,SAEEA,GAIAA,SACF,KAAAvN,EAAA,aACD,EACD3sB,SAAQma,QACRqpC,EAAY/7C,IAAM,EAClBylB,MAAS,EACPgN,SACMvN,OAAW,CACnB,SAACvlB,EAAA,SAECwB,SAAOuiC,GAAM,QACfqY,WAAmBj6C,EAAA,CACnBhB,GAAU,SACZ,EAAEjB,IAEFC,SAAA,CAAAD,YACEA,WACEA,YACEiC,CAAA5H,EAAAnD,EAAA,eACI,aACNmuB,EAAAk2B,EAAA,YACE36B,YACAte,WACAoT,SAAWxe,YAAM,IAAAyiD,GAAA,IAAAx5C,GAAAF,EAAA,UACfi8C,QACF,SAAAnqC,EAAA6nC,GAAAz5C,CAAA,GACApI,GAAyC2G,EACzC0W,CAAK,EACD,GAAA+kC,GAAM8B,CAEV,SAAgB,CACftC,CACC,KAAAvyB,EAAejnB,OAAwB,KAAAA,EACvC,YAAAk6C,EACK,QAAAhY,EAEV,YAAA+X,CAEA,IAAQhlC,WAAMjV,OAAMk6C,oBAAahY,oBAAS+X,cAAkB,WAC3D,EACE,KACE,UAAAp6C,KACEF,KAAAE,SACEC,GAAAD,SACEC,GAAAgC,IAAA,uBAAAojB,EAAAk2B,EAAA,cAAkB,OACd,SACN,CAAAt7C,EAAA,UACEmV,MAAK,OACK,IAACglC,eACX93C,WACAvK,WAAcstB,KAAyB3mB,CACvCmiB,GAAI,EAAM7gB,CAEV,EAAc,GAEQ3F,OAAUiJ,SAC9BxD,EAAA,kBACK,CAAAG,EAAA,QACJ,SAAA8R,EAAAqV,CAAA,EACN,MAAAnnB,EAAA,SAEP,KAAAE,EAEA,OACEA,IAAA,mBAAAH,OACEA,YACEC,EAAAo6C,CAAA,EAAAr6C,SAAO+R,IAAM,SAAAqoC,EAAQ,SAAA93C,EAEnBnC,qDACAg2C,kBACA/gC,qBACAilC,cACAz5B,UACAte,aACApI,IACE+hD,WAAgBE,EACZ,UAAAl8C,EACA,YAENs8C,gCACAC,WAAe,IAAAC,GAAAx8C,EAAA,UACfy8C,QAAY,KACZra,IACAxhB,CAAI,EAIF,EAAa,IAAAm7B,GAA4Bh8C,CACtCm8C,KAAsBM,KACrB,gCAAmBrnC,SACpB,CAAAnV,EAAAS,EAAA,MAEJ,SACEqR,EAAAiqC,GAAAC,CAAA,MACNn8C,EAAA,sBAIKm8C,SAAW,CACpB17C,KAAM,SAAyBP,cAC1BW,SAAK2B,GAAA2e,IAAA,UAAQ,SAChB+6B,EAAWC,GAAY,EAG9Bj8C,CAEIG,GAAK,SACC,EACNmC,GAAUA,EAEDyP,CAAG,aAAM,MAACA,gCAAG,4BAAKlY,EAAA,iBAAA8hD,EAAA,GAAC16C,IAAA,CACtB,EAGJd,SAAKF,EAAAgC,EAAA,CACL1B,WAAM,EAEJ1G,GACAoH,GAAU,EACZ,GAEA,GAAoB,SAAA86C,GAEvB,WAAAlB,EACM,QAAA55C,CACL,GACD,KACJ,CAET,EAAA8Q,CAEA,EAAA7Y,GAAS6iD,EAAelB,CAAW55C,OAAQ,EAAG9F,GAAA,EACtCwhD,EAAApoC,GAAA,IAAExC,IAAG7Y,GAAA,0BACL0jD,iCAAA,eAAA/B,EAAA,kBAAEnhD,KAAUyB,GAAI0hD,CAAA,EAAAxjD,EAAA,IAChBsjD,IAA6B,EAAAtjD,EAAA,WAC7ByjD,EAAmBvoC,GAAA,KACvB,GAAI,CAACsmC,EACL,OAAAkC,aAGElC,KAEJ,GAAM,CACN,MAAMiC,kDAAwCE,CAAA,GAC5C,GAAKA,gBAAmB,kCACtBD,SAAiB,SAAS,EACnBE,CACT,OACA,GAAI,CACF,MAAMA,EAASz+C,KAAKC,MAClBy+C,GAGF,UAAW5nB,QAAQ2nB,CAAS,QAAM,UAAU,cAAc,EAC1DF,SAAiB,SAAS,EAClBlqC,CACR,MAAOoqC,UACK,SAGR,IACF,CACA,CACAF,OACAI,EAAOF,uBACK7kD,EAAA,EACZ2kD,gBACA,6BAAO,MACT,QACF,YAAA97C,GAAAhB,EAAA,UACE+8C,cACJ,MAAMG,cAEN,UAEA,SACEl9C,EAAAS,EAAA,CAAQ,SAA0BH,IAAM6xB,GAAA,EAE5BjyB,CAAcI,GAAM,SAAuBU,CAC5C,EAAM,GAAIJ,EAAGuxB,SAAArgB,2BAAE9R,EAAAgC,EAAA,IAAA5H,SAAO,YAAC,EAAA4F,EAAA,SAAG,yBAGnC,EACE,CAAAD,CACE,KAAAF,EAAA8D,OAAA,eACgB,SAAOrD,GAAM,oBAAmC,CAAAT,EAAA,MAAC,UAAAG,EAAAS,EAAA,CAC1D,yBACL,SAENZ,MAAA,gBAAMsE,MAASnE,EAAA,QAAID,SACjBF,EAAAmC,EAAA,CAAAjC,WACE,CAAAA,CACO,EAACW,CAAK,GAAoBC,EAAK,WAAIL,eAAqB,SAC7DN,GAAA,SAAAD,MACE,iBAAoB,SACf,YAAAoyB,GAAA,EAEN7xB,CAAoBP,WACrB,CACOo9C,EAELhoC,MAAK,QACLilC,WAAWjoB,CAAArgB,mBAAE,IAAA1X,MAAA,GAAsB80C,IAAAlvC,EAAA,UAAC,cACpCM,MAAM,eACN0Z,QAAU/iB,KACR2lD,sBACF,UACI,KAAAz1B,CAAA,EAEL+nB,MAEQ/nB,IACCy1B,EAAAz1B,CAAA,IACS,cAAAA,EACbvtB,EAA4B,0CAChB,CAAEutB,CACV,EACEy1B,cACAO,YACAA,SAIJ,CACF,YACF,CAEK,EAAM,GAAOv8C,EAAGuxB,SAAArgB,mEAAE,wBAAAsrC,IAAA,4BAAc,UAACN,EAAA,qBAAG,MAAAlrC,EAAApS,GAAA,EAG5C5F,GAAOgE,GAASqe,EAGb3b,IACU88C,QAAkB,CAE1BN,GACA,IAEE,MAAA74B,GADOnS,gDACP,MAAmD,GAAAmS,EAAA,CACrD,MACI,KAAAtC,EAAA,EACF,EAAMiC,EAEFxpB,GAAI,+DAAe,KAAAunB,CAAA,GACpB,MAAA/jB,EAAA+jB,EAAA,yEACGsC,CACFA,IACF,GAAAo5B,EAAQ17B,MAAO,EAAOsC,cACtBk5B,EACE,cAAAhwC,EAIAgwC,EAAsBG,QACpB,iCAEF,CAAM,CAAEpvC,EAAGmvC,gBAAIlwC,GAAc3O,OAAMZ,EACnCu/C,QAIF,CACF,WACAL,CAA0B,EAE1BrkD,CACAqkD,EACAzgD,WAASyV,CAAC,GAAA1X,QAAA,CAA8B,EAAC,SAC3C,CAAA4F,EAAAS,EAAA,CACF,iBACK0xB,EAAArgB,mBAAE,cAAyC,GAAC,EAAA+qC,GAAA,cAAAA,CAAA,GAAAh9C,EAAAC,EAAA,UAACC,GAElDC,IAACS,CAAI,SAAM,CAAAT,EAAA,KAAS,SACnBS,EAAI,SAACC,YAAKm8C,EAAA,oBAAAh9C,EAAA,SAAac,MAAK,gBAAM,cAAAo8C,EAAA,uBAEtC,GACA,EACAF,QAEC98C,6BACEA,WACE,IAAAu7C,GAAAz7C,EAAA,MAAAE,SAAI88C,WAAmC,OAEhCv8C,QAAMs6C,EAAA,KAAA9X,GAEL,YAAAA,CAAA,QAAA/kC,GAAA,CAEV,KAAAA,KAAAu9C,GAAA,SAAU,MAAAvZ,EAAAuZ,EAAAv9C,CAAA,EACP8+C,mBAAwBr6C,MAAK84C,IAC5Bz7C,OACE,UAEuB09C,CAAMza,IAEvBlqB,EAAOxU,CACL,EACA,YACA,GAAAvE,EAAA,OACEkiC,CAIA,UAAAjwB,EAAA6nC,GAAO2B,EAAA,OAAAA,EAAA,iBAAAA,EAAA,cAAApB,GAAAoB,EAAA,oBAAAn0B,EAET,KAAAhS,EAAkB4sB,MACnB,MAGC5sB,CAAA,EAAAtV,EAAAC,EAAA,CACN,UAAAD,EAAA,QAAEE,MACH,8BAGDF,SAAA,CAAAiS,EAAAqV,CAAA,UAAAjnB,IAAA,WAAAo7C,EAAAnmC,CAAA,iBAAAmmC,EAAAnmC,CAAA,GAAApV,MAIK,GAAEonB,SAAMhS,GAAMjV,KAAK,IAClBo7C,CACE,SAAAv7C,WACE,UAAMO,EAAM0B,EAAA,IAA6BjC,QAMrB,EACT,GAAAC,EAEX,KACP,IAAAH,EAAA,kBACI,UAAAG,EAAAgC,EAAA,CAEV,YAEHnC,EAAA,CAAAE,EACE,GACE,GAAAq9C,IAAA,SAAAp9C,EAAA,WAA2C,iBAE7CA,EAAA,SACA,SAAAD,OAAOC,EACFgC,EACHA,CAAA,GAAA5H,QAAA,GAEQ,EACF,GACNyF,EAAA,KACJ,SAELu9C,MACCt9C,EAAA,CAAGQ,SAAM,CAAAN,EAAAqT,GAAA,CAAOtT,aACdoyB,GAAA,EACK/3B,CAAsC,YACpC,EAGX2F,WACGm9C,SACCn9C,MACEC,oBACcmyB,EAAArgB,aAAE,YAA8B,KAAC,MAAA0rC,EAAAX,EAAA,OAAAvB,GAAA,CAAA1hD,EAAA,eAAAkpC,GAEtCxiC,OAAM,KAAAwiC,CAAA,QAAA/kC,GAAA+kC,EAAA/kC,CAAA,IAAAu9C,EAAAv9C,CAAA,EAAQgC,GACjB,GAAA3F,GAAA,QAGOiC,GAAA81B,GAAA,GASHqrB,WAEsB1a,EAEtBlqB,EAIN,MACA,CACEvc,MAASyV,0CAAC2rC,IAAAC,IAAA,QAAAjE,EAAA,GAA4B7/C,EAAC,UAAA8jD,EACvCrhD,GAAAohD,EAAAtrB,GAAA,EAEF,CAIA,GAAMsrB,SACFA,QAEFC,kBAAoD,CAEtD9jD,CACAyC,KACEohD,EACI,CAAArjD,GAAA,YAAAq/C,IAAoD,GAAgC,SAACtnB,EAAArgB,8BACrF,mBAAA+qC,EAAA,SAAoB78C,EAAAgC,EAAA,CAC1B,WACAhB,EAAU,CACZ,IAAEjB,IAEF,GAAAC,EACEE,GAAK,cACCg9C,EAAA/qB,GAAA,EACK0qB,CAEX,GAAAziD,QAAA,CAA8B,EACxB+3B,GAAA,EAIdnyB,CACEuT,WACoBzB,GACd,kBAAAorC,EAAA,wBAA6B,OAAC/qB,UAAArgB,UAC9B1X,CAAmB,YAAC,CAE1BoZ,MACSrT,CACPvG,EACAyC,WAAS81B,SAAArgB,qBAAC,mBAAA+qC,EAAA,SAAoBK,EAAA/qB,GAAA,EAC9BnxB,CACF,YAEA,EACEd,GAAK,GAE8BH,WAEhB+R,EAAG,KAAc,GAACA,yBAAG,CAAAjS,EAAA,eAAAzF,GAAAqG,EAAA,MAAS,uBAAC,UAC5C,gBACG,EAAC,IAAAT,EAAA,QACZ,SAAAA,EAAAgC,EAAA,CAENnC,GAAA,SAAAE,CACE,CAAAA,EACO,GAACW,EAAK,WAAkBC,eAAK,SAAU,CAAAX,EAAA,SAAiB,MAC7DA,CAAAD,YACE,OAAoB,OACf,MAAA28C,EAET78C,SAAA,GAAGS,QAAMrJ,GAAA,CAAc8I,KACrBC,OAAA,MACE0B,UAAO,SAAEgJ,IAAc,8BAAAzT,EAAA,cACvBiJ,GAAKiyB,GAAA,EAELrV,IACU7lB,QACR,CACAA,EAEA,MAAI,CACFsf,GAAU6qB,KACDtvB,CAAC,cAAkB,EAAC,EAE7BrZ,UACA4D,cAAS81B,CAAArgB,oBAAC,wBAAA1X,GAAA,QAA0B,KAAAR,EAAC,iBACvC,KAAA8iD,CAAA,CAEF97B,EACD,SACD5gB,EAAAS,EAAA,CACEP,KAAK,SACLI,IAAM6xB,GAAA,GAGJv4B,GAAO8wB,QAAkB,CACjBgyB,CACR,CACF,IAAE38C,WAEDU,mCAAIZ,EAAA,eAACa,SAAK,MAAYyxB,eAAArgB,uCAAE,UAAAgrC,EAAA,yBAASlrC,EAAApS,GAAA,EAAC,IAKjCc,MAAM2jB,GAL8B,MAAAxqB,EAAA,iCAEvCG,GAAOgE,EAASqe,CACf,CACE/b,GACM,QACIk9C,MACD,CACPN,SACA,IACI,IAAAa,EAAA,GACF,QACE,KAAMlkD,UAASiD,CACbtC,EAAKwX,IAET,GAAMqS,WAEJ,KAAMy4B,CAAS,CAAG,EAEdiB,+DAAU,KAAAh8B,CAAA,EACdg8B,EAAMC,yEAA8B,8BAAAA,CAAA,gCAC/BD,EAAA,GAAAh8B,CAAA;;;AAAA,6BAEG+6B,gCACRrgD,GAAC81B,GAAA,EAMCwrB,CAIF,GAAO,QACLA,CAAiB,SAAAlkD,EAAA,oBAAAmY,CAAA,uBAAoCgsC,CAAY,CACnE,EACAvhD,EAASyV,mBAAC,CAAsC,YAChD,EAEe,CACF6rC,MACV,CACHb,SAAiB,EACjBzgD,MAAS81B,EAAArgB,CAAC,GAAA1X,QAAA,CAAiB,EAAC,CAC9B,EAEA3B,WAEA4D,CAASyV,YAAC,WAA0B,CAAA9R,EAAAS,EAAA,MAAC,UACvCT,EAAAS,EAAA,CACF,qBACK0xB,GAAArgB,MAAE,GAAAjS,EAAAzF,IAAA,UAAyB,CAAAyF,EAAA,UAAC,cAACE,eAE7B,SAAM,CAAA28C,EAAO,QACjBj8C,IAAI,CAACC,IAAgBC,UAAK,oBAAA+7C,CAAA,EAAMrgD,GAAA81B,GAAA,EAIvC,IACEtyB,QAAA,CACO,CACLS,OACWo8C,IACFv8C,GAAM,EAEXoW,CACAla,WAASyV,GAAC,GAA0B,SAAC,CAAA9R,EAAAS,EAAA,CACvC,gBACEhI,gBAAe,CACf4D,WAAS81B,EAAArgB,cAAC,UAAkC,8CAAC4qC,CAAA,IAC/C78C,EAAA,UACF,cAAEE,eAEG,SAAM,CAAA28C,EAAW,QACtB18C,IAAA,CAAAD,IACE3F,UAAA,OAAkB,KAAAsiD,CAAA,CACb,CACC,MACTnmC,CAEG4Q,MAAMu1B,KAGC,CACC,YACKA,EAET,CACEnmC,EAAgB,SACd4Q,GAAMu1B,QACP,gBACS,QACVjkD,SAAQ6Y,IAAO,CACfiK,WAAKzJ,KAAC,OAAA4qC,EAAA,UAAA18C,EAAA,eAA+B,4BAACA,EAAAgC,EAAA,CACxC,YACF,QAAEjC,IAEDU,MAAI,CAAM,CAAS,CACpB,GACE,KAAAi8C,GAAA78C,EAAA,oBAAmB,CAAAG,EAAA,WAAC,MACf,gBACD,mBAEExF,CACL8F,SAAMN,EAAAgC,EAAA,CAAkBjC,WAC7B,CAAA3F,CAAA,KAAA4F,EACS08C,YAAaliD,MAAM,CAG3B,cAIN,KAAEkiD,GACD38C,SACEC,GAASM,SAAM,eAAAs6C,EAAA,yBAAe76C,CAC5B,GACE,GAAAnG,EAAAQ,SAAA,mCAAA4F,EAAA,mBAAgCH,EAAA,cAC3B,CAAAG,EAAAS,EAAA,CACA,KACTT,OAAA,GAAU0B,IAAO1B,EAAAgC,EAAA,IAAE0I,QAAO,EAAO,GAAS,GAAY,GACF,EACzC,CC3pCzBpP,GAAU1B,EAASikD,GAAY,CAC7B,SAAW,CAACx5C,EAAQk2C,EAAMjgD,EAAOwjD,CAAS,IAAKD,EAEzC,SAAS75C,KAAKu2C,CAAI,GAAK,CAACjgD,GAC1BqkB,IAGN,CAAC,EAED,SAAwBo/B,IAAS,CAC/B,KAAM,CAAE/kD,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAC/BokD,EAAWC,KACX5uC,EAAWqQ,KAEjBtnB,SAAU,IAAM,CACdmB,WAAW2kD,GAAS,GAAI,CAC1B,EAAG,EAAE,EAGHr+C,EAAAC,EAAA,CAAAC,SAAA,CACG,CAAC,CAAC9C,EAAW2B,aACZoB,EAACkE,GAAK,CACJ5D,MAAO,SAASrD,EAAWgB,cAAcC,UAAY,MAAQ,EAAE,GAC/DA,UAAW,CAAC,CAACjB,EAAWgB,cAAcC,UAAU6B,SAEhDC,EAACm+C,GAAe,CACdv+C,cACE,OAAO3C,EAAW2B,aAAgB,UAC9B3B,EAAW2B,YAAYgB,cACvB1J,OAAOkoD,aAAax+C,eAAiB,KAE3Cy+C,UACEzkD,EAAOgF,aAAay/C,WACpBnoD,OAAOkoD,aAAaC,WACpB,MAEFC,WACE1kD,EAAOgF,aAAa0/C,YACpBpoD,OAAOkoD,aAAaE,YACpB,KAEFnzB,YACEvxB,EAAOgF,aAAausB,aACpBj1B,OAAOkoD,aAAajzB,aACpB,KAEF2I,YACEl6B,EAAOgF,aAAak1B,aACpB59B,OAAOkoD,aAAatqB,aACpB,KAEF9yB,QAAU8oB,GAAY,CACpB,KAAM,CAAEy0B,YAAW7kD,WAAUwG,OAAMs+C,eAAgB10B,GAAW,GAC9DlwB,EAAOgF,YAAc,GACrB1I,OAAOkoD,YAAc,KACjBG,IACF3kD,EAAO6kD,mBACHD,GAAa5kD,EAAO8kD,uBACxBriD,GAAU,CACR8qB,KAAM,CACJxnB,KAAiBxD,EAAXqiD,EACF,CAAApkD,GAAA,UACA,CAAAA,GAAA,SADgB,EAEpBukD,MAAkBxiD,EAAXqiD,EACH,CAAApkD,GAAA,UACA,CAAAA,GAAA,SADiB,EAErBwkD,KAAIziD,EAAE,CAAA/B,GAAA,SAA6B,CAAC,EACpC8F,GAAQ,MAAM,EAChB8G,MAAO,IACPskB,SAAU,IACVnrB,QAAU0+C,GAAU,CAClBA,EAAM5e,YACNrmC,EAAOklD,aAAezvC,EAEpB2uC,EADEQ,EACO,MAGP9kD,EACI,IAAIA,CAAQ,MAAM6kD,EAAUnkD,EAAE,GAC9B,MAAMmkD,EAAUnkD,EAAE,EALV,CAQlB,EACD,EAEL,EACD,EACI,EAER,CAAC,CAAC6C,EAAW8hD,cACZ/+C,EAACkE,GAAK,CACJlD,QAASA,IAAM,CACbpH,EAAOmlD,aAAe,EACxB,EAAEh/C,SAEFC,EAACgZ,GAAQ,CACPhY,QAASA,IAAM,CACbpH,EAAOmlD,aAAe,EACxB,EACD,EACI,EAER,CAAC,CAAC9hD,EAAWw5B,cACZz2B,EAACkE,GAAK,CACJlD,QAASA,IAAM,CACbpH,EAAO68B,aAAe,EACxB,EAAE12B,SAEFC,EAAC0R,GAAQ,CACP1Q,QAASA,IAAM,CACbpH,EAAO68B,aAAe,EACxB,EACD,EACI,EAER,CAAC,CAACx5B,EAAW4f,aACZ7c,EAACkE,GAAK,CACJlD,QAASA,IAAM,CACbpH,EAAOijB,YAAc,EACvB,EAAE9c,SAEFC,EAACuyB,GAAY,CACXpgB,QAASlV,EAAW4f,aAAa1K,SAAWlV,EAAW4f,YACvDnjB,SAAUuD,EAAW4f,aAAanjB,SAClCsH,QAASA,CAAC,CAAEg+C,eAAgB,KAAO,CACjCplD,EAAOijB,YAAc,EAKvB,EACD,EACI,EAER,CAAC,CAAC5f,EAAWgiD,cACZj/C,EAACkE,GAAK,CACJlD,QAASA,IAAM,CACbpH,EAAOqlD,aAAe,EACxB,EAAEl/C,SAEFC,EAAC+gC,GAAa,CACZtuB,IAAKxV,EAAWgiD,aAAaxsC,IAC7BuuB,SAAU/jC,EAAWgiD,aAAaje,SAClChgC,QAASA,IAAM,CACbpH,EAAOqlD,aAAe,EACxB,EACD,EACI,EAER,CAAC,CAAChiD,EAAWkf,YACZnc,EAACkE,GAAK,CACJlD,QAASA,IAAM,CACbpH,EAAOuiB,WAAa,EACtB,EAAEpc,SAEFC,EAACgzB,GAAM,CAAChyB,QAASA,IAAOpH,EAAOuiB,WAAa,GAAS,EAChD,EAER,CAAC,CAAClf,EAAW8zB,gBACZ/wB,EAACkE,GAAK,CACJ/D,QAAUlJ,GAAM,EAEZA,EAAEoK,SAAWpK,EAAE6pB,eACf7pB,EAAEoK,OAAOiZ,UAAUkmB,SAAS,OAAO,KAEnC5mC,EAAOm3B,eAAiB,GAE5B,EAAEhxB,SAEFC,EAAC69B,GAAU,CACTpb,iBAAkBxlB,EAAW8zB,eAAetO,iBAC5C/oB,SAAUuD,EAAW8zB,eAAer3B,SACpC6mB,MAAOtjB,EAAW8zB,eAAerO,WACjCob,SAAU7gC,EAAW8zB,eAAe+M,SACpC98B,QAASA,IAAM,CACbpH,EAAOm3B,eAAiB,EAC1B,EACD,EACI,EAER,CAAC,CAAC9zB,EAAWiiD,uBACZl/C,EAACkE,GAAK,CACJlD,QAASA,IAAM,CACbpH,EAAOslD,sBAAwB,EACjC,EAAEn/C,SAEFC,EAAC26C,GAAiB,CAChB35C,QAASA,IAAOpH,EAAOslD,sBAAwB,GAChD,EACI,EAER,CAAC,CAACjiD,EAAWs0B,qBACZvxB,EAACkE,GAAK,CACJlD,QAASA,IAAM,CACbpH,EAAO23B,oBAAsB,EAC/B,EAAExxB,SAEFC,EAAC00B,GAAe,CACdh7B,SAAUuD,EAAWs0B,oBAAoB73B,SACzCg4B,yBACEz0B,EAAWs0B,oBAAoBG,yBAEjCiD,OAAQ13B,EAAWs0B,oBAAoBoD,OACvC3zB,QAASA,IAAOpH,EAAO23B,oBAAsB,GAC7CI,UAAW10B,EAAWs0B,oBAAoBI,UAC3C,EACI,EAER,CAAC,CAAC10B,EAAW0jC,cACZ3gC,EAACkE,GAAK,CACJlD,QAAU/J,GAAM,CACd2C,EAAO+mC,aAAe,EACxB,EAAE5gC,SAEFC,EAACy4B,GAAa,CACZ73B,IAAK3D,EAAW0jC,aAAa//B,KAAO3D,EAAW0jC,aAC/CnsB,KAAMvX,EAAW0jC,cAAcnsB,KAC/BxT,QAASA,IAAM,CACbpH,EAAO+mC,aAAe,EACxB,EACD,EACI,EAER,CAAC,CAAC1jC,EAAWkiD,gBACZn/C,EAACkE,GAAK,CACJ5D,MAAM,QACNU,QAASA,IAAM,CACbpH,EAAOulD,eAAiB,EAC1B,EAAEp/C,SAEFC,EAACy0B,GAAU,CACTpa,KAAMpd,EAAWkiD,eAAe9kC,KAChC5H,IAAKxV,EAAWkiD,eAAe1sC,IAC/B/H,MAAOzN,EAAWkiD,eAAez0C,MACjCC,OAAQ1N,EAAWkiD,eAAex0C,OAClC3J,QAASA,IAAM,CACbpH,EAAOulD,eAAiB,EAC1B,EACD,EACI,EAER,CAAC,CAACliD,EAAW0uB,iBACZ3rB,EAACkE,GAAK,CACJlD,QAASA,IAAM,CACbpH,EAAO+xB,gBAAkB,EAC3B,EAAE5rB,SAEFC,EAAC00C,GAAW,CACVviC,QAASlV,EAAW0uB,gBAAgBxZ,QACpCxS,KAAM1C,EAAW0uB,gBAAgBhsB,KACjCqB,QAASA,IAAM,CACbpH,EAAO+xB,gBAAkB,EAC3B,EACD,EACI,EAER,CAAC,CAAC1uB,EAAWytB,iBACZ1qB,EAACkE,GAAK,CACJ5D,MAAM,QACNU,QAASA,IAAM,CACbpH,EAAO8wB,gBAAkB,EAC3B,EAAE3qB,SAEFC,EAACqvC,GAAW,CACVloB,KAAMlqB,EAAWytB,gBAAgBvD,KACjC2J,MAAO7zB,EAAWytB,gBAAgBoG,MAClCnG,eAAgB1tB,EAAWytB,gBAAgBC,eAC3CC,QAAS3tB,EAAWytB,gBAAgBE,QACpC5pB,QAASA,IAAM,CACbpH,EAAO8wB,gBAAkB,EAC3B,EACAG,eAAgB5tB,EAAWytB,gBAAgBG,eAC5C,EACI,EAER,CAAC,CAAC5tB,EAAWmiD,oBACZp/C,EAACkE,GAAK,CACJ5D,MAAM,QACNU,QAASA,IAAM,CACbpH,EAAOwlD,mBAAqB,EAC9B,EAAEr/C,SAEFC,EAACq/C,GAAc,CACbhO,cAAep0C,EAAWmiD,mBAAmB/N,cAC7CpkB,eAAgBhwB,EAAWmiD,mBAAmBnyB,eAC9CjsB,QAASA,IAAIhL,IAAS,CAChBiH,EAAWmiD,mBAAmBp+C,SAChC/D,EAAWmiD,mBAAmBp+C,QAAQ,GAAGhL,CAAI,EAE/C4D,EAAOwlD,mBAAqB,EAC9B,EACD,EACI,EAER,CAAC,CAACniD,EAAW8W,0BACZ/T,EAACkE,GAAK,CACJlD,QAASA,IAAM,CACbpH,EAAOma,yBAA2B,EACpC,EAAEhU,SAEFC,EAACg3B,GAAoB,CACnBh2B,QAASA,IAAM,CACbpH,EAAOma,yBAA2B,EACpC,EACAurC,eACE,OAAOriD,EAAW8W,0BAA6B,SAC3C9W,EAAW8W,yBAAyBurC,eACpC,GAEP,EACI,CACR,EACD,CAEN,CCjVA,MAAAC,GAAezmD,GAAK,UAA6B,CAC/C,MAAMklD,EAAWC,KAEXuB,EAAgB,CACpB3gD,OAAQ,GACRC,gBAAkB7H,GACC,CAAC,CAACd,SAAS4I,cAAc,sBAAsB,GAC7C9H,EAAE+H,SAAW/H,EAAEgI,SAAWhI,EAAEiI,MACjD,EAGF9C,UAAW,MAAO,IAAM4hD,EAAS,GAAG,EAAGwB,CAAa,EACpDpjD,GAAW,MAAO,IAAM4hD,EAAS,gBAAgB,EAAGwB,CAAa,EAE1D,IACT,CAAC,ECXD,SAASC,GAAqB,CAAE38B,YAAWrN,UAAS,EAAG,CACrD,KAAM,CAAEzc,KAAGC,KACL,CAAEQ,SAAUyB,KACZ,CAAC8lB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAACsmD,EAAcC,CAAe,EAAIvmD,EAAS,IAAI,EAC/C,CAAC6qB,EAAcqE,CAAe,EAAIlvB,EAAS,IAAI,EAE/CwmD,EAAkB37B,IAAiB,KAEzC,OACEpkB,EAAA,KAAGS,MAAM,yBAAwBP,UAC/BC,EAAA,UACEE,KAAK,SACLmC,SAAU2e,IAAY,WAAa4+B,EACnCz/C,QAASA,IAAM,CACbmd,EAAW,SAAS,EACpBqiC,EAAgB,QAAQ,GACvB,SAAY,CACX,GAAI,CACF,MAAM1kC,EAAM,MAAMxhB,EAAMM,GAAG8lD,eACxBljD,QAAQmmB,CAAS,EACjBg9B,YACH,GAAI,CAAC7kC,GAAK4N,WACR,MAAM,IAAIonB,MAAM,6BAA6B,EAE/C3nB,EAAgBrN,CAAG,EACnBxF,GACF,MAAY,EACVhd,WAAe,KAEjB6kB,EAAoB,SACnBtd,EAAAgC,EAAA,CACL,YAAEjC,CAEF,GAAA3F,IAAA4F,EAAA,eAAoB,SACd,SACRA,IAAA,WAAA4/C,EACE1/C,MAAK,eACLmC,aACA/B,EAAM,aACS,WACbgd,SAAW,CACXqiC,IACC,MAAA1kC,EAAY,MAAAxhB,EAAA,0BAAAqpB,CAAA,WACX,GAAI7H,GAAA,WACF,MAAMA,IAAM,MAAMxhB,6BACfkD,EAGD2rB,GAAgB,EAClB7S,EAAA,CACA6S,OACA7S,EAAS,UACX,CACEhd,IACA6kB,EAAoB,SACtBtd,EAAAgC,EAAA,CACF,GAAG,SACL,IAAEjC,SAEFiC,CAAA,uCAAoB49C,GAAAF,MAAA,SAAA1/C,EAAAS,EAAA,CAEtBT,KAAA,eAAMM,IAAMnE,EAIJuE,CACAE,GAAGzE,WAAE,MAAA/B,iBAAA,GAAU4F,EAAAS,EAAA,CAAC,gBAChBH,MAGII,CAAgBE,GAAGzE,WAAE,MAAA/B,iBAAA,GAAU4F,EAAA8jB,GAAA,CAAC,OAAA9C,IAAA,WAAQ,EAAiB,CAG1D,EAAqB,CC9DtC,MAAM++B,GAAqB,CACzBliC,QAAS,UACTrP,OAAQ,eACRuP,OAAQ,SACRC,OAAQ,SACRgiC,eAAgB,aAChBliC,UAAW,QACXxW,KAAM,OACN8O,OAAQ,SACR,eAAgB,eAChB,eAAgB,kBAChB6pC,sBAAuB,cACvBC,mBAAoB,QACpBC,eAAgB,SAChB,yBAA0B,SAC1BC,cAAe,YACfxsB,MAAO,QACPysB,cAAe,QACjB,EAqBA,SAASC,GAAU,CAAEnuC,UAASouC,QAAOC,WAAU,EAAG,CAChD,IAAI/tC,EACAguC,EACA,OAAOD,GAAc,SACvB/tC,EAAM+tC,GAEN/tC,EAAM+tC,GAAW/tC,IACjBguC,EAAYD,GAAWC,WAEzB,MAAMC,EAAcjuC,EAClBzS,EAAC2gD,GAAW,CAACluC,MAAUguC,YAAsB7/C,IAAK2/C,EAAQ,EAE1DA,EAEF,OACEvgD,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA8X,UACUuuC,cAAwC,CAC3C,CAEX,CAEA,MAAME,GAAc,CAClBpyC,OAAQA,CAAC,CAAE2D,aAAcnS,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA8X,UAAe,CAA0B,EAClE4L,OAAQA,CAAC,CACPknB,QACA9yB,UACA0uC,aACAC,WACAn9C,WAAY,CAAEo9C,UAAQ,IAEtB/gD,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAAuJ,EAyBiCkuB,GAAcmT,CAAK,EAACphC,EAQpBiuB,GAAcmT,CAAK,EAACA,QAhCvC4b,aAayBC,WAOlB3uC,WAPHxO,WAAA,CAAAC,EAUR5D,EAAC+gD,EAAO,CAACC,UAAW/b,EAAQ,EAEnB,EAACphC,EADR7D,EAAA,QAAMqD,MAAO4hC,EAAmC,EAAC3gC,EAOnDtE,EAAC+gD,EAAO,CAACC,UAAW/b,EAAQ,EAEnB,EAAC/S,EADRlyB,EAAA,QAAMqD,MAAO4hC,EAAmC,EAAC,CAO5D,EAEHjnB,OAAQA,CAAC,CAAE7L,UAAS8yB,QAAOthC,WAAY,CAAEo9C,UAAQ,IAC/C/gD,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAAuJ,EAM6BkuB,GAAcmT,CAAK,EAACA,QALnC9yB,WACOxO,WAAA,CAAAC,EAGf5D,EAAC+gD,EAAO,CAACC,UAAW/b,EAAQ,EAEnB,EAACphC,EADR7D,EAAA,QAAMqD,MAAO4hC,EAAmC,EAAC,CAKxD,EAEH+a,eAAgBA,CAAC,CAAE7tC,aACjBnS,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA8X,UAAe,CAAiC,EAElD2L,UAAWA,CAAC,CACV3L,UACA8yB,QACA4b,aACAC,WACAn9C,WAAY,CAAEo9C,UAAQ,IAEtB/gD,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAAuJ,EAyBiCkuB,GAAcmT,CAAK,EAACphC,EAQpBiuB,GAAcmT,CAAK,EAACA,QAhCvC4b,aAauBC,WAOhB3uC,WAPHxO,WAAA,CAAAC,EAUR5D,EAAC+gD,EAAO,CAACC,UAAW/b,EAAQ,EAEnB,EAACphC,EADR7D,EAAA,QAAMqD,MAAO4hC,EAAmC,EAAC3gC,EAOnDtE,EAAC+gD,EAAO,CAACC,UAAW/b,EAAQ,EAEnB,EAAC/S,EADRlyB,EAAA,QAAMqD,MAAO4hC,EAAmC,EAAC,CAO5D,EAEH39B,KAAMA,IAAA6qB,GAAArgB,EAAM,CAAA1X,GAAA,SAAgD,EAC5D,YAAa6mD,IAAA9uB,GAAArgB,EAAM,CAAA1X,GAAA,SAAoC,EACvD,aAAc8mD,IAAA/uB,GAAArgB,EAAM,CAAA1X,GAAA,SAAqC,EACzDgc,OAAQA,CAAC,CAAEjE,aACTA,EACEnS,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA8X,UAAe,CAAuB,EAACggB,GAAArgB,EAEvC,CAAA1X,GAAA,SAA6C,EAEjD,mBAAoB+mD,CAAC,CACnBlc,QACA9yB,UACA0uC,aACAC,WACAn9C,WAAY,CAAEo9C,UAAQ,IAEtB/gD,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAAuJ,EAyBiCkuB,GAAcmT,CAAK,EAACphC,EAQpBiuB,GAAcmT,CAAK,EAACA,QAhCvC4b,aAaiCC,WAO1B3uC,WAPHxO,WAAA,CAAAC,EAUR5D,EAAC+gD,EAAO,CAACC,UAAW/b,EAAQ,EAEnB,EAACphC,EADR7D,EAAA,QAAMqD,MAAO4hC,EAAmC,EAAC3gC,EAOnDtE,EAAC+gD,EAAO,CAACC,UAAW/b,EAAQ,EAEnB,EAAC/S,EADRlyB,EAAA,QAAMqD,MAAO4hC,EAAmC,EAAC,CAO5D,EAEHob,cAAeA,CAAC,CAAEluC,aAChBnS,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA8X,UAAe,CAAuC,EAExD,gBAAiBivC,CAAC,CAAEjvC,aAAcnS,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA8X,UAAe,CAAmB,EACpE,eAAgBkvC,CAAC,CAAElvC,UAASmvC,mBAC1BthD,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA8X,UACUmvC,gBAAyB,CAC5B,EAETrB,sBAAuBA,CAAC,CAAE9qC,UACxBnV,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA8a,QACgCxR,WAAA,CAAAC,EAAR5D,EAAA,MAAY,EAAC,CAC9B,EAETkgD,mBAAoBA,IAClBlgD,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAgC,EAC/B,EAEL+lD,eAAgBG,GAChB,yBAA0BA,GAC1BF,cAAeA,CAAC,CAAEmB,UAAWvhD,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAAknD,OAAiB,CAA6B,CAC7E,EAGMC,GAA6B,CACjCC,mBAAoBA,CAAC,CAAE10C,OAAM20C,gBAC3B1hD,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA0S,OACwB20C,cAAkC/9C,WAAA,CAAAC,EAA1C5D,EAAA,MAAY,EAAC6D,EAAe7D,EAAA,MAAkB,EAAC,CAExD,EAET2hD,aAAcA,CAAC,CAAE50C,OAAM20C,aAAY7vB,iBAAgBG,oBACjDhyB,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA0S,OACwB20C,aAAgC7vB,iBAC5BG,kBAA8BruB,WAAA,CAAAC,EAD1C5D,EAAA,MAAY,EAAC6D,EAAa7D,EAAA,MAAkB,EAAC,CAEtD,EAET4hD,kBAAmBA,CAAC,CAAEF,aAAY7vB,iBAAgBG,oBAChDhyB,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAAqnD,aACiC7vB,iBAAyCG,kBAC7CruB,WAAA,CAAAC,EADV5D,EAAA,MAAkB,EAAC,CAE/B,CAEX,EAEM6hD,GAA0B,CAC9BC,KAAM,CAAA1nD,GAAA,UACN2nD,QAAS,CAAA3nD,GAAA,UACT4nD,2BAA4B,CAAA5nD,GAAA,UAC5B6nD,gBAAiB,CAAA7nD,GAAA,UACjB8nD,UAAW,CAAA9nD,GAAA,UACX+nD,QAAS,CAAA/nD,GAAA,UACTgoD,QAAS,CAAAhoD,GAAA,SACX,EAEMioD,GAAgB,GAEtB,SAAS3jC,GAAa,CACpBrjB,eACA3B,WACA4oD,WACAC,oBACF,EAAG,CACD,KAAM,CAAEzwC,KAAG7Y,KACL,CAAEQ,SAAUyB,KACZ,CACJd,KACAoU,SACA2D,UACAqwC,SACApsD,QACA8pD,qBACAuC,eAEAC,OACAC,YACAC,YACAC,aAEAC,iBACAC,qBACAC,WACAC,sBACAC,wBACE7nD,EACJ,GAAI,CAAE6E,QAAS7E,EAEf,IAAK6E,IAAS,WAAaA,IAAS,UAAY,CAACsO,EAE/C,OAAO,KAIT,MAAM20C,EAAe30C,GAAQuP,QAAUvP,EACjC40C,EAAiBD,GAAc/oD,GAE/BwX,EAAiBpS,KACjBgqB,EAAS5X,IAAmBO,GAAS/X,GACrCipD,EAAU70C,GAAQlH,MAAMg8C,MACxBC,EACJ,CAAC,CAAC/0C,GAAQg1C,oBACVh1C,GAAQg1C,qBAAuB5xC,GAC/BpD,GAAQ2D,SAAS/X,KAAOwX,EAE1B,IAAI6xC,EAAY,EACZC,GAAe,EACnB,GAAIxjD,IAAS,mBAAoB,CAC/B,GAAIyiD,EACF,UAAWxwC,KAAWwwC,EAChBxwC,EAAQqjB,QAAQ7mB,SAAS,WAAW,GACtC80C,IAEEtxC,EAAQqjB,QAAQ7mB,SAAS,QAAQ,GACnC+0C,KAIF,CAACA,IAAgBD,IAAWvjD,EAAO,aACnC,CAACujD,GAAaC,KAAcxjD,EAAO,SACzC,CAEA,IAAIinB,EACAjnB,IAAS,OACXinB,EAAOy5B,GAAYp3B,EAAS,YAAc65B,EAAU,aAAe,MAAM,EAChEzC,GAAY1gD,CAAI,EACzBinB,EAAOy5B,GAAY1gD,CAAI,EAIvBinB,EAAIgL,GAAArgB,EAAG,CAAA1X,GAAA,SAAAC,OAAA,CAAA6F,OAAoC,CAAE,EAG/C,MAAM6gD,EAAUA,CAAC,CAAEC,YAAW,GAAG2C,MAC/B3C,EACEhhD,EAAA,KAAGkS,SAAS,IAAI/R,QAASyjD,EAA0B,GAAKD,GAAQ,EAEhE3jD,EAAA,QAAO2jD,GAAQ,EAGbE,EACJd,EAAqB,GAAKA,EAAqBD,GAAgBtoD,OAC3DspD,EAAiBD,EAAY,SAAW,QAE9C,GAAI,OAAO18B,GAAS,WAAY,CAC9B,MAAM8d,GACH/kC,IAAS,aAAeA,IAAS,WAAa6iD,EAC3Cc,EACEd,EACAD,GAAgBtoD,OAClBmoD,GAAWnoD,QAAUsoD,GAAgBtoD,SAAW2X,EAAU,EAAI,GAC9D0uC,GAAa+B,GAAWpoD,SAAWgU,EAAS,EAAI,GACtD,GAAItO,IAAS,eAAgB,CAC3B,MAAMohD,GAAgBkB,GAAQlB,cAC1BA,KACFn6B,EAAOA,EAAK,CACVhV,QAASnS,EAAC8S,GAAQ,CAACX,UAAkB4xC,WAAU,GAAE,EACjDzC,cAAethD,EAAC8S,GAAQ,CAACX,QAASmvC,GAAeyC,WAAU,GAAE,EAC9D,EAEL,SAAW7jD,IAAS,wBAAyB,CAC3C,MAAMwhD,GAAatrD,GAAOsrD,WACtBA,KACFv6B,EAAOA,EAAK,CAAEhS,KAAMusC,GAAY,EAEpC,UACGxhD,IAAS,kBAAoBA,IAAS,2BACvC7E,EAAaklD,MACb,CACA,MAAMyD,GACJ3oD,EAAamlD,WACbhyC,GAAQkf,QAAQ3Y,OACbwrC,GACCA,GAAO0D,YACP5oD,EAAaklD,MAAMvyC,QAAQ,KAAM,EAAE,EAAEA,QAAQ,KAAM,EAAE,CACzD,EACFmZ,EAAOA,EAAK,CACVhV,QAASnS,EAAC8S,GAAQ,CAACX,UAAkB4xC,WAAU,GAAE,EACjDxD,MAAOllD,EAAaklD,MACpByD,YACD,CACH,MAAW9jD,IAAS,gBAClBinB,EAAOA,EAAK,CACV,GAAG9rB,EAAaonD,aACjB,EAEDt7B,EAAOA,EAAK,CACVhV,QAASA,EACPnS,EAAC8S,GAAQ,CAACX,UAAkB4xC,WAAU,GAAE,EAExCjB,IAAiB,CAAC,GAChB9iD,EAAC8S,GAAQ,CAACX,QAAS2wC,EAAe,CAAC,EAAGiB,WAAU,GAAE,EAGtD9e,QACA4b,cACAC,SAAUyC,EAAkB,QAAU,OACtC5/C,WAAY,CAAEo9C,UAAQ,CACvB,CAEL,CAEA,MAAMmD,EACJ7oD,EAAasH,WAAa,IAAID,KAAKrH,EAAasH,SAAS,EAAEW,iBAEvD6gD,EACJ,CACE,mBAAkBhyB,GAAArgB,EAAE,CAAA1X,GAAA,SAAmB,EACvC0jB,UAASqU,GAAArgB,EAAE,CAAA1X,GAAA,SAAW,EACtB2jB,OAAMoU,GAAArgB,EAAE,CAAA1X,GAAA,SAAa,EACrB4jB,OAAMmU,GAAArgB,EAAE,CAAA1X,GAAA,SAAc,CAAC,EACvB8F,CAAI,GAACiyB,GAAArgB,EAAI,CAAA1X,GAAA,SAAU,EACjBwpD,EAA4BA,IAAM,CACtChqD,EAAO23B,oBAAsB,CAC3BC,QAAS2yB,EACTznD,SAAUimD,EACV3tB,cAAe90B,IAAS,mBACxBwxB,yBAA0BxxB,IAAS,SAAW,CAAC,YAAY,EAAI,GAC/Dy0B,OAAQyvB,GAAUhB,EAAgB1pD,CAAQ,EAE9C,EAEAjB,MAAc,UAGd,MAAM+V,EAAQ61C,GAAU,cAAAzyC,EAChB0yC,GAAY91C,GAAQ2D,EAAS/X,SAAOwX,iBAC1C,IAAA4X,GAAM+6B,IAAaC,IAAkBH,SAAU,OAC/C,OAAK76B,IACI,CAEX,OAAA3pB,EAAA,OAEA,mCACEK,CAAA,GACEI,4BACA,oBAAsBoiD,KAAQtoD,QAC9B,aACA8X,SAAS,CAAAlS,EAAA,OAAGD,wCAEZG,CAAA,GACEI,MAAO4jD,EACP7gD,SAAO6gD,4BAAmBnkD,SAEzBG,KAAS,CACRH,cACQW,KAAK,KAASC,MAAUC,MAAKV,gBAAMI,EAAMG,EAAA,CAAe,KAC9DT,QAAMU,KAAK,KAAQC,MAAUC,MAAKV,kBAAMI,CAAM,GAAmBN,EAAAS,EAAA,CACjE,KAEFT,GAAKE,CAAA,kBACHQ,KAAMq/C,KACNp/C,KAAK,EACAT,GACNL,EAAA,OAEA,MACLA,uBAAKS,SAAM,CAAAJ,IAAA,WAAAA,IAAA,SAAAL,EAAAC,EAAA,UAgBRI,QACCH,SACEC,CAAA,GAAAD,IAAIonB,wBAAQ,UACFhV,EAAA,EACa,OAAYA,yBAAQ/X,SAAK,SAE/C8F,CAASshD,GACR3hD,EAAA,OAAAE,OAEIgN,IAAMrT,GACNsG,EAAG5J,qBAEL4J,WAAKtG,CACL,yBACEyZ,gBACA9R,eACA4Z,SAAIjb,EAAAgC,EAAA,CAAUjC,YAEd3F,WAAA,CAAAuJ,MAAA,CAAAC,KACcnD,WAAKC,KAAK,KAAgB,CAAK,EAAC,GACvC,WAGX,wBAAAw/C,GAAArgD,EAAA,gBAEDK,CAAS4R,EAAA+vC,GAA0B3B,WAClC,EAAAlgD,EAAA,SAAAA,EAAA,KAAAD,0BACK8hD,OAGD1uC,OAAM,SACN9R,eACA4Z,SAAIjb,EAAAgC,EAAA,CAAUjC,YAEd3F,WAAA,CAAAuJ,MAAA,CAAAC,KACcnD,WAAKC,KAAK,KAAgB,CAAK,EAAC,GACvC,GACLR,IAAA,iBAAAF,EAAA,OACD,SAENE,EAAS4T,GAAA,CACR/T,qBACO0iD,GAAA,OAAC1gD,SAAI/B,EAAAgC,EAAkBygD,CAAqB1iD,WAC/C,IAA8B,EAAC,CAC3B,GAET4iD,GAAA,UAAA9iD,EAAA,KACD,MAEH8iD,gBACIriD,SAAM,CAAAqiD,EAAA,QAAAN,EAAA,MAAAn0B,GAAAruB,EAAAk2C,EAAA,CAAeh2C,SACrB4iD,OAAUn2C,CACAzM,OACP,IAEEoT,eACA8H,MAAI,uBACJ3a,QAAMrJ,IAAA,mBACU,EACdA,EAAEoJ,YAAe6tB,CACjBt0B,EACF,UAAAoG,EAAAwS,GAAA,CAAEzS,MAEDyS,aACCC,KAAKN,EAAQO,sCACb/R,SACYnG,WAAU,OAEhBmoD,OAKN/hD,SAAQuR,GAAQqP,GAA4B,IAClCrP,QAASsb,mCAFdtb,oBAKA7R,SAAM4tB,EAAA,WAAAu2B,IAAAzkD,EAAAS,EAAA,WACYP,EAEjBQ,KAAMq/C,IACNp/C,MAAK,GAAA8jD,EAAA,SACLnkD,CAAc,EAAQ,CAEzB,EACE4tB,EACN,UAAAA,EAhCI/b,EAAQ/X,IAiCV8F,IAAG,oBAAAA,IAAA,aAAAA,IAAA,WAAA4jD,IAAA,SAAAjkD,EAAA,eAnCKsS,SA2CbjS,MAAK,cACLI,kBAAMuiD,GAAA,UACN,eACS1iD,oBAAM,CACbvG,QAAO23B,EACLC,SAAS2yB,EACTznD,cAAUimD,kBACK,MAAY,mBAAAE,EAAA,UAAA6B,IAAA,CACzB,UAAoB,GAAMnL,sBACxBsJ,IAAWrgD,cAAWkiD,SAAS,EAC7B,MAAM7L,WAAWp/C,EAASO,aACvB2C,CAGH,IAEJD,GAAA,GACA,gBAAiBioD,EAAA,CACjB,MAAA5mD,MAAyB4mD,GAAa,MAC9BF,GAAM9B,aAAaiC,QAAWtqD,4CACpC,GAAAmqD,GAKA,UAAWv2B,MAAA22B,GAAA,CACX,MAAAvvB,MAAsBqtB,KAAW52C,OAAA,KAAAmiB,GAAA,IAC/BoH,GAGAA,GAAIA,OAAY,KAAAmvB,EAAA,GAEhBv2B,GAAO,QAAAu2B,EAAA,EACLtyC,GAAQqjB,OAAUt1B,EACG,CACvB,CAEJ,OACA,KAAO,GACLk1B,MAAM14B,EAAA,CACCA,EAEX,cAAAwD,IAAA,mBACA80B,UAAe90B,EAASxG,CAAA,EACkB,EAE9C,eAAAwG,IAAA,aAAAA,IAAA,WAAA6iD,EAAAJ,EAAA,OAAA3iD,EAAAS,EAAA,CAAEV,mBAKG,EAACW,CAAK,GAAiBb,EAAA,UACtB,KAERA,SACEK,MAAK,cACLI,QAAMsjD,EACNzjD,SAASyjD,qCAA0B7jD,mBAI9B,EAACW,CAAK,EAAc,CAAG,GAE/B,CAAAiiD,GAAA,QAAAG,GAAA,UAAAjjD,EAAA,WAGH8iD,gBACGriD,SAAM,CAAAwiD,EAAA,IAAA50B,GAAAruB,EAAAk2C,EAAA,UACN+M,QACU/iD,OACP,IAEEoT,eACA8H,MAAI,uBACJ3a,QAAMrJ,IAAA,mBACU,EACdA,EAAEoJ,YAAe6tB,CACjBt0B,EACF,SAAAoG,EAAAwS,GAAA,CAAEzS,MAEDyS,aACCC,KAAKN,MACLxR,OAAKutB,EAAA,gBAAAA,EAAA,OAELttB,SAAQuR,GAAQqP,GAA4B,IAClCrP,GAASsb,EAAIS,IAFV9zB,EAGd,MAAC8zB,EAfG/b,EAAQ/X,GA2BZ2oD,EAAKD,EAAA,QAAAjjD,EAAAiU,GAAA,UAGXivC,SAAqBD,WAAetoD,IACnCqF,GACEkC,MACErI,8BAEF4G,SAAM,KAAAyiD,EAAAD,EAAA,OAAA9iD,EAAAS,EAAA,qBAGD,EAACC,CAAK,EAAe,CAAG,GAEhCkiD,GAAA,UAAA5iD,EAAA,MACA,MAEJ4iD,8BACKtiD,SAAMsiD,EAAA,IAAAkC,GAAA9kD,EAAA,eACP4iD,KAAep0C,CACdzO,iCACgBG,CAAA,GACZI,kBAAsC,WAAAwkD,EAAA,KACtC/iD,SACErI,EAAWg8B,GAAIh8B,CAChBqG,OAEDC,EACEwO,SACA7N,YAAK,GACL20C,iBAAW,GACXyP,eAAgB,EACJ,EACb,EACYD,EAAA,OAACt2C,IACd,CACLo0C,GAAA,QAAAA,GAAA,YAAA5iD,EAAAglD,GAAA,CACC,MAELx2C,4BAAiCo0C,GAE9BtiD,iBAAsC,SAAA8iD,CAAA,GACtCrhD,cAEMwgD,EAiBE,OAjBgBa,IAGxBhjD,SACEnJ,EAACsrD,qBACItrD,SAAM,EACL,GAAA0I,GAAMA,CACN,GAAIA,UAAM,OAER1I,EAAA,eAAe,EACfA,GAAEoJ,cAAe,8BACjBV,QAAKslD,UAEDC,QAASjuD,EAAEiuD,SACXC,CAAWA,CAEf,EAEJ,SACA1mD,QACLsB,OAEAuiD,EAEG9zC,SACA7N,SAAK,GACLmc,iBAAQ,GACRioC,eAAgB,GAChBK,KAAY,CACb,SAEA1vB,EACCoI,SACAn9B,SAAK,GACLmc,iBAAQ,GACRioC,eAAgB,EACJ,GACb,EACF,CAEJ,EACG,CAGZ,SAAAC,GAAArB,EAAA,CAEA,MAAA1jD,KAAuB0jD,EACrB,SAAY0B,IACZ,GAAA1B,EAAY,iBAAKA,KAAO7xC,CAAgB,cAAc,IAAA7R,CAAA,EAAEA,CAC1D,MAAAqlD,GAAAxsD,GAAA4lB,GAAA,CAAA6mC,EAAAC,IAEAD,EAAezsD,cAAK4lB,KAAe6mC,EAAUC,cAAa,EACxD,EC7xBI,kBAAmBjvC,WACrB9d,wBAAY,iBAA0B,UAAArC,GAAA,CACtCmgB,MACE9d,OACA,GAAA2B,EAAQ8F,eAAM9F,YAAImY,qBAAY3Y,EAAIxD,kBAAgB,CAC9C8J,KACFtG,aAA2B,EAEzB2Y,GAGL,MAAAkzC,GACH3sD,GAAA,WACF,MAEA,EAAAqD,CACE,EAAAlD,GAAM,KAAED,2CAAE,MAACC,EAAAiE,GAAAtD,CAAA,EACL,CAEN,kBAAA8rD,CACA,EAAAzoD,EAAQyoD,CAAkB,GAAAtrD,EAE1B3B,aAEA,EAAAitD,GAAM,GAAEtrD,eAAImY,KAAY,UAA0B,OAClD,KAAOozC,CAEPxnB,UACE,EAAIjjC,GAACd,EACC,CAAEV,kBACR,EAAAwB,GAAM,CAAEzB,gBAAoByB,EAAI+sB,IAAAvuB,EAC9B6Y,gBACD,UACD9Z,MAAQma,EAAW,MAAAnZ,EAAA,yBAAAW,CAAA,UAAEmY,SAAa0V,sBAAiBvuB,CAAU,KAAAwG,EACvDioB,SACAhW,SAGN,EAAC9W,EACOA,IAAe,SAAM5B,oCAAmCmB,QAC1CuX,UAAS,EAAAyzC,GAAA,GAC3BntD,EAAY,EAAAmtD,GAAoB,GAAExrD,UAAIiB,KAAc8W,eAAS,QAAAyzC,EAC7D,UACA,EAAQ1lD,YAAMsO,GAAQ2D,KAAiC9W,UACvD,aAAAA,EACA,aAAA8sB,CACA,KAIEvuB,SAAOijB,SAAcoL,CAAA,MAAAzZ,EAAA,KACVo3C,EACTlsD,cAAU60B,kBAEd,SAAWs3B,qBAMPzrD,CACA+X,IACA9W,MACA8sB,MACD,KACH,WAAO,eACL,UAAI29B,cAAW,CAEqC,MAGlDz2C,GAASpL,GAAWgkB,CAA2C/uB,GAC1D,0BAELmW,wBAAgB,CAClB,GACF,MACFrO,EAAO,KACLvI,MAA6CmB,EAC/C,uBACC,8CACDQ,SAAImY,KAAY,iBAuBlB,EACEgE,KAAUwvC,CACZ,SACGC,EACLhuD,UACE,aAAAqD,EACE5C,cACA8d,IACF,OAAAvW,EAAAkE,GAAA,CACD,QAAAjN,GAAA,YAEqBA,EAAA,eACpBgvD,GAIA,EACE52C,SAASpL,EAAO,OAClB,cACF,cAEI0hD,qBAAuB,CACnB,cAAEvrD,oBAAI+X,UAAS9W,cAAc8sB,SAAiBw9B,OAIxCtkD,WACJL,CAAQ,CACV,CACF,EAAEjB,aAEF,CAAKO,SAAMN,EAAA,KAAQkS,SAASlS,EAAAgC,EAAA,CAAIjC,WAC9B,CAAQG,CAAK,CAASI,CAAM,GAAcH,SAASa,CAAQjB,SACzDC,KAAKA,EAAA,KAACU,SAAKV,EAAAgC,EAAA,CAAIpB,GAAGzE,aAAE6D,EAAA,aAAA5F,oBAAA,QAAOnD,GAAA,CAAC,MAAG,OAAAoK,CAAA,EAEjCpK,GAAA8I,EACEC,OAAA,oBAAA/I,EAAA,uBAAA8I,GACE,EACC,SAAAC,EAAA0e,GAAA,CAEL7e,SAAAsS,EAAA,YAAApS,eAEIA,WACE,KAA2DC,EAAA,OAC1D,MAEL,CACEM,UAAM,OAKJ,SAAMT,EAAAiU,GAAA,IAAEzS,iBAAO,MAAIpK,eAEnB,QAAMoK,EACJL,SAAQ,CAAAhB,EAAA,QACV,SAAAA,EAAAgC,EAAA,CACF,YAAEjC,CAEW,SACDoS,EAAQ9D,CAClBhT,mBACAinD,EAAQ,CACT,EACE,EACL,GACS,EACM,EACb,CAEK,WAAI,GC/LV4D,GAAmBA,CAAC,CAAEhsD,OAAM,EAAI,KAAO,CAClD,MAAMisD,EAAUxyC,GAAMxB,QAAQ0B,IAAI,eAAe,GAAK,GACtD,OAAO3Z,EAAQisD,EAAQ35C,MAAM,EAAGtS,CAAK,EAAIisD,CAC3C,EAEMC,GAAqB,GACdC,GAAqBA,CAACnV,EAAOoV,EAAY,OAAS,CAC7D,GAAI,CAACpV,GAAOrqB,SAAU,OAEtB,MAAMs/B,EAAUD,GAAgB,EAC1BK,EAAgBJ,EAAQnhC,UAC3BwhC,GAASA,EAAKtV,QAAUA,GAASsV,EAAKF,YAAcA,CACvD,EAIIC,IAAkB,IACpBJ,EAAQ/yC,OAAOmzC,EAAe,CAAC,EAGjCJ,EAAQM,QAAQ,CACdvV,MAAOA,EAAMrqB,KAAI,EACjBy/B,YACAI,UAAWhkD,KAAK1G,IAAG,CACrB,CAAC,EACD,MAAM2qD,EAAiBR,EAAQ35C,MAAM,EAAG45C,EAAkB,EAE1DzyC,GAAMxB,QAAQwD,IAAI,gBAAiBgxC,CAAc,CACnD,EAEaC,GAA0BA,CAAC1V,EAAOoV,EAAY,OAAS,CAElE,MAAMO,EADUX,GAAgB,EACA3yB,OAC7BizB,GAAS,EAAEA,EAAKtV,QAAUA,GAASsV,EAAKF,YAAcA,EACzD,EACA3yC,GAAMxB,QAAQwD,IAAI,gBAAiBkxC,CAAe,CACpD,EAEaC,GAAwBA,IAAM,CACzCnzC,GAAMxB,QAAQwD,IAAI,gBAAiB,EAAE,CACvC,EC9BaoxC,GAAyBA,CAAC7V,EAAOoV,EAAW5sD,IAAa,CACpE,IAAI4I,EAAOP,EAAIrB,EAEf,GAAI4lD,IAAc,WAChBhkD,EACEtC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA62C,SACsBvtC,WAAA,CAAAC,EAAT5D,EAAA,MAAa,EAAC,CACpB,EAET+B,EAAK,aAAa24C,mBAAmBxJ,CAAK,CAAC,iBAC3CxwC,EAAO,mBACE4lD,IAAc,WACvBhkD,EACEtC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA62C,SACyBvtC,WAAA,CAAAC,EAAT5D,EAAA,MAAa,EAAC,CACvB,EAET+B,EAAK,aAAa24C,mBAAmBxJ,CAAK,CAAC,iBAC3CxwC,EAAO,gBACE4lD,IAAc,WAAY,CACnC,KAAM,EAAGU,EAAa,IAAKC,EAAc/V,CAAK,EAC5CA,EAAMoM,MAAM,eAAe,EACvBvD,EAAU,GAAGiN,CAAU,GAAGC,CAAW,GAC3C3kD,EACEtC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA0/C,WACkCp2C,WAAA,CAAAC,EAAd5D,EAAA,SAAqB,EAAC,CACnC,EAET+B,EAAK,IAAIrI,CAAQ,MAAMutD,CAAW,GAClCvmD,EAAO,SACT,MAEE4B,EACEtC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA62C,SACQvtC,WAAA,CAAAC,EACN5D,EAAA,SAAOM,MAAM,gBAAuD,EAAC,CAChE,EAETyB,EAAK,aAAa24C,mBAAmBxJ,CAAK,CAAC,GAC3CxwC,EAAO,SAGT,MAAO,CAAE4B,QAAOP,KAAIrB,OACtB,EAEMwmD,GAAaC,GAAW,CAACxD,EAAO1jD,IAAQ,CAC5C,KAAM,CAAEjH,KAAGC,KACL,CAAES,YAAawB,KACf,CAACksD,EAAcC,CAAe,EAAIC,KAClC,CAACC,EAAgBC,CAAiB,EAAIpuD,EAAS,EAAK,EACpD,CAAC83C,EAAOuW,CAAQ,EAAIruD,EAASguD,EAAavzC,IAAI,GAAG,GAAK,EAAE,EACxD3T,EAAOknD,EAAavzC,IAAI,MAAM,EAC9BwoC,EAAUlkD,EAAO,IAAI,EAErBuvD,EAAiBvvD,EAAO,IAAI,EAClCwvD,GAAoB1nD,EAAK,KAAO,CAC9B2nD,SAAWttD,GAAU,CACnBmtD,EAASntD,CAAK,CAChB,EACA0kB,MAAOA,IAAM,CACX0oC,EAAervD,QAAQ2mB,OACzB,EACAjC,OAAQA,IAAM,CACZ2qC,EAAervD,QAAQ0kB,QACzB,EACA8qC,KAAMA,IAAM,CACVH,EAAervD,QAAQwvD,MACzB,GACA,EAEF,MAAMC,EAAgBxzC,GACpB,IAAM4xC,GAAiB,CAAEhsD,MAAO,EAAG,EACnC,CAACypD,GAAOprD,MAAM,CAChB,EAEMwvD,EAAwBzzC,GAAQ,IAAM,CAC1C,GAAI,CAAC48B,EAAO,MAAO,GAWnB,MAAM8W,EATkBF,EACrBv0B,OAAQ00B,GAEHA,EAAY/W,QAAUA,EAAc,GAEjC+W,EAAY/W,MAAMlzC,cAAc2Q,SAASuiC,EAAMlzC,aAAa,CACpE,EACAwO,MAAM,EAAG,CAAC,EAE6BhK,IAAKylD,IAAiB,CAC9D,GAAGlB,GACDkB,EAAY/W,MACZ+W,EAAY3B,UACZ5sD,CACF,EACA4sD,UAAW2B,EAAY3B,UACvB4B,eAAgB,GAChBD,eACA,EA+CF,MA7CiB,CAEf,CACE,GAAGlB,GAAuB7V,EAAO,KAAMx3C,CAAQ,EAC/C8Q,IAAK,CAACtK,GAAQ,CAAC,KAAK8D,KAAKktC,CAAK,EAC9B34C,OAAQ,CAAC,CAAC2H,GAGZ,GAAG8nD,EAEH,CACE,GAAGjB,GAAuB7V,EAAO,WAAYx3C,CAAQ,EACrDnB,OAAQ,WAAWyL,KAAKktC,CAAK,EAC7B1mC,IAAK,KAAKxG,KAAKktC,CAAK,EACpBoV,UAAW,YAGb,CACE,GAAGS,GAAuB7V,EAAO,WAAYx3C,CAAQ,EACrDnB,OACE,QAAQyL,KAAKktC,CAAK,GAAK,WAAWltC,KAAKktC,CAAK,GAAK,KAAKltC,KAAKktC,CAAK,EAClE1mC,IAAK,QAAQxG,KAAKktC,CAAK,EACvBhxC,KAAM,OACNomD,UAAW,YAGb,CACEhkD,MACEtC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA62C,SACsBvtC,WAAA,CAAAC,EAAZ5D,EAAA,SAAmB,EAAC,CACvB,EAET+B,GAAI,IAAImvC,CAAK,GACb34C,OAAQ,CAAC,WAAWyL,KAAKktC,CAAK,EAC9B1mC,IAAK,WAAWxG,KAAKktC,CAAK,EAC1BhxC,KAAM,OACNQ,KAAM,eAGR,CACE,GAAGqmD,GAAuB7V,EAAO,WAAYx3C,CAAQ,EACrD4sD,UAAW,WACb,EAIClxC,KAAK,CAACrJ,EAAGsJ,IAAM,CACd,GAAInV,EAAM,CACR,GAAI6L,EAAEu6C,YAAcpmD,EAAM,MAAO,GACjC,GAAImV,EAAEixC,YAAcpmD,EAAM,MAAO,EACnC,CACA,OAAI6L,EAAEvB,KAAO,CAAC6K,EAAE7K,IAAY,GACxB,CAACuB,EAAEvB,KAAO6K,EAAE7K,IAAY,EACrB,CACT,CAAC,EACA+oB,OAAO,CAAC,CAAEh7B,YAAa,CAACA,CAAM,CACnC,EAAG,CAAC24C,EAAOhxC,EAAMxG,CAAQ,CAAC,EAE1B,OACEmG,EAAA,QACEI,IAAKo8C,EACL/7C,MAAM,2BACNqlB,SAAW1uB,GAAM,CAIf,GAHAA,EAAEoJ,iBAEmB,WAAW2D,KAAKqL,SAASpL,IAAI,EAEhD,GAAIitC,EAAO,CACT,MAAM76C,EAAS,CACb4zB,EAAGinB,GAEDhxC,MAAaA,KAAOA,GACxBmnD,EAAgBhxD,CAAM,CACxB,MACEgxD,EAAgB,EAAE,OAGhBnW,EACF7hC,SAASpL,KAAO,aAAay2C,mBAAmBxJ,CAAK,CAAC,GACpDhxC,EAAO,SAASA,CAAI,GAAK,EAAE,GAG7BmP,SAASpL,KAAO,UAIpBoiD,GAAmBnV,EAAOhxC,CAAI,EAE9ByjD,GAAOh+B,WAAW1uB,CAAC,CACrB,EAAE8I,UAEFC,EAAA,SACEC,IAAKynD,EACLptD,MAAO42C,EACP/7B,KAAK,IACLjV,KAAK,SAELk6C,YAAWj+C,EAAE,CAAA/B,GAAA,SAAQ,EACrBwmB,IAAI,OACJunC,aAAa,MACb7L,YAAY,MACZC,eAAe,MACfE,WAAW,QACX57B,aAAa,SACbunC,SAAWnxD,GAAM,CACVA,EAAEoK,OAAO/G,OACZ+sD,EAAgB,EAAE,CAEtB,EACArtC,QAAU/iB,GAAM,CACdwwD,EAASxwD,EAAEoK,OAAO/G,KAAK,EACvBktD,EAAkB,EAAI,CACxB,EACAa,QAASA,IAAM,CACbb,EAAkB,EAAI,EAEtB,MAAMc,EAAYjM,EAAQhkD,SAAS0G,cACjC,sBACF,EACIupD,GACFA,EAAUhuC,UAAUnS,IAAI,OAAO,CAEnC,EACAogD,OAAQA,IAAM,CACZhvD,WAAW,IAAM,CACfiuD,EAAkB,EAAK,CACzB,EAAG,GAAG,EACNnL,EAAQhkD,SACJ0G,cAAc,4BAA4B,GAC1Cub,UAAUjS,OAAO,OAAO,CAC9B,EACAmgD,UAAYvxD,GAAM,CAChB,KAAM,CAAE8G,OAAQ9G,EAChB,OAAQ8G,GACN,IAAK,SACHypD,EAAkB,EAAK,EACvB,MACF,IAAK,OACL,IAAK,YAEH,GADAvwD,EAAEoJ,iBACEknD,EAAgB,CAClB,MAAMkB,EAAYpM,EAAQhkD,QAAQ0G,cAChC,4BACF,EACA,GAAI0pD,EAAW,CACb,IAAIC,EAAWD,EAAUE,mBACzB,KAAOD,GAAYA,EAASnwD,QAC1BmwD,EAAWA,EAASC,mBAElBD,IACFA,EAASpuC,UAAUnS,IAAI,OAAO,EACb2E,MAAMC,KACrB27C,EAASE,cAAc7oD,QACzB,EAAEwzB,OAAQ37B,GAAOA,IAAO8wD,CAAQ,EACvBthD,QAASxP,GAAO,CACvBA,EAAG0iB,UAAUjS,OAAO,OAAO,CAC7B,CAAC,EAEL,KAAO,CACL,MAAMigD,EAAYjM,EAAQhkD,QAAQ0G,cAChC,sBACF,EACIupD,GACFA,EAAUhuC,UAAUnS,IAAI,OAAO,CAEnC,CACF,CACA,MACF,IAAK,KACL,IAAK,UAEH,GADAlR,EAAEoJ,iBACEknD,EAAgB,CAClB,MAAMkB,EAAYtyD,SAAS4I,cACzB,4BACF,EACA,GAAI0pD,EAAW,CACb,IAAII,EAAWJ,EAAUK,uBACzB,KAAOD,GAAYA,EAAStwD,QAC1BswD,EAAWA,EAASC,uBAElBD,IACFA,EAASvuC,UAAUnS,IAAI,OAAO,EACb2E,MAAMC,KACrB87C,EAASD,cAAc7oD,QACzB,EAAEwzB,OAAQ37B,GAAOA,IAAOixD,CAAQ,EACvBzhD,QAASxP,GAAO,CACvBA,EAAG0iB,UAAUjS,OAAO,OAAO,CAC7B,CAAC,EAEL,KAAO,CACL,MAAM0gD,EAAQ5yD,SAASkI,iBACrB,sBACF,EACM2qD,EAAWD,EAAMA,EAAMvuD,OAAS,CAAC,EACnCwuD,GACFA,EAAS1uC,UAAUnS,IAAI,OAAO,CAElC,CACF,CACA,MACF,IAAK,QACH,GAAIo/C,EAAgB,CAClB,MAAMkB,EAAYtyD,SAAS4I,cACzB,4BACF,EACI0pD,IACFxxD,EAAEoJ,iBACFooD,EAAUxwB,SAEZuvB,EAAkB,EAAK,EACvB7D,GAAOh+B,WAAW1uB,CAAC,CACrB,CACA,MAEN,EACD,EACD4I,EAAA,OAAKS,MAAM,iBAAiB/H,OAAQ,CAACgvD,EAAexnD,SAAA,CAEjD,CAACmxC,GAAS4W,EAActtD,OAAS,GAChCqF,EAAA,OAAKS,MAAM,iCAAgCP,UACzCF,EAAA,OAAKS,MAAM,wBAAuBP,SAAA,CAChCC,EAACS,EAAI,CAACC,KAAK,UAAUC,KAAK,IAAK,EAC/BX,EAAAgC,EAAA,CAAA5H,GAAA,SAA6B,CAAC,EAC3B,EACJ0tD,EAActlD,IAAI,CAACylD,EAAapgD,IAAM,CACrC,KAAM,CAAEvF,QAAOP,KAAIrB,QAASqmD,GAC1BkB,EAAY/W,MACZ+W,EAAY3B,UACZ5sD,CACF,EAEA,OACEmG,EAACiU,GAAI,CAEH/R,KACAzB,MAAO,uBAAuBuH,IAAM,EAAI,QAAU,EAAE,GACpD1H,QAAUlJ,GAAM,CACdovD,GACE4B,EAAY/W,MACZ+W,EAAY3B,SACd,EACA3C,GAAOh+B,WAAW1uB,CAAC,CACrB,EAAE8I,SAAA,CAEFC,EAACS,EAAI,CAACC,OAAYJ,MAAM,qBAAsB,EAC9CN,EAAA,QAAAD,SAAOuC,EAAY,CAAC,GAZf,GAAG2lD,EAAY/W,KAAK,IAAI+W,EAAY3B,SAAS,IAAI2B,EAAYvB,SAAS,EAavE,CAEV,CAAC,EACD7mD,EAACiU,GAAI,CACH/R,GAAG,UACHzB,MAAM,6CAA4CP,SAAA,CAElDC,EAACS,EAAI,CAACC,KAAK,QAAQJ,MAAM,qBAAsB,EAC/CN,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAqB,EACjB,CAAC,EACH,CAAC,EACJ,EAIN2tD,EAAsBvlD,IACrB,CAAC,CAAEF,QAAOP,KAAIrB,OAAM4lD,YAAW4B,iBAAgBD,eAAepgD,IAC5DhI,EAACiU,GAAI,CAMH/R,KACAzB,MAAO,uBAAuB4nD,EAAiB,6BAA+B,EAAE,IAAIrgD,IAAM,EAAI,QAAU,EAAE,GAC1G1H,QAAUlJ,GAAM,CACTixD,GACH7B,GAAmBnV,EAAOoV,CAAS,EAErC3C,GAAOh+B,WAAW1uB,CAAC,CACrB,EAAE8I,SAAA,CAEFC,EAACS,EAAI,CAACC,OAAYJ,MAAM,qBAAsB,EAC9CN,EAAA,QAAAD,SAAOuC,EAAY,CAAC,GAdlB4lD,EACI,UAAUD,EAAY/W,KAAK,IAAI+W,EAAY3B,SAAS,IAAI2B,EAAYvB,SAAS,GAC7E,cAAcJ,GAAa,SAAS,IAAIz+C,CAAC,EAa3C,CAEV,CAAC,EACE,CAAC,EACF,CAEV,CAAC,ECrYDohD,GAAenwD,GAAK,SAAuB,CAAEkI,UAAUA,IAAM,CAAC,CAAE,EAAG,CACjE,KAAM,CAACkoD,EAAYC,CAAa,EAAI/vD,EAAS,EAAK,EAC5CgwD,EAAgBjxD,EAAO,IAAI,EAEjCiE,GACE,CAAC,QAAS,GAAG,EACZnF,GAAM,CACLkyD,EAAc,EAAI,EAClB5vD,WAAW,IAAM,CACf6vD,EAAc/wD,SAAS2mB,UACvBoqC,EAAc/wD,SAAS0kB,UACzB,EAAG,CAAC,CACN,EACA,CACEle,OAAQ,GACRwB,eAAgB,GAChBvB,gBAAkB7H,GAAM,CACtB,MAAMoyD,EAAe,WAAWrlD,KAAKqL,SAASpL,IAAI,EAC5C4hD,EAAW,CAAC,CAAC1vD,SAAS4I,cAAc,sBAAsB,EAChE,OACEsqD,GACAxD,GACA5uD,EAAE+H,SACF/H,EAAEgI,SACFhI,EAAEiI,QACFjI,EAAEyH,QAEN,EAEJ,EAEA,MAAM4qD,EAAcA,IAAM,CACxBH,EAAc,EAAK,EACnBnoD,GACF,EAEA5E,GACE,MACCnF,GAAM,CACLmyD,EAAc/wD,SAASwvD,SACvByB,GACF,EACA,CACEtkD,QAASkkD,EACTK,iBAAkB,GAClBlpD,eAAgB,GAChBxB,OAAQ,GACRC,mBAAwB7H,EAAE+H,SAAW/H,EAAEgI,SAAWhI,EAAEiI,QAAUjI,EAAEyH,SAEpE,EAEA,MAAMnG,EAAS,CAAC2wD,EAEhB,OACElpD,EAAA,OACE5F,GAAG,2BACH7B,SACA4H,QAAUlJ,GAAM,CACdwB,WAAaxB,EAAA,eACbqyD,EAAMjoD,CACQ,EAEhB,SAAArB,EAAAknD,GAAA,CAAEnnD,MAGAE,SACA1H,gBACUotB,CACR2jC,CAAY,EACd,EACD,GCvDP,SAASE,IAAY,CACnB,KAAM,CAAExwD,IAAG8Y,KAAG7Y,KACR,CAAES,YAAawB,KACf+B,EAAaC,GAAYtD,CAAM,EAC/B,CAAEghD,YAAWh9C,YAAaX,EAEhC,GAAI,CAAC29C,EAAUpgD,OACb,OAAO,KAET,MAAMivD,EACJ7rD,EAASC,oBAAsB,gBAC9B,CAACD,EAASC,mBAAqBD,EAAS8rD,qBAErChsD,EAAUvF,IACVwxD,EAAYxxD,IAEZyxD,EAAWzxD,EAAO,EAAK,EACvB0xD,EAAqBjP,EACxBp4C,IAAI,CAACsnD,EAAKjiD,IAAM,CACf,KAAM,CAAE3H,OAAM,GAAGiN,GAAS28C,EAC1B,GAAI,CAACxP,GAAep6C,CAAI,EAAG,OAAO,KAClC,GAAI,CAAE9F,KAAImgD,OAAMl3C,QAAOo3C,WAAU/5C,QAAS45C,GAAep6C,CAAI,EAE7D,OAAI,OAAO9F,GAAO,aAChBA,EAAKA,EAAG+S,EAAMtF,CAAC,GAEb,OAAO0yC,GAAS,aAClBA,EAAOA,EACL,CACE,GAAGptC,EACHzT,SAAUyT,EAAKzT,UAAYA,GAE7BmO,CACF,GAEE,OAAOxE,GAAU,WACnBA,EAAQA,EAAM8J,EAAMtF,CAAC,EACZxE,GAAOjJ,KAEhBiJ,EAAQyO,EAAEzO,CAAK,GAEb,OAAOo3C,GAAa,WACtBA,EAAWA,EAASttC,EAAMtF,CAAC,EAClB4yC,GAAUrgD,KAEnBqgD,EAAW3oC,EAAE2oC,CAAQ,GAEnB,OAAO/5C,GAAS,aAClBA,EAAOA,EAAKyM,EAAMtF,CAAC,GAGjBzN,IAAO,UACTwvD,EAASvxD,QAAU,IAGd,CACL+B,KACAmgD,OACAl3C,QACAo3C,WACA/5C,OAEJ,CAAC,EACA6yB,OAAOoD,OAAO,EAGjBv+B,EAAU,IAAM,CACd,GACE6E,EAAWW,SAASC,oBAAsB,gBAC1C8rD,EAAUtxD,QACV,CACA,MAAM0xD,EAAYxwD,WAAW,IAAM,CACjC,MAAMywD,EAAYL,EAAUtxD,SAAS0G,cAAc,YAAY,EAC3DirD,GACFA,EAAU5rB,eAAe,CACvB3a,SAAU,SACVC,MAAO,UACPumC,OAAQ,SACT,CAEL,EAAG,GAAG,EAEN,MAAO,IAAM3wD,aAAaywD,CAAS,CACrC,CACF,EAAG,EAAE,EAEL,MAAM/L,EAAWC,KACjB7hD,GACE,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAG,EAC3CnF,GAAM,CACL,MAAMspB,EAAQxF,SAAS9jB,EAAE8G,IAAK,EAAE,EAAI,EACpC,GAAIwiB,EAAQspC,EAAmBrvD,OAAQ,CACrC,KAAM,CAAE+/C,QAASsP,EAAmBtpC,CAAK,EACrCg6B,IACFyD,EAASzD,CAAI,EACb78C,EAAQrF,SAASuJ,cAErB,CACF,EACA,CACEoD,QAAS,CAACykD,EACV5qD,OAAQ,GACRC,mBAAwB7H,EAAE+H,SAAW/H,EAAEgI,SAAWhI,EAAEiI,QAAUjI,EAAEyH,SAEpE,EAEA,KAAM,CAAC2lB,EAAO0B,CAAQ,EAAI3sB,EAAS,EAAE,EAErC,OAAIqwD,EACK,KAIPzpD,EAAA,OAAK5F,GAAG,YAAW2F,SAChB9C,EAAWW,SAASC,oBAAsB,eACzCmC,EAAA,OACEC,IAAK0pD,EACLrpD,MAAM,UACNF,cAAgBnJ,GAAM,CACpBA,EAAEoJ,iBACFzG,EAAOslD,sBAAwB,EACjC,EAAEn/C,SAEFC,EAAA,MAAAD,SACG8pD,EAAmBrnD,IAClB,CAAC,CAAEpI,KAAImgD,OAAMl3C,QAAOo3C,WAAU/5C,QAAQmH,IAElC7H,EAAA,MAAAD,SACEF,EAACiU,GAAI,CACHxT,MAAOm6C,EAAW,eAAiB,GACnC14C,GAAIw4C,EACJp6C,QAAUlJ,GAAM,CACd,GAAIA,EAAEoK,OAAOiZ,UAAUkmB,SAAS,WAAW,EAAG,CAC5CvpC,EAAEoJ,iBACF,MAAMmf,EAAOrpB,SAAS2oB,eAAe,GAAG1kB,CAAE,OAAO,EACjD3B,KAAQma,CACR4M,EAAIA,UAAM,EACRA,MAAK0qC,EAAY1qC,EAAA,iCACjB2qC,GAEAA,EAAIA,MAAe,CACG,CACtB,CACF,EAEJ,UAAAnqD,EAAAS,EAAA,CAAEV,OAEIW,YAAYC,EAAK,QAAM,SAC7B,CAAAX,EAAAq5C,GAAA,CAAAt5C,SACEC,CAAU,GAAAD,GAAEsD,KAAiB,SAC5Bo3C,GACC56C,KAAAC,MAAA,SAAAC,SACEC,CACA,EAAAD,CAAQ06C,EAAQ,CAAS,GAE5B,EACI,EACH,GAAA5yC,CAAA,IAAAzN,CAAA,IAAAiJ,CAAA,IAAAo3C,CAAA,IAAAF,CAAA,IACJ,EAGV,GACEv6C,EAAAiT,GAAA,CACD,YAEJA,EACCm3C,gBACAp/B,WAAS,QACTq/B,cAAW,4BACXvpB,MACA5/B,SAAK,SACL4pB,aAAS7zB,GAAA,SACMA,EAAM,SACnBstB,GAAMxB,OAAQ6mC,CAASvxD,CACG,EAE5B,WAAA2H,EAAA,UACAkT,cAEIhT,sBACA9F,MAAG,QACHkG,cAAMrJ,GAAA,kBACUA,EACdA,EAAEoJ,sBAAe,EACjBzG,EACF,kBAAA3C,GAAA,KAGE,KAAI,CACF,OAAAoK,CAAM,EAAEA,EAAWpK,4CACnByG,EAAI4sD,qBAAuB,CACI,MAC/B,CACF,CAAY,EACd,SAAAtqD,EAAAS,EAAA,CAAEV,gBAEIW,KAAK,KAAWC,MAAaxE,CAAE,aAAW,EAAC,GAAI,SAC/C0tD,EAAA,MACT9pD,KAE0B3F,OAAImgD,QAAMl3C,WAAOo3C,QAAU/5C,IAAQmH,IAAM,UACvD3F,GAAS,CAClB,cACGA,aACC4+B,gBACA9V,OACA9pB,MAAKrB,EAAAC,EAAA,CACLwC,UACExC,IAAA,CAAAC,OACQW,WAAYC,EAAK,QAAK,MAC5B,YAAML,SAAMN,EAAAq5C,GAAA,CAAWt5C,UACX,EAAEsD,GAAiBrD,EAAAS,EAAA,CACzB,KACNT,eAAK,EAACU,CAAK,GAAkB,SAC7B,CAAAV,EAAA8B,GAAA,CACH/B,QAESgC,SAAG/B,EAAA,QAAID,WACfiC,EAAA,CAAAjC,WACE,IAAuB,GACnBC,EAAAiC,GAAA,IAAAoiB,GAAA,IAAApqB,GAAA+F,EAAA8B,GAAA,CACE,GACV9B,MAACiC,OAEyBF,SAAU9H,EAAKG,OAAE,CAAG2F,YAC1C,MAAA9F,EAAA,WAAA4F,EAAAC,EAAA,UACG7F,OACAA,OACC,EAAA8F,CAEwB,EAEzB,EACG9F,EAAA,QAKhB4F,EAAAiC,GAAA,CAEA,GAAAy4C,EAEIx4C,MAAIw4C,kBAEJj6C,SAAM,CAAAN,EAAAS,EAAA,CAAiBV,OAEjBW,WAAYC,IAAKd,EAAA,QAAK,MAC5BA,YAAMS,SAAM,CAAAN,EAAA,QAAWD,SACrBC,EAAAq5C,GAAA,CAAAt5C,UACY,EAAEsD,GAAiBo3C,GAAA56C,EAAAC,EAAA,CACzB,SACL26C,KACC56C,EAAAC,SAAAC,2BAESO,SAAMm6C,CAAA,EAAoB16C,CAAE06C,EAAQ,CAAS,GAEvDz6C,EAAA,QACG,MACN,yCAAMM,SAAMuH,EAAA,GAAwC9H,CAC7C,EACD,GAAC8H,CAAA,IAAAzN,CAAA,IAAAiJ,CAAA,IAAAo3C,CAAA,IAAAF,CAAA,IACC,EAEb,EACI,CAIf,MAAAgQ,GAAAzxD,GAAA0wD,EAAA,EC3RO,SAASgB,GAAYnwD,EAAQ,CAClC,IAAIowD,EAAY,GACZC,EAAa,GACbC,EAAe,EACnB,QAAS9iD,EAAI,EAAGA,EAAIxN,EAAOG,OAAQqN,IAAK,CACtC,MAAM2+C,EAAOnsD,EAAOwN,CAAC,EACjB2+C,EAAKzoC,QAAU,CAACyoC,EAAKr0C,SAASwb,OAChC+8B,EAAW10C,KAAKwwC,CAAI,EACpBmE,MAEAF,EAAUz0C,KAAKwwC,CAAI,EACfmE,EAAe,IACjBA,EAAe,GAGrB,CAGA,GACEtwD,EAAOG,OAAS,KACfkwD,EAAWlwD,OAASH,EAAOG,OAAS,GAAKmwD,GAAgB,GAC1D,CAEA,MAAMC,EAAeF,EAAWloD,IAAKgM,GAAWA,EAAOpU,EAAE,EACzD,GAAIswD,EAAWlwD,OAAUH,EAAOG,OAAS,EAAK,EAE5CiwD,EAAY,CACV,GAAGA,EACH,CAAErwD,GAAIwwD,EAAc7B,MAAO2B,EAAYxqD,KAAM,QAAS,CAAC,MAEpD,CAEL,MAAM2qD,EAAOloC,KAAKmoC,MAAML,EAAUjwD,OAAS,CAAC,EAC5CiwD,EAAY,CACV,GAAGA,EAAUj+C,MAAM,EAAGq+C,CAAI,EAC1B,CACEzwD,GAAIwwD,EACJ7B,MAAO2B,EACPxqD,KAAM,UAER,GAAGuqD,EAAUj+C,MAAMq+C,CAAI,CAAC,CAE5B,CACA,OAAOJ,CACT,KACE,QAAOpwD,CAEX,CAEO,SAAS0wD,GAAahC,EAAOrvD,EAAU,CAC5C,MAAMsxD,EAAmBr3C,GAAMxB,QAAQ0B,IAAI,kBAAkB,GAAK,GAC5Do3C,EAAgBlC,EAAMx1B,OAAQizB,GAAS,CAC3C,GAAI,CAACA,EAAKzoC,OAAQ,MAAO,GACzB,MAAMqmC,EAAY,GAAG1qD,CAAQ,IAAI8sD,EAAKzoC,OAAO3jB,EAAE,GACzC8wD,EAAYF,EAAiB5G,CAAS,EAC5C,OAAI8G,GAAaA,IAAc1E,EAAKpsD,GAC3B,IAMR4wD,EAAM5G,CAAA,EAAAoC,EAAA,GAEP,GACA,GAEFpiD,EAAA,YAAA4mD,CAAA,EACA,OAAA5mD,SAAawU,IACbxU,EAAIA,MAAK5J,EAAM4J,EAAK,OAAE,YAAArG,GAAA,CACpBqG,OAAKoI,EAAoBzO,KAG3B4V,GAAA,+BAAAq3C,CAAA,GAEA,CACF,SAAAG,GAAApC,EAAArvD,EAAA,CAEA,QAAgByxD,GACd,IAAAC,EAAmB,EACnBrC,EAAIqC,WAAgB,CACpBrC,QAAM3hD,EAASo/C,EAAI3+C,EAAKwjD,EAAA,OAAAxjD,IAAA,CACtB,GAAKwjD,EAASxjD,CAAEA,EAAC,KAAGwjD,GAAQryD,EAACwB,KAAQqN,EAAK,WACxC,GAAIwjD,EAASxjD,CAAC,EAAEkN,KAAM/b,GAAMA,EAAEoB,KAAOosD,EAAKpsD,WAAK,GAAAixD,EAAAxjD,CAAA,OAAA7O,KAAA,cAAAwtD,EAAA,KAC/C6E,EACEA,CAAQ,EAAE,KAAEt2C,CAAO,EAGnBs2C,MACA,CACF,CACF,MAAAC,EAAAvC,EAAA,KAAAlhD,KAAA,KAAA2+C,EAAA,aACA8E,IACAD,KAAiB,GAAA7E,EAAA8E,CAAA,EAEjB,GAIF,QAAAzjD,EAAA,EAAAA,EAAAwjD,EAAA,OAAAxjD,IACA,QAAU0tB,EAAI1tB,EAAG,EAAGwjD,IAAe,OAAO91B,IACnB81B,KAAY7wD,UAAa+6B,CAAA,WAAAv8B,CAAA,KAE5CqyD,KAAgB,IAAAA,EAAAxjD,CAAA,KAAAwjD,EAAA91B,CAAA,GAEd81B,EAAAxjD,CAAA,EAAAwjD,EAAAxjD,CAAA,UAAA2+C,EAAAjmC,EAAAgrC,MAAA,UAAAvyD,KAAA,KAAAwtD,EAAA,MAAAjmC,CAAA,EACA8qC,EAASxjD,YAITwjD,KAMNA,EAAA,QAAAt1D,GAAA,CACAs1D,EAASjkD,MAAO2E,EAAEhW,IAChBA,CAAOgW,EAACqJ,aAAe,CAAAC,EAAA,YACdm2C,aAAe,SAAGA,OAAa,MAAAn2C,EAAA,WAEtCtJ,EAAA,cAAAsJ,EAAA,KACItJ,EAAEy/C,cAAgBn2C,EAAEjb,IACpBib,CAACtJ,EAACy/C,YAAoB,GACrBz/C,EAAEy/C,YACAA,WAAWz/C,EAAE,SAAQ,aAAAsJ,EAAA,WADD,CAE3B,CACF,GAGFg2C,EAAA,QAAAt1D,GAAA,CACAs1D,MAAQI,EAAsB11D,EAAA,cAC5BA,EAAM01D,WAAkB,CACxB11D,EAAQqR,QAASo/C,KAASiF,IACxBjF,sBAEA,EACF,GACA6E,EAAA,OAIF,MAAMK,EAAW,GACXC,EAAwB,GACxBC,EAAe,GACrB7C,SAAM3hD,QAASo/C,GAAS,CACtB,GAAIA,EAAKzoC,OAAQ,CACf2tC,EAAS11C,KAAKwwC,CAAI,EAClB,MACF,CACA,QAAS3+C,EAAI,EAAGA,EAAIwjD,EAAS7wD,OAAQqN,IACnC,GAAIwjD,EAASxjD,CAAC,EAAEkN,KAAM/b,GAAMA,EAAEoB,KAAOosD,EAAKpsD,EAAE,EAAG,CAC7C,GAAIuxD,EAAsBh9C,SAAS9G,CAAC,EAAG,OACvC,MAAMgkD,EAAeR,EAASxjD,CAAC,EAC/BgkD,EAAaz2C,KAAK,CAACrJ,EAAGsJ,IACb3S,KAAKlE,MAAMuN,EAAEpJ,SAAS,EAAID,KAAKlE,MAAM6W,EAAE1S,SAAS,CACxD,EACD,MAAM8oD,EAAqBI,EAAa,CAAC,EAAE15C,QAAQ/X,GACnDsxD,EAAS11C,KAAK,CACZ5b,GAAIyxD,EAAarpD,IAAKqF,GAAMA,EAAEzN,EAAE,EAChC2uD,MAAO8C,EACP3rD,KAAM2rD,EAAaj1B,MAAOk1B,GAAOA,EAAG35C,QAAQ/X,KAAOqxD,CAAkB,EACjE,SACA,cACN,CAAC,EACDE,EAAsB31C,KAAKnO,CAAC,EAC5B,MACF,CAIF,GAAI2+C,EAAKgF,aAAehF,EAAKhD,qBAAuBgD,EAAKr0C,QAAQ/X,GAAI,CACnE,MAAM2xD,EAAO3H,GAAUoC,EAAKpsD,GAAIV,CAAQ,EACnCE,EAAOoyD,YAAYD,CAAI,GAE1BH,EAAa51C,KAAK,CAChB+1C,OACAP,YAAahF,EAAKgF,WACpB,CAAC,CAsBL,CAEAE,EAAS11C,KAAKwwC,CAAI,CACpB,CAAC,EAGGoF,GAAcpxD,QAChByxD,eAAe,IAAM,CACnB,KAAM,CAAExyD,SAAUyB,GAAI,CAAExB,UAAS,CAAC,EAGlC,eAAAwyD,GAAA,CACA,QAAArkD,EAAeqkD,MAAgB,OAAArkD,IAAA,CAC7B,KAAK,CACH,KAAAkkD,EAAQA,aAAMP,OAAY,GAAII,CAC9B,MAAIhsD,EAAA,MAAAusD,GAAAX,EAAA/xD,CAAA,EACF2yD,GAAMxsD,EAAgBlG,EAAMyyD,CAC5BC,cAAWxsD,EACTpE,GACF5B,EAAE,YAAAmyD,CAAA,GACFnyD,GAAMgG,EAAamsD,GACjB3xD,UACAV,EAEF,kBAAAwwB,GAAA,WAAAA,EAAA,WACUqvB,GAEV,CACA9gD,MAAO,mCAAS,GAGtB,MAAA4zD,EAAAT,EAAA,MAEIpoC,aACF,IAAAgoC,CAAA,GACA,UACA,GAAMa,CAA0Bb,kCAAkBA,IAClD,CAAC,EACC,GAAIc,GAAA,OACF,UAAMA,KAAwB7yD,EAAiB,CAAU2yD,GAAEC,KAAM,iBAC7DC,EACF,MAAKP,EAAMnsD,EAAiB0sD,OAC1BF,aACE5wD,QAAeoE,EAAA,UACfmsD,IACFnyD,cAAagyD,CAAY,EAAC72C,CACrBy2C,QAAa,SAAA9xD,CAElB,UAIG,CAEL,OACFwyD,EAAO,CACLA,CACF,UAEAA,EAAA,CAEAA,GAEHR,CACH,CACEQ,YAAe,CAAApuB,EAAArkC,IACjBA,EAAA,oBAAAqkC,CAAA,SACF,EACF,eAAAyuB,GAAAxD,EAAArvD,EAAA,CAEA,MAAAo/C,EAAe,MAAAG,KACjB,IAAAH,EAAA,cAEA,KAAMqT,CACJ,mBAAAK,CACF,EAAE5yD,IAEoB2yD,MACpBxD,EAAMjQ,WAAe,CACrB,GAAKA,SAAat+C,OAClB,KAAM,CAAEgyD,KAAuB5yD,UAC/BnB,OAAW,IACLg0D,EACArlD,EAASo/C,GAASpsD,EAAAV,CAAA,EACtB,GAAI8sD,EAAauF,CAAA,iBACjB,MAAMW,EAAAvT,GAAA5Y,CAAA,KAAI,CAAAmsB,EAAA,SAAA3T,EAAA,oBAAExY,EAAOuY,EAAA,QAAAx3B,EAAAk7B,MAAMkQ,EAAG,KAAA1zD,KAAA,gBAAAwjD,EAAA,qBAAAzD,EAAA,KAAA//C,KAAA,qBAAAwjD,EAAA,sBAAOgK,EAAI,KAAAhK,EAAA,SAGvC,IACImQ,EAAenyD,QAEjBiyD,EACsBzzD,KAAMA,CAG1BsoB,OACF,KAAAyqC,EACA,aAAUY,EACT,CAED,GACAF,EAAuBz2C,OAAK,OAC1BwwC,EAAIiG,EAAA,IAAA3pB,KAAA,cACJipB,EAAI,MAAApoC,GAAAjnB,CAAA,EACJo8C,MAAc6T,OAChBF,EAAE,QAAA3pB,GAAA,CACJ,MACA,KAAA0jB,EAEEiG,OACF,aAAA3T,CACA,EAAMl1B,MACc4iC,EAAA,YAEpBiG,kBACED,EAAMT,CAAA,EAAAjT,IAAcA,CAAa,CACjC,SAAUl1B,IAAmBzR,CAC7BvY,EAAA,mBAAuB,EACrB4yD,CCpUO,SAASI,GAAU,CAChCC,gBACAC,oBAAoB,EACpBC,kBAAkB,EAClBC,uBAAuB,GACvBC,qBAAqB,GACrBhsD,YAAY,WACZisD,oBAAqBC,EACrBC,kBAAmBC,CACrB,EAAI,GAAI,CACN,KAAM,CAACC,EAAiBC,CAAkB,EAAIn0D,EAAS,IAAI,EACrD,CAACo0D,EAAYC,CAAa,EAAIr0D,EAAS,EAAK,EAC5C,CAACs0D,EAAUC,CAAW,EAAIv0D,EAAS,EAAK,EACxC,CAACw0D,EAAgBC,CAAiB,EAAIz0D,EAAS,EAAK,EACpD,CAAC00D,EAAcC,CAAe,EAAI30D,EAAS,EAAK,EAChD40D,EAAa/sD,IAAc,WAEjCk9B,UAAgB,IAAM,CACpB,MAAM8vB,EAAoBpB,EAAcx0D,QACxC,GAAI,CAAC41D,EAAmB,MAAO,GAC/B,IAAIC,EAAsBF,EACtBC,EAAkB/D,UAClB+D,EAAkB3vB,WAEtB,SAAS6vB,GAAW,CAClB,KAAM,CACJjE,YACA5rB,aACA8vB,eACAC,cACAC,eACA/vB,aACF,EAAI0vB,EACEM,EAAcP,EAAa9D,EAAY5rB,EACvCkwB,EAAkBR,EAAaI,EAAeC,EAC9CI,GAAkBT,EAAaM,EAAe/vB,EAC9CmwB,EAAiB/rC,KAAKqc,IAAIuvB,EAAcL,CAAmB,EAC3DhB,EACJC,GACAxqC,KAAK/H,IACH6zC,GAAkB3B,EAClB0B,EACAD,CACF,EACInB,EACJC,GACA1qC,KAAK/H,IACH6zC,GAAkB1B,EAClByB,EACAA,EAAkBD,EAAcE,EAClC,EAGAC,IACCR,EAAsBK,EACnBtB,EACAD,KAEJO,EAAmBW,EAAsBK,EAAc,MAAQ,OAAO,EACtEL,EAAsBK,GAGxBd,EAAcc,GAAe,CAAC,EAC9BZ,EAAYY,EAAcE,IAAmBD,CAAe,EAC5DX,EAAkBU,GAAerB,CAAmB,EACpDa,EACEQ,EAAcE,IAAmBD,EAAkBpB,CACrD,CACF,CAEAa,SAAkBv1D,iBAAiB,SAAUy1D,EAAU,CAAElvB,QAAS,EAAK,CAAC,EAEjE,IAAMgvB,EAAkBnvB,oBAAoB,SAAUqvB,CAAQ,CACvE,EAAG,CACDrB,EACAC,EACAC,EACAC,CAAkB,CACnB,EAEM,CACLK,kBACAE,aACAE,WACAE,iBACAE,eACAa,KAAMA,IAAM,CACN9B,EAAcx0D,SAChBw0D,EAAcx0D,QAAQ4sD,cAAc,IAAI2J,MAAM,QAAQ,CAAC,CAE3D,EAEJ,CC3Fe,SAASC,GACtB,CACEhC,gBACAC,oBAAoB,EACpBC,kBAAkB,EAClBC,uBAAuB,GACvBC,qBAAqB,GACrBhsD,YAAY,WACZisD,oBAAqBC,EACrBC,kBAAmBC,EACnBsB,MACF,EAAI,GACJpnD,EACA,CACA,GAAI,CAACA,EAAU,OACf,MAAMymD,EAAa/sD,IAAc,WAC3BitD,EAAsB/1D,EAAO,IAAI,EACjCm1D,EAAkBn1D,EAAO,IAAI,EAE7Bg2D,EAAWW,GACf,IAAM,CACJ,IAAItB,EAAa,GACbE,EAAW,GACXE,EAAiB,GACjBE,EAAe,GAEnB,MAAMG,EAAoBpB,EAAcx0D,QAClC,CACJ6xD,YACA5rB,aACA8vB,eACAC,cACAC,eACA/vB,aACF,EAAI0vB,EACEM,EAAcP,EAAa9D,EAAY5rB,EACvCkwB,EAAkBR,EAAaI,EAAeC,EAC9CI,EAAkBT,EAAaM,EAAe/vB,EAC9CwwB,EAAcR,EAAcL,EAAoB71D,QAChD22D,EAAqBD,EAAc,EACnC1vD,GAAY2vD,EACd/B,EACAD,EACEE,EACJC,GACAxqC,KAAK/H,IACH6zC,EAAkB3B,EAClB0B,EACAD,CACF,EACInB,EACJC,GACA1qC,KAAK/H,IACH6zC,EAAkB1B,EAClByB,EACAA,EAAkBD,EAAcE,CAClC,EAEE9rC,KAAKqc,IAAI+vB,CAAW,GAAK1vD,KAC3BiuD,EAAgBj1D,QAAU22D,EAAqB,MAAQ,QACvDd,EAAoB71D,QAAUk2D,GAGhCf,EAAae,GAAe,EAC5Bb,EAAWa,EAAcE,GAAmBD,EAC5CZ,EAAiBW,GAAerB,EAChCY,EACES,EAAcE,GAAmBD,EAAkBpB,EAErD7lD,EAAS,CACP+lD,gBAAiBA,EAAgBj1D,QACjCm1D,aACAE,WACAE,iBACAE,cACF,CAAC,CACH,EACA,IACA,CACEmB,QAAS,EACX,CACF,EAEA9wB,UAAgB,IAAM,CACpB,MAAM8vB,EAAoBpB,EAAcx0D,QACxC,OAAI41D,IACFC,EAAoB71D,QAClB41D,EAAkBD,EAAa,YAAc,YAAY,EAC3DC,EAAkBv1D,iBAAiB,SAAUy1D,EAAU,CAAElvB,QAAS,EAAK,CAAC,GAEnE,IAAM,CACPgvB,GACFA,EAAkBnvB,oBAAoB,SAAUqvB,CAAQ,CAE5D,CACF,EAAG,EAAE,EAEL/1D,EAAU,IAAM,CACVu2D,GAAQ9B,EAAcx0D,SACxB4zD,eAAe,IAAM,CACnBY,EAAcx0D,QAAQ4sD,cAAc,IAAI2J,MAAM,QAAQ,CAAC,CACzD,CAAC,CAEL,EAAG,CAACD,CAAI,CAAC,EAEF,CACLO,qBAAsBA,IAAM,CAC1B5B,EAAgBj1D,QAAU,IAC5B,EAEJ,CCjGA,SAAS82D,GAAU,CACjB7uD,MAAOiC,EACPu7B,WACAtvB,SACA9U,WACAyN,SAEAioD,cACF,EAAG,CACD,KAAM,CAAEp2D,KAAGC,KACX,IAAI8yD,EAAO3H,GAAUtmB,EAAUpkC,CAAQ,EACvC,MAAMuD,EAAaC,GAAYtD,CAAM,EAKrC,GAJK4U,IACHA,EAASvR,EAAWL,SAASmvD,CAAI,GAAK9uD,EAAWL,SAASkhC,CAAQ,EAClEiuB,EAAO3H,GAAU51C,GAAQpU,GAAIV,CAAQ,GAEnC,CAAC8U,EACH,OAAO,KAGT,KAAM,CACJ2D,QAAS,CACP0N,OACA4B,SACA/O,eACAtY,GAAIy7C,EACJpjC,IAAKqgB,EACLtR,cACA1B,WACA4N,OAAQ2hC,EACR5hC,MACAE,SAEFvzB,KACAk1D,eACAC,YACA7L,eACA8L,aACAC,kBACAC,aACApoD,OACA4rC,QACAgP,YACAluB,cACA27B,cACAC,WACAC,WACAxL,WACAyL,OACAntD,YACA6oD,cACAhI,qBACAjjB,UACA0Z,YACAx3B,oBACA1E,SACAgyC,OACAt9C,OACAib,UAEAsiC,YACAC,YAEEzhD,EAEJ,GAAI,CAACiU,IAAkBjoB,OACrB,OAAO,KAGT,MAAM01D,GAAcj5D,IAAM,CACpBA,GAAEyH,QACJjG,EACEmZ,GAAGpD,OACJhP,GAAA,EACH,IACFgqB,GAAAlV,GAAA,IAEM1C,SAA+BikC,EACnC,CAAAA,EAAOr2C,EAAoB,GACxB2wD,GAAAC,GAAAC,EAAA,EACC7mC,QAAuBg7B,GAAAH,EAAA8L,EAAA,EAC3B,GAAA5L,aAAyB3yC,OAC3B,OAAIikC,KAGJ,MAAM0O,GAAarC,EAInBoO,IAFI/L,GAAuB,EAClB,qDACT,WAEA9rD,GAAc0O,GAAA,MAEd,OAAMopD,GAAarO,cACnB,SAAcvoC,QAAewlB,GAAA,KACvBqxB,MACE,UACR,aAEA,qBAAyBzE,EAEzB,aAAOtpC,GACL,oBAAoBspC,IAAgB7J,EAAA/lD,EAEpC,CAEI,WAAoB4vD,CACNmE,EAEd,QAC2B/zD,4BAAG,CAAiB,YAAIsC,QAEnD,eAAAgyD,CAEoBt0D,GACZ,CAA4B,YAA5B,EAA8BA;AAAAA;AAAAA,YAC9B/B,GAAA;AAAA,YAAUm2D,GAAA;AAAA,YACZ9xD;AAAAA,UAEC,SAAAuB,EAAA0wD,GAAA,OAEHnM,EAA4B,MAAAplB,GACG,KAC/BmxB,EAAoC,OAAA52D,CAAA,MAAAU,CAAA,eAAAyN,GAAA,IACtC9H,UAEI9I,IAAAm4D,EAAAn4D,GAAA4Q,GAAAs3B,GAAA3wB,CAAA,UACGjM,IACP48B,GACMywB,CACsC,MAAAe,GAC5CxwD,OC5HV,SAASywD,GAAQjN,EAAO,CACtB,KAAM,CAAE3qD,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAC/B,CAAEH,QAAOC,WAAUkgB,iBAAkB1e,KAErC,CAAC0W,EAAgBC,CAAkB,EAAIyC,GAAQ,IAAM,CACzD,MAAM5X,EAAWiV,KAIjB,MAAO,CAFLjV,EAASqY,KAAM5C,GAAYA,EAAQvW,KAAKxB,KAAOoF,IAAqB,GACpE9C,EAAS,CAAC,EACCA,EAASlC,OAAS,CAAC,CAClC,EAAG,EAAE,EAMCq2D,GACH5zD,EAAWW,SAASC,oBAAsB,gBACxC,CAACZ,EAAWW,SAASC,mBACpBZ,EAAWW,SAAS8rD,uBACxB,CAACzsD,EAAW29C,UAAU7lC,KAAM+0C,GAAQA,EAAI5pD,OAAS,WAAW,EAExDf,EAAgBC,GACpB,IAAM,CACJxF,EAAO68B,aAAe,EACxB,EACA,CACEp3B,UAAW,IACXyxD,OAAQ,QACRC,iBAAkB,GAEtB,EAEMtzD,EAAYtF,IACZ,CAAC64D,EAAWC,CAAY,EAAI73D,EAASqF,MAAS,EAE9C8C,EAAqBC,GAAuB,CAChD,EACA,EACAvE,EAAWW,SAASC,oBAAsB,eAAiB,GAAK,EAChE,CAAC,CACF,EAEKqzD,EAAgB/4D,IACtB,eAAeg5D,EAAW3iC,EAAW,CACnC,OAAIA,GAAa,CAAC0iC,EAAc74D,WAC9B64D,EAAc74D,QAAUoB,EAAMM,GAAGq3D,MAC9Bn3D,KAAK,CACJC,MAAO,GACR,EACAG,UAEW,MAAM62D,EAAc74D,QAAQkC,MAE9C,CAEA,MAAM82D,EAAiBl5D,IACvB,eAAem5D,EAAY9iC,EAAW,CACpC,OAAIA,GAAa,CAAC6iC,EAAeh5D,WAC/Bg5D,EAAeh5D,QAAUoB,EAAMM,GAAGkoC,OAC/BhoC,KAAK,CACJC,MAAO,GACR,EACAG,UAEW,MAAMg3D,EAAeh5D,QAAQkC,MAE/C,CAEA,MAAMg3D,EAAgBp5D,IACtB,OACE0H,EAAAC,EAAA,CAAAC,UACEF,EAAA,UACEI,IAAKxC,EACLyC,KAAK,SACLI,MAAO,gCACLuR,EAAqB,cAAgB,EAAE,IACrCm/C,IAAc,OAAS,SAAW,EAAE,GACxCtvD,MAAO,CAAEopB,SAAU,YACnB3qB,QAASA,IAAM,CACboxD,EAAcl5D,QAAUqK,KAAK1G,MAC7Bi1D,EAAcnwD,GAAYA,EAAiBrC,OAAT,MAAmB,CACvD,EACA2B,cAAgBnJ,GAAM,CACpBA,EAAEoJ,iBACFzG,EAAO68B,aAAe,EACxB,EAAE,GACEt3B,IAAeY,SAAA,CAElB8R,GACC7R,EAACwS,GAAM,CACLC,IACEb,GAAgBhW,MAAM6lB,QAAU7P,GAAgBhW,MAAM8W,aAExD/R,KAAK,IACL6wD,SAAU5/C,GAAgBhW,MAAM6xB,IACjC,EAEHztB,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAMkR,EAAqB,IAAM,IAAKjR,IAAGzE,EAAE,CAAA/B,GAAA,SAAM,CAAC,CAAG,CAAC,EAClE,EACRyF,EAACgB,GAAc,CACbigC,cAAc,WACdhgC,MAAOkwD,EACPjwD,UAAWtD,EACXuD,QAASA,IAAM,CACbiwD,EAAaxyD,MAAS,CACxB,EACAgD,eAAgB,CACdC,MAAO,CACLC,OAAQ,IAEVxB,QAASA,IAAM,CACTuC,KAAK1G,MAAQu1D,EAAcl5D,QAAU,GAI3C,GAEF+I,OAAQ,CACNC,OAAQlL,SAASmL,MACjB,GACEqiD,EACJ34B,SAAS,OACTq/B,WAAW,QACXv/B,SAAS,SACT3oB,MAAM,SACNZ,qBACAJ,eAAc,GAAApB,UAEb,CAAC,CAAC9C,EAAWhB,YAAYw1D,YACJx0D,EAAWhB,WAAWw1D,aAA1CC,WACE7xD,EAAA,OAAKS,MAAM,WAAUP,SAAA,CACnBF,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACDurB,QAAOvvB,EAAC,CAAA/B,GAAA,SAA4B,CAAC,IAE9C,SAAY,CACX,GAAI,CACFiV,SAAS0C,QACX,MAAY,CAAC,CACf,IAEJ,EAAEhS,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,WAAWJ,MAAM,eAAeK,KAAK,IAAK,EAAE,IACvDX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAmC,EAC/B,CAAC,EACC,EACV4F,EAACiC,KAAa,CAAC,EACZ,EAETpC,EAAA,WAAAE,SAAA,CACEF,EAACiC,GAAQ,CAACC,GAAG,IAAGhC,SAAA,CACdC,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAK,IAAK,EAAE,IAC9BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAkB,EACd,CAAC,EACC,EACTwf,EACC/Z,EAAAC,EAAA,CAAAC,SAAA,CACG8wD,GACChxD,EAACiC,GAAQ,CAACC,GAAG,aAAYhC,SAAA,CACvBC,EAACS,EAAI,CAACC,KAAK,YAAYC,KAAK,IAAK,EAAE,IACnCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAU5H,GAAA,kBAAkC,EACxC,CAAC,EACC,EAEZyF,EAACiC,GAAQ,CAACC,GAAG,WAAUhC,SAAA,CACrBC,EAACS,EAAI,CAACC,KAAK,WAAWC,KAAK,IAAK,EAChCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAsB,EAClB,CAAC,EACC,EACTopB,GAAS,oBAAoB,GAC5B3jB,EAACiC,GAAQ,CAACC,GAAG,YAAWhC,SAAA,CACtBC,EAACS,EAAI,CAACC,KAAK,KAAKC,KAAK,IAAK,EAAE,IAC5BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAsB,EAClB,CAAC,EACC,EAEZyF,EAACiC,GAAQ,CAACC,GAAG,iBAAgBhC,SAAA,CAC3BC,EAACS,EAAI,CAACC,KAAK,eAAeC,KAAK,IAAK,EAAE,IACtCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA2B,EACvB,EACL6C,EAAWxC,sBACVoF,EAAA,OAAKwD,MAAKlH,EAAE,CAAA/B,GAAA,SAAK,EAAGsH,MAAO,CAAEutC,QAAS,IAAMlvC,SAAA,CACzC,IAAI,GAEP,EAAK,CACN,EACO,EACVC,EAACiC,KAAa,EACb2P,GAAgBhW,MAAMxB,IACrByF,EAACiC,GAAQ,CAACC,GAAI,IAAIrI,CAAQ,MAAMkY,EAAehW,KAAKxB,EAAE,GAAG2F,SAAA,CACvDC,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAK,IAAK,EAAE,IAC9BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAqB,EACjB,CAAC,EACC,EAEZ4F,EAAC2xD,GAAQ,CAACX,YAAuB,EACjCnxD,EAACiC,GAAQ,CAACC,GAAG,KAAIhC,SAAA,CACfC,EAACS,EAAI,CAACC,KAAK,WAAWC,KAAK,IAAK,EAAE,IAClCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAuB,EACnB,CAAC,EACC,EACVyF,EAACqC,GAAQ,CACP4+B,cAAc,cACd9V,SAAS,OACT9pB,IAAK,GACLoB,MACEzC,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAK,IAAK,EAC5BX,EAAA,QAAMM,MAAM,YAAWP,SACrBC,EAAAgC,EAAA,CAAA5H,GAAA,SAAmB,EACf,EACN4F,EAACS,EAAI,CAACC,KAAK,gBAAiB,CAAC,EAC7B,EACHX,SAAA,CAEDF,EAACiC,GAAQ,CAACC,GAAG,KAAIhC,SAAA,CACfC,EAACS,EAAI,CAACC,KAAK,QAAQC,KAAK,IAAK,EAAE,IAC/BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAmB,EACf,CAAC,EACC,EACVyF,EAACiC,GAAQ,CAACC,GAAG,MAAKhC,SAAA,CAChBC,EAACS,EAAI,CAACC,KAAK,UAAUC,KAAK,IAAK,EAAE,IACjCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA+B,EAC3B,CAAC,EACC,EACVyF,EAACiC,GAAQ,CAACC,GAAG,MAAKhC,SAAA,CAChBC,EAACS,EAAI,CAACC,KAAK,WAAWC,KAAK,IAAK,EAAE,IAClCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA6B,EACzB,CAAC,EACC,EACV4F,EAACiC,GAAW,EAAE,EACbuhB,GAAS,mBAAmB,GAC3B3jB,EAACiC,GAAQ,CAACC,GAAG,MAAKhC,SAAA,CAChBC,EAACS,EAAI,CAACC,KAAK,UAAUC,KAAK,IAAK,EAAE,IACjCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAqB,EACjB,CAAC,EACC,EAEZyF,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACbvG,EAAO23B,oBAAsB,CAC3Bn3B,GAAI,OACJo3B,QAAOr1B,EAAE,CAAA/B,GAAA,SAAa,EACtBq3B,cAAe0/B,EACfz/B,yBAA0B,CAAC,QAAQ,EAEvC,EAAE3xB,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAK,IAAK,EAAE,IAC9BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA0B,EACtB,CAAC,EACC,EACVyF,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACbvG,EAAO23B,oBAAsB,CAC3Bn3B,GAAI,QACJo3B,QAAOr1B,EAAE,CAAA/B,GAAA,SAAe,EACxBq3B,cAAe6/B,EACf5/B,yBAA0B,CAAC,UAAU,EAEzC,EAAE3xB,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,QAAQC,KAAK,IAAK,EAAE,IAC/BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA4B,EACxB,CAAC,EACC,EAAE,GAAG,EACP,EACV4F,EAACiC,KAAa,EACdpC,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACbvG,EAAO68B,aAAe,EACxB,EAAE12B,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,QAAQC,KAAK,IAAK,EAAE,IAC/BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAuB,EACnB,CAAC,EACC,CAAC,EACX,EAEFyF,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAACiC,KAAa,EACdpC,EAACiC,GAAQ,CAACC,GAAG,SAAQhC,SAAA,CACnBC,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAK,IAAK,EAAE,IAC9BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAoB,EAChB,CAAC,EACC,CAAC,EACX,CACH,EACM,EACTyF,EAAA,WAAAE,SAAA,CACEC,EAACiC,KAAa,EACdpC,EAACiC,GAAQ,CAACC,GAAI,UAAUhC,SAAA,CACtBC,EAACS,EAAI,CAACC,KAAK,SAASC,KAAK,IAAK,EAAE,IAChCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAoB,EAChB,CAAC,EACC,EACVyF,EAACiC,GAAQ,CAACC,GAAI,IAAIrI,CAAQ,YAAYqG,SAAA,CACpCC,EAACS,EAAI,CAACC,KAAK,QAAQC,KAAK,IAAK,EAAE,IAC/BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAsB,EAClB,CAAC,EACC,EACVyF,EAACiC,GAAQ,CAACC,GAAI,IAAIrI,CAAQ,OAAOqG,SAAA,CAC/BC,EAACS,EAAI,CAACC,KAAK,WAAWC,KAAK,IAAK,EAAE,IAClCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAmB,EACf,CAAC,EACC,EACVyF,EAACiC,GAAQ,CAACC,GAAI,IAAIrI,CAAQ,KAAKqG,SAAA,CAC7BC,EAACS,EAAI,CAACC,KAAK,QAAQC,KAAK,IAAK,EAAE,IAC/BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAuB,EACnB,CAAC,EACC,EACTwf,EACC/Z,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAACiC,GAAW,CAACM,UAAU,eAAgB,EACvC1C,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACbvG,EAAOmK,0BAA4B,EACrC,EAAEhE,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,WAAWC,KAAK,IAAK,EAAE,IAClCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAgC,EAC5B,CAAC,EACC,EACVyF,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACbvG,EAAOslD,sBAAwB,EACjC,EAAEn/C,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,WAAWC,KAAK,IAAK,EAAE,IAClCX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAkC,EAC9B,CAAC,EACC,EACVyF,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACbvG,EAAOmlD,aAAe,EACxB,EAAEh/C,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAK,IAAK,EAAE,IAC9BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAuB,EACnB,CAAC,EACC,CAAC,EACX,EAEFyF,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAACiC,KAAa,EACdpC,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACbvG,EAAOmlD,aAAe,EACxB,EAAEh/C,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAK,IAAK,EAAE,IAC9BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAuB,EACnB,CAAC,EACC,CAAC,EACX,CACH,EACM,CAAC,EACI,CAAC,EACjB,CAEN,CAEA,SAASu3D,GAAS,CAAEX,WAAU,EAAG,CAC/B,MAAMY,EAAgBpuC,GAAS,iBAAiB,EAC1C,CAACa,EAAO0B,CAAQ,EAAI3sB,EAAS,EAAE,EACrChB,SAAU,IAAM,CACTw5D,GACDZ,IAAc,QAChBzsC,KAAWi1B,KAAKzzB,CAAQ,CAE5B,EAAG,CAACirC,EAAWY,CAAa,CAAC,EAEtBvtC,EAAM7pB,OAAS,EACpBqF,EAACqC,GAAQ,CACP4+B,cAAc,cACd9V,SAAS,OACT9pB,IAAK,GACLoB,MACEzC,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAK,IAAK,EAC5BX,EAAA,QAAMM,MAAM,YAAWP,SACrBC,EAAAgC,EAAA,CAAA5H,GAAA,SAAmB,EACf,EACN4F,EAACS,EAAI,CAACC,KAAK,gBAAiB,CAAC,EAC7B,EACHX,SAAA,CAEDC,EAAC8B,GAAQ,CAACC,GAAG,KAAIhC,SACfC,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAuB,EACnB,EACE,EACTiqB,GAAO7pB,OAAS,GACfqF,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAACiC,KAAa,EACboiB,EAAM7hB,IAAKvI,GACV+F,EAAC8B,GAAQ,CAAeC,GAAI,MAAM9H,EAAKG,EAAE,GAAG2F,SAC1CF,EAAA,QAAAE,SAAA,CACG9F,EAAKoJ,MACLpJ,EAAKwrB,WACJ5lB,EAAAC,EAAA,CAAAC,UACG,IACDC,EAACilB,KAAoB,CAAC,EACtB,CACH,EACG,GATOhrB,EAAKG,EAUV,CACX,CAAC,EACF,CACH,EACO,EAEVw3D,GACE/xD,EAACiC,GAAQ,CAACC,GAAG,KAAIhC,SAAA,CACfC,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAK,IAAK,EAC5BX,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAmB,EACf,CAAC,EACC,CAGhB,CAEA,MAAAy3D,GAAe/4D,GAAK83D,EAAO,ECtbrBkB,GAAwB,CAC5BpuC,MAAO,QACPumC,OAAQ,SACRxmC,SAAU,QACZ,EAEA,SAASsuC,GAAS,CAChB1uD,QACA2uD,iBACA53D,KACAV,WACAu4D,YACAC,YACAC,YACAz2C,iBACA02C,aAAaA,IAAM,CAAC,EACpBt2D,kBAAkBA,IAAM,CAAC,EACzBu2D,0BAA0B,KAC1BC,cACAC,YACAC,gBAEAC,UACAC,OACAvC,gBACAwC,mBACAC,kBACAC,kBACF,EAAG,CACD,KAAM,CAAE75D,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAC/B,CAACmvD,EAAO+J,CAAQ,EAAI15D,EAAS,EAAE,EAC/B,CAAC4nB,EAAS1D,CAAU,EAAIlkB,EAAS,OAAO,EACxC,CAACy7B,EAAUC,CAAW,EAAI17B,EAAS,EAAK,EACxC,CAAC25D,EAASC,CAAU,EAAI55D,EAAS,EAAK,EACtC,CAACF,GAASC,CAAU,EAAIC,EAAS,EAAI,EACrCyzD,EAAgB10D,IAEtBM,YAAQw6D,MAAM,YAAA74D,CAAA,OAAuBq4D,EACrCS,QAAkB5+C,GAAA,IAAc6+C,GAAO,MAEjCC,EAAa9+C,IAAQ,QAErB++C,IAAgBX,GAChBY,KAAsBC,IAAA,CAC5BP,EAAMQ,EAAYC,EAEdT,EAAW,SAAK,GAEhB11C,SAAW,CACV,IACC,MAAIo2C,GAAAJ,EAAA,mBACF,IACA,KAAAl+B,GAAMA,UAAM96B,YAAM,GAAIo5D,KAAMtB,EAAW5jC,QAAS,OAChD,GAAIklC,gBAAmBr7D,GACvB,KAAIyU,IAAcxS,EAAQ,EAAAA,GAAA,QAAAgnB,GAAAklC,KAElBA,UAEFllC,MAAS2uC,MAAS,EAElB3uC,GAAA,CAAO,OAAAklC,CAAA,EAEPllC,IACA,MAAOA,GACThnB,GACKq5D,GAEPr5D,IACI+4D,IACF/4D,GAAIohB,GAAgBphB,EAAA,GAEpBA,GAAA6wD,GAAA7wD,GAAAZ,CAAA,GAEFk6D,GAAA,SACAt5D,MAAgBE,OAAQF,EAAA,GAGxB7B,EADA86D,MAGWj5D,IAAK,IAAAu5D,GAAA,GAAAv5D,EAAA,CAFJA,EAIVw4D,GAAU/J,gBACZj0B,EAAA,CAAAM,EAAA,CACA,MACAN,EAAY,EAAK,EAEjBA,WAAiB,EACnB,4BAAA16B,CAAA,QACAkjB,OACA41C,SAAgB,MACN,CAAAnK,EAAA,QAAAmJ,GACVz5D,IAAe,CAEf,SACE4D,SAAU61D,CAAS,CACrB,IAEAsB,OAAiB,QACnB,EACC,GAIHvE,EAAS,qCAAA6E,EAAA13D,GAAA,cAAAnF,GAAA88D,KAAA,CAGb,GAAA98D,GAAA,WAAA88D,GAAA,aAEA,MAAMC,YAAgB,sBAAAA,CAAA,EAEhBF,GACJG,IAAA,sBACgB,EAERv1D,SAAaq1D,KAAQ3xD,EAAO,yBAAA4xD,CAAA,UAAAxN,IAAA,EAAAA,GAAA,cAGlC,GAAAyN,IAAMA,GAAsBC,MAAsBF,sBAAaG,GAAA,UAC/D,MAAMA,MAA6Bh1C,YACnC,IAAMi1C,GAAWtnD,GAAMC,MAIrBknD,WAIAvL,GAAM2L,QAAkBD,GAASE,KAAQL,GAAUI,IAAA,CAAA7N,EAAA,0CAE/CuN,KAEFrL,SAAW0L,EAKb1L,GAAA,eAAAoJ,EAAA,EAEEpJ,MACAA,YAAwBoJ,UAC1B,MAAAyC,EAAA/N,GAAA,wBACF,OAAO+N,EAAA,SAAAA,EAAA,OAEL,GACEC,KACAA,GAAOD,MAAS/pD,EACjBgqD,GAAA,eAAA1C,EAAA,EAEC0C,CACAA,GAAgD,OAClD,GACF,gBAAAv9D,OAAA,SAAAA,GAAA,SAAAA,GAAA,OACF,EAEE4H,GAAQzC,GAAA,cAAAnF,GAAA88D,KAAA,CACRj1D,iBAAkB7H,GAAQ+H,aAE9B,MAAAi1D,GAAA,+BAAAD,CAAA,EAEMS,GACJR,IAAA,sBACgB,EAERv1D,SAAaq1D,KAAQ3xD,EAAO,yBAAA4xD,CAAA,UAAAxN,IAAA,EAAAA,GAAA,cAGlC,GAAAyN,IAAMA,GAAsBC,MAAsBF,sBAAaG,GAAA,UAC/D,MAAMA,MAA6Bh1C,YACnC,IAAMi1C,GAAWtnD,GAAMC,MAIrBknD,WAIApL,GAAMwL,YAAkBD,GAASE,KAAQL,GAAUI,IAAA,CAAA7N,EAAA,0CAE/CuN,KAEFlL,SAAWuL,EAKbvL,GAAA,eAAAiJ,EAAA,EAEEjJ,MACAA,YAAwBiJ,UAC1B,MAAAyC,EAAA/N,GAAA,wBACF,OAAO+N,EAAA,SAAAA,EAAA,OAEL,GACEC,KACAA,GAAOD,MAAS/pD,EACjBgqD,GAAA,eAAA1C,EAAA,EAEC0C,CACAA,GAAgD,OAClD,GACF,gBAAAv9D,OAAA,SAAAA,GAAA,SAAAA,GAAA,OACF,EAEE4H,GAAQzC,GAAA,mBACR0C,SAAkB7H,SAAQ+H,cAE9Bi1D,IAAA,QAAAD,CAAA,GAEAC,GAAa73D,OAKT,GACE63D,UACF,gBAAAh9D,OAAA,SAAAA,GAAA,SAAAA,GAAA,QAAAA,GAAA,SACF,EAEE4H,EAAQkqD,EAAA,UAAA/nC,IAAA,WAAA+xC,EACRj0D,GAAwB7H,GAAaA,IAAEgI,CAE3Cy1D,GAAAlB,EAAA,IAEA3G,EAAM6H,kBACJ3L,CACF,IAAM4L,EACJ,SAAID,QACJ7H,EAAgC,GAC9BriD,EAAKkqD,CAAA,GACLjxC,GAAUrnB,GAAA,IAAAu4D,GAAA,CACZ,OAAC,GACH,gBAAeD,gBAAsBz9D,GAAA,SAAAA,GAAA,QAAAA,GAAA,QACrC,GACE4H,GAAQ1G,EAAA,EACR2G,QAAuCG,EAAWhI,IACnD29D,GAAAr1D,GAAA,EAaD,gBAAA+tD,GAEA,eAAOM,GACP,WAAAJ,EACG,IAAEF,CAAiBM,eAAgBJ,yBAAWqH,GAAM,eAAAC,EACnD,CACEjH,GAAMiH,EAAWxH,EACjBuH,IACFrB,EAAA,GAEA,GAAA3F,GAAgB2F,CAAA,GACdA,CACF,qBAAAtE,EAAA,EAEDrB,IAEH,cAAAhB,EAAQqC,uCACN,IACErC,MACAE,KACAC,WAAsB,UAExB4H,KAGFx8D,GACEy0D,IAAcx0D,CAAkB,IAAEmS,EAAK,MAAGgkB,GAAAr2B,EAAA,IAC1Cq7D,MAAc,CAChB,GAAKhlC,GAAA,SACLA,GAAMA,WACNp2B,MACE,CACEo2B,GAAoBu6B,GAAA,SACpByK,EAAA,WACFV,EAAA,KAEEU,IAAUuB,CACVjC,KAAWL,CAAA,SACbuC,GAAA78D,EAAAu6D,CAAA,EACAc,MAAc,CACZX,aAAkBJ,IActBuC,GAAMA,UACN58D,EAAU,IAEN48D,OACAlC,SAAWvzD,GAAA,OACb,iBAAA01D,GAAA,IACEvC,KAAK,CAET,MAAMwC,aACJ,iBAAOrI,EAAA,mCAAEoI,WAAmB,aAAApI,EAAA,uBAAAoI,IAAA,mBAAAE,GAAA,IAAAC,GAAU5B,EAAO,YAIJp5D,GAErC8vD,KAEamL,GACbF,IAAcA,EAAal4D,EAAA,uBAC3Bm4D,iBACDE,IAAA,CACD,GACEr4D,IAMAxE,SAAY,WAAkB2B,GAAewD,SAC7C41D,IAAc,SAAAl8D,GAAA,QAChB49D,GAAO,CACLz8D,iBAAY,EACZ,EAEEA,MACAu6D,GAAW,QAAI,WAEnB75D,EAAAm8D,EAAA,CACF,EACA,CAACl7D,KAAgC6C,EAAWW,oBAC9C,GAEA/B,MAA8B3C,IAAA,CAAA65D,EAAAV,GAAAzE,GAAA,WAC9B51D,KACGkB,SAAY,CACX,MAAIA,EACF,SAAM5B,QAAWoL,CACjB,GAAI,GAAC6yD,SAEHL,wBAAmB9B,EAAA,sCACjB6B,KACFpI,EAAC,QAAAjlD,GACHksD,EAAA,QAAAlsD,GACF6sD,GAAO,QAAA7sD,GACL2tD,WAAel9D,GACjBm9D,GAAA,QAAA5tD,EACAzO,EAED2C,cAIHD,QACEq5D,KASAl1D,YAAey1D,UAAQ,+CAACn7D,WAAO61D,KAAcpwD,GAC3C,qBACW,CACTO,EAAO,IAILusD,EACAiH,SAAKz7D,QAAUuP,CACf6sD,MAAKp8D,qBACLq9D,SAAKr9D,GAAUuP,UACf4tD,IAAOn9D,GACT,QAAApB,IAAA,CACSA,GAAA,+BACO,yBAMZsC,SAAW,QACTs7D,EAEF,EACF,WAAA59D,IAAA,CACFA,GAAA,6BAAE8I,EAEF,GAA+BA,EAE3BE,MAAK40D,2BAEL10D,SAAUlJ,GAAM,OACd,MAAOoK,cACLwrD,mBAAgC,MACzB,uBACLppC,GAAUmtC,GAAA,IAAA0B,GAAAtyD,EAAA8T,GAAA,CACX,OACH,iCACF,SAAA9T,EAAAS,EAAA,MACaxJ,OACNA,KAAEoK,IACLmyD,MAEJ,CACOxyC,WAAoC,CAE3C,CAAW,CAAajhB,CACtB,CAAKO,EAAM,GAAaP,IACtBC,GACiBA,EAAA,KAAQsyD,CAGlB,SAAIjvD,CAAA,IAAI/C,QAAM,OAA0BP,cACtC,SAAM,EAAAwyD,IAAA,GAAY,GAAAmC,GAAOv4D,4DAAE,QAAAw4D,GAAA,SAAM,CAAA30D,EAAAS,EAAA,MAAC,aAAC,IAAET,EAAAgC,EAAA,CAAC,GAE9C,SACE,EACwC,GAAKqB,GAAK,CAAK,CAAAmvD,GAC5DxyD,EAAA,aAAKM,kBAAM0gB,IAAA,kCAAajhB,CAENwyD,GACZxJ,EAAA,OAAAlpD,EAAAC,EAAA,UAEP40D,SAEGp0D,MAAM,YAAAoyD,EAAA,YAAAA,CAAA,QACNxyD,SAAK,CAAA6oD,EAAA,IAAAv6C,IAAAxO,EAAA21D,GAAA,CACLx1D,UAA4BJ,WAEtBW,YAAiB,cAAAyvD,EAAE/1D,OAAwB,iBAAAu4D,EAEpD,gBAAAC,EAEAJ,YACD,EACElyD,GAAO,GAAAkO,IAAkBwS,SAAY,GAAA6T,OAA0B,YAAA69B,IAAA,aAAA7yD,EAAAC,EAAA,CAAGC,SAEjEyyD,SAGFzJ,MAAMvuD,CACPuF,OACEF,MAAA,WACGkpD,EAAMvmD,GAAKgM,CAERA,YACA9U,aACAy4D,EAEAhC,UAEAuC,OACAC,eAEAS,eAJK5kD,SAAYA,GAUjBzO,YACE,CACE2B,CAAO,GACG,IACV,GAAAsf,IAEAhhB,YAAO60B,EAAA70B,EAAA41B,GAAA,MAAClG,EAAQ,mBAAC0jC,8CAAyBwC,IAAA,CAE5C51D,IACE0B,EAAO,CACG,EACV,SAAE3B,WAED21B,CAAM,KAAChG,SAAQ,MAAC0jC,sBAAyB,IAAAI,EAAA,EAAC,MACxC,CAEP,+BAKM3G,IAAcx0D,CACpBsO,WAA0C,EAExC,EACE6sD,UAAU,MACZ,yBACF,SAAAxzD,EAAAgC,EAAA,CAAEjC,WAEF,EACO,IACC,GAAAihB,cACSwyC,EAAU,YACzB9xD,WAAO,SAAEm0D,YAAgB,OAAM,QAAE91D,aAEjCiC,QAAAhC,EAAA,aAAA5F,CAAA,OAAwB,OAClB,CACF,EAER4F,EAAA,MAAGM,SAAMN,EAAA01B,GAAA,CAAwB31B,YAC/B3F,YAAA,CAAsB,GAExByN,EAAA,GACJ,EACAmZ,IAAY,SAAAA,IACd,SAAAhhB,EAAA,KAAIM,MAAM,WAAUP,SACjB+M,CAAW,GAAEtS,IAAQ,SAAAqF,EAAA,KAAE,MAAO,WAE3B,SACS,CAAAqyD,EAAAlyD,EAAA,SAAAA,EAAA,SAAAA,EAAA,eACL2K,SACF,YAAA6oD,EAAA,CAAAzK,EAAA,QACD,SAED/oD,EAAAgC,EAAA,CAAAjC,WACS,EAAS,GAACqzD,GAAyB,EAGhD,EAIqB,EAAS,CAAYnB,SAE7CjxC,GAAY,EACX,OAAAxS,EAAS,SAAA9U,EAIP,UAAAy4D,EAA4D,cAAAhC,EAC1D,KAAAuC,EAAA,iBAAAC,EAAuB,gBAAAC,EAChB,WAAAQ,CAEZ,KACE,KACF,CACiB,EAAAn2C,CAE5B,EAAAhkB,GAAA,EAEM08D,CAEFnnD,KACA9U,SACAy4D,eAEAhC,WACAuC,EACAC,UACAC,iBACAQ,6BACF,GAAMrK,EAAA,CACJ,IAAM+M,EAAA7K,GAAAlC,EAAAoH,CAAA,EAAEn3D,KAaI,GAbDC,IAAA,SACXR,EAAQw6D,GAAM,EACFn1B,CAAU/f,YAAQgrC,QAAO7oD,WAAM+vD,CAC3C,EACM7M,eACN//C,EAAY3J,EAKNo8D,CACAzyD,WACJ,CACEA,GAAQnD,IAAA,UAAAA,IAAA,gBAAA7F,EAAA,QAmBN,GAnBMy7D,OAAOA,GAAOt7D,WAAMu7D,EAAAvR,GAAAz4C,EAAA,SAAAokD,CAAA,EAG3B6F,EAAAxR,GAAAnvC,EAAA,SAAA86C,CAAA,EAEqB,OAFpB4F,MAAA,iBACJE,EAAoB,IAAAlqD,EAAA,EAAU,EACvBkR,uBAAGg5C,EAAA,IAAA5gD,EAAA,IAAc0gD,GAAA,CAAAC,EAAC,EAEnBE,IAAah2D,EACfg2D,GAGK9gD,CAOL,GACA6gD,EAAkBzR,QAAWnvC,CAE3B4gD,QAAiB9tD,GACnBk8C,EAAA,GACAyR,EAAIE,WAAaA,CACfC,EAAqB5gD,IAAImxC,EAAA,IAC3BnC,EAAA,KAAAmC,CAAA,EAEE2P,EAAO,KAAA3P,CAAA,CAET,GACE,MAAA4P,EAAO,GACT,QAAAvuD,EAAA,EAAAA,EAAAw8C,EAAA,OAAAx8C,GAAA,EACAuuD,EAAO,MACR,YAEGH,gBAAyBpuD,EAAG,EAC9B,GAGAiuD,IAAiB,OAAAM,CAAA,CACjBN,CACE,OAAA91D,EAAIi2D,MACF5R,+BAAkB,SACbrkD,EAAAq2D,GAAA,CACLF,QACF,SAAAj2D,CAAA,YACD,SAAA41D,EAAA,IAAAtP,GAAA,CACD,MACA,cAEI8P,QAAUC,EACV92D,UAAuC,EACxC+mD,EACH,GAAA8P,EACAR,OAASK,QACX,8CAGE3P,EAAA,UAAAgQ,GAAA,CAAuC,SACpCH,GAAehzD,SAAwBnD,QAAIu2D,CAAA,EACzCX,EACOY,EAAAC,GAAA,IAAAC,GAAM94B,6BAAU/f,iBAAQkyC,MAASqG,+CAAa9P,KAChD8P,SAAUnE,EAAAnyD,EAAA01B,GAAA,UAEVkhC,GAAmBt2D,WAAoCP,KACpDymD,GACC,GAAMxmD,EAAA01B,GAAA,CAAEt7B,OAAI0jC,EAAU/f,WAAQkyC,SAAQ,CACtC,EACA,EAGA,EAAA4G,GAEO,MAAAC,EACGC,GAAA,IAAAF,EAAAG,EACFvkD,sCAAI1S,EAEPoyD,IACQnyD,EACL89B,MAAUA,SACVpkC,YACAiH,yCAAK,GAAGq2D,EAGH,SACLxoD,EAAQg4C,eACR9sD,aACK,KACN,IACF,kBACG,GAET,qBA5BMokC,YA6BL,CAER,EAAA99B,EAAA01B,GAAA,CAEM0tB,SACA3wC,oBAIN,kBACE,GAAA1S,kBACO,GACHO,YAAM,CACNyB,CAAI0Q,EAGK,EAAAokD,CACL/4B,CAAUA,EACVpkC,EACK,cACLu9D,IAAiB,CACA,MAAAC,EAEjB9D,oBACD,IAEDpzD,GAAC01B,IAAM,OACG8wB,KACR9sD,kBACK,EAAA8sD,EACYwQ,EACjBG,OAAiB,MAAAN,CAAA,SAAAA,CAAA,GAAAO,EAEjBhE,oBACD5M,EAAA,aAAAA,EAAA,YAAA6Q,EAEC,CAAAC,GAAAC,GAAA1vD,EAAA,GAAAqvD,GAAAE,IAAAl3D,IAAA,UAAAA,IAAA,iBAAAo3D,GAAA,CAAAxB,EAAAjuD,EAAA,sBAAAiuD,EAAAjuD,EAAA,qBAAC2vD,EA1BA15B,IA2BL,EAEP25B,GAAA5vD,IAAAiuD,EAAA,gBACa91D,EAAA,MAAC,MA3EV,wDA4ELE,CAAA,4BAAAs3D,EAAA,QAAAC,GAAA,kBAAAH,EAAA,iCAER,SAAAt3D,EAAA8T,GAAA,CACMojD,kCACN,GAAOpB,EACL,SAAMuB,EAAAr3D,EAAA03D,GAAA,CAAM55B,SAAUw5B,WAAqB9Q,eAC3C,GAAM/zC,IAAiBijB,GAAIh8B,CACrB09D,WACAG,WACAF,kBACFC,GAQEE,kBAEN,KACE9hC,GAAA,CAEEp1B,OAAOkmD,EAEmDzmD,WAEpDO,kBAAMm3D,GAA4B11D,kBAEd,EACZykD,EACR9sD,cACAy2D,MAGK,CACKryB,QACVpkC,6BACAy9D,QAAmBM,EACnB9E,mCAED,KAEM,SAAA70B,EACG0oB,UAEWiR,GACnB9E,qCAED,YAAAnkD,EAEE,SAAA9U,CAGZ,EACHi+D,CAAA,SAIa,CACX,SAAOxF,MAEH7xD,MAAM,4BACN6G,KAEA22B,iBACApkC,sBAFKi+D,kBAMNxI,GACC7uD,mBACA6G,kBAEAqH,aACA9U,iBAFKi+D,WAMX,qBAEA,iBAAAhF,EACE5yD,kBACQO,YAAM,CAA4ByB,CAAI0Q,EAEjC,EAAAklD,CACL75B,MACApkC,WACAy9D,aAAiB,mBACjBxE,uCACAC,kDAEAQ,SACDiD,GAEM,OAAAhzD,EACLmL,MACA9U,YACiB,GACjBi5D,KACAC,IAEAQ,EAAuBn6D,GACxB,EAEC8kC,EAAA5lC,EAAA,EAvBCw/D,EAwBLx/D,EAAA,IAGGqtD,EAAa,EAChBoS,GAASrS,CAAS/2C,IAAQpU,EAAUmS,EAC1CnU,SAAMy/D,IAASrS,CACf,WACEoS,KAKNE,EAAA,GAEA,IAA0Bz0D,MAAcd,SAAWxC,6BAAY,UAAAF,EAAA,UAC7D,SAAM,CAAAG,EAAA,MAAEhH,WAAGC,WAAA,CACL8kC,YAAc5lC,SAAO,qBAIpB4/D,MAAQD,eACf1/D,QAAgB,KACdmB,MAAWkR,EAAM,aAAAszB,EAAA,uBAAAW,GAAA,QACfo5B,EAAc,mBACZ,KAAArtD,EACD,iBAEL,EACOnK,EAAsCP,SACzCF,EAAAY,EAAA,CAAAV,KACEC,eAAAD,MACAA,CAESi4D,YACA,CACC,EAGJ,OAAAh4D,EAAMyK,SACCmQ,CAEPmjB,MAA8B,KAC5BtzB,eACAgZ,eAAU,QACX,KACH,MAAAhZ,EAAA,aAAAszB,EAAA,uBAAAW,GAAA,QAAE3+B,WAEG,UAACW,OAAoBE,SAAGq3D,YAAE,SAAAj4D,EAAAS,EAAA,MAAU,gBAAC,IAAAw3D,EAClC,CAEHC,YACA,CACC,EAGJ,GAGAn6B,GAA8B,GAAAl+B,EAC5B4K,YACU,SACX,CAAAzK,EAAA41B,GAAA,OACH,kCAAE71B,GAEDU,CAAKC,EAAK,UAAAs3D,EAAA,iBAAApC,EAAA,CAAmBqC,kCAAE,kCAAA79D,GAAA,CAAM89D,EAAA,UAAAA,EAAA,iBAAAtC,EAAA,CAAC,GAAG,GACnC,EACJ,CAET,SAAI31D,GAAK89B,UACA,SAAArkC,EACC,cAAAy2D,CAEJ,GACoCyF,KACtC,GACDuC,CAGM,EAAAl/D,GACC,EACNwc,EAAWmgD,GAAWh8D,CAAA,EACpB,CAA0Dg8D,KAC5D,WAAAjG,EACA,SAAAC,CACC,EACFphD,EAET4pD,EAAAr1D,GAAAyL,CAAA,EAEAu9C,EAAS2L,MAAsB,EAAElpD,mBAAQ9U,oBAAUy2D,qEAAiB,cAClE,SAAM,CAAAnwD,EAAA,OAAEhH,sCAAGC,WAAAo/D,GAAA,CACLp7D,2BAA+B8uD,CAAA,CACrC,EAAM,CAAE3xD,WAAIu1D,wBAAYC,QAAaphD,OACrC,IAAM4pD,OACN,SAAahU,GAAc1qD,GAAQ,gBAAAsG,EAAA,KAC7BukD,oDACN,MACEA,GAAA,cACEjkD,SAAOikD,GAAA,UACLoL,IAAe,CAEjBxrD,GAAS,SAAIpE,OAEbC,CAAKM,EAAMikD,EAAA,WACIhkC,WAAOtjB,CAAsC,EAAA+C,EAAA,WAE5DA,IAAA,WACQ,CACNqD,EAAO+0D,UACP5jD,SAAMo7C,KACF,YAAM7vD,CAGR,CACEO,CAAM,GACN+C,IAAmBi1D,CAAgBv4D,SAElCwkD,GAAY+T,EACXt4D,WAAAwO,EAAA,aAAA3O,EAAAC,EAAA,CAAA1F,SAAA,KAAA4F,EAAA,QAAA3F,MAAA,gBAAAuJ,SACgC2gD,EAAW+T,GAAS,iBAAA30D,SAAAC,IAAlD5D,EAA0D,CAG5D,YACE,EAAsB,EAClB,GAEP,EAEH,EAGI,GAEE,EAAY,CACL,SAAAm1D,IAAM,kBAAiB,sDC97B9C,MAAMlpC,GAAQ,GACRssC,GAAW,KACXC,GAAiB,GAAGD,EAAQ,MAE5BE,GAAqBC,GAAI,IAAM,CACnC,GAAI,CACF,MAAMh2B,EAAQvsC,SAASi6B,cAAc,OAAO,EAC5CsS,SAAMmN,aAAa,OAAQ,OAAO,EAC3BnN,EAAMxiC,OAAS,OACxB,MAAY,CACV,MAAO,EACT,CACF,CAAC,EAED,eAAey4D,GAAiBj/D,EAAU,CACxC,KAAM,CAAED,SAAUyB,GAAI,CAAExB,WAAU,EAMlC,MAAO,CAAC,EALQ,MAAMD,EAAMswB,GAAGC,OAAO/vB,KAAK,CACzCgwB,EAAG,UACH/pB,KAAM,WACNhG,MAAO,EACR,IACiB0C,UAAUpC,MAC9B,CACA,MAAMo+D,GAAkBr8D,GAAKo8D,EAAgB,EAE7C,SAASE,IAAkB,CACzB,KAAM,CAAE1kD,OAAMnb,KAAGC,KACXgE,EAAaC,GAAYtD,CAAM,EAC/B,CAAEQ,KAAI,GAAG/D,GAAWyiE,KACpB,CAAC1R,EAAcC,CAAe,EAAIC,KAClCyR,EAAQ3R,EAAavzC,IAAI,OAAO,EAChCmlD,EAAiB,CAAC5R,EAAavzC,IAAI,SAAS,EAC5ColD,EAAgB,CAAC,CAAC7R,EAAavzC,IAAI,QAAQ,EAC3CqlD,EAAS9R,EAAavzC,IAAI,QAAQ,EAClCsrB,EAAQ,CAAC,CAACioB,EAAavzC,IAAI,OAAO,EAClC,CAAEpa,QAAOC,WAAUkgB,iBAAkB1e,GAAI,CAAExB,SAAUrD,EAAOqD,SAAU,EACtE,CAAED,MAAOuuB,EAActuB,SAAUuuB,GAAoB/sB,KACrDi+D,EAA0BhhE,IAE1BihE,EAAkB,CAACL,EAAOC,EAAgBC,EAAeC,EAAQ/5B,CAAK,EACtE,CAAChtB,EAAS8O,CAAU,EAAI7nB,IACxBigE,EAAkBlhE,EAAO,CAAC,EAChCC,EAAU,IAAM,CACdihE,EAAgBhhE,QAAU,CAC5B,EAAG+gE,CAAe,EAElB,MAAMhG,EAAa9+C,GAAQ,IAAM6+C,KAAwB,EAAE,EAErD5lC,EAAsBjZ,GAC1B,IAAM5a,IAAauuB,EACnB,CAACvuB,EAAUuuB,CAAe,CAC5B,EACM,CAACqxC,EAAeC,CAAgB,EAAIngE,EAAS,EAAK,EACxDhB,EAAU,IAAM,CAGTm1B,GACApb,GAAS0N,OACb,SAAY,CACX,MAAM7a,GAAU,MAAM4zD,GAAgBl/D,CAAQ,EAC9CjB,EAAYuM,EAAA,KAAEA,GAAQtL,EAAC6zB,EAAApb,GAAA,OACvBonD,iBAAwB/qC,GAAA,CAC1B,MAAGgrC,EAAA,sBAAAT,CAAA,EACDr/D,GAAU6zB,WAAqBpb,OAAS0N,IAAK04C,GAEjD,GAAAiB,OACE,GAAMA,GACN,gBAEM,KAACrnD,EACH,EACS,KACPijB,IAAMqkC,EAAA,EAAAV,EAAA,WACRW,GAAA,SAAAD,GAAA,MACFE,GAAA,SAAAC,GAAAF,GAAA,GACMG,GAAQJ,GAAME,GAAIZ,YAAY,CAAG,KAAAY,GAAA,4CAAAA,GAAA,uCACjCD,OAAa3+C,QAAS0+C,GAAc,KAQpCE,GAAYj3D,MAAKk3D,kBAAoBE,GAAA,4CAAAA,GAAA,uCAC3C,IAAA5/D,GAIAs0B,IACAt0B,GAAM6/D,GAAY,EAGlBthE,EAAY,YAEVmhE,kBACAH,eACAC,MACAC,2BACAG,4CACAD,gBACAE,SACD,OAAAV,EAAA,OAED,GACA,GAAI7qC,IAAW,kBACbt0B,SAAQ+xB,GAAQ,iBAAAA,EAAA,EAChBotC,WAAgBhhE,KAClB+zD,GAAO5F,GAAA9sD,CAAA,CACLQ,GACAm/D,YAA2BptC,oBAC7B,OAEA,MAAM+tC,QACDC,EAA0D,CACvD,KAENh3B,QACD,SACG+2B,OACF,CAEE5N,CAAyB,IAC3BtiC,GAAC,GACD,GAAA0E,GAAM4G,CACN,MAAO,MAAE96B,IAAO86B,8CAAK,UACvB,SAAO,SACL,GAAA8kC,IAAO,SAAAhB,GAAA,CAAA/5B,EAAA,UAAS+6B,GAAA,IAAA1rD,KAAI4mB,GAAM5mB,GAAA9U,CAAA,EAAK,CACjC,GAAA8U,GACF,UAEA,EACIggB,EACF,GAAM2rC,GAAA,WAAE7/D,2BAAUwvB,GAAMrwB,KAAMM,CAG1BqgE,GAAQC,GAEThgE,MACAE,GACCD,KAAOE,QACT,EACE4xD,MACAtiC,GAAO,QAAAqwC,EAAA,CACF3rD,CACM,EAEbggB,IAAC,CAAA2qC,EAAA,WACDA,UAAgC1/D,EAAA,oBAAAW,CAAA,iBAC9B,MAAA6xB,GACAnC,gBAAakvC,EAAA,gBACPqB,aACGF,kBACD,UACP,GAEDrwC,MAA8B,MAAAxvB,GAElC,KAAA86B,EAAA,EACF,MAAA+jC,EAAA,eACA,GAAI3qC,WAAc2qC,CAChBA,kCAGIj/D,GAAO+xB,QACPpvB,OAAiBm8D,GACjBl8D,OAAiBm8D,mBACIx6D,SAGtBpE,GAAOyvB,GAAA,OAAAtb,OAAA,aAAAA,OAAA,IAEN6rD,GAAA,MAAAC,IAAAhgE,GAAA,KAAAkU,OAAA,KAAA8rD,EAAA,KAASllC,MACX96B,CAKAwvB,WAAYtvB,IACVF,GAAA,aACA8xD,GAAItiC,GAASpwB,CAAGwG,CACdm6D,EAA+BjgE,CAE/BigE,OAE4B,MAC9BvwC,GACA,KAAAsL,EAGA,CAEEtL,CAAU,MAAAywC,EACZC,CAAA,EAAAphE,EAAA,QAAAiK,EACFlH,EAGF2tB,CAEAxvB,WACE8xD,CAAyB,EAC1B,GACHj6C,GAAA,MACA,MAAAsoD,IAAO,SAAAtoD,EAAA,cAAAA,EAAA,KACL7X,EAAOwvB,qDACPsL,GACF/xB,EAAAlH,EAGI,CACFkH,GAAKlH,iBAAG,eAAAu+D,CAAA,EAAe,UACd76C,EACXxc,EAAMo3D,EAIF,CACFp3D,GAAKlH,iBAAG,eAAAu+D,CAAA,YAAkBxB,EAAA71D,EAAalH,GAEvCkH,GAAKlH,iBAAG,eAAAu+D,EAAAtgE,QAAA,EAAAsgE,UAA8Bv7B,EAAC97B,EAAAlH,EAEvCkH,CAAKlH,YAAG,QAAA/B,gBAAA,EAAAsgE,UAA8B3B,EAAA,OAAE4B,GAAA,SAAA5B,CAAA,iBAAA5kD,EAAA,QAAC,2BAEzC9Q,GAAKlH,IAAG,CAAA9B,YAAA,OAAAqgE,CAAkB,eAAAA,EAAS,UAAAC,EAAA,CAAC,CAEpC,CAA8D,MACrDt3D,EACDq3D,CAERr3D,CAAKlH,gCAAGy+D,GAAAr7D,GAAA,IAAAnF,KAAAX,CAAA,GAAAW,EAAAC,IAAAjC,EAAAsiE,eAAkBC,IAAc,CAAE,MAAAr5C,GAAA,MAAAs5C,GAAA,EAAC35C,EAAAK,EAAA,CAC7C,MAAO,EACLje,MACF,IACF,MAAAw3D,GAAA,MAAAphE,EAAA,oBAAAW,CAAA,sBACA0gE,EAAgBD,EAAmB,CAE7BztC,QAEN,GAAG,CAEHh1B,MAAgB,GACd,KAAC,CACC,YAAAopB,EACE,KAAA3B,EACApnB,QACAwoB,UACOhqB,GAAG,IAAAkb,GAAA,KAAA3S,KAAA,CAAA2S,GAAA,KACV1Z,EAAeN,EAAA,EACjB4iE,EAAAzmD,GAAA,KAGA,MAAI+vC,GAAC+O,IAAY6F,GAAAC,GAAA/5B,GAAA,EAAA45B,EACfiC,EAAI/9D,EAAA,YAAA7C,CAAA,IAAAV,CAAA,IACF,OAAAmG,EAAM06D,GAGN9hE,YAAY00B,GAAA,UAAAzzB,EAAE6gE,QAAcS,GAAA5gE,EAC5BogE,gBACF,cAAA5gD,EACEnhB,cACF,oBACF,GAAA26D,GAAAvzD,EAAA,OACC,mBACDzF,IAAIg5D,EAEF,OAAE5xC,qBAAmBkM,0BAAuBh0B,CAAA,MAAAU,CAAA,GAE5CovB,MAASlV,iDAWb,CACE,EAEI5a,mBACSshE,IACT5tC,SACAxT,MAEAiO,CAEAurC,WACA,CACQ,CACD6H,CACLv5D,CAAO,EACLopB,eAAU,EAAA9qB,EAAAS,EAAA,CACZ,cAAEV,sBAIEgC,KAAI,IACJzB,MACKnE,CAAE,aAAe,GAAC6D,EAAA8T,GAAA,CAAC/T,QAGvBU,MAAIrG,CAAA,GAAA4+D,EAAA,0BAAM,KAAIr4D,GAASC,GAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAI,EAIzCsG,MAAKs4D,EAAA,eACL14D,SAAMN,EAAAgC,EAAA,CACNrB,GAAK,SACLC,CAAGzE,YAAE,IAAAzC,CAAA,MAAAU,CAAA,GAAA6+D,EAAA,8BAASA,GAAC58D,GAAAF,MAKRgE,QACP,CACE9D,EAASF,EAAC,MAAA/B,EAAA,wBAA2B4F,EAAAgC,EAAA,IAAC,UACxC,GACFhC,EAAA8T,GAAA,CACAxT,eAAwB,GAAA6+B,EAAK,gBAAYp/B,YAEzCiC,CAAAm9B,GAAuB9iC,GAAAF,MAIdgE,QACP,CACE9D,EAASF,EAAC,MAAAgjC,EAAA,wBAA8Bn/B,EAAAgC,EAAA,IAAC,UAC3C,GACFu4D,EAAA,IAAA/d,IAAAx8C,EAAA8T,GAAA,CACAxT,OAAQ24D,QAAgB,GAAAC,IAAK1c,GAAA,sCAAAA,GAAA,UAAYz8C,YAEzCiC,CAAAk3D,IAAA1c,GAAA,MAAsBngD,GAAAF,MAIbgE,SACFg/B,OAAO,CACV9iC,KAASF,MAAC,EAA0B,EAAC,MACvC+8D,IAAA1c,GAAA,oBACF,SAAA38C,EAAA,QACAS,YAAe,QAAiBP,2BAEhC3F,SAAA,IAAmB,EAAAoiD,GAAA,MACf,CAEC,EAEHz6C,GAAI,GAAIrI,MACNw/D,GAAe/jD,IAEX,QAAWulC,CAEjBv6C,sBAAe44D,EAAA,iBACb,SAAIG,KAAe/jD,CACjB9Y,aAASF,aAAC,cAAA/B,QAAA,SAAAC,IAAA,WAAA0+D,GAAmC5jD,UAAI,IAAC,4CAACle,IAAA,CACrD,MACF,MAAAqD,GACAgG,WAA2C,EAAGP,GAE9CF,cAAAE,OACE,aAAMO,EAAMhG,GAAA,CAAoByF,QAAC,EAChCy8C,EAAIrnC,EACD,MAAAosC,GAAA2Z,EAAA,EAAA5gE,GAAA,cAOTg/D,SACEb,SACehhC,GAAA,SAAgBshC,GAAQW,EAAA,EAAmB35D,GACvDC,EAAmBW,CACnBX,GAAA,SACO,QACLqC,EAAW8P,kBAAS0N,UACbk5C,MAAS,OACXP,gBACmC,CAEtC,CAAM,EAAEl+D,CAAO6gE,GACf,GAGMn7D,EAAAo7D,GACS9gE,OAER,gBACPy+D,EAAA,iBACA,SAAOxX,IAAMwX,KACb,MAAAA,GAAMW,GACN,IAAAlB,GACAn8D,IAASF,sDACP,OAAA7B,GAAA,SAAA6gE,EAAA,EAAAlkE,GAAsDkkE,GACpDpC,OAAO1R,EACD/sD,GAAA,OACPA,EAAA,EAAC,IAAC,GACL,CACF,GACA,EACG,GAAAF,EAAAV,EAAAkgB,EAAA2gD,EAAAK,GAAAtB,EAAA,GAAAF,CAAA,GAAAhhE,MAGNgjE,CAAW,MAAAC,GACHJ,EAAA,SAAgBlC,cAAQ,YAAgB,EAAAsC,IAC3Bx7C,EACbk5C,iBAAS,UACXP,cACL39C,qCAAwCwgD,GAAA,gBAEhC,GAAAd,EAAEjgE,iBAAO6gE,UAAalkE,IACvBkkE,UAASG,EAAO,eADOrkE,KAItB,CAAAkb,CAAA,GAINopD,GACF,EAAAppD,GAAA,EADEzY,IAAA60B,GACF,OAAA1uB,EACDC,EAAA,UACD,CAAAE,EAAA+xD,GAAA,OAEP,GAAA5/C,GAAA,SAAAA,EAAA,KAAAhW,EAIL/B,CASFhC,GAAU,QAER,CACA,IACEK,eAAYoH,EAAUw7D,MACtBJ,2CACEx3C,SAAU,CAAAzjB,EAAA,cAERq7D,EAAOG,IAEV,KAAAh6C,EACH,OAAAkM,EACE6sC,YAAcjB,MAElB,CAAM/qC,CACJ,CAAKpc,UAAc,CACbwiC,SAAS5hB,EAAIv0B,OAAM2T,CAClBwiC,qBACLxiC,SAAQ,KAAA0N,CAAA,CACZ,EACA,CAAM07C,EAEN,GACEx7D,sBAGIsD,WAA4ClH,YAAG,CAAO,YAAC,EAErD,UACQA,EAQN,CACY,GACRgrB,QAAM3F,CACNkM,EACsBjb,WACvBgpD,EAAA,UAEH,QAAA17D,KACE,8BAAY9C,EAAA,sCAAc8C,EAAO,QAAO,CAAAi5D,EAAAC,EAAAC,EAAA/5B,EAAA45B,EAAA5mD,GAAA,2BACpCtS,EAAAoT,GAAA,CACJ,UAEN7Y,SAAG,OACHV,mBACAu4D,SAAS91D,gCAAE,cAAA/B,MAAA,QAA0B,SAAA4F,EAAAS,EAAA,CAAC,YACtCyxD,KAAS/1D,UAAE,CAAsB,YAAC,CACtBs/D,CACZtJ,CAAS,CACTO,EACAh3C,eAA2B9d,CAC3B40D,UAAeuI,GACftI,QACEuG,MAMFzG,SACGt/C,CACC7R,GAAM,CAEN4pB,KAAS,CACTq/B,MAAWqR,EAAA,EACFxgE,GAAA,CACTgY,SACEqb,CAAA,CAAa,EAAejN,EAAA,MAAAo6C,GAAA,oBAAO37D,OAC5B,KAACW,EAAiB,CAAOvE,SAAE,kBAAAoyB,CAAA,MAAAy3B,EAAA,SAAM,MAAA7pD,EAAI,CACpC,YAGD,GAGL,GAAC,CACC,EACE,UAAA6D,EAAMS,EAAA,MAAEhH,mBAAc,eACpBC,oBAAU60B,SACXvuB,EAAAgC,EAAA,CACD,YAA2C,QAE3C,EAACusB,EAAA1uB,EAAAC,EAAA,CACD,SAAM,SAAAE,EAAA,KAAE5F,yBAAG,EAAIknB,IACfjS,OAA2C,CAE3C5W,EACA8iB,GAAKpf,qBAAC,mBAA8B,CAAC,MAAAmlB,GAAA,MAAA0G,EAAA,oBACvC,KAAA7V,EAAA,SAAAzY,CAAA,CACC,EACL,CAAEqG,GAEFC,CAAK,EAAMshB,GAAc,SACzB,SAAA2G,CAAA,MAAA+9B,CAAA,EAAO1lD,MAAM,CAAmBP,MAC9BC,EAAA3F,CAEGk0B,WACC,CAEG,EAAsC,CACzC,IACE,EAAI,SACH,CAAAvuB,EAAAS,EAAA,CACD,gBACA,EACR8sB,qBAEWptB,oBACP,SAACH,EAAYgC,EAAA,CACX,GAAI,SACF,OAAMsf,CAA4C,gBAAA2G,CACrBvuB,EAE7B,WAAM,GAAEU,UACRiV,EAA2C,GAE3C5W,GACA8iB,EAAKpf,2CAAC,kCAA8B,QAAC,IAAA0jB,CAAA,IACvC,EACC,GACL,EAEK,CAAM,SAAAu7C,GACXp7D,EAAA,OAAa,KAAAmU,CACX,EAAAlb,GAAAmB,EAAA,OAAAmI,EAAA0lB,WAC4C,MAAA3tB,EAAA,IAAAsgB,EAAI,IAAAC,EAAC,QAAAb,EAC1C,MACD,EAAA2pC,EAGP,CAAAiW,EAAAH,CAAA,EAAAn/D,GAAA,eA/GJF,EAkHGovB,IAENlpB,EAAMnI,EAAA,EACNmC,EAAYi9B,GAAUgqB,IAAA,MACpBp2B,IAAa,EAAAvQ,GAAA,eACXpM,IAAgB,EAAAqM,GAAA,eAKxB,MAJM,EAAA0mC,EAAAoa,GACDpa,EAAAqa,GAEJra,IAAAoa,GAAA5C,EAAA8C,GACDta,IAAAqa,GAAA7C,EAAA+C,EAIN,EACE,OAAMj8D,EAAA,OAAEsU,iBAAMlb,GAAAwH,EAAA,CACd,KAAM,QACJH,KAAOiC,IACPF,cACA/H,MACAsgB,WACAC,oBACUb,GAAM,CAAC,MACf2pC,OACJ,sBAC6B,cACvBoY,MAAe5jE,EAAOopD,CAAA,SAEtBlQ,SACE,SAAUwqB,SAEhB,CACA,EACIta,GACAA,MAASqa,KAAW7C,KAAQ+C,IAAU,GAC1C,SAAO,CACT,QAEA,CACE,CAAKx7D,CAAiBP,EACdW,SAAK,CAAAV,EAAA,UAAQW,MAAK,GACxBd,SAAAG,EAAAgC,EAAA,CACE/B,GAAK+7D,SACL35D,MACOo3D,SAAU,UACPxiE,GACR,SAAM,UAAEqD,WAAOy+D,CAAM,OAAMj4C,EAC3B,GAAAhP,EAAAjK,IAAM05C,WAAoBlpD,CAC1B,OAGI8iE,cAAU,kBACD,SACT,WAAAtzD,CAAA,iBAAAsM,EAAA,QACF,YACF6F,EAAQ,EAAAnS,CACNvN,GAAoC,OACpC6gE,UAAU,KAAAY,EACD,KACT,kBAAA15D,EAEJ,MAAAu3D,GAAA,yBAAE75D,aAEF,MAAAw4D,GAAA,IAAQj+D,GAAM,6CAAEyF,IACd,MAAmB,MAAAwhD,EAErBvhD,UAAA,EAAQqC,gBAAQtC,EAACi8D,EAAA,cAAa,GAC7BlvD,GAAW,QAAAukC,EAAA0nB,EAAAxX,CAAA,SAAE/mD,MAAQ,GAAOsX,UAEzBxX,WAIoB0f,EAAA,CACnBja,QAGI2C,GAAK6+C,CAAI,IAAEj+C,OACdy1D,SAAO,CACR,SAEH,CACM,CAER94D,EACAC,MAAK,CACLmC,cACuC,EACvCuY,CAAyB29C,EACuB,CAE9C,SAAAnrC,GAAMhzB,EAAAX,EAAA,QAAAA,EAAEa,GAAOinD,4BAAM4Z,SAAer6C,OACpC,YAAMi4C,GAEG,GClrBnB,SAAwBkD,IAAe,CACrC,MAAM5lE,EAASyiE,KACT,CAAEvX,QAASlrD,EACjBykE,GACEvZ,EAAO,GAAGA,CAAI,eAAiB,cAC/B,sBACF,EACA,KAAM,CAAE9nD,QAAOC,YAAawB,KACtB,CAAC4uB,EAASoyC,CAAU,EAAI9iE,EAAS,IAAI,EACrC,CAAC4nB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAEhDhB,EAAU,IAAM,CACVmpD,IACD,SAAY,CACXjkC,EAAW,SAAS,EACpB,MAAMwM,EAAU,MAAMrwB,EAAMM,GAAGoiE,cAAcx/D,QAAQ4kD,CAAI,EAAE3mD,QAC3DnC,EAAQma,GACRspD,EAAWpyC,SAAO,CAClBxM,IACC,EACL,CAAAikC,CAAA,GACF,KAAIA,CAEJ,SAAA7kD,EAAQA,gBAAUy/D,YAAev/D,QAAwBu/D,GAAC,KAAAC,KAAA,MAAA7a,CAAA,QACpDiB,WAEN,OAAM6Z,SAEN,wBACOjiE,MAAG,iBAAqBkG,SAAM,KAAiB4R,SAAS,CAAArS,EAAA,OAAIE,gBAC/DihB,IAAA,8BAAK1gB,SAAO,CAAAT,EAAUmhB,MAA8CjhB,SAClEF,GAAA,kBAAAE,KAAKwhD,EAAK,MAAgB,SACvBiB,eACDA,CAAA,QAAAzkD,EAAAzD,CAAA,KAAAyF,QACU8F,GACNpN,aAAQma,SAAatY,GACrBA,UAAgBksD,GAAA,CACZ15C,OAAMuoB,QAAQ/6B,CAAK,UAAG,EAAAg/B,EAAA,aACTktB,cACb5tC,EAAO/S,MAAcuB,IAAS,GAAK,EAE/Bk1D,EAA+BpuD,GAGpCrO,EAAAC,EAAA,CACH,UAAAE,EAAA,MAEA,SACEF,CAAA,CAAAC,SACEC,CAAAD,gBAAKhC,IAAQ,SACb,cAAAzD,CAAA,EAAAuF,EAAA,SAAIS,YAAiBvC,QAAG,UACrB+O,EAAMuoB,KAAQ/6B,CACbyF,SACEC,OAAA,QAAA1F,EAAA,UAAAoJ,EAAAw2D,CAAA,IAAAl6D,EAAA,MAAAD,UACE,gBAAAm6D,GAAA,qBAAAn6D,SACG6Y,CACC,EACEtY,CAGM,EAGLvC,GAAGiC,EAEP,SAAC,SACA1F,EAAA,IAAAksD,GAAAxmD,EAAA,MAENA,SAAA,eAAAwmD,CAAA,QAAAltB,EAAA4gC,CAAA,IAAAl6D,EAAA,MAAAD,MACGzF,IAAMkI,SAAKgkD,OACV0T,GAAA,qBAAAn6D,sBAIc,OAAWm6D,GAAO5/D,cACpBgiE,EACAhjC,CAAA,YAEC,SACL4gC,GACE,eAAO5/D,KAAUg/B,CAAA,+DAEb,KAAAv7B,CAAA,EAAArB,GAAA,KAAAqP,KAAA,KAAAmuD,CAAA,EAAAl6D,EAAA8S,GAAA,CACR,QAAApW,GAAA,KAAAqP,KAAA,KAAAmuD,CAAA,aAEC5/D,EAMY,QACEoC,YACNqP,EAAezR,SAClB4/D,EAAA,IAAAmC,EAAA,uBACAtY,YAAU,CACX,EAED,OAEAzqB,GAAM,SACR+iC,iBAAyB/hE,GACiB,GACjC,GAKTA,GAGL,GACC,OACLA,GAAA,iCAAAyD,CAAA,EAAAiC,EAAA,MAAC,SACI,eAAA1F,CAAA,QAAAg/B,EAAA4gC,CAAA,IAAAr6D,EAAAC,EAAA,CACH,SACExF,QAAU,CAEjByF,SACG6Y,CACC,CAAA7Y,SACEC,CAAAD,SAAKu5B,SACLt5B,OAAAtG,CAAA,MAAAwgE,CAAA,GAAAn6D,SACGzF,KACEwZ,CAAK/R,OAAQrI,GAAQ,KAAMY,GAAKwoC,EAAA,KAAAo3B,CAAA,EAAGn6D,SAEhCyO,SAAQ5R,GAGR+D,iBAAK,IACG,EACQ,GACjB,GACG,GAENX,EAAC,kBAERA,EAAA,SACC,SAEJ,eAAA1F,CAAA,UAAA4/D,CAAA,IAAAr6D,EAAA,MAAAE,UACEC,EAAA,MAAAD,SACG6Y,CACC,CAAA7Y,SACEC,CAAAD,aAAKu5B,wBAAM,SACX4gC,CAAA,EACE55D,CACyC,GAGxChG,EACE,GACH,OACLA,GAAA,SAAAA,EAEE,KAEP,UAAOA,EAAU,OACnBA,GAG6B,IAE5B,GACL,GAEN0F,EAAC,SAAAA,EAAA,KAAC,MAEL,CAEHA,UAAA,QACA,EAAU,SAAEu8D,EAAWzoD,GAAA,CAAS,OAAE/T,WAC/B+T,EAAI,CAAC/R,GAAG,SAAGhC,CACV,KAAqB,EACjB,CCnLd,MAAMksB,GAAQ,GAEd,SAASuwC,IAAY,CACnB,KAAM,CAAExjE,KAAGC,KACX6hE,GAAQ3+D,EAAC,CAAA/B,GAAA,SAAW,EAAG,IAAI,EAC3B,KAAM,CAAEX,QAAOC,YAAawB,KACtBuhE,EAAoBtkE,IAC1B,eAAeukE,EAAeluC,EAAW,CACvC,OAAIA,GAAa,CAACiuC,EAAkBpkE,WAClCokE,EAAkBpkE,QAAUoB,EAAMM,GAAG8/C,UAClC5/C,KAAK,CAAEC,MAAO+xB,GAAO,EACrB5xB,UAEE,MAAMoiE,EAAkBpkE,QAAQkC,MACzC,CAEA,OACEyF,EAAC+xD,GAAQ,CACP1uD,MAAKlH,EAAE,CAAA/B,GAAA,SAAW,EAClBA,GAAG,YACH63D,UAAS91D,EAAE,CAAA/B,GAAA,SAA0C,EACrD83D,UAAS/1D,EAAE,CAAA/B,GAAA,SAA2B,EACtCV,WACA04D,WAAYsK,EACb,CAEL,CCjCA,MAAAC,GAAe,yDCoDTC,GAAiB,OACjBC,GAAa,UAEbC,GAAS,CACb,CAAEx6D,MAAO,CAAAlI,GAAA,UAAkBE,MAAO,CAAE,EACpC,CAAEgI,MAAO,CAAAlI,GAAA,UAAmBE,MAAO,CAAE,EACrC,CAAEgI,MAAO,CAAAlI,GAAA,UAAmBE,MAAO,CAAE,EACrC,CAAEgI,MAAO,CAAAlI,GAAA,UAAmBE,MAAO,CAAE,EACrC,CAAEgI,MAAO,CAAAlI,GAAA,UAAmBE,MAAO,CAAE,EACrC,CAAEgI,MAAO,CAAAlI,GAAA,UAAmBE,MAAO,CAAE,EACrC,CAAEgI,MAAO,CAAAlI,GAAA,UAAmBE,MAAO,CAAE,EACrC,CAAEgI,MAAO,CAAAlI,GAAA,UAAmBE,MAAO,CAAE,EACrC,CAAEgI,MAAO,CAAAlI,GAAA,UAAmBE,MAAO,CAAE,EACrC,CAAEgI,MAAO,CAAAlI,GAAA,UAAoBE,MAAO,EAAG,EACvC,CAAEgI,MAAO,CAAAlI,GAAA,UAAoBE,MAAO,EAAG,EACvC,CAAEgI,MAAO,CAAAlI,GAAA,UAAoBE,MAAO,EAAG,EACvC,CAAEgI,MAAO,CAAAlI,GAAA,UAAsBE,MAAO,EAAG,CAAC,EAGtCyiE,GAAc,CAClBC,SAAU,CAAA5iE,GAAA,UACVuyB,QAAS,CAAAvyB,GAAA,UACT6iE,OAAQ,CAAA7iE,GAAA,UACRwyB,OAAQ,CAAAxyB,GAAA,UACR0+C,aAAc,CAAA1+C,GAAA,UACd8iE,OAAQ,CAAA9iE,GAAA,UACRiqD,SAAU,CAAAjqD,GAAA,SACZ,EACM+iE,GAAe,CACnB,YACA,eACA,kBACA,eAKA,SAAS,EAELC,GAAgB,CAAC,KAAM,SAAS,EAEhCC,GAAM3E,GACT9jD,GACC,IAAI0oD,KAAKC,eAAe3oD,GAAUnW,OAAW,CAC3C8iD,KAAM,UACNwX,MAAO,QACPyE,IAAK,UACLC,KAAM,UACNC,OAAQ,SACV,CAAC,CACL,EAEA,SAASvpC,GAASP,EAAO,CACvB,OAAOA,GAAOx5B,IAAMw5B,GAAO+pC,cAAcvjE,EAC3C,CAEA,SAASwjE,IAAU,CACjB,KAAM,CAAEzpD,SAAMrC,EAAG9Y,KAAGC,KACd4kE,EAAMR,GAAIlpD,EAAKS,MAAM,EAE3BkmD,GAAS,WAAY,UAAU,EAC/B,KAAM,CAAErhE,QAAOC,YAAawB,KACtB,CAACksD,EAAcC,CAAe,EAAIC,KAClCltD,EAAKgtD,EAAavzC,IAAI,IAAI,EAC1B,CAACmN,EAAS1D,CAAU,EAAIlkB,EAAS,OAAO,EACxC,CAAC0kE,EAAcC,CAAe,EAAI3kE,EAAS,EAAK,EAEhDwY,EAAiB0C,GAAQ,IACtB9U,KACN,EAAE,EACCgqB,KAAwB1G,IAAclR,EAEtCosD,EAAmBx6C,GAAS,gCAAgC,EAElE,eAAey6C,EAAU,CAAEC,gBAAgB,CACzCzlE,WACM0lE,EAAa1kE,EAAA,wBACnB,MAAM2kE,EAA4C,GAAaC,GAAAD,EAAA,SAC/DE,EAAMD,OACNC,IACMN,GAAAI,EAAA,SACEJ,iBAAiC3nE,SACnC+nE,EAAWA,QAAa/nE,wBAExB+nE,EAAO,2BAGT,MAAAt0C,EAAA,MAAAu0C,GAAA,OACMv0C,CACN,MAAAxvB,EAAM,EAAEA,EAAM,GAAIwvB,YAClB,SAAmBxvB,GAAAZ,CAAA,EAEjB,IAAA6kE,GAAMhS,GACN,QAAIgS,QAAejkE,GAAA,OAAAuN,KAAA,CACnB,MAAA2+C,GAAalsD,GAAOA,IACZksD,GAAc,WAAAA,GAAA,WACpB,IAAA0X,GAAMM,IAAgC77D,EAAS,CAG7C,MAAM87D,IAFHP,EAAgBM,WAAiBN,aAAc1X,GAAA,aAG3CzoC,MAAiB3jB,QAAMosD,UAC9BA,GAAA,SAAAoW,EAAA,EACA,GAAArY,IAAMA,SACHka,OACDja,SAIFgC,GAAIjC,aACJiC,MAAKkY,MAAYna,SAGjBiC,GAAA,cAAapC,EAAehqD,mBAAY2xD,EAAA,MAAAnyD,EAAA,mBAAAmyD,EAAA,MACxCvF,EAAKmY,SAILR,KACAI,CAGA,IAAAA,GAGF,MAAKA,CACGD,CACR,KAEJ,OAAOA,EAEP,kBAAAp0C,IAAA,WAAAA,GAAA,KAEA,MAAUqvB,QAEV9gD,CACM6lE,SACR,QAAA9vD,GAAA,CACF,GAAAA,GAAA,aAIA2vD,SAAoB3vD,EAAW,KAAAs0B,OAAA,KAAAt0B,EAAA,iBACjBg9C,IAAa,cACvB5rD,WAAsBu+D,GAIpBv+D,CAAwB,GAE5Bu+D,CAAA,CAGF,MAAA1+D,EAAO0+D,SACTS,EAAAzmE,EAAA,EAEM0mE,EAAgB1mE,EAAIiB,EACpBwlE,SAAkBzmE,GAAO,MACzB0mE,EAAiB1mE,GAAO,OAC9B,SAAAmzB,CACA,OAAMwzC,CAA0CxzC,mBAAc4yC,EAAM5yC,EAAAtvB,EAAAsvB,EAAA,KAClEhO,EAAMthB,SAAWA,EACjB,MAAMkiE,SAAe5yC,EAAWtvB,CAChCshB,cACA,GAAkC4gD,iBAAa,GAAC,CAGhD,MAAMa,WAAY,IAAKA,EAAS,CAC5B,GAAAA,EACF,MAASC,GACP5kE,MAAI2kE,UACJt/D,QAAOqqB,EACPmb,MAAOnb,CAAQtvB,GACN0jE,EACFliE,CACR,GAAA+iE,CACD1X,EAAgB,MAAM0X,MAAW,EAAA3mE,MACvB,CACVK,GACF,UACG,MAAAumE,EAAA,MAAA7rC,GAAA,YAAA/4B,CAAA,EAEK4kE,IACJ5kE,EAAI,YAAA2R,EAAAsJ,IAAAtJ,EAAA,UAAAsJ,EAAA,gBACL4pD,EAAYD,EAAA,OACX1hD,EAAM0hD,SAAgB7rC,EAEpB6rC,KACAC,IAAiBx/D,YACjB6d,MAAoBA,EACtB,SACC,EACL,CAAAljB,CAAA,GACE6kE,QAAWC,CAAA,EAAAltD,GAAAgD,KAAA,KACXsI,GAAkB6hD,CAAA,EAAA/lE,EAAA,MACpB,CAAAgmE,EAAAC,CAAA,EAAAjmE,EAAA,IACFhB,EAAO,KAEP,gBAA4B8mE,EAAc,SAAgBlqD,KAC1D,QAAOsqD,iBAAkBH,YAAmB,OAC5C,MAAOC,iBAAcC,KAAe,EAEpCjnE,MAAU,WAAM,GAAAykE,EAAA,MACd,MAAM0C,KAAiBC,QAAIJ,KAAkBK,IAAOA,IAC3C53D,EAAI63D,MAAellE,GAC1BmZ,GAAM5V,QAAM2hE,MAEV,CACA,CACE/rD,IAAMC,GAAexb,EACvB,eACF,CACF,IACEgnE,QAAa,MAAAjsC,GAAA,eAEjB/6B,GAAUunE,EAAM,QACb,MAAAvsC,EAAYC,GAAA,EACPC,EAAAqsC,EAAA,OAAA5hE,OAAA,cAAAq1B,CAAA,MACF,GAAMusC,SAAW,CACbA,OAAiB,MAAAxsC,GAAA,gBAAAG,CAAA,EACnBssC,GAAWvsC,iBAAoB,MAAAtnB,GAAA,OAC/B,IAAMunB,KAA2Bv1B,cACb6hE,GAAA,SAClB,MAAIA,GAAoBzsC,UAAmBG,CAC3CssC,MAGIC,MACAC,SAEJ,QAAAC,GACE,MAAAC,EAAM,EAAE5lE,SAAI6qC,CAAO86B,MAASC,SAAM,QAAAD,GAClC,MAAAC,EAAO,CACL5lE,GACA6qC,EACA86B,MACAC,eACF,KACFH,EAAC,KACDR,mBAAgBY,CAChBd,WAGAS,WAAc,QAAAE,GAAA,IAAA9qD,OAAA,eACd6qD,GAAe,IAEf5T,aAAe,CAAM,EAGjB94B,GAII2sC,MAAe,CAGfrnE,CAAe,MAChB,EAAA4mE,EACL,OAGF,GAAAa,CAAA,GAAA9nE,EACF,KACF4oB,IAAA,SACFk+C,EAAY,CACK,GACjBl+C,IAAA,UACAq+C,UAAkB,EAAA/qD,GAAA,KACpB,IAAG+vC,EAAA,EAAA6Y,EAAA,EAAAtwC,EAAA,EAAAqwC,GAAA,EAAAtwC,EAAA,EAAAmsB,GAAA,EAAAkkB,GAAA,EACL,MAAIkD,MACJ9nE,UAAUuH,MAAMF,EAAA,eACEE,GAAS,4BACvBu/D,IACFv/D,GAAA,qBACEqhB,GAAY,OAEVk8C,IACA7Y,YACF6Y,aAMa,QACftwC,IACEjtB,GAAIA,SAAK++D,UACPra,oBACA1kD,KACFA,GAAA,SAAgBguB,UACduvC,0BACAv9D,KACFA,GAAA,SAAgBoe,gBACd6O,wDACAjtB,gBACS2b,YAET3b,KACFA,GAAA,SAAgBg/D,YAEdh/D,SAAKwgE,GAAW,QAAAxgE,GAClB,iBACO6rD,YACAhI,8BACL4c,GAAA,qBACAzzC,MACAhtB,QACF,gBAAA8vD,GACEuN,eACAr9D,KACF,IAEA,IAAA8S,EACA,EACE9S,GAKM,GAAN8S,GAAMA,GAAA,kBAAEq9C,QAAML,QAAiB/L,aAAiB0c,QAC5C,SAAE3tD,qBAAQq9C,SACdr9C,OAAUzE,EACV,MACEqyD,CAAa,MACHD,YAAQhmE,gCAChB01D,SACQwQ,GACRC,IAAU5gE,SAAY2gE,GACtBE,EAAO/Q,2BACP7iC,GAAQ82B,qBACV4c,GAAA7tD,EAAA,SAAAg9C,GACF6Q,GAAO7tD,EAAA,UAAAixC,GAEH,EAEF2c,CACAA,OAAM5tD,GACN,UAAI4tD,MAAM5tD,GACR4tD,QAAM5tD,CACN4tD,OAAqB3c,GACvB4c,GAAAG,EAAA,IAeJ,GAZFC,GAAA,MAAA30D,GAAAsJ,eAEeA,GAAA,UACftJ,GAAA,UAAmBs0D,OAAO,EACxBK,UAAcrrD,GAAA,UACZ5C,UAAKguD,YACL10D,SAAS00D,GAAI,SACd10D,GAAA,MAAAsJ,GAAA,QACHtJ,GAAA,OAAAsJ,GAAA,UACAqrD,UAAe30D,GAAGsJ,OAAM,EAChBsrD,CACN,EACAD,GAAM9zC,OAAWA,GACjBg0C,EAAMh0C,QAAWA,GAAQ,GAAA/kB,GAAO64D,GAAA,OAAA74D,KAAA,CAChC,KAAM24D,CACFz0D,SACJ,EAAMkxD,GAAS5nD,IACf,GAAM4nD,IAAS5nD,EAAE4nD,CACjByD,GAAOA,GAAA,QAAA74D,EAAA,EACR,MAAA+4D,CAGGF,CACFE,CACQ,MAAED,aACR,OAAAzD,EACEwD,SACA,OAAAzD,GAAM2D,UAEV,aAAA9nB,GACF,SAAAkkB,EAEA,EAAA0D,EACE,IACErc,IACA6Y,eACAtwC,cACAqwC,WACAtwC,qBACAmsB,iBACAkkB,iBAEF0D,IAAQ,CAEZ,GAAIjhE,GAAM,OAEV,MAAOohE,aAAwBC,aAAyB,IAAI1nE,KACtD2nE,IAEClhC,EAAOmhC,yBAAsB,QAE9BF,IAA+B,sBAAW,EAEzCG,EAASC,yBAEhB9oE,EAAgB2oE,EAAA,gBAERA,WAAmBntD,QACrBmtD,IAAY,QAEZD,sBACFK,GAAAJ,EAAA,WAEEK,oBACFF,GAAAH,EAAA,SAEEM,iBAA2B,QAC7BtD,EAAAgD,EAAA,cAEmC,GACnC3mE,CAAA,GACAhC,EAAI2oE,KACFG,qBAA6B,aAC/BpgE,EAAA,CACA,uBAAA+/D,EACE9C,iBACF,OAAAuD,EACF,UAAAC,GACEnnE,UAEJhC,cACE,EACAub,GAAM7S,QAAQ,WAAA+7D,EAAA,IAAAziE,CAAA,GAAA0G,CAAA,IACZ+/D,wBACAW,yBACAF,KACAC,cACAN,eACAnD,mCACF,OAAA2D,KACA9tD,EAAc+tD,cAAqB/hE,EAAIvF,QAEvCA,EAEAymE,oBAEAS,MACAC,QACAN,QACAnD,MAKA,GAEA,MAAI6D,GAAgBliE,GAClB,OAAAmiE,EAAMH,WACJZ,CAGEY,WACFI,GAAiB1vD,SAAU,EAAIxS,GAC/BmiE,GAAgBnsD,EACdhW,OAAKwS,EAAQ/X,aAGjB2nE,GAAApiE,EAAA,0BAAAA,EAAA,SAGDoiE,GAAApiE,EAAA,+BAAAA,EAAA,UAIDgiE,eAEII,GAAIA,EAAapiE,OAAKoe,EAAO3jB,EAAEuF,EAE6B,GAExDoiE,GAAapiE,EAAgBqiE,SAAmCJ,EAClEA,EAAA,OAAAjiE,KAAA,aAAA6hE,GAAA,IAAA7hE,EAAA,qBAAAoM,OAAA,KAAAy1D,CAAA,IAEF,CAAAI,EAAOC,EAAA,mBAAAC,CAAA,EACLC,KAAkBhkD,EAAape,IACjCsiE,GAAA3tD,GAAA,WACF9R,EAAA,GACF,OAAAm/D,GAAC,QAAAhiE,GAAA,CAED6C,EAAIg/D,OACFG,GAKFn/D,CAEA,GAAAm/D,EAAQA,GACNd,MAAwBW,gBAAsBU,EAAA,QAAAn2D,EAAAsJ,IAAA6sD,GAAA7sD,CAAA,EAAA6sD,GAAAn2D,CAAA,IAAAm2D,EAAA,GAE5CD,MAA2B,IAAM,CACrC,MAAMz/D,EAAO,GACbm/D,kBAAuBhiE,GAAS4gB,IAAA,CAC9B/d,EAAW2/D,CAAIxiE,GACjB,CAAC,EACM6C,uCACLm/D,OAAc,WAEZS,SAAmB9tD,UACvB,GAOI+tD,oBACmBC,EAAA,EACvBF,GAAiBh7D,EAAS+6D,CAAU5hD,EAClCgiD,MAAsBC,GACvB,GAAAltD,KAAA,EACD,OAAOqsD,EAID,CACA,GAAAL,IAAMmB,cACN12D,IAAM22D,UACNrtD,IAAMmtD,UACNlB,IAAcoB,WAASF,aACvB,mBAAiBntD,EAAA,eAGnB,GAAAisD,IAAA,WACA,SAAeqB,GAAa52D,CAAA,EACpBgS,EAAUhS,MAChBsJ,OAAIA,KAAYA,SACDutD,OAEfA,EAAAC,GAAA,IAEF,CACE,OAAAtB,KAAMsB,MACAD,UAAwB,KAE5BvtD,EAAOwtD,QAAsB,EAAI,EAEjC,EAAiC,GAAAlB,GACnCL,EAAAC,GAAAN,EAAAmB,EAAA,GACFU,GAAA3qE,EAAA,MACA4qE,GAAkB5qE,EAAO,MACvB6qE,GAAe7qE,EAAMmpE,EAAM,EAAQlpE,EACrC,IAAO,CACLqH,EAAA,OAAe,KAAM6hE,GAAc,SACrCyB,GAAA,UACDp3D,GAAAo3D,GAAA,SACDpB,YAEJ,GAEAqB,GAAMD,WAEN3qE,KAAU2qE,EAAM,GACd,MAAItjE,GAAeA,EAAA,OAAOujE,IAAa3qE,KAAS,KAC5C0qE,MAAkB1qE,IACpBsT,UAA8BtT,KAC5BizB,MAAU3rB,GAAA,CACZ,MAACsjE,EAAAhB,GAAAtiE,EAAA,IACDqjE,gBAAa3qE,CACf,kBAAA4qE,EAAA,2BACExjE,EAAOsjE,GAEX,GAEA,CAAAd,KACMiB,UACJA,KAAkBvjE,MAEhB,CAAAF,GAAM+kD,OAAayd,QAEjBxiE,EAAA,iBAES,KAAA0jE,EAAY3e,MACpB,OAEJ,kBACCyd,WAAiB,IAAAtiE,IAAA,CAEfyjE,QAAoBnB,GAAMtiE,GAAA,IAC1BujE,gBAAuB,CACtBzjE,MAAOjF,YAAeyoE,EAAA,yBAC3B,EAAMI,GAAOC,GACb,EACE,EAAAz7D,CAAA,CACE,EAAW,CAAAo6D,EACRxiE,GACCotD,GAAMrI,EAAayd,MACnB9jC,OACE,CAE2D,GAF3D,CAAA/jC,GAEEkG,IAAO,WAAYkkD,IAAa,SAAyB,CAAA6d,GAC1D,oBAEJtB,EAAAptD,GAAA,mBAAAkpD,EAAA,IAAAziE,CAAA,UACE,oBAAA2mE,EAAA,aAER,MAAAhX,EAAA,gBACCkY,GAAiB,SAEfpV,GAAgB10D,QAAO,SAAI,CAEjCgmC,MAAsB,UACf/jC,SAAM4mB,SACX,EAGA,EAAI+/C,KACF,MAAMhX,kBAA6B,CACjC,CACE8C,UAAsBpuB,MAAS,GAAArmC,EAC7BoS,IAAKu2D,CAAW7W,OAChBzmC,IAAU,YAAAopC,GAAA,qBACZ9tB,EAAC,QACH,CAAA8tB,GAAA,eACF,MAAMkU,EAAAptD,GAAA,mBAAAkpD,EAAA,IAAAziE,CAAA,QAEN2mE,EAAO,aAA4B,kBACrCptD,GAAA,mBAAAkpD,EAAA,IAAAziE,CAAA,GAAA2mE,CAAA,GAGF3oE,EAAgBy0D,GAAA,QACd,OAAA0W,EAAWviD,iBAAY,WAA4B3oB,CAEnD,UACE,GACA,IAAM0oE,CACNA,EAAW7W,6BAA0B7xD,CAAQ6xD,CAC7Cv2C,CAAuD,EACzD,CAAAvZ,EAAA4mB,CAAA,GAEA,MAAAwiD,GAAsB3W,OACtB0W,GAAyDtkC,KAAS,MAAAqgC,GAAA,UAApD5mE,KAA0D,CAAA4mE,EAAAz/B,CAAA,GAExEznC,EAAO,IAAM,CACXmrE,OAAczkC,iBAChB,MAAA2kC,EAAAjC,GAAAkC,GAAAlC,CAAA,EAAAkC,GAAAlC,CAAA,cACMxgD,EAAQugD,KAAA,UAGViC,GAEJ,iBACA,EACF,IAAIlE,MAAkBz/B,CAEtBznC,SAAU,IAMR,KAAMurE,EAEJxxD,CACF,mBACY9V,CACVivB,yBAAU,OAAAg2C,EAAA,UAAAC,GAENplE,WAAE,cAAA0kE,KAAyCS,cAS3BC,KAiBON,kBACF,QAGtBO,GAACkC,GAAAlC,CAAA,GACL,MAAAoC,EAAAb,GAAA,uCAAAvB,CAAA,MACMqC,EAAMd,GAAA,iCACJ9iC,EAAY2jC,GAAA,wBACrBE,EAAA,KAAAD,EAAA,MAAAC,EAAA,MAAAD,EAAA,MAEA7iD,EACA6/C,eACAW,CAOQ,MAAM,UACVA,gBACEkC,iBAEF,GAGMG,MACJd,GACFa,EAAME,gBACNrrE,MAAQma,iBACCixD,mBACCA,QAAeE,EAEJA,CAMnBH,OAAcxlC,GAAe,MAAA4lC,GACpBC,EAAA,EAAA7qE,EAAA,IAAA46D,GACC,yBAAAF,EACRrwC,GAAU,eACZwwC,EAAC,+BAAAD,EAAA,EACHG,EAAW2P,GAAoB,wBAC7BF,QAAcxlC,QAAe,yBAAA41B,EAAA,MAAAC,GACpBE,EAAA,IAAAtH,GAAA,sBAAAsH,EAAA,gBACPlK,GAAQmK,EAAA,QAAAH,CAAA,EACRxwC,EAAU2wC,EAAAC,GAAA,GACZ3L,IACFA,EAAA,QACFA,EAAA,gBACF,eACE8Y,gBAEGwC,SAAUC,QAEjB,CAAMjQ,EAIF,KAAMC,CACN,MAAME,UAA6Bh1C,GAClBrS,EAAMC,sBACP1U,QAOd,EACAm8D,KACAA,GAAc,QACZ9L,GAAS1pC,eAAM,CACf0pC,MAAStqB,UACP1a,OAAO,SACPumC,SAAQ,WAET,CACH,EACF,CACE,OAAMuK,GACJ,eAAMD,GACN,mBAAgB/pD,WAAOvT,EAAA,SAAAA,EAAA,QAAAA,EAAA,WAEzBw9D,GAAID,GAAa,SACfA,QAAYx1C,SAAM,sBAAAg1C,EAAA,EAClBQ,EAAYp2B,GAAe,wBACzB1a,EAAO,WAAAmpC,GAAA,yBAAAmH,EAAA,MAAAC,GACCE,EAAA,IAAAtH,GAAA,sBAAAsH,EAAA,gBACR1wC,GAAU2wC,EAAA,QAAAH,CAAA,MACXpL,EAAAuL,EAAAC,GAAA,GACHxL,IACFA,EAAA,QAEFA,EAAA,gBACEhqD,MAAQ,SACRwB,gBACAvB,iBAAgEJ,CAEpE,EAKI,KAAMu1D,CACN,MAAME,UAA6Bh1C,IACnC,SAAiBrS,EAAMC,sBACP1U,EAGd47D,mBACezpD,GAAMqiD,OAGrB,GACIhE,KACJ2L,GAAc,QACZ3L,GAAS7pC,eAAM,CACf6pC,MAASzqB,UACP1a,OAAO,SACPumC,SAAQ,WAET,CACH,EACF,CACE,OAAMuK,GACJ,eAAMD,GACN,gBAAOA,GAAS/pD,WAAa+pD,WAAiBt9D,EAAA,QAAAA,EAAA,WAEhDitE,GAAI1P,GAAa,QAAA2P,EAAApQ,IAAA,CACfS,UAAYx1C,KAAM,GAClBw1C,KAAYp2B,CAAe,MACzB1a,GAAO0+C,GAAA,QAAAZ,CAAA,EACPvX,IAAQ,IACRxmC,GAAU,GAAAlD,GAAA6hD,GAAA,SACXhB,EAAAgB,GAAA7hD,GAAA,IACHssC,GAAA,kBAGJ9uD,IAAA,KACUwiB,GAAA6hD,GAAA,UAAA7hD,IAAA,IACRlgB,EAAgB+hE,GAAA7hD,GAAA,IAChBzhB,YAA0BE,QAQ1B,MAAMjB,IAAMg2D,MACZqN,EAAoBgB,GAAA,IAClBvV,GAAcuV,iBAEZ,GACEhB,UACAvU,kBAA6B,gBAC/B51D,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,kCACsB,CACtB,GACEmqE,MAAkBgB,WAClBvV,QAA6BA,GAC/B,mBAEJ,kBACEuU,mBAAkBgB,WAAiBnrE,EAAE,SAAAA,EAAA,QAAAA,EAAA,SACrC41D,yBAAuB7tC,EACzB,UACF,EAEEngB,EAAQzC,GAAA,SACRiE,YAAgB,UAChBvB,MACAyqD,iBAA0B,CAE9B,CAEA,GAGI6X,UACAvU,kBACF,gBACA51D,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,SACEoJ,iBAAgB,YAEhBkpD,GAAmBhqD,GAAOtI,GAAA,CAC1B4H,QAAQ,uBAEZulE,EAAAlQ,GAAA,mBAAAA,EAAA,eAKIrH,IAHWzwD,QAEb,aAAMnF,EAAA,iBAAAA,EAAA,mBAAAA,EAAA,uBACmBwnC,CACrBj0B,EAAK,OACLiZ,MACF,CACF,EACA,WACE5kB,EAAQ,OACRwB,QACAvB,WAA0BE,EAC1BuqD,YAEJkL,GAAA,QAAA7sD,EAEAs8D,GAAMG,UACJC,aACA9O,EAAM4O,QACJlQ,CACF,EAKA,GAAIqQ,eAEFrQ,uBACA,cACF,UAAAr0D,EAAA,aACG,0BAEL,SACE,CAAAG,EAAA,gBACQ4H,OAAS,yBACbilD,WAAcx0D,CACTA,SAAUuP,sBACVvP,GAAUuP,mBACTvP,MACCA,SAAUuP,QACjB4tD,CAAOn9D,CAEN,EACHiI,SAAMT,EAAA,OACNqS,MAAS,cAAInS,SAEbF,GAAA,OAAKS,MAAM,cAAyBP,SAClC,CAAAC,EAAA4wD,GAAA,IAAA5vC,IAAA,WAAAhhB,EAAA8T,GAAA,CACExT,GAAU0gB,iBACA/pB,eACJ,SAAUutE,KACZ3X,gBACEriD,KAAK,IACLiZ,MAEJ,CACF,YAEA,CAAW,CAAa1jB,CACtB,CAAKO,MAAM,SAAAN,EAAA8T,GAAA,CAAa/T,OAGdgC,MAAG,eAAWzB,SAAMN,EAAAS,EAAA,CAAcV,YAChCW,KAAK,IAAWC,MAAYxE,CAAE,aAAU,EAAC,EAAC,CAAE,GAC9C6D,EAEPghB,MACM,SAAIA,IAAA,SAAAhhB,EAAAgC,EAAA,CAAI1B,YAAoBP,YACzBW,IAAK,UAAY,EAAOvE,kBAAE,uBAAA/B,IAAA,SAAA4mB,IAAA,WAAAhhB,EAAA,eAAM,eAAC,QAAC,QAAE,KAE7CikE,GAAA,GAEHjkE,EAAAD,SACGihB,IAAY,CACX5mB,GAAA,SAAAuJ,CAAA,EACyB,GAAC,EACnB,GACR9D,EAEHG,OAAA,WAAWqkE,GAAA,cACRrjD,SAAYnhB,EAAWmhB,OACtB,MACE9gB,gBAAK,SACLI,CAAMN,EAAA,iBACGG,EAAM,CACb8jE,YACF,YAAElkE,IAEFC,MAAAgC,GAAA,GAAkB,GACZnC,EAAA,WAEN,UAAAG,EAAA,WACH,SAAAA,EAAAgC,EAAA,CAEP,YAAMwmD,CAAW6b,CAAgBtkE,IAC9BihB,KACM1gB,SAAMN,EAAAgC,EAAA,CAAejC,WACxB,CAAAA,CACE,GAAA3F,EAAA,OAAAuJ,OAAA,MACW3D,OAAe,aACnB,IAAA7D,EAET4D,CACEA,WACE,EAA2B,CACpB,EACTC,EAAA,KAAAD,SACEC,EAAAgC,SAAA,CAAA5H,KAAA,SAKO,QAAAnD,GAAA,CAET+I,SAAA,0BACEyc,EACA/R,SAAM1K,EAAAgC,EAAA,CACN2I,GAAO,SACP/J,CAAGzE,KAAE,GAAA6D,EAAA5F,IAAA,UAAwB4F,EAAAgC,EAAA,CAAC,YAC/B,CACD,GAAAjC,MACEC,CAAA,SACOA,EAAA,gBACK/I,EAAM,CACdA,GAAEoK,QAAiC,EACrC,EAEA,GAAAxB,EAAAzF,MAAA,OAA4B,wBACtB,CAAA4F,EAAA,SACN,IAAA4+D,EAEN5+D,KAAA,QAAAD,QACE3F,IAAA0iE,GAAA,SAA+D,IAAAA,MAAA,gBAEjE98D,KAAA,IAAAD,sBACEA,YACEiC,EAAA,CAAA/K,EAAA,gBAAAmD,IAAAyF,EAAA,cAAqC,CACpC,aAEAS,SAAM,CAAAwR,EAAAgrD,GAAAj9B,EAAA,UAAA7/B,EAAA,SAAAA,EAAA,SAAcD,MACvBC,gBACEC,SAAK2+D,2BAELtkE,CACKwiE,WAAUxiE,CACgBA,EAC1BiJ,GAAA,oBAAAs8B,EAAA,YACL5lC,EAAK,gBACY+mE,CAClB,GAAE,iBAEDt/D,SAAOo7D,GAAA,MACLpyD,QACF,MAAApQ,CAAA,IAAEyF,EAED+R,UAEMxR,QAAqBP,SACzB8/B,CAAwC1jC,UACrC6D,EAAA,eAAA5F,SAAA,QAAe,KAAC,GAChBmJ,KACEu5D,GAASp6D,OAAS,SAAIm9B,CAEtB,IAAAvU,EAEVuU,IAAAi9B,MAAA,iBAAA+B,EAAA,iBAAavzC,EAAA,WAAAg0C,EACIh9D,cAAaw8D,EAC1B,CAAQxkE,WAAcgI,CACvB,MACSw8D,EACZ,CAEE3+D,EACE,WAAY28D,EAAOA,CACjB,WACA,EAIExxC,GAAwBg0C,OACnBz/B,EAAA2jC,GAAA3jE,EAAA,KACLyrB,qBAA6B,SAC/B,CAAAtrB,EAAAS,EAAA,CACAq+D,WAAmB,OAAExzC,QAAS,QAAC,GAE/BwzC,aAAmB,iBAAAQ,EAAAt/D,EAAA,WACrB,wBACFH,EAAA,SAAEE,SAEFC,GAAAgC,QAAA,CAAA5H,KAAA,WAAsB,UACf,WAEVopE,KACC,CAAGljE,MAAMN,EAAAgC,EAAA,CAAcjC,YACfW,OAAK,CAAU,EACrBV,SAAAgC,IAAA,KAAAs9D,CAAA,IAA+C,GAC9C,CAGH,GAAGh/D,KAAMN,EAAA,KAAcD,sBACrB,SAAAA,EACEC,QAAA,UACOA,EAAAgC,EAAA,CACLk0C,WAAM,EACC,EACF2oB,GAAe,CACrB,CAAAO,GACDp9D,QAAAnC,EAAA,aAAAzF,eAAA,SAAAC,GAAA,cAEGwjE,EAAI36D,EAAWR,CAAuB,YAClC,CAAC,CACH,EAAA1C,EAAA,MACN,SAELA,EAAA,IAAAy/D,GAAA5/D,EAAA,MAAGS,SAAM,CAAAT,EAAAiU,GAAA,CAAe/T,GACtBC,eAAAy/D,EAAA,KAAA1/D,UACEiC,IAAA,iBAIO,MAAAhC,EAAA,QACF,SAAAy/D,EAAA,QAAA5B,EAAA,qBAAA4B,EAAA,kBAAAA,EAAA,eAAA5B,EAAA,gBAAA4B,EAAA,UAENL,EACD,CAAK9+D,EAAM,IAAAT,EAAA,QAAcE,SACvB,CAAAC,EAAA,SAAAD,yBACE,SAAAC,EAAAgC,EAAA,CAAyB,YAE3B,QACGo9D,SACC,CACO,CAACr9D,CAAwB,CAAGhC,QAC/BC,SAAK,CAACU,KAAK,SAAY,MACvBV,qBAAAD,iBACMggE,CAUJ1lE,GAJK,QAAA8B,EAET4D,CACSO,GAAM,SACX,CAAAlG,EAAA,CAAAwJ,IACS67D,EAAGx6B,KAGX,CAEHjlC,GAAA,SACO,QACC,EAAAy/D,EAAA,GAEJ,CAAmBtjE,GAAC,MAAAg3B,GAAA,YAAAssC,EAAA,IAAAgF,GAAArqE,YAAA,EAAuBiC,GAAAF,EACvCuoE,CACED,YAActoE,QAChB,EAAAsjE,EAAA,OAAyBrlE,EAAE,EAAC,EAE9B,SAAM+4B,EAAG6rC,EAAQ2F,CACjBF,KAAIxkC,IACJ5jC,MAASF,CAAC,GAAA/B,QAAA,EAAgBA,EAAE,GAAS,GACrC8kE,QAAe,GAAAE,EACjB,WAAAp/D,EAAA,cACFA,EAAA,kBAAED,IAEDU,CAAI,GAACC,QAAK,EAAOvE,KAAE,MAAA6kB,IAAQ,WAAAnhB,EAAA,sCAAC,SAAC,CAAEG,EAAA8jB,GAAA,QACzB,KAAA9jB,EACJ,WAtCAy/D,gBAwCT,SAEHL,IAAa5kE,CACZuF,WACE,EACE,GAAAC,EAAA5F,IAAA,OAGO,yBACF4F,EAAAgC,EAAA,CAEV,YAEJ,EACE,CAENgf,CACC,GAAK1gB,IAAM,WAAAT,EAAAC,EAAA,CAAwBC,SAAA,CACjCC,EAAC8jB,MAAM,CAAC9B,uBAAQ,SAChB,CAAAviB,EAAA,UAAAO,EAAA,KAAGM,SAAMN,EAAA,KAAeD,WACtB3F,SAAAyjE,EAAA,qBAAAp+D,EAAA,uBAAAA,IAAA,sBAA6B,EAC5B,EACHO,EAAA,SAAGM,SAAM,CAAAN,EAAA,UAAeD,WACtB,QAAAyhE,GAAAF,IAAA,aAAAC,KAAA,MAAAnnE,KAAA,SAAsC,qBACpC,aAGP4mB,EACClhB,OAAAC,EACE,MAAKO,EAAM,gBACF9F,MACLuF,GACE,MAAGO,EAAUP,SACV89D,EAAI+G,GAIJ,YAGP/kE,CAAA,CAAAE,MACEC,OAAA,GAAAH,EAAA,UACEtH,cAMA2H,MAAK,cACLI,QAAM,IAAAy9D,EAAA,CAAAD,CAAA,EACN39D,SAASA,GAAM6B,EAAA,CACb8+D,WACAM,WAAkB,CAClBC,oBACAH,OACAC,UAAarD,EAAK,gCACpB,CAAE/9D,EAEF,MAA2B,GAACC,EAE7BqgE,MAAO7lE,CACN,MACE0F,gCAAK,OACLI,GAAM,SACNH,EAASA,MAAM49D,CAA6B,MAAEh+D,yBAE9C,SAAAC,EAAA,aAAyB,8BACpB,SACEqgE,GAAA,IAAAI,GAAA,CACL/+D,MACEmjE,OAGF,OAAAlE,EACA,QAAAJ,GAEL,MAAAC,EACK,OAAA5zC,EAAA,EAEV6zC,EAAW,CAAwC,SAAArhC,GAAcr/B,SAC1DO,eAA8BP,OAC5BO,SAAmCP,oBAEpC,SAAA6vD,GAAQE,SAAM6Q,UAAQJ,gBAASC,EAAO5zC,UAAO,IAAI6zC,GACjD,GAAArhC,GAAM,CACJA,gBACA/7B,UACAu9B,wBACAnuB,OACA6hB,OACAwwC,QACAlV,gBACAllD,eACAC,mBACAo6D,UACEjV,wCACJ,uBAA4B,QAAApvB,GAAA,iBAC5B,EAAIA,GACJ,SAAItB,EAAU,WACZ,SAAMC,aACN,SAAM2lC,SACNtkC,OAKF,IAAAokC,YAKUryD,UACNpR,QAAO,OACH,EACJf,IAAM,aAEJogC,eAEM,UAAA7gC,EAAkB,SAAO6gC,CAGzB,UAAA7gC,EAAA,MAAwB,CAIzB,qBACNE,SAED,CAAAC,EAAA,QAAAD,MACEC,SAAAD,SACE40C,EAAA,CACEl4B,EAAK6X,eACL1zB,SAAKkkE,KACLp6D,aACAC,eACAogB,SAAQg6C,GACT,eAEHllE,CAAA,CAAKS,EAAM,CAAcP,QACvBC,EAAA,MAAAD,cACOO,QAAoBP,WACvB,MAAAsD,GAAY,SAAQtD,EAAE40C,EAAM,CACV,KAAA50C,IAAEC,EAAA,WAClB,cACA,KAAAD,GACe,WACDglE,MACV7hE,GAAO,SACR09B,EAAA,GAAC5gC,EAEL,SAAAA,EAAA,WAEAqD,CAEC/C,WAAM,UACAsvD,SACF5vD,EAAAgC,EAAA,CACJqB,YAAatD,QAIhB,EAAAwgE,GAAA,IAAAz9B,IAAA,CAEAlC,MAEO,aAAAluB,GACAk9C,gBACF9sB,GACJz/B,OAAOu9B,YAAY7gC,KAElB6gC,SAGL,MAAK,QAEI,OACLxZ,QAAY,GACZrnB,QAEFiC,IAAA,CAAA/K,GAAA,iBAAAA,GAAA,kBAEGspE,KAAQ/9D,CACD,GAAAwjD,EAAA,EAAEtzC,GAAc8O,MAAgBshB,QACtC,EAEI5iC,SAAKF,EAAAwS,GAAA,CACLlS,IAAMoS,GACNhR,KAAO,IACLqV,MAAS,CACX,GAEE9f,EACAA,CAEA,EAAM,GAAEmD,GACRgnE,EACAN,KAA+B,EACjC,EAEO,EACApuD,iBACL/R,KAAK,KAAAX,EAAA,0CACAwhB,WACN,GAAAxhB,EAAA,OACK,8BAEX,SAAAilE,EAAC,IAAAxlE,EAAA,QACG,GAAAI,EAAA,+BACL,UACDA,EAAC,eACC,sBACR,CAAAG,EAAA,SAEP,KAAC,QACE,kBACF,QAAA6gE,EAAA,sBAENphE,SAAMjF,KAEE8F,EAAM,MAA4BP,CAAEqjE,CAEzCpjE,IAAAgC,EAAA,CAAK1B,GAAM,SAAuBP,MAAEklE,UAEvCxlE,MAAMjF,QACA8F,SAAMb,EAAA,OAAiBM,EAC1B,GAAOO,OAAM,QAAAy8D,EAAA,QAAAh/D,EAAAuE,CAAA,MAAA4iE,EAAAnnE,CAAA,GAAA8B,EAAA,SAAYE,mBACvB,OACOmlE,EAAAnnE,CAAA,EAAA0B,EAAA,oCACA,CAAAO,EAAA,SACLwb,aACA/F,kBACEqrD,UAA0B,gBAAK/iE,EAAA,cACjC,cAEFiC,EAAAjC,CAAA,EAAAA,IAAA,WAAkBsjE,EAAC,gBAAM/gE,GAAM,WAASb,IAAMjF,EAE/Coe,CAGK,CACEtY,KAAM,MAAAN,EAAA,QAENqD,cAICtD,SAEDC,EAAAjC,CAAA,GACEmC,CAAK,EAAA4R,EACLqD,CAAK,OAAA1V,EACL+b,QACEqlD,SAAuB7iE,QACvBD,CAAgB,wCAGhB+iE,OACA,SAAI/iE,IAAkB,IAAAonE,GAAAtlE,EAAA,SACpBwhE,sBACAF,gBACAD,oBAAe,MACjB,QAEF,qBACD,QACOM,IACR2D,EAAM7kE,SAAM,KAAOP,GAAkB,CAAS,EAzBzC+R,QA4BZ,KAGEtX,IAAiB0nE,GAEdd,EAAA,MAIJ,CACE9gE,IAAMkS,GAAA,CACN,IAAAkxD,GAAayB,8BAAOplE,WAMlBG,OAAKwjE,GAAAyB,CAAA,mBAAAzB,GAAAyB,CAAA,YACLhwD,IAAKnV,EAAA,QACLwb,cACA/F,SAAUA,GAAM0vD,CAAA,CACd/D,aAEF,iBACAjhE,SAASA,GAAMglE,CAAA,UACb,GACE/D,aAAkB+D,CAAI,MAAA/C,GAAA,UAAApiE,EAAA,eACxB,CACF,oBACD,cACM,MACLyS,QACEixD,GAAgDjiD,EAE7C,SACGiiD,IAAQyB,CACjB,GAAE,SACG7kE,OAAM,CAAOP,WAAqB,CACxC,EAAY,iBAAY2jE,EAAgB5jD,GAAQrgB,EAAQ,WAAAI,EAAA,aA1BhDslE,kBA8BV,SAES,CAAAnlE,EACLonB,QACAg+C,qBACAn2B,SAASjvC,EAAAgC,EAAA,CACX,YAAEjC,CAEF,OAAAC,aACSoiE,CAAuB,0BAG/B,SAAAjF,GAAA,IAAAp/D,GAAA8B,EAAA,6BAKRJ,QAAMjF,GAAU,CACJ8mE,IAAAvjE,uBACT9G,EAAA,kBAAMqJ,GAAMihE,KAAA,oBACVnnE,EAAkB,UAAA4F,EAAA,SACd,aAAE,uBACR,QAAAshE,IAAAvjE,EAAUuC,SAAM,KAAmBP,EAChCo9D,GAEG78D,MAAMgV,EAAA,2CAAAvX,CAAA,kBAEUuX,CAAA,CACd,CACEre,IACAA,UAAE04B,EAEJ,CACF,YAEA,EAEExa,aAAKhZ,GAGHklE,WACA,CAIAF,EACF,gBAAAhlE,EAIEwG,CAASxG,YAAE,eAAMA,EACjBmzD,CAAYnzD,YAAE,cAASA,EACvBszD,CAAetzD,YAAE,UAAOA,EACxBunD,CAAYvnD,YAAE,GAAA4B,CAAQ,EAAAujE,IAAAvjE,IAAAwjE,KAAA,mBAAAxjE,CAAC,KACZ5B,gBAAE,wBAAA/B,EAAA4H,EAAA,IAAQ,gBAAC,GACf7F,iBAAE,oCAASihE,GAAA,IAAAr/D,GAAA8B,EAAA,eAAC,eACrB,SAEDyhE,iBAEJ,QACO,oBAgBV,QAAAL,IAAAljE,EAAMuC,SAAM,KAAcP,GACxBiC,EAAU5H,EAA2B,SAAA2D,IAAA,WAAAyjE,CAAA,CACjC,GAAE,QAAArlE,EACEmE,CAAyBP,GAChCq9D,QACC,CAAa,CACX,EACEl9D,IAAK/D,EAELqf,YAEE0lD,CAAc,EAChB,EAAAnjE,GACAsE,QAA+Bm/D,GAEhCA,GACQrlE,4CAAE,uBAAA/B,IAAA,CAAAgnE,EAAS,OAAC,MAChB,CAACjlE,qBAAI,SAAA6D,EAAAgC,EAAA,IAAM,UAAC,GAZcjE,IAuB/B,CACO,GAAAiC,EACLonB,MAAY,MACd,+BAAAy5C,GAAA,MAAAS,EAAA,gBAAAA,CAAA,SAAAE,GAAAkC,GAAAlC,CAAA,kCAAAP,EAAA,iBAAAA,CAAA,iBAAElhE,GAEF,KAAAJ,EAAAkI,IAAA,OAAAzN,EAAAuF,EAAA,YAAAA,EAAA,OAA8B0lE,GAAA,GAAC,OACzBpE,IACN,YAAA6B,GAAA,SAAAnjE,EAAA,aAAAmjE,GAAA,SAAAj7D,EAAA,IAAAw9D,GAAA,IAAAvC,GAAA,QAAAnjE,EAAA,YAAAE,EAAAk2C,EAAA,WAAAsvB,IAAArlE,EAAA,MAOJ,kBAINA,IAAAslE,GAAA,CACEhlE,kBAMgDP,OAG9C,KAAM3F,GAAU2jB,OAChB,EAAIsnD,CACJ,aAAgBA,EAAW,GACzB,EAKEA,eAAgB,SAClB1D,GAAA,UAAA9hE,EAAA,KACAijE,UAAiC1oE,EAAjC0oE,IAAiC1oE,SAEnC,CACW2F,WACW,EAEQ,CAExBkF,WAAoB5M,CAJM,EADf,IAAGsH,EAAO,UAS5B,cAEHK,MAAA,UAAAD,QACG4hE,KACC5hE,GACG8gE,kBAA2B,CAAQ1kE,EAChC,SAAA6D,EAAAgC,EAAA,CAAA5H,GAAA,SAAoC,EAAC,EAAA+B,SACrC,MAAa,GAAA6nE,IAAGhkE,EACpBA,GAAA,aACEE,GAAK,aACLI,QAAM,eAEJusD,wBAAkC,SACpC,CAAA7sD,EAAA,eAAED,SAEF,4BAAyB,IAAAkkE,GAAA,aAClBjkE,EAEXS,EAAA,MAAG,IAEE,IAAAtE,EAGR,CAER6nE,GACChkE,QAAM,CAAiC,CACrC,CAAKM,CAAM,CAAQlG,EAAG4F,EAAA,UAAoBD,SACxCC,EAAA,MACEE,SAAKF,EAAAgC,EAAA,CACL1B,GAAM,SACNH,CAAgC,CAAEJ,CAE7B,GAACW,SAAK,UAAOvE,0BAAE,SAAA6D,EAAAgC,EAAA,CAAA5H,GAAA,SAAO,EAAC,EAAA4F,EAAA,MAAG,SAAAA,EAAAgC,EAAA,CAEjChC,GAAA,SAAAD,CACE,CAAAA,SACEiC,CAAA5H,SAAA4F,EAAAgC,EAAA,CAAkB,YAChB,EAENhC,IAAA,MAAAD,WACEiC,EAAA,CAAAjC,WACE,CAAAA,CACE,GAAA3F,EAAA,eAAuB4F,EAAAgC,EAAA,CAEzBhC,WAAA,CAAAD,CACE,GAAA3F,EAAA,eAGO4F,EAAAgC,EAAA,CAEThC,WAAA,CAAAD,CACE,GAAA3F,EAAA,eAA2B4F,EAAAgC,EAAA,CAE7BhC,WAAA,CAAAD,CACE,GAAA3F,EAAA,eAIO4F,EAAA,SAETA,SAAAH,EAAA,SAAAE,UACEiC,OAAA,WAAAhC,EAAA,MAA4B,SAAAA,EAAAgC,EAAA,CAE9B,YAAAjC,CACE,GAAAC,EAAA,MAGO,SAAAA,EAAA,OAET,aAAAD,CACE,IAAgC,EAAAF,EAAA,MAoBlCG,SAAA,CAAAA,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAAjC,WACE,CAAAA,CACE,CAAAA,SACEC,CAAAD,SACEC,EAAAgC,OAAA5H,SAAA,IAAuB,EACrB,EACJ,GAAA2F,QACE,SAAAA,GAAK,MAAC,SAAKC,EAAAgC,EAAA,CACR,YAEPnC,CAAA,CAAAE,SACEC,CAAAD,SACEC,EAAAgC,OAAA5H,SAAA,IAA2B,EACzB,EACJ,GAAA2F,QACE,SAAAA,GAAK,MAAC,SAAKC,EAAAgC,EAAA,CACR,YAEPnC,CAAA,CAAAE,SACEC,CAAAD,SACEC,EAAAgC,OAAA5H,SAAA,IAAyB,EACvB,EACJ,GAAA2F,QACE,SAAAA,GAAK,MAAC,SAAKC,EAAAgC,EAAA,CACR,YAEPnC,CAAA,CAAAE,SACEC,CAAAD,SACEC,EAAAgC,OAAA5H,SAAA,QAA6B,EAC3B,EACJ,GAAA2F,QACE,SAAAA,GAAK,MAAC,SAAKC,EAAAgC,EAAA,CACR,YAEPnC,CAAA,CAAAE,SACEC,CAAAD,SACEC,EAAAgC,OAAA5H,SAAA,IAA+B,EAC7B,EACJ,GACE,EAAK,EAAU,GACZ,EAEP,GACE,EACE,KAA2B,CAE7B,MAAAmrE,GAAAzsE,GAAAiH,UACE,KAAAJ,CAAK,GAAM,MACR,GAAAvF,EACF,QAAA+X,EACA,MAAAwb,EACF,OAAA5P,EACJ,MAAA6V,EACH,YAAA43B,EACC,mBAAAhI,EACH,cAETgiB,EACE,UAAAjhB,EAET,WAAAoL,EAEA,WAAAqS,CACY,EAAEriE,EAAQ8lE,EAAAja,GAAAhI,IAAArxC,EAAA,GACZ8wD,EAAA,EAAA1e,MAAA,gBACJnqD,MACA+X,YACAwb,OACA5P,aACA6V,iJACA43B,eACAhI,oBACAmb,oBACAD,SAAWna,YACXoL,2BACAqS,gBACEriE,6BACE8lE,SAAYja,KAClB,CAAMhH,KAAeD,cAA0BlgD,OAAWrE,EAAAwS,GAAA,qBAEhC6C,EAAA,OAClB3W,SAAU2W,EAAA,GACd5c,IAAQma,GAAI,IAAA5S,EAAAS,EAAA,CACV,KAAGd,SACJ,MAAAK,EAAA8S,GAAA,CACH,QAAAiL,EAAA,QACF,aAEA,CACEle,EAAA,CACES,EAAO6zB,GAAAP,CACLjG,IACI,OACA5P,CAUN2nD,0BAAyB3lE,SAEzBC,GAAAwS,GAAA,CAAMlS,IAAM6R,EAAA,cAAAA,EAAA,OAAapS,SACtBge,EACCle,GAAA,CAAMS,MAAMN,EAAAS,EAAA,CAAoBV,YACvB,GACL0S,IAAKN,KAAQO,CACb8+C,UAAUr/C,cAAQsb,mBACnB,WACAu0C,EAEY,EAACvvD,CAAyBgP,QAAoBgM,CAAI,QAAAtb,EAG1D,WAAM,IAKF,GAAAnS,KAAU+d,CAAO5L,KAAS4xC,GAAUpkD,EAAA,WAAA4kD,CAAG,GAC5C1kD,EACJs0B,OAASP,CACX,MAAMtzB,YAAM,SAAmBP,GAC7BC,GAAO,MACLyS,GAAaC,CAAwB+O,GACrC+vC,MAAUr/C,GAAQsb,CAAI,SAExBztB,IAACS,QAAI,WAAAd,EAAA,kBAAM,SAAO,CACT,GACuCwS,EACpC,GAAAozC,EACVC,IACED,GAELzyC,WAAQ0yC,GAAA,UAACrzC,GAA4B,OAAAlN,EAAE,GAAAlD,EAGnC,GAAA4hD,CAAiBhkD,IAAM4kD,OAChC1kD,EAAA1H,EAAA,EAAMmI,GAAMqlE,CAAA,EAAAvsE,EAAA,IAAAhB,SAAW2H,IACrBC,CAAU,QAAO+d,IAAUpe,yBAC1BqD,sBAECE,eAAO,IAAAyiE,EAAA,KACP9+D,EAAA,UAAA5G,EAAA,SAEG,UAIX,WAAOslD,GAAU5lD,KAAMvF,QAAOorD,OAAU7lD,OAAMvF,QAChD,CACF,EAEA,4BAAkC6F,EAAA,SAAEgF,KAAMlD,iCAAI,CAAS,IAAM,IAC/C5J,EAAO,MACnB,SAAOytE,EAAMD,GAAO,CACpBvtE,KACE,SAAMyO,EAAW0+D,GAAIM,CAEjB,GAAAliB,CACA,EACEsI,EACAplD,UAASi/D,CAAqB,IAAA7lE,EAElC,MACA,CACEgF,aACkD,EAGtD,EACA8gE,GAAa,EACXC,GAAQ3tE,EAAuC,SACjDsqE,GAAAhjE,EAAA,CACF,KAAK,CAEL,YAAAq0B,EACEj0B,UACO,KAAAuH,EAACvF,mBACK,KAAA+tD,CAAKnM,EAAKhkD,EACfsmE,EAAA3+D,GAAA,gBAAAA,EAAA,gBAAAga,EAAA8hB,IAAA9hB,EAAA8hB,EAAA,aAGR,OAAApP,EAAA,OAAAkyC,GAAA3lC,CAAA,EAAA0lC,EAAA,aAAAxjD,GAAA,OAAAsjD,GAAAtjD,EAAA,OAAAqtC,GAAA,MAAAkW,GAAA,EAAI/lE,CAAiB,MAAE0K,GAAQ,YAAMw7D,GAAA,CAAE,KAAAxmE,EAE3C,WAAA4kD,CAGA,GACA,KAAMyhB,CACN,EAAA/oD,CACE,EAAAhkB,GAAM,KAAE+6B,CAAauM,cAASj5B,YAAMmb,UAAkBqtC,SAAK,KAAAxoD,EAC3D,iBAAAmb,EAGA,KAAAqtC,EAQA,YAAAtE,EACF,mBAAAhI,EAEA,QAAArxC,EAEA,QAAAi0D,EAAoBzmE,SAAM4kD,EAAW,MAAG8hB,EAAA7a,GAAAhI,IAAArxC,EAAA,MAAAi0D,EACtC,IAAAE,EAAMhrD,GAAA,GAAA6Y,GAAAP,CAAA,EAAAA,EAAA,cAAAA,EAAA,MAAE56B,wCAAGC,WAAAy0B,EAAA,QAAA44C,EAAA,QACP,CAAA7jD,GAAA,QAAA6jD,GAAA,2BACFtyC,sBAEAuM,MACA7S,IADA6S,KACA7S,2BACApmB,gCACAmb,aACAqtC,eACAtE,SACAhI,kBACArxC,aACAi0D,oBACAxyC,0BACEj0B,sBACE0mE,UACH7a,UACC8a,MACFhrD,iCAGEgrD,SAAUtyC,QACd,OACA,CAAKvR,KAAkBjoB,GAAU8rE,kBAA4B9rE,OAAQ,CACnEioB,2BACF,SAAA8hC,GAAA,UAAAtnC,EAGMspD,aAKAC,OAAWjmC,CAEXkmC,IAAmBzyC,SAEzB,CACE,CAAW,EAAoBA,EACvB1zB,IAAyB,QAE3B,CACE,CAAY,GAAgCP,IAAC,CAAM,SAAW,GAAAi0B,GAAAn0B,EAAA,QAGjE,0BACOS,SAAM,CAAAN,EAAAS,EAAA,CAAoBV,KAE7BwkD,KAAqBtnC,oCAClBwpD,GAAA5mE,EAAA,wCAAAwmE,GAAAxmE,EAAAC,EAAA,UAAcykD,GAAW+T,QAAS,uCAAC,SAAAt4D,EAAAgC,EAAA,CAACib,cACpC,SAAA7iB,EAAAmmC,GAAAvgC,EAAA,OAAU,yBAAC,OAAA0mE,GAAAnmC,EAAA7S,CAAA,GAAA44C,GAAA,+CAAAA,EAAA,2BAGjB,QACKtyC,mBACD,YAAA2yC,GAAA9mE,EAAA,OAAMS,SAAM,CAAAgH,EAAA,sBAAAq/D,EAAA,OAAmB5mE,OAC5BU,GAAI,YAAAgiB,EAAA,gBAAA5iB,EAAAC,EAAA,CACHY,SAAS6lE,WACR,MACFvyC,8BAGJyyC,cACC,CAAKnmE,MAAMN,EAAA,OAAgBD,SACxBsmE,EACCvmE,cAAA,CAAAC,EACE,GAAY,GACV,QAAAwkD,GAAoBA,GAAA,kBAAA1kD,EAAA,cAChB,yBAAK,SAGZ0gC,MACDvgC,EAAA,cACEkxB,+BAAyB,SACvBE,GACEs1C,GAGI,KACR,OAAE,KAGHp/D,GAEC,GAAAvH,IACGuH,CAAoC,GAExC,QAIC,GACE,GAAAmb,GAAY,OAAAA,EAAA,IAAAhI,GAAA,OAA6B1a,EAAC0a,EAAA,YAAAA,EAAA,IAASmsD,EACnDnsD,EAAA,kBAAAA,EAAA,UAAA1a,IAAM0iB,eAAiBhI,EAAC,KAAEmmB,6DAAkBj2B,EAAA8P,EAAA,eAAAA,EAAA,qBAAAA,EAAA,qBAAAA,EAAA,8BAE/Cza,EAAA,QAEN,wBAEJ,UAEAukD,cAAqCsiB,IACtC,OAAY,IAAAC,QACPx/D,GACKhH,OAAMymE,GAA8BhnE,IACxCC,cAAMU,QAAK,OAAOC,QAAK1J,GAAA,CACvB+I,KAAAgC,CAAA,IAAAya,CAAA,EAAmBxlB,EAAA,cAInBwrB,OAA4BmkD,IACpBE,SAAaE,MAEbt8D,EAGAC,yBAIJ,8BAAAD,EAAAC,CAAA,iBAAuB,CAAiB5K,IACrC,QACCu0B,MACGwyC,uBAEGrqD,SAAKqqD,OACEC,MACPp8D,GAAQo8D,eACRnmE,IAAK6Z,EACLsQ,SACA6E,UACE,IAAAnV,EAAA,YAAM,QAAEgC,eAAUpb,IAClB,KACEob,CAIAxlB,KAAe2vE,EACjB3vE,EAAA,OACFwlB,IAAAqqD,GAAAF,GAAAE,IAAAF,IACAllE,SAAO,IAAAklE,EAKP,EACD,EAED5mE,EAAA,QAAMM,MAAM,uBAAsBP,SAAC,MAAQ,EAE/CknE,OACGH,GAAYF,IAAmBC,IAC9B,OACEpqD,IAAKqqD,EACLp8D,MAAOq8D,GACPp8D,OAAQo8D,GACRnmE,IAAK6Z,EAAEmmB,YACP7V,QAAQ,OACR6E,QAAU34B,GAAM,CACd,KAAM,CAAEwlB,OAAQxlB,EAAEoK,OAEhBob,IAAQqqD,GACRF,GACAE,IAAaF,IAEb3vE,EAAEoK,OAAOob,IAAMmqD,EAEnB,EACD,EAED5mE,EAAA,QAAMM,MAAM,uBAAsBP,SAAC,KAAS,EAEhDwwC,QACGu2B,OAAYF,CAETnqD,MAAKqqD,uBACLp8D,SAAOq8D,MACCA,IACRnmE,OAAOggC,UACP7V,CAAQ,KAAA+kC,KACE74D,OAAM4vE,GAAA7mE,EAAA,QACd,6CAAM8vD,EAAA,oBAAErzC,uBAAQxlB,MAChB,MAAA8vE,GAKE9vE,UAAe2vE,MACjB,OAAA9W,EAAA,aAAAA,EAAA,yBACF,aAGF9vD,CAAA,kBAAY8vD,EAAA,OAAAA,EAAA,sCAAAA,EAAA,MAAAA,EAAA,uBAAuB,GAAQ9vD,EAAA,cAE/CknE,uBAAO,SAAM5mE,IAAM,EAAuB,GAAQ,GACvC,EACT,CAMR,SACEA,GAAO,CACU,KAAAX,CAIf,GACY20B,MACHyyC,GACCA,KAENjX,EAAuCgV,CAEjC,aAAAphB,EACD,aAAA4L,EAUF,gBAAAG,EACL,YAAA0X,CAGF,EAAAxnE,EAAY,OAAAE,EAAsBE,OAAC,OAAQ,sBAGhD,CAAAuvD,EAAA,GAAAzvD,EAAA,QAER,0BACE,UAAAG,EAAAS,EAAA,CAET,gBAEA,KAAS2mE,IAAYznE,MACb,CAAE3G,YACR,CAAM,CAAE0qD,aAAc4L,iBAAcG,wBAAiB0X,eAAgBxnE,aACrE,SACQW,IAAM23D,EAEF33D,CAAyBP,GAAA,QACxB,CAAM,CAAgB,GAAIa,IAAGq3D,kCAAE,6BAAAj4D,EAAAS,EAAA,MAAS,SAAC,SAAG,IAAEw3D,EAK/C33D,CAAuBP,GAAA,QACtB,CAAM,CAAa,GAAIa,IAAGq3D,4EAAE,UAAAqL,GAAOn2D,EAAApP,EAAAspE,EAAA,OAACC,EAAAn6D,EAAA,IAAAq5C,GAAA,SAAAA,EAAAzoD,CAAA,IAAGwpE,EAC3Cz1C,gBAA8B2F,EAAAnW,EAAAmW,EAAAnW,EAAAgmD,EAAA,IAGlC5jB,WAAoByjB,OACnBtnE,EAAAyhB,EAAAmW,EAAAnW,EAAAgmD,EAAA,IAAMhnE,EAAM,SAAAknE,EAAA,sBAAAD,EAAA,UAAkBxnE,QAC5BC,KAACS,CAAI,OAACC,CAAK,MAASC,IAAK,OAAAwM,EAAA,QAAO8qD,kCAAE,WAAAoL,IAAA,eAAA7c,CAAA,MAAQ,OAACihB,GAAAtkE,EAAAokE,EAAA,WAAA1nC,EAAK6nC,EAC/ChkB,WAAe+jB,GAAKN,EACdzjB,MAKPgkB,CAAI,OAAAlhB,CAAA,CACJ,CAEV,GAES8c,CAEP,CC7rEF,MAAMr3C,GAAQ,GAEd,SAAS07C,IAAa,CACpB,KAAM,CAAE3uE,KAAGC,KACX6hE,GAAQ3+D,EAAC,CAAA/B,GAAA,SAAO,EAAG,aAAa,EAChC,KAAM,CAAEX,QAAOC,YAAawB,KACtB0sE,EAAqBzvE,IAC3B,eAAe0vE,EAAgBr5C,EAAW,CACxC,OAAIA,GAAa,CAACo5C,EAAmBvvE,WACnCuvE,EAAmBvvE,QAAUoB,EAAMM,GAAG+/C,WACnC7/C,KAAK,CAAEC,MAAO+xB,GAAO,EACrB5xB,UAEE,MAAMutE,EAAmBvvE,QAAQkC,MAC1C,CAEA,OACEyF,EAAC+xD,GAAQ,CACP1uD,MAAKlH,EAAE,CAAA/B,GAAA,SAAO,EACdA,GAAG,aACH63D,UAAS91D,EAAE,CAAA/B,GAAA,SAAkC,EAC7C83D,UAAS/1D,EAAE,CAAA/B,GAAA,SAAuB,EAClCV,WACA04D,WAAYyV,EACb,CAEL,CCdA,MAAMjL,GAAiB,CAAC,OAAQ,SAAU,gBAAiB,SAAU,SAAS,EACxEkL,GAA+B,CAAC,SAAU,SAAS,EACnDC,GAAwB,CAC5BC,KAAM,CAAA5tE,GAAA,UACNJ,cAAe,CAAAI,GAAA,UACfw/C,OAAQ,CAAAx/C,GAAA,UACR6tE,OAAQ,CAAA7tE,GAAA,UACR+X,QAAS,CAAA/X,GAAA,SACX,EAEM8tE,GAAmB,CACvB,EACA,KACA,KACA,IAAS,GACT,IAAU,GACV,KAAU,GACV,KAAU,GAAK,EACf,KAAU,GAAK,EAAI,EAGfC,GAA0B,CAC9B,EAAG,CAAA/tE,GAAA,UACH,KAAMqtB,GAAa,GAAI,QAAQ,EAC/B,KAAMA,GAAa,EAAG,MAAM,EAC5B,MAAOA,GAAa,EAAG,MAAM,EAC7B,MAAOA,GAAa,GAAI,MAAM,EAC9B,MAAQA,GAAa,GAAI,MAAM,EAC/B,OAASA,GAAa,EAAG,KAAK,EAC9B,OAAWA,GAAa,GAAI,KAAK,CACnC,EAEA,SAAS2gD,IAAU,CACjB,KAAM,CAAEpvE,KAAGC,KACL,CAAEQ,SAAUyB,KAClB4/D,GAAQ3+D,EAAC,CAAA/B,GAAA,SAAS,EAAG,KAAK,EAC1B,KAAM,CAAC4mB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAACivE,EAAyBC,CAA0B,EAAIlvE,EAAS,EAAK,EAEtE,CAAC8sB,EAAanU,CAAM,EAAIC,GAAYgD,GAAMA,EAAI,EAAG,CAAC,EAClD,CAACuzD,EAASC,CAAU,EAAIpvE,EAAS,EAAE,EACzChB,SAAU,IAAM,CACdklB,EAAW,SAAS,GACnB,SAAY,CACX,GAAI,CACF,MAAMirD,EAAU,MAAM9uE,EAAMswB,GAAGw+C,QAAQtuE,OACvCsuE,EAAQnzD,KAAK,CAACrJ,EAAGsJ,IAAMtJ,EAAE1I,MAAMkS,cAAcF,EAAEhS,KAAK,CAAC,EACrDklE,EAAQnhE,QAASmsB,GAAW,CACtBA,EAAOk1C,UAAUjuE,QACnB+4B,EAAOk1C,SAASrzD,KAAK,CAACrJ,EAAGsJ,IAAMtJ,EAAE3R,GAAKib,EAAEjb,EAAE,CAE9C,CAAC,EACD3B,GAAY8vE,EACZC,EAAWD,SAAO,CAClBjrD,SACU,QACV7kB,CACA6kB,IAAkB,GACpB4I,CAAA,GACCrmB,EAAA,OACL,GAAIqmB,eAEJ,uBACO9rB,SAAG,KAAekG,SAAM,CAAAT,EAAA,OAAiBqS,2BAAanS,SACzDF,GAAA,UAAKS,SAAMT,EAAA,OAAoBE,MAC7BC,cAAAD,YACE,OAAKO,MAAM,cAAaP,SACtBF,GAAA+wD,GAAA,IAAA5wD,EAAA8T,GAAA,CAAKxT,OAAmBP,qBAEhBgC,SAAG/B,EAAAS,EAAA,CAAIH,KAAM,OAAcP,SACzBW,MAAqBE,CAAGzE,YAAE,GAAM,GAAC,GAAC6D,EAAE,MAAC,SACtCA,EAAAgC,EAAA,CAEThC,WAAA,CAAAD,CACE,GAAA3F,EAAA,aAAqB,cACnB,SACJ4F,EAAA,UAAKM,KAAM,SAAaP,cAEpBG,QAAK,KACLI,EAAM,GACNH,EACEmoE,cACF,YAAEvoE,SAEIW,MAAqBE,CAAGzE,YAAE,GAAY,EAAC,GAAG,EAC1C,GAAC6D,EACL,iBACHuoE,EAAA,SAAA1oE,EAAAC,EAAA,CAEPE,SAAA,CAAAA,EAAA,MAAAD,MACGwoE,eACCxoE,SACEC,EAAA,IAAAuzB,GAAA,CAAIjzB,KAAM,CAAcP,KAEpB,MAAAsD,EAAQjJ,YAAIiJ,YAAOqlE,SAAWD,QAAS,SAAIl1C,UAC3C,SACE,CAAAvzB,EAAA,MAAAD,SACEF,CAAA,CAAAE,KACEC,OAAA,GAAAA,EAAA,OAAAD,SAAKsD,cACJolE,SAAUjuE,UACTwF,CAAAD,MACG0oE,8BACC1oE,SACEC,YAAA,IAAAs5B,EAAA,WAAAA,EAAA,UAAMh5B,IAAM,GAC0BqoE,GAAO3oE,EACrC,QAAG,OAEd,gBACE,SAEPA,EAAA4oE,GAAA,CAAOtoE,WAAM,CAAeP,CACb,GAAC2oE,GAAqB1oE,EAAE,UAAC,KAChC,SACL,MACL,QACEE,QAAK,KACLI,EAAM,SAEJgoE,EAA2B,EACzB/0C,SACDvzB,EAAAS,EAAA,CACH,cAAEV,SAEIW,iBAAK,EAAc,GAAQ,EAAAtG,CAAe,GACzC,GAAAmuE,EACP,UAAAvoE,EAAA,UAER,MAAC,WACC,SACKxF,UACPwF,CAAQM,MAAM,gBAAUP,WACtBiC,EAAA,CAAO1B,YAAqBP,OAC1BC,CAAA5F,EAAAmuE,EAAA,SACiB/tE,EAAM,GAGtB,GACIwmB,IAAA,UAAAhhB,EAAA,KAAC,MAEX,WACD,SACAghB,EAAY8C,GAAA,GACd,GAAGxjB,IAAM,QAAAN,EAAA,KAAUD,iBAEhB,SACDihB,EAAYhf,EAAA,CACX1B,WAAM,CAAUP,CACjB,GAAA3F,EAAA,WAAqC,WACpC,SAEH4F,EAAAgC,EAAA,CAAG1B,WAAM,CAAUP,CACjB,KAA6B,GAAC,CAC7B,CAAAsoE,GAAAroE,EAAAkE,GAAA,CACJ,MACI/H,EAILkH,CAAKlH,YAAE,UAAY,KAACmsE,EAAA,GACpBtnE,EACEsnE,cAA2B,CAC7B,OAAAD,GAAA,OAAEtoE,WAED8oE,GACSR,qBACE11C,EAEN5gB,EAAO,IAETu2D,EAAgC,GAClC,EACD,CAEJ,IACEQ,GAAA,EAET,MAAAC,GAAA,IAAAD,KAEA,SAAIA,GAAM,CACV,OAAAv1C,EACA,QAAAvyB,CAAwB,EAAEuyB,CAAQvyB,MAAW,EAAA8Q,EAC3C,EAAAmL,CAAM,EAAEnL,KAAG9Y,QACX,EAAAkC,GAAM,EAAEzB,mBAAUyB,EAAI,EAAAq4B,EAChB,CACN,QAAAx9B,EACA,UAAA2yE,EAAQ3yE,KAAS2yE,WAAWtuE,QAAIquE,gBAAUplE,MAAO2lE,QACpCC,GAAA,SAAAP,CAAA,EACPO,GAAcP,YACdQ,IAAgBD,EAChB,CAACE,EAAcC,CAAmBhwE,EAASqvE,IAAY,EACvDY,GAAqBC,CAAA,EAAAlwE,EAAA,IAGrBmwE,EAAoBC,SAAwBpwE,MAAW,SAAAkgC,EAAA,MAAAmwC,EAAA,SAAAnwC,EAAA,MAC7D,OAAOmwC,SAEP,MAAMF,QAKN,4BACOjpE,SAAM,GAAAU,GAAAhB,EAAA,UAAQ5F,KAAG,6BAEV8F,QAAKc,EAASV,SAAMN,EAAAS,EAAA,CAAcN,SAAiBJ,MAC1Ca,CAAGqc,YAAE,GAAO,GAACjd,EAAA,UAAC,SAAEA,EAAA,MAGnCA,SAAAid,EAAAmI,GACenI,aAAiB,CAAAA,YAAd,CAAiB,EAAY,GAACjd,EAAA,iBAAKH,EAAA,QAErDG,SAAA/I,GAAA,CAAA8I,iBACE,UACmB,aAAA9I,EAAA,QACboJ,IAAe,aACX4Z,EAAWA,EAAIC,OAAW7Y,0BAAM,EAChCgC,EAAiBwQ,EAAI,OAAO,iCAC5B61D,EAAazvD,IAAS0vD,EAAO,yBAA0B,uDAAA9hE,KAAA,SACvD+hE,GAAkB3vD,EACtB,KAAAqf,EAAAzxB,KAAA,CAMF,GAAMgiE,aAKN,QAAMC,EACJ1vE,UAAIsvE,EAAiBjrE,IACrBkqE,EACAoB,MAA8B,QAC9BC,EAAA,QAAAhkB,GAAA,CAYE5gC,SACF4kD,KACEF,WAAwB,EACtB1vE,GAED,MACF6vE,EAAAhwD,EAAA,kBACH,IAAAiwD,EAAAjwD,EAAA,kBACA,MAAMlkB,EAAUkkB,EAAS0vD,IAAO,eAAS,EACrCO,KAAYjwD,GAASpG,SAEbyJ,EACVja,qBACAqmE,CACAjB,IACA0B,MACAL,GACA/zE,iBACAm0E,EACAlB,iCAIG3lE,EAAUtN,KAEfm0E,IAAA,KAAAA,IAAA,EAEA5sD,EAAoB,KAGd4sD,EAAA,CAAAA,EAGFE,EAAc,MAAA3wE,EAAA,mBAAAW,CAAA,UACZ,MAAI8vE,EAKF,QAAIjB,EACFiB,YAGF,mBAAAJ,GACEI,aAAYG,CAAA,KAIdH,MAAY,KACdE,EAAO,MAAA3wE,EAAA,mBACLywE,QACF,QAAAD,EACAG,YACE/mE,sBACAtN,kBAEA+zE,EACAd,eACD,CACH,MAAO,UACLkB,QACAE,EAA6C,MAC3C/mE,GACAtN,eACAm0E,IACAJ,CAED,aAEyB,CAC5BxsD,WACAtc,CAFAvI,CAEU,CACD,CACC2xE,KACT,EAED3xE,kBAAc6Y,CACdgM,wBACA/B,SACE6J,UAAQnI,2BACJjd,EAAAgC,EAAA,IAAA5H,QAAA,EAAuB,GAAC4F,EAAAid,0BACxB,qBAAA5Z,EAAA,SAAyB2d,IAAA,UAAC,IAChC,OACF,oBACC,YACL,GAAEjhB,CAEF,GAAKO,EAAM,OAAiBP,6BAC1B,IAAAA,EACE,SAAAA,GACE,OAAAC,EAAA,YAAA5F,kBAAA,SAAmBmvE,EAAA,IAAAjwC,GAAA,CAClB,KACHt5B,CACEE,GAAK8lD,EACL7wC,UACArd,iBACsB,EACtB8oB,EACAC,cAAa,CACbF,SAAQ,CAAA3gB,EAAA,SACR,cACG,gCAET,MAAAgmD,CAAA,CAAW,EAAAhmD,EAAA,SAA4BqpE,qCAAYtpE,KAChDwpE,OACKjpE,aAAMqoE,EAAiB5oE,SACxBwpE,cACC,SAAM,GAAEnvE,WAAIuuE,oBAASoB,WAAWjB,+BAAQxvC,qBACxC,SACE,CAAAt5B,EAAA,SAAAD,KACEC,mCACEE,KAAK,WACLiV,MAAK6wC,EACL1rD,eAAOF,EAET4F,SAAAghB,IAAA,UACE7L,EAAK,IAAAnV,EAAAgC,EAAA,CACL9B,GAAK,SACLpI,EAAc6wE,cACJ3nD,CACVL,cACAC,MAAI,qBACJC,aAAa,UAEfhhB,QAAA,KAAWmmD,GAAwBjmD,EACjC,KAAAimD,CAAA,EAAAjmD,EACE,IAAAiqE,CAAA,IACOM,IACLpqE,EAAK,KAAAoqE,CAAA,EACLhwE,EAAOF,QACS2vE,EACgB,SAElC/pE,EAAAgC,GAAA5H,KAAA,IAAyB,IAAA6iB,EAGzB/c,CACAI,GAAM,SACgB,CAEpB,EACE0pE,GACAR,GAA2C,KAAAxjB,QAClC8iB,CACTW,EACAH,YAA6C,wBAC/C,SACFtpE,EAAA,aAAED,gBAEG,SAACW,EAAKsB,EAAA,YAAOib,IAAE,GAAApd,EAAA,yCAAQ,SAAC,CAAAG,EAAA,eAAC,SAAE,MACzB,gBACL,KAAAopE,EA1Ca,CA2CjB,GAAAD,EAAA,CAEP,IAAAJ,GAAA,EAGH/oE,QAAA,GAAKM,UAAM,GAAiBP,GACrBO,WAAM,KAAeP,MACxBC,EAAAgC,EAAA,+CAAA5H,EAAAwnB,EAAA,oBAAmC,KAChC,EAGT/hB,SAAAG,EAAAgC,EAAA,CAAQ1B,GAAM,SAAwBP,CACpC,GACEG,IAAKqpE,GAAA,UAAAvpE,EAAA,SACLM,MAAM,gBACNH,SAASA,EAAM6B,EAAA,CACbonE,YAEE,OACOL,CACLJ,IAAS,OACE,EAGfpvE,GAEE,GAIAqoB,WAAOA,CAA4B,yBAChC,SACP,CAAA/hB,EAAA,aAAEE,kBAEF,UAAAC,EAAA,gBAAyBA,EAAA,KACjB,cAEDM,GAAM,SAAeP,CAC1B,KAAA1F,GAAA,IAAAw1B,GAAAhwB,EAAA,gBACS0pE,YAA2B,MAAAzB,GAAA,SAAAj4C,CAAA,qBAGnC,UAAA7vB,EAAA,SAEJ,gBACM,eAEX,MAAA6vB,EAAW,eAAA95B,IAAA,SAAA85B,CAAA,KAAkB9vB,SAC3BihB,IAAA,UAAK1gB,EAAM,IAAAwR,EAAAi2D,GAAAl4C,CAAA,GAAAi4C,GAAA,SAAAj4C,CAAA,UAAiB9vB,MAC1B,EAAAA,SACE,SAAAA,UACEiC,CAAA,+BAA0BhC,EAAAgC,EAAA,CACzB,YAEJ46D,CACC,CAAA78D,CACE,GAIQ,GAAAF,EACLE,MAEDC,CAAA,MACEE,kBAAK,SACLiV,IAAKnV,EAAAgC,EAAA,IACL1H,SAAOu1B,YAC6C,QAC1C7O,IAAsB,EACjChhB,EAAE4oE,GACAb,CAEI,UAAAW,EAGb1oE,iBAAA,GAAAD,CACE,CAAa,GAAeA,SAC1B,UAAAC,EAAA,aAAmC,qBAC9B,SAAAid,EAAAmI,EAGXvlB,CAAW,aAEP+D,IAGKglE,QAAY,CAHjB,CAGwD,GAAE/oE,EAAA,UAAC,wBAI7DA,KAAA,aAAAE,SACEC,IAAA,UAAOkb,aAAIkK,EAAA,SAAoBrlB,SAC5BqlB,IAAQnI,6CAAG,gBAAAkrD,GAAAj6D,CAAA,cAAAi6D,GAAAj6D,CAAA,IAAA4D,EAAAq2D,GAAAj6D,CAAA,SAAe,GAACrO,EAAAod,uBAAG,WAAAjd,EAAA5F,KAAA,IAAAmwE,GAAA,gBAAA1qE,EAAA,eAAQ,KAAC,UAAAG,EAAA,SAE1CH,KAAA,QACEzF,KAAG,gBACH+a,MAAK,sBACK6L,IAAY,OACtBlpB,sBAAqC,CAAEiI,QAEtCqlB,GAES9qB,WAAO4T,EAAEnO,CAGiB,GAEnC,IAACF,EAAA,SACK,WAEXA,SAAA,CAAAG,EAAA,SAAAD,KAAA,QACE3F,KAAA,gBACA4F,MAAA,OAESM,eAAM0oE,IAAA,QAAAA,IAAA,SAAA5jD,EAAIrlB,SACfC,IAAA,YACEE,IAAKF,EAAAgC,EAAA,CACLmT,WAAK,EACL7a,CAAM,GACNqgB,cAAgBquD,CAAiB,WACD,SAElChpE,GAAAgC,QAAA,CAAA5H,KAAA,QAAoC,qBAErC,MACHyF,OAAOS,eAAM0oE,IAAA,OAAIjpE,SACfC,IAAA,YACEE,IAAKF,EAAAgC,EAAA,CACLmT,WAAK,EACL7a,CAAM,GAGH8qB,GAEmB,GAExB,GAAAvlB,EAAAzF,SAAA,OAAuB,qBAAC,SACjB,CAAAyF,EACTA,OAAA,UAAOS,CAAMN,EAAA,eAAID,SACf,SACOihB,IAAA,mBACA/D,EAAAmI,EACC,CAEN/iB,WAAsB,EAGlB,CACN,YAFA,CAKR,CAAQ/B,MAAMN,EAAA8jB,GAAA,CAAoB/jB,OAChCF,GAAAE,WACE,WAAQG,CAAK,GAASmC,GAAU2e,KAAY,cACzCoE,UAAQnI,8BAAG,sBAAAA,EAAO,CAAAA,YAAG,UAAQ,KAACK,EAAA,YACzB,SACPwG,CAAO9B,UAAehB,aAAY,QAAA5mB,CAAA,WAAakjB,EAAA,WAEjD8H,IACCplB,OACYghB,SAAY,CAChB,CACNxN,OACAD,EAAY0J,iBAAE,CAAqB,YAAC,EAElCK,CACA,GAAC,CACC,EACE,SAAAtd,WAAeuoE,CACfjrD,cACAtc,qBAAU,QACRF,IAAO,GACR,aACS,UACVrI,aAAe,CACf6kB,WACA/B,EAAK0B,KAAC,KAA0B,GAAC,EACnC,CACC,SAAA2rD,GACL,WAAAF,EAEA,iBAAA8B,CACO,GACC,MACS,EAAAvS,CAAC,EAAAh/D,KACMgwE,EAAUlpE,IAEhCmpE,EAAAD,GAAA,SAAAP,CAAA,EAAA+B,EAAqBxB,GAAA,WAAAP,CAAA,eAAA52D,EAAC44D,CAChB,EAAA14D,GAAAgD,KAAA,YAAAnZ,GAEX6uE,EAAAD,GAAA,KACKA,EAACxS,EACJ,CAEN,WAET,CAEA,EAAAgR,EAASL,EAAa5mE,EAAA,CAAE0mE,YAAW8B,YAAoB,EAAAxqE,EAAAgD,GAAA,CAC/C,SAAAkmE,CAAA,CAAElwE,EACR,GAAAwxE,GAAoB9B,EAEpB,CAGA,WACA7sE,CAEA,CAAco8D,CCtmBhB,SAAS0S,IAAmB,CAC1B,KAAM,CAAE3xE,KAAGC,KACL,CAAEQ,QAAOC,YAAawB,KAC5B4/D,GAAQ3+D,EAAC,CAAA/B,GAAA,SAAmB,EAAG,KAAK,EACpC,KAAM,CAAC4mB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAE1C,CAAC8iD,EAAkBC,CAAmB,EAAI/iD,EAAS,EAAE,EAC3DhB,SAAU,IAAM,CACdklB,EAAW,SAAS,GACnB,SAAY,CACX,GAAI,CACF,MAAMy7B,EAAO,MAAMH,KACnBuD,EAAoBpD,CAAI,EACxBz7B,EAAW,SAAS,CACtB,MAAY,CACV7kB,SAAe,CACf6kB,CAAkB,IACpB,EACF,EAAG,EACAtd,EAAA,OAEL,4BACO5F,MAAG,iBAAyBkG,SAAM,KAAiB4R,SAASrS,EAAA,OAAIE,2BAC9DO,SAAM,CAAAN,EAAA,UAAoBD,SAC7BC,EAAA,OAAAD,oBACOO,SAAM,CAAAT,EAAA,OAAaE,oBACjBO,SAAM,CAAAN,EAAA4wD,GAAA,IAAA5wD,EAAA8T,GAAA,CAAa/T,OAEhBgC,MAAG,eAAIzB,SAAMN,EAAAS,EAAA,CAAcV,YACzBW,KAAK,IAAOC,MAAYxE,CAAE,aAAM,EAAC,EAAC,CAAE,GACrC6D,EAAA,MACJ,SACLA,EAAAgC,EAAA,CAAAjC,WACE,KAA+BC,EAAA,OAC7B,MACJ,eAAKM,CAAM,EAAgB,GACxBN,EAAA,QACC,SACRk8C,EAAA,SAAAr8C,EAAAC,EAAA,CAAAC,SACGm8C,SACCn8C,kBACMO,SAAM47C,EAAA,IAAAM,GAAAx8C,EAAA,MAAWD,SAClBm8C,MACCn8C,KACG+T,KAAI,MAAA0oC,EAAA,aAAAA,EAAA,OACHz6C,SACErI,GACI+G,EAAI/G,CAETqG,eAEKW,OAAK,GAAUE,IAAIZ,EAAA,QAAK,SAAEA,EAAA,MAAAD,CAAWoV,EAAY,GACnD,GAET+mC,EAAA,UAAAl8C,EAAA,UACC,MACHk8C,WACS57C,SAAMN,EAAA,SAAUD,sBACfO,SAAMN,EAAAgC,EAAA,CAAejC,YAC1B3F,OAAA,CAAAC,IAAA,OAC0BG,EAAM,EAG/B,EAAC,CACG,GAEVwmB,IAAA,UAAAhhB,EAAA,KACD,MACAghB,WACC1gB,SAAMN,EAAA8jB,GAAA,CAAU/jB,OACjBC,EAAO,EAAO,GAAEghB,IAAA,QAAAhhB,EAAA,KACf,MACDghB,WACC1gB,SAAMN,EAAAgC,EAAA,CAAUjC,WACjB,KAA+CC,EAAA,KAC9C,MAEHA,WAAGM,SAAMN,EAAAgC,EAAA,CAAUjC,WACjB,IAAuC,EAAC,CACvC,EAEA,EACJ,CC7EX,MAAMksB,GAAQ,GAEd,SAAS2+C,GAAU,CAAEvnE,QAAOk3C,OAAMngD,KAAI,GAAGupD,CAAM,EAAG,CAChD,KAAM,CAAE3qD,KAAGC,KACX6hE,GACEz3D,GAAKlH,EACD,CACA/B,GAAI,kBAEN,EACFmgD,GAAQ,YACV,EACA,KAAM,CAAE9gD,QAAOwB,YAAWvB,WAAUmxE,UAAW3vE,KACzC,CAAC4vE,EAAiBC,CAAkB,EAAI3xE,EAAS6B,CAAS,EAE1DgC,EAAaC,GAAYtD,CAAM,EAC/BwkE,EAAejmE,IACfkmE,EAAelmE,IACf6yE,EAAa7yE,IAGnBC,EAAU,IAAM,CACV,CAAC6C,GAAa4vE,GAAQI,kBACxBJ,EAAOI,iBAAkBH,GAAoB,CAC3CC,EAAmBD,CAAe,CACpC,CAAC,CAEL,EAAG,CAACD,CAAM,CAAC,EACX3X,YAAYhpD,IAAI,mBAAmB,EAEnCzR,QAAc+qB,GAAoBngB,gCAAS,EAC3C,eAAM26D,EAAmBx6C,EAAS,EAElCgL,MAAyBA,WACvB,YAAIA,MAAc6vC,kBAAahmE,EAC7B66D,UAAkBz5D,EAAA,aAAkB,WACpC2kE,QAAoD,GAAeC,EAAC,QAAAD,EAAA,kBAEtEJ,GAAAI,EAAA,kBACIJ,SAAoBI,gBAAa/lE,SACnC+lE,EAAWA,gBAAqB/nE,wBAEhC+nE,EAAO,mCAGT,MAAAt0C,EAAA,MAAAu0C,EAAA,eACA,IACA,MAAA/jE,CAAI,EAAEA,EAAM,GAAIwvB,WAChB,MAAmB,GACbohD,IACA18C,KAAW,KAAAw8C,EAAA,UACbE,MAEAF,EAAA,QAAA1wE,EAAA,OAEA7B,UAAY+tD,GAAA,CACd4F,GAAA5F,EAAA9sD,CAAA,CAGAY,GACE8xD,KAAiB1yD,EAAQA,CAAA,EAC1B80B,GAAA08C,GAAAC,GAAA,EACD7wE,WAAQywD,KACRwB,MAAoC4e,CACpC5xE,OACEgzD,cACI,WAAAl3C,EAAA,sBAAAtJ,EAAA,UAGNzR,CACE,CAAuD,mBACxD,wBACH,CACA44D,KACA,MAAA54D,CAAO,CACFwvB,CACHxvB,eACFwB,GAAA,CACF,IAEA,MAAAwC,EAAexC,CACT,QACF,SAAMwC,EAAO,YAED0sE,gCAAW3yE,IACvBiG,EAAA,oBAEEA,QAAK8sE,QAAkB,uBAAA9sE,CAAA,kBACzB,IACA,MAAAhE,CACA,EAAIwvB,EAAA,MAAExvB,uBAAM,MAAIwvB,mBAChBrxB,EAAY,QAAA6B,EAAA,GAAmB0wE,GAC/B1wE,EAAM+wE,MAAgC,EACtC/wE,EAAIA,GAAkB+wE,UACpBL,OAAW3yE,GAAUiC,GAASF,SAIrB,MACT,CACF,QACA,CAAO,CAEP3B,cACA,IAAAqC,EACF,iBACF,GAAAgwE,EAAA,CAEA1yE,EAAU0yE,EAAM,iBACVhwE,wBACH,IAAAA,EAAY,MACPgwE,aAAiB,iBACnBhwE,MAAMgwE,YACNryE,OACA,SAAA8C,UAA0BT,SAAK,CAC7B,MAAKA,EAAKS,EAAA,QACNA,KAAgBuiC,EAAApkC,CAAiB,EACnCopC,eAAevnC,GACf9C,CACA2zD,CAA2B,CAE3B,KACA3zD,KAEAqC,GAAA,cAAUwwE,EACVxwE,EAAA,IAAoB,CACtB,GAAAgwE,CACF,GACAryE,KAAY,CAAgC,MAC9C4K,GAAAlH,EAEF,CACErB,GAAKW,iBACLX,CAAM,EAEV,GAAIgwE,eAEJ,UACG/Y,EACa51D,CAAM,YAAM,EAAyC,UAAAA,EAEjE81D,CAAS91D,YAAE,WAAAzC,EAAuB,WAAAukE,EAClC/L,kBAAS/1D,4BAAEc,EAAA,2BAAA0mD,EAAwB,qBACnCjqD,oBACA04D,gBAAY6L,IACZniE,CCzIN,MAAMmwB,GAAQ,GAKRs/C,GAAsB,EACtBC,GAAmBD,GAAsB,EAE/C,SAASE,GAAS,CAAEtsC,MAAOusC,EAAW/tE,aAAY,GAAGgmD,CAAM,EAAG,CAC5D,KAAM,CAAE3qD,KAAGC,KAEX,GAAI,CAAE8gD,UAAS,GAAG1jD,GAAWsH,EAAa,GAAKm7D,KAC3CnV,EAAM5J,UAASA,EAAU4J,EAAM5J,SACnC,IAAI4xB,EAAW5xB,EAAQlzB,OAAO7G,MAAM,QAAQ,EAC5C2rD,EAASv2D,OACT2kC,EAAU4xB,EAAS,CAAC,EACpB,KAAM,CAACvkB,EAAcC,CAAe,EAAIC,KAClCnoB,EAAQusC,GAAa,CAAC,CAACtkB,EAAavzC,IAAI,OAAO,EAC/C+3D,EAAazsC,EAAQ,WAAa,GAElC,CAAE1lC,QAAOC,WAAUkgB,iBAAkB1e,GAAI,CAC7CxB,SAAUiqD,GAAOjqD,UAAYrD,EAAOqD,SACrC,EACK,CACJD,MAAOuuB,EACPtuB,SAAUuuB,EACVrO,cAAesO,GACbhtB,KACE2wE,EAAeF,EAASnpE,IAAKxJ,GAAM,IAAIA,CAAC,EAAE,EAAEgU,KAAK,GAAG,EACpD3J,EACGlH,EADKzC,EACVylC,EACE,CAAA/kC,GAAA,SAAAC,OAAA,CAAAwxE,eAAgBnyE,WAA4B,EAC5C,CAAAU,GAAA,SAAAC,OAAA,CAAAwxE,eAAgBnyE,WAAe,EACjCylC,EACE,CAAA/kC,GAAA,SAAAC,OAAA,CAAAwxE,eAAgB,EAChB,CAAAzxE,GAAA,SAAAC,OAAA,CAAAwxE,eAAgB,CAJ6B,EAKnD/Q,GAASz3D,EAAO,wBAAwB,EACxC,MAAM2nE,EAAa7yE,IAEbi7D,EAAa9+C,GAAQ,IAAM6+C,KAAwB,EAAE,EAGrD2Y,EAAQ3zE,EAAOsG,MAAS,EAC9B,eAAestE,EAAcv9C,EAAW,CAUtC,MAAM1E,EAAU,MAAMrwB,EAAMM,GAAGiyE,UAAUxvB,IACtC7/C,QAAQo9C,CAAO,EACf9/C,KAAK,CACJC,MAAO+xB,GACPggD,IAAKN,EAASn/D,MAAM,CAAC,EACrB0/D,MAAO19C,EAAY/vB,OAAYqtE,EAAMzzE,QACrC8zE,UAAWhtC,EAAQ,GAAO1gC,OAC3B,EACApE,SACAE,OACH,GAAI,CAAED,SAAUwvB,EAChB,OAAIxvB,GAAOE,SACLg0B,IACFw8C,EAAW3yE,QAAUiC,EAAM,CAAC,EAAEF,IAIhCE,EAAM8M,QAASo/C,GAAS,CACtB4F,GAAW5F,EAAM9sD,EAAU,CACzB8B,cAAe2jC,GAASi0B,EACzB,CACH,CAAC,EAED0Y,EAAMzzE,QAAUiC,EAAMA,EAAME,OAAS,CAAC,EAAEJ,IAEnC,CACL,GAAG0vB,EACHxvB,QAEJ,CAEA,eAAewB,GAAkB,CAC/B,GAAI,CACF,MAAMguB,EAAU,MAAMrwB,EAAMM,GAAGiyE,UAAUxvB,IACtC7/C,QAAQo9C,CAAO,EACf9/C,KAAK,CACJC,MAAO,EACP+xE,IAAKN,EAASn/D,MAAM,CAAC,EACrB4/D,SAAUpB,EAAW3yE,QACrB8zE,UAAWhtC,EACZ,EACA9kC,SACAE,OACH,GAAI,CAAED,SAAUwvB,EAChB,MAAMuhD,EAA0B/wE,EAAM,CAAC,GAAGF,KAAO4wE,EAAW3yE,QAC5D,OAAIiC,GAAOE,QAAU,CAAC6wE,GACpB/wE,EAAQ2wD,GAAc3wD,EAAO,QAAQ,EAC9B,IAEF,EACT,MAAY,CACV,MAAO,EACT,CACF,CAEA,KAAM,CAAC+xE,EAAeC,CAAgB,EAAIlzE,EAAS,SAAS,EACtD,CAACwC,EAAM0xB,CAAO,EAAIl0B,IAExBhB,EAAU,IAAM,EACb,SAAY,CACX,GAAI,CACF,MAAMwD,EAAO,MAAMnC,EAAMM,GAAGg/C,KAAKp8C,QAAQo9C,CAAO,EAAEn/C,QAClDnC,EAAQma,CAAIhX,CACZ0xB,MAAQ1xB,EAAI,IAEZnD,OAAe,MACjB8zE,EAAAZ,EAAA,QAAAH,GACC,CAAAgB,EAAAC,EAAA,EAAArzE,EAAA,WACD2gD,GAAQygB,CAAA,EAAAphE,EAAA,IAENmzE,IAAgCf,QAEtCpzE,SAAOo0E,KACAjS,IACP,SAAOmS,CACPt0E,IACM,MAACwhB,EAAe,MAAAngB,EAAA,uBACnB+gE,EAAYK,CAAA,EACX8R,EAAI9R,EAAA,KAAAre,KAAA,qBAAAzC,EAAA,eACF,MAAMwgB,EACNC,IACAmS,QAKO11E,EAAG,CACVwB,eAAe,CACjB,MAAA4K,EACF,eAAG,EAAA3J,GAAAmG,EAAA,MACA,4BAEL,SACEC,OAAA,CAAAC,IACEC,OAEEqD,WACA2uD,UACIt4D,CACI4G,SAAM5G,CAAA,CAAqBqG,EAC7B,GAAO,GAAMA,UAAE8rE,WACf,UAAA9rE,EACE,CAGL,YACHrG,EACSyC,YAAE,CAA+C,YAAC,EAClDA,+BAAE,kBAAoCgjC,GAAAi0B,EAAA,eAAC,QAAAj0B,EAChDizB,cAAY2Z,SACZjwE,gBACAq2D,UACAO,gBAAeU,GACfX,SAAStzB,OAETgxB,kBACAoC,aACGt/C,SAAK,CACJ7R,KAAM,SACNwrE,cACA5hD,SAAShrB,EAAAS,EAAA,CAETqqB,KAAS,OACT5X,SACUhT,IAAK/D,EAAsB4D,CAC3BW,GAAK,SAAY,CAAOvE,KAAE,SAAA/B,EAAA,CAAAwB,GAAA+vE,EAAA,YAAA9rE,EAAAC,EAAA,UAAM,CAAAE,EAAAqT,GAAA,CAAC,WAAG,QAAAzX,EAAA,UACpC,aAAAO,EAIR4D,CAEIuT,mBACS1X,CACT2X,SAAYpX,EAAE,WAAA9B,IAAA,YAAAuf,EAAA,QAAAmgC,OAAqB,WAAEn+C,EAAA,UAACnC,EAAA,gBAAAsgD,CAAA,uBACtC13C,EAAUgqE,IACDlsE,EACPmsE,UAAiB,EACjB,GAME7yE,KAIc,CAASivB,YAAkB,QACrCrsB,SAASF,EAAC,WAAA9B,GAAA,OAAA0/C,aAAuB,KAAAuyB,EAAC,aAGlC/wD,KAAO,aAAAw+B,CAAA,qBACPthD,EAAQ6Y,CAETu7D,KACCP,YAA0B,CAC3B,EACLjwE,GAAOF,EAKDmxB,CAAU,GAAG1xB,SAAM8sB,QAAiB,QAAAqxB,CACpC19C,CAASF,GAAC,SAAAlF,GAAA,OAAAoD,EAAA,WAAA0/C,OAAqB,YAAE,EAGjCx+B,WAAO,UAAA1b,EAAAC,EAAA,CACPrH,cAAe,CACjB,KACCo0E,cACCP,gBAAiB,CACnB,SAACtsE,EAAAgC,EAAA,CACL,YACF,EAAEjC,EAGA,GAAAA,IACGU,CAAI,SAAM,CAAAT,EAAAS,EAAA,CAAgB,KAAE,MAC7B,GAAAV,aACEiC,CAAA,SAAAhC,EAAAgC,EAAA,CAAwB,YACnB,EACP,EAEF,EACO,GAAAhC,EAACU,GAAK,MAAU,WACrB,QAAAX,EACE,SAAAysE,IAAA,YAAA5yD,EAAA,QAAoB,KAEtB,GAFuB6yD,GAChB,WACPC,EAAA,CAGN1sE,MAAC8C,EAAQy3D,EAAA,KAAA/d,KAAA,qBAAAzC,EAAA,kBACF+yB,EACLtxD,EAASkxD,8CACTrqE,EAAUmqE,EAAoB,KACfrwE,EAETuwE,CACII,WAIN,CACErzE,GAIIkzE,IAAsB,OAAAnwB,KAAA,KAAAswB,CAAA,EACtBzwE,YAASF,iCAACE,GAAuBF,EACjCq+D,CAMDj8C,WACC9lB,CAAe,CAChB,CAE6B,MAElCgB,EAAA,GAAO,qBACL4C,MAASF,cAAC,IAAAE,GAAAF,EAAiC,CAC7C,YAEA1C,GAEI0b,EAAM4kC,YACR,CAAC,EACAP,MAAMl/C,OAAU,aACfqyE,GAAiB,SAAI,CACrBtwE,EAASF,EAAC,SAAA/B,EAAAyF,EAAAC,EAAA,UAAqB,CAAAE,EAAAS,EAAA,MAAC,cAChC+5D,aACF,SACQvjE,IAAM,CACZwB,WAAe,CAChB,CAECg0E,GAA4B,GAC7B5sE,EAAAC,EAAA,CACL,UAAAE,EAAAS,EAAA,CACF,oBAAEV,IAED2sE,QACC3sE,SACEC,EAACS,EAAI,CAACC,GAAK,SAAgB,CAC3B,EAAAX,CACE,KAAAC,EAAiCiC,GAAA,QAAAmxD,GAC5BvzD,EAAAC,EAAA,UAGTD,GAAAC,GAAA,WAAAC,QACO,SAAMC,EAAAgC,EAAA,CAAc,GACzBhC,QAAA,EACE,GAAAH,EAAAzF,GAAA,MAAgC,mBAC3B,EAAA+kC,EAAA,QACP,KAGNn/B,EAGFozD,SACAtzD,SACcyC,EAAU,iBACpBnI,EAAAgtD,CAAA,GACU,SACXtkD,KAAQ,CACP5C,KAAK,eACLsb,QAAW2jB,OACFh/B,SAAM,CACb,MAAIg/B,YACFioB,WAAa2lB,EAAO,CACtB,WACE3lB,EAA6B,EAC/B,CACAC,QAAgBD,IAAY,GAC9BpnD,EAAAgtE,GAAA,WAAEjtE,aAEG,SAAMwsE,EAAA,SAAmB,EAAI,IAAAtsE,CAClC,IAAMK,EAAM,iBAAWP,GACrBiC,CAAA/K,EAAAmD,eAAA,QAAwB6yE,EAAAh2E,EAAA,0BACnBg2E,GAAA,CAAAtB,EAAA,KAAA3yE,KAAA,gBAAAi0E,EAAA,iBAETjtE,EAACiC,MAAc,EAGnBjC,EAACgtE,OAAczqE,SAAU,KAAA7I,EAAA,IAAAA,CAAA,MAAAiyE,EAAA,YAAAC,CAAA,SAAAD,EAAA,YAAAC,CAAA,KACnB3rE,eAAI,cACN,aACmB,CACfhJ,MACA,KAAMg2E,OAEN,YACEA,EACCtB,GAASpuB,EAKVouB,CAMAt8D,YAGF,QACF,iBAAAm8D,EAAA,CAEK,CAAM,EACXxrE,EAEEE,CACAk6C,WACYtoC,GACN,6CAAA05D,iBAAuB,WAEtB,sBAAC,SAAArvE,0BACF,SAAa,GAAA6D,EAACktE,GAAA,cAEZ,YACR5wB,EAAY,KAAAE,EAAA30C,IAAAhI,EAAAiD,GAAA,UACZy5C,EAAe,mBACfE,GAAY,CAEZra,EAAQ,OAAAv6B,EAAA,GACRxF,OAAUkqE,EACV3rD,SAAI,KAAAlnB,EAAA,IAAAA,CAAA,MAAAiyE,EAAA,YAAAC,CAAA,SAAAD,EAAA,YAAAC,CAAA,IACa,SACjB,CAAA5rE,EAAAS,EAAA,CACE,SAGVT,IAACktE,GAIK7qE,GAAUspE,QAAoB,CAE5BA,EACAA,mBAMAt8D,YAAgB3V,CAGlB,qBAAEqG,SAEFC,GAACS,OAAI,CAACC,MAAK,qBAAIE,SAAGzE,WAAE,EAAAqgD,CAAA,KAAAx8C,EAAgBiC,GAAA,IAAApC,EAAAiD,GAAA,UAAC,CAAAolB,EAAA,QAAE5nB,IAAM,CAAa,GAC1DT,EAAA,kBAAA45C,GAAA,CAAMn5C,SAAM,EACJA,CAA0BP,YAC/By8C,OAAG,CACC,gBAAA/C,EAAA,CAEV,CAGM,SAGL,CACEl+B,QAAKzJ,wBACH65D,EAAA,mBAAAjyE,EAAA,MAAAW,EAAA,aAAsBT,EAAA,eAAAkpC,KAAA,OAAAwY,EAAA,MAAAxY,EAAA,2CAAAwY,EAAA,2CAAAxY,EAAA,SAAAA,EAAA,WAAAwY,EAAA,eAAAxY,EAAA,QAAAA,EAAA,SAAAwY,EAAA,WAGpB,MACJn/C,EAEF,CACMm/C,WAAW,CACT,CACNvB,GAEA5a,EAAOA,UAAQ,KAAO1gC,GACxBpC,GAAAF,EAgBIgxE,CACF5xD,GAAKpf,YAAC,EAA8B,SAAC,CAAA6D,EAAAS,EAAA,CACvC,eACE7G,SAAOghD,QACPv+C,WAASF,gBAAC,MAAA0D,EAAwBiD,GAAA,SAAC,KACrC,IAAAsqE,EAAA,OAAAjxE,EACA4D,CAEIW,GAAK,SACX,CAAAX,EACE,GAAA3F,MAAA,KAAAgzE,CAAA,GAA8BA,GAAA,MAAAjxE,EAGlC0D,IACWM,QACP,CAAwBhE,GACtB,OAA6CixE,IAC/CA,IAAA,qBACA,SAAUppE,KAAKopE,KAAc,MAAAzB,EAAA,YAAAC,CAAA,GACLzvE,WAAC,CAAA6D,EAAAS,EAAA,MAAArG,KAAA,OAAkB4F,EAAA,iBAACA,EAAAgC,EAAA,CAC1C,YACF,CACA,GACEorE,OAAcA,GAAYpvE,KAAmB,CAE7CqR,YAASpL,CAGX,kBAAAgkB,CAAA,MAAA0jD,EAAA,YAAAC,CAAA,EACF,EAAE7rE,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,MAAO,EAAE,IACpBV,EAAA,SAAAD,0BACE,SAAAC,EAAAgC,EAAA,CAAqC,YAChC,QAERimB,iBACU,EAEL5Y,WAASpL,CAGX,EAAAjE,EAAA,QAEK,CAACU,CAAK,CAAO,EAClB,GAAa,EACX,EAAAhH,EAAAmyE,CAAA,GAAAluE,GAAA,EAAAguE,GAAA,QAAA3rE,EAAA,wCAAAioB,uBACwC,QAAAtkB,KAAA;;AAAA,QAAAkoE,CAAA,GAAI,EAAC,GACtC,EACD,CCpfxB,MAAM5/C,GAAQ,GAEd,SAASohD,GAAK1pB,EAAO,CACnB,KAAM,CAAE3qD,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAC/B,CAAEH,QAAOC,YAAawB,KACtBd,EAAKupD,GAAOvpD,IAAM0+D,MAAa1+D,GAE/B4wE,EAAa7yE,IAGbm1E,EAAen1E,IACrB,eAAeqsB,EAAUgK,EAAW,EAC9BA,GAAa,CAAC8+C,EAAaj1E,WAC7Bi1E,EAAaj1E,QAAUoB,EAAMM,GAAGiyE,UAAU/xE,KACvC0C,QAAQvC,CAAE,EACVH,KAAK,CACJC,MAAO+xB,GACR,EACA5xB,UAEL,MAAMyvB,EAAU,MAAMwjD,EAAaj1E,QAAQkC,OAC3C,GAAI,CAAED,SAAUwvB,EAChB,OAAIxvB,GAAOE,SACLg0B,IACFw8C,EAAW3yE,QAAUiC,EAAM,CAAC,EAAEF,IAIhCE,EAAM8M,QAASo/C,GAAS,CACtB4F,GAAW5F,EAAM9sD,CAAQ,CAC3B,CAAC,GAEI,CACL,GAAGowB,EACHxvB,QAEJ,CAEA,eAAewB,GAAkB,CAC/B,GAAI,CACF,MAAMguB,EAAU,MAAMrwB,EAAMM,GAAGiyE,UAAU/xE,KAAK0C,QAAQvC,CAAE,EAAEH,KAAK,CAC7DC,MAAO,EACPkyE,SAAUpB,EAAW3yE,QACtB,EACD,GAAI,CAAEiC,SAAUwvB,EAChB,MAAMuhD,EAA0B/wE,EAAM,CAAC,GAAGF,KAAO4wE,EAAW3yE,QAC5D,OAAIiC,GAAOE,QAAU,CAAC6wE,GACpB/wE,EAAQ2wD,GAAc3wD,EAAO,MAAM,EAC5B,IAEF,EACT,MAAY,CACV,MAAO,EACT,CACF,CAEA,KAAM,CAAC+pB,EAAO0B,CAAQ,EAAI3sB,EAAS,EAAE,EAE/B,CAACa,EAAMszE,CAAO,EAAIn0E,EAAS,CAAEiK,MAAO,OAAQ,EAElDy3D,GAAS7gE,EAAKoJ,MAAO,QAAQ,EAC7BjL,EAAU,IAAM,EACb,SAAY,CACX,GAAI,CACF,MAAM6B,EAAO,MAAMwqB,GAAQrqB,CAAE,EAC7BmzE,EAAQtzE,CAAI,CAEd,MAAY,EACVxB,IAAe,GACjB2B,CAAA,QACC,CAAAisB,EAAAD,CAAA,EAAAhtB,EAAA,IACC,CAACo0E,EAAAC,CAAA,EAAAr0E,EAAA,IAEP,OAAOitB,KACP,SAAOmnD,OAEP,QACE1tE,MAAAC,UAGIsD,UAAOpJ,EAEPg4D,CAAS91D,YAAE,YAAcA,EACzB+1D,CAAS/1D,YAAE,WAAAzC,EAAwB,WAAA8qB,EACnC9qB,kBACA04D,aACAt2D,yCACAq2D,cAAS,OACTz2C,mBAEAy0C,YAGAmC,iCAIQzyD,EAAA,UACJmrB,cACA9X,cACUhT,SAAK,CAAAF,EAAAS,EAAA,CAASH,KAAM,OAAOP,SAC3BW,MAAqBE,CAAGzE,YAAE,IAAO6D,EAAAS,EAAA,CAAC,oBAAG,KAC3CT,GAAK,EAACU,CAAK,GAAoB,aAAMzJ,GAAA,CAC/BA,EAAA,WAEKA,MAAM,CAEjBstB,EAAwB,SAC1B,CAAAvkB,EAAA8B,GAAA,CACF,QAAE/B,SAEFC,EAAC8B,QAASC,SAAG/B,EAAAgC,EAAA,CAAIjC,WACf,CAAAA,CACE,KAAAskB,GAAuB,UAAAxkB,EAAAC,EAAA,CAAC,SACpB,CAAAE,EAAAiC,GAAA,IAAAoiB,EAAA,IAAAqpD,GAAA1tE,EAAA8B,GAAA,CAEPuiB,SAAO7pB,EAAS,KACfuF,SACEC,EAACiC,QAEyBF,SAAU9H,GAAO,MAAAyzE,EAAA,WAAA7tE,EAAAC,EAAA,CAAGC,cAC1CC,EAAAilB,GAAA,OAGI,EAEwB,EAAAyoD,EAEzB,QACG,GAIb,UACI7tE,EAAAoT,GAAA,WAETs/C,gBACGt/C,GACC7R,SAAM,OACNwrE,mBACA5hD,SAAS,SACTq/B,WAAWrqD,EAAA,UACX8qB,cACA5X,cACUhT,SAAKF,EAAAS,EAAA,CAASH,KAAM,OAAOP,SAC3BW,MAAqBE,CAAGzE,YAAE,GAAM,GAAC,SAAG,CAAAlC,GAAA,WAAA4F,EAAAC,EAAA,CACpC,UAAAD,EAAA8tE,GAAA,CACT5tE,UAEA9F,QACC8F,SACEF,GAAC8tE,GAAU,QAAA3tE,EAAAgC,EAAA,CAACO,WAAU,CAAOxC,EAE3B,GAAA3F,EAAA6H,GAAA,OAAApC,EAEQiD,GAAA,SAETb,MAAc,CAGnBpC,MAAS,CACPM,EAC0B,SACtBlG,MACD,cACF8F,QAEI,GAACW,EAAK,QAASC,SAAKX,EAAAgC,EAAA,CACzBhC,WAAA,CAAAD,CACE,MAAAF,EAAkBiD,GAAA,CAAC,QACd,IAAA2qE,EAAA,IACC,SACT3qE,KAAQ,CAAC3C,aAA+CJ,QAClD,GAACW,EAAK,QAAQC,SAAKX,EAAAgC,EAAA,CACxBhC,WAAA,CAAAD,CACE,MAA4B,EACvB,EAAA3F,CACC,EAACisB,GAAArmB,EAAAkE,GAAA,SACNjN,GAAA,CAGVovB,8BAEmB,GAEZD,EAA6B,SAC/BpmB,EAAAmlB,GAAA,CACF,KAAAkB,GAAA,KAAEtmB,WAEDolB,CACOkB,qBAAsBpsB,SAClB04B,MAAW,EACR7xB,UAAU,YACnBysE,cAAetzE,MAIfoV,EAAgB,IAElB+W,EAA6B,GAC/BonD,GAAAxtE,EAAAkE,GAAA,CAAE,QACHjN,GAAA,CAGJu2E,8BAEmB,GAEZC,EAA+B,SACjCztE,EAAA4tE,GAAA,CACF,OAAAxzE,EAAE2F,YAED6tE,EAAiB,KACRxzE,GACsC,EAC/C,CAEJ,MACDyzE,GAAA,GAEN,SAAAD,GAAA,CAEA,OAAA7oD,EAEA,QAAA/jB,CAA2B,EAAE+jB,CAAQ/jB,MAAW,EAAAic,CAC9C,EAAAhkB,GAAM,EAAED,SAIR,SAAAU,CAAM,EAAED,KAAOC,YAAawB,GAAIoiB,CAAA,EAAAlkB,EAAA,WAC1B,CAAC00E,EAASC,CAAU,EAAI30E,EAAW,IACnC40E,EAAU1wD,EAAclkB,EAC9B,eAAOy7B,EAAqBrG,GAE5BsG,MAEAxX,EAAA,YACEwX,SAAY,CACZxX,KACCkR,GAAY,CAAAw/C,EAAA,WACPA,EAAA,QAAAv0E,EAAA,iBAAAsrB,CAAA,iBACEyJ,QACFw/C,aAGWH,MAERxzE,EAAO,MAAA2zE,EAAA,eACZ,IACA,KAAA54C,EACA,MAAA96B,CAAI,EAAE86B,EAAM96B,WACRA,EADkBwvB,EACXtvB,EAEIF,EAAK,OAAAA,CAAA,CAFD,EAIfyzE,GAAWD,IAEbh5C,EAAY,EAAK,EAEjBA,WAAiB,OACnB,CACAxX,EAAW,QACb,CACEA,IAAkB,CACpBllB,SACC,KACL61E,EAAA,GAEA71E,MACE61E,QAAiB,CACnB,MAAK,QAEL,mCACO3tE,SAAM,GAAAU,GAAAhB,EAAA,UAAQ5F,KAAG,6BAEV8F,QAAKc,EAASV,SAAMN,EAAAS,EAAA,CAAcN,SAAiBJ,MAC1Ca,CAAGqc,YAAE,GAAO,GAACjd,EAAA,UAAC,SAAEA,EAAA,MAGnCA,WAAAgC,EAAA,CAAAjC,WACE,CAAAA,CACE,KAAAC,EAA4B,QAAC,SAC3BH,EAAA,MAENG,SAAA,CAAA8tE,EAAA,IAAAI,GAAAruE,EAAA,MAAAE,YACEgkB,GAAA,SACG+pD,EACC/tE,UACe,GAACoS,KAAS+7D,CAAQx0E,UAAqB,OAAAqrB,CACpC,EAAC5S,CAAS+7D,IAAQnpD,6BAAe,GAAG,cAEvD6wC,GACA/gC,GAAY7T,EAAY,EACfmtD,SAAGnuE,EAAA,UAAKyV,cAA+C1V,oBACrDG,QAAK+tE,EAAS3tE,SAAMN,EAAAgC,EAAA,CAAc7B,WAAS8tE,CAAaluE,CAC9D,KAAwB,EAClB,GAEX,EACC,CACC,SACJquE,GAAA,CAET,QAAAj8D,EAEA,OAAA4S,CAAyB,EAAE5S,CAAS4S,MAAU,EAAAkzC,CAC5C,EAAAh/D,GAAM,EAAED,QACR,EAAAkC,GAAM,EAAEzB,mBAAUyB,GAAImzE,CAAA,EAAAj1E,EAAA,IACtB,OAAO4nB,KAAS1D,CAChB,QAAOgxD,GAEP,aACGj7D,SAAW,UACAi7D,KACV/6D,YACExT,OACEC,CAAA5F,EAAA+X,EAAA,qBACsCA,CAAgB,EAAAnS,EAAA,QAAA2D,oBAAA,CAAAC,CAA7C,CAAY,EAAwC,GAAC,MAEvD,MAAC,kBACJ,SAERzB,QAAM,KACNqR,KACe,YACb,SAAa,CACX8J,IACC,MAAA7jB,EAAY,iBAAAsrB,CAAA,mBACP,YAAA5S,EAAA,GACF,GAAqDmL,EACnDkJ,SAAarU,EACfk8D,EAAC,GACD/wD,OACA+wD,EAAW,OAAK,CAClB,CACE/wD,OAEJA,EAAG,YACL,SAAO,CAGLA,IAEC,MAAA7jB,EAAY,iBAAAsrB,CAAA,mBACP,YAAA5S,EAAA,GACF,GAAqDmL,EACnDkJ,SAAarU,EACfk8D,EAAC,GACD/wD,OACA+wD,EAAW,OAAI,CACjB,CACE/wD,KACF,EACC,SACLtd,EAAA,UACF,cAAED,eAEFuuE,EAAA,cACEpuE,SAAK8gB,IAAA,UACL1gB,SAAgBguE,EAATA,GAGCrW,aAAS,CAAAA,YAAN,CAAS,EAAS,EAAC,CClYtC,MAAMsW,GAAuB,CAC3B1wD,QAAS,CAAC,UAAW,QAAQ,EAC7B+V,MAAO,CAAC,UAAW,QAAQ,EAC3BplB,OAAQ,CAAC,UAAW,QAAQ,EAC5BuP,OAAQ,CAAC,UAAW,QAAQ,EAC5BC,OAAQ,CAAC,SAAS,EAClBgiC,eAAgB,CAAC,SAAS,EAC1BliC,UAAW,CAAC,UAAW,QAAQ,EAC/BxW,KAAM,CAAC,QAAQ,EACf8O,OAAQ,CAAC,QAAQ,CACnB,EAEMo4D,GAAc,CAAC,YAAa,SAAU,QAAQ,EAC9CC,GAAavuE,GAASsuE,GAAY7/D,SAASzO,CAAI,EAE9C,SAASwuE,GAAiB10E,EAAe,CAC9C,OAAOA,EAAcu5B,OAAQl4B,GAAiB,CAC5C,KAAM,CAAE6E,OAAM9F,KAAIuI,WAAU,EAAItH,EAChC,GAAI,CAAC6E,EACHzH,MAAO,GAGT,MAAK2B,KAAkB8F,CAAA,EACrBzH,UAAQukB,OACR5Y,EAAA,MAAArG,GAAA,EAAA1C,EAAA0C,CAAA,GAEIqG,IAEJ,CACF,SAAAuqE,GAAA30E,EAAA,IACAA,GAAa,oBACb,MACJ,SAAA0C,EAAA,GAEA,mBAAAkyE,EAAgBD,GACV30E,eACFA,EACE0C,SAAa,IAAAixB,GAAA,CACbihD,MACAhyE,mBACE5C,UACJ,EAAA2zB,EACQm1B,EAAA+rB,GAAA,IAAAz0E,GAAAsC,EAAA,KAAAqP,KAAA,KAAA3R,CAAA,OAAEy0E,KAAgB,KAAA/rC,KAAA,KAAAgsC,CAAA,QAAEA,UAAanhD,EACvC,eAAAm1B,EAEA,OAAAt0C,EAEE,GAEAA,SAEF,SAAAugE,GAAAC,EAAA,CAEJ,MAAAC,EAAoBD,EAAA,IAAAE,GAAA,CACtB,MAEA,yBAAAC,EACE,yBAAAC,EACA,eAAAtsB,EACE,mBAAAC,GACEosB,QACAC,CACAtsB,QACAC,oBACID,EAAA,GAEN,GAAAosB,EAEEvsE,QAMJ0sE,EAAA,GACA,QAAAxnE,EAAA,EAAAA,EAAAonE,EAAA,OAAApnE,IAAA,CACA,MAAAqnE,EAAAD,EAAApnE,CAAA,EACMynE,CACN,KAAApvE,EACA,OAAAsO,EACE,UAAA7L,EACA,mBAAAogD,EACE7iD,iBACAsO,YACA7L,EACAogD,IAAkB,SAAApgD,CAAA,8BAClBmgD,EAAc5iD,EAIZqvE,EAD8B5sE,EAA6B,GAAKmgD,GAAE,UAAAC,EAAAD,GAAA,UAChD5iD,IAAA,aAAAA,IAAA,YACtBqvE,EAAA,oBAMA,MACGC,eAAiC,IACjCtvE,CAAI,GAELqvE,EAAcD,EAAkBvxE,CAAA,EAClC,IAAA0wE,GAAAvuE,CAAA,EACAmvE,EAAA,KAAAH,CAAA,UACSO,EAET3sB,EAAe5iD,QAAO6L,GAAA,CACpBsjE,QAAuBr5D,EAAQ,oBAAA05D,KAAA,KAAA3jE,EAAA,IAC1B4jE,GAQCA,EAAI,YAAAzvE,CAAA,IACKA,OAAI,kBARnBuvE,EAAA,qBACA3sB,KACE,WAGA,CAKA,GAGA2sB,EAAA,4BAAAA,EAAA,mBAAA1sB,CAAA,EACF0sB,EAAE,yBAAA1sB,CAAA,EACF0sB,EAAA,0BAAA3sB,GAAA,QACA2sB,EAAA,UAAAA,EAAA,eACAA,EAAmB1sB,iBAAqBpgC,MAIxC8sD,CACAA,kBAAwCz5D,CACxCy5D,KACAA,UACF,EAAC,EACCH,EAAiBxsB,IACf,GAAG/2C,EACHypB,eAAa94B,EACb,KAAC6yE,EACHD,YACE,WAAKtsB,EAAA,CAAAA,CAAA,KACLF,oBAAgBpmD,EAAQ,EACxBwD,qBAAiB,CAAA4iD,GAAA,OACjBH,EACAE,EAAoB,KAAIG,EAAcjlD,CAAA,GAEtCmlD,YAMN0sB,EAAA,GACA,QAAA/nE,EAAA,EAAAA,EAAAwnE,EAAA,OAAAxnE,IAAA,CACA,MAAAqnE,EAAAG,EAAAxnE,CAAA,EACMgoE,CACN,KAAA3vE,EACA,QAAAiS,EACE,UAAAwwC,EACA,eAAAG,EAAQ5iD,YAAMiS,YAASwwC,EAAWG,IAAc,SAAAngD,CAAA,0BAAEA,EAASmgD,GAAA,YAAAH,GAAA,WAAEK,qEACzDjlD,EAAA,GAAAoU,GAAA,MAAAjS,CAAA,IAAAu3B,CAAA,GACEA,EAAuB/0B,EAAgBotE,GAC7C,GAAMC,EAGJN,EAAU,UACJ,KAAKP,EAAA,MAAQ,EAInBO,EAAet9D,MAAW,IAAIjS,EAAI,EAAIu3B,GACtCg4C,EAAMA,WAAqBI,MAAkB9xE,OAE3C0xE,SAA6Bz5D,EAAI,CACjCy5D,KACAA,OACD,KAAMP,EAAA,GACL,UAASW,WACP,WAAK7sB,EAAA,CAAAA,CAAA,QAEM,KAAA5Z,CAAA,CACXwZ,CACAC,QACA,KAAAqsB,CAAA,CAEJ,CACF,OAACU,CACCA,CACF,SAAAZ,GAAAh1E,EAAA,CAGFvB,EAAYi2E,GAAA10E,GAOZA,QAAgB00E,QAEhB,QAAA7mE,EAAA,EAAA0tB,EAAA,EAAA1tB,EAAA7N,EAAA,OAAA6N,IAAA,CACA,MAAAxM,EAAArB,EAAA6N,CAAA,EACA,CACA,GAAAzN,EACA,OAAAoU,EACA,QAAA2D,EACE,KAAAjS,EACA,UAAAyC,GAAUtH,EAAEmT,EAAM7L,EAAA,SAAAA,CAAA,8BAAEwP,EAAOjS,GAAEA,IAAI,aAAAA,IAAA,YAAEyC,sBACnC,MAAM80B,EAAI,GAAG90B,GAAS,EAAG,IAAID,CAAKC,IAAU80B,CAACq4C,GACzCP,EAAkBD,EAAAvxE,CAAA,EACtB,GAAImC,IAASA,CAAA,EACXqvE,EAAch6C,GAAA,EAAAl6B,UAChBo0E,GAAA,SACA,MAAM1xE,IAAkC,UAAU,KAAAgO,KAAA,KAAAoG,EAAA,IAC5Cs9D,GACFE,EAAWzvE,OAAO,KAAAA,CAAA,EACpB8vE,SAAuB,KAAG30E,YAC3Bo0E,EAAUA,MAAoBt9D,UAI7BA,SAAmB,CAAAjS,CAAA,EACjByvE,EAAcn6C,eAAiBrjB,CAAA,EAC/Bw9D,QAA2B,IAACM,IAE9B,KAAC,CACC99D,IAAQqjB,SAAe,CAAAt1B,CAAA,GACvBuvE,QAAmB9sB,GAAU3sC,CAC7By5D,KACF,KAAAF,EACD,KAAMn1E,EACL,UAAa+X,IAAkBjS,EAAI,EACnC,EACE8vE,EAAez6C,GAAA,EAAA6T,CACflpC,CACAwiD,CAON,MAAAmtB,EAAA,GACAK,EAAA,GACA,QAAAroE,EAAA,EAAA0tB,EAAA,EAAA1tB,EAAAmoE,EAAA,OAAAnoE,IAAA,CACA,MAAAxM,EAAA20E,EAAAnoE,CAAA,EACA,CACA,GAAAzN,EACA,QAAA+X,EACA,UAAAwwC,EACE,KAAAziD,EACA,UAAAyC,GAAUtH,EAAE8W,EAAOxP,EAAA,SAAAA,CAAA,6BAAEggD,IAAS,oBAAAxwC,GAAAwwC,EAAA,YAAEziD,MAAInC,EAAA,GAAAoU,GAAA,MAAAjS,CAAA,IAAAu3B,CAAA,GAAE90B,UAActH,EACpDo0E,EAAsB,UAAW,KAAC9sE,EAAWmtE,QACzC5vE,EAAS,MAAkB,IAAIiS,QAC3BpU,CACN,IAAM0xE,IAAqBI,IACvBJ,KACFA,OACAA,OACD,UAAM,CAAAp0E,EAAA,OACL,EACE60E,EAAe36C,GAAA,EAAA6T,EAEfsZ,MACAE,EAAYvnD,MAEd60E,CAGFA,QACF,CCpQJ,MAAMjkD,GAAQ,GACRkkD,GAAoB,IAAItgE,gBAE9B,SAASugE,GAAS,CAAEzyE,aAAY,GAAGgmD,CAAM,EAAG,CAC1C,KAAM,CAAE3qD,KAAGC,KACL,CAAEQ,QAAOC,YAAawB,KACtB,CAACksD,CAAY,EAAIzpD,EAAa,CAACwyE,EAAiB,EAAI7oB,KACpD,CAAC+oB,EAAWC,CAAY,EAAIl3E,EAAS,IAAI,EACzC8G,EAAOyjD,GAAOzjD,MAAQknD,EAAavzC,IAAI,MAAM,GAAKw8D,EACxDvV,GAA2B3+D,EAAlB+D,IAAS,UAAY,CAAA9F,GAAA,UAAsB,CAAAA,GAAA,SAAJ,EAAiB,WAAW,EAE5E,MAAMm2E,EAAmBp4E,IACnB6yE,EAAa7yE,IAEnB,eAAeq4E,EAAchiD,EAAW,EAClCA,GAAa,CAAC+hD,EAAiBl4E,WACjCk4E,EAAiBl4E,QAAUoB,EAAMM,GAAGC,cACjCC,KAAK,CACJC,MAAO+xB,GACPwkD,MAAO,CAAC,SAAS,EAClB,EACAp2E,UAEL,MAAMyvB,EAAU,MAAMymD,EAAiBl4E,QAAQkC,OAC/C,GAAI,CAAED,SAAUwvB,EAChB,OAAIxvB,GAAOE,SACTF,EAAQo0E,GAAiBp0E,CAAK,EAE1Bk0B,IACFw8C,EAAW3yE,QAAUiC,EAAM,CAAC,EAAEF,IAEhCE,EAAA,UAEAA,QAAe,IAAEkU,CAAa49C,GAAM5F,EAAA9sD,CAAA,CAClC0yD,IAEJ,CACA,GAAAtiC,EACE,MAAGA,oBACoC,CAE3C,MAAA4mD,EAAAv4E,EAAA,EAEMu4E,EAAwBv4E,EAAO,EACrC,iBAA+BA,EAAO,EACtCq2B,MAAkCA,WAChCkiD,EAAkBA,UAAsBr4E,iBAAS,MAC/Cq4E,QACQ,GACJx2E,OAAO+xB,GAGb,MAAAnC,EAAA,MAAA4mD,EAAA,eACA,IACA,MAAAp2E,CAAI,EAAEA,EAAM,OAAAA,EAAIwvB,2BAChBxvB,GAAQA,aAENq2E,EAAe,QAAAr2E,EAAA,kBAEb7B,UAAY,EACd,WAAA+tD,CAEAlsD,IAAM8M,CAAWwpE,KAAYpqB,EAAK,IAEjC,CACH,GAAA18B,EACArxB,MAAQma,UAAsB4zC,EAAA,WAC9B,CAAO,CACF18B,SACHxvB,KAAmBksD,GACrB,OAAAtmD,IAAA,UACF2wE,EAAA,GAAA76E,CAAA,IAGe,GAAWA,CAAA,CACtB,CAAiC,eACnC8F,GAAA,CACA,GAAAoE,IAAOswE,UACT,IAEA,MAAA1mD,EAAehuB,QAAkB,6BAClB,EACP,SAAA60E,EAAA,OACF,UAAM7mD,OAAU,EACR,GACJ5vB,CACAkyE,OAAiC/zE,EAElCgC,EAEH,MAAIgxE,EAAA/wE,EAAA,SAAAq2E,EAAA,eAAEr2E,eAAMq2E,EAAI7mD,2BACRlX,IAOJtY,EACFq2E,OACA,QAAO,KAGX,KACE,MAAA7mD,EAAO,MAAArwB,EAAA,uBACT,QACF,MAAO,YACD,SAAAuxE,EAAA,OACF,UAAMlhD,OAAU,EACR,GACJ5vB,CACAu2E,OAAiB,IAEnB,OACCp2E,GAAO,QAEV2wE,EAAI,QAAA1wE,EAAA,MAAEA,IACN7B,EACA,OACEuyE,QACA,CAEF,CAAO,QACG12D,GAAA,IACVzU,EAAO,OACT,4BACF,UAAAG,EAAA8T,GAAA,CACF,eAEMinD,QAAwB,GAAxBA,YACJ,QACE9jE,GAAA,CAAW0G,IAAqBoC,iBACzB,EACAuwE,EAAA,MAEHnwE,EACE,SAAIxC,IAAY,CACd1G,GAAEoJ,QACFiwE,EAAiB,GACnBtwE,EAAA8T,GAAA,CACF,4BAAE/T,UAEFiC,UAAA,uBAAA/K,GAAA,CAAiB0G,IAEnBqC,iBAAK,EACAswE,EAAA,WAEHnwE,EACE,SAAIxC,IAAY,CACd1G,GAAEoJ,QACFiwE,EAAsB,GACxB,GACF,CAAApwE,CAAEH,GAEF,OAAAC,EAAA+xD,GAAA,OAAqB51D,EAEpB,CAEL+D,GAAK,QAET,CACW,EACF/D,wBAAEA,EAAU,CAAC,YACf,EACMA,YAAE,CAAyB,YAAC,EAC5BA,wBAAE,gBAAAL,EAAA,UAA0B,GAAC,cAAAi/D,EACtCrhE,UACA04D,+BACAt2D,CClIN,MAAMg1E,GAAsB,GACtBC,GAA8B,GAC9BZ,GAAoB,IAAItgE,gBAExBiiD,GAAwB,CAC5BpuC,MAAO,SACPumC,OAAQ,SACRxmC,SAAU,QACZ,EAEMutD,GAAkCtY,GACtC,IAAM6R,MAAkB0G,UAAY,EACpC,CACEl0E,OAAQ,IAAO,GAAK,CACtB,CACF,EAEA,SAASm0E,GAAgC5yE,EAAO,GAAI,CAClD,KAAM,CAAE7E,SAAUyB,KAClB,OAAI81E,KAEKv3E,EAAMswB,GAAG/vB,cAAcC,KAAK,CACjCC,MAAO62E,GACP,GAAGzyE,EACJ,EAEM7E,EAAMM,GAAGC,cAAcC,KAAK,CACjCC,MAAO42E,GACP,GAAGxyE,EACJ,CAEL,CACO,SAAS6yE,GAAwB7yE,EAAO,GAAI,CACjD,OAAO4yE,GAAgC5yE,CAAI,EAAEjE,QAC/C,CAEO,SAAS+2E,GAAwBp3E,EAAe,CACrD,OAAIg3E,KACKjC,GAAoB/0E,CAAa,EAEjCg1E,GAAmBh1E,CAAa,CAE3C,CAEA,MAAMq3E,GAAyB,CAC7B,kBACA,kBACA,iBACA,qBACA,oBAAoB,EAEhBC,GAA8B,CAClCC,gBAAiB,CAAAn3E,GAAA,UACjBo3E,gBAAiB,CAAAp3E,GAAA,UACjBq3E,eAAgB,CAAAr3E,GAAA,UAChBs3E,mBAAoB,CAAAt3E,GAAA,UACpBu3E,mBAAoB,CAAAv3E,GAAA,SACtB,EAEA,SAASw3E,GAAc,CAAEj0E,YAAW,EAAG,CACrC,KAAM,CAAEmU,IAAG9Y,KAAGC,KACd6hE,GAAQ3+D,EAAC,CAAA/B,GAAA,SAAe,EAAG,gBAAgB,EAC3C,KAAM,CAAEX,QAAOC,YAAawB,KACtB+B,EAAaC,GAAYtD,CAAM,EAC/B,CAAConB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAACguD,CAAY,EAAIzpD,EAAa,CAACwyE,EAAiB,EAAI7oB,KACpDuqB,EAAiBzqB,EAAavzC,IAAI,IAAI,EACtCi+D,EAA0B1qB,EAAavzC,IAAI,cAAc,EACzD,CAACghB,EAAUC,CAAW,EAAI17B,EAAS,EAAK,EACxC,CAAC24E,EAAcC,CAAe,EAAI54E,EAAS,EAAK,EAChDyzD,EAAgB10D,IAChB,CAAE21D,eAAcR,kBAAiBE,aAAYI,kBACjDhB,GAAU,CACRC,gBACD,EACGiI,EAAWxH,IAAoB,OAAS,CAACM,EACzC,CAAC/N,EAAgBoyB,CAAiB,EAAI74E,EAAS,EAAE,EACjD,CAAC84E,EAAeC,CAAgB,EAAI/4E,EAAS,EAAE,EAErDX,EAAcN,EAAsB,EAE9Bi6E,EAAwBj6E,IAC9B,iBAA8BA,EAAO,CAQnC,IAPFo7D,MAAkC/kC,WAChC4jD,EAAkBt4E,WAA+B,CAE/Cs4E,8BAAgClB,CAAgC,GAEhEp3E,EAAC,QAAAs4E,EAAA,kBAEH,qBAAAt4E,EAAA,qBACA,MAAI,CAGF,KAAO,IAGT,MAAAu4E,GAAA,MAAAv4E,EAAA,eACMu4E,MAAyBv4E,GAA8BS,KAAK,EAClE,GAAAP,IAAMA,OAAgB20E,CAEtB30E,WAAmBQ,GAAQ,CACzBR,KAAuBqB,SAAiB,CACtC+wD,cAAW/wD,EAA+B,EACzB,GAEnB,MAACi3E,GAAAlB,GAAAp3E,EAAA,EA4BDu5D,GAEA35D,EAAI40B,kBAAW8jD,GAAA,GACb14E,EAAOC,iBACPD,KAAOI,eAAgBs4E,CAGvB74E,cACGwc,CACCjc,cAAe,MACuBI,GACtC,WACF,CAAC,GAELR,EAAO,sBAAA04E,EAAA,CAC4C,CAErD,OAAA14E,EAAA,wBAEAA,EAAOa,2BAAuB,WACvB83E,EACP,CACF,eAAAC,GAAA,CAEA,IAEE,OAAI,MAAA/4E,EAAA,wBACF,MAAO,EAAmC,EACjC,MACR,OACMxC,EAEP,CAAO,CAEX,MAAAw7E,EAAA,KAEAn1D,cACEA,SAAW,CACV,IACC,MAAIo1D,EAAA,MAAAF,EAAA,EACFP,GAAuBO,EACvBP,WAAkBS,CAClBp1D,SACU,QACVA,CAAkB,IACpB,EAEJ,eAAAq1D,IAAA,CAEA,IACE,OAAI,MAAAl5E,EAAA,uBACF,MAAO,OACAxC,EAEP,CAAO,CAEX,MAAA27E,EAAApvD,GAAA,oCAEMovD,IACJ,EAAAx5E,EAAA,IAEI,CAACy5E,GAA2BC,IAA4B,IAE9D,SAAOC,GAAqBC,CAC5B,OAASC,0BAA2B,mBAClC,EAAyD,CAC3D,SAAAC,GAAA,CACAD,EAASC,OAA0Bl7D,GAAA,CACjCi7D,EAAyBj7D,EAErBvf,cACAu6E,EAA6B,CAElB,KAAE,CAAAG,EAAAC,EAAA,EAAAh6E,EAAA,MACnB,SAAAi6E,IAAA,CACA,OAAOF,mBAAuBC,eAC9B,CACE,MAAAE,EAAgBt5E,GAAuBC,CACzC+4D,GAAA,IAEA11C,EAAMg2D,YACJtgB,SAAW,CACX11C,IACC,MAAAi2D,GAAYC,EAAAjgB,CAAA,EACPA,IACFof,GAAMY,YAEF/kD,GAAW,MAAAziB,EAAAsJ,KACbs9D,WACGn5B,cAAM04B,YAAkB,aAAAnmE,EAAA,WAAAA,EAAA,UACvBmmE,EAEEC,EACO3zE,EAAQ8lB,CACwB,GAExC,WACD6tD,GACFK,EACa,OAAAE,IAAA,CAAET,EAAAS,EAAA,CAEjBF,cAEIP,GAED1zD,GAAc20D,EAAA,GAGS,KAC1B,CACF,KAAA99C,EAEA,QAAMm+C,GAAAz+C,EAAEM,KAAK9X,EAAUi2D,UACvBz+C,OAEAxX,EAAW,QACb,CACE7kB,IACA6kB,EAAkBllB,EACpB,KACFk7E,EAAG,GACL,MAEAl7E,EAAU,IAAM,CACdk7E,KACG,GAEH,GAAA9lB,CAAIA,GACF8lB,WAAsB,EAAAl6E,EAAA,IACxBq6E,GAAAl0E,GAAA,EACF,iBAAA01D,EAAe,EAQf,OAAOlC,CAED0gB,eAEEzyD,WAAY,aAAW6rC,EAAA,wBAAAoI,GAAA,mBAAAE,GAAA,GACzBme,EAAA,GAEF76E,KAAY,qBAAkBwE,EAAA,qBAAA+jB,CAAA,GAC5BvF,KAAwB7d,EAAS6d,MACRpjB,CAAS6xD,MAElC+K,+BACD,CAAAM,GAAA,SAAAj+D,GAAA,MAEC2F,GAAWW,CAKX01E,iBAAsB,GACxB,EAME/d,WAAwB,UAE5B,CACE,GACA,MAAA/mC,GAAK+mC,EAAel9D,IAElBo7E,OAAY,IAAAC,EACVze,GAAkBr7D,EAAA,uBAAAsU,IAAA,IACnBsgB,GAAA,SACHA,GAAO,WACL+mC,MACF,CACFv0C,IAAA,YACD9S,IAAAulE,GAAA,EACDzgB,GAAMxkC,IACNp2B,GACE,MAAIs7E,IAAQC,KACV,MACEnlD,SAAoB,SACpBolD,GAAA,SAAAC,GAAA,iBACFC,GAAA,SACA,MAAAC,GAAgB,CAAA92E,EAAW,mBAAA5B,GAAA,SAAAA,EAAA,4BAAAw4E,GAAA,gBAC3BG,GAAmB77E,EAAA,EACnB66D,MAAY,CACb6e,IACDj4E,oBAAqB,CAClB,GAAAi4E,EAECgC,kBAAqB,CAC3B,EAEA,GAAAhC,EAAMkC,CAA6B/5E,GAMnC,KAAMg6E,IAAuB77E,EAAO,EAAAiB,EAAA,MAEpChB,EAAU,SAAM,CACd,MAAIy5E,EAAgB,SACS,GAA3Bj4E,EAAO8rD,iBACLtrD,IAAIy3E,sCACJt/D,GAAkBu/D,WAAuB,mCAC3CmC,GAAA,CACFC,GAAAD,EAAA,EACEpC,MAoBJ,CAEAz5E,SAAsB+4E,GAAA,CAEpB,MAAM15C,iBACN,GAGA,GAAI,CAKJw8C,IAHIE,SACF,SAE4B,+BAC5BD,IAA4BC,cAAwB,MACpD18C,EAAA,gBACFy8C,GAAAD,EAAA,EACAtgE,0CAA6Bw9D,EAAwB,EAErD,MAAC,EACD,MACE,MAAAnd,GAAM34D,gBACN84E,cAA2B94E,CAC3B,MAAA44D,EAAMmgB,iCAA6C3xB,EAE/C2xB,MAAyB18C,sBAAe,EAC1Cj/B,GACE,WAAAo0D,EACAunB,yBACAD,EACF,GACAD,SAA4BC,cAAwB,cAAAhgB,GAAA,UACpDxgD,SAAkBygD,GAAA,QAAAH,CAA4BkgB,EAChD,IAAAzrB,EAAA0L,GAAAC,GAAA,OAEA57D,QAAc,EAChBiwD,EAAA,eAAAoJ,EAAA,EAGF,KAAMkC,CACN,MAAMF,GACJM,GACA,KAAM5N,GAAA,CACJ,MAAMyN,GAAa99D,wBAAuBquE,EAC1C,OAAMrQ,eAA6Bh1C,OACnC,GAIE80C,KAIAO,GAAMH,QACNG,GAAI9L,eAAoB2L,EAAmB,EAEzC3L,CACAA,GAA6C,OAC/C,GACF,gBAAOzxD,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,QACL,GACEw9D,GAAMF,OAAgBp1C,KACtB,MAAA80C,EAAOM,SAAgB,cAAe9pD,QAAQupD,EAAA,EAC/CG,GAAAF,GAAA,wBACGO,SAAa,KAAA3H,EAAA,yBAAAmH,EAAA,GACfQ,MAAYx1C,GAAM,IAAA6tC,EAAA,sBAAAsH,GAAA,UAClBK,YAA2B1C,SAAqB,EAClD,IAAAjJ,EAAAuL,GAAAC,GAAA,GACFxL,IAEFA,EAAA,QACEhqD,EAAQ,eAAAizD,EAAA,EAGZ,MAEA,MAAM2C,GACJL,GACA,KAAM5N,GAAA,CAEJ,MAAMyN,GAAa99D,wBAAuBquE,EAC1C,OAAMrQ,eAA6Bh1C,OACnC,GAIE80C,KAIAO,GAAMH,QACNG,GAAI3L,eAAoBwL,EAAmB,EAEzCxL,CACAA,GAA6C,OAC/C,GACF,gBAAO5xD,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,QACL,GACEy+D,GAAMnB,YAAgBp1C,UACwB,MAC/Ck1D,GADQ9f,SAAgB,cAAe9pD,QAAQupD,EAAA,GAC/C,8BACDqgB,IACE7f,SAAYx1C,CACoC,GAEpD,UACF,gBACA/nB,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,WAEE6H,GAA0BE,SAE9Bs1E,GAAAhgE,GAAA,OAEalY,GACV,CAEC,UAAM63D,CACN,QAAMogB,MACN,CACEA,GACF,CAAAE,EAAA,GACF,OACA10E,EAAA,OACEhB,wBACAC,uBAEJ,IAAA8I,GAAA,CAEAilD,YACAiH,GAAMwgB,UACJ7f,GAAOlxD,UACLixE,WAAW5sE,CAAA,EACA,SACX,KACF,SAAC,CAAA/H,EAAA,OACC00E,MAAM,sBAAAxC,EAAA,qBAEV,SACE,CAAAlyE,EAAA,UACK,OAAAi1D,EACHx0D,QAAMrJ,GAAA,CACA2Q,SAAS,sBACbilD,EAAcx0D,SAAUuP,UACnBvP,MACAA,SAAUuP,QACf8tD,CAAKr9D,CAEP6Z,EAAanS,WAEb9I,GAAA,CAAYA,EAAA,0BAAsB86E,GAAsChyE,EACtE,GAEEI,EACE,MAAKlJ,IAASutE,oBAAsB,GAClC3X,mBAAgC,MAAEriD,cAAK,SAAGiZ,GAAU,OAAS,MAAC,cAChE,UAAAzjB,EAAA4wD,GAAA,IAAA5wD,EAAA8T,GAAA,CACF,aACa7c,eACP,SAAUutE,KACZ8O,YACF,SACF,IAAAn3E,GAGW,YACT,CAAW,CAAa4D,CAEjB,EAACgC,CAAG,GAAIzB,OAAM,UAAcP,IAC1B,IAACW,QAAK,EAAY,GAAAV,EAAIY,MAAGzE,8BAAEy2E,GAAA5yE,EAAA,eAAA5F,SAAA,MAAM,wBAAC,KAAG04E,EAAA,GACrC,EAET9yE,WAAAS,EAAA,CAAAV,KACEC,WAAA5F,KAAA,IAA2B,IAAA+B,EAExBmE,CAAmBP,GACrB6yE,QACC,CACO,CACC,EAEJE,EAAiC,GACnC,GAAA/f,IAAEhzD,IAEG,WAAAF,EAAA,gBACHa,4BAAK,KACLC,SAAK,QACLC,IAAGzE,SAAE,kCAAwB,UAAC,EAC/B,SACK,CAAA6D,EAAAS,EAAA,CAEN,gBACH,EACJsyD,MAAW/xC,GAER1gB,WAAM,CACNJ,EAAK,EACLC,CACEmzE,YAAkB,GAAItzE,EAAA,OACtB6sD,yBAAgC,SAC9BriD,EAAK,aACLiZ,yBAAU,SACX5jB,EAAA,WACH,sBAAEE,SAEFC,GAACS,UAAI,CAACC,SAAK,CAAAb,EAAA,QAAa,SAACmC,GAAAvB,EAAA,iBAAgC,0BAE5D,SAEFyxE,MAAc13E,IACbwF,CAAW,YACTA,OAAA,CAAW,EAAAkyE,EAAA,OACT,CAAS5xE,EAAM,IAAAN,EAAA,SAAeD,MAC5BF,gBAAAE,SACEF,CAAA,CAAAE,EACO,GAACW,EAAK,UAAAV,EAAA,cAAWM,4BAAM,SAAyB4xE,EAAA,KAAAuC,EAAAl0D,KAAAvgB,EAAA,UAAK,KAAE,SAC5D5F,MAAA,eAAAC,QAAA,KAAAuJ,GACuBpJ,sCAAM,kBAG1B,MACHwF,SAAA,CAAOM,CAAqBP,EAAmB,SAAAwgB,GAAA,EAC3C,CACL2xD,CACC,EAAM5xE,CAAM,GAA2BP,OACpCmyE,CACC,MACEhyE,sBAAKgyE,EAAA,mCACL5xE,GAAM,WACS,IAAAm0E,GAAAz0E,EAAA,MACbg0E,cAA8Bj0E,CAEb,aAAA00E,CACL,EACH,GACR,GACH,EAES,EAEZ,GAAA50B,EAEJ,UAAAhgD,EAAA,aACM,kBACT,YACS,MAC2C,MAElDI,kBAAK+zE,SAAqBj0E,EAEzBmyE,GACC,GAAAnyE,QACoB,EAAC00E,KAA6B,SAAA50E,EAAA,oBAEnD,CAAAG,EAAA,WAAC,SACCA,EAAAgC,EAAA,CACE,YACN,QAGR69C,IAAwB,MACvB,CAAW,CAAiB9/C,CAC1B,CAAIO,IAAM,MAAiBP,WACzB,IAAAoS,GAAAtS,EAAA,MAAAzF,SAAA,CAAA4F,EAAA+jB,GAAA,CAA6B,QAAA5R,CAAA,CAE9B0tC,QACC9/C,UACEoS,EAAA,GAAApS,aACEiC,CAAA5H,CAAA,CAAAC,EAAA,EAAA8X,EACS0tC,IAAerlD,GAAM,GAG7BwF,EAAA,MAAC,SAEJ6/C,EAAA,IAAA1tC,GAAAtS,EAAA,MAAAE,SACG8/C,MAAoB1tC,CACnBpS,SACe,GAACoS,MAAiB,UAC9BstC,KAAoB,aACRttC,CAAQ/X,CACH,GAEd,EAAA+X,EAEF,OAEL,GAACygE,GACCG,GAAA,iCAAA/yE,EAAA,aAGPA,mBAAA,SAAAD,EACG8/C,OACC,MAAA9/C,yBACe,SAACoS,SAAiB,MAC/BnS,yBAAqB,WACRmS,UAAQ/X,CACnBqb,SAAUA,MAAMxe,GAAA,CAEd,MAEF,KAAA8rB,EAAA,EARK5Q,EAAQ/X,OAYtB,GAAA2oB,GAAA,CAGJ6vD,oBAEcQ,GAAAV,EAAA,CAAkB3yE,CACtBO,EAA8BP,UACjCC,EAAA,WAAKM,SAAMN,EAAAgC,EAAA,CAAwBjC,GACjCF,SACE60E,QACE,EAAM3B,EAAA,6BAAEhwD,EACR,GAAAowD,EAGgBpwD,GAAM2vD,2BAAUS,EAAA,IAAAwB,GAAA90E,EAAA,MAChC,UAAAA,EAAA,OACF,6BAAEE,SAEF,EAAA40E,EAAA,gBAAA30E,EAAA+jB,GAAA,CAAAhkB,gBACE,gBAAA1F,QAAAs6E,EAAA,QAAA/wE,gBAC6BgxE,MAAQC,OAAoB,kBAGxD,SAAA70E,EAAA8T,GAAA,CAEDq/D,oBACS,OAAAz5E,CAAA,MAAAi7E,EAAA,gBAAU50E,SAChB+jB,EAAM4R,GAAA,CAAO,OAAAi/C,EAAA,WAAE,SAGlBxB,WACE,CAAApzE,CAEI,CAAAA,CACE,CAAKO,IAAMw0E,GAAA,UAEM,EACXv/B,CAAe,GACf5f,KAAS,SAAAg/C,EACgB,SAG5BA,IAAQ/D,CACFtwE,EAAM,IACJ,GACG,EAAAq0E,IACF,EAAuC,GAnCjD30E,EAAA,KACR,iBACAozE,eACA36E,OAAQma,EAAI,EAAEmQ,EAgC2C,CAEpC,EACW6tD,EACX,EACG,GAAAuD,IACTn0E,EAAA,gCACG,SAAAA,EACH,MAEN80E,CAA8B,+BAC7BH,SAAiB30E,EACjB0e,GAAA,cAEJ1e,EAA2B,EACzB20E,EAEErB,YAAsB,qBACxB,SAAEzzE,EACF,kBAhCK80E,WAkCV,MAGN,mBACM5C,EACN,SAAA96E,GAAA,CACF+6E,EAAA/6E,EAAA,eAGVk9E,CACC,CAAK7zE,MAAMN,EAAAgC,EAAA,CAAkBjC,WAC3B,CAAKO,EAAM,EACI,GAAAT,EAACxE,MAAc84E,MAA2B,kBAAC,SACrD,CAAAn0E,EAAAgC,EAAA,CAGThC,WAAA,CAAK5F,EAAG,IAAA4F,EAAA,SAAiBD,mCACvBA,WACE,GACO,GAAAg0E,IACIhC,sCAEPC,aAAgB/6E,UAASukB,EACzB,CAEJphB,GAAA,SAA4B,EACvB4F,EAAAF,EAAA,CAETD,SAAA,IAAIS,CAAM,GAAiBP,EACzBC,cAAA,OAAAA,EAAAqwD,GAAA,yCACArwD,EAAA,qBAAAopC,KAAA,6BAAA/tC,GAAA,CAAOiF,MAAMjF,EAAA,iBAA4B0E,YAE1Cg0E,SACC,SAAA14E,EAAA,WAAS05E,GAAAC,GAAA,iBAAAlB,GAAA,eAAwB/zE,KACT5D,OAAG,MAAAq1B,GAAAwjD,GAAA,iBAAApB,GAAA,eAAAz3E,EAA2B6D,CAAAD,WAAE,CAAU,EAGnE9C,MAAyBzC,CACAF,SAAM,GAAeyF,EAKnCgyE,KAAgB12E,GAAsB,CACxC,UAAO,CACT,cACA,CACA,GAEA,OAAI05E,IAAc,CAChBjB,cAAakB,QACf,wBAGA,YACEA,QAC4B74E,YACxB,MAAA6D,EAAA,SAAA5F,MAAA,6BAAW,SAAA66E,CAAA,GACc,CACvBxqD,OAAU,CACX,SAAA/wB,EACP,aAAA2B,CAA4C,EAC1Cm5E,EAAW,MAAAn5E,EAAA,MAAAA,EACA,MAAAA,EAAA,KACX,GACDwE,EAAAC,EAAA,CACD,cACGi2C,WAAQ/1C,EAAAF,EAAA,UAAAC,EACNg1E,MACC,MAAIz0E,gBAAM,SAAiBP,MACzBC,KAAA,QAAAD,CAAOyxB,GAAc,IAAE,CAAA2yC,EACvBnkE,KAAAH,EAAA,YAAOS,wBAAM,SAA4BP,GACtCk1E,OACK,0BAGZj1E,SAAC0e,IAAY,CACXhlB,oBACA2B,UACKA,CACL,CAbWA,UAAaqnD,CAgB/B,6BAGL7iD,SAAAC,EAAA,cACGkhB,kBACC,CAAAjhB,CACE,CAAIO,EAAM,CAAeP,EACX,EAAU,GAAEihB,IAAWnZ,WACjC,WAAIvH,WAAM,SAAuBP,GAC/BC,EAAA,IAAKM,QAAM,GAAAN,EAAmBD,WAC3BU,KAAI,IAAAT,EAAA,eAACU,SAAK,QAAeC,IAAK2yE,EAAA,aAAMtzE,EAAAgC,EAAA,CAAC,GAExChC,QAAA,EAAW,GACT,GAAG,GAAA60B,GAAmB70B,EAAA41B,GAAA,UAClBggC,GAAA,CAETA,GACC0d,EAAA,CAIN,EAAS,SAAUvzE,EACjBC,SAAAgC,CAAA,oBACAhC,cAEA,SAAaghB,IAAA,kBAAS7gB,IAASA,EAAMmzE,EAAsB,MAAEvzE,CAC3D,sBAAwB,SACjBihB,IAAA,UAAAhhB,EAAA8jB,GAAA,CAEZ,UAGJ+Q,MACEe,YAEG,EACE09C,EAAkB,GACpB,GACFV,GAAAC,GAAA7yE,EAAAkE,GAAA,SAAEnE,IAGAG,WAAKjJ,EAAA,eACLqJ,EAAM,GACgB,EACW,SACjCoB,EAAO,aAAEm0D,QAAgB,GAAM,kCAAE91D,KAGxB,SAACiiB,GAAM,eAEdhiB,SAAA,4BAAwB,IAAA8yE,EAAA,IAEpB,SAAA9yE,EAAAS,EAAA,CAEX,SAEFmyE,MAGWvxE,CACJyxE,WAAkC,CACpC,CACF,CAAE/yE,CAEF,CAAKO,IAAM,UAAQlG,SAAG4F,EAAA,MAAyBkS,SAASlS,EAAAgC,EAAA,CAAIjC,WAC1D,CACEG,CAAK,CACLI,CAAM,GACNH,SAAe2yE,CAAoC/yE,SAEnDC,EAACS,OAAI,CAACC,SAAKzJ,GAAA,CAAI2J,iBAAGzE,QAAE,gBAAAo1E,GAAAn3E,mBAAO,eAAAq3E,GAAC,mBAAAC,EAAG,mBAAAC,EAAA,EAEjC16E,EAAA,OACE+I,EAAA,CAAAD,KACE3F,gBAAAm3E,GAAA,MAAoC,gBAAAC,GAAA,MAClC,eAAAC,GAAA,MAENzxE,mBAAA0xE,EAAA,MAAA3xE,mBACE4xE,GAAA,OAEI16E,EAAiBi+E,CAAA,EACjBpC,EAAM,cACJvB,CACAC,IACAC,0CACAC,KAEIrwE,CACA6zE,WAAY,CACbnC,EAEHvB,QAAiCl3E,IACFA,EACQA,iBAEzC,SAAA0F,EAAAgC,EAAA,CACAgxE,WACAF,EACA,GAAC9yE,EAAA,MAAY,CACX,MAAI,6BACF,SAAMvG,GAAuBue,QAC7B3b,SAASF,8BAAC0D,EAAA,mBAAAiS,EAAAw/D,GAAAvzE,CAAA,GAAA8B,EAAA,UAAgC,KAAA9B,EAAC,aAAAzD,SACjC,QACV7B,SAAcxB,GAAC,UACjB,eACC,SAAA+I,EAAAgC,EAAA,CACL,YAEAhC,CAAA,CAAAD,IACEiC,SAAA,gBAAmD,SAAAhC,EAAAgC,EAAA,CAErD,YAAW,EAA4BjC,EACpCsxE,YACO/2E,sBAEJ0F,EAAAgC,EAAA,CAAAjC,WACE,CAAAA,CAEE,CAAQoV,EAAMpX,EAAKjG,CAAcwC,EAAa,EAAAyD,CAAOgC,CACnD,EAAc,GAAAC,EAAA,IAAQD,CACpB,SAAAC,EAAA5F,SAAA,eAAoB,SAEtB4F,EAAAgC,EAAA,YAAc,EACZ,KAAoB,EAEtB,GAAc,EACZ,KAAoB,CACb,SAAAmzD,IACF,kBACJ,sDACJ,SAAAggB,GAER,cAAAV,CAEH,GACE,MAAa,SAAA/6E,CACX,EAAAwB,GAAA,GAAkB,QAAAk6E,CACZ,EAAAtgC,GACN,EAAAugC,EACAD,GAAA,QAAC,CACF,GAAAh7E,EACH,QAAAmmC,EAGP,SAAA+0C,EAET,OAAAC,EAEA,UAAAC,EACE,OAAAC,EACF,YAAA1Q,EAEA,UAAAzgD,EAA6BmwD,OAAgB,SAAAx6B,EAC3C,SAAAr9C,EAAQlD,gBACR,UAAAg8E,CAAM,EAAEN,EAAYtgC,EAAmB,SAAAiwB,CAAA,EACjCsQ,EAAiBD,GAASjjE,GAC1B0hB,EAAA,SAAAvP,CAAA,EACJlqB,eACAmmC,SACA+0C,2BACAC,gBACAC,UACAC,WACA1Q,6BACAzgD,YACAqxD,WACA17B,WACAr9C,EACAm8C,yBACArrB,aACAgoD,SACEjB,CAEJ,CACA,GAAMmB,OACN,MAAM/hD,gBACN,SAAMgiD,WAEN,SACEC,EAAA,cAAKx1E,SAAMiD,GAAAuyE,CAAA,EAAoB/1E,KAC5BgkB,IAAY6xD,GAAA/1E,EAAAC,EAAA,CAACqS,SAASkjE,uBACvBr1E,MAAA,KACEM,SAAMN,EAAAgC,EAAA,IACGivB,SAAqBgpB,QAAUvgD,SACxCw3B,YACEE,YACE1D,yBACD,EACH,CAEF7tB,CAAA,CAAGS,EAAM,CAAeP,EACtB,GAAMkD,SAAsC,MAAElD,yBACd,OAE/BukB,GACC,WACO,IACEyxD,GACP,MAAMz1E,CAAUP,OACd,MAAAklC,EAAA,GAAA+wC,EAAA,UAAAv1B,EAG+B,IAAAhuC,CAAC,EAAA9O,EAAA,OAAAC,WAD9B,MAAMX,SAAoC,MAEpC,gBAAA+yE,EAAA,wBAAC,CAAAvjE,GAAAguC,EAAAzgD,EAAA,OACF,IAAAyS,GAAAguC,EACF,IAAAtrC,EAEV,WAEHnV,OAAA,KAAKM,EAAMN,EAAA,QAAyBzH,SAAM4c,CAAA,CAAApV,MACvC21E,SAAeK,CACd,MAAM,QAAE5gE,eAAM8vB,IAAO+wC,EAAIv1B,GAAWhuC,EACpC,CACE,SAAAwjE,GAAanzD,EAAA,OAAmD,MAAArpB,CAE5D,EAAAyB,GAAA,EAAiBulD,SAAW7/C,GAAKuU,+BAAY,EAAY,CAEzD,SAAA2/D,GAAO3/D,UAET,GAAY,MAA4B,SAAAzb,CAAS,EAAAwB,GAC3C,EAEX,CAAA8lB,EAAA1D,CAAA,EAAAlkB,EAAA,WACG,CACH,QAAA+Y,EAET,WAAAy+D,CAEA,EAAA+D,EACQ,CAAAuB,EAAAC,CAAA,EAAA/8E,EAAA,IAAEK,YAAM,SAAQuH,GAAA,CACtBm1E,EAAap8E,EAAGC,CAAmB,CAEnC5B,SAAC,KACHu8E,GAAA,aACSG,IAAiCH,cAAW,UACnD,MAAMyB,EAAA,MAAAH,GAAAtB,EAAA,YAAEj7E,SAAawB,EAAI,UACzB,KACA,GAAAg7E,EAAMvB,GAAA,cAAExiE,KAASy+D,sBAAe+D,cAChC,MAAOuB,uCACP,QAAOl8E,KAEPm8E,EAAmB,GACjBA,EACF,UAAAn2E,EAAAS,EAAA,CAEArI,KAAU,eACJ,MAACu8E,oBACL,GAAKuB,MAAW,SAChB54D,SAAWtd,EAAAgC,EAAS,CACnB,YACC,OAAMo0E,CACNC,IAAiBD,QACjB94D,EACC,YACD44D,IAAWvB,OAASxiE,OAGtBrS,cAAA,CAAAC,CACE,CACO,CACLO,CAAM,OACGH,IAAM,CACbg2E,mBAAiB,CACnB,KAAEp2E,GAEFC,EAACS,GAAI,SAAMxJ,GAAA,CAAeqJ,WAAMrJ,EAAA,eAAwB+J,EACxDhB,CACE,WAAA3F,EAAA,aAE+B8X,QAAQ2N,SAAQ,cAAAnc,GAAA,wBAA7C,MAAMrD,cAAM,QAAwCU,EAAC,SAAAhB,EAAAS,EAAA,CAChD,SACA,IACTT,QAAK,CAACU,CAAK,CAAiB,EAAAV,EAAA,UAE7Bk2E,WACCl2E,IAACkE,UACiBlE,EAAAgC,EAAA,CACRX,YACJL,OAAQ,CACV,EAAAmR,EAAA,UACApS,WAEF,CAAW,EAAAC,EAAA,QAAiB,qBAAID,CAC9B,CAAa,CAASO,CAAM,CAAcH,CAASa,GAAQjB,SACxDU,CAAI,SAAMugB,IAAA,UAAAhhB,EAAA,KAAIY,MAAK5H,WAAW,SAAAgH,EAAA8jB,GAAA,CAEjC9jB,OAAA,GAAAD,CACE,GAAAA,EACEiC,OAAAhC,EAAA,yCAAA/I,GAAA,MAE+Bkb,CAAgB,OAAA9Q,CAAA,EAAAsC,GAAAC,SAA7C,oBAAA3M,EAAA,uBAAA+J,EAAMV,CAA8C,EAAC,SAChDN,EAAA0e,GAAA,CACN,SAAAhlB,EAELsG,eAAAD,SACGihB,EACC,CAAG1gB,CAAM,EAAUP,CACV,GAAO,EAAE,GAIhB,EACQ,CAEJ,SAAAu2E,GAAM,SAAA3B,EAAEtzE,UAER,GAIEL,MAAQ,EAAAic,CACV,EAAAhkB,GACF,GAEa,MAAAQ,CACXC,OACA2B,GACAinD,CAAQ,EAAAlpD,EAAA,YAAAsmD,EACTC,CAAA,EAAAvmD,EAAA,MAAAm9E,EAEJ72B,IAAA,YAEC7/C,EAAC,WACJ,+BAAC,SAET,CAAAG,EAAA,UACD,cAEN,SAAAghB,IAAA,WAAAu1D,EAEA,QAASD,KAA6B3B,cAASl/D,UAAY,IACnD,MAAAhc,EAAA,kCAAAk7E,EAAA,aAAE37E,YAAGC,EAAA,WACLwc,EAAA,CAAEhc,UAAc,cACtB,CAAOunB,EACA0+B,MAII,YACP1/C,OAAA,CACO,EAAA20E,EAAA,iBAC8B4B,CAEjCj5D,EACC,MAAY,CACXA,EAAI,SACFjhB,GAAM5C,EAIN6jB,CACA7H,WAAS,CACPk/D,EACO,CAETt4E,IAAS4gB,WACPjd,EAAAgC,EAAA,qBAAAhC,EAAA4D,UAAwCkc,cAAQ,SAAmCkB,IAAA,WAAAu1D,EAAA,MACrF,2BACOjlE,CACPgM,WAAW,GACX7kB,UACA4D,IAAS4gB,4DAAC,WAAAK,EAAA,WAAA7H,EAAuC,CAAC,QAAAk/D,EACpD,gBACC,EACLt4E,GAAA4gB,EAEA,CAAmB,YAErBjd,OAAA,CACO,EAAA20E,EAAA,iBAC8B4B,CAC7B,EAEJj5D,MAAW,CACVA,EAAY,SACXjhB,GAAI4gB,EAIF0iC,CACAriC,WACA7H,CAAS,EACPk/D,CACO,IAETt4E,EAAS4gB,yBACP,KAAAjd,EAAA,OAAA3F,CAAA,oCAAwCylB,SAAQkB,IAAA,UAAAhhB,EAAA8jB,GAAA,QAAyD,KAAA47B,IAC3G,SAAA1/C,EAAAS,EAAA,qBAEA6c,MAEAjhB,CAAS4gB,YAAC,QAAwC,0BAAAyiC,IAAC,WAAA1/C,EAAAS,EAAA,MACrD,WACF,IAAGwc,EACHld,CAEF,YAAqB,EAEjBO,MAAM,yBAA6BP,CAE9B,GAAO,EAET,CACE,MAAAy2E,GACFv5D,OCvuCTgP,GAAQ,GAEd,SAASwqD,GAAO,CAAE/gE,QAAO/X,aAAY,GAAGgmD,CAAM,EAAG,CAC/C,KAAM,CAAE3qD,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAC/B88E,EAAU,CAAC,CAAChhE,EACZrf,EAASsH,EAAa,GAAKm7D,KAC3B,CAAEr/D,QAAOC,YAAawB,GAAI,CAC9BxB,SAAUiqD,GAAOjqD,UAAYrD,EAAOqD,SACrC,EACK,CAAED,MAAOuuB,EAActuB,SAAUuuB,GAAoB/sB,KACrDmI,EAAelH,EAAPu6E,EACV,CAAAt8E,GAAA,SAAAC,OAAA,CAAAX,WAA4B,EAC5B,CAAAU,GAAA,SAAAC,OAAA,CAAAX,WAAgC,CADF,EAElCohE,GAASz3D,EAAOqzE,EAAU,kBAAoB,eAAe,EAE7D,MAAM1L,EAAa7yE,IAEbw+E,EAAiBx+E,IACvB,eAAey+E,EAAYpoD,EAAW,CACpC,GAAIA,GAAa,CAACmoD,EAAet+E,QAAS,CACxC,MAAMiG,EAAO,CACXpE,MAAO+xB,GACPvW,MAAOghE,GAAWj4E,QAEhB,CAACi4E,GAAWlzD,GAAS,uBAAuB,IAC9CllB,EAAKu4E,OAAS,IAEhBF,EAAet+E,QAAUoB,EAAMM,GAAGiyE,UAAUpyB,OAAO3/C,KAAKqE,CAAI,EAAEjE,QAChE,CACA,MAAMyvB,EAAU,MAAM6sD,EAAet+E,QAAQkC,OAC7C,GAAI,CAAED,SAAUwvB,EAChB,OAAIxvB,GAAOE,SACLg0B,IACFw8C,EAAW3yE,QAAUiC,EAAM,CAAC,EAAEF,IAIhCE,EAAM8M,QAASo/C,GAAS,CACtB4F,GAAW5F,EAAM9sD,CAAQ,CAC3B,CAAC,GAEI,CACL,GAAGowB,EACHxvB,QAEJ,CAEA,eAAewB,GAAkB,CAC/B,GAAI,CACF,MAAMguB,EAAU,MAAMrwB,EAAMM,GAAGiyE,UAAUpyB,OACtC3/C,KAAK,CACJC,MAAO,EACPwb,MAAOghE,EACPtK,SAAUpB,EAAW3yE,QACtB,EACAgC,SACAE,OACH,GAAI,CAAED,SAAUwvB,EAChB,MAAMuhD,EAA0B/wE,EAAM,CAAC,GAAGF,KAAO4wE,EAAW3yE,QAC5D,OAAIiC,GAAOE,QAAU,CAAC6wE,GACpB/wE,EAAQ2wD,GAAc3wD,EAAO,QAAQ,EAC9B,IAEF,EACT,MAAY,CACV,MAAO,EACT,CACF,CAEA,OACE0F,EAAC+xD,GAAQ,CAEP1uD,QACA2uD,eACEnyD,EAAA,MAAIS,MAAM,sBAAqBP,UAC7BC,EAAA,KAAAD,SAAW5D,EAAPu6E,EAAU,CAAAt8E,GAAA,UAAoB,CAAAA,GAAA,SAAJ,CAAyB,CAAI,EAC3D4F,EAAA,OAAAD,SAAMrG,EAAc,CAAC,EACnB,EAENU,GAAG,SACHV,WACAu4D,UAAS91D,EAAE,CAAA/B,GAAA,SAAiC,EAC5C83D,UAAS/1D,EAAE,CAAA/B,GAAA,SAAsB,EACjCg4D,WAAYwkB,EACZ96E,kBACAq2D,UAAS,GACTG,YAAatyD,EAAAF,IAAI,EACjB4b,eAAgBze,EAAWW,SAAS8d,eAEpCy0C,cAAc,SACdoC,UACE1yD,EAACoT,GAAK,CACJ7R,OAAM,GAEN4pB,SAAS,OACTq/B,WAAW,QACXv/B,SAAS,SACT5X,WACElT,EAAA,UAAQE,KAAK,SAASI,MAAM,QAAOP,SACjCC,EAACS,EAAI,CAACC,KAAK,OAAOC,KAAK,IAAIC,IAAGzE,EAAE,CAAA/B,GAAA,SAAM,CAAC,CAAG,EACpC,EACT2F,SAAA,CAEDC,EAAC8C,GAAQ,CAACqQ,KAAMujE,EAAU,MAAMh9E,CAAQ,KAAO,MAAMA,CAAQ,OAAOqG,SACjE22E,EACC72E,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAACS,EAAI,CAACC,KAAK,WAAY,EAAE,IACzBV,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAiC,EAC7B,CAAC,EACP,EAEFyF,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAACS,EAAI,CAACC,KAAK,WAAY,EAAE,IACzBV,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA6B,EACzB,CAAC,EACP,EAEI,EACV4F,EAACiC,KAAa,EACdpC,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACb,IAAIitE,EAAc0J,OAAM36E,EACtB,CAAA/B,GAAA,SAA6C,CAC/C,EACA,GAAI,CAAC,KAAK4J,KAAKopE,CAAW,EAAG,CACvBA,GAAa7xD,MAAKpf,EAAC,CAAA/B,GAAA,SAAkB,CAAC,EAC1C,MACF,CACIgzE,IACFA,EAAcA,EAAYpvE,cAAc6oB,OAExCxX,SAASpL,KAAOyyE,EACZ,IAAItJ,CAAW,OACf,IAAIA,CAAW,KAEvB,EAAErtE,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,MAAO,EAAE,IACpBV,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAqC,EACjC,CAAC,EACC,EACT6tB,IAAoBvuB,GACnBmG,EAACiD,GAAQ,CACP3C,QAASA,IAAM,CACbkP,SAASpL,KAAOyyE,EACZ,IAAIzuD,CAAe,OACnB,IAAIA,CAAe,IACzB,EAAEloB,SAAA,CAEFC,EAACS,EAAI,CAACC,KAAK,MAAO,EAAE,IACpBV,EAAA,SAAOM,MAAM,oBAAmBP,SAC9BC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAC,OAAA,CAAA4tB,mBACwCtkB,WAAA,CAAAC,EAAnB5D,EAAA,MAAuB,EAAC,CACtC,EACF,CAAC,EACA,CACX,EACI,GAzFJtG,EAAWg9E,CA2FjB,CAEL,CCnKA,SAAwBK,GAAe,CAAEC,aAAY,EAAG,CACtD,KAAM,CAAEh+E,KAAGC,KACL,CAAES,YAAawB,KACf,EAAG6W,CAAM,EAAIC,GAAYgD,GAAMA,EAAI,EAAG,CAAC,EACvCmxC,EAAUD,KAEV+wB,EAAiBA,IAAM,CAC3BnwB,KACAzqD,GAAU,CACR8qB,KAAIhrB,EAAE,CAAA/B,GAAA,SAAyB,EAC/B4M,MAAO,IACR,EACD+K,GACF,EAEMmlE,EAAmBA,CAAChmC,EAAOoV,IAAc,CAC7CM,GAAwB1V,EAAOoV,CAAS,EACxCv0C,GACF,EAEM,CAAColE,CAAO,EAAIlrE,KAElB,OAAIk6C,EAAQ3rD,SAAW,EACd,KAIPqF,EAAA,OAAKS,MAAM,kBAAiBP,UAC1BF,EAAA,OAAKS,MAAM,yBAAwBP,SAAA,CACjCC,EAACS,EAAI,CAACC,KAAK,UAAW,EAAE,IACxBV,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA6B,EACzB,EACN4F,EAAA,QAAMM,MAAM,SAAU,EACtBN,EAAA,UACEE,KAAK,SACLI,MAAM,eACNH,QAAS82E,EACT50E,SAAU8jD,EAAQ3rD,QAAU,EAAEuF,SAE9BC,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAuB,EACnB,EACA,CAAC,EACN,EACL4F,EAAA,MAAIM,MAAM,iCAAiCL,IAAKk3E,EAAQp3E,SACrDomD,EAAQ3jD,IAAKylD,GAAgB,CAC5B,KAAM,CAAE3lD,QAAOP,KAAIrB,QAASqmD,GAC1BkB,EAAY/W,MACZ+W,EAAY3B,UACZ5sD,CACF,EAEA,OACEmG,EAAA,MAEES,MAAM,uBAAsBP,SAAA,CAE5BF,EAACiU,GAAI,CACH/R,KACAzB,MAAM,uBACNH,QAAUlJ,GAAM,CACdovD,GAAmB4B,EAAY/W,MAAO+W,EAAY3B,SAAS,EAC3D0wB,IAAc//E,CAAC,CACjB,EAAE8I,SAAA,CAEFC,EAACS,EAAI,CAACC,OAAYJ,MAAM,qBAAsB,EAC9CN,EAAA,QAAMM,MAAM,wBAAuBP,SAAEuC,EAAY,CAAC,EAC9C,EACNtC,EAAA,UACEE,KAAK,SACLI,MAAM,eACNH,QAASA,IACP+2E,EAAiBjvB,EAAY/W,MAAO+W,EAAY3B,SAAS,EAC1DvmD,SAEDC,EAACS,EAAI,CAACC,KAAK,QAAQE,IAAGzE,EAAE,CAAA/B,GAAA,SAAO,CAAC,CAAG,EAC7B,CAAC,GAtBJ,GAAG6tD,EAAY/W,KAAK,IAAI+W,EAAY3B,SAAS,IAAI2B,EAAYvB,SAAS,EAuBzE,CAER,CAAC,EACC,CAAC,EACF,CAET,CC9EA,MAAM0wB,GAAc,EACdnrD,GAAQ,GACRkkD,GAAoB,IAAItgE,gBAExBiiD,GAAwB,CAC5BpuC,MAAO,UACPumC,OAAQ,SACRxmC,SAAU,QACZ,EAEA,SAAS4zD,GAAO,CAAE15E,aAAY,GAAGgmD,CAAM,EAAG,CACxC,KAAM,CAAE3qD,KAAGC,KACL5C,EAASsH,EAAa,GAAKm7D,KAC3B,CAAEr/D,QAAOC,WAAUkgB,iBAAkB1e,GAAI,CAC7CxB,SAAUrD,EAAOqD,SAClB,EACK,CAACsnB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAACguD,CAAY,EAAIzpD,EAAa,CAACwyE,EAAiB,EAAI7oB,KACpD8B,EAAgBjxD,IAChB8xB,EAAI05B,GAAOzS,OAASkW,EAAavzC,IAAI,GAAG,EACxC3T,EAAOvC,EACT,WACAgmD,GAAOzjD,MAAQknD,EAAavzC,IAAI,MAAM,EAC1C,IAAIxQ,EAAKlH,EAAG,CAAA/B,GAAA,SAAQ,EACpB,GAAI6vB,EACF,OAAQ/pB,GACN,IAAK,WACHmD,EAAKlH,EAAG,CAAA/B,GAAA,SAAAC,OAAA,CAAA4vB,IAAa,CAAS,EAC9B,MACF,IAAK,WACH5mB,EAAKlH,EAAG,CAAA/B,GAAA,SAAAC,OAAA,CAAA4vB,IAAa,CAAY,EACjC,MACF,IAAK,WACH5mB,EAAKlH,EAAG,CAAA/B,GAAA,SAAAC,OAAA,CAAA4vB,IAAa,CAAY,EACjC,MACF,QACE5mB,EAAKlH,EAAG,CAAA/B,GAAA,SAAAC,OAAA,CAAA4vB,IAAa,CAAC,CAAC,CAG7B6wC,GAASz3D,EAAO,SAAS,EAEzB,KAAM,CAACwxB,EAAUC,CAAW,EAAI17B,EAAS,EAAK,EACxCk+E,EAAYn/E,EAAO,CAAC,EAC1BC,EAAU,IAAM,CACdk/E,EAAUj/E,QAAU,CACtB,EAAG,CAAC4xB,EAAG/pB,CAAI,CAAC,EAEZ,MAAM2sD,EAAgB10D,IACtBgmC,GAAgB,IAAM,CACpB0uB,EAAcx0D,SAASomC,WAAW,EAAG,CAAC,CACxC,EAAG,CAACxU,EAAG/pB,CAAI,CAAC,EAEZ,KAAM,CAACq3E,EAAeC,CAAgB,EAAIp+E,EAAS,EAAE,EAC/C,CAACq+E,EAAgBC,CAAiB,EAAIt+E,EAAS,EAAE,EACjD,CAACu+E,EAAgBC,CAAiB,EAAIx+E,EAAS,EAAE,EACvDhB,EAAU,IAAM,CACdo/E,EAAiB,EAAE,EACnBE,EAAkB,EAAE,EACpBE,EAAkB,EAAE,CACtB,EAAG,CAAC3tD,CAAC,CAAC,EACN,MAAM4tD,EAAc,CAClBj7E,SAAU26E,EACV76E,SAAU+6E,EACV9L,SAAUgM,GAENG,EAAqB,CACzBl7E,SAAU46E,EACV96E,SAAUg7E,EACV/L,SAAUiM,GAGN,CAACt0D,EAAkBC,CAAmB,EAAInqB,EAAS,EAAE,EACrD87B,EAAoB,MAAOx4B,GAAa,CAC5C,GAAI,CAACA,GAAUlC,OAAQ,OACvB,MAAMopB,EAAgB,MAAMD,GAAmBjnB,EAAU4mB,CAAgB,EACrEM,GACFL,EAAoB,CAClB,GAAGD,EACH,GAAGM,EACJ,CAEL,EAEA,SAASm0D,EAAYvpD,EAAW,CAC1BA,IACF8oD,EAAUj/E,QAAU,GAGlB,GAACm2B,GAAa,CAAC5U,KAKnB0D,EAAW,SAAS,EAChBkR,GAAa,CAACtuB,IAChBs3E,EAAiBD,EAAc/qE,MAAM,EAAG4qE,EAAW,CAAC,EACpDM,EAAkBD,EAAejrE,MAAM,EAAG4qE,EAAW,CAAC,EACtDQ,EAAkBD,EAAenrE,MAAM,EAAG4qE,EAAW,CAAC,IAGvD,SAAY,CACX,MAAM/gF,EAAS,CACb4zB,IACAC,QAAStQ,EACT1f,MAAOk9E,IAELl3E,IACF7J,EAAO6D,MAAQ+xB,GACf51B,EAAO6J,KAAOA,EACV0Z,IAAevjB,EAAO4sC,OAASq0C,EAAUj/E,UAG/C,GAAI,CACF,MAAMyxB,EAAU,MAAMrwB,EAAMswB,GAAGC,OAAO/vB,KAAK5D,CAAM,EACjDoC,KACA,GAAIyH,EAAM,CACR43E,EAAe53E,CAAA,EAAA4pB,EAAA5pB,CAAA,GACb43E,UAAuB53E,CAAE4pB,UACzBwtD,EAAM98E,QAASsvB,GACfwtD,EAAUj/E,GAAU4zB,CACpB6I,SACFhL,EAAO5pB,CAAA,aAAA23E,EAAA33E,CAAA,WAGL40B,EAAY50B,EAAI,MACd40B,CACFgjD,EAAO53E,CAAA,EAAAmK,IAAA,IAAAA,GAAA,GAAAyf,EAAA5pB,CAAA,IACL43E,UAAuB53E,CAAGmK,UAC1BitE,EAAM98E,QAASsvB,EAAetvB,WAC9B88E,EAAUj/E,GAAUi/E,CACpBxiD,MAGN0iD,EAAO1tD,EAAA,cACL0tD,EAAiB1tD,EAAQltB,YAAc,EACvC86E,EAAkB5tD,EAAQptB,UAAY,EAAE,EACxCk7E,UAAkB9tD,EAClBwtD,EAAUj/E,IAEZ68B,EAAApL,EAAA,UACAoL,YAEA5X,MAAW,GACJ9F,OAAK,CACZ/e,CACA6kB,KAAkB,CACpB,MACCi4C,GAAAp9D,EAAA,EACLH,GAAAkB,GAAA,CAEA,UAA8B,uBAC9BlB,QAAmBkB,CACjB,MAAMs0D,EAAaX,cAAuB3C,YAC3BsD,SAAYl2D,EAAA,MACzBygF,EAAMzgF,EAAWoL,EAGfq1E,GAAY,QAAI,UAEhBxiB,CAAkC,GACpCn9D,EACF,KACD,IAAAwmB,EAEDxmB,SAAgB,oBAAA6xB,GAAA,IACVrL,EACJwqC,EAAc/wD,IAEZ0/E,aAAgB,KAClB3uB,EAAO,kBACLxqC,OAEG,IAAG,aAAAA,CAAA,GACR,CAAAqL,EAAA/pB,EAAAxG,CAAA,GACA0C,GAAO,cAAmBwiB,GAAK,CACjCwqC,WAAsB,UAEtBhtD,EACG,SAAY,SACZnF,CACCmyD,GACAA,UACF,eACA,GACEvqD,gBAAQ5H,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,WACQ,MAChB6H,+CAEJg1D,EAAA13D,GAAA,SAEA,MAAM43D,WAAgB,sBAAAA,CAAA,EAChBF,EACJG,GACM,wBACEA,QAAa99D,KAAS+9D,EAAcsQ,QAAQxQ,iBAAaA,CAAA,GAC/D,GAAAC,GAAME,MAA6Bh1C,UAAsB,cAAAg1C,EAAA,UACzD,QAAuBpnD,UACP1U,CAAQgG,EAExB,IACE41D,OACqBpH,GAGrBnE,KACAA,GAAIA,MAAW0L,EACf1L,GAAIA,eAAUoJ,EAAA,EAEZpJ,MACF,MAAA8L,EAAAJ,EAAA,KAAA5N,IAAA,CACF,MAAO+N,GAAA/N,GAAA,wBACL,OAAMgO,QAAcJ,IAASr/C,GAAMyxC,MAAS,CAC1C,GACAgO,IACDA,EAAA,QACDA,EAAIA,eAAa1C,EAAA,EAEf0C,CAAgD,GAEpD,UACF,gBACAv9D,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,WAEE6H,SAA0BE,KAE9B,MAAAi1D,EAAA,+BAAAD,CAAA,EAEMS,EACJR,GACM,wBAEEA,QAAa99D,KAAS+9D,EAAcsQ,QAAQxQ,iBAAaA,CAAA,GAC/D,GAAAC,GAAME,MAA6Bh1C,UAAsB,cAAAg1C,EAAA,UACzD,QAAuBpnD,UACP1U,CAAQgG,EAExB,IACE41D,OACqBpH,GAGrBhE,KACAA,GAAIA,MAAWuL,EACfvL,GAAIA,eAAUiJ,EAAA,EAEZjJ,MACF,MAAA2L,EAAAJ,EAAA,KAAA5N,IAAA,CACF,MAAO+N,GAAA/N,GAAA,wBACL,OAAMgO,QAAcJ,IAASr/C,GAAMyxC,MAAS,CAC1C,GACAgO,IACDA,EAAA,QACDA,EAAIA,eAAa1C,EAAA,EAEf0C,CAAgD,GAEpD,UACF,gBACAv9D,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,WAEE6H,IAAwB7H,KAC1B,OACF+I,EAAA,OAEA,GAAM,cAEN,uBAEI5F,SAAG,KACHkG,OAAM,CACN4R,EAAS,QAAAtK,IACHA,QAASA,EACbilD,UAAcx0D,CACdy7D,EACAW,SAAKp8D,QAAUuP,CACjB,2BAAE7H,YAEF,UAAKO,MAAM0gB,IAAA,uBAAoBjhB,SAC7BC,EAAA,OAAQM,MAAO0gB,cAAuCjhB,YACpD,OAAKO,MAAM,cAAaP,SACtBC,EAAA4wD,GAAA,MAAKtwD,EAAM4mD,GAAA,CAAannD,KACZ,CACP,EACLC,EAACknD,OAAWjnD,MAAKmpD,cAAgB,SACjCppD,EAAA,UAAKM,KAAM,SAAaP,cAEpBG,QAAK,KACLI,EAAM,GACNH,EACE43E,aAAgB,UAClB,SAAA/3E,EAAAS,EAAA,eACgCV,SAE1BW,MAAuBE,CAAGzE,YAAE,GAAQ,EAAC,GAAG,EACxC,GAAC0D,EACL,iBACH,GAAAoqB,GAAA,CAAAtsB,GAAAkC,EAAA,OAEPA,MAAAE,oBACWpC,cACP,eACEsC,SAAK+3E,YACL13E,aAAO2pB,EAAA,MAAcjJ,mBAAwBiJ,mBAE3C,CAAC/pB,KACK6B,mBAAoD,CAAGhC,QAC3DC,EAAK,CAACU,WAAK,CAAgB,EAAE,GAAAtG,EAAA,MAAkB+B,EAK/CmG,CAAKnG,YAAE,OAAU,WAAC,mCAAA8tB,CAAA,mBAClB/pB,CACA6B,MAAI5F,EAGJmG,CAAKnG,YAAE,OAAU,WAAC,mCAAA8tB,CAAA,mBAClB/pB,CACA6B,MAAI5F,EAGJmG,CAAKnG,YAAE,OAAO,WAAC,mCAAA8tB,CAAA,oBACf/pB,KAAM,CAAA6L,EAAAsJ,IACFtJ,EAAA,OAAA7L,EAAaw6C,GAGlBtlC,EAAK,OAAIC,EAAM,EACRnV,CACN,MAAMA,GAASA,EAAM4T,GAAA,CACrB,GAAA2sD,EAAO,GACR,SACKA,EACJzgE,KAAK,IAAKygE,IAAK1+D,UACZ0+D,EAAKn+D,CAAK,SADgBpC,EAEvB,CACPA,GAACA,IAAA,aAAAL,EAAAC,EAAA,CAGP,cACCA,YAAAD,EAAA,8BAEIE,SACGG,KAAS,CACJI,WAAM,CAAiBP,QACzBC,GAAAgC,CAAA5H,GAAA,gCAAA6vB,CAAA,kBAAsB,SACtBjqB,EAAC8T,EAAI,CACH/R,KAAI,cAAmDhC,SAEjDW,MAA4BE,CAAGzE,YAAE,GAAU,GAAC,GAACs7E,EAAE,SAAA53E,EAAAC,EAAA,CAAC,SACjD,CAAAE,EAAA,MAGVy3E,oCACC13E,SACEC,EAAA,IAAAmS,GAAAnS,EAAA,MAAIM,SAAMN,EAAA+jB,GAAA,CAA6BhkB,UAEnCA,WAEIoS,aACAzY,sBACS,EAAAyY,EACT8R,IAAyC,GAAE/jB,IAC5C,YAAAF,EAAA,OAAC,MANKmS,WAST,SACHjS,EAAS4T,GAAA,CACHxT,MAAM,eAAUP,gBAClB+T,mBAAImW,CAAA,kBACH3pB,SAAM,CAAAN,EAAAgC,EAAA,CACND,GAAI,QAEH,CAAiBhC,QAElBC,EAAAgC,CAAA5H,KAAA,cAA+B,EAC1B,EAAM,GAAgB,GACvB,CAAA8F,IAAA8gB,IAAA,UAAAhhB,EAAA,KAAC,MAEV,WACD,WAGDghB,IACI1gB,OAAM,GAAUP,CACV,GAACiiB,MAAM,OAAE,WACf,SAEHhiB,EAAAgC,EAAA,CAAG1B,WAAM,CAAUP,CACjB,QAAgC,CAAAG,OAAA,aAAAL,EAAAC,EAAA,CAAC,SAGtC,CAAAI,IAAA,YAAAL,EAAA,MACD,wBAGFE,SACGG,KAAS,CACJI,WAAM,CAAiBP,QACzBC,GAAAgC,CAAA5H,GAAA,gCAAA6vB,CAAA,kBAAsB,SACtBjqB,EAAC8T,EAAI,CACH/R,KAAI,cAAmDhC,SAEjDW,MAA4BE,CAAGzE,YAAE,GAAU,GAAC,GAACw7E,EAAE,SAAA93E,EAAAC,EAAA,CAAC,SACjD,CAAAE,EAAA,MAGV23E,+BACC53E,SACEC,EAAA,IAAA+5C,GAAA,CAAIz5C,KAAM,CAAwBP,OAE9B,QAAAomD,CAAM,EAAEhxC,EAAMgxC,uCAAQ,OAAIpM,QAC1B,SAAMttB,EAAQ05B,GAAS8xB,CAIvB,KACE,IAAAv+E,CAAA,MAAAyb,CAAA,SAAAA,CAAA,GAAApV,YACG+T,EAAI,CACH/R,eAIChC,OAEI,GAACW,EAAK,QAAUE,SAAIuU,CAAA,CAAK,EAC9BnV,OAAA,QAAAD,cAAkB,SACf0sB,GACDA,CAAA,GAAMnsB,CAAM,EACU,KAEvB6U,CAAA,IAAAsX,CAAA,KACG,GAACvsB,IAfGiV,YAgBRnV,EAAA,OAER,MAAC,WACC,SACHE,EAAS4T,GAAA,CACHxT,MAAM,eAAUP,gBAClB+T,mBAAImW,CAAA,kBACH3pB,SAAM,CAAAN,EAAAgC,EAAA,CACND,GAAI,QAEH,CAAiBhC,QAElBC,EAAAgC,CAAA5H,KAAA,cAA+B,EAC1B,EAAM,GAAgB,GACvB,CAAA8F,IAAA8gB,IAAA,UAAAhhB,EAAA,KAAC,MAEV,WACD,WAGDghB,IACI1gB,OAAM,GAAUP,CACV,GAACiiB,MAAM,OAAE,WACf,SAEHhiB,EAAAgC,EAAA,CAAG1B,WAAM,CAAUP,CACjB,QAAgC,CAAAG,OAAA,aAAAL,EAAAC,EAAA,CAAC,SAGtC,CAAAI,IAAA,YAAAL,EAAA,MACD,wBAGFE,SACGG,KAAS,CACJI,WAAM,CAAiBP,QACzBC,GAAAgC,CAAA5H,GAAA,gCAAA6vB,CAAA,kBAAmB,SACnBjqB,EAAC8T,EAAI,CACH/R,KAAI,cAAmDhC,SAEjDW,MAA4BE,CAAGzE,YAAE,GAAU,GAAC,GAACo7E,EAAE,SAAA13E,EAAAC,EAAA,CAAC,SACjD,CAAAE,EAAA,MAGVu3E,iBACCx3E,SACEC,EAAA,IAAAwO,GAAAxO,EAAA,MAAIM,SAAMN,EAAA8T,GAAA,CAAU/T,MACjBw3E,cACCx3E,KACG+T,IAAIpa,CAAA,MAAA8U,EAAA,WAAAA,EAAA,KACHlO,SAAMN,EAAA01B,GAAA,CACN3zB,QAGqB,CACpBhC,CAEM,EAACyO,IAAiB,OAACtO,IACtB,YAAAF,EAAA,OAAC,MAVAwO,WAaT,SACHtO,EAAS4T,GAAA,CACHxT,MAAM,eAAUP,gBAClB+T,mBAAImW,CAAA,kBACH3pB,SAAM,CAAAN,EAAAgC,EAAA,CACND,GAAI,QAEH,CAAiBhC,QAElBC,EAAAgC,CAAA5H,KAAA,cAA4B,EACvB,EAAM,GAAgB,GACvB,CAAA8F,IAAA8gB,IAAA,UAAAhhB,EAAA,KAAC,MAEV,WACD,WAGDghB,IACI1gB,OAAM,GAAUP,CACV,GAACiiB,MAAM,OAAE,WACf,SAEHhiB,EAAAgC,EAAA,CAAG1B,WAAM,CAAUP,CACjB,QAA6B,CAAAG,IAAA8gB,IAAA,UAAA6T,EAAA70B,EAAA41B,GAAA,CAAC,SAGnCggC,GAAA,MAOcA,CAEPmiB,EAAY,SACd/3E,EAAA,UACF,cAAED,oBAGAG,QAAK,IAAA63E,EAAA,EACLz3E,MAAM,CACNH,eAAe43E,KAAY,EACpB,SAAEliB,IAAgB,CAAM,YAAE91D,CAEjC,KAAwBC,EAAA,KAAC,MACnB,yBACF,SAERA,EAAAgC,EAAA,CAAG1B,WAAM,CAAwBP,CAC/B,GAAA3F,IAAA,WAAA4F,EAAA,WAAsB,WACrB,SAGLghB,EAAY8C,GAAA,CACPxjB,OAAM,GAAUP,CACV,IAAO,GAAEihB,IAAA,UAAAhhB,EAAA,KAAC,MAGrB,WACJ,SACAghB,EAAY8C,GAAA,CACXxjB,OAAM,GAAUP,CACV,GAACiiB,IAAM,UAAE,CAAAhiB,EAAA,KACf,MAEHF,yBAAAC,SACEC,EAAAgC,EAAA,CAAG1B,WAAM,CAAwBP,CAC/B,GAAA3F,EAAA28E,GAAA,OAEO,GAES,EAErB,EACI,CCnjBf,MAAM9qD,GAAQ,GACRisD,GAAmB,IAAU,IAE7BC,GAAa57E,GAChB9C,GACQA,EAAMM,GAAGq+E,OAAO/X,MAAMpmE,OAAOI,SAASE,OAE/C,CACEwC,OAAQm7E,EACV,CACF,EAEMnM,GAAgBxvE,GACnB9C,GACQA,EAAMM,GAAGq+E,OAAOr/B,KAAK9+C,OAAOI,SAASE,OAE9C,CACEwC,OAAQm7E,EACV,CACF,EAEA,SAASG,GAAoB5+E,EAAO,CAClC,OAAI+pB,GAAS,oBAAoB,EACxB/pB,EAAM6+E,SAASvuD,GAAGwuD,SAAS94E,MAAMu6C,SACrC//C,KAAK,CACJ4lC,MAAO,QACR,EACAxlC,SAEEZ,EAAMM,GAAGq+E,OAAOx7E,SACpB3C,KAAK,CACJC,MAAO+xB,GACR,EACA5xB,QACL,CAEA,SAASm+E,GAAc/+E,EAAOpD,EAAQ,CACpC,OAAOoD,EAAMM,GAAGiyE,UAAUvL,KAAKxmE,KAAK5D,CAAM,EAAEgE,QAC9C,CAEA,SAASo+E,GAAS,CAAE96E,aAAY,GAAGgmD,CAAM,EAAG,CAC1C,KAAM,CAAE3qD,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAC/BvD,EAASsH,EAAa,GAAKm7D,KAC3B,CAAEr/D,QAAOC,YAAawB,GAAI,CAC9BxB,SAAUiqD,GAAOjqD,UAAYrD,EAAOqD,SACrC,EACK,CAAED,MAAOuuB,EAActuB,SAAUuuB,GAAoB/sB,KACrDmI,EAAKlH,EAAG,CAAA/B,GAAA,SAAAC,OAAA,CAAAX,WAAsB,CAAE,EACtCohE,GAASz3D,EAAO,sBAAsB,EAEtC,MAAM2nE,EAAa7yE,IAEbo1B,EAAsB7zB,IAAauuB,EAEnC,CAAC0jD,EAAU+M,CAAW,EAAIt/E,EAAS,EAAE,EACrC,CAACinE,EAAOsY,CAAQ,EAAIv/E,EAAS,EAAE,EAC/Bw/E,EAAgBzgF,IAEtB,eAAe0gF,EAAYrqD,GAAW,CACpC/1B,UAA0B+1B,QAAS,CAEjCoqD,GADFA,EAAIpqD,QAAcoqD,GAAuBn/E,CAAA,EACvCm/E,kCAGA,GAAIp1D,CACF,KAAI,CAEF,MAAMu1B,CAAA,EAAEz+C,MAAOy+C,MAASA,GAAMgzB,QAC9BtzE,IAEEigF,QACF,MACOzhF,0BAAG,EACVwB,IACF,MACF,MAAAyhE,CAGA,EAAI12C,YAAmC,EACjC88C,EAAApG,GAAA,SAAAuG,KAAA,eACFH,GAAM,QAAEhmE,IAGR,QAEA,CACEq+E,cAAStY,EAAK,mBAChB,MAAA/lE,CAEA7B,IAAe,OACjB6B,GAAA,SACFk0B,KACFw8C,EAAA,QAAA1wE,EAAA,OAEAA,EAAI,QAAAksD,GAAA,CAAElsD,OAAM,IAENk0B,CACFw8C,KACF,MAAA1wE,CAGAA,CACE8xD,CAAyB,KAC1B,CAAA0sB,EAAAC,CAAA,EAAA3/E,EAAA,IACH4/E,EAAA7gF,EAAA,EACA,CAAA8gF,EAAOC,CAAA,EAAA9/E,EAAA,MACL+/E,EAAGrvD,IACHxvB,MACF8+E,EAAA7rD,GAAA/J,GAAA,iCACFprB,EAAA,KAIM6gF,GAACH,EAA4BC,SAEnCM,yBAAoClhF,CAC9B,SAAC8gF,SACDE,gBACAE,eACN,EAIE,GAAAJ,CAAIA,GACFI,UAAuBj7C,EAAe,eACpC3a,EAAU+K,GAAA,EACV9K,IAAO,CAAAs1D,EAAA,WAAAD,EACC,IACVC,EAAC,QAAAR,GAAA/+E,EAAA,CACH,IAAAw/E,CAAA,CACEA,GAGJK,YACE,MAAI9qD,QAAcwqD,EAA4B3gF,QAAS,OACrD0gF,IACAC,OAA2D,EACzDvmE,EAAKwmE,OACN3+E,GAAA,SACHA,EAAA2wD,GAAA3wD,EAAA,UACAg/E,UAAgBjhF,GAAU4gF,CAC1B7sB,GAAMtiC,EAAUpwB,CAAMs/E,CACtB,IAAgBlvD,eAChBivD,EAAmB,IAEjBz+E,CACE8xD,KACF,MAAA9xD,CAAC,CAEH,CACEy+E,mBACF,IACA,MAAOjvD,GAAA,MAAArwB,EAAA,yBACL,MAAGqwB,CAEL,CACF,kBAEA,IACM,MAAAxvB,CACF,EAAAwvB,GAEW,OADHxvB,EACJJ,GAAOI,EAAA,UAAAA,GAAA,QAAAA,EAAA,QAAA0wE,EAAA,SAAAA,EAAA,QAAA1wE,EAAA,MAIRD,IAEGC,QAAUwvB,CAChBxvB,QACA,CACE0wE,CACA,MAAAjQ,EAAOzmD,GAAA,IACTzU,EAAAC,EAAA,CACA,SAAO,GAAA6rE,EAAA,QAAA9rE,EAAA,aACA5I,wBACP,SAAO,CAAA+I,EAAAS,EAAA,CACT,aACF,sBAEMs6D,QACJ,KACEj7D,QAAA+H,IAAA,OAESvH,OAA6BP,SAC3B,EAACW,GAAaJ,EAAM6lD,EAAA,QAAA7kC,EAAA8hB,IAAA9hB,GAAA,CAAA8hB,EAAA,QAAgBziC,OAAKd,EAAAiU,GAAA,CAC7C63D,cAAmB9jE,CAAM,GACxB,SAAM,CAAAhI,EAAA,QAAEsV,WAAMgxC,oBAAY3J,2BACpB/vB,SAAQ05B,GACd,KACO,CAACpkD,EAAI/B,EAAItG,OAAQ,CAAaqG,qBAC3B6gB,SAAIkR,GAAArF,CAAA,GAAM1sB,CACd,EAAAoV,CAAM7U,CAAM,GAAqB,KAAA+/D,EAChClrD,QAAItV,EAAA,aACD,YACN,SAAMS,GAAM,mBAAcP,QAAsB,SAAQC,EAAAgC,EAAA,CALjBmT,GAMnC,SAER,EAGJ,CACA,CAAK7U,IAAM,IAAAmgE,IAAA,CAAW1gE,MACpBA,UACEA,aACE,UAAAw5E,EAAA,SAAAn6C,EACE,YAAAwB,EAELy/B,SACC,MAAA/rC,EACEovC,mBACA8V,YACAD,gBACAn6C,cACAwB,eACAj2B,SACA2pB,OACAwwC,UACAlV,GACA6pB,yCACAC,gBACA3U,aACA1hE,cACAoP,MACA/H,GACF,MAAI+1D,SACE0E,GAAoBvoC,KACtB8mC,EAEJhjC,GAAMi5C,OAAqBn/E,GAAS,GAAAwqE,GAAA,IACpC,CACA,OAAMrwB,SACN,SAAIjU,QACAtB,QAAU3sB,GAAA4mE,EAAA,KACZ,KAAMh6C,GACN,OAAM2lC,SACNtkC,eAKF,oBAAAy4C,EAAAF,IAAAxmE,GAAA,yBAEA,SACE,CAAA1S,iBACE,OAAA2gC,GAAA,aACEzgC,uBAAqBwS,QAAM4mE,GAAiB,mBAC5ClmE,GACA9R,SAAOxB,EAAA,WACPob,SAAI,CAAAjb,EAAA,mBACGA,EAAA,MACLm5E,KAOAz4C,EAEM,IAAAokC,EACA,MAAAp6D,GAID,OAAAC,EACN5K,cAED,CAAAA,CACE,GAAAA,QACE,OACOu0B,wBACAwwC,aACLp6D,mBACAC,qBACAogB,SAAQ,CAAA/qB,EAAA,QACT,eAEHH,SAAA80C,EAAA,CAAKr0C,EAAM,MAAAykE,IAAA/kE,EAAAF,EAAA,CAAcC,SACvBF,IAAA,CAAAE,QACEC,EAAAF,EAAA,CAAKQ,SAAMN,EAAAgD,GAAA,CAAcjD,SACvBC,GAAMM,OAAM,QAAQP,CAAE40C,CAAa,EACjB,GAAA50C,MAAEC,EAAA,MAAS,MAC1B+kE,QACD,KAAAhlE,GACe,IACXkD,OAAU8hE,MACV7hE,GAAO,SACR02E,EAAA,EAAC,CAEL,GACE,EACJh5C,KACC,WACEtgC,eAAMu5E,IAAA,CAAAF,GAAA,uBACNnlE,GAAMo7C,IACNhvC,OAAI,MACJvd,EAAOA,SAAMtD,CAEZsD,GAEJw2E,IAAAh6E,EAAAC,EAAA,CACK,SACL8gC,UACD,EAAA5gC,EAAA,WACS,SAGPwU,SAAMo7C,WACNhvC,SAAI5gB,EAAAgC,EAAA,CACJqB,GAAOu9B,SAAY7gC,OAElB6gC,CAGJi5C,KACCh6E,EAAAC,GAAA,SACEqlE,GACS,cAAQplE,IACfC,EAAA,KAAAD,OACE,gBAAA1F,IAAA,WAAAuJ,SAGI5D,CAAS,GAACmS,CAASgzD,CAAkB,EAErC,EACQoU,GACC,GACH,GAEHC,EAGHA,MACD35E,EAAA,wBACI,2BACF,QACL,KAAAq5E,EAEPzmE,EAAA,GACG,SACCA,KAAAwmE,EACR,SACFG,MAEGl5E,KAAK,WACLI,MAAMN,EAAA,iBACGG,EAAM6B,EAAA,CACbk3E,WAAkB,CACpB,UACUzmE,EAAQwmE,CAAYl5E,mBAEzB,EAACW,CAAK,EAAU,CACrB,EAAA+R,EAAA1S,CACE,MAAAq5E,GAAsB,EAAA/Y,EAAA,QAAArgE,EAAA,aAClB,yBACDm5E,EAAA,wBAACz4E,EAAKb,EAAAC,EAAA,UAAiB,CAAAE,EAAA,aAE/B,CAlHOyS,MAmHL,GAEP,aAGL2mE,kBACC,EACoEr5E,SAEjEo5E,EACCr5E,EAAAgkB,GAAA,CAAA/jB,OACEC,EAAA,CAAK0B,IAAO,UAAEgJ,cAAWovE,cAAevd,YAAW,CAAS2c,EAAA,KAAEn5E,EAElDiiB,SAAMhiB,EAAAS,EAAA,CAAE,KAEhB,IACEP,IAAK/D,GAGH+8E,WAAmB,CACrB,CAEK,EAAM,EAAO/8E,mBAAE6D,EAAAgC,EAAA,oBAAgC,CAAC,EAAAi3E,EAAA,uDAC/C,YAGZj5E,IAAA,QAAAD,iBACE,CAAA3F,CAAA,GAKwB,GAAC,GAAA4F,EAAA2D,KAAA,MAAAC,gBAHvB,SAAMtD,EAAM0B,EAAA,IAAW,QAIjB,EAAC,EACF,GACL,GAGN,CAAA2pE,EAAGrrE,EAAM24E,EAAAH,CAAA,UAAA94E,EAAeD,IACtB,MAAAsD,EAAA,eAA4BxD,EAAA,YAC3B,sBACJ,SAEJ,CAAAG,EAAA,KACD,SAAAA,EAAAgC,EAAA,CAEF2pE,WAEJ,CACE3rE,CAAS,CAEPqD,WACA2uD,UACE,CAAI1xD,EAAM,GACR,GAAAP,WACE,SAAArG,EAAA,UAAsByC,EAExB,CAAqB,YACnB,EAGNzC,YACSyC,CAAE,cAAqB,WAAAg9E,EAAAY,EAAAlB,EAChC3mB,gBAAS/1D,qDAAE,eAAA6D,EAAAF,EAAA,mBAAsB7C,EAAA,wBAAC,uBAClCm1D,gBACAt2D,UACAu2D,oBACAF,OAAS,uBACTG,YAAatyD,GAAAF,CACb4b,UAEAy0C,gBACAqC,mBACAC,SAASwmB,SACTpmB,aAAgB,UAChBH,cACAH,MACE1yD,QACEuB,SAAMpB,EAAAS,EAAA,CAENuqB,KAAS,OACTq/B,SACAv/B,MAEU5qB,CAAcI,GAAM,SACrB,CAAM,EAAY,GAAOnE,wBAAE,SAAA/B,GAAA,OAAA+B,EAAO,CAAG,YACpC,CACT4D,WAGUI,KAAMitE,EAAA,OACK0J,MAAM36E,EACtB,CAAA/B,GAAA,SAA6C,CAC/C,EACA,MACE,CAAsB+B,QAACixE,GAAA,uCAAAA,EAAA,YAAkB,EACzC,UAAAptE,EAAAS,EAAA,CACF,UACA,OAAI2sE,SAAa,CACfA,aAAcA,CAEd/9D,WAA+B,CACjC,EACF,KAAEtP,IAEGrG,GAAAmG,EAAAiD,GAAA,SAAM,KAAO,SAClB9C,KAAA,IAAAioB,CAAA,aACE,UAAAjoB,EAAAS,EAAA,MAAqC,MACjC,EAAC,IAAAT,EAAA,SAERioB,mCAEY9nB,EAAM6B,EAAA,CACbqN,YACF,QAAEtP,iBAEG,EAAe,WACpB,CAAOO,EAAMN,EAAA,QACX,QAAAioB,EACwC,EAAAvuB,CAAAiK,CAAA,CCzexD,MAAMmuD,GAAwB,CAC5BpuC,MAAO,UACPumC,OAAQ,UACRxmC,SAAU,QACZ,EAEA,SAASu2D,IAAU,CACjB,KAAM,CAAEhhF,KAAGC,KACX6hE,GAAQ3+D,EAAC,CAAA/B,GAAA,SAAM,EAAG,GAAG,EACrB,MAAM6C,EAAaC,GAAYtD,CAAM,EAC/B,CAAEghD,aAAc39C,EAEtBxE,QAAgCmiD,GAAS,CAEzC,GAAMj3C,UAAai3C,KACjB,MACA,KAAA16C,EAAQA,MAAMo7C,EAAcA,GAC5B,UAAM2+B,GACJvxD,cAAWkiD,GACX5wE,QACAC,OAAMozE,GACNzzB,UAAQ68B,GACR58B,WAAW2iB,GACX1iB,WACAC,SAASmgC,GACTjgC,SAAUm2B,GACVp2B,SAAUy+B,EACVzuD,GAIF,MAHE9pB,IACEA,cAAmB,CAAA7J,EAAA,OAEnB6J,IAAS,SAAA7J,EAAaA,GAAc,KAEpC6J,IAAmB,CACvB,GAAA7J,EACY,WAAyCA,IAAQsH,OAAU,UAAAtH,CAAA,KAEzE+F,UAAC,sCAAAnF,GAAA,CAEDmF,IAGI,MAAImkB,EAAA,SAAAtpB,EAAA,UACIspB,EAAQxF,SAAWhd,iBAAW,gBAAAwiB,CAAA,EACpC45D,IACAA,EAAIA,MAAS,EACXA,EAAQn7D,eAAM8yC,EAAA,EAC8B,MAC9C,KAEAr5D,UACF,gBAAAxB,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,SACF,EACAmF,GACU,WAAAnF,EAAA88D,IAAA,CACRj1D,eAAwB7H,CAAE+H,EAE9Bo7E,EAAA,+CAEAh+E,EACGsiC,GAAK,EAEE3gC,EAAMg2D,EAAa,IAAC,IACpBqmB,QACJjkF,IAEF,IAAAgkF,EACAp8E,IAAMs8E,EACNF,EAAMG,EAAyBF,EAAA,oEAC3BD,QAEJA,EAAYE,EAAYD,EAAA,iEAKxBD,IAEEA,UAGFA,EAAA,eAAAroB,EAAA,EAEEqoB,GACAA,UACF,gBAAAljF,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,SACF,EAEE4H,EAAQ,OACRC,aAEJ,cAAA7H,GAAA,UAGE,4BAAAA,EAAA,sBAAAA,EAAA,2BACKA,EAAA,yCACmB,GAOlBA,EACA2C,YAAOslD,CACT,MAAAk7B,EAAA,+CACFA,YACS/xB,iBAAM,wBAAAnpC,GAAA,CAEbA,EAAMk7D,yBACJjkF,IAAS+9D,CAAsB,CACjC,EAIIh1C,EAAgE,SACjEvb,CAAA,EACH,CC5GR,SAAS42E,IAAO,CACd,KAAM,CAAEzoE,KAAG7Y,KACLgE,EAAaC,GAAYtD,CAAM,EACrCs5D,mBAAYhpD,IAAI,cAAc,EAC9B9R,EAAU,IAAM,EACb,SAAY,CACX,MAAMgM,EAAO,MAAM+uB,GAAGF,OAAO7uB,OAC7B,GAAIA,EAAK5J,OAAQ,CACf,MAAM44B,EAAKC,KACKjvB,EAAKmvB,UAAgBx1B,EAAI80B,WAAWO,CAAE,CAAC,EAC3C54B,SACVZ,EAAOuiB,WAAa,GAExB,CACF,IACF,EAAG,EAAE,EAGHnc,EAAAF,EAAA,CAAAC,UACI9C,EAAWW,SAASC,oBAAsB,gBACzC,CAACZ,EAAWW,SAASC,mBACpBZ,EAAWW,SAAS8rD,uBACtBzsD,EAAW29C,WAAWpgD,OACtBwF,EAACg6E,GAAO,EAAE,EAEVh6E,EAAC4qE,GAAS,CACRvnE,MAAOyO,EAAE,CAAA1X,GAAA,SAAQ,EACjBmgD,KAAK,IACLngD,GAAG,OACHk4D,YAAa,GACbC,UAAWvyD,EAACw6E,GAAiB,EAAE,EAChC,EAEH,CAEN,CAEA,SAASA,IAAoB,CAC3B,KAAM,CAAExhF,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EAC/B6gF,EAAsBtiF,IACtB,CAAC64D,EAAWC,CAAY,EAAI73D,EAASqF,MAAS,EACpD,OACEoB,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAAC8T,GAAI,CACH7T,IAAKw6E,EACL14E,GAAG,iBACHzB,MAAO,qCACLrD,EAAWxC,qBAAuB,YAAc,EAAE,IAChDu2D,GAAa,EAAE,GACnB7wD,QAAUlJ,GAAM,CACdA,EAAE04B,kBACEz5B,OAAOsb,WAAW,yBAAyB,EAAEC,UAC/Cxa,EAAEoJ,iBACF4wD,EAAcnwD,GAAYA,EAAiBrC,OAAT,MAAmB,EAEzD,EAAEsB,SAEFC,EAACS,EAAI,CAACC,KAAK,eAAeC,KAAK,IAAIC,IAAGzE,EAAE,CAAA/B,GAAA,SAAe,CAAC,CAAG,EACvD,EACN4F,EAAC06E,GAAiB,CAChB55E,MAAOkwD,EACPjwD,UAAW05E,EACXz5E,QAASA,IAAMiwD,EAAaxyD,MAAS,EACtC,CAAC,EACF,CAEN,CAEA,MAAMk8E,GAA8B,EACpC,SAASD,GAAkB,CAAE35E,YAAWD,QAAOE,SAAQ,EAAG,CACxD,KAAM,CAAEvH,QAAOC,YAAawB,KACtB+B,EAAaC,GAAYtD,CAAM,EAC/B,CAAConB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAE1CU,EAAwBq3E,KAE9B,eAAeqC,GAAqB,CAClC,MAAMnB,EAAmB,MAAMv4E,EAAsBS,OAC/CP,EAAgB20E,GAAsB0D,EAAiB/3E,KAAK,EAElE,GAAIN,GAAeQ,OAAQ,CACzBR,EAAcoN,QAAS/L,GAAiB,CACtC+wD,GAAW/wD,EAAamT,OAAQ9U,EAAU,CACxC8B,cAAe,GAChB,CACH,CAAC,EAED,MAAM82E,EAAuBlB,GAAwBp3E,CAAa,EAElEJ,EAAOC,kBAAoBy4E,EAAqB,CAAC,EACjD14E,EAAOI,cAAgBs4E,EAGvB74E,EAAMM,GAAGY,QACNsb,OAAO,CACNjc,cAAe,CACbU,WAAY43E,EAAqB,CAAC,EAAEl4E,GACtC,CACD,EACAmkB,MAAM,IAAM,CAAC,CAAC,CACnB,CAEA3kB,SAAOa,qBAAuB,GAC9Bb,EAAO24E,2BAA6B7vE,KAAK1G,MAClCq2E,CACT,CAEA,KAAM,CAACuI,EAAmBC,CAAoB,EAAIzhF,EAAS,EAAK,EAChE,SAASo5E,GAAsB,CAC7B,OAAO/4E,EAAMM,GAAG8lD,eAAe5lD,KAAK,CAClCC,MAAO,EACR,CACH,CAEA,SAASo5E,EAAkB,CAAEwH,qBAAqB,IAAU,GAAI,CAC9Dx9D,EAAW,SAAS,GACnB,SAAY,CACX,GAAI,CAEF,GADA,MAAMk2D,IACF,CAACsH,EAAoB,CACvB,MAAMj7B,EAAiB,MAAM2yB,IAC7BqI,EAAqB,CAAC,CAACh7B,GAAgBrlD,MAAM,CAC/C,CACA8iB,EAAW,SAAS,CACtB,MAAY,CACVA,EAAW,OAAO,CACpB,CACF,IACF,CAEA,MAAM5f,EAAUvF,IACV4iF,EAAe,GACrB3iF,SAAU,IAAM,CACV0I,IAAU,SACV7D,EAAWxC,qBACOiD,EAAQrF,SACX6xD,WAAa6wB,GAC5BzH,EAAkB,CAChBwH,mBAAoB,GACrB,EAGHxH,IAEJ,EAAG,CAACxyE,EAAO7D,EAAWxC,oBAAoB,CAAC,EAGzCoF,EAACgB,GAAc,CACbZ,IAAKvC,EACLojC,cAAc,qBACdhgC,QACAC,YACAC,UACAI,OAAQ,CACNC,OAAQlL,SAASmL,MAEnBG,eAAgB,CACdtB,QAASA,IAAM,CACbzC,EAAQrF,SAASuJ,aACnB,GAEFopB,SAAS,OACTq/B,WAAW,QACXv/B,SAAS,SACT3oB,MAAM,SACNZ,mBAAmB,UAASxB,UAE5BC,EAAA,UAAAD,SACEC,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA2B,EACzB,EACE,EACR4F,EAACqwD,GAAcoF,SAAQ,CAACn7D,MAAM,gBAAeyF,SAC3CC,EAAA,QAAAD,SACG9C,EAAWjD,cAAcQ,OACxBwF,EAAAF,EAAA,CAAAC,SACG9C,EAAWjD,cACTwS,MAAM,EAAGmuE,EAA2B,EACpCn4E,IAAKnH,GACJ2E,EAAC0e,GAAY,CAEXhlB,WACA2B,eACAknD,mBAAkB,IAHblnD,EAAaqnD,MAAQrnD,EAAajB,EAIxC,CACF,EACH,EACA4mB,IAAY,UACdhhB,EAAA,OAAKM,MAAM,WAAUP,SACnBC,EAAC8jB,GAAM,CAAC9B,OAAM,GAAE,EACb,EAELhB,IAAY,SACVnhB,EAAA,OAAKS,MAAM,WAAUP,UACnBC,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA4C,EAC3C,EACH4F,EAAA,KAAAD,SACEC,EAAA,UAAQE,KAAK,SAASC,QAASmzE,EAAkBvzE,SAC/CC,EAAAgC,EAAA,CAAA5H,GAAA,SAAuB,EACjB,EACP,CAAC,EACD,EAGL,EACgB,EACxByF,EAAA,UAAAE,SAAA,CACEF,EAACiU,GAAI,CAAC/R,GAAG,YAAYzB,MAAM,eAAcP,SAAA,CACvCC,EAACS,EAAI,CAACC,KAAK,KAAM,EAAE,IACnBV,EAAA,QAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAsB,EAClB,CAAC,EACH,EACNyF,EAACiU,GAAI,CAAC/R,GAAG,iBAAiBzB,MAAM,gBAAeP,SAAA,CAC5C66E,EACC56E,EAAAgC,EAAA,CAAA5H,GAAA,SAAAuJ,WAAA,CAAAC,EACE5D,EAAA,QAAMM,MAAM,gBAAyB,EAACuD,EACtC7D,EAAA,SAA2B,EAAC,CACvB,EAEPA,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAqB,EACpB,EACF,IACH4F,EAACS,EAAI,CAACC,KAAK,cAAe,CAAC,EACvB,CAAC,EACD,CAAC,EACK,CAEpB,CAEA,MAAAs6E,GAAeliF,GAAKyhF,EAAI,ECjQlBU,GAAoB,CACxB,6CACA,qBACA,uCACA,8BACA,iCACA,yBAA2B,EAGtB,SAASC,GAAwBzoE,EAAK,CAE3C,MAAM0oE,EAASpoD,IAAIv0B,MAAMiU,CAAG,EAC5B,GAAI,CAAC0oE,EAAQ,MAAO,GACpB,KAAM,CAAE7rE,WAAUG,UAAS,EAAI0rE,EAE/B,UAAWC,KAASH,GAAmB,CACrC,KAAM,EAAG7gF,CAAE,EAAIqV,EAAS6tC,MAAM89B,CAAK,GAAK,GACxC3iF,KACA,MAAQ,CACN,SAAO6W,EACL5V,IACAU,CAEJ,CACF,QACA,CACF,SAAAihF,GAAA5oE,EAAA,CAEA,MACE,SAAA/Y,EAAQA,IAAUU,QAAG,OAAI8gF,KACrBxhF,IAAQA,CAAQ,MAAAU,CAAA,GAEpB,IACA,CCzBF,SAAwBkhF,IAAY,CAElC,MAAM7oE,EADWiN,KACIjQ,SAASzB,QAAQ,MAAO,EAAE,EACzCutE,EAAeL,GAAwBzoE,CAAG,EAE1C+oE,EAAYD,GAAc7hF,SAC5B,IAAI6hF,EAAa7hF,QAAQ,MAAM6hF,EAAanhF,EAAE,GAC9C,KACE,CAAC4mB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAEhD+kC,UAAgB,IAAM,CACpB7gB,EAAW,SAAS,GACnB,SAAY,CAEX,GAAI,CACF,KAAM,CAAE5jB,WAAUU,MAAOmhF,EACzB,GAAInhF,EAAI,CACN,KAAM,CAAEX,SAAUyB,GAAI,CAAExB,WAAU,EAElC,GADe,MAAMD,EAAMM,GAAG6C,SAASD,QAAQvC,CAAE,EAAEQ,QACvC,CACV1E,OAAOmZ,SAASpL,KAAOu3E,EAAY,aACnC,MACF,CACF,CACF,MAAY,CAAC,CAGb,CACE,KAAM,CAAE/hF,MAAOuuB,EAActuB,SAAUuuB,GAAoB/sB,KACrDy3B,EAAS,MAAM3K,EAAa+B,GAAGC,OAAO/vB,KAAK,CAC/CgwB,EAAGxX,EACHvY,MAAO,EACPgwB,QAAS,GACV,EACD,GAAIyI,EAAO/1B,SAASpC,OAAQ,CAC1B,MAAMgU,EAASmkB,EAAO/1B,SAAS,CAAC,EAChC1G,OAAOmZ,SAASpL,KAAO,IAAIgkB,CAAe,MAAMzZ,EAAOpU,EAAE,YAC3D,SAAWu4B,EAAOj2B,SAASlC,OAAQ,CACjC,MAAM2X,EAAUwgB,EAAOj2B,SAAS,CAAC,EACjCxG,OAAOmZ,SAASpL,KAAO,IAAIgkB,CAAe,MAAM9V,EAAQ/X,EAAE,EAC5D,MAAWohF,EAETtlF,OAAOmZ,SAASpL,KAAOu3E,EAAY,aAEnCl+D,EAAW,OAAO,CAEtB,CACF,IACF,EAAG,CAACk+D,CAAS,CAAC,EAGZ37E,EAAA,OAAKS,MAAM,WAAW4R,SAAS,KAAInS,UAChCihB,IAAY,UACXnhB,EAAAC,EAAA,CAAAC,SAAA,CACEC,EAAC8jB,GAAM,CAAC9B,OAAM,GAAE,EAChBhiB,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAwB,EACtB,EACJ4F,EAAA,KAAAD,SACEC,EAAA,KAAGmT,KAAMV,EAAKpR,OAAO,SAAS4Z,IAAI,WAAUlb,SACzC0S,EACA,EACF,CAAC,EACJ,EAEF5S,EAAAC,EAAA,CAAAC,UACEC,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAmC,EACjC,EACJ4F,EAAA,KAAAD,SACEC,EAAA,KAAGmT,KAAMV,EAAKpR,OAAO,SAAS4Z,IAAI,WAAUlb,SACzC0S,EACA,EACF,CAAC,EACJ,EAEJzS,EAAA,OAAK,EACLA,EAAA,KAAAD,SACEC,EAAC8T,GAAI,CAAC/R,GAAG,IAAGhC,SACVC,EAAAgC,EAAA,CAAA5H,GAAA,SAAqB,EACjB,EACL,CAAC,EACD,CAET,CChFA,SAASqhF,IAAQ,CACf,KAAM,CAAEziF,KAAGC,KACX6hE,GAAQ3+D,EAAC,CAAA/B,GAAA,SAAO,EAAG,IAAI,EACvB,KAAM,CAAC4mB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAE1C,CAAC8sB,EAAanU,CAAM,EAAIC,GAAYgD,GAAMA,EAAI,EAAG,CAAC,EAClD,CAACqP,EAAO0B,CAAQ,EAAI3sB,EAAS,EAAE,EACrChB,EAAU,IAAM,CACdklB,EAAW,SAAS,GACnB,SAAY,CACX,GAAI,CACF,MAAM+G,EAAQ,MAAMD,KACpB3rB,GAAY4rB,EACZ0B,EAAS1B,SAAK,CACd/G,SACU,QACV7kB,CACA6kB,IAAkB,GACpB4I,CAAA,QACC,CAAAG,EAAAD,CAAA,EAAAhtB,EAAA,IACD8sB,EAAY7B,EAAA,KAAApqB,KAAA,WAEhB,OAAOosB,SAEP,GAAMq1D,aAEN,uBACOthF,SAAG,KAAakG,SAAM,CAAAT,EAAA,OAAiBqS,2BAAanS,SACvDF,GAAA,UAAKS,SAAMT,EAAA,OAAoBE,MAC7BC,cAAAD,YACE,OAAKO,MAAM,cAAaP,SACtBF,GAAA+wD,GAAA,IAAA5wD,EAAA8T,GAAA,CAAKxT,OAAmBP,qBAEhBgC,SAAG/B,EAAAS,EAAA,CAAIH,KAAM,OAAcP,QAC1B,EAAM,GAAY,GAAGC,EAAE,MAAC,SACxBA,EAAAgC,EAAA,CAEThC,WAAA,CAAAD,CACE,GAAA3F,EAAA,aAAmB,cACjB,SACJ4F,EAAA,UAAKM,KAAM,SAAaP,cAEpBG,QAAK,IAAAkmB,EAAA,IACL9lB,SAAMN,EAAAS,EAAA,CACNN,YAA6CJ,SAEvCW,MAAqBE,CAAGzE,YAAE,GAAU,EAAC,GAAG,EACxC,GAAC6D,EACL,iBACHqkB,EAAA,SAAAxkB,EAAAC,EAAA,CAEPE,SAAA,CAAAA,EAAA,MAAAD,MACGskB,YACCtkB,SACEC,EAAA,IAAA/F,GAAA+F,EAAA,MAAIM,SAAMT,EAAAiU,GAAA,CAAW/T,SAClBskB,EAAM7hB,EAAKvI,GACV8F,YACG+T,EAAI,CAAC/R,KAAI,MAAa,CAAGhC,QACxBC,OAAK,CAACU,SAAK,CAAAzG,EAAA,MAAAA,EAAA,WAAA4F,EAAAC,EAAA,CAAU,SACrBD,CAAA,IAAAG,EAAAilB,GAAA,iBAGI,CAAAllB,EAEqB,GAAc,GAAG,EAEvC,GACI,GAAAskB,EAcH,UAAAxkB,EAAA,UAAC,MAEV,WACC,SACGrF,IACLwF,EAAA,KAAQM,SAAMT,EAAA,SAAUE,MACrB27E,gBACC37E,YACEklB,GAAA,QAAAjlB,EAAAgC,EAAA,CAAO1B,WAAM,CAAeP,EAE1B,KAAAC,EAEQ,cACHA,EAAA,SAGXA,MAAA,gBAAAD,WACEiC,EAAA,CAAO1B,YAAqBP,OAC1BC,CAAA5F,EAAAiqB,EAAA,SACe7pB,EAAM,GAGpB,GACI,GACNwmB,IAAC,UAAAhhB,EAAA,WAEP,WACD,SACAghB,EAAY8C,GAAA,GACd,GAAGxjB,IAAM,QAAAN,EAAA,KAAUD,iBAEhB,SACDihB,EAAYhf,EAAA,CACX1B,WAAM,CAAUP,CACjB,GAAA3F,EAAA,WAAmC,WAClC,SAEH4F,EAAAgC,EAAA,CAAG1B,WAAM,CAAUP,CACjB,KAA2B,GAACsmB,GAC3BrmB,EAAAkE,GAAA,CACJ,QACIjN,GAAA,CAERovB,8BAEmB,GAEZD,EAA6B,SAC/BpmB,EAAAmlB,GAAA,CACF,KAAAkB,GAAA,KAAEtmB,WAEDolB,CACOkB,uBACIsM,EAEN5gB,EAAO,IAETqU,EAA6B,GAC/B,EACD,CC3JX,MAAAu1D,GAAe,2DCAR,SAASC,GAAcnpE,EAAK,CACjC,MAAM/H,EAAQiY,KAAK/H,IAAI,IAAK+H,KAAKmoC,MAAM50D,OAAO47C,OAAOpnC,MAAQ,EAAG,CAAC,EAC3DC,EAASgY,KAAK/H,IAAI,IAAK+H,KAAKmoC,MAAM50D,OAAO47C,OAAOnnC,OAAS,EAAG,CAAC,EAE7DkxE,EAAW,eAAenxE,CAAK,WAAWC,CAAM,GAEtD,GAAI,CACF,MAAMmxE,EAAQ5lF,OAAO6sB,KAAKtQ,EAAK,aAAcopE,CAAQ,EACrD,MAAI,CAACC,GAASA,EAAMC,QAAU,OAAOD,EAAMC,OAAW,IAC7C,KAEFD,CACT,MAAY,CACVrjF,OAAO,IACP,CACF,CACF,SAAAujF,GAAAF,EAAA,CAEA,GAAAA,GAAO,CAASE,SACd,IACEF,EAAI,aACIG,CAAK,CAEXxjF,CACF,SAAAyjF,GAAAJ,EAAAK,EAAAvsD,EAAA,CACF,IAAAwsD,EAAA,GACF,MAAAC,EAAAjmF,GAAA,CAGMgmF,EAAQ,SAAQ,wBAIdhmF,EAAMoZ,MAAMpZ,OAAYiZ,OAASG,mBACnC4sE,EAAA,GACFE,EAAA,EAEIlmF,EAAM+W,KAAI,KACZivE,EAAWhmF,EAAI,WAGfw5B,EAAUziB,IAAI,MAAK,gCAAE,GAGnByiB,EACF,kCAAAysD,CAAA,EACF,MAAAE,EAAA,kBACD,CAAAT,KAAA,UAED5lF,cAAOwC,CAAiB,EAElB6jF,IACAH,EAAUN,GACZpgF,IACAk0B,MAAa,MAAE,sDAGbA,OACF0sD,EAAA,KACF,qCAAAD,CAAA,EACD,cAAME,CAAA,EAEPP,GAAgBF,CAAM,CACpB5lF,SACAwF,4ZCpCE,CAAE8gF,wBAAyBC,EAAiB,EAAIvtE,GAEtD,SAASwtE,IAAQ,CACf,KAAM,CAAE1jF,KAAGC,KACX6hE,GAAQ3+D,EAAC,CAAA/B,GAAA,SAAQ,EAAG,QAAQ,EAC5B,MAAMuiF,EAAiBxkF,IACjBykF,EAAoBjpE,GAAM+B,MAAM7B,IAAI,aAAa,EACjD,CAACmN,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAACguD,CAAY,EAAIE,KACjB5tD,EAAW0tD,EAAavzC,IAAI,UAAU,EACtCgpE,EAASz1B,EAAavzC,IAAI,QAAQ,EAClC,CAACipE,EAAcC,CAAe,EAAI3jF,EACtCM,GAAYkjF,GAAmB5+E,eAAiB,EAClD,EAEM,CAACg/E,EAAeC,CAAgB,EAAI7jF,EAAS,EAAE,EAC/C8jF,EAAW/kF,IACjBC,EAAU,IAAM,EACb,SAAY,CACX,GAAI,CAEF,MAAM+U,EAAO,MADD,MAAMvS,MAAM+gF,EAAgB,GACjBltE,OACvBwuE,EAAiB9vE,CAAI,EACrB+vE,EAAS7kF,QAAU,IAAI8kF,GAAKhwE,CAAI,CAClC,MAAY,EAEV1U,IAAe,IACjB,QACC2kF,EAAA/uE,GAAA,CACAA,IAQL,SAAM+uE,CACJ,GAAK/uE,CAKH,MAAI8Y,EAAA,MAHO,uBAAA9Y,CAAA,2BAGP,OAKIgvE,EAJM,IAAMziF,UAAM,EACL0T,gBAAS6Y,EAAA,YAETm2D,qBAAU,WACPC,uBAAsB,EAEtC9c,MAAO4c,MAAOG,GACdC,CACN,KAAAzxD,CACA,EAAAvZ,EAAQuZ,QAAK3d,EAAIoE,EAEfha,MAAQma,EACRvE,2BAAc2d,KAChB,WACF,IAEEvzB,MAAeilF,GAAArvE,CAAA,GACjB,CAAAsvE,GAAA,CAAAA,EAAA,YAAAA,EAAA,iBAEAhqE,EAAgB,MAAetF,GAAW,CAE1CiP,aACA,CAAI,EACFsgE,MAAqDvvE,GAMnDsvE,MAAkD,UAAAttE,EAElD,cAAAS,CACA8sE,IACFC,EAAA,MAAAzvE,GAAA,CAEA,YAAAC,CAAM,GAAayC,QAAc,IAAI6sE,EAErC,GAAAE,GAAMA,OAAiBzvE,gBAAeC,SAAa,MAAAoE,EAAAhG,CAAA,QAAA2D,GAAA,CACnD3X,cAAcolF,YAAU,WAAAvtE,CACxB,GAEIwtE,uCACAD,GACF,MACE,MAAM1hF,EAEJkU,CACAC,YAEFqD,GACAmqE,EAAUrrE,WACZ,MACE8I,SAAMlL,GAAAS,EAAAgtE,EAAA,MAAAC,GAAA,CAAgC,YAAA1vE,EAAC,UAAAgC,EACvCiN,YACA,OACF,CACF,MAAOnhB,EAEH2hF,CACEzvE,YACAgC,GAEFiN,EAAC,WACH,MACE/B,CAAKpf,MAAC2/E,EAAAF,GAAAkC,CAAA,EAAAhC,EAAAI,GAAgCJ,EAAA/qE,GAAA,CAAC,MAAAitE,EAAA,gFAAAjtE,CAAA,IACvCuM,gBAAW,KAAS0gE,CACpB,EAAA1sE,GAAA,CACFgM,EAAA,QACF,GAIA,SAAW,KAAAwgE,EAILxgE,EAAM0gE,UACN9nF,OAAuB8nF,EAExB1sE,OAAU,CACT7Y,CACA6kB,IAAkB,EAGxB2gE,EAAOnB,IAAA,kFAELrkF,EAAY,qCAAyC,KAAAwlF,CAAA,qBAAAA,CAAA,EACrD5uE,EAAgByuE,6BAClB,EAEAxgE,WAAWggC,EAAA,IAAS,OACV4gC,EAAAD,EAAAE,GAAA,OAAAA,EAAA,GAAArB,EAAAE,EAAA,KAAAoB,KAAA,SAAAtB,CAAA,QACVrkF,KAAe,CACf6kB,iBAAW,EAAO8/D,EACpBiB,CAAA,GAEJ,OAAAxB,GAEAzkF,OAOAglF,EAAMc,KAIN,IAAMC,EAKE37E,SAAe86C,CAGvB,GAAM+gC,QAQN,MAAM14D,CACFtlB,kBAaF+8E,EACF,SAAAv9E,EAAA,QAEIg9E,WACFzkF,SAAU,CAAAyH,EAAM,MACdu9E,mBACG,IAAAppE,GACP,aAGE,KAAS,YAAQtS,EAAO1B,EAAA,SAAAA,EAAAgC,EAAA,CAAEu6D,WAAW,CAAS,GAAEx8D,YAC9C,CAAM4lB,iBAAmB5lB,SACvBF,EAAAmC,EAAA,CAAAjC,WACE,CAAK0c,CAAKzI,GAAMpT,EAAI,SAAG8J,MAAMoyE,EAAKnyE,SAAO,QACzC3K,OACA5F,MAAA,QAAqB,iBAEvByF,MAAAE,SACEC,IAAA,UAAAD,kBACE,kCAAsB,MACrB,WACH,GACEzF,YAAOwiF,EAEP58E,CACAI,GAAM,SACH,EAEH+B,aAAU2e,KAEVs7B,WAAY,CACZC,EAAetlD,EAAA,aACfkxD,EACA1L,UAAY,GACZrC,GAAWj+C,qDAAEgiF,EAAA,KAAAC,EAAAv2E,IAAA7H,EAAA,eAAAA,EAAA,UAAiB,cAAC,eAC/B6gB,YAAa,CACb7G,EAAgBokE,CAAA,CACdrB,EACF,SAAAqB,CAAA,CACAx9D,CAAI,CACL,CACAu9D,CACC,GAAI/jF,EAAG,OAAuB2F,kBAE1B,SAAAA,IACE,IACEG,QAAK,EACC,GAEJk9E,gBAAe1jF,MAAQ,OACzB,iBAAEqG,IAEDrG,IACK,UAEX,GACCmG,EAEJG,MAAA,UAAQ,CAAAA,EAAA,UAAcD,SACpBC,IAAAgC,WAAA,CAAA86E,GAAA,CAAAuB,EAAA,SAAAliF,EAAAkiF,EAEH,CAOFr9D,YACI1gB,OAAM,CAAOP,sBACd,GAOAsC,YAIqBlG,CATd,CAUH,MAAA/B,CAAA,GAAA4F,EAAA3F,GAAA,QAAAgkF,kBAAsC,UAAA5B,IAAAz8E,EAAA,cAACA,EAAA,KAAC,KAAA7D,4DACxC6D,EAAAgC,EAAA,IAAA5H,QAAA,EAAU,EAAC,KACJ,KACV,SACJ0pB,EAAMhQ,GAAA,QACP9T,WAAKgC,EACHy6E,CACA18E,WACE,CAAGoT,CAAK,EAA0C,GAAQpT,KACxDiC,IAAA,IAAgD,CCrR9D,MAAMiqB,GAAQ,GAEd,SAAwBqyD,IAAiB,CACvC,KAAM,CAAEtlF,KAAGC,KACLgE,EAAaC,GAAYtD,CAAM,EACrCkhE,GAAQ3+D,EAAC,CAAA/B,GAAA,SAAiB,EAAG,KAAK,EAClC,KAAM,CAAEX,SAAUyB,KACZ,CAACqjF,EAAgBC,CAAiB,EAAIplF,EAAS,EAAE,EACjD,CAAC4nB,EAAS1D,CAAU,EAAIlkB,EAAS,SAAS,EAC1C,CAAC8sB,EAAanU,CAAM,EAAIC,GAAYgD,GAAMA,EAAI,EAAG,CAAC,EAClD,CAACypE,EAAwBC,CAAyB,EAAItlF,EAAS,EAAK,EAE1EhB,SAAU2Z,EAAQ,CAAC9U,EAAWyhD,oBAAoB,CAAC,EAEnDtmD,EAAU,IAAM,CACdklB,EAAW,SAAS,GACnB,SAAY,CACX,GAAI,CACF,MAAMqhE,EAAgBllF,EAAMM,GAAG6kF,kBAC5B3kF,KAAK,CAAEC,MAAO+xB,GAAO,EACrB5xB,SACGwkF,EAAW,GACjB,IAAIp/E,EACJ,GAEEA,GADe,MAAMk/E,EAAcpkF,QACpBD,MACXmF,GAAOjF,QACTqkF,EAAS7oE,KAAK,GAAGvW,CAAK,QAEjBA,GAAOjF,QAChBgkF,EAAkBK,CAAQ,CAC5B,MAAY,CACVpmF,SAAe,CACf6kB,SACFA,EAAC,UACCA,CAAoB,IACtB,EACF,CAAA4I,CAAG,GACDA,QAAY,CAEhB,0BACO9rB,MAAG,iBAAuBkG,SAAM,KAAiB4R,SAASrS,EAAA,OAAIE,2BAC5DO,SAAM,CAAAN,EAAA,UAAoBD,SAC7BC,EAAA,OAAAD,oBACOO,SAAM,CAAAT,EAAA,OAAaE,oBACjBO,SAAM,CAAAN,EAAA4wD,GAAA,IAAA5wD,EAAA8T,GAAA,CAAa/T,OAEhBgC,MAAG,eAAIzB,SAAMN,EAAAS,EAAA,CAAcV,YACzBW,KAAK,IAAOC,MAAYxE,CAAE,aAAM,EAAC,EAAC,CAAE,GACrC6D,EAAA,MACJ,SACLA,EAAAgC,EAAA,CAAAjC,WACE,KAA6BC,EAAA,OAC3B,MACJ,cAAKM,SAAMN,EAAAiT,GAAA,CAAalT,OACtBC,GACEoB,gBAAM,GACNwrE,gBACA5hD,WAAS,QACTq/B,kBACAv/B,WAAS9qB,EAAA,UACTkT,cACUhT,MAAK,QAASI,SAAMN,EAAAS,EAAA,CAAOV,YAC3BW,KAAK,IAAOC,MAAYxE,CAAE,aAAM,EAAC,GAAI,SACrC0D,EAAAiD,GAAA,CACT/C,YAEA+C,IAEGiP,EACF,UAAA/R,EAAAS,EAAA,CAAEV,eAEIW,KAAK,MAAUC,EAAK,QAAK,SAC/BX,EAAAgC,EAAA,CAAAjC,WACE,KAAqB,EAChB,EACC,EAAC,CACN,EACH,GACHF,EAAA,QACC,SACR,CAAA0+E,EAAA,OAGkEv+E,EAAA,MAC3D,MAEHA,aAAIM,SAAMi+E,EAAA,IAAA5+E,GAAA,CAAYI,MAElB,GAAA3F,EAAQA,SAAI/D,cAAQmoD,oBAAa/7B,EAAqB9iB,CACtD,YAAA6rD,EACEA,WACAoE,OACAtoD,YACA46C,cACAluB,OACA7M,aACAwoC,iBACAmvB,uBACAC,EACE1oF,GACW,GAAA+D,EAEbA,cACAoxD,WACAoE,mBACAntC,aAGM,UAAGnb,qCACHohE,kBAAoBhmE,SACpBoC,MAASwC,EACPjE,WAAO27E,GACPC,CAAY,EACZ,OACJ,UAAA/8B,EAEJA,cACAluB,OACA7M,aACAwoC,sBACmB,eAAAmvB,EAEnBA,uBAEF,OAAA9+E,EAAA,MAEA,SACEA,EAAAk/E,GAAA,CAAAn/E,SAEIyO,cACAgwC,eACe,CACbkgC,OACE/+E,YAAM6O,aAC2B,CAClC,EACH,EACDpU,CAAA,GACC,GA1Dd4F,EAAA,sBAEOM,SAAM0gB,IAAA,UAAAhhB,EAAA8jB,GAAA,IAAA3nB,EAC4BA,CAAG,aAAqB,GAyD1DsiF,GAAAz+E,EAAAkE,GAAA,CACC,QAELu6E,eAEmBxnF,EAAA,eACdynF,EAAmB59D,GACc,EAEnC,SAAA9gB,EAAAm/E,GAAA,CAAEp/E,OAEDo/E,KACCx/E,YAAM8+E,EAAuB9+E,YAC7B6+C,YAAaigC,EAAuBjgC,KACU,EAAE,CACjD,EAAC,CAEL,EACI,EACJ,CAGX,SAAA0gC,GAAA,CAEA,OAAA1wE,EAAgCA,cAAQgwC,WAAar+C,CAAQ,MAAGO,EAAA4T,GAAA,KAE9D,MAAM5T,QAAe,MAAM89C,CAAA,mBACzB,OAAA4gC,EAAMA,UAEGA,EAAA,IACT,MAGO,OACE,EACT,CAAA5gC,CAAA,GACF,OAAIA,WAAY,CAEhB,cACUt+C,MAAK,gBAASI,UAAsBH,mBAAiBJ,0CAC3DW,CAAA,GAAKJ,eAAkDP,OAC/CW,wBAAYJ,IAAMN,EAAA,QAAiB,SACzCA,EAAAgC,EAAA,CAAAjC,YACE3F,OAAA,CAAAC,KAAAmkD,EAAA,CAAA56C,YAQMy7E,gBACEC,gBAAS,CACD,EACV,EACA,YAAA37E,QAAA,IAAAC,EAVJ5D,EAAAgD,GAEG,CAACa,SADDb,CAAY,GAAuB,EAAEhD,EAAA,YAWjC,EAAC,GACH,GACFA,EAAA01B,GAAA,CACJ,OAAAlnB,EACGA,SAAgB7N,YAAK,GAAI20C,WAAW,EAACx4B,CAAQ,EAAG,CAG9D,SAAAqiE,GAAA,CAEA,KAAAx/E,EAA6BA,cAAM6+C,WAAax9C,CAAQ,KAAG,CACzD,MAAAvH,EAAQA,YAAOC,KAAawB,CAC5B,EAAA+hB,CAAM,EAAEjkB,KAAGC,GAAAqkB,CAAA,EAAAlkB,EAAA,WACL,CAAC4nB,EAAS1D,CAAuB,EAAAlkB,EAAS,EAC1CmmF,EAAiBC,GAAqBpmF,EAAS,YAAAolD,EAAA,UAC/C+gC,KACJE,EACIC,EAAUC,MAAqB,WAC/BC,CAEN,YAAAp0B,CAAM,EAAEA,EAAgB7rD,cAClB,CAeN,eAAAm/E,CAAM,EAAEA,EAAe,OAAIn/E,SA0B3B,0BACOvF,MAAG,QAAuBkG,SAAM,CAAAN,EAAA,UAAOD,cAClCG,MAAK,cAASI,QAAMU,EAAcb,SAASa,KAAQjB,SACnDW,KAAK,IAAIC,MAAYsc,CAAE,aAAO,EAAC,GAAGjd,EAAA,UAClC,SACRH,EAAA,MAAAE,YACEiC,EAAA,CAAAjC,YACE3F,WAAA,CAAAuJ,QAAA,IAAAC,EAEE5D,EAAAgD,GAEG,CAACa,SADDb,CAAY,EAAWw7C,CAAc,GAACx+C,EAAA,SAAAA,EAAA,kBAG3CuD,GACAi7C,EAAA,CAAAz+C,YAEIs/E,gBACEC,gBAAS,CACD,EACV,EACF,CAAC,EACK,GACNz/E,EAAA,QACE,SACR,KAAMqS,SAAS,GAAAtS,GAAAI,EAAA,4BAENM,SAAMN,EAAA01B,GAAA,CAAc31B,OACvBC,EAAQwO,SAAuB7N,YAAK,GAAI20C,WAAW,EAAS,GAAEt1C,EAAA01B,GAAA,CAC3D,OAENA,EACClnB,SACA7N,YAAK,GACL20C,YACAx4B,aAAQ,CAAA7lB,EAAA4Q,EAAAs3B,EAAA3wB,IAAA,CACR4gD,iBAAkBvnD,EAChB5Q,EAAEoJ,eAAe,CACjBzG,iBAAOm3B,EAAiB,iBACtBtO,YAAuBA,CACX5a,CACd,GACF7H,EAAA,QACD,SACD/I,GAAA,kBACmB,EACfA,EAAEoJ,SAAe,GACjBid,SAAW,CACV,IACC,MAAI7jB,EAAA,6BAAAkG,EAAA,YACF,YAAei/E,cAA0Bj/E,CAAgB,GAEzDtD,GAAC4gB,EACQA,CAAC,eAA6Bjc,EAAA,EACvCA,EAAQ,WACRsc,wBACA1jB,MAAO8kD,GACG,SACVphC,KAEAjhB,CAAS4gB,YAAC,GAA2B,IAAC,EACxC,SACCpd,EAAA,UACL,UAAAG,EAAA,OAAED,YAEFA,SACEC,EAAA,QAAKM,SAAM,CAAAN,EAAA6/E,GAAA,CAAK9/E,cACdA,eACG8/E,IACCrhC,IACAshC,CACEN,iBAAkB/nD,CACpB,WACD,SACDz3B,CAAA,EAAOM,CAAM,EAAMo/E,GAAO7/E,EAAS,aAC/B,MACH,SACL,CAAAG,EAAA,UAAKM,SAAM,CAAAi/E,GAAAv+D,IAAA,WAAA4+D,EAAK7/E,SACdC,EAAAgC,EAAA,CACEK,WACoDu9E,CACnD7/E,CAED,GAAA3F,EAAA,cAAwB,OAClB,EACR4F,EAAAqT,GAAA,CAAM/S,MAAM,MAAQ,kBACnB+S,SACClR,aAAM8a,EAEN1J,CAAY0J,YAAE,UAAwB,KAACK,EAAA,qBACxB,CACbA,IACC,MAAApiB,GAAY,qCAAAyE,EAAA,aACXtD,GAAI4gB,EAIF5gB,CAAS4gB,YAAC,GAAAjc,EAAwB,EAACsc,EAAA,WACnCtc,wBACAsc,OACA1jB,EAAO8kD,YACGzhC,EAEVxkB,CACA4D,WAAS4gB,GAAC,KAAiC,EAAC,SAC9Cjd,EAAA,UACF,KAAG,SACL,qBAAED,aAEF,WAAA6/E,EACE1/E,SAAKF,EAAAgC,EAAA,CACL1B,WAAM,CACN+B,CAAmCu9E,EAEnC,MAAqB,EACf,GACI,GACV,EACA,CC3YlB,SAAwBG,IAAsB,CAC5C,KAAM,CAAE/mF,KAAGC,KACL,CACJ+mF,eACAC,eACAC,gBACAC,kBACAC,iBACAC,mBACEC,KACJ,OAAKH,EAEHtgF,EAAA,OAAKS,MAAM,wBAAuBP,SAAA,CAChCC,EAACS,EAAI,CAACC,KAAK,OAAQ,EACnBV,EAAA,KAAGM,MAAM,uBAAsBP,SAAA5D,EAAE,CAAA/B,GAAA,SAAwB,CAAC,CAAI,EAC9D4F,EAAA,QAAMM,MAAM,SAAU,EACtBT,EAAA,QAAMS,MAAM,0BAAyBP,UACnCC,EAAA,UACEE,KAAK,SACLI,MAAM,SACNH,QAASA,IAAM,CACb6/E,GACF,EACA39E,SACE,CAAC89E,GACDD,EAAgB,GAAKE,EAAe/nF,QAAQmC,OAC7CuF,SAEDC,EAACS,EAAI,CAACC,KAAK,eAAeE,IAAGzE,EAAE,CAAA/B,GAAA,SAAU,CAAC,CAAG,EACvC,EAAE,IACTgmF,EAAe/nF,QAAQmC,OAAS0lF,EAAc,KAAG,IACjDE,EAAe/nF,QAAQmC,OAAQ,IAChCwF,EAAA,UACEE,KAAK,SACLI,MAAM,SACNH,QAASA,IAAM,CACb8/E,GACF,EACA59E,SAAU,CAAC89E,GAAmBD,GAAiB,EAAEngF,SAEjDC,EAACS,EAAI,CAACC,KAAK,gBAAgBE,IAAGzE,EAAE,CAAA/B,GAAA,SAAM,CAAC,CAAG,EACpC,CAAC,EACL,EACN4F,EAAA,UACEE,KAAK,SACLI,MAAM,SACNH,QAASA,IAAM,CACbkgF,GACF,EAAEtgF,SAEFC,EAACS,EAAI,CAACC,KAAK,OAAOE,IAAGzE,EAAE,CAAA/B,GAAA,SAAM,CAAC,CAAG,EAC3B,CAAC,EACN,EA1CsB,IA4C/B,2ZCRM,CAAEoiF,wBAAyBC,EAAiB,EAAIvtE,GAEhD+c,GAAQ,GACRs0D,GAA6B,GAC7BC,GAAa,EAEnB,IAAIC,GAAsB,GACtBC,GAAoB,GACpBC,GAAkB,GACtB,SAASC,GAAoBxmF,EAAI,CAC/B,OAAOsmF,GAAkBtmF,CAAE,EAC3B,OAAOumF,GAAgBvmF,CAAE,CAC3B,CAEA,MAAM03D,GAAwB,CAC5BpuC,MAAO,UACPumC,OAAQ,SACRxmC,SAAU,QACZ,EAKMo9D,GACJ,sLAEIC,GAAmB,SAIzB,SAASC,GAAW1qF,EAAQ,CAC1B,KAAM,CAAE+D,MAAO/D,EACT,CAAEoD,QAAOC,YAAawB,GAAI,CAAExB,SAAUrD,EAAOqD,SAAU,EACvDuD,EAAaC,GAAYtD,CAAM,EAC/B,CAACwtD,EAAcC,CAAe,EAAIC,KAClC05B,EAAa55B,EAAavzC,IAAI,OAAO,EACrCotE,EAAiB75B,EAAavzC,IAAI,YAAY,EAC9C6O,EAAa3H,SAASimE,GAAcC,EAAgB,EAAE,EAC5D,IAAIpa,EAAYnkD,EAAa,EAC7B,MAAMw+D,EAAgB95B,EAAavzC,IAAI,eAAe,EAChDstE,EAAc7V,GAAU4V,EAAexnF,CAAQ,EACjDwnF,GAAiB,CAACC,IACpBta,EAAY,IAEd,MAAMua,EAAgBva,GAAa,CAAC,CAACoa,EAE/Bl1B,EAAO3H,GAAUhqD,EAAIV,CAAQ,EAC7B,CAAC2nF,EAAYC,CAAa,EAAIloF,EAASQ,EAAOgD,SAASmvD,CAAI,CAAC,EAClE3zD,EAAU,IAAM,CACVwB,EAAOgD,SAASmvD,CAAI,GACtBu1B,EAAc1nF,EAAOgD,SAASmvD,CAAI,CAAC,CAEvC,EAAG,CAACA,CAAI,CAAC,EAET,MAAMw1B,EAAYjtE,GAAQ,IAAM,CAC9B,KAAM,CAAEwqC,gBAAiBllD,EACnB6V,GACHqvC,GAAcrvC,UAAY,KAAOqvC,GAAc90B,QAAU,IACtDw3D,EACJC,GAAU,mBAAoBhyE,CAAQ,GAAKgyE,GAAU,SAAUhyE,CAAQ,EACzE,MAAI,CAACA,GAAY+xE,EACR,IAEF/xE,CACT,EAAG,EAAE,EAELrX,EAAU,IAAM,CACV,CAACipF,GAAcxa,IAChB,SAAY,CACX,GAAI,CACF,MAAMr4D,EAAS,MAAM/U,EAAMM,GAAG6C,SAASD,QAAQvC,CAAE,EAAEQ,QACnDwxD,GAAW59C,EAAQ9U,CAAQ,EAC3B4nF,EAAc9yE,CAAM,CACtB,MAAc,CACZ/V,4BAAiB,EACjB8iB,SAAM,KAAAgmE,CACNlyE,CAAgBkyE,IAEjB,EACL,CAAA1a,CAAA,GACF,MAAIA,EAAUqa,EAAAjkF,EAAA,SAAAmnD,GAAA88B,EAAAxnF,CAAA,qBAAA2nF,GAAA,iBAER5+D,MAAmBy+D,kBACrBjkF,2CAA6CvD,QAAY+oB,QAGvDi/D,KACJxrF,KAGIyrF,EAAapiF,aAAkBtC,EAAA,aACnCxE,aAAY,EAEV2oF,EACD,cAAAG,GAECp7B,EAAa,gBACfiB,EAAO,wBACLC,EAAI+5B,CAAe,EAGjBh6B,KAAa2lB,EAAO9vE,EAAO,eAC3BmqD,KAAoB,CAAAnwD,EAAe+mC,EAAA4jD,EAAA7jD,IAAA,CACnCspB,SAAgBD,SAAY,CAAAg6B,EAAA,CAC9BO,EAAA,EACF,OAEF,GAAME,YAAmBtiF,oBACnBy+B,CACF,MAAI0jD,IAAoB1jD,CAAYojD,EAClCO,CACA,GAAA37B,EACF,SAAA5mB,EACIynC,KACF,EAAA1nC,EACM2iD,GAAAC,GAAA/7B,GAAA5mB,GAAA3sB,CAAA,EAAM2sB,MAAJhlC,+EAAIglC,eAAU3sB,kCAAI,OAAI0sB,yEAC9B,GACM6iD,IAAM7rF,SAASkI,IACnB,GAAA4jF,EAAA,KAAAC,GAAA,EAAAA,EAAA,sBACF,GACAtqF,WACsBunB,oBAAsB,KAC1CvnB,EAAA,MACEuqF,mBAAsBC,GAKzBrkD,GAAA,SAEKnmC,EACJqqF,QAASznF,iBACLynF,6BACsB,QAAKzd,IAEzB5xD,EAAI,yBAAO,EAAEusB,GAAW6iD,GAAKpqF,GAAI,mBACrCA,QAAI,sBACNA,EAAA,QAAMyqF,iBAAsBC,EAC1B1qF,GAEEmmC,GAGkC,MAC/B4jD,EACL,CACW,GAAA9a,EACZua,CAAA,GACDiB,cACEzqF,iBAAS2qF,KACT3qF,QAAW4qF,uBAAmBV,aAC/BW,GACHA,EAAO,OACM,EACb,KACF,MAAO,iBAAA7jE,CAAA,CACL+iE,IAAW,GAAAvpF,EACb,KACF,MACCyuE,EAAWua,SACd,oCAEAhpF,SAAgB,QAAAsqF,GAAA,CACdA,eAA6B,WAE3B,GACID,KACFA,EAAUzjE,QAAM0jE,GAAA,CAClBA,EAAA,yBACC,CACH,CACF,EAAG,EAACtB,EAEJhpF,EAAU,MAAM,CACd,MAAMuqF,gBACNA,YAAgBv7E,GAASs7E,OAAmB1iF,EAAA69B,GAAA,CAC1C6kD,mBACD,SAAAxB,GAAA9mF,EACD,SAAAV,EACEipF,QAAgBv7E,SACds7E,UACF,QAACb,CAAA,CACH,EAAA7hF,EAAA,aACG,gCAEL,SACEA,EAAA8jB,GAAA,CAAKxjB,OAAM,IAGM,GACTmiB,MACAqb,IAA2B1jC,GAC3BV,UACA8a,SAAM6sE,EACN9gE,SAAOmC,KAAa,CACpB1hB,KACD,SAED3K,EAAA,SAAKiK,WAAM,CAA+BP,CACjC,GAAO,EAAE,CAIf,SAACgC,GAAIw/E,QAEX,CACqB,SAAAqB,EAAWxoF,KAChB,QAAA+F,EACX/F,IACiBV,IACjB6nF,OACDqB,EAAA5iF,EAAA8T,GAAA,CAAC,MAEL,cACE,GAAA/R,EAET,QAAA5B,EAEA,GAAA0iF,CACE,GAAA7iF,EAAM,OAAE4iF,qBAAU7gF,WAAI5B,MAAY0iF,CAClC,SAAOD,KACJ9uE,GAAI,OAACxT,KAAM,MAAAyL,EAAA,sBAAAsJ,EAAA,WAActT,MAAQ5B,4BAAsB0iF,IAAS,GAAAzoF,EAEjE,UAAAmnF,EAAW,aAAervE,CAAU,GAAgB,KAAG,CAE3D,EAAA/V,CAGA,EAAAlD,GAAS6pF,EACP,CAAOpgF,EAAaC,CAAaD,EAAKlE,GAAiB,EACzDwiF,EAAA55B,EAAA,aAEM27B,EAAc37B,EAAiB,IAAK,iBAE1Cyf,EAASmc,SAAahC,EAAA,MAAE5mF,uGAAImnF,GAAY0B,CAAA,EAAA7pF,EAAAguD,EAAA,aAAA54B,EAAA,qBAAK90B,EAAU84B,+BAAgB,CACrE,MAAA/4B,EAAQT,YAAGC,IACX,SAAOmuD,CACP,GACM85B,CACN,MAAMra,EACN,SAAMr4C,EAKN,cAAA5U,CAGA,EAAA1e,KACMitB,EAAAzuB,IAAAuuB,EAAExuB,QAAOC,YAAawB,GAAIoiB,CAAA,EAAAlkB,EAAA,WAAEM,EAAU84B,IAAcu5B,EAAA3H,GAAAhqD,EAAAV,CAAA,EACpDwpF,EAAA/qF,EAAA,GACJsB,EAAOuuB,MACPtuB,IAAUuuB,CACVrO,kBACF,IAAI1e,EACJ9C,OACA,MAAM6E,EAAaC,OAAYtD,CAC/B,GAAOgD,GAAUumF,QAAe/pF,OAChC,KAAO4nB,CACDoiE,YACN,EAAMr3B,EAAO3H,QACP8+B,gBAEAr2B,GAAgB10D,MAEpB00D,MACF,OAAAA,EAAK,mCAAAsB,EAAA,CACL/1D,QAAU,EACR,GAEE+1D,IACA,IAAM,CAAAA,EAAEjE,SAAU2C,EAAIA,SAAcx0D,+BACpC,CACEsoF,kBAAsBz2B,QACxB,CACF,gBAAAi2B,EACAtzB,kBAA4D,cAAAqzB,GAE5D,eAAAE,CACAjyB,KAAS,EACTk1B,EAAalrF,EAAA,EACXg2D,EAAgBh2D,EAAA,EAChB00D,GAAcx0D,CAASymC,IAAoB,GAC7CwkD,EAAAnrF,EAAA,MACEiC,MAA0B,CAE9B,GAAM,CAAAkpF,EAAA,eAAEnD,IAAiBoD,YAAiBrD,eAAeE,cACvDE,UAEF,GAAM+C,GAAgBlrF,IAAO,QAC7B,SAAiCioF,EAAA,QAAAF,EAAA,EAC1BsD,cAA2CC,GAAA,WAC5CH,GAAyBlD,EAAA,QAAAF,GAAA,MACEwD,GAAA,WAAAA,GAAA,gBAC/BjrF,GAAYkrF,GAAA,OAAA7gD,IAAA,UAAewgD,KAAYjrF,iCAAS,OAAAurF,IAAAC,KAAA,CAAAC,IAAAF,IAAAE,GAChD,EACA,CAAIC,EAAEC,YAAWL,WAAatC,sBAAW,MAAIiC,EAAYjrF,QAEzD0rF,EAAI5D,aAIF/zB,GAAMq3B,MACN,cAAMI,EAGN,GACAr1E,mBAAoCk1E,iBAChChhF,GAAKlE,WAAMklF,GAEfC,EAAcA,OAAYpwD,WAAc,CAGtC,GAGkBuwD,MAEnBG,EAAAF,EAAA,MAAAjhD,OAAA,aAAAohD,EAAA,YACHC,GAAA,GAEAH,WAAelB,IAAa,CAS1B,GARFa,MAAiBb,EAAa,CAI9B,GACAkB,GAAU58E,aAASoH,IAAW,KAAAs0B,OAAA,KAAAt0B,GAAA,cAAAA,GAAA,cAAA01E,EAAA,IAC5B93B,MAAmB1yD,GAAU,aAE5B8U,GAAA,qBAAAA,GAAA,WACD21E,GACS34B,OACNw4B,UAEDI,GAAgBj8E,cAAWqjD,EAAW,GACxC24B,GAAA,KAAA31E,EAAA,UACD,CAAAA,GAAA,oBAAA21E,GAAA,KAAArhD,OAAA,KAAAt0B,GAAA,aAAAs0B,GAAA,aAAAohD,EAAA,aAAA11E,GAAA,aAAA01E,EAAA,WACDC,GAAMF,KAAoBD,SAI1BL,SAAYv8E,GAASoH,KAAWs0B,OAAA,KAAAt0B,GAAA,aAC9B49C,KAA6BjlD,GAAA,YAE5BA,GAAA,cAOCi9E,aAAgBj8E,OAAWqjD,EAG7B,CAEE24B,GAA6BA,GACpB31E,KAAOg9C,UAEhB24B,WAA6B,WAC/B,OAAAp4E,GAAA,QACGyC,KAAOg1C,eACR2gC,QAEM/pF,GAMN+pF,oBAA6Bp4E,GAAA,aAAAs4E,GAAA,EACxB,CAEL,GACAD,EAAY,KACV,IAAAE,EAAYC,EACVp9E,eAAmBq9E,GAAA,OACrBC,GAAAD,GAAA,EACAr9E,UAAOo9E,IACTD,EAAOE,IAGPE,IAAA,IAAAC,KAAA,CACF,GAAAA,GAAA,GACD,QAAAA,GAAA,QAGDR,aAAkB/uE,gBAChB,QAAMivE,WACN,UAAqBA,IAErB,SAEA,QAAOO,GAAAD,GAAA,UAAAF,EAAA,GACR,CAEDhsF,CAAY,MAAEurF,gBAAWL,SAAaQ,mBAAmB,UAAArhD,GAAA,WACzD,cACErqC,OAAQ6Y,WAAM,KAAA4yE,EAAqB,WACrC,OAAAW,GAAA/hD,EAAA,EAEA,MAAIwhD,EACJ,QAASM,gBAAwBJ,GAC/B,sBACA,IAgBWryE,MACX2Q,CACAgiE,YAjBER,MAAwBE,UAC1B,GAAA1hD,GAAA,GACA,SAAO4hD,GAAuB,SACrBtqF,YACEuqF,WAAGxyE,sBACKm9C,aACL/uB,uBACZwkD,OAA2B,UACpBN,gBACP93D,CACF,GAAAvyB,EACF,UAAA8pF,EAAA,WAEA,OAAMc,IAA0Bb,EAC9B/pF,UAAMA,kBACK+X,EAGX81D,oBACA8c,0BAA0B,CACnB,IAEMpiF,EACf,WAAAsiF,CACA,QAC2B3nE,EACjBljB,eACN8qF,GAAU,MACV7e,EAAU4d,SACVnhE,EAAa3Q,CACbA,QAAWA,cACKm9C,WACU,EAE1B6zB,EACFgC,CAAA,OAEEriE,IACAiiE,IAAmC,IAMvCtsF,gBAAY,CAAE2sF,qDAAad,UAAuB,EAC3Ce,EAAAC,GAAA,IAAA7rF,EAAA,oBAAAW,CAAA,mBAAEgrF,UAAanB,EAAmBe,mBAAwB,IAAAd,EAAAjnF,EAAA,SAAA8uD,CAAA,EACnE,KAAAjG,IAAA,CAAAm/B,GAEMM,IAAiBN,YAAgB74B,GAAM83B,EAAAxqF,CAAA,EAC3CjB,MAAQw6D,gBAAuB,CAC/B31C,WAAW4M,GAAS,IAChBs7D,EAEJ,MAAMC,CACFA,SAAgB,EAElB,MACG3iD,CAEH,IACAqgD,SAAYgC,QACP,CAQLhC,UAAaY,EAAA,EAAE3pF,GAAKkpF,EAAA,SAEtB,GAAAvtF,GAEC,WAAYmuF,CACX,EAEIwB,MACD,YAAAN,GACH,kBAAAnB,GAGIyB,0BAAS,EAEbC,EAAA,EAEM7/B,GAAc7oD,WAAwB,CAAAgnF,GAAA,GAAAe,GAAA,OAAAliD,OAAA,QACxCu+C,IAAapkF,GAAwB8mF,GAAA,UAAA6B,GAAA,OACrC9/B,GAAcm/B,MAAY,KAC5BxsF,EAAcotF,GAAA,GAEdvoE,EAAI,WACF+jE,UAAmByE,CACnB15B,UAAWi1B,EAAY3nF,SAAQ,UAE/B,UAAU6/C,EAASrvB,SAAY,SAC7B3wB,EAAuB,MACxBwsF,GAAAhC,GAAA,cACS7pF,IACVzB,MAAe,GAEf0qF,EAAAiC,EAAA,EACF1E,GAAAtmF,CAAA,EAAAgrF,GACFY,GAAA9B,EAAAxqF,CAAA,CAEA,MAAI,CACF4jB,SAAgB,CAChB,CAAM,KAAE0mE,EAAcjuF,mBACtButF,KAAsB,aAAKvtF,IAASsrF,EACpCjpF,EAAAmtF,EAAM,CAAAnrF,EAAAX,CAAA,GAAArB,EAAEgtF,SAAanB,KAAmBe,CAAwB,YAAAI,CAGhE,EAAAO,EAAMC,EAINzC,EAAMK,EAEN,MAAIA,CAGFyC,CAAgC,GAAA9F,EAClCD,EAAA,GAEA5iE,SAAW4oE,EAAS,EAAA9sF,EAAA,IACpBiqF,OAAwB,IAAAn+C,EACtBihD,gBAAyB9tF,CAAS8tF,MAClCj8B,cACFk8B,EAAA,SAAApqF,GAAAoqF,EAAA,cAIAF,GAAMH,GAEJM,OAAsB,MACxB,KAEAlD,cAAYiC,EACZ1E,CAKAsF,MAAoC7nD,GAC1B,KACV1lC,aAAe,OACf6kB,QAAkBqjE,GAAAvmF,CAAA,KACpBksF,EACFz5B,EAAG,kBAAAy5B,UAEHF,EAAkB/tF,QAAe2D,CAEjC,MAAOuqF,GAAM,CACXjtF,UAAaksF,EAAS,mBACxB,UAAA34B,EAAA,oBAGQ04B,EAAcnrF,GAAU,UAAAipF,EAAA,kBAAAkD,GAAA,UAElCnuF,EAAgB,kBAAAouF,CACd,MAAI5pF,EAAA,aACFiwD,EAAM,qBAAEu4B,EAAgBO,YACxBxC,OAAuB/qF,MACb,CAAC6E,EAAA,sBAGZ,SAACkjF,CAEJ,GAAOsG,CACPruF,KAAU,CACJ8sC,aACF,EAAMlpC,GAAe,EAEnBoqF,cAAkB/tF,CACZ+tF,gCAGR,aADiB,MAAI,oBACrB,OAAAM,GAAA,CACO,aACT,GACEhrF,EAAcwpC,CAChB,cACG,CAEL/G,MAAgB,EACd,IACA1lC,KAAQw6D,gBAAkBr2D,GAC1BxE,EAAMkuF,IACN7tF,IAAQw6D,CACR0tB,GAAM2F,GACJ7tF,mBAAwB,EAAAioF,GACtBtmF,MACAksF,GACFK,GAAC,OACD95B,EACF,IACE,MAAAw0B,EAAMkF,EAAmB,SAAAx6B,CAAA,GAAA9uD,EAAA,SAAA7C,CAAA,EACvB+rF,MAAyB9tF,KAAS8tF,GAClCj8B,YAAkCA,KACpC,CACA,QAAA/3C,CAIA1Z,gBACiB4qF,cAAchrF,iBAC7BkuF,wBACAC,uBACA5pF,GACDgqF,GAAAtyE,GAAA,KACDu4C,YAAsB3C,GACxB,IAAA/iC,EAAWvqB,GAASpC,CAAW,EAC7B/B,gBAAc,KAAU0uB,EACtB/sB,mBAEFyyD,CAAkC,EACpC,CAAAw0B,CAAA,GAGAgC,OAAwBuD,GAAA,GAAAC,EAAA,MAAAD,EAAA,IAAAzqF,EAG1B/D,CACE,GAAI6E,YAEJ,CACE,qBAAI,EACF,MAAA6pF,GAAMxyE,GAAA,SAAA+sE,EAAEhzE,aACR,IAAAoE,CACAha,IACA,GAAAga,EACA,WAAMs0E,kBAA4B,GAAA1F,CAAE2F,GAAiBC,GAAC3yE,GAAA,KAEtD,GAAAwyE,GAAmB,OACjB7B,KAAYvrF,CAAA,GAAAotF,GACbptF,CAAA,OACMzC,EAAG,EAAAmC,EAAA6yB,EAAA,EACVxzB,MAAe,IACjBmE,EAAA,OAAA1C,GACF,CAAA0C,EAAG,OAAA1C,EAAA,GACD+C,GAAWwhD,EAAiB,KAAA3b,KAAA,YAEhC1qC,GAAgBwE,EAAA,OAAAkmC,KAAA,UACd,CAAAokD,GAAaC,EAAA,EAAA/tF,EAAA,IAEXunF,MAAmB,KACnB/mF,MAAO6kD,SAAmByoC,GAAA,YAC1BxG,MACAD,KACAkG,YAAwB,wBAC1B,OAAAn8E,EAAA,aACF,EAAG,GAAE,GAELpO,aAAmBa,CACnB,SAAM4pF,MAEJ,GACgB,QAAIxF,GACpB,gBAAYlrF,GACIgc,WAAQqP,uCACHqF,WAAK5vB,EAAA,SAAAA,EAAA,QAAAA,EAAA,SAE5B,OAAM2vF,EACJ,GACAxqF,GAAI+qB,YAAkBk6D,KACtB,SAAS7mF,MAGP2sB,GACF,UACA,gBAAOA,8CACT,EACA2zC,YAEgD3+D,sEACxCirF,GAAAC,GAAA,wBACIC,EAAA,WAAAz6B,EAAA,yBAAAg0B,EAAA,GAEN,GAAAwG,GAAAD,GAAA,IAAAv6B,EAAA,sBAAAu6B,GAAA,UACJ,MAAAG,EACFD,EAAA,QAAAD,CAAA,EAEA,IAAMP,EAAexyE,EAAcizE,EAAA,GAC5BlG,IACLmG,EAAM,QAAE/0E,qBACR,KAAKA,CACL,MAAOsgB,EAAgBzjB,WACrB+xE,SAAWhN,EAAA,wBACT4S,eAA2B,IAAMQ,GAAA,OACrC,GACAC,IACEZ,EAAcptF,MAAS,EAErBguF,EAAgB,eAAaz7D,EAAK,EAGtC,CACF,EAAG,CAEH,UACA,gBAAkBrvB,KAAS22B,SAAQuP,EAAMA,SAAU7rC,EAAA,QAAAA,EAAA,QAEnD,GACAmF,GAAMurF,SAEJ,MAAKvE,EAAc/qF,SAAW6uF,cAAY,QAAO,+BAC3CE,GAAAC,GAAA,wBAAE78E,6CAAI,GAAI44E,GAAc/qF,GAAQ8mB,MAAsB,sBAAAioE,GAAA,UAC5D,MAAO58E,EAAmB88E,EAAA,QAAAD,CAAA,EACxBH,MAAWI,EAAAC,EAAA,GAEfnrF,IAGIiT,EAASpL,MAAOs9E,EAElBqG,EAAA,eAAA91B,EAAA,gBAGY+U,WACV/nE,SAAwBu1E,EAAA,wBACtB,OAAMxuB,GAAa1vD,YAAuB,OAC1C,GACFuxF,IACA7oF,EAAQ,QAEZ6oF,EAAA,eAAA51B,EAAA,EAKIziD,CACF,EACA,CACExQ,OAAQ,GACRC,mBAAwB7H,EAAE+H,SAAW/H,EAAEgI,SAAWhI,EAAEiI,QAAUjI,EAAEyH,SAEpE,EAEAtC,GACE,IACA,IAAM,CACJ,MAAMirF,EAAelxF,SAAS+9D,cAAcsQ,QAC1C,6BACF,EACA,GAAA6iB,EAAMD,CACN,WAA6Br6E,mBAG7BtU,IAAYovF,GAAA,oCAAEP,iBACd,CAKE,GACA,OAAIE,GACJ,gBAAgBvwF,KAAA,SAAAA,EAAA,SAAAA,EAAA,QAAAA,EAAA,QACduwF,GACAA,WAA0B11B,MAAqB,EACjDg2B,GAAA3vF,EAAA0uE,EAAA,yBACFkhB,GAAOxoF,GAAA,CAAAtI,EAAA4Q,GAAAs3B,EAAA3wB,IAAA,CAELvX,EAAA,eAAMywF,EACJzwF,EAAA,gBAAMwwF,EACNpgC,EAAOogC,CACT,MAAC5/E,GAAA,EACD,cAAI6/E,IACFA,EACAA,OACFM,GAAAzoF,GAAA,CAAAtI,EAAAuX,KAAA,CACFoyE,GAAApyE,GAAA,GACF,EACA,IAAApW,EACU,KACR0G,MAEJ,OAAAoiF,GAAAra,IAEAzqE,aAEQ,KACJ,MAAMirF,KAAwBnzB,uBAC5B,wBAAAgtB,CACF,MACMkG,IACAE,kBAAiBx6E,EACPzU,CAOd,KAAMkvF,GAEFK,KACFA,aAAW5oE,EACX4oE,CAA+C,GACjD1G,EAAAra,CAAA,SACFohB,GAAO1oF,GAAA,CAAAiP,EAAA3G,KAAA,CAEL,MACE,GAAAi2B,EACA,SAAAonD,EACF,SAAA7e,EACA,WAAAye,GACE4C,SACAA,WACF,aAAAp4B,GACF,OAAAy1B,GAEF,MAAAP,EAAA,EACE3lF,EACAC,SAMJ1C,cAEE,CACE,IAAMirF,KAAwBnzB,KAG9B,MAAImzB,KAAc,iBAAAvC,GAAA,mBAAA7c,EAAA,eAAAigB,GAAA,YAChB,UACAA,GAAIL,EAAWA,EAAQM,CACrBN,SAAQ9kE,GAAQ8kE,GAAQ9kE,CAC1B,aACF,SAAA6yC,IAAA,CAEF,oBACU,2BACR92D,MAEJ,EAEOspF,EAMDN,uBAIAznF,SAAe,EACfsvB,SAAgB3vB,EAAA01B,GAAA,CAClB2xB,WACSx/C,yBACezN,GACvB,SAGL,mBAEM4tF,gBACJpH,EAA6B,CAC1B,EAAA5/D,IAAA,YAAApH,EAAA/Z,EAAA,OAEK,MAAM,qBACV+e,4BACiBioD,EAAW,YAE5B,EAGA,CAAIr4D,IAAQsF,GAAA,CACVtF,MAAsBsjD,mBAAqB2qB,EAAA,qBAC7C,eACI,SAAAz8E,EAAAgC,EAAA,CACR,WACA,CAAO,CACL1I,GAAkB,CACpB,GAAA6uB,GAAAtoB,EAAA,OACEqhF,2BAEE+G,UAAe1oF,OAEX,SAAAS,EAAAgC,EAAA,CACA87B,YACJonD,QACA7e,YAEA4B,YACAt7C,YACA2iC,CACAy1B,EACAP,cACEh2E,uBACWsvB,IAAa1jC,kBACTisE,OAGjB,qBAEgB+c,CACJ8B,IAE2C,MAAAp7D,GAAA,MAAA9B,EAAA,kBAGnDloB,EAAA,IACEE,KAAC41B,WACCv2B,QAAW,GACAu2D,OACT3J,GACEo8B,eAAsB,OAAM,CAC1BlB,SAAoBr9D,GAAA,YACrB,cAAA7B,EAAA,IAAAA,CAAA,MAAA68B,GAAA,WAAAA,GAAA,IACF,KACH,8BAEA5yC,OAAUjb,GAAA,CAAE8I,EAEX21B,SAAM,EACLoI,QAEAwqD,CACK,YACLC,OAAe,CACfjhE,IAAgBkhE,CACjB,CAGD,CAAW,CAAoBzoF,CAC7BA,IACE,WAGO,CAAAC,EAAAS,EAAA,CAETT,KAAC8T,UAAI,CACH/R,EACE06E,SAIFn8E,WAAM,CAAQP,EAEd,MAAoB,GAChBF,EAAC4oF,GAAA,UAhIvBpiB,GAAA6e,EAoIgB,GAAK5kF,EAAM,IAAA5G,CAAA,MAAAokC,CAAA,SAAAA,CAAA,WAAoB/9B,IAC7BC,CAAA4gF,GACE5+E,CAAA,YAAA3H,MAAA,GAAA6qF,EAAAllF,EAAA41B,GAAA,WAAAl8B,YACkDk8D,IAAA,2CAAI,KAAC8yB,GAAA9yB,EAAA,CAEhD,EACN,EACH,EACO,WACK50C,IACV7gB,WACEmd,WACA,cAAa,GACX,KAAA2qD,GAAIid,EAAA,QACF,gBAAMp7D,GAA4C,aAC7Cu3D,GAAW5uE,kBACRu1E,EAAA,EACG,GAAAhoF,EAAA01B,GACTx7B,CAAO,SAAA4jC,EAET,SAAApkC,EACE,iBACA2V,UAAgB4Y,QAEG,gBACd,GACL,aAAA8/D,GAA4B,kBAC9BC,GAAA,eACO/wF,EAAG6tF,EACVxnE,SAAoB,GAAAzd,EAAA,OACpB0b,qBAAKpf,+BAAC,IAAAA,EAAA,CAAAlF,WAAY,CAAC,CACnBwB,gBAAcxB,CAAC,MACjBq4D,GAAA,SACCx9B,GAAAw9B,EAAA,GACL,IAAEvvD,IAEG,GAAM+kF,IAAcn4D,IACzB3qB,OAAA,GAAAhC,EAAA2oF,GAAA,UAAAjvF,EAAA,QAAAizB,GAEQ,gBACDs7C,EAAA,MAAAuc,GAIf,UAEDiE,GACC7F,UAAUgG,WACV7mF,iBACe,IAAArI,CAAA,MAAAokC,CAAA,SAAAA,CAAA,GACb8iD,eAA4B9iD,CAAA,EAC9B,GAUS9c,IACL3hB,WAAW6oF,IAAA,EAAA7G,GAAA,eAAAwH,IAAA7oF,EAAA,aACXyV,iBACEw2C,cAAe,CACbo8B,uBAA4B,CAC1BK,EAAsB,GACvB1nE,IACF,SAAAknE,IAAA,EAAA7G,GAAA,eAAAwH,IAAAhpF,EAAA,aACH,wBAAEE,KAED21B,CAAM,GACLoI,WACApkC,4BACA4uF,SAAa,MACb3nF,QAAiC,QACjC4nF,KACAn5B,oBAAc24B,EAC2B,SAC1C/nF,EAAAgC,EAAA,CACK,GAERhC,QAAO,CACL89B,GACApkC,GACa,CACoB,EAAAokC,CACjCyqD,CAAe,GAAAnuF,EAAAV,EACf01D,EAAc24B,mBACKC,0BACnBc,QAAkBhE,2BACnBiE,EAEF7D,WAAY51B,QAAe,aAC1B,yBAAAy5B,GAAW,WAAchpF,GACtBU,KAAIsoF,EAAA,IAAM,CAAc5sF,+CAAE6sF,GAAA10E,GAAA,SAAAugB,GAAS,eAAAw3B,EAAC,YAAG48B,GAAEz6E,EAC1C,CAAA69C,EAAA,KAAMhpD,EAAOisD,MAAavvD,SACGyO,EACtB,gBAAAy6E,EAAA,CAEL,CASM,OAAArsF,EAGfkoF,QAAcn4D,UAASnyB,EAAS,EAE7Bd,uBACAizB,kBACAu8D,KAAiBjhB,MACjBuc,UACA2E,KACoC5I,CACxB,GACVx+E,SAA4D,OAC5D5B,CACF,OAAAipF,CAAA,CACD,CAMC,EAA2BrpF,CAClB,MAACiiB,GAAQq/D,WAAW/xB,MAAgB,OAAIn9B,GAAA,EAGpDnR,CAIQ1gB,YAAoBP,QACvB3F,QAAA,CAEA,CACO,CACC,CAEJR,CAAO6kD,SACTnqC,GAAA,WAAAqe,EAAE5yB,GAEFspF,GAAAzsF,EAAA,QAAA1C,EAAA,UAAuB2N,EAAA,EAAAA,EAAAwhF,GAAA,OAAAxhF,IAAA,OAChB2G,EAAA66E,GAAAxhF,CAAA,KACNA,EAAA,GACN,MAAA+/E,EAAAyB,GAAAxhF,EAAA,GAzMEi2B,CA+MTpkC,aAWE4vF,aAEA,OAAArhB,GACF,KACA,IACE,GAAA2f,GAAO9G,WAAsBiI,GAAUt2E,CACzC,MAAA82E,GAAA,WAAA5mF,EAAA,EACF,YAAA4mF,EAAA,GAAAA,GAAAxG,GAAA,CACOjC,SAAiB98E,KAAKpK,MAAOklD,WAAcrvC,EAC3C,GAAA+5E,IAAA,SAAAA,EAAA,GAEHR,MACCn0D,YACO,GAAA40D,EACZ,IAEa98D,GAAS,IADF48D,GAAAC,IACEzG,IACXp2D,GAAgBs8D,GACzBt2D,EAAA,KAAA3yB,EAAA,MACF,OACe9F,mBAAqB,YAAAwvF,EAAA,CACpC,EACY9sF,qBAA0B,iBAAAkoF,EAAA,mBAAA7c,GAAA,uBAGjBmhB,GAAQM,EAAA,CAC7B,EAAa,YAAI1jC,EAAA,IAAAyjC,EAAA,IACR,CAAArvF,CAAA,EAAAgvF,EAAa,KAAAnB,GAAAz5E,EAAA3G,CAAA,GAGnB,OAAC8qB,CAAA,EACJ,CAAA/1B,EAAO1C,GAAA+tF,GAAA9H,EAAAD,EAAA,GACL9nF,SAAMuxF,KACN,IAAA/qE,EAAAuT,WAAArgB,gCAAO83E,GAAAxG,EAAA,8FAAAhpF,IAAAwvF,GAAA,YAAAvvF,EAAA,UAAAsvF,sBAGN3pF,EAAA6pF,GAAA,gBAACrG,EACJ,SAAA3jF,EAAA,OACF,cAEA,IAAMiqF,EACJ,oCAAeltF,EAAA,+BAAAkrF,GAAA,qBAAAt5D,EAAA,yBAAAu7D,EAAA,aAAAA,CAAA,SAAA5J,EAAA,yBACf,MAAMkJ,EAAiBzsF,CAEvB,4BAAoBysF,OAA4BjJ,EAAA,mBAC9C,SAGA,eAAWnpF,GAAA,CACT6wF,GAAmBuB,qBAEnBvB,GAAM,aAAEnlF,EAAWmiF,SAAY7c,mBAAQ7tE,gCAAG,WAAIoU,IAE9C5U,EAAIguF,kBACF,EACA,SAAIoC,EAAST,OACX,kCAEA,SAAIC,QAAYQ,CACd,SAAM,CAAAV,GAAAtpF,EAAA,eAAEklF,eAAcuE,kBAAO,QAAI7B,KACjC,cACA,EAEA,aAAoB,CAClBj1D,oBACE,KAEEjxB,KAAO,IACLvF,EAEFmE,CAEGP,WAEsB,CAE7B,CACK,CAWL,EAEJ,GAAAmnF,IAAA7F,GAAArgE,IAAA,UAAAnhB,EAAAC,EAAA,CACF,UAAAD,EAAA,QACF,qBACF,UAAAG,EAAA8S,GAAA,CAEYm1E,UAAaz5E,QAC3B,SAAA9U,EAEOi5B,oBACYs1D,EAGrB7vF,CAAU,EAAM,IAAAyH,EAAA,uCAEOxH,KAAS,IAAA2H,EAAAgD,GAAA,CACtB4mF,SAAgBxG,YAGlBwG,cAAmC,CAClC,EACP,CAAatwF,EAAkB,CAC1B,MAAA0G,EAAA,wBAG+BwjF,gDAClCvsF,GAAA,CACWA,EAAA,iBACJ41D,oBACEu2B,EAAA,uBACI5oF,CAST2lF,+BAEyF,CAErF1hF,CAENwrF,EAGMnC,QAGJ,CACF,YAEA,EAEEn1E,SAAa1b,EAAMwJ,EAAA,CAEVg+C,yCACT,EAAE1+C,EAOF,CAAKO,EAAMT,EAAAC,EAAA,CAA2BC,SACpCF,GAAAmC,EAAA,CAAAjC,eAEI,CACEG,MAAKL,EAAA,UACLS,KAAM,eACGH,kCACPgmD,QAAQ+jC,GAAK,CACfjzF,EAAA,iBAAE8I,kBAEG,EAACW,EAAK,kBAAeC,IAAK,EAAKC,SAAGzE,YAAE,QAAA6nF,GAAA,QAAAoE,GAAA,MAAMjsF,EAAI,CAGrD+qF,YACAnnF,OACEF,CAAMS,EAAM0jF,GAAA,OACD,CACa7xE,EACpBzY,SACAqqD,GAAUtjD,EAAA,CACV0pF,eAAK,CACN,EAAEnG,GACHnkF,OAAA,CAAAkM,EAAAlE,GAAAuiF,MAAA,UAAA/0E,KAAA,YAAAtJ,EAAA,aAAAlE,EAAA,iBAAAq9E,GAAAllF,EAAAwS,GAAA,CAAMlS,MAAM,sBAAA4kF,EAAA,eAAenlF,MAAC,oBAEb,WACDshF,SAAW1+E,OACd,aAAAqhF,GAAA,UAAAnkF,EAAAC,EAAA,CAAO,SACd,KAAAE,EAAA,QACG,sBACD,SACR8xB,GAAAkyD,GAAA,QACE9jF,EAAK,CACLI,EAAM,EACNH,CACElJ,GACAA,KAAE04B,OACFyzD,oBAAqC,SACnC3/D,YAAU,MACVC,SAAO,MACR,kCACH,CACArgB,QAAKlH,8BAAE,KAAA8mF,EAAA,MAAA77B,EAAiB,gBAACA,EAAA,qBAACrnD,SAEzBU,MAAI,EAAA4mD,EACGsgC,CAAgB,CAAwB,EAC9C,MACKxrF,EAGX4D,CACY3F,GAAA,SACV,EACO,SACC4F,EAAAS,EAAA,CACNN,eAEElJ,KAAEoJ,GACFpJ,EACA41D,kBAAsBpuB,CAAS,KAC7Bj0B,SAAK,MACLiZ,uBAAU,QACX,KACH7pB,EAAA,mBACArB,GAASyrF,EAAUxpF,CAAU4tF,EACxBjsF,mBAAE,eAAA/B,IAAA,IAAAC,EAAcG,CAA+B,YAAC,CAEhD,EAAM,GAAUqF,EACpBmkF,IAQU,MAELvxE,MAEmBgP,OAEnB7gB,CACgC,OAN3BskF,EAON,OAIH,EAEE,WAAM5kF,EAAM,eAAeP,SACM,MAC1B,yBAEVC,EAAAS,EAAA,CACM,YAEZ,IAAAtE,EAEQ,IACT6D,QAAA,CACO,EAEL0B,KAAO,KACL2a,CAAoC,CACtC,EACAlc,SAASA,GAAM2C,GAAA,CACbmgF,aAAgB,UAChB77B,aACAA,oBACAA,EACAC,YAAgBD,GAClB,eACA/jD,IAAKlH,sBAAE,YAAA/B,CAAA,CAA0B,GAAC,EAAAyF,EAAAiD,GAAA,CAAC/C,6BAE7BW,QAAK,KAAUC,EAAKopF,IAAA,oBAAK3iC,EAAA,gBAEhCq/B,EACCzmF,OAAA,cACO+pF,IAAA,OACLzpF,EAAM,eAEJ1G,EAAO6kD,mBAET4I,EAAAD,CAAA,CAAErnD,EAEIW,SAAK,CAAAV,EAAAS,EAAA,CAAUE,KAAK,CAAIC,GAAGzE,0BAAE4tF,GAAA,MAAA3vF,EAAA,QAAS,SAAA+B,EAAA4tF,IAAA,OAAI,CAGnD92E,WAAK,GAKJ,YAJM,CAMS,CAAS3S,EAAM,GAAeP,KACxCU,CAAI,QAAM,KAAUtE,4HAAEkuF,GAAA,WAAM,SAAC,CAAArqF,EAAAS,EAAA,CAAEE,KAAK,WAAM,MAAAX,EAAA,QACrC,SAAAA,EAAAgC,EAAA,CACTjC,GAAA,QAEQ,EACe,GAEpBnG,QAAO6kD,UACT,kBAAE1+C,SAAAC,EAEFA,EAAK,CAACU,WAAK,CAAW,CACtB,GAAAX,KACEiC,CAAA,UAAA8kF,IAAAG,GAAA,QAAqB,KAChB,MAAAzL,EAAAH,GAAAgG,EAAA,KAETxhF,EACE0C,SAAU,KAAAi5E,EAERyH,QAEA77B,YAEEA,CAA0B,CAC5B,CACiC,EAEjCC,cAAgBD,CAClB,gBAAErnD,YAEDU,CACCC,MACE,6BACMvE,EAAA2qF,GAEJiD,CAGN/pF,GAAA,SAAAD,QACsB5D,mBAChB,EAA2BA,CAC3B,YADA,CACqB,EAAC,IACrB0D,EAAAiD,GAAA,CACC,SACTA,IAAQke,IAAA,YAAAqgE,GAAA,WAAA6B,EAAA,QACP/iF,QAASA,EAEP,cAAgB2M,CAKhBw9E,WACED,YAAa,CACf,SAACluF,EACD4D,CAEIW,GAAK,SACX,CACE,MAAwC,GAACV,EACpC8T,GAAA,OAET9T,0BACW,GAACuC,EAAU,SAAOxC,IAC3BiC,CAAA,cAA0B,KAChB,IACZnC,GAGI,GAAM27E,QACN,CACEnsE,CAAgBmsE,EAEhBjgE,GAAKpf,KAAC,GAAA6D,EAAA+/E,GAAA,IAAAnjF,EAAA,QAAAykF,EAAAxhF,EAAA,6CAAkBmhB,IAAA,mCAAA8oE,GAACj1D,GAAA,GAAA70B,EAAA,yCAC3B,SACFH,EAAA,eAAEE,SAEG,MAACW,wBAAK,SACXV,IAAA,kBAAOM,IAAM+lF,GAAA9/D,KAAA0F,EAAA,SACE9vB,sBACT,sBAAA6sF,GAAA,mBAAA3uF,SAAA,0BAEA,SAACuC,EAAA,MAAA1C,MAAA,OAAAsU,GAAAxO,EAAAwS,GAAA,KAAEhE,EAAA,oBAACrS,eACJ0D,EAAA,2BAA2B,CAAAG,EAAAgC,EAAA,IAAC,WAC1B,IAAAhC,EAAA,QACA,MACVH,MACEwC,SACEwyB,GAAC1M,GACDnH,WAEkB3oB,EAEpB8H,CAASojF,GAEJ,EAAM,GACX,GAAA1jF,EAAAC,EAAA3D,gFAAO,SAAA6D,EAAA5F,KAAA,UAA6B4F,EAAA01B,GAAA,UAAC,QAAQ,KACpC,EAER,GAAA1U,IAAO,SAAAnhB,EAAA,WAA0BkC,WAAIw/E,SAAUxhF,KACjDU,CAAI,GAACC,QAAK,GAAAV,EAAIW,KAAK,IAAAX,EAAA,SAAAA,EAAA,eAAKY,SAAGzE,eAAE,6BAAO6D,EAAAgC,EAAA,IAAC,UAAG,EAAC,CACrC,GACH,GACH,EAIL,EAE0C,CAKtC,SAAA2mF,GAAU,SAAAh8D,EACR,SAAAjzB,EACO,gBAAAwvF,EACC,MAAA1E,EACgB,UAAA2E,EACkB,QAAAoB,EACjC,WAAAC,CAAkB,GAAM,MACe,EAAAvtE,CAE9C,EAAAhkB,GAAKqH,EAAM,CAAA8mD,EAAkBrnD,CAEjByM,EAAMtS,GAAkBsI,EACzBioF,EAELh4E,GAAoBC,uBAGvB,aAAA48C,EAEH,QAAKhvD,CAAM,EAAAq+C,EACT1Z,EAAAylD,GAAA,QAAAp7B,EAAA,OAAAhuC,EAA0B2jB,EAC1BjlC,EAAA0qF,GAAA,QACoC71D,EAC7BlI,EAAA,OAAA89D,EAAA99D,CAAA,EAAAg+D,EACHh+D,EAAA,SAAAi+D,EAAAluF,EACAiwB,EAAA,IAAAhxB,KAAA,iBAAAoQ,EAAAlE,EAAAuiF,MAAA,UAAA/0E,KAAA,KAAAtJ,EAAA,MAAAlE,CAAA,aAACgjF,EAEZv2E,GAAA,IAGHzU,GAAAC,QAAAwhB,EAAAq9B,IAAA5+C,EACGihB,UACCmoE,CAAI7oF,EAAM,CAAA6oF,EAAuCppF,GAC/C,aAAAgjB,EAAAhjB,IACSwqF,GAAoBM,GAAArK,IAIhCx/D,IAAY4pE,IACX,GAAS/F,GAAAl4D,EAAA,SAAU5J,EACjB/gB,IAAA,MAAA8oF,EACArK,GACA9zD,KACA,IAAAo7D,EACOxoF,GAAA,CAAAtI,EAAA4Q,EAAAs3B,EAAA3wB,IAAA,CAAAvX,EAAA,iBAEH2C,kBAAO6kD,IACT,OAAE1+C,IAEF,cAAAyO,EAAA,IAAuB,MAChBu8E,EAEZ5yF,EAAA,EAAAgmC,GAEJ,cACEY,EAAA9nC,EAAA,CACsBA,EAAA,0BAAAA,EAAA,iBAEjC,CAEA,OAAA8zF,EAASpC,SAAY,0BAAA5pD,EAAA,CACnBpS,WACAjzB,EACAwvF,KACA1E,0CACA2E,CACAoB,MACAC,mBACFpyF,EAAG,KACD,IAAMwmB,EAAE5lB,eAAGC,aAAA,IAAA+xF,EAAA,UAILP,iBAAY99D,CAAY,CAC5B,GAAAm+D,EAAOn+D,CAAQsrD,GACb,MAAAgT,EAAMloE,EAAA,gBAAEusC,uBAAc3iC,SAAQo+D,EAC9B,gBACA,KAAAG,EAAajmD,GAAiBtY,SAChC,SAAIu+D,EAAAj0F,GAAA,CACN,MACM2zF,MACN,EAAMD,SAGNlK,GAAiB9zD,EACThxB,KAAMA,EAAEwW,CAIhB,EAAM04E,OACJ,MAAOl+D,CACL,mBAAoBo4D,GAExB,wBAEA,+BAAWP,EAAA,EACX,SAAI+F,CAAS,CAAAxnE,GAAAljB,EAAA,WACXkjB,MAAO,kBACT,SACEA,SAAO,CAAA/iB,EAAA,QACT,MAAYkpF,UACV,SAAMiC,EAAatG,SAAiBl4D,GAAU,oBAEhD,SAAA5gB,EAAA,gBAAAA,EAAA,WACM++E,YAAarK,GAEnB,QACExpF,CAAEoJ,WAAe,CACfsvB,uBACF03B,YAAgB,cACHrnD,EAAAgC,EAAA,aAEZ,QACE,EAAA2qB,EAAA,YAEqBA,EAAA,OAC1BwR,EACE,YAGI98B,EAAO+pF,SAAQ9sD,CACnB,MAAA3R,EAAA,MACAo+D,CAAW1yF,CAAkD,CAClD,CACV,CACD,GAAO,CAAAsyF,GAAMC,EAAA,GAAA/qF,EAAAC,EAAA,CACXirF,SAAW1yF,KAASymC,iBAAoB,CAC1C,SAAA9+B,EAAAgC,EAAA,CACG,YAGEqpF,QACG,EAAMv5D,GAAA84D,CAAA,EACVhsE,eACJ,EACUrlB,WAAW,CACrB,EAAAyG,EAAA,eAC+B,CAC7B8qF,CAEJ,CACA,EAEA,GACY,CACHC,GACLzqF,IAAMG,EAAA,CACNsiB,KAAMmoE,eACNxW,MACEwW,yBAEM,KAAMV,GAAAxqF,EAAA8T,GAAA,CAAEiP,+BAAW1hB,KAEnBo/E,UAAoB9zD,QAEtBluB,QAGJ,CACF,YACqB+lF,EACmBzkF,SAEtCgjB,GACA,CAASziB,EAAM,GAAkB/H,GAAQwqB,QAAKhjB,WAC5C,IAAApE,GAAAkE,EAAA,MAAMS,SAAM,CAAAT,EAAA,4BAIN4S,SAAOC,EACPrP,SAAU0I,GAAEyV,GAAW,UACbzV,EAAG0hB,GAHR1hB,WAOXlM,cAAA,GAAMS,KAAM,IAAgBP,gBAC1B,GAAAA,aACEiC,EAAA5H,eAAA,KAAAC,YAAA,QAAAsB,EAAA,gBAAAkE,EAAA,aACS8sB,eAAQnyB,SAKRs3B,KAAcnF,CAAe,gBAAAhpB,MAD1BN,CAEA,YAAC,CAIZ,CAEDsnF,QAAaC,cAEVjvF,EAAA,aAEDoE,YACEpE,EAAA,eAAAvB,CAAA,MAAAuB,EAAA,iBAMuBivF,KAAa,UAAAlxF,EAACkxF,QALfjvF,EAAA,cAAAgI,QAAA,YAIhBknF,EAAAlvF,EAAA,eAAA4uF,EAAaK,WAEP,IAAClxF,EAAA,IAAAA,CAAA,MAAAiC,EAAA,WAAAA,EAAA,aAIZ,KACIilF,GAAAjlF,EAAA,GAEV,EAEE,CAAC+E,EAAK,EAAeJ,MAAM,EAAyB,CAElD,EACG,CACSyB,SACK5B,OACf8c,YAAE,IAAA0pE,GAAA,iBAAA9B,GAA4Br2E,EAAA,OAAC88E,EAAA3E,GAAA,IAAAn4E,EAAA,OAAA88E,EACrC,OAAAA,EAAA,KAGF,aAAAt3D,EAIH,QAAAuM,EAEI,iBAAA9d,EAQE,KAAAnb,EAAW,KAAAwoD,CAAyB,EAAAthD,EAC3BhU,KACOJ,OACZV,kBACA4uF,GAAa,oBAAAiD,GAAAC,EACR17B,IAAArtC,GAAA,QAAAnb,GAAA,mBAAAmkF,GACU1G,GAAfwD,EAAemD,EAAAC,EAAAH,GACDzD,aACde,MAAc,GAAA/D,CAAA,EAAAA,CAGd,CAAW,MAAArvD,GAAc31B,KACtBU,EC3xDrB,SAAwBmrF,IAAc,CACpC,MAAMv1F,EAASyiE,KACT,CAAE1+D,KAAIV,YAAarD,EACzB,OAAO2J,EAAC01B,GAAM,CAACt7B,KAAQV,WAAqB,CAC9C,CCRA,MAAAmyF,GAAe,gECAfxwC,GAAe,6DCAfywC,GAAe,uECAfC,GAAe,uECAfC,GAAe,oxJCiBT,CACJxP,wBAAyBC,GACzBztE,eAAgBC,GAChBkJ,0BAA2BC,GAC3B6zE,yCAA0CC,EAC5C,EAAIh9E,GACEi9E,GAAUl9E,GACZA,GAAQjB,QAAQ,eAAgB,EAAE,EAAEA,QAAQ,MAAO,EAAE,EACrD,KACE/R,GACF,GAAGmwF,2BAAgB5/E,MAAM,EAAG,EAAE,EAAEwB,QAAQ,KAAM,GAAG,CAAC,WAKtD,SAASq+E,IAAU,CACjB,KAAM,CAAErzF,KAAGC,KACX6hE,UAAS,KAAM,CAAC,IAAK,UAAU,CAAC,EAE9Bj7D,EAAA,QAAMzF,GAAG,UAAS2F,UAChBF,EAAA,OAAKS,MAAM,iBAAgBP,UACzBF,EAAA,OAAKS,MAAM,eAAcP,UACvBF,EAAA,MAAAE,UACEC,EAAA,OACEyc,IAAKzI,GACLpT,IAAI,GACJ8J,MAAM,MACNC,OAAO,MACPjJ,MAAO,CACLgb,YAAa,MACbm5C,eAAgB,IAClB,CACD,EACD71D,EAAA,OAAKyc,IAAKuvE,GAAUprF,IAAI,SAAS8J,MAAM,MAAO,CAAC,EAC7C,EACJ1K,EAAA,KAAGM,MAAM,OAAMP,SACbC,EAAAgC,EAAA,CAAA5H,GAAA,SAA6D,EAC5D,EACH4F,EAAA,KAAAD,SACEC,EAAC8T,GAAI,CACH/R,GACE06E,GACI,mBAAmBA,EAAgB,YACnC,SAENn8E,MAAM,SAAQP,SAEG5D,EAAhBsgF,GAAmB,CAAAriF,GAAA,UAAY,CAAAA,GAAA,SAAJ,CAA2B,CACnD,EACL,EACFqiF,IAAoByP,IACnBlsF,EAAA,KAAAD,SACEC,EAAA,KAAGmT,KAAM+4E,GAAmC5rF,MAAM,gBAAeP,SAC/DC,EAAAgC,EAAA,CAAA5H,GAAA,SAAqB,EACpB,EACF,EAEJ,CAACqiF,IACAz8E,EAAA,KAAGM,MAAM,gBAAeP,SACtBC,EAAA,SAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAuJ,WAAA,CAAAC,EAEE5D,EAAA,OAAK,EAAC,CAED,EACF,EACN,CACJ,EACE,GACHmsF,IAAWlwF,KACX+D,EAAA,KAAGM,MAAM,mBAAkBP,SACzBF,EAAA,SAAAE,SAAA,CACGosF,GAAQ,IAAElwF,EAAU,EAChB,EACN,EAEL+D,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAAuJ,WAAA,CAAAC,EACE5D,EAAA,KAAGmT,KAAK,oCAAoC9R,OAAO,SAEhD,EAACwC,EAEJ7D,EAAA,KACEmT,KAAK,mCACL9R,OAAO,SACPlB,QAAUlJ,GAAM,CACdA,EAAEoJ,iBACFzG,EAAOijB,YAAc,yBACvB,EAGC,EAACvY,EAEJtE,EAAA,KAAGmT,KAAMiF,GAAoB/W,OAAO,SAEjC,EAAC,CAEC,EACN,EACHrB,EAAA,OAAAD,SACEC,EAACkU,GAAY,EAAE,EACZ,CAAC,EACH,EACLlU,EAAA,OAAK5F,GAAG,gBAAe2F,SACrBF,EAAA,OAAKS,MAAM,WAAUP,UACnBF,EAAA,WAAAE,UACEC,EAAA,OACEyc,IAAKovE,GACLjrF,IAAGzE,EAAE,CAAA/B,GAAA,SAA+B,EACpC2wB,QAAQ,OACT,EACD/qB,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA6B,EAC3B,EACJ4F,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAGO,EACN,CAAC,EACG,EACTyF,EAAA,WAAAE,UACEC,EAAA,OACEyc,IAAKkgD,GACL/7D,IAAGzE,EAAE,CAAA/B,GAAA,SAAwB,EAC7B2wB,QAAQ,OACT,EACD/qB,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAsB,EACpB,EACJ4F,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAGO,EACN,CAAC,EACG,EACTyF,EAAA,WAAAE,UACEC,EAAA,OACEyc,IAAKsvE,GACLnrF,IAAGzE,EAAE,CAAA/B,GAAA,SAAsC,EAC3C2wB,QAAQ,OACT,EACD/qB,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAoC,EAClC,EACJ4F,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAEO,EACN,CAAC,EACG,EACTyF,EAAA,WAAAE,UACEC,EAAA,OACEyc,IAAK4+B,GACLz6C,IAAGzE,EAAE,CAAA/B,GAAA,SAA+B,EACpC2wB,QAAQ,OACT,EACD/qB,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAoC,EAClC,EACJ4F,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAGO,EACN,CAAC,EACG,EACTyF,EAAA,WAAAE,UACEC,EAAA,OACEyc,IAAKqvE,GACLlrF,IAAGzE,EAAE,CAAA/B,GAAA,SAAuE,EAC5E2wB,QAAQ,OACT,EACD/qB,EAAA,MAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAAoC,EAClC,EACJ4F,EAAA,KAAAD,SACEC,EAAAgC,EAAA,CAAA5H,GAAA,SAA+D,EAC9D,CAAC,EACG,CAAC,EACP,EACF,CAAC,EACF,CAEV,CCvMA,MAAMkyF,GAAcp2F,OAAOqlB,MACtBrlB,OAAOq2F,gBAAer2F,OAAOq2F,cAAgBD,IAElDp2F,OAAOqlB,MAAQ,SAAU9D,EAAS,CAIhCA,aAAA,OAAAA,GAAA,UACAA,EAAWA,EAAA,SAGX,OAAAA,GAAA,WACAA,EAAWA,eAAYA,CAAU,GAEjC,MAAAonC,EAAA2tC,GAAA,CAEA,KAAM3tC,EACJ13B,UAAM1P,QACNlV,QAAS,MACTkqF,SAAS,SACT3hE,SAAU,IACVQ,OAAQ,CACR2X,IACEt6B,EACF,QAAC,KACDxI,EAAO,UAAQ,EAEf,GACF0+C,EAAE,aC+DJ3oD,OAAOw2F,WAAa9yF,EACpB1D,OAAOy2F,iBAAmB,IAAM,CAC9B,MAAMvoF,EAAO,CACX,WACA,WACA,WACA,gBACA,cAAc,EAEVwoF,EAAS,GACfxoF,EAAKgD,QAASrJ,GAAQ,CACpB6uF,EAAO7uF,CAAG,EAAI6a,OAAOxU,KAAKxK,EAAOmE,CAAG,CAAC,EAAEvD,MACzC,CAAC,EACD/B,MAEA,SAAAmE,CAAM,EAAEA,EAAahD,KACrB,0BACkBgD,cAAU,yBAAAmB,CAAA,8BAAAA,CAAA,OAI1B8uF,EAAY,KAAA9uF,CAAA,CAEZ,EAEFtF,YAAQukB,IAAK,CACf,2BAKA8vE,MAEI,SAAAlwF,EACA,cAAAmwF,EAAQnwF,iBAAUmwF,MAAe/yF,IAAc,KAAIJ,CACnD,SAAAF,CACA,EAAAwB,GAAM,YAAExB,WAAawB,QAAI,eACzB,IACE,QAAYm6D,SAAU,uCAAAt3D,CAAA,8BAAAA,CAAA,MAClBivF,EAAAhzF,EAAA,KAAAovC,GAAArrC,IAAAqmD,GAAAhb,EAAA,WAAA1vC,CAAA,GACF,IAAAuzF,GAAc92F,GAAS4I,CAGvB,OAAMiuF,YAAsBhzF,EAG5B,OAAKizF,EAAUD,gBACb,UAAOpzF,OAAmB,CAC1B,MAAOA,IAAuB6mE,CAAA,EAE5B,MADiBssB,EAAe,GAAAG,EAAA,YAC1BA,GACN,OAAMnhC,EAAO3H,cAAU8oC,CAAS9yF,EAChC,KACE,CACA,CAAA+yF,GACF,CAEFA,QACF,CACW,EACf,SACA,WAAIA,IAAW,CACb10F,UAAQmD,KAAKwxF,GACf,sBAGJ,QAAAA,GAAA1sF,CAAA,GAKAnH,GAAWmH,CAAM,gBACI0sF,GAAO1sF,CAAA,YACxBnH,IAAW,WAAM,EAEb6zF,GAAM1sF,CAAI,KAEV0sF,IAEAA,QAAc,IAChB,QACE,YACN,MAAAC,EAAA,8FACKC,EAAA,KAEN,OAAM,WACLp3F,EAWMo3F,EAAgBj4F,GAAAi4F,EAVhBD,GAUgB,EACpBn3F,EAAOm/D,IAAW,CACpB,mBACAk4B,EAAkB,CAClB,EACAF,UAAkBG,GAAM,CACtBt3F,OAAOm/D,iBAAWj/D,EAAAo3F,EAAA,CAClBD,WACF,UACAF,EACEn3F,GAA0C,OACxC+oC,iBAAS,OAAAquD,EAAA,SACTG,EAAS,GAEb,SAAC,8CAAAx2F,GAAA,CACDf,CAAOwC,+BACLumC,EAAS,CAGX9oC,GAGI,QAAOu3F,EACLJ,EAAQ,KACV,MAEFK,GAAA,6CACE1uD,IACF,SACF,yCAYC,yCAKC0uD,GADU,SAAwBp3E,uBAAmB,kCAC9C,OACTpgB,MAASuC,wBACP,IAAIvC,EAGF,GAAAgkB,GAIA,GAFAgmB,EAAIytD,uBAAmB,yDAEjBzzE,GACFgmB,kBACAhmB,EAAOA,IAAA,QAAAgmB,EAAA,4BAAAA,EAAA,2BAETA,EAAQhqC,WACN,GAEF,WAAW,KACTgqC,UAAcA,CACd,KAIAA,MACA5mC,CACE4mC,QAAgBvP,yEAEpB,GAFoBA,EACb,2DAAA0P,CAAA,MACPH,EAAA,CACF,MAAOvP,EAAAuP,EAAA,kBAEejqC,UAAOsb,YAK3B2uB,EAAQhqC,QAAS4I,GACf,GAEF,WAAW,KACTohC,EAAMvP,SACN,KACAuP,CACA5mC,CACE4mC,CAAgBvP,GAEpB,CACF,MACFzW,EAAAxG,GAAA,mBACF,GAACwG,EAAA,CACH,6CAAAA,CAAA,IAEA,2EAAAA,GAAA,cACE,MAAMA,EAAczE,SAAU,cAAO,qCAEjCyE,IAEFhkB,EAASikB,mBACTjkB,UACiBgkB,IAAA,QAAAI,EACds1B,0BAAiC,QAAY,gBAM/B,6DACft1B,QAAYpF,GAAO,CACnBoF,SAIF,EAEA,CAGAC,QAAWpT,GAASqT,MAAM,gBACxBA,GACF,SAAC,mDAAAozE,CAAA,KAEH,CACAvyF,GAAIuyF,EAAUhwC,GAAA,CACZ1nD,SAASikB,OAAsBY,KAAY6iC,EAAA,CAC7C,GAAAtD,EAAA,0CACF,MAAAuzC,EAAA,+BAEUl0F,IACRk0F,EAAW,QAACzpF,kBAAqBy5C,aAAuB,OAAAxjD,EAAA,GAGpD,CACAigD,EAAIuzC,KAAM,6BACH1C,SAAQvtF,KACf,yBAAAvD,CAAA,CAIF,CACE,GACAyzF,SAAuB,QAAc,OACvC,+BACF,aACD,MAAA54E,EAAA,CAMG,EAEA,IAAAA,EAAI64E,CASF,CACAC,EAemD,SACrD,uCAAAt6E,GAAA,uCAEJ,MAAAu6E,GAAA,0FAEAC,GAAA,SAGEh4F,aAASmL,CAIX,MAAAvI,EAAAq1F,CAAA,EAAAh1F,EAAA,IAGM80F,IACG18E,EAAWpY,EAAA,WAEpB,YAAM+0F,kBAEN,YAASE,MAAM,qBACb,YAAOt1F,oBAAyB,EAChC,YAAOioB,MAAS1D,sBAChB41C,KACAA,OACAA,QAAkBv/C,GAAA,MAAc,mBAChCu/C,sBAAkB,OAAoB,kDACtC9+C,KAAU,CAGR,GADc,qCACR/F,CACN,GAAM0C,CAIFA,OAAM,oBACRtY,KAAY,iBAAEsY,QAAM,wBAEpB,WAAMu9E,IAAUp4F,CAEZo4F,OAAS,OACX,EAAI,IACFp4F,OACE,OACEgK,MAAM,EACN6Q,MAIJxX,CACErD,eAAO+lF,aAAM,uDAEjB,UAAShlF,EACPwB,cAAQ6Y,EACRpb,WAAa,EACfwnF,GAAArvE,CAAA,MACAuJ,EAAA22E,GAAAlgF,CAAA,GAAAmgF,EACF/hF,EAAAkH,GAAA,mCAGAzd,SAAOiwD,CAMP7oC,EAAM,WACJjN,MACAS,aAAe4C,GACf86E,UACE9Q,cACJ,UAAM9lE,EACN,cAAiBjE,EAEhB,KAAA5C,EACCuM,cAAW7Q,GAAS,MACpB,GAAM,GAAEgiF,EAAcl8E,CAAY,QAAUm8E,GAAe,CACzDrgF,WACAgC,aAAWs+E,CACX79E,EACAC,sDACAC,KACD,uCAEDo9E,EAAI77E,EAAa,EACf+K,WAAesxE,CAAW,MAAYvgF,EAAakE,SACnD,gBAAcs8E,WAKdC,IACA54F,MAEAk4F,oCAAkB,GAClB9wE,QAAW,oBAAS,gEACtBnL,EAaA1Z,GAZE6kB,IACFnL,EAAA48E,GAAAC,CAAA,EACA97B,IACClgD,GAAAb,EAAA,SACL,OAAO,wEAKDA,IACJA,EAAI68E,GAAe,GAEjBv2F,EAAQma,CACRI,GAAab,EAAA,SACXa,MACA9c,QAIA,EACFgF,GAAA,CACF,QAAAiX,CACA,GACEA,CACF,SAAAzY,CACA,EAAIyY,EACFa,KACAsK,EAAM,qBAAEutD,IAAW3vE,CAAMiX,aAAS88E,GAAApkB,CAAA,EAC5BqkB,GAAArkB,EAAAnxE,CAAA,GAAemxE,yCAGrBvtD,MAAW,CACV,SACC8wE,EAAI,IACF9wE,EAAI6xE,SAAe,EAEjBF,0BAAsB,CACtBC,CAA6B,IAE7B,MAGC5xE,EACH,uBACOrmB,IAAG,WAEVm3F,CACA9wE,iBAAW,cAAS,EACpB41C,iBAAYhpD,IAAI,cAAU,EAAAyJ,GAC5B,uCACC,IACLy7E,EAAO1vE,GAAA,EACLpC,kBAAW8xE,EAAS,SACpBl8B,MAAgBk8B,EAAUr2F,CAAA,SAC5Bs2F,EAAAl3F,EAAA,IACFm3F,EAAA,cA+CUp5F,OA5CVyd,EAAM47E,KACN57E,EAAM47E,SACN57E,IAAM47E,IACHC,GAAAJ,EAAA,mBAEU1vE,KAAY,EAM3BtnB,GAAUumB,cAAYtP,EAAUtW,CAG1Bs2F,gBAA0BD,EAAA,OAC1BE,aAAc,UACpBl3F,GAII,GAAAg3F,EAAII,SAAWngF,EAASI,OAAW1W,CAAA,GACjC4a,MAAM+B,CAE2B,GADnC,EAAA25E,EAAO,SAC4B,KAAbC,UAAaF,EAAA,kBACIplE,IACnCylE,GAAmBzzF,IAAI,iBACxB0zF,EAAA/7E,GAAA,cAAA27E,CAAA,EACHI,GACF,gBACErgF,SAGY,YAAAqgF,EAAA,iBACWvB,KACnBqB,gBAAcngF,KAASI,QAG3BkE,GAAM+7E,UAAW/7E,CAAYg8E,CAC7B,EAAID,KAEAL,UAAc90C,EACZ,CAEA,GAAAv5B,EAAAjoB,IACE7C,iBAAOmZ,UAAgBqgF,EAASn1C,EAClC+gC,GAAA,IAEF3nE,IAAM+B,UACL1V,EAAG8jB,GAAA,CACR,gBACAurE,GAEAruE,EAASjoB,EAAW,CAExB,SAAI,CAAAiH,EAAYgE,GAAcyL,CAC5B,WAAA1W,CAAmB,CACrB,EAAAiH,EAAA4vF,GAAA,CAEI5uE,YACF,GAAAhhB,KAAQ8jB,CAAO1pB,SAAG4F,EAAA6vF,GAAA,CAAe,yBACnC,QAAA7vF,EAAA4rF,GAAA,GAEA,EACE,CAAA7rF,KACG+vF,KAAa,IAAA/2F,GAAAiH,EAAAwpD,GAAA,IAAAxpD,EAAA+9C,GAAA,IAAAhlD,GAAAiH,EAAAylD,GAAA,IAAAzlD,EAAAnH,GAAA,CAACE,aAAyB,EACxCiH,GAAC4vF,KAAe,IAAA5vF,EAAAipD,GAAA,CAAClwD,WAAyB,EAC1CiH,EAAC+vF,GAAM,MACC,CAAM,SAAoBnkF,IAAuB,WAAA7S,CAAI,GAM3C,OAACA,GAAuB,YACzCA,0BAEDiH,EAAC8D,SAAwB9D,EAAAqsF,GAAA,IAG/B,SAAAmD,GAAA//E,EAAA,CAEA,MAASugF,wCAAK,KAAAvgF,CAAA,EAAa,MAAGqgF,GAAAh3F,GAAA,EAC5B,WAAAC,CACEm6D,KACF,MAAAk8B,EAAA1vE,GAAA,EACAuwE,KAAyB,IAAMjwF,CACjC,MAEA,SAAAyP,CACE,EAAA2/E,EACF,OAAAI,GAAA//E,CAAA,CAEA,GAAMqgF,IAAwB/2F,aAAW,SAAMk3F,GAAAb,EAC7C,YAAiB1vE,IACjB,KAAMuwE,IACJ,QAAMjwF,EAAAgwF,GAAA,CAAEvgF,aAAS,CACjB,GAAAzP,MACEqP,cAEJ,QACG0gF,KAAM,WAAWE,CAA4BlwF,gBACrCw6C,QAAKv6C,EAAAqsF,GAAA,MAAIzgF,MAQC,CAAkB,EAAI,GAAkB,SAAAskF,IAC9CC,CAAS,OACFv2F,EAAA,mBAGR,SAAC2gD,GAAK,YAAAxhD,CAAkC,GAAK,MAEtDq2F,EAAA1vE,GAAA,EACK0wE,EAAAj4F,EAAA+3F,IAAA,EAMZ,OAJC57E,GAAA,IAEQ47E,sBAAkBd,EAAA,WAAA3N,GAAA,SAAA2N,EAAA,UACzB,CAAAA,EAActwC,WAAgB,GAEvB8wC,EAAgB,UAAAQ,EAAA,QAAAF,GAAA,GAAgBE,EAAA,aAIjCA,MAEN,SAAMC,EAAsB,SAAMjB,EAChC,SACE3N,QAA8BpyE,CAG9BA,SAASI,OACT4gF,sBACE,QAACD,KACHA,GAA6C,CACjD,EAAOpwF,EAAA6vF,GAAA,CACLO,iBACF,QAAApwF,EAAAowE,GAAA,GACA33E,GAAQw6D,KAAM,mBAEZ5jD,iBACD,EAAArP,EAAA6vF,GAAA,CAED,UACUxgF,aAA6BhX,GAAWgX,CAAStP,IACtDhH,IACCgH,UACSw6C,QAAKv6C,EAAA2nE,GAAA,MAAiB/7D,KAAUgmE,CAAmB,KAC1D5xE,KAAOu6C,SAAK,CAAAv6C,EAAA6vF,GAAA,CAAYjkF,MAAS5L,GACjCA,QAAC6vF,EAAKpU,GAAA,IAAClhC,IAAKs1C,GAAA,CAAajkF,WACzB5L,QAAC6vF,EAAKxiB,GAAA,IAAC9yB,EAAK,GAAK3uC,KAAU4wD,CAAe,KAC1Cx8D,MAAOu6C,QAAKv6C,EAAA2qE,GAAA,MAAK/+D,KAAU+7D,CAAgB,KAC3C9nE,MAAO06C,QAAKv6C,EAAAs+E,GAAA,MAAIv+E,KACdC,CAAM,KAACugB,MAAK,QAAC3U,EAAS5L,GAAM,EAAE,IAAIA,EAClCA,GAAC6vF,CAAK,KAACt1C,WAAK,QAAM3uC,EAAS5L,GAAK,EAAE,IAAKA,EAAA6vF,GAAA,CAClC,KACP7vF,uBAAOu6C,QAAKv6C,EAAAi8D,GAAA,KAAMrwD,CAA4B,GAAI5L,EAClDA,GAAC6vF,CAAK,KAACt1C,yBAAK,QAAM3uC,EAAS5L,GAACs+E,GAAgB,GAAIt+E,EAChDA,GAAC6vF,CAAK,KAACt1C,oBAAK,QAAM3uC,EAAS5L,GAAU,MAAIH,EACzCG,GAAC6vF,CAAK,KAACt1C,gBAAK,SAAW3uC,CAAS5L,EAAC49D,IAAa,MAC7CiyB,GAAMt1C,QAAKv6C,EAAAy2E,GAAA,MAAuB7qE,KAAUqwD,CAAmB,SAGpEj8D,QAAC6vF,EAAKpZ,GAAA,CAACl8B,MAAK,GAAyB3uC,CAAmB,CAAI,CAC5D5L,CAAM,GAACu6C,EAAKs1C,GAAA,CAAoBjkF,4BAA+B,QAC9DikF,KAAK,MAACt1C,EAAKs1C,GAAA,CAAe9vF,0BACnB,QAAMC,EAAAq3E,GAAA,MAAmB,EACzB,CCxqBdiZ,KACAC,KAMAx4B,GACE/3D,EAACwwF,GAAY,CAACr8E,QAAWpU,SACvBC,EAACywF,GAAU,CAAA1wF,SACTC,EAAC0wF,GAAkB,CAAA3wF,SACjBC,EAACquF,GAAG,EAAE,EACY,EACV,CAAC,CACD,EACdl4F,SAAS2oB,eAAe,KAAK,CAC/B,EAGAvlB,WAAW,IAAM,CACf,GAAI,CAEFo3F,aAAaC,WAAW,oCAAoC,CAC9D,MAAY,CAAC,CACf,EAAG,GAAI,EAGP,GAAI,kBAAmBr6E,WAAa,OAAOs6E,OAAW,IAAa,CAEjE,MAAMC,EAAoB,CAAC,OAAO,EAClC,IAAIC,EAAe,GACnB,MAAMC,EAAgB,IAChBC,EAAgB,KAAU,IAChC,eAAeC,GAAc,CAC3B,GAAIh7F,OAAOm/D,SACT,GAAI,CACF,MAAMjxD,EAAO,MAAMysF,OAAOzsF,OAC1B,UAAWrG,KAAOqG,EAAM,CACtB,GAAI0sF,EAAkBniF,SAAS5Q,CAAG,EAAG,SACrC,MAAMozF,EAAQ,MAAMN,OAAO9tE,KAAKhlB,CAAG,EAC7BqzF,EAAQ,MAAMD,EAAM/sF,OAC1B,GAAIgtF,EAAM52F,OAAS62F,GAAmB,CACpC54F,QAAa24F,EAAA,MAAkBrzF,EAAiB,EAChD,UAAMuzF,KAAaF,EACnB,MAAAD,UAAwBG,CACM,CAC9B,CAEJP,EAAA,EACAA,OACF,CACF,WAAAG,EAAAH,EAAAE,EAAAD,CAAA,CAEAz3F,CACF,WAAA23F,EAAAF,CAAA,CACAz3F,CACF,sBAEArD,wBAAyB,eACvBC","names":["functionDebounce","debounce","fn","wait","callFirst","timeout","debouncedFn","clear","flush","call","debounceWrapper","context","args","callNow","window","document","event","params","evt","handleTouchStart","handleTouchMove","handleTouchEnd","xDown","yDown","xDiff","yDiff","timeDown","startEl","touchCount","e","swipeThreshold","getNearestAttribute","swipeUnit","swipeTimeout","timeDiff","eventType","changedTouches","eventData","xUp","yUp","el","attributeName","defaultValue","attributeValue","usePageVisibility","deps","savedCallback","useRef","useEffect","current","handleVisibilityChange","hidden","visibilityState","console","addEventListener","STREAMING_TIMEOUT","POLL_INTERVAL","BackgroundService","memo","isLoggedIn","t","_useLingui","visible","setVisible","useState","visibleTimeout","clearTimeout","setTimeout","checkLatestNotification","masto","instance","skipCheckMarkers","states","notificationsLast","notificationsIterator","v1","notifications","list","limit","sinceId","id","values","value","next","length","notificationsShowNew","lastReadId","markers","fetch","timeline","sub","streamTimeout","pollNotifications","streaming","api","hasStreaming","user","notification","subscribe","entry","skipThreading","unsubscribe","clearInterval","r","info","useInterval","checkForUpdates","lastCheckDate","now","appVersion","currentCloakMode","_t","useHotkeys","showToast","fetchLatestPostsMemoized","pmem","currentAccountID","statusesIterator","accounts","$select","statuses","exclude_replies","exclude_reblogs","maxAge","ComposeButton","snapStates","useSnapshot","menuOpen","setMenuOpen","latestPosts","setLatestPosts","loadingPosts","setLoadingPosts","buttonRef","menuRef","columnMode","settings","shortcutsViewMode","handleButton","key","toLowerCase","composerState","minimized","openOSK","composeDataElements","querySelectorAll","opts","JSON","parse","undefined","shiftKey","openCompose","showCompose","useKey","ignoreEventWhen","querySelector","metaKey","ctrlKey","altKey","bindLongPress","useLongPress","threshold","fetchLatestPosts","useCallback","getCurrentAccountID","posts","handleReplyToPost","post","replyToStatus","_jsxs","_Fragment","children","_jsx","ref","type","onClick","onContextMenu","preventDefault","class","publishing","publishingError","Icon","icon","size","alt","ControlledMenu","state","anchorRef","onClose","direction","gap","unmountOnClose","portal","target","body","boundingBoxPadding","safeBoundingBoxPadding","containerProps","style","zIndex","closeMenu","submenuOpenDelay","MenuLink","to","_Trans","MenuDivider","SubMenu2","align","shift","disabled","label","className","map","createdDate","Date","createdAt","isWithinDay","getTime","MenuItem","statusPeek","RelativeTime","datetime","format","dateTime","toISOString","title","toLocaleString","niceDateTime","SequentialKeys","key1","key2","components","0","1","KeyboardShortcutsHelp","showKeyboardShortcutsHelp","test","hash","Modal","tabindex","keys","action","2","parents","coords","siblings","animations","intersections","mutationObservers","intervals","options","debounces","enabled","root","scrollX","scrollY","TGT","DEL","NEW","handleMutations","mutations","elements","getElements","animate","handleResizes","entries","updateAllPos","updatePos","isOffscreen","rect","vw","vh","observePosition","oldObserver","invocations","buffer","getCoords","offsetWidth","offsetHeight","rootMargin","px","observer","optionsOrPlugin","getOptions","delay","isPlugin","currentAnimation","parent","forEach","lowPriority","poll","callback","resize","supportedBrowser","nodes","mutation","node","i","child","_a","_b","isMounted","preExisting","add","remain","remove","raw","str","getScrollOffset","p","x","y","getTransitionSizes","oldCoords","newCoords","widthFrom","heightFrom","widthTo","heightTo","styles","paddingY","paddingX","getTarget","isEnabled","callbacks","getPluginTuple","pluginReturn","config","animation","pluginOrOptions","deltaLeft","deltaTop","deltaRight","start","end","keyframes","cleanUp","prev","finalX","finalY","top","left","width","height","deletePosition","adjustScroll","styleReset","scrollDeltaX","scrollDeltaY","scrollBefore","lastHeight","lastWidth","startScroll","smoothScroll","deltaY","deltaX","offsetParent","parentStyles","parentCoords","autoAnimate","element","mo","d","a","io","useAutoAnimate","controller","setController","setEnabled","dec2hex","dec","toString","slice","verifier","array","Uint32Array","crypto","getRandomValues","Array","from","join","sha256","plain","data","TextEncoder","encode","subtle","digest","base64urlencode","bytes","Uint8Array","len","byteLength","String","fromCharCode","btoa","replace","generateCodeChallenge","v","hashed","supportsPKCE","instanceURL","res","ok","status","json","code_challenge_methods_supported","includes","__generateCodeChallenge","DEV","PHANPY_CLIENT_NAME","CLIENT_NAME","PHANPY_WEBSITE","WEBSITE","import","SCOPES","sameSite","location","hostname","currentLocation","origin","pathname","REDIRECT_URI","registerApplication","registrationParams","URLSearchParams","client_name","redirect_uris","scopes","website","method","headers","getPKCEAuthorizationURL","client_id","forceLogin","codeVerifier","code_challenge_method","code_challenge","codeChallenge","response_type","authorizationParams","scope","client_secret","code","code_verifier","append","tokenResponse","revokeAccessToken","token","revokeResponse","error","isStandalone","matchMedia","matches","Accounts","getAccounts","currentAccount","moreThanOneAccount","_","reload","useReducer","accountsListParent","tabIndex","account","isCurrent","isDefault","isLoggedOut","accessToken","Avatar","url","avatarStatic","onDblClick","log","saveAccounts","NameText","showAcct","setCurrentAccountID","Menu2","menuButton","href","splice","MenuConfirm","subMenu","confirmLabel","menuItemClassName","clientId","clientSecret","store","session","get","Link","showImportExportAccounts","logo","regionMaps","LangSelector","i18n","useLingui","populatedLocales","useMemo","LOCALES","lang","regionlessCode","native","localeCode2Text","locale","fallback","CATALOGS","find","c","nativeName","_common","name","sort","b","order","localeCompare","DEFAULT_LANG","onChange","local","set","activateLang","common","createBackendPushSubscription","subscription","push","create","fetchBackendPushSubscription","updateBackendPushSubscription","update","removeBackendPushSubscription","isPushSupported","navigator","getRegistration","serviceWorker","getSubscription","registration","pushManager","urlBase64ToUint8Array","base64String","padding","repeat","base64","rawData","atob","outputArray","charCodeAt","initSubscription","backendSubscription","err","message","sameEndpoint","sameKey","vapidKey","applicationServerKey","vapidKeyStr","applicationServerKeyStr","policy","DEFAULT_TEXT_SIZE","TEXT_SIZES","PHANPY_PRIVACY_POLICY_URL","PRIVACY_POLICY_URL","PHANPY_TRANSLANG_INSTANCES","TRANSLANG_INSTANCES","PHANPY_IMG_ALT_API_URL","IMG_ALT_API_URL","PHANPY_GIPHY_API_KEY","GIPHY_API_KEY","targetLanguages","Object","languages","tl","TRANSLATION_API_NAME","Settings","currentTheme","themeFormRef","targetLanguage","contentTranslationTargetLanguage","systemTargetLanguage","getTranslateTargetLanguage","systemTargetLanguageText","currentTextSize","prefs","setPrefs","getPreferences","authenticated","expTabBarV2","setExpTabBarV2","disableQuotePolicy","onInput","formData","FormData","theme","documentElement","html","classList","$manualMeta","$autoMetas","m","toggle","defaultChecked","min","max","step","parseInt","setProperty","rel","for","source","newPrefs","setPreferences","supportsNativeQuote","alert","checked","autoRefresh","boostsCarousel","contentTranslation","showCommon","contentTranslationHideLanguages","contentTranslationAutoInline","composerGIFPicker","mediaAltGenerator","shortcutSettingsCloudImportExport","cloakMode","showDrafts","PushNotificationsSection","display","flexWrap","alignItems","marginTop","src","aspectRatio","background","borderRadius","showAccount","readOnly","select","warn","_t2","pushFormRef","setNeedRelogin","previousPolicyRef","allowNotifications","setUIState","needRelogin","alerts","setAllowNotifications","alert2","policyEl","fromEntries","mention","favourite","reblog","follow","followRequest","alertsCount","policyChanged","allowNotifications2","updateSubscription","removeSubscription","catch","isLoading","permission","Notification","focusDeck","timer","columns","getElementById","focusedColumn","focus","firstVisibleColumn","column","getBoundingClientRect","modals","modal","modalFocusElement","pages","page","useLocationChange","useLocation","currentLocationRef","AccountHandleInfo","acct","username","server","split","encodedAcct","punycode","toASCII","SUPPORTED_IMAGE_FORMATS","SUPPORTED_IMAGE_FORMATS_STR","FieldsAttributesRow","index","hasValue","setHasValue","maxLength","required","dir","enterKeyHint","currentTarget","EditProfileSheet","uiState","setAccount","headerPreview","setHeaderPreview","avatarPreview","setAvatarPreview","acc","verifyCredentials","displayName","avatar","header","note","fields","fieldsAttributesRef","avatarMediaAttachments","headerMediaAttachments","abrupt","fieldsAttributesFields","field","fieldsAttributes","newAccount","header2","file","accept","blob","mediaAttachments","mediaIndex","Math","ENDORSEMENTS_LIMIT","Endorsements","accountID","open","onlyOpenIfHasEndorsements","endorsementsContainer","endorsementsUIState","setEndorsementsUIState","endorsements","setEndorsements","relationshipsMap","setRelationshipsMap","supports","behavior","block","fetchRelationships","relationships","reallyOpen","Loader","AccountBlock","avatarSize","relationship","FETCH_MAX_AGE","MAX_AGE","fetchLists","lists","updatedAt","getLists","fetchList","getList","theList","getListTitle","addListStore","updateListStore","deleteListStore","listID","findIndex","ListExclusiveBadge","insignificant","ListAddEdit","editMode","nameFieldRef","repliesPolicyFieldRef","exclusiveFieldRef","repliesPolicy","exclusive","supportsExclusive","onSubmit","listResult","replies_policy","AddRemoveListsSheet","setLists","listsContainingAccount","setListsContainingAccount","reloadCount","listsContainingAccount2","setShowListAddEditModal","showListAddEditModal","inList","l","accountIds","PrivateNoteSheet","initialNote","onRelationshipChange","textareaRef","trim","newRelationship","comment","TranslatedBioSheet","fieldsText","getHTMLText","text","whiteSpace","TranslationBlock","forceTranslate","MUTE_DURATIONS","MUTE_DURATIONS_LABELS","i18nDuration","RelatedActions","standalone","setShowEditProfile","showEndorsements","renderEndorsements","setRenderEndorsements","currentMasto","currentInstance","currentAuthenticated","sameInstance","relationshipUIState","setRelationshipUIState","setRelationship","locked","lastStatusAt","moved","following","showingReblogs","notifying","followedBy","blocking","blockedBy","muting","mutingNotifications","requested","domainBlocking","endorsed","privateNote","currentInfo","setCurrentInfo","isSelf","setIsSelf","acctWithInstance","supportsEndorsements","currentID","acctHasInstance","results","v2","search","q","resolve","updateAccount","setShowTranslatedBio","setShowAddRemoveLists","showPrivateNoteModal","setShowPrivateNoteModal","headerStatic","hideTime","showQrCodeModal","backgroundMask","caption","onScannerClick","position","loading","overflow","lists2","onMenuChange","draftStatus","handle","openTrigger","duration","textOverflow","reloadGenericAccounts","counter","confirm","showReportModal","showTranslatedBio","showAddRemoveLists","relationship2","urlObj","host","LIMIT","ACCOUNT_INFO_MAX_AGE","fetchFamiliarFollowers","familiarFollowers","memFetchFamiliarFollowers","fetchPostingStats","fetchStatuses","stats","total","originals","replies","boosts","memFetchPostingStats","isValidUrl","string","handleScannerClick","actionableText","hideAllModals","AccountInfo","fetchAccount","isString","setInfo","sameCurrentInstance","info2","bot","emojis","group","statusesCount","memorial","roles","hideCollections","headerIsAvatar","infoHasEssentials","account2","updated","headerCornerColors","setHeaderCornerColors","followersIterator","accountInstance","firstLoad","familiarFollowersCache","newValue","familiarFollowers2","familiar","followingIterator","LinkOrDiv","accountLink","postingStats","setPostingStats","renderFamiliarFollowers","setFamiliarFollowers","postingStatsUIState","setPostingStatsUIState","followers","renderPostingStats","onProfileUpdate","isStringURL","skeleton","stopPropagation","onError","ctx","canvas","crossOrigin","onLoad","pixelDimension","rgbColors","OffscreenCanvas","createElement","willReadFrequently","imageSmoothingEnabled","drawImage","colors","g","dataLength","lightenRGB","color","handleWithInstance","arena","showMediaModal","internal","handleContentLinks","dangerouslySetInnerHTML","verifiedAt","__html","EmojiText","fetchFollowers","showGenericAccounts","heading","fetchAccounts","excludeRelationshipAttrs","blankCopy","follower","followersCount","shortenNumber","fetchFollowing","followingCount","hasPostingStats","3","_i18n","daysSinceLastPost","luminence","alpha","AccountSheet","propInstance","lookup","skip_webfinger","result","accountWithSameString","startsWith","accountURL","URL","Drafts","drafts","setDrafts","db","ns","getCurrentAccountNS","ownKeys","filter","getMany","hasDrafts","draft","replyTo","quote","updatedAtDate","quoteStatus","MiniDraft","spoilerText","hasPoll","hasMedia","hasQuote","hasPollOrMedia","firstImageMedia","image","objectURL","createObjectURL","EmbedModal","GenericAccounts","postID","isCurrentInstance","showMore","setShowMore","staticAccounts","showReactions","setAccounts","loadRelationships","loadAccounts","done","isArray","theAccount","j","_types","newAccounts","Status","showStats","InView","ImportAccountsSelection","importedAccounts","existingAccounts","accountsToImport","statusOrder","duplicate","new","__status","selectedAccounts","setSelectedAccounts","initialSelection","handleImportSelection","showAccounts","selectedCount","Boolean","every","newSelection","shouldSelect","isSelected","ImportExportAccounts","setImportedAccounts","dragOver","setDragOver","handleExport","exportData","rest","stringify","Blob","date","getFullYear","getMonth","padStart","getDate","getHours","getMinutes","download","click","revokeObjectURL","processFile","handleImport","onDragOver","onDragLeave","onDrop","FORCE_TRANSLATE_LIMIT","MediaAltModal","setForceTranslate","differentLanguage","localeMatch","isShortAlt","supportsTTS","speak","textWrap","sourceLanguage","classToType","obj","unpack","keyOrder","k","PI","TWOPI","PITHIRD","DEG2RAD","RAD2DEG","multiplyMatrices","A","B","B_cols","product","row","col","labConstants","compand","linear","sign","xyz2rgb","z","MtxAdaptMa","MtxAdaptMaI","MtxXYZ2RGB","RefWhiteRGB","Xn","Yn","Zn","LAB_CONSTANTS","As","Bs","Cs","Ad","Bd","Cd","X1","Y1","Z1","X2","Y2","Z2","oklab2rgb","L","X","Y","Z","OKLab_to_XYZ","b_","OKLab","LMStoXYZ","OKLabtoLMS","LMSnl","gammaAdjustSRGB","companded","rgb2xyz","MtxRGB2XYZ","rgb2oklab","xyz","XYZ_to_OKLab","XYZ","XYZtoLMS","LMStoOKLab","LMS","sin","cos","lch2lab","h","oklch2rgb","sqrt","atan2","round","lab2lch","rgb2oklch","MediaModal","statusID","carouselRef","currentIndex","setCurrentIndex","carouselFocusItem","useLayoutEffect","scrollIntoView","prevStatusID","scrollLeft","clientWidth","differentStatusID","scrollTo","isRTL","showControls","setShowControls","handleSwipe","removeEventListener","handleScroll","abs","passive","mediaOkColors","media","blurhash","averageColor","getBlurHashAverageColor","mediaAccentColors","okColor","light","dark","default","mediaAccentGradients","range","lightGradient","darkGradient","toastRef","hideToast","currentColor","$meta","metaColor","mediaColor","colorScheme","content","contains","backgroundAttachment","accentColor","showMediaAlt","description","showOriginal","menuClassName","OpenLinkSheet","linkText","displayUrl","protocol","handleCopy","clipboard","writeText","handleShare","chCodes","assertNumber","validateVersion","ver","bin","pad","mod","fillArr","val","interleaveBytes","blocks","includesAt","lst","pattern","best","bestScore","score","alphabet","char","input","letter","digits","Bitmap","s","lines","line","offset","yPos","xPos","cur","border","bm","factor","out","first","second","cc","reset","whiteBG","darkBG","optimize","pathData","prevPoint","point","relM","bH","u16le","dims","N","fullChunks","isRGB","ECMode","Encoding","BYTES","WORDS_PER_BLOCK","ECC_BLOCKS","last","distance","count","interval","ecc","maskIdx","words","numBlocks","blockLen","shortBlocks","PATTERNS","_x","_y","GF","p_poly","exp","poly","degree","coefficient","coefficients","scalar","smaller","larger","sumDiff","lengthDiff","divisor","elm","R","rLast","tLast","rLastLast","tLastLast","dltInverse","degreeDiff","scale","sigmaTildeAtZero","inverse","RS","eccWords","pol","syndrome","hasError","evl","monomial","errorLocator","errorEvaluator","locations","pos","xiInverse","denominator","interleave","rs","eccBlocks","isShort","resBlocks","resECC","drawTemplate","finder","alignPos","bits","getBit","bit","zigzag","tpl","xOffset","detectType","utf8ToBytes","encoded","dataLen","n","utf8","capacity","idx","drawQR","need","mask","penalty","sameColor","same","adjacent","box","lastW","lastH","x1","y1","finderPattern","lightPattern","p1","p2","darkPixels","_c","darkPercent","drawQRBest","bestMask","validateECC","ec","validateEncoding","enc","validateMask","encodeQR","output","encoding","utils","getContext","QrCode","arenaCircle","captionRef","captionHeight","setCaptionHeight","arenaLoaded","setArenaLoaded","arenaHasAlpha","setArenaHasAlpha","effectiveArenaCircle","img","Image","onload","getImageData","totalPixels","lowAlphaCount","hasAlpha","onerror","qrData","gridSize","centerExcludeSize","centerStart","centerEnd","isFilled","centerX","centerY","radius","dx","isFilledInGrid","isInPositionMarker","cx","cy","hasTop","hasRight","hasBottom","hasLeft","markerOuterRadius","markerInnerRadius","centerImagePadding","centerImageSize","centerImageX","centerImageY","captionSpacing","viewBoxWidth","viewBoxHeight","viewBox","xmlns","fill","stroke","rx","ry","in","stdDeviation","slope","intercept","markerPositions","bleed","preserveAspectRatio","opacity","mediaDevicesSupported","mediaDevices","getUserMedia","QrCodeModal","hasBarcodeDetector","__vitePreload","QRCamera","constructor","stream","player","setStream","setAttribute","srcObject","listDevices","enumerateDevices","Error","device","kind","deviceId","setDevice","stop","video","exact","readFrame","fullSize","videoHeight","videoWidth","getSize","track","getTracks","createQRCamera","permissions","query","ideal","facingMode","checkValidity","containerRef","videoRef","setIsScanning","overlayRef","decodedText","setDecodedText","handleScreenOrientationChange","screenOrientation","screen","orientation","cam","qrCanvas","detector","cancelMainLoop","qrDom","BarcodeDetector","formats","QRCanvas","cropToSquare","overlayMainColor","overlayFinderColor","animationId","mainLoop","rafLoop","isScanning","startCamera","showActionableButton","playsInline","muted","disablepictureinpicture","CATEGORIES","CATEGORIES_INFO","spam","legal","violation","stampLabel","other","excludeStamp","findMatchingLanguage","rule","currentLang","translations","availableLanguages","matchedLang","normalizedLanguages","part","region","charAt","toUpperCase","translateRules","rules","_translatedText","ReportModal","domain","translatedRules","currentDomain","getCurrentInstance","selectedCategory","setSelectedCategory","showRules","setShowRules","rulesRef","hasRules","setHasRules","previewMode","useAvatarStatic","showActivity","category","forward","ruleIds","reports","accountId","statusIds","Fragment","maxlength","rows","switch","LZString","f","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","character","compressed","uncompressed","buf","TotalLen","current_value","bitsPerChar","getCharFromInt","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","ii","resetValue","getNextValue","dictionary","enlargeIn","dictSize","numBits","w","resb","maxpower","power","module","floatingButtonUrl","multiColumnUrl$1","tabMenuBarUrl","MAX_FETCH","fetchFollowedTags","iterator","followedTags","tags","fetchCount","getFollowedTags","fauxDiv","extractTagsFromStatus","hashtagLinks","AsyncText","setText","Promise","then","SHORTCUTS_LIMIT","TYPES","TYPE_TEXT","public","bookmarks","favourites","hashtag","trending","mentions","TYPE_PARAMS","notRequired","placeholder","fetchAccountTitle","SHORTCUTS_META","path","excludeViewMode","subtitle","encodeURIComponent","ShortcutsSettings","shortcuts","showForm","setShowForm","showImportExport","setShowImportExport","shortcutsListParent","fontSize","textTransform","imgURL","multiColumnUrl","shortcut","excludedViewMode","shortcutsArr","temp","shortcutIndex","justifyContent","ShortcutForm","mode","ImportExport","FORM_NOTES","currentType","setCurrentType","followedHashtags","setFollowedHashtags","form","formRef","autocorrect","autocapitalize","tag","spellCheck","shortcutsStr","compressToEncodedURIComponent","setImportShortcutStr","parsedImportShortcutStr","setImportUIState","importShortcutStr","parsed","decompressFromEncodedURIComponent","hasCurrentSettings","shortcutsImportFieldRef","importUIState","dt","match","some","nonUniqueShortcuts","exceededLimit","newShortcuts","newNote","settingsJSON","changes","prevValue","Modals","navigate","useNavigate","preload","ComposeSuspense","__COMPOSE__","replyMode","editStatus","newStatus","scheduledAt","reloadStatusPage","reloadScheduledPosts","reply","edit","toast","prevLocation","showSettings","destination","showOpenLink","showShortcutsSettings","showEmbedModal","showQrScannerModal","QrScannerModal","exportDisabled","NavigationCommand","hotkeyOptions","FollowRequestButtons","requestState","setRequestState","hasRelationship","followRequests","authorize","NOTIFICATION_ICONS","follow_request","severed_relationships","moderation_warning","emoji_reaction","annual_report","quoted_update","emojiText","emoji","emoji_url","staticUrl","emojiObject","CustomEmoji","contentText","postsCount","postType","Subject","clickable","poll-self","poll-voted","favourite+reblog","admin.sign_up","admin.report","targetAccount","year","SEVERED_RELATIONSHIPS_TEXT","account_suspension","targetName","domain_block","user_domain_block","MODERATION_WARNING_TEXT","none","disable","mark_statuses_as_sensitive","delete_statuses","sensitive","silence","suspend","AVATARS_LIMIT","isStatic","disableContextMenu","report","annualReport","_ids","_accounts","_statuses","_groupKeys","sampleAccounts","notificationsCount","groupKey","_notificationsCount","_sampleAccountsCount","actualStatus","actualStatusID","isVoted","voted","isReplyToOthers","inReplyToAccountId","favsCount","reblogsCount","props","handleOpenGenericAccounts","diffCount","expandAccounts","showAvatar","emojiURL","shortcode","formattedCreatedAt","genericAccountsHeading","statusKey","filtered","isOwnPost","filterInfo","isFiltered","type2","gKey","keyAccounts","keyAccount","_accounts2","status2","allowContextMenu","TruncatedLink","dispatchEvent","clientX","clientY","allowFilters","useTruncated","Notification$2","oldProps","newProps","NotificationService","routeNotification","showNotificationSheet","notificationAccount","hasModal","hasStatus","clearAppBadge","id2","setShowNotificationSheet","getSearchHistory","history","MAX_HISTORY_LENGTH","addToSearchHistory","queryType","existingIndex","item","unshift","timestamp","limitedHistory","removeFromSearchHistory","filteredHistory","clearAllSearchHistory","generateSearchItemData","hashSymbol","hashtagText","SearchForm","forwardRef","searchParams","setSearchParams","useSearchParams","searchMenuOpen","setSearchMenuOpen","setQuery","searchFieldRef","useImperativeHandle","setValue","blur","searchHistory","searchSuggestionsData","recentSearchItems","historyItem","isRecentSearch","autocomplete","onSearch","onFocus","firstItem","onBlur","onKeyDown","focusItem","nextItem","nextElementSibling","parentElement","prevItem","previousElementSibling","items","lastItem","SearchCommand","showSearch","setShowSearch","searchFormRef","isSearchPage","closeSearch","enableOnFormTags","Shortcuts","isMultiColumnMode","shortcutsColumnsMode","tabBarRef","hasLists","formattedShortcuts","pin","timeoutId","activeTab","inline","scrollTop","updatesButton","instanceRef","viewScroll","getComputedStyle","Shortcuts$1","groupBoosts","newValues","boostStash","serialBoosts","boostStashID","half","floor","dedupeBoosts","boostedStatusIDs","filteredItems","boosterID","groupContext","contextIndex","contexts","repliedItem","self","inReplyToId","firstItemAccountID","newItems","appliedContextIndices","inReplyToIds","contextItems","it","sKey","statusReply","queueMicrotask","fallbackFetch","fetchStatus","saveStatus","ids","replyToStatuses","assignFollowedTags","statusFollowedTags","statusWithFollowedTags","extractedTags","itemFollowedTags","useScroll","scrollableRef","distanceFromStart","distanceFromEnd","scrollThresholdStart","scrollThresholdEnd","distanceFromStartPx","_distanceFromStartPx","distanceFromEndPx","_distanceFromEndPx","scrollDirection","setScrollDirection","reachStart","setReachStart","reachEnd","setReachEnd","nearReachStart","setNearReachStart","nearReachEnd","setNearReachEnd","isVertical","scrollableElement","previousScrollStart","onScroll","scrollHeight","scrollWidth","clientHeight","scrollStart","scrollDimension","clientDimension","scrollDistance","init","Event","useScrollFn","useThrottledCallback","scrollDelta","isScrollingForward","leading","resetScrollDirection","MediaPost","onMediaClick","accountEmojis","repliesCount","reblogged","favourited","favouritesCount","bookmarked","visibility","language","editedAt","card","uri","_deleted","_pinned","debugHover","filterContext","useContext","FilterContext","showSpoilerMedia","hasSpoiler","readingExpandMedia","filterTitleStr","Media","MediaPost$1","NavMenu","showFollowing","detect","cancelOnMovement","menuState","setMenuState","mutesIterator","fetchMutes","mutes","blocksIterator","fetchBlocks","buttonClickTS","squircle","commitHash","__COMMIT_HASH__","ListMenu","supportsLists","NavMenu$1","scrollIntoViewOptions","Timeline","titleComponent","emptyText","errorText","useItemID","fetchItems","checkForUpdatesInterval","headerStart","headerEnd","timelineStart","refresh","view","showFollowedTags","showReplyParent","clearWhenRefresh","setItems","showNew","setShowNew","debug","__BENCHMARK","isMediaFirstInstance","mediaFirst","allowGrouping","loadItemsTS","firstLoad2","loadItems","useDebouncedCallback","ts","otherPosts","pinnedPosts","items2","jRef","handler","itemsSelector","activeItem","activeElement","activeItemRect","allItems","activeItemIndex","indexOf","itemRect","topmostItem","kRef","showNewPostsIndicator","handleLoadNewPosts","scrollFnCallback","headerRef","hiddenUI","cancel","prevView","disableIdleCheck","loadOrCheckUpdates","inBackground","noPointers","__IDLE__","visible2","lastHiddenTime","dotRef","Provider","oRef","TimelineItem","inView","marginBlockEnd","fItems","aFiltered","bFiltered","filteredItemsIDs","isCarousel","unfiltered","filteredItems2","StatusCarousel","_grouped","_pinned2","item2","_pinned3","actualStatusID3","reblog3","statusID3","statusID2","actualStatusID2","reblog2","url2","contentTextWeight","manyItems","enableCommentHint","isMiddle","showCompact","_differentAuthor","isSpoiler","isStart","isEnd","TimelineStatusCompact","itemKey","oldID","newID","setRender","render","startButtonRef","_t3","endButtonRef","_t4","statusPeekText","ThreadBadge","titlesStr","MIN_YEAR","MIN_YEAR_MONTH","supportsInputMonth","mem","_isSearchEnabled","isSearchEnabled","AccountStatuses","useParams","month","excludeReplies","excludeBoosts","tagged","accountStatusesIterator","allSearchParams","searchOffsetRef","searchEnabled","setSearchEnabled","isValidMonth","_month","monthIndex","after","_year","afterStr","before","beforeStr","searchResults","done2","value2","pinnedStatuses","pinned","pinnedStatusesIds","postId","featuredTags","setFeaturedTags","acctDisplay","accountDisplay","monthYear","fetchAccount2","featuredTags2","useTitle","TimelineStart","cachedAccount","filterBarRef","month2","validity","MonthPicker","active","valid","allowSwitch","offsetLeft","fetchAccountStatuses","masto2","minYear","maxYear","minMonth","maxMonth","yearFieldRef","monthFieldRef","AnnualReport","setResults","annualReports","report2","datePlaceholder","totals","textAlign","Bookmarks","bookmarksIterator","fetchBookmarks","catchupUrl","FILTER_CONTEXT","CATCHUP_NS","RANGES","FILTER_KEYS","original","quotes","groups","FILTER_SORTS","FILTER_GROUPS","DTF","Intl","DateTimeFormat","day","hour","minute","quotedStatus","Catchup","dtf","showTopLinks","setShowTopLinks","supportsPixelfed","fetchHome","maxCreatedAt","allResults","homeIterable","homeIterator","mainloop","addedResults","createdAtTime","selfPost","_filtered","_followedTags","catchupRangeRef","catchupLastRef","handleCatchupClick","catchupID","catchup","setPosts","reloadCatchups","setLastCatchupEndAt","prevCatchups","setPrevCatchups","lastCatchupEndAt","catchupIds","Set","pc","sessionStorage","catchups","ownCatchups","lastCatchups","restCatchups","startAt","endAt","trimmedCatchups","reloadCatchupsCount","__FILTER","thePost","links","links2","sharers","likes","link","topLinks","shared","linksLoop","selectedFilterCategory","setSelectedFilterCategory","savedState","setRange","groupBy","setGroupBy","setSortOrder","setSelectedAuthor","setSortBy","sortBy","sortOrder","selectedAuthor","postFilterMatches","setJSON","filteredPosts","filteredPosts2","authorsHash","authorCountsMap","boostedPosts","__BOOSTERS","filteredPostsMap","authorCounts","authorID","authorCountsList","sortedFilteredPosts","aAccountID","authorIndices","bIndex","bAccountID","aIndex","postDensity","bDensity","aDensity","prevGroup","authorsListParent","autoAnimated","isFiltered2","postsBarType","posts2","postsBins","bins","binByTime","scrollElement","lastCatchupRange","authorUsername","authors","sortOrderIndex","authorElement","scrollableRect","authorRect","right","showHelp","setShowHelp","hlRef","_2","isRadio","handleArrowKeys","escRef","isArrowKeys","closest","st","yes","del","formatRange","transform","imageDescription","publishedAt","labAverageColor","postsBar","filterCounts","author","paddingInline","showSeparator","IntersectionPostLineItem","PostLine","isFollowedTags","isReplyTo","onMouseEnter","setShow","show","IntersectionObserver","unobserve","MEDIA_DENSITY","CARD_DENSITY","pollContent","htmlContentLength","PostPeek","_thread","isThread","theQuote","readingExpandSpoilers","postText","showPostContent","emojifyText","o","remoteMediaURL","showMedia","mediaURL","MEDIA_SIZE","previewUrl","gifv","audio","quotesCount","PostStats","numBins","dates","minDate","maxDate","normalized","binIndex","Favourites","favouritesIterator","fetchFavourites","FILTER_CONTEXT_UNIMPLEMENTED","FILTER_CONTEXT_LABELS","home","thread","EXPIRY_DURATIONS","EXPIRY_DURATIONS_LABELS","Filters","showFiltersAddEditModal","setShowFiltersAddEditModal","filters","setFilters","keywords","expiresAt","keyword","ExpiryStatus","FiltersAddEdit","_id","incID","filterAction","hasExpiry","expiresAtDate","editKeywords","setEditKeywords","keywordsRef","setRemovedKeyword_IDs","filteredEditKeywords","setRemovedKeywordIDs","removedKeyword_IDs","keywordIDs","getAll","keywordKeywords","keywordWholeWords","keywordsAttributes","wholeWord","removedKeywordIDs","context2","expiresIn","wholeWords","filterResult","filterAction2","_id2","getAPIVersions","showNeverExpires","expired","rerender","FollowedHashtags","Following","client","streamingClient","setStreamingClient","latestItem","onStreamingReady","latestItemChanged","clearFollowedTagsState","include_reblogs","valueContainsLatestItem","getStatus","TAGS_LIMIT_PER_MODE","TOTAL_TAGS_LIMIT","Hashtags","mediaView","hashtags","linkParams","hashtagTitle","maxID","fetchHashtags","timelines","any","maxId","onlyMedia","since_id","followUIState","setFollowUIState","reachLimit","featuredUIState","setFeaturedUIState","isFeaturedTag","setIsFeaturedTag","setDownOverflow","finally","featuredTagID","delete","FocusableItem","newHashtag","MenuGroup","exists","newInstance","List","listIterator","setList","showManageMembersModal","setShowManageMembersModal","list2","MenuHeader","ListManageMembers","MEMBERS_LIMIT","members","setMembers","membersIterator","fetchMembers","member","as","RemoveAddButton","setRemoved","removed","notificationTypeKeys","GROUP_TYPES","groupable","fixNotifications","massageNotifications2","notificationGroups","sampleAccountIds","statusId","groupNotifications2","groupNotifications","newGroupNotifications","gn","latestPageNotificationAt","mostRecentNotificationId","newGroupNotifications1","notificationsMap","virtualType","sampleCountDiffNotificationsCount","mappedNotification","ma","mappedAccount","newGroupNotifications2","notificationsMap2","toLocaleDateString","hasOneAccount","cleanNotifications","reverse","cleanNotifications2","emptySearchParams","Mentions","stateType","setStateType","mentionsIterator","fetchMentions","types","conversationsIterator","latestConversationItem","lastStatus","fetchConversations","NOTIFICATIONS_LIMIT","NOTIFICATIONS_GROUPED_LIMIT","memSupportsGroupedNotifications","mastodon","mastoFetchNotificationsIterable","mastoFetchNotifications","getGroupedNotifications","NOTIFICATIONS_POLICIES","NOTIFICATIONS_POLICIES_TEXT","forNotFollowing","forNotFollowers","forNewAccounts","forPrivateMentions","forLimitedAccounts","Notifications","notificationID","notificationAccessToken","onlyMentions","setOnlyMentions","setFollowRequests","announcements","setAnnouncements","notificationsIterable","allNotifications","groupedNotifications","notificationsLastFetchTime","fetchFollowRequests","loadFollowRequests","requests","fetchAnnouncements","supportsFilteredNotifications","showNotificationsSettings","setShowNotificationsSettings","notificationsPolicy","setNotificationsPolicy","fetchNotificationsPolicy","loadNotificationsPolicy","notificationsRequests","setNotificationsRequests","fetchNotificationsRequest","loadNotifications","fetchNotificationsPromise","fetchNotifications","loadUpdates","unsub","subscribeKey","yesterdayDate","todayDate","currentDay","showTodayEmpty","announcementsListRef","annualReportNotification2","setAnnualReportNotification","annualReportNotification","annualReportYear","statusLink","todaySubHeading","today","forceOpts","announcement","onToggle","request","summary","pendingRequestsCount","NotificationRequestModalButton","differentDay","notificationDay","subHeading","newPolicy","AnnouncementBlock","contact","contactAccount","startsAt","endsAt","published","allDay","reactions","read","publishedDateText","updatedAtText","publishedAtDate","reaction","me","fetchNotficationsByAccount","showModal","setShowModal","notifs","setNotifications","NotificationRequestButtons","hasRequestState","Notifications$1","Public","isLocal","publicIterator","fetchPublic","remote","prompt","RecentSearches","onItemClick","handleClearAll","handleRemoveItem","listRef","SHORT_LIMIT","Search","offsetRef","statusResults","setStatusResults","accountResults","setAccountResults","hashtagResults","setHashtagResults","typeResults","setTypeResultsFunc","loadResults","filterBarParent","reduce","TREND_CACHE_TIME","fetchLinks","trends","fetchTrendsStatuses","pixelfed","discover","fetchLinkList","Trending","setHashtags","setLinks","trendIterator","fetchTrends","currentLinkMentionsLoading","setCurrentLinkMentionsLoading","currentLinkMentionsIterator","currentLink","setCurrentLink","hasCurrentLink","supportsTrendingLinkPosts","currentLinkRef","prevCurrentLink","authorUrl","authorName","providerName","providerUrl","isShortTitle","title2","hasAuthor","flexShrink","fetchLinkMentions","Columns","Component","Hashtag","$column","currentFocusedColumn","prevColKey","nextColKey","Home","NotificationsLink","notificationLinkRef","NotificationsMenu","NOTIFICATIONS_DISPLAY_LIMIT","hasFollowRequests","setHasFollowRequests","skipFollowRequests","headerHeight","Home$1","statusPostRegexes","getInstanceStatusObject","theURL","regex","getInstanceStatusURL","HttpRoute","statusObject","statusURL","Lists","hasExclusiveLists","instancesListURL","openAuthPopup","features","popup","closed","closeAuthPopup","close","watchAuthPopup","onSuccess","resolved","messageHandler","cleanup","pollInterval","PHANPY_DEFAULT_INSTANCE","DEFAULT_INSTANCE","Login","instanceURLRef","cachedInstanceURL","submit","instanceText","setInstanceText","instancesList","setInstancesList","searcher","Fuse","submitInstance","xmlDoc","DOMParser","parseFromString","getElementsByTagName","template","getCredentialApplication","credentialApplication","storeCredentialApplication","authPKCE","authUrl","getAuthorizationURL","callbackUrl","cleanInstanceText","instanceTextLooksLikeDomain","instancesSuggestions","instance2","selectedInstanceText","ScheduledPosts","scheduledPosts","setScheduledPosts","showScheduledPostModal","setShowScheduledPostModal","postsIterator","scheduledStatuses","allPosts","quotedStatusId","quoteApprovalPolicy","option","votesCount","ScheduledPostPreview","ScheduledPostEdit","hours","formatOpts","weekday","differentScheduledAt","setNewScheduledAt","newScheduledAt","localTZ","getLocalTimezoneName","pastSchedule","ScheduledAtField","setScheduledAt","EditHistoryControls","prevEditedAt","nextEditedAt","editedAtIndex","editHistoryMode","editHistoryRef","exitEditHistory","useEditHistory","SUBCOMMENTS_OPEN_ALL_LIMIT","MAX_WEIGHT","cachedRepliesToggle","cachedStatusesMap","scrollPositions","resetScrollPosition","STATUSES_SELECTOR","STATUS_URL_REGEX","StatusPage","mediaParam","mediaOnlyParam","mediaStatusID","mediaStatus","showMediaOnly","heroStatus","setHeroStatus","closeLink","matchStatusPath","matchPath","postViewState","mediaClose","mediaAttachments2","handleMediaClose","mediaVTN","getSafeViewTransitionName","els","foundEls","el2","elBounds","innerHeight","transition","startViewTransition","viewTransitionName","viewTransitioned","$carousel","$deckContainer","$deckContainers","linkable","restProps","createdAtSort","MONTH_IN_MS","StatusThread","setViewMode","totalDescendants","setStatuses","heroStatusRef","scrollOffsets","fullContext","initEditHistory","threadsCount","currentEditedAtStatus","nextEditedAtStatus","descendants","sCreatedAt","currentEditedAtStatusCreatedAt","nextEditedAtStatusCreatedAt","ancestors2","ancestors","ancestorsIsThread","heroStatus2","nestedDescendants","missingStatuses","heroAccountID","descendantLevelsCount","__replies","level","nextLevel","_replies","_r","expandReplies","calcStatusWeight","descendant","weight","mappedNestedDescendants","reloadHero","ancestor","reallyCachedStatuses","allStatuses","contextFetch","pRetry","initContext","heroTimer","cachedStatuses","retries","restructureContext","descendantsThread","threadsCount2","heroFetch","heroLimit","threadifyStatus","setThreadsCount","setShowRefresh","offsetTop","lastInitContextTS","setLimit","scrollPosition","newScrollOffsets","newScrollTop","showRefresh","contextURL","statusWeightCache","heroContentText","heroDisplayName","postInstance","apiCache","ignoreVary","postSameInstance","heroInView","setHeroInView","activeStatusRect","activeStatus","allStatusLinks","activeStatusIndex","nextStatus","statusLinkRect","topmostStatusLink","heroPointer","prevStatus","details","initialPageState","handleMediaClick","handleStatusLinkClick","renderStatus","isHero","tagName","reachTopPost","requestAnimationFrame","withinContext","enableTranslate","translate","StatusParent","setReachTopPost","SubComments","isLinkable","hasDescendants","showActionsBar","prevEntry","moreStatusesKeys","getIDs","hasParentThread","accWeight","months","slicedStatuses","prevLocationIsStatusPage","currentDate","prevDate","prevID","monthsDiff","years","spoilerButton","ThreadCountContext","statusesList","viewMode","isFinite","onAnimationEnd","back","short","arr","button","buttons","openAll","parentLink","diveDeep","replies3","sameCount","totalComments","totalWeight","openBefore","detailsRef","setRenderReplies","Container","isDetails","shortReply","dataset","renderReplies","cachedWeight","POLL_VIRTUAL_LENGTH","cardLength","CARD_VIRTUAL_LENGTH","mediaLength","pollLength","StatusRoute","boostsCarouselUrl","multiHashtagTimelineUrl","nestedCommentsThreadUrl","logoText","PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL","DEFAULT_INSTANCE_REGISTRATION_URL","appSite","__COMMIT_TIME__","Welcome","nativeAlert","__nativeAlert","Toastify","gravity","__STATES__","__STATES_STATS__","counts","unmountedPosts","setInterval","unfurledLinks","postInNotifications","$post","unfurled","keysCount","ICONS","nonIdleEvents","setIdle","debouncedSetIdle","onNonIdle","capture","relatedTarget","isIOS","showingMediaModal","textSize","$app","$body","BENCHES","__BENCH_RESULTS","isPWA","PATH_RESTORE_TIME_LIMIT","setIsLoggedIn","App","isPopup","getVapidKey","vapid_key","access_token","getAccessToken","clientID","initClient","allSettled","initStates","getAccount","searchAccount","initPreferences","initInstance","hasPreferences","location2","restoredRef","lastPathKey","sessionCookie","isRootPath","lastAccessed","lastPath","getJSON","SecondaryRoutes","Route","PrimaryRoutes","Routes","Root","nonRootLocation","getPrevLocation","Sandbox","backgroundLocation","isModalPage","initActivateLang","initPWAViewport","I18nProvider","HashRouter","IconSpriteProvider","localStorage","removeItem","caches","IGNORE_CACHE_KEYS","clearRanOnce","FAST_INTERVAL","SLOW_INTERVAL","clearCaches","cache","_keys","MAX_SW_CACHE_SIZE","deleteKeys"],"ignoreList":[0,1,6,7,35,36,37,38,39,40,41,42,43,44,45,46,47,48,51,56],"sources":["../../node_modules/just-debounce-it/index.mjs","../../node_modules/swiped-events/src/swiped-events.js","../../src/utils/usePageVisibility.js","../../src/components/background-service.jsx","../../src/components/compose-button.jsx","../../src/components/keyboard-shortcuts-help.jsx","../../node_modules/@formkit/auto-animate/index.mjs","../../node_modules/@formkit/auto-animate/preact/index.mjs","../../src/utils/oauth-pkce.js","../../src/utils/auth.js","../../src/pages/accounts.jsx","../../src/assets/logo.svg","../../src/components/lang-selector.jsx","../../src/utils/push-notifications.js","../../src/pages/settings.jsx","../../src/utils/focus-deck.js","../../src/utils/useLocationChange.js","../../src/components/account-handle-info.jsx","../../src/components/edit-profile-sheet.jsx","../../src/components/endorsements.jsx","../../src/utils/lists.js","../../src/components/list-exclusive-badge.jsx","../../src/components/list-add-edit.jsx","../../src/components/add-remove-lists-sheet.jsx","../../src/components/private-note-sheet.jsx","../../src/components/translated-bio-sheet.jsx","../../src/components/related-actions.jsx","../../src/components/account-info.jsx","../../src/components/account-sheet.jsx","../../src/components/drafts.jsx","../../src/components/embed-modal.jsx","../../src/components/generic-accounts.jsx","../../src/components/import-accounts-selection.jsx","../../src/components/import-export-accounts.jsx","../../src/components/media-alt-modal.jsx","../../node_modules/chroma-js/src/utils/limit.js","../../node_modules/chroma-js/src/utils/type.js","../../node_modules/chroma-js/src/utils/unpack.js","../../node_modules/chroma-js/src/utils/index.js","../../node_modules/chroma-js/src/utils/multiply-matrices.js","../../node_modules/chroma-js/src/io/lab/lab-constants.js","../../node_modules/chroma-js/src/io/lab/lab2rgb.js","../../node_modules/chroma-js/src/io/oklab/oklab2rgb.js","../../node_modules/chroma-js/src/io/lab/rgb2lab.js","../../node_modules/chroma-js/src/io/oklab/rgb2oklab.js","../../node_modules/chroma-js/src/io/lch/lch2lab.js","../../node_modules/chroma-js/src/io/oklch/oklch2rgb.js","../../node_modules/chroma-js/src/io/lch/lab2lch.js","../../node_modules/chroma-js/src/io/oklch/rgb2oklch.js","../../src/components/media-modal.jsx","../../src/components/open-link-sheet.jsx","../../node_modules/qr/index.js","../../src/components/qr-code.jsx","../../src/components/qr-code-modal.jsx","../../src/components/qr-scanner-modal.jsx","../../src/components/report-modal.jsx","../../node_modules/lz-string/libs/lz-string.js","../../src/assets/floating-button.svg","../../src/assets/multi-column.svg","../../src/assets/tab-menu-bar.svg","../../src/utils/followed-tags.js","../../src/components/AsyncText.jsx","../../src/components/shortcuts-settings.jsx","../../src/components/modals.jsx","../../src/components/navigation-command.jsx","../../src/components/follow-request-buttons.jsx","../../src/components/notification.jsx","../../src/components/notification-service.jsx","../../src/utils/search-history.js","../../src/components/search-form.jsx","../../src/components/search-command.jsx","../../src/components/shortcuts.jsx","../../src/utils/timeline-utils.js","../../src/utils/useScroll.js","../../src/utils/useScrollFn.js","../../src/components/media-post.jsx","../../src/components/nav-menu.jsx","../../src/components/timeline.jsx","../../src/pages/account-statuses.jsx","../../src/pages/annual-report.jsx","../../src/pages/bookmarks.jsx","../../src/assets/features/catch-up.png","../../src/pages/catchup.jsx","../../src/pages/favourites.jsx","../../src/pages/filters.jsx","../../src/pages/followed-hashtags.jsx","../../src/pages/following.jsx","../../src/pages/hashtag.jsx","../../src/pages/list.jsx","../../src/utils/group-notifications.js","../../src/pages/mentions.jsx","../../src/pages/notifications.jsx","../../src/pages/public.jsx","../../src/components/recent-searches.jsx","../../src/pages/search.jsx","../../src/pages/trending.jsx","../../src/components/columns.jsx","../../src/pages/home.jsx","../../src/utils/get-instance-status-url.js","../../src/pages/http-route.jsx","../../src/pages/lists.jsx","../../src/data/instances.json?url","../../src/utils/auth-popup.js","../../src/pages/login.jsx","../../src/pages/scheduled-posts.jsx","../../src/components/edit-history-controls.jsx","../../src/pages/status.jsx","../../src/pages/status-route.jsx","../../src/assets/features/boosts-carousel.jpg","../../src/assets/features/multi-column.jpg","../../src/assets/features/multi-hashtag-timeline.jpg","../../src/assets/features/nested-comments-thread.jpg","../../src/assets/logo-text.svg","../../src/pages/welcome.jsx","../../src/utils/toast-alert.js","../../src/app.jsx","../../src/main.jsx"],"sourcesContent":["var functionDebounce = debounce;\n\nfunction debounce(fn, wait, callFirst) {\n  var timeout = null;\n  var debouncedFn = null;\n\n  var clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n\n      debouncedFn = null;\n      timeout = null;\n    }\n  };\n\n  var flush = function() {\n    var call = debouncedFn;\n    clear();\n\n    if (call) {\n      call();\n    }\n  };\n\n  var debounceWrapper = function() {\n    if (!wait) {\n      return fn.apply(this, arguments);\n    }\n\n    var context = this;\n    var args = arguments;\n    var callNow = callFirst && !timeout;\n    clear();\n\n    debouncedFn = function() {\n      fn.apply(context, args);\n    };\n\n    timeout = setTimeout(function() {\n      timeout = null;\n\n      if (!callNow) {\n        var call = debouncedFn;\n        debouncedFn = null;\n\n        return call();\n      }\n    }, wait);\n\n    if (callNow) {\n      return debouncedFn();\n    }\n  };\n\n  debounceWrapper.cancel = clear;\n  debounceWrapper.flush = flush;\n\n  return debounceWrapper;\n}\n\nexport {functionDebounce as default};\n","/*!\n * swiped-events.js - v@version@\n * Pure JavaScript swipe events\n * https://github.com/john-doherty/swiped-events\n * @inspiration https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element\n * @author John Doherty <www.johndoherty.info>\n * @license MIT\n */\n(function (window, document) {\n\n    'use strict';\n\n    // patch CustomEvent to allow constructor creation (IE/Chrome)\n    if (typeof window.CustomEvent !== 'function') {\n\n        window.CustomEvent = function (event, params) {\n\n            params = params || { bubbles: false, cancelable: false, detail: undefined };\n\n            var evt = document.createEvent('CustomEvent');\n            evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n            return evt;\n        };\n\n        window.CustomEvent.prototype = window.Event.prototype;\n    }\n\n    document.addEventListener('touchstart', handleTouchStart, false);\n    document.addEventListener('touchmove', handleTouchMove, false);\n    document.addEventListener('touchend', handleTouchEnd, false);\n\n    var xDown = null;\n    var yDown = null;\n    var xDiff = null;\n    var yDiff = null;\n    var timeDown = null;\n    var startEl = null;\n    var touchCount = 0;\n\n    /**\n     * Fires swiped event if swipe detected on touchend\n     * @param {object} e - browser event object\n     * @returns {void}\n     */\n    function handleTouchEnd(e) {\n\n        // if the user released on a different target, cancel!\n        if (startEl !== e.target) return;\n\n        var swipeThreshold = parseInt(getNearestAttribute(startEl, 'data-swipe-threshold', '20'), 10); // default 20 units\n        var swipeUnit = getNearestAttribute(startEl, 'data-swipe-unit', 'px'); // default px\n        var swipeTimeout = parseInt(getNearestAttribute(startEl, 'data-swipe-timeout', '500'), 10);    // default 500ms\n        var timeDiff = Date.now() - timeDown;\n        var eventType = '';\n        var changedTouches = e.changedTouches || e.touches || [];\n\n        if (swipeUnit === 'vh') {\n            swipeThreshold = Math.round((swipeThreshold / 100) * document.documentElement.clientHeight); // get percentage of viewport height in pixels\n        }\n        if (swipeUnit === 'vw') {\n            swipeThreshold = Math.round((swipeThreshold / 100) * document.documentElement.clientWidth); // get percentage of viewport height in pixels\n        }\n\n        if (Math.abs(xDiff) > Math.abs(yDiff)) { // most significant\n            if (Math.abs(xDiff) > swipeThreshold && timeDiff < swipeTimeout) {\n                if (xDiff > 0) {\n                    eventType = 'swiped-left';\n                }\n                else {\n                    eventType = 'swiped-right';\n                }\n            }\n        }\n        else if (Math.abs(yDiff) > swipeThreshold && timeDiff < swipeTimeout) {\n            if (yDiff > 0) {\n                eventType = 'swiped-up';\n            }\n            else {\n                eventType = 'swiped-down';\n            }\n        }\n\n        if (eventType !== '') {\n\n            var eventData = {\n                dir: eventType.replace(/swiped-/, ''),\n                touchType: (changedTouches[0] || {}).touchType || 'direct',\n                fingers: touchCount, // Number of fingers used\n                xStart: parseInt(xDown, 10),\n                xEnd: parseInt((changedTouches[0] || {}).clientX || -1, 10),\n                yStart: parseInt(yDown, 10),\n                yEnd: parseInt((changedTouches[0] || {}).clientY || -1, 10)\n            };\n\n            // fire `swiped` event event on the element that started the swipe\n            startEl.dispatchEvent(new CustomEvent('swiped', { bubbles: true, cancelable: true, detail: eventData }));\n\n            // fire `swiped-dir` event on the element that started the swipe\n            startEl.dispatchEvent(new CustomEvent(eventType, { bubbles: true, cancelable: true, detail: eventData }));\n        }\n\n        // reset values\n        xDown = null;\n        yDown = null;\n        timeDown = null;\n    }\n    /**\n     * Records current location on touchstart event\n     * @param {object} e - browser event object\n     * @returns {void}\n     */\n    function handleTouchStart(e) {\n\n        // if the element has data-swipe-ignore=\"true\" we stop listening for swipe events\n        if (e.target.getAttribute('data-swipe-ignore') === 'true') return;\n\n        startEl = e.target;\n\n        timeDown = Date.now();\n        xDown = e.touches[0].clientX;\n        yDown = e.touches[0].clientY;\n        xDiff = 0;\n        yDiff = 0;\n        touchCount = e.touches.length;\n    }\n\n    /**\n     * Records location diff in px on touchmove event\n     * @param {object} e - browser event object\n     * @returns {void}\n     */\n    function handleTouchMove(e) {\n\n        if (!xDown || !yDown) return;\n\n        var xUp = e.touches[0].clientX;\n        var yUp = e.touches[0].clientY;\n\n        xDiff = xDown - xUp;\n        yDiff = yDown - yUp;\n    }\n\n    /**\n     * Gets attribute off HTML element or nearest parent\n     * @param {object} el - HTML element to retrieve attribute from\n     * @param {string} attributeName - name of the attribute\n     * @param {any} defaultValue - default value to return if no match found\n     * @returns {any} attribute value or defaultValue\n     */\n    function getNearestAttribute(el, attributeName, defaultValue) {\n\n        // walk up the dom tree looking for attributeName\n        while (el && el !== document.documentElement) {\n\n            var attributeValue = el.getAttribute(attributeName);\n\n            if (attributeValue) {\n                return attributeValue;\n            }\n\n            el = el.parentNode;\n        }\n\n        return defaultValue;\n    }\n\n}(window, document));\n","import { useEffect, useRef } from 'preact/hooks';\n\nexport default function usePageVisibility(fn = () => {}, deps = []) {\n  const savedCallback = useRef(fn);\n  useEffect(() => {\n    savedCallback.current = fn;\n  }, [deps]);\n\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      const hidden = document.hidden || document.visibilityState === 'hidden';\n      console.log(' Page visibility changed', hidden ? 'hidden' : 'visible');\n      savedCallback.current(!hidden);\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () =>\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n  }, []);\n}\n","import { useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\nimport { api } from '../utils/api';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport useInterval from '../utils/useInterval';\nimport usePageVisibility from '../utils/usePageVisibility';\n\nconst STREAMING_TIMEOUT = 1000 * 3; // 3 seconds\nconst POLL_INTERVAL = 20_000; // 20 seconds\n\nexport default memo(function BackgroundService({ isLoggedIn }) {\n  const { t } = useLingui();\n\n  // Notifications service\n  // - WebSocket to receive notifications when page is visible\n  const [visible, setVisible] = useState(true);\n  const visibleTimeout = useRef();\n  usePageVisibility((visible) => {\n    clearTimeout(visibleTimeout.current);\n    if (visible) {\n      setVisible(true);\n    } else {\n      visibleTimeout.current = setTimeout(() => {\n        setVisible(false);\n      }, POLL_INTERVAL);\n    }\n  });\n\n  const checkLatestNotification = async (masto, instance, skipCheckMarkers) => {\n    if (states.notificationsLast) {\n      const notificationsIterator = masto.v1.notifications\n        .list({\n          limit: 1,\n          sinceId: states.notificationsLast.id,\n        })\n        .values();\n      const { value: notifications } = await notificationsIterator.next();\n      if (notifications?.length) {\n        if (skipCheckMarkers) {\n          states.notificationsShowNew = true;\n        } else {\n          let lastReadId;\n          try {\n            const markers = await masto.v1.markers.fetch({\n              timeline: 'notifications',\n            });\n            lastReadId = markers?.notifications?.lastReadId;\n          } catch (e) {}\n          if (lastReadId) {\n            states.notificationsShowNew = notifications[0].id !== lastReadId;\n          } else {\n            states.notificationsShowNew = true;\n          }\n        }\n      }\n    }\n  };\n\n  useEffect(() => {\n    let sub;\n    let streamTimeout;\n    let pollNotifications;\n    if (isLoggedIn && visible) {\n      const { masto, streaming, instance } = api();\n      (async () => {\n        // 1. Get the latest notification\n        await checkLatestNotification(masto, instance);\n\n        let hasStreaming = false;\n        // 2. Start streaming\n        if (streaming) {\n          streamTimeout = setTimeout(() => {\n            (async () => {\n              try {\n                hasStreaming = true;\n                sub = streaming.user.notification.subscribe();\n                console.log(' Streaming notification', sub);\n                for await (const entry of sub) {\n                  if (!sub) break;\n                  if (!visible) break;\n                  console.log(' Notification entry', entry);\n                  if (entry.event === 'notification') {\n                    console.log(' Notification', entry);\n                    saveStatus(entry.payload, instance, {\n                      skipThreading: true,\n                    });\n                  }\n                  states.notificationsShowNew = true;\n                }\n                console.log(' Streaming notification loop STOPPED');\n              } catch (e) {\n                hasStreaming = false;\n                console.error(e);\n              }\n\n              if (!hasStreaming) {\n                console.log(' Streaming failed, fallback to polling');\n                pollNotifications = setInterval(() => {\n                  checkLatestNotification(masto, instance, true);\n                }, POLL_INTERVAL);\n              }\n            })();\n          }, STREAMING_TIMEOUT);\n        }\n      })();\n    }\n    return () => {\n      sub?.unsubscribe?.();\n      sub = null;\n      clearTimeout(streamTimeout);\n      clearInterval(pollNotifications);\n    };\n  }, [visible, isLoggedIn]);\n\n  // Check for updates service\n  const lastCheckDate = useRef();\n  const checkForUpdates = () => {\n    lastCheckDate.current = Date.now();\n    console.log(' Check app update');\n    fetch('./version.json')\n      .then((r) => r.json())\n      .then((info) => {\n        if (info) states.appVersion = info;\n      })\n      .catch((e) => {\n        console.error(e);\n      });\n  };\n  useInterval(checkForUpdates, visible && 1000 * 60 * 30); // 30 minutes\n  usePageVisibility((visible) => {\n    if (visible) {\n      if (!lastCheckDate.current) {\n        checkForUpdates();\n      } else {\n        const diff = Date.now() - lastCheckDate.current;\n        if (diff > 1000 * 60 * 60) {\n          // 1 hour\n          checkForUpdates();\n        }\n      }\n    }\n  });\n\n  // Global keyboard shortcuts \"service\"\n  useHotkeys(\n    'shift+alt+k',\n    (e) => {\n      // Need modifers check due to useKey: true\n      if (!e.shiftKey || !e.altKey) return;\n\n      const currentCloakMode = states.settings.cloakMode;\n      states.settings.cloakMode = !currentCloakMode;\n      showToast({\n        text: currentCloakMode ? t`Cloak mode disabled` : t`Cloak mode enabled`,\n      });\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey,\n    },\n  );\n\n  return null;\n});\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { ControlledMenu, MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useCallback, useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useLongPress } from 'use-long-press';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport niceDateTime from '../utils/nice-date-time';\nimport openCompose from '../utils/open-compose';\nimport openOSK from '../utils/open-osk';\nimport pmem from '../utils/pmem';\nimport safeBoundingBoxPadding from '../utils/safe-bounding-box-padding';\nimport showCompose from '../utils/show-compose';\nimport states from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport { getCurrentAccountID } from '../utils/store-utils';\n\nimport Icon from './icon';\nimport Loader from './loader';\nimport MenuLink from './menu-link';\nimport RelativeTime from './relative-time';\nimport SubMenu2 from './submenu2';\n\n// Function to fetch the latest posts from the current user\n// Use pmem to memoize fetch results for 1 minute\nconst fetchLatestPostsMemoized = pmem(\n  async (masto, currentAccountID) => {\n    const statusesIterator = masto.v1.accounts\n      .$select(currentAccountID)\n      .statuses.list({\n        limit: 3,\n        exclude_replies: true,\n        exclude_reblogs: true,\n      })\n      .values();\n    const { value } = await statusesIterator.next();\n    return value || [];\n  },\n  { maxAge: 60000 },\n); // 1 minute cache\n\nexport default function ComposeButton() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { masto } = api();\n\n  // Context menu state\n  const [menuOpen, setMenuOpen] = useState(false);\n  const [latestPosts, setLatestPosts] = useState([]);\n  const [loadingPosts, setLoadingPosts] = useState(false);\n  const buttonRef = useRef(null);\n  const menuRef = useRef(null);\n\n  const columnMode = snapStates.settings.shortcutsViewMode === 'multi-column';\n\n  function handleButton(e) {\n    // useKey will even listen to Shift\n    // e.g. press Shift (without c) will trigger this \n    if (e.key && e.key.toLowerCase() !== 'c') return;\n\n    if (snapStates.composerState.minimized) {\n      states.composerState.minimized = false;\n      openOSK();\n      return;\n    }\n\n    const composeDataElements = document.querySelectorAll('data.compose-data');\n    // If there's a lot of them, ignore\n    const opts =\n      !columnMode && composeDataElements.length === 1\n        ? JSON.parse(composeDataElements[0].value)\n        : undefined;\n\n    if (e.shiftKey) {\n      const newWin = openCompose(opts);\n\n      if (!newWin) {\n        states.showCompose = opts || true;\n      }\n    } else {\n      openOSK();\n      states.showCompose = opts || true;\n    }\n  }\n\n  useHotkeys('c, shift+c', handleButton, {\n    useKey: true,\n    ignoreEventWhen: (e) => {\n      const hasModal = !!document.querySelector('#modal-container > *');\n      return hasModal || e.metaKey || e.ctrlKey || e.altKey;\n    },\n  });\n\n  // Setup longpress handler to open context menu\n  const bindLongPress = useLongPress(\n    () => {\n      setMenuOpen(true);\n    },\n    {\n      threshold: 600,\n    },\n  );\n\n  const fetchLatestPosts = useCallback(async () => {\n    try {\n      setLoadingPosts(true);\n      const currentAccountID = getCurrentAccountID();\n      if (!currentAccountID) {\n        return;\n      }\n      const posts = await fetchLatestPostsMemoized(masto, currentAccountID);\n      setLatestPosts(posts);\n    } catch (error) {\n    } finally {\n      setLoadingPosts(false);\n    }\n  }, [masto]);\n\n  // Function to handle opening the compose window to reply to a post\n  const handleReplyToPost = useCallback((post) => {\n    showCompose({\n      replyToStatus: post,\n    });\n    setMenuOpen(false);\n  }, []);\n\n  useEffect(() => {\n    if (menuOpen) {\n      fetchLatestPosts();\n    }\n  }, [fetchLatestPosts, menuOpen]);\n\n  return (\n    <>\n      <button\n        ref={buttonRef}\n        type=\"button\"\n        id=\"compose-button\"\n        onClick={handleButton}\n        onContextMenu={(e) => {\n          e.preventDefault();\n          setMenuOpen(true);\n        }}\n        {...bindLongPress()}\n        class={`${snapStates.composerState.minimized ? 'min' : ''} ${\n          snapStates.composerState.publishing ? 'loading' : ''\n        } ${snapStates.composerState.publishingError ? 'error' : ''}`}\n      >\n        <Icon icon=\"quill\" size=\"xl\" alt={t`Compose`} />\n      </button>\n      <ControlledMenu\n        ref={menuRef}\n        state={menuOpen ? 'open' : undefined}\n        anchorRef={buttonRef}\n        onClose={() => setMenuOpen(false)}\n        direction=\"top\"\n        gap={8} // Add gap between menu and button\n        unmountOnClose\n        portal={{\n          target: document.body,\n        }}\n        boundingBoxPadding={safeBoundingBoxPadding()}\n        containerProps={{\n          style: {\n            zIndex: 19,\n          },\n          onClick: () => {\n            menuRef.current?.closeMenu?.();\n          },\n        }}\n        submenuOpenDelay={600}\n      >\n        <MenuLink to=\"/sp\">\n          <Icon icon=\"schedule\" />{' '}\n          <span>\n            <Trans>Scheduled Posts</Trans>\n          </span>\n        </MenuLink>\n        <MenuDivider />\n        <SubMenu2\n          align=\"end\"\n          direction=\"top\"\n          shift={-8}\n          disabled={loadingPosts || latestPosts.length === 0}\n          label={\n            <>\n              <Icon icon=\"comment\" />{' '}\n              <span className=\"menu-grow\">\n                <Trans>Add to thread</Trans>\n              </span>\n              {loadingPosts ? '' : <Icon icon=\"chevron-right\" />}\n            </>\n          }\n        >\n          {latestPosts.length > 0 &&\n            latestPosts.map((post) => {\n              const createdDate = new Date(post.createdAt);\n              const isWithinDay = Date.now() - createdDate.getTime() < 86400000;\n\n              return (\n                <MenuItem key={post.id} onClick={() => handleReplyToPost(post)}>\n                  <small>\n                    <div class=\"menu-post-text\">{statusPeek(post)}</div>\n                    <span className=\"more-insignificant\">\n                      {/* Show relative time if within a day */}\n                      {isWithinDay && (\n                        <>\n                          <RelativeTime datetime={createdDate} format=\"micro\" />{' '}\n                          {' '}\n                        </>\n                      )}\n                      <time\n                        className=\"created\"\n                        dateTime={createdDate.toISOString()}\n                        title={createdDate.toLocaleString()}\n                      >\n                        {niceDateTime(post.createdAt)}\n                      </time>\n                    </span>\n                  </small>\n                </MenuItem>\n              );\n            })}\n        </SubMenu2>\n      </ControlledMenu>\n    </>\n  );\n}\n","import './keyboard-shortcuts-help.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSnapshot } from 'valtio';\n\nimport states from '../utils/states';\n\nimport Icon from './icon';\nimport Modal from './modal';\n\n// Helper component for sequential key shortcuts\nfunction SequentialKeys({ key1, key2 }) {\n  return (\n    <Trans>\n      <kbd>{key1}</kbd> then <kbd>{key2}</kbd>\n    </Trans>\n  );\n}\n\nexport default memo(function KeyboardShortcutsHelp() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n\n  function onClose() {\n    states.showKeyboardShortcutsHelp = false;\n  }\n\n  useHotkeys(\n    '?',\n    () => {\n      console.log('help');\n      states.showKeyboardShortcutsHelp = true;\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => {\n        const isCatchUpPage = /\\/catchup/i.test(location.hash);\n        return isCatchUpPage || e.metaKey || e.ctrlKey || e.altKey;\n        // const hasModal = !!document.querySelector('#modal-container > *');\n        // return hasModal;\n      },\n    },\n  );\n\n  return (\n    !!snapStates.showKeyboardShortcutsHelp && (\n      <Modal onClose={onClose}>\n        <div id=\"keyboard-shortcuts-help-container\" class=\"sheet\" tabindex=\"-1\">\n          <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n          <header>\n            <h2>\n              <Trans>Keyboard shortcuts</Trans>\n            </h2>\n          </header>\n          <main>\n            <table>\n              <tbody>\n                {[\n                  {\n                    action: t`Keyboard shortcuts help`,\n                    keys: <kbd>?</kbd>,\n                  },\n                  {\n                    action: t`Next post`,\n                    keys: <kbd>j</kbd>,\n                  },\n                  {\n                    action: t`Previous post`,\n                    keys: <kbd>k</kbd>,\n                  },\n                  {\n                    action: t`Skip carousel to next post`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>j</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Skip carousel to previous post`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>k</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Load new posts`,\n                    keys: <kbd>.</kbd>,\n                  },\n                  {\n                    action: t`Open post details`,\n                    keys: (\n                      <Trans>\n                        <kbd>Enter</kbd> or <kbd>o</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: (\n                      <Trans>\n                        Expand content warning or\n                        <br />\n                        toggle expanded/collapsed thread\n                      </Trans>\n                    ),\n                    keys: <kbd>x</kbd>,\n                  },\n                  {\n                    action: t`Close post or dialogs`,\n                    keys: (\n                      <Trans>\n                        <kbd>Esc</kbd> or <kbd>Backspace</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Focus column in multi-column mode`,\n                    keys: (\n                      <Trans>\n                        <kbd>1</kbd> to <kbd>9</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Focus next column in multi-column mode`,\n                    keys: <kbd>]</kbd>,\n                  },\n                  {\n                    action: t`Focus previous column in multi-column mode`,\n                    keys: <kbd>[</kbd>,\n                  },\n                  {\n                    action: t`Compose new post`,\n                    keys: <kbd>c</kbd>,\n                  },\n                  {\n                    action: t`Compose new post (new window)`,\n                    className: 'insignificant',\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>c</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Send post`,\n                    keys: (\n                      <Trans>\n                        <kbd>Ctrl</kbd> + <kbd>Enter</kbd> or <kbd></kbd> +{' '}\n                        <kbd>Enter</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Search`,\n                    keys: <kbd>/</kbd>,\n                  },\n                  {\n                    action: t`Reply`,\n                    keys: <kbd>r</kbd>,\n                  },\n                  {\n                    action: t`Reply (new window)`,\n                    className: 'insignificant',\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>r</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Like (favourite)`,\n                    keys: (\n                      <Trans>\n                        <kbd>l</kbd> or <kbd>f</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Boost`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>b</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Quote`,\n                    keys: <kbd>q</kbd>,\n                  },\n                  {\n                    action: t`Bookmark`,\n                    keys: <kbd>d</kbd>,\n                  },\n                  {\n                    action: t`Toggle Cloak mode`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>Alt</kbd> + <kbd>k</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Go to Home`,\n                    keys: <SequentialKeys key1=\"g\" key2=\"h\" />,\n                  },\n                  {\n                    action: t`Go to Notifications`,\n                    keys: <SequentialKeys key1=\"g\" key2=\"n\" />,\n                  },\n                ].map(({ action, className, keys }) => (\n                  <tr key={action}>\n                    <th class={className}>{action}</th>\n                    <td>{keys}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </main>\n        </div>\n      </Modal>\n    )\n  );\n});\n","/**\n * A set of all the parents currently being observe. This is the only non weak\n * registry.\n */\nconst parents = new Set();\n/**\n * Element coordinates that is constantly kept up to date.\n */\nconst coords = new WeakMap();\n/**\n * Siblings of elements that have been removed from the dom.\n */\nconst siblings = new WeakMap();\n/**\n * Animations that are currently running.\n */\nconst animations = new WeakMap();\n/**\n * A map of existing intersection observers used to track element movements.\n */\nconst intersections = new WeakMap();\n/**\n * A map of existing mutation observers used to track element movements.\n */\nconst mutationObservers = new WeakMap();\n/**\n * Intervals for automatically checking the position of elements occasionally.\n */\nconst intervals = new WeakMap();\n/**\n * The configuration options for each group of elements.\n */\nconst options = new WeakMap();\n/**\n * Debounce counters by id, used to debounce calls to update positions.\n */\nconst debounces = new WeakMap();\n/**\n * All parents that are currently enabled are tracked here.\n */\nconst enabled = new WeakSet();\n/**\n * The document used to calculate transitions.\n */\nlet root;\n/**\n * The roots XY scroll positions.\n */\nlet scrollX = 0;\nlet scrollY = 0;\n/**\n * Used to sign an element as the target.\n */\nconst TGT = \"__aa_tgt\";\n/**\n * Used to sign an element as being part of a removal.\n */\nconst DEL = \"__aa_del\";\n/**\n * Used to sign an element as being \"new\". When an element is removed from the\n * dom, but may cycle back in we can sign it with new to ensure the next time\n * it is recognized we consider it new.\n */\nconst NEW = \"__aa_new\";\n/**\n * Callback for handling all mutations.\n * @param mutations - A mutation list\n */\nconst handleMutations = (mutations) => {\n    const elements = getElements(mutations);\n    // If elements is \"false\" that means this mutation that should be ignored.\n    if (elements) {\n        elements.forEach((el) => animate(el));\n    }\n};\n/**\n *\n * @param entries - Elements that have been resized.\n */\nconst handleResizes = (entries) => {\n    entries.forEach((entry) => {\n        if (entry.target === root)\n            updateAllPos();\n        if (coords.has(entry.target))\n            updatePos(entry.target);\n    });\n};\n/**\n * Determine if an element is fully outside of the current viewport.\n * @param el - Element to test\n */\nfunction isOffscreen(el) {\n    const rect = el.getBoundingClientRect();\n    const vw = (root === null || root === void 0 ? void 0 : root.clientWidth) || 0;\n    const vh = (root === null || root === void 0 ? void 0 : root.clientHeight) || 0;\n    return rect.bottom < 0 || rect.top > vh || rect.right < 0 || rect.left > vw;\n}\n/**\n * Observe this elements position.\n * @param el - The element to observe the position of.\n */\nfunction observePosition(el) {\n    const oldObserver = intersections.get(el);\n    oldObserver === null || oldObserver === void 0 ? void 0 : oldObserver.disconnect();\n    let rect = coords.get(el);\n    let invocations = 0;\n    const buffer = 5;\n    if (!rect) {\n        rect = getCoords(el);\n        coords.set(el, rect);\n    }\n    const { offsetWidth, offsetHeight } = root;\n    const rootMargins = [\n        rect.top - buffer,\n        offsetWidth - (rect.left + buffer + rect.width),\n        offsetHeight - (rect.top + buffer + rect.height),\n        rect.left - buffer,\n    ];\n    const rootMargin = rootMargins\n        .map((px) => `${ -1 * Math.floor(px)}px`)\n        .join(\" \");\n    const observer = new IntersectionObserver(() => {\n        ++invocations > 1 && updatePos(el);\n    }, {\n        root,\n        threshold: 1,\n        rootMargin,\n    });\n    observer.observe(el);\n    intersections.set(el, observer);\n}\n/**\n * Update the exact position of a given element.\n * @param el - An element to update the position of.\n * @param debounce - Whether or not to debounce the update. After an animation is finished, it should update as soon as possible to prevent flickering on quick toggles.\n */\nfunction updatePos(el, debounce = true) {\n    clearTimeout(debounces.get(el));\n    const optionsOrPlugin = getOptions(el);\n    const delay = debounce\n        ? isPlugin(optionsOrPlugin)\n            ? 500\n            : optionsOrPlugin.duration\n        : 0;\n    debounces.set(el, setTimeout(async () => {\n        const currentAnimation = animations.get(el);\n        try {\n            await (currentAnimation === null || currentAnimation === void 0 ? void 0 : currentAnimation.finished);\n            coords.set(el, getCoords(el));\n            observePosition(el);\n        }\n        catch {\n            // ignore errors as the `.finished` promise is rejected when animations were cancelled\n        }\n    }, delay));\n}\n/**\n * Updates all positions that are currently being tracked.\n */\nfunction updateAllPos() {\n    clearTimeout(debounces.get(root));\n    debounces.set(root, setTimeout(() => {\n        parents.forEach((parent) => forEach(parent, (el) => lowPriority(() => updatePos(el))));\n    }, 100));\n}\n/**\n * Its possible for a quick scroll or other fast events to get past the\n * intersection observer, so occasionally we need want \"cold-poll\" for the\n * latests and greatest position. We try to do this in the most non-disruptive\n * fashion possible. First we only do this ever couple seconds, staggard by a\n * random offset.\n * @param el - Element\n */\nfunction poll(el) {\n    setTimeout(() => {\n        intervals.set(el, setInterval(() => lowPriority(updatePos.bind(null, el)), 2000));\n    }, Math.round(2000 * Math.random()));\n}\n/**\n * Perform some operation that is non critical at some point.\n * @param callback\n */\nfunction lowPriority(callback) {\n    if (typeof requestIdleCallback === \"function\") {\n        requestIdleCallback(() => callback());\n    }\n    else {\n        requestAnimationFrame(() => callback());\n    }\n}\n/**\n * A resize observer, responsible for recalculating elements on resize.\n */\nlet resize;\n/**\n * Ensure the browser is supported.\n */\nconst supportedBrowser = typeof window !== \"undefined\" && \"ResizeObserver\" in window;\n/**\n * If this is in a browser, initialize our Web APIs\n */\nif (supportedBrowser) {\n    root = document.documentElement;\n    new MutationObserver(handleMutations);\n    resize = new ResizeObserver(handleResizes);\n    window.addEventListener(\"scroll\", () => {\n        scrollY = window.scrollY;\n        scrollX = window.scrollX;\n    });\n    resize.observe(root);\n}\n/**\n * Retrieves all the elements that may have been affected by the last mutation\n * including ones that have been removed and are no longer in the DOM.\n * @param mutations - A mutation list.\n * @returns\n */\nfunction getElements(mutations) {\n    const observedNodes = mutations.reduce((nodes, mutation) => {\n        return [\n            ...nodes,\n            ...Array.from(mutation.addedNodes),\n            ...Array.from(mutation.removedNodes),\n        ];\n    }, []);\n    // Short circuit if _only_ comment nodes are observed\n    const onlyCommentNodesObserved = observedNodes.every((node) => node.nodeName === \"#comment\");\n    if (onlyCommentNodesObserved)\n        return false;\n    return mutations.reduce((elements, mutation) => {\n        // Short circuit if we find a purposefully deleted node.\n        if (elements === false)\n            return false;\n        if (mutation.target instanceof Element) {\n            target(mutation.target);\n            if (!elements.has(mutation.target)) {\n                elements.add(mutation.target);\n                for (let i = 0; i < mutation.target.children.length; i++) {\n                    const child = mutation.target.children.item(i);\n                    if (!child)\n                        continue;\n                    if (DEL in child) {\n                        return false;\n                    }\n                    target(mutation.target, child);\n                    elements.add(child);\n                }\n            }\n            if (mutation.removedNodes.length) {\n                for (let i = 0; i < mutation.removedNodes.length; i++) {\n                    const child = mutation.removedNodes[i];\n                    if (DEL in child) {\n                        return false;\n                    }\n                    if (child instanceof Element) {\n                        elements.add(child);\n                        target(mutation.target, child);\n                        siblings.set(child, [\n                            mutation.previousSibling,\n                            mutation.nextSibling,\n                        ]);\n                    }\n                }\n            }\n        }\n        return elements;\n    }, new Set());\n}\n/**\n * Assign the target to an element.\n * @param el - The root element\n * @param child\n */\nfunction target(el, child) {\n    if (!child && !(TGT in el))\n        Object.defineProperty(el, TGT, { value: el });\n    else if (child && !(TGT in child))\n        Object.defineProperty(child, TGT, { value: el });\n}\n/**\n * Determines what kind of change took place on the given element and then\n * performs the proper animation based on that.\n * @param el - The specific element to animate.\n */\nfunction animate(el) {\n    var _a, _b;\n    const isMounted = el.isConnected;\n    const preExisting = coords.has(el);\n    if (isMounted && siblings.has(el))\n        siblings.delete(el);\n    if (((_a = animations.get(el)) === null || _a === void 0 ? void 0 : _a.playState) !== \"finished\") {\n        (_b = animations.get(el)) === null || _b === void 0 ? void 0 : _b.cancel();\n    }\n    if (NEW in el) {\n        add(el);\n    }\n    else if (preExisting && isMounted) {\n        remain(el);\n    }\n    else if (preExisting && !isMounted) {\n        remove(el);\n    }\n    else {\n        add(el);\n    }\n}\n/**\n * Removes all non-digits from a string and casts to a number.\n * @param str - A string containing a pixel value.\n * @returns\n */\nfunction raw(str) {\n    return Number(str.replace(/[^0-9.\\-]/g, \"\"));\n}\n/**\n * Get the scroll offset of elements\n * @param el - Element\n * @returns\n */\nfunction getScrollOffset(el) {\n    let p = el.parentElement;\n    while (p) {\n        if (p.scrollLeft || p.scrollTop) {\n            return { x: p.scrollLeft, y: p.scrollTop };\n        }\n        p = p.parentElement;\n    }\n    return { x: 0, y: 0 };\n}\n/**\n * Get the coordinates of elements adjusted for scroll position.\n * @param el - Element\n * @returns\n */\nfunction getCoords(el) {\n    const rect = el.getBoundingClientRect();\n    const { x, y } = getScrollOffset(el);\n    return {\n        top: rect.top + y,\n        left: rect.left + x,\n        width: rect.width,\n        height: rect.height,\n    };\n}\n/**\n * Returns the width/height that the element should be transitioned between.\n * This takes into account box-sizing.\n * @param el - Element being animated\n * @param oldCoords - Old set of Coordinates coordinates\n * @param newCoords - New set of Coordinates coordinates\n * @returns\n */\nfunction getTransitionSizes(el, oldCoords, newCoords) {\n    let widthFrom = oldCoords.width;\n    let heightFrom = oldCoords.height;\n    let widthTo = newCoords.width;\n    let heightTo = newCoords.height;\n    const styles = getComputedStyle(el);\n    const sizing = styles.getPropertyValue(\"box-sizing\");\n    if (sizing === \"content-box\") {\n        const paddingY = raw(styles.paddingTop) +\n            raw(styles.paddingBottom) +\n            raw(styles.borderTopWidth) +\n            raw(styles.borderBottomWidth);\n        const paddingX = raw(styles.paddingLeft) +\n            raw(styles.paddingRight) +\n            raw(styles.borderRightWidth) +\n            raw(styles.borderLeftWidth);\n        widthFrom -= paddingX;\n        widthTo -= paddingX;\n        heightFrom -= paddingY;\n        heightTo -= paddingY;\n    }\n    return [widthFrom, widthTo, heightFrom, heightTo].map(Math.round);\n}\n/**\n * Retrieves animation options for the current element.\n * @param el - Element to retrieve options for.\n * @returns\n */\nfunction getOptions(el) {\n    return TGT in el && options.has(el[TGT])\n        ? options.get(el[TGT])\n        : { duration: 250, easing: \"ease-in-out\" };\n}\n/**\n * Returns the target of a given animation (generally the parent).\n * @param el - An element to check for a target\n * @returns\n */\nfunction getTarget(el) {\n    if (TGT in el)\n        return el[TGT];\n    return undefined;\n}\n/**\n * Checks if animations are enabled or disabled for a given element.\n * @param el - Any element\n * @returns\n */\nfunction isEnabled(el) {\n    const target = getTarget(el);\n    return target ? enabled.has(target) : false;\n}\n/**\n * Iterate over the children of a given parent.\n * @param parent - A parent element\n * @param callback - A callback\n */\nfunction forEach(parent, ...callbacks) {\n    callbacks.forEach((callback) => callback(parent, options.has(parent)));\n    for (let i = 0; i < parent.children.length; i++) {\n        const child = parent.children.item(i);\n        if (child) {\n            callbacks.forEach((callback) => callback(child, options.has(child)));\n        }\n    }\n}\n/**\n * Always return tuple to provide consistent interface\n */\nfunction getPluginTuple(pluginReturn) {\n    if (Array.isArray(pluginReturn))\n        return pluginReturn;\n    return [pluginReturn];\n}\n/**\n * Determine if config is plugin\n */\nfunction isPlugin(config) {\n    return typeof config === \"function\";\n}\n/**\n * The element in question is remaining in the DOM.\n * @param el - Element to flip\n * @returns\n */\nfunction remain(el) {\n    const oldCoords = coords.get(el);\n    const newCoords = getCoords(el);\n    if (!isEnabled(el))\n        return coords.set(el, newCoords);\n    if (isOffscreen(el)) {\n        // When element is offscreen, skip FLIP to avoid broken transforms\n        coords.set(el, newCoords);\n        observePosition(el);\n        return;\n    }\n    let animation;\n    if (!oldCoords)\n        return;\n    const pluginOrOptions = getOptions(el);\n    if (typeof pluginOrOptions !== \"function\") {\n        let deltaLeft = oldCoords.left - newCoords.left;\n        let deltaTop = oldCoords.top - newCoords.top;\n        const deltaRight = oldCoords.left + oldCoords.width - (newCoords.left + newCoords.width);\n        const deltaBottom = oldCoords.top + oldCoords.height - (newCoords.top + newCoords.height);\n        // element is probably anchored and doesn't need to be offset\n        if (deltaBottom == 0)\n            deltaTop = 0;\n        if (deltaRight == 0)\n            deltaLeft = 0;\n        const [widthFrom, widthTo, heightFrom, heightTo] = getTransitionSizes(el, oldCoords, newCoords);\n        const start = {\n            transform: `translate(${deltaLeft}px, ${deltaTop}px)`,\n        };\n        const end = {\n            transform: `translate(0, 0)`,\n        };\n        if (widthFrom !== widthTo) {\n            start.width = `${widthFrom}px`;\n            end.width = `${widthTo}px`;\n        }\n        if (heightFrom !== heightTo) {\n            start.height = `${heightFrom}px`;\n            end.height = `${heightTo}px`;\n        }\n        animation = el.animate([start, end], {\n            duration: pluginOrOptions.duration,\n            easing: pluginOrOptions.easing,\n        });\n    }\n    else {\n        const [keyframes] = getPluginTuple(pluginOrOptions(el, \"remain\", oldCoords, newCoords));\n        animation = new Animation(keyframes);\n        animation.play();\n    }\n    animations.set(el, animation);\n    coords.set(el, newCoords);\n    animation.addEventListener(\"finish\", updatePos.bind(null, el, false), {\n        once: true,\n    });\n}\n/**\n * Adds the element with a transition.\n * @param el - Animates the element being added.\n */\nfunction add(el) {\n    if (NEW in el)\n        delete el[NEW];\n    const newCoords = getCoords(el);\n    coords.set(el, newCoords);\n    const pluginOrOptions = getOptions(el);\n    if (!isEnabled(el))\n        return;\n    if (isOffscreen(el)) {\n        // Skip entry animation if element is not visible in viewport\n        observePosition(el);\n        return;\n    }\n    let animation;\n    if (typeof pluginOrOptions !== \"function\") {\n        animation = el.animate([\n            { transform: \"scale(.98)\", opacity: 0 },\n            { transform: \"scale(0.98)\", opacity: 0, offset: 0.5 },\n            { transform: \"scale(1)\", opacity: 1 },\n        ], {\n            duration: pluginOrOptions.duration * 1.5,\n            easing: \"ease-in\",\n        });\n    }\n    else {\n        const [keyframes] = getPluginTuple(pluginOrOptions(el, \"add\", newCoords));\n        animation = new Animation(keyframes);\n        animation.play();\n    }\n    animations.set(el, animation);\n    animation.addEventListener(\"finish\", updatePos.bind(null, el, false), {\n        once: true,\n    });\n}\n/**\n * Clean up after removing an element from the dom.\n * @param el - Element being removed\n * @param styles - Optional styles that should be removed from the element.\n */\nfunction cleanUp(el, styles) {\n    var _a;\n    el.remove();\n    coords.delete(el);\n    siblings.delete(el);\n    animations.delete(el);\n    (_a = intersections.get(el)) === null || _a === void 0 ? void 0 : _a.disconnect();\n    setTimeout(() => {\n        if (DEL in el)\n            delete el[DEL];\n        Object.defineProperty(el, NEW, { value: true, configurable: true });\n        if (styles && el instanceof HTMLElement) {\n            for (const style in styles) {\n                el.style[style] = \"\";\n            }\n        }\n    }, 0);\n}\n/**\n * Animates the removal of an element.\n * @param el - Element to remove\n */\nfunction remove(el) {\n    var _a;\n    if (!siblings.has(el) || !coords.has(el))\n        return;\n    const [prev, next] = siblings.get(el);\n    Object.defineProperty(el, DEL, { value: true, configurable: true });\n    const finalX = window.scrollX;\n    const finalY = window.scrollY;\n    if (next &&\n        next.parentNode &&\n        next.parentNode instanceof Element) {\n        next.parentNode.insertBefore(el, next);\n    }\n    else if (prev && prev.parentNode) {\n        prev.parentNode.appendChild(el);\n    }\n    else {\n        (_a = getTarget(el)) === null || _a === void 0 ? void 0 : _a.appendChild(el);\n    }\n    if (!isEnabled(el))\n        return cleanUp(el);\n    const [top, left, width, height] = deletePosition(el);\n    const optionsOrPlugin = getOptions(el);\n    const oldCoords = coords.get(el);\n    if (finalX !== scrollX || finalY !== scrollY) {\n        adjustScroll(el, finalX, finalY, optionsOrPlugin);\n    }\n    let animation;\n    let styleReset = {\n        position: \"absolute\",\n        top: `${top}px`,\n        left: `${left}px`,\n        width: `${width}px`,\n        height: `${height}px`,\n        margin: \"0\",\n        pointerEvents: \"none\",\n        transformOrigin: \"center\",\n        zIndex: \"100\",\n    };\n    if (!isPlugin(optionsOrPlugin)) {\n        Object.assign(el.style, styleReset);\n        animation = el.animate([\n            {\n                transform: \"scale(1)\",\n                opacity: 1,\n            },\n            {\n                transform: \"scale(.98)\",\n                opacity: 0,\n            },\n        ], {\n            duration: optionsOrPlugin.duration,\n            easing: \"ease-out\",\n        });\n    }\n    else {\n        const [keyframes, options] = getPluginTuple(optionsOrPlugin(el, \"remove\", oldCoords));\n        if ((options === null || options === void 0 ? void 0 : options.styleReset) !== false) {\n            styleReset =\n                (options === null || options === void 0 ? void 0 : options.styleReset) ||\n                    styleReset;\n            Object.assign(el.style, styleReset);\n        }\n        animation = new Animation(keyframes);\n        animation.play();\n    }\n    animations.set(el, animation);\n    animation.addEventListener(\"finish\", () => cleanUp(el, styleReset), {\n        once: true,\n    });\n}\n/**\n * If the element being removed is at the very bottom of the page, and the\n * the page was scrolled into a space being \"made available\" by the element\n * that was removed, the page scroll will have jumped up some amount. We need\n * to offset the jump by the amount that the page was \"automatically\" scrolled\n * up. We can do this by comparing the scroll position before and after the\n * element was removed, and then offsetting by that amount.\n *\n * @param el - The element being deleted\n * @param finalX - The final X scroll position\n * @param finalY - The final Y scroll position\n * @param optionsOrPlugin - The options or plugin\n * @returns\n */\nfunction adjustScroll(el, finalX, finalY, optionsOrPlugin) {\n    const scrollDeltaX = scrollX - finalX;\n    const scrollDeltaY = scrollY - finalY;\n    const scrollBefore = document.documentElement.style.scrollBehavior;\n    const scrollBehavior = getComputedStyle(root).scrollBehavior;\n    if (scrollBehavior === \"smooth\") {\n        document.documentElement.style.scrollBehavior = \"auto\";\n    }\n    window.scrollTo(window.scrollX + scrollDeltaX, window.scrollY + scrollDeltaY);\n    if (!el.parentElement)\n        return;\n    const parent = el.parentElement;\n    let lastHeight = parent.clientHeight;\n    let lastWidth = parent.clientWidth;\n    const startScroll = performance.now();\n    // Here we use a manual scroll animation to keep the element using the same\n    // easing and timing as the parents scroll animation.\n    function smoothScroll() {\n        requestAnimationFrame(() => {\n            if (!isPlugin(optionsOrPlugin)) {\n                const deltaY = lastHeight - parent.clientHeight;\n                const deltaX = lastWidth - parent.clientWidth;\n                if (startScroll + optionsOrPlugin.duration >\n                    performance.now()) {\n                    window.scrollTo({\n                        left: window.scrollX - deltaX,\n                        top: window.scrollY - deltaY,\n                    });\n                    lastHeight = parent.clientHeight;\n                    lastWidth = parent.clientWidth;\n                    smoothScroll();\n                }\n                else {\n                    document.documentElement.style.scrollBehavior = scrollBefore;\n                }\n            }\n        });\n    }\n    smoothScroll();\n}\n/**\n * Determines the position of the element being removed.\n * @param el - The element being deleted\n * @returns\n */\nfunction deletePosition(el) {\n    var _a;\n    const oldCoords = coords.get(el);\n    const [width, , height] = getTransitionSizes(el, oldCoords, getCoords(el));\n    let offsetParent = el.parentElement;\n    while (offsetParent &&\n        (getComputedStyle(offsetParent).position === \"static\" ||\n            offsetParent instanceof HTMLBodyElement)) {\n        offsetParent = offsetParent.parentElement;\n    }\n    if (!offsetParent)\n        offsetParent = document.body;\n    const parentStyles = getComputedStyle(offsetParent);\n    const parentCoords = !animations.has(el) || ((_a = animations.get(el)) === null || _a === void 0 ? void 0 : _a.playState) === \"finished\"\n        ? getCoords(offsetParent)\n        : coords.get(offsetParent);\n    const top = Math.round(oldCoords.top - parentCoords.top) -\n        raw(parentStyles.borderTopWidth);\n    const left = Math.round(oldCoords.left - parentCoords.left) -\n        raw(parentStyles.borderLeftWidth);\n    return [top, left, width, height];\n}\n/**\n * A function that automatically adds animation effects to itself and its\n * immediate children. Specifically it adds effects for adding, moving, and\n * removing DOM elements.\n * @param el - A parent element to add animations to.\n * @param options - An optional object of options.\n */\nfunction autoAnimate(el, config = {}) {\n    if (supportedBrowser && resize) {\n        const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\n        const isDisabledDueToReduceMotion = mediaQuery.matches &&\n            !isPlugin(config) &&\n            !config.disrespectUserMotionPreference;\n        if (!isDisabledDueToReduceMotion) {\n            enabled.add(el);\n            if (getComputedStyle(el).position === \"static\") {\n                Object.assign(el.style, { position: \"relative\" });\n            }\n            forEach(el, updatePos, poll, (element) => resize === null || resize === void 0 ? void 0 : resize.observe(element));\n            if (isPlugin(config)) {\n                options.set(el, config);\n            }\n            else {\n                options.set(el, {\n                    duration: 250,\n                    easing: \"ease-in-out\",\n                    ...config,\n                });\n            }\n            const mo = new MutationObserver(handleMutations);\n            mo.observe(el, { childList: true });\n            mutationObservers.set(el, mo);\n            parents.add(el);\n        }\n    }\n    const controller = Object.freeze({\n        parent: el,\n        enable: () => {\n            enabled.add(el);\n        },\n        disable: () => {\n            enabled.delete(el);\n            // Cancel any in-flight animations and pending timers for immediate effect\n            forEach(el, (node) => {\n                const a = animations.get(node);\n                try {\n                    a === null || a === void 0 ? void 0 : a.cancel();\n                }\n                catch { }\n                animations.delete(node);\n                const d = debounces.get(node);\n                if (d)\n                    clearTimeout(d);\n                debounces.delete(node);\n                const i = intervals.get(node);\n                if (i)\n                    clearInterval(i);\n                intervals.delete(node);\n            });\n        },\n        isEnabled: () => enabled.has(el),\n        destroy: () => {\n            enabled.delete(el);\n            parents.delete(el);\n            options.delete(el);\n            const mo = mutationObservers.get(el);\n            mo === null || mo === void 0 ? void 0 : mo.disconnect();\n            mutationObservers.delete(el);\n            forEach(el, (node) => {\n                // unobserve resize\n                resize === null || resize === void 0 ? void 0 : resize.unobserve(node);\n                // cancel animations\n                const a = animations.get(node);\n                try {\n                    a === null || a === void 0 ? void 0 : a.cancel();\n                }\n                catch { }\n                animations.delete(node);\n                // disconnect observers\n                const io = intersections.get(node);\n                io === null || io === void 0 ? void 0 : io.disconnect();\n                intersections.delete(node);\n                // clear intervals and debounces\n                const i = intervals.get(node);\n                if (i)\n                    clearInterval(i);\n                intervals.delete(node);\n                const d = debounces.get(node);\n                if (d)\n                    clearTimeout(d);\n                debounces.delete(node);\n                // clear state\n                coords.delete(node);\n                siblings.delete(node);\n            });\n        },\n    });\n    return controller;\n}\n/**\n * The vue directive.\n */\nconst vAutoAnimate = {\n    mounted: (el, binding) => {\n        const ctl = autoAnimate(el, binding.value || {});\n        Object.defineProperty(el, \"__aa_ctl\", { value: ctl, configurable: true });\n    },\n    unmounted: (el) => {\n        var _a;\n        const ctl = el[\"__aa_ctl\"];\n        (_a = ctl === null || ctl === void 0 ? void 0 : ctl.destroy) === null || _a === void 0 ? void 0 : _a.call(ctl);\n        try {\n            delete el[\"__aa_ctl\"];\n        }\n        catch { }\n    },\n    getSSRProps: () => ({}),\n};\n\nexport { autoAnimate, autoAnimate as default, getTransitionSizes, vAutoAnimate };\n","import { useRef, useState, useEffect } from 'preact/hooks';\nimport autoAnimate from '../index.mjs';\n\n/**\n * AutoAnimate hook for adding dead-simple transitions and animations to preact.\n * @param options - Auto animate options or a plugin\n * @returns\n */\nfunction useAutoAnimate(options) {\n    const element = useRef(null);\n    const [controller, setController] = useState();\n    const setEnabled = (enabled) => {\n        if (controller) {\n            enabled ? controller.enable() : controller.disable();\n        }\n    };\n    useEffect(() => {\n        if (element.current instanceof HTMLElement)\n            setController(autoAnimate(element.current, options || {}));\n    }, []);\n    useEffect(() => {\n        return () => {\n            var _a;\n            (_a = controller === null || controller === void 0 ? void 0 : controller.destroy) === null || _a === void 0 ? void 0 : _a.call(controller);\n        };\n    }, [controller]);\n    return [element, setEnabled];\n}\n\nexport { useAutoAnimate };\n","function dec2hex(dec) {\n  return ('0' + dec.toString(16)).slice(-2);\n}\nexport function verifier() {\n  var array = new Uint32Array(56 / 2);\n  window.crypto.getRandomValues(array);\n  return Array.from(array, dec2hex).join('');\n}\nfunction sha256(plain) {\n  // returns promise ArrayBuffer\n  const encoder = new TextEncoder();\n  const data = encoder.encode(plain);\n  return window.crypto.subtle.digest('SHA-256', data);\n}\nfunction base64urlencode(a) {\n  let str = '';\n  const bytes = new Uint8Array(a);\n  const len = bytes.byteLength;\n  for (var i = 0; i < len; i++) {\n    str += String.fromCharCode(bytes[i]);\n  }\n  return btoa(str).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n}\nexport async function generateCodeChallenge(v) {\n  const hashed = await sha256(v);\n  return base64urlencode(hashed);\n}\n\n// If /.well-known/oauth-authorization-server exists and code_challenge_methods_supported includes \"S256\", means support PKCE\nexport async function supportsPKCE({ instanceURL }) {\n  if (!instanceURL) return false;\n  try {\n    const res = await fetch(\n      `https://${instanceURL}/.well-known/oauth-authorization-server`,\n    );\n    if (!res.ok || res.status !== 200) return false;\n    const json = await res.json();\n    if (json.code_challenge_methods_supported?.includes('S256')) return true;\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\n// For debugging\nwindow.__generateCodeChallenge = generateCodeChallenge;\n","import { generateCodeChallenge, verifier } from './oauth-pkce';\n\nconst {\n  DEV,\n  PHANPY_CLIENT_NAME: CLIENT_NAME,\n  PHANPY_WEBSITE: WEBSITE,\n} = import.meta.env;\n\nconst SCOPES = 'read write follow push';\n\n/*\n  PHANPY_WEBSITE is set to the default official site.\n  It's used in pre-built releases, so there's no way to change it dynamically\n  without rebuilding.\n  Therefore, we can't use it as redirect_uri.\n  We only use PHANPY_WEBSITE if it's \"same\" as current location URL.\n  \n  Very basic check based on location.hostname for now\n*/\nconst sameSite = WEBSITE\n  ? WEBSITE.toLowerCase().includes(location.hostname)\n  : false;\nconst currentLocation = location.origin + location.pathname;\nconst REDIRECT_URI = DEV || !sameSite ? currentLocation : WEBSITE;\n\nexport async function registerApplication({ instanceURL }) {\n  const registrationParams = new URLSearchParams({\n    client_name: CLIENT_NAME,\n    redirect_uris: REDIRECT_URI,\n    scopes: SCOPES,\n    website: WEBSITE,\n  });\n  const registrationResponse = await fetch(\n    `https://${instanceURL}/api/v1/apps`,\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: registrationParams.toString(),\n    },\n  );\n  const registrationJSON = await registrationResponse.json();\n  console.log({ registrationJSON });\n  return registrationJSON;\n}\n\nexport async function getPKCEAuthorizationURL({\n  instanceURL,\n  client_id,\n  forceLogin = false,\n}) {\n  const codeVerifier = verifier();\n  const codeChallenge = await generateCodeChallenge(codeVerifier);\n  const params = new URLSearchParams({\n    client_id,\n    code_challenge_method: 'S256',\n    code_challenge: codeChallenge,\n    redirect_uri: REDIRECT_URI,\n    response_type: 'code',\n    scope: SCOPES,\n  });\n  if (forceLogin) params.append('force_login', true);\n  const authorizationURL = `https://${instanceURL}/oauth/authorize?${params.toString()}`;\n  return [authorizationURL, codeVerifier];\n}\n\nexport async function getAuthorizationURL({\n  instanceURL,\n  client_id,\n  forceLogin = false,\n}) {\n  const authorizationParams = new URLSearchParams({\n    client_id,\n    scope: SCOPES,\n    redirect_uri: REDIRECT_URI,\n    // redirect_uri: 'urn:ietf:wg:oauth:2.0:oob',\n    response_type: 'code',\n  });\n  if (forceLogin) authorizationParams.append('force_login', true);\n  const authorizationURL = `https://${instanceURL}/oauth/authorize?${authorizationParams.toString()}`;\n  return authorizationURL;\n}\n\nexport async function getAccessToken({\n  instanceURL,\n  client_id,\n  client_secret,\n  code,\n  code_verifier,\n}) {\n  const params = new URLSearchParams({\n    client_id,\n    redirect_uri: REDIRECT_URI,\n    grant_type: 'authorization_code',\n    code,\n    // scope: SCOPES, // Not needed\n    // client_secret,\n    // code_verifier,\n  });\n  if (client_secret) {\n    params.append('client_secret', client_secret);\n  }\n  if (code_verifier) {\n    params.append('code_verifier', code_verifier);\n  }\n  const tokenResponse = await fetch(`https://${instanceURL}/oauth/token`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    body: params.toString(),\n  });\n  const tokenJSON = await tokenResponse.json();\n  console.log({ tokenJSON });\n  return tokenJSON;\n}\n\nexport async function revokeAccessToken({\n  instanceURL,\n  client_id,\n  client_secret,\n  token,\n}) {\n  try {\n    const params = new URLSearchParams({\n      client_id,\n      client_secret,\n      token,\n    });\n\n    const revokeResponse = await fetch(`https://${instanceURL}/oauth/revoke`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params.toString(),\n      keepalive: true,\n    });\n\n    return revokeResponse.ok;\n  } catch (error) {\n    console.erro('Error revoking token', error);\n    return false;\n  }\n}\n","import './accounts.css';\n\nimport { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useReducer } from 'preact/hooks';\n\nimport Avatar from '../components/avatar';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport MenuConfirm from '../components/menu-confirm';\nimport MenuLink from '../components/menu-link';\nimport Menu2 from '../components/menu2';\nimport NameText from '../components/name-text';\nimport RelativeTime from '../components/relative-time';\nimport { api } from '../utils/api';\nimport { revokeAccessToken } from '../utils/auth';\nimport niceDateTime from '../utils/nice-date-time';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport {\n  getAccounts,\n  getCurrentAccountID,\n  saveAccounts,\n  setCurrentAccountID,\n} from '../utils/store-utils';\n\nconst isStandalone = window.matchMedia('(display-mode: standalone)').matches;\n\nfunction Accounts({ onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  // Accounts\n  const accounts = getAccounts();\n  const currentAccount = getCurrentAccountID();\n  const moreThanOneAccount = accounts.length > 1;\n\n  const [_, reload] = useReducer((x) => x + 1, 0);\n  const [accountsListParent] = useAutoAnimate();\n\n  return (\n    <div id=\"accounts-container\" class=\"sheet\" tabIndex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header class=\"header-grid\">\n        <h2>\n          <Trans>Accounts</Trans>\n        </h2>\n      </header>\n      <main>\n        <section>\n          <ul class=\"accounts-list\" ref={accountsListParent}>\n            {accounts.map((account, i) => {\n              const isCurrent = account.info.id === currentAccount;\n              const isDefault = i === 0; // first account is always default\n              const isLoggedOut = !account.accessToken;\n              return (\n                <li key={account.info.id}>\n                  <div>\n                    {moreThanOneAccount && (\n                      <span class={`current ${isCurrent ? 'is-current' : ''}`}>\n                        <Icon icon=\"check-circle\" alt={t`Current`} />\n                      </span>\n                    )}\n                    <Avatar\n                      url={account.info.avatarStatic}\n                      size=\"xxl\"\n                      onDblClick={async () => {\n                        if (isCurrent) {\n                          try {\n                            const info = await masto.v1.accounts\n                              .$select(account.info.id)\n                              .fetch();\n                            console.log('fetched account info', info);\n                            account.info = info;\n                            saveAccounts(accounts);\n                            reload();\n                          } catch (e) {}\n                        }\n                      }}\n                    />\n                    <NameText\n                      account={\n                        moreThanOneAccount\n                          ? {\n                              ...account.info,\n                              acct: /@/.test(account.info.acct)\n                                ? account.info.acct\n                                : `${account.info.acct}@${account.instanceURL}`,\n                            }\n                          : account.info\n                      }\n                      showAcct\n                      onClick={() => {\n                        if (isLoggedOut) {\n                          location.href = `/#/login?instance=${account.instanceURL}`;\n                          onClose();\n                        } else if (isCurrent) {\n                          states.showAccount = `${account.info.username}@${account.instanceURL}`;\n                        } else {\n                          setCurrentAccountID(account.info.id);\n                          location.reload();\n                        }\n                      }}\n                    />\n                  </div>\n                  <div class=\"actions\">\n                    {isLoggedOut && (\n                      <span class=\"tag\">\n                        <Trans>Logged out</Trans>\n                      </span>\n                    )}\n                    {isDefault && moreThanOneAccount && (\n                      <>\n                        <span class=\"tag\">\n                          <Trans>Default</Trans>\n                        </span>{' '}\n                      </>\n                    )}\n                    <Menu2\n                      align=\"end\"\n                      menuButton={\n                        <button type=\"button\" class=\"plain more-button\">\n                          <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n                        </button>\n                      }\n                    >\n                      {moreThanOneAccount && (\n                        <>\n                          <MenuItem\n                            disabled={isCurrent || isLoggedOut}\n                            onClick={() => {\n                              setCurrentAccountID(account.info.id);\n                              location.reload();\n                            }}\n                          >\n                            <Icon icon=\"transfer\" />{' '}\n                            <Trans>Switch to this account</Trans>\n                          </MenuItem>\n                          {!isStandalone && !isCurrent && !isLoggedOut && (\n                            <MenuLink\n                              href={`./?account=${account.info.id}`}\n                              target=\"_blank\"\n                            >\n                              <Icon icon=\"external\" />\n                              <span>\n                                <Trans>Switch in new tab/window</Trans>\n                              </span>\n                            </MenuLink>\n                          )}\n                          <MenuDivider />\n                        </>\n                      )}\n                      <MenuItem\n                        onClick={() => {\n                          states.showAccount = `${account.info.username}@${account.instanceURL}`;\n                        }}\n                      >\n                        <Icon icon=\"user\" />\n                        <span>\n                          <Trans>View profile</Trans>\n                        </span>\n                      </MenuItem>\n                      <MenuDivider />\n                      {moreThanOneAccount && (\n                        <>\n                          <MenuItem\n                            disabled={isDefault || isLoggedOut}\n                            onClick={() => {\n                              // Move account to the top of the list\n                              accounts.splice(i, 1);\n                              accounts.unshift(account);\n                              saveAccounts(accounts);\n                              reload();\n                            }}\n                          >\n                            <Icon icon=\"check-circle\" />\n                            <span>\n                              <Trans>Set as default</Trans>\n                            </span>\n                          </MenuItem>\n                          <MenuItem\n                            disabled={i <= 1}\n                            onClick={() => {\n                              // Move account one position up\n                              accounts.splice(i, 1);\n                              accounts.splice(i - 1, 0, account);\n                              saveAccounts(accounts);\n                              reload();\n                            }}\n                          >\n                            <Icon icon=\"arrow-up\" />\n                            <span>\n                              <Trans>Move up</Trans>\n                            </span>\n                          </MenuItem>\n                          <MenuItem\n                            disabled={i === 0 || i === accounts.length - 1}\n                            onClick={() => {\n                              // Move account one position down\n                              accounts.splice(i, 1);\n                              accounts.splice(i + 1, 0, account);\n                              saveAccounts(accounts);\n                              reload();\n                            }}\n                          >\n                            <Icon icon=\"arrow-down\" />\n                            <span>\n                              <Trans>Move down</Trans>\n                            </span>\n                          </MenuItem>\n                          <MenuDivider />\n                        </>\n                      )}\n                      <MenuConfirm\n                        subMenu\n                        confirmLabel={\n                          <>\n                            <Icon icon=\"exit\" />\n                            <span>\n                              <Trans>\n                                Log out{' '}\n                                <span class=\"bidi-isolate\">\n                                  @{account.info.acct}\n                                </span>\n                                ?\n                              </Trans>\n                            </span>\n                          </>\n                        }\n                        disabled={!isCurrent || isLoggedOut}\n                        menuItemClassName=\"danger\"\n                        onClick={async () => {\n                          // const yes = confirm('Log out?');\n                          // if (!yes) return;\n                          await revokeAccessToken({\n                            instanceURL: account.instanceURL,\n                            client_id: account.clientId,\n                            client_secret: account.clientSecret,\n                            token: account.accessToken,\n                          });\n                          accounts.splice(i, 1);\n                          saveAccounts(accounts);\n                          // location.reload();\n                          try {\n                            // Clean up session currentAccount if same as deleted\n                            if (\n                              store.session.get('currentAccount') ===\n                              account.info.id\n                            ) {\n                              store.session.del('currentAccount');\n                            }\n                          } catch (e) {}\n                          location.href = location.pathname || '/';\n                        }}\n                      >\n                        <Icon icon=\"exit\" />\n                        <span>\n                          <Trans>Log out</Trans>\n                        </span>\n                      </MenuConfirm>\n                      {!!account?.createdAt && (\n                        <div class=\"footer\">\n                          <Icon icon=\"account-add\" />\n                          <span>\n                            <Trans>\n                              Connected on {niceDateTime(account.createdAt)} (\n                              <RelativeTime datetime={account.createdAt} />)\n                            </Trans>\n                          </span>\n                        </div>\n                      )}\n                    </Menu2>\n                  </div>\n                </li>\n              );\n            })}\n          </ul>\n          <p>\n            <Link to=\"/login\" class=\"button plain2\" onClick={onClose}>\n              <Icon icon=\"plus\" />{' '}\n              <span>\n                <Trans>Add an existing account</Trans>\n              </span>\n            </Link>\n          </p>\n          {moreThanOneAccount && (\n            <p>\n              <small>\n                <Trans>\n                  Note: <i>Default</i> account will always be used for first\n                  load. Switched accounts will persist during the session.\n                </Trans>\n              </small>\n            </p>\n          )}\n          <p>\n            <button\n              type=\"button\"\n              class=\"light\"\n              onClick={() => (states.showImportExportAccounts = true)}\n            >\n              <Trans>Import/export</Trans>\n            </button>\n          </p>\n        </section>\n      </main>\n    </div>\n  );\n}\n\nexport default Accounts;\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e\"","import { useLingui } from '@lingui/react';\nimport { useMemo } from 'preact/hooks';\n\nimport { CATALOGS, DEFAULT_LANG, DEV_LOCALES, LOCALES } from '../locales';\nimport { activateLang } from '../utils/lang';\nimport localeCode2Text from '../utils/localeCode2Text';\nimport store from '../utils/store';\n\nconst regionMaps = {\n  'zh-CN': 'zh-Hans',\n  'zh-TW': 'zh-Hant',\n  'pt-BR': 'pt-BR',\n};\n\nexport default function LangSelector() {\n  const { i18n } = useLingui();\n\n  // Sorted on render, so the order won't suddenly change based on current locale\n  const populatedLocales = useMemo(() => {\n    return LOCALES.map((lang) => {\n      // Don't need regions for now, it makes text too noisy\n      // Wait till there's too many languages and there are regional clashes\n      const regionlessCode = regionMaps[lang] || lang.replace(/-[a-z]+$/i, '');\n\n      const native = localeCode2Text({\n        code: regionlessCode,\n        locale: lang,\n        fallback: CATALOGS.find((c) => c.code === lang)?.nativeName,\n      });\n\n      // Not used when rendering because it'll change based on current locale\n      // Only used for sorting on render\n      const _common = localeCode2Text({\n        code: regionlessCode,\n        locale: i18n.locale,\n        fallback: CATALOGS.find((c) => c.code === lang)?.name,\n      });\n\n      return {\n        code: lang,\n        regionlessCode,\n        _common,\n        native,\n      };\n    }).sort((a, b) => {\n      // Sort by common name\n      const order = a._common.localeCompare(b._common, i18n.locale);\n      if (order !== 0) return order;\n      // Sort by code (fallback)\n      if (a.code < b.code) return -1;\n      if (a.code > b.code) return 1;\n      return 0;\n    });\n  }, []);\n\n  return (\n    <label class=\"lang-selector\">\n      {' '}\n      <select\n        class=\"small\"\n        value={i18n.locale || DEFAULT_LANG}\n        onChange={(e) => {\n          store.local.set('lang', e.target.value);\n          activateLang(e.target.value);\n        }}\n      >\n        {populatedLocales.map(({ code, regionlessCode, native }) => {\n          // Common name changes based on current locale\n          const common = localeCode2Text({\n            code: regionlessCode,\n            locale: i18n.locale,\n            fallback: CATALOGS.find((c) => c.code === code)?.name,\n          });\n          const showCommon = !!common && common !== native;\n          return (\n            <option\n              value={code}\n              data-regionless-code={regionlessCode}\n              key={code}\n            >\n              {showCommon ? `${native} - ${common}` : native}\n            </option>\n          );\n        })}\n        {(import.meta.env.DEV || import.meta.env.PHANPY_SHOW_DEV_LOCALES) && (\n          <optgroup label=\" Development (<50% translated)\">\n            {DEV_LOCALES.map((code) => {\n              if (code === 'pseudo-LOCALE') {\n                return (\n                  <>\n                    <hr />\n                    <option value={code} key={code}>\n                      Pseudolocalization (test)\n                    </option>\n                  </>\n                );\n              }\n              const nativeName = CATALOGS.find(\n                (c) => c.code === code,\n              )?.nativeName;\n              const completion = CATALOGS.find(\n                (c) => c.code === code,\n              )?.completion;\n              return (\n                <option value={code} key={code}>\n                  {nativeName || code} &lrm;[{completion}%]\n                </option>\n              );\n            })}\n          </optgroup>\n        )}\n      </select>\n    </label>\n  );\n}\n","// Utils for push notifications\nimport { api } from './api';\nimport { getVapidKey } from './store-utils';\n\n// Subscription is an object with the following structure:\n// {\n//   data: {\n//     alerts: {\n//       admin: {\n//         report: boolean,\n//         signUp: boolean,\n//       },\n//       favourite: boolean,\n//       follow: boolean,\n//       mention: boolean,\n//       poll: boolean,\n//       reblog: boolean,\n//       status: boolean,\n//       update: boolean,\n//     }\n//   },\n//   policy: \"all\" | \"followed\" | \"follower\" | \"none\",\n//   subscription: {\n//     endpoint: string,\n//     keys: {\n//       auth: string,\n//       p256dh: string,\n//     },\n//   },\n// }\n\n// Back-end CRUD\n// =============\n\nfunction createBackendPushSubscription(subscription) {\n  const { masto } = api();\n  return masto.v1.push.subscription.create(subscription);\n}\n\nfunction fetchBackendPushSubscription() {\n  const { masto } = api();\n  return masto.v1.push.subscription.fetch();\n}\n\nfunction updateBackendPushSubscription(subscription) {\n  const { masto } = api();\n  return masto.v1.push.subscription.update(subscription);\n}\n\nfunction removeBackendPushSubscription() {\n  const { masto } = api();\n  return masto.v1.push.subscription.remove();\n}\n\n// Front-end\n// =========\n\nexport function isPushSupported() {\n  return 'serviceWorker' in navigator && 'PushManager' in window;\n}\n\nexport function getRegistration() {\n  // return navigator.serviceWorker.ready;\n  return navigator.serviceWorker.getRegistration();\n}\n\nasync function getSubscription() {\n  const registration = await getRegistration();\n  const subscription = registration\n    ? await registration.pushManager.getSubscription()\n    : undefined;\n  return { registration, subscription };\n}\n\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\n  const base64 = `${base64String}${padding}`\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}\n\n// Front-end <-> back-end\n// ======================\n\nexport async function initSubscription() {\n  if (!isPushSupported()) return;\n  const { subscription } = await getSubscription();\n  let backendSubscription = null;\n  try {\n    backendSubscription = await fetchBackendPushSubscription();\n  } catch (err) {\n    if (/(not found|unknown)/i.test(err.message)) {\n      // No subscription found\n    } else {\n      // Other error\n      throw err;\n    }\n  }\n  console.log('INIT subscription', {\n    subscription,\n    backendSubscription,\n  });\n\n  // Check if the subscription changed\n  if (backendSubscription && subscription) {\n    const sameEndpoint = backendSubscription.endpoint === subscription.endpoint;\n    const vapidKey = getVapidKey();\n    const sameKey = backendSubscription.serverKey === vapidKey;\n    if (!sameEndpoint) {\n      throw new Error('Backend subscription endpoint changed');\n    }\n    if (sameKey) {\n      // Subscription didn't change\n    } else {\n      // Subscription changed\n      console.error(' Subscription changed', {\n        sameEndpoint,\n        serverKey: backendSubscription.serverKey,\n        vapIdKey: vapidKey,\n        endpoint1: backendSubscription.endpoint,\n        endpoint2: subscription.endpoint,\n        sameKey,\n        key1: backendSubscription.serverKey,\n        key2: vapidKey,\n      });\n      throw new Error('Backend subscription key and vapid key changed');\n      // Only unsubscribe from backend, not from browser\n      // await removeBackendPushSubscription();\n      // // Now let's resubscribe\n      // // NOTE: I have no idea if this works\n      // return await updateSubscription({\n      //   data: backendSubscription.data,\n      //   policy: backendSubscription.policy,\n      // });\n    }\n  }\n\n  if (subscription && !backendSubscription) {\n    // check if account's vapidKey is same as subscription's applicationServerKey\n    const vapidKey = getVapidKey();\n    if (vapidKey) {\n      const { applicationServerKey } = subscription.options;\n      const vapidKeyStr = urlBase64ToUint8Array(vapidKey).toString();\n      const applicationServerKeyStr = new Uint8Array(\n        applicationServerKey,\n      ).toString();\n      const sameKey = vapidKeyStr === applicationServerKeyStr;\n      if (sameKey) {\n        // Subscription didn't change\n      } else {\n        // Subscription changed\n        console.error(' Subscription changed', {\n          vapidKeyStr,\n          applicationServerKeyStr,\n          sameKey,\n        });\n        // Unsubscribe since backend doesn't have a subscription\n        await subscription.unsubscribe();\n        throw new Error('Subscription key and vapid key changed');\n      }\n    } else {\n      console.warn('No vapidKey found');\n    }\n  }\n\n  // Check if backend subscription returns 404\n  // if (subscription && !backendSubscription) {\n  //   // Re-subscribe to backend\n  //   backendSubscription = await createBackendPushSubscription({\n  //     subscription,\n  //     data: {},\n  //     policy: 'all',\n  //   });\n  // }\n\n  return { subscription, backendSubscription };\n}\n\nexport async function updateSubscription({ data, policy }) {\n  console.log(' Updating subscription', { data, policy });\n  if (!isPushSupported()) return;\n  let { registration, subscription } = await getSubscription();\n  let backendSubscription = null;\n\n  if (subscription) {\n    try {\n      backendSubscription = await updateBackendPushSubscription({\n        data,\n        policy,\n      });\n      // TODO: save subscription in user settings\n    } catch (error) {\n      // Backend doesn't have a subscription for this user\n      // Create a new one\n      backendSubscription = await createBackendPushSubscription({\n        subscription,\n        data,\n        policy,\n      });\n      // TODO: save subscription in user settings\n    }\n  } else {\n    // User is not subscribed\n    const vapidKey = getVapidKey();\n    if (!vapidKey) throw new Error('No server key found');\n    subscription = await registration.pushManager.subscribe({\n      userVisibleOnly: true,\n      applicationServerKey: urlBase64ToUint8Array(vapidKey),\n    });\n    backendSubscription = await createBackendPushSubscription({\n      subscription,\n      data,\n      policy,\n    });\n    // TODO: save subscription in user settings\n  }\n\n  return { subscription, backendSubscription };\n}\n\nexport async function removeSubscription() {\n  if (!isPushSupported()) return;\n  const { subscription } = await getSubscription();\n  if (subscription) {\n    await removeBackendPushSubscription();\n    await subscription.unsubscribe();\n  }\n}\n","import './settings.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport logo from '../assets/logo.svg';\n\nimport Icon from '../components/icon';\nimport LangSelector from '../components/lang-selector';\nimport Link from '../components/link';\nimport RelativeTime from '../components/relative-time';\nimport languages from '../data/translang-languages';\nimport { api, getPreferences, setPreferences } from '../utils/api';\nimport getTranslateTargetLanguage from '../utils/get-translate-target-language';\nimport localeCode2Text from '../utils/localeCode2Text';\nimport prettyBytes from '../utils/pretty-bytes';\nimport {\n  initSubscription,\n  isPushSupported,\n  removeSubscription,\n  updateSubscription,\n} from '../utils/push-notifications';\nimport { supportsNativeQuote } from '../utils/quote-utils';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport { getAPIVersions, getVapidKey } from '../utils/store-utils';\n\nconst DEFAULT_TEXT_SIZE = 16;\nconst TEXT_SIZES = [14, 15, 16, 17, 18, 19, 20];\nconst {\n  PHANPY_WEBSITE: WEBSITE,\n  PHANPY_PRIVACY_POLICY_URL: PRIVACY_POLICY_URL,\n  PHANPY_TRANSLANG_INSTANCES: TRANSLANG_INSTANCES,\n  PHANPY_IMG_ALT_API_URL: IMG_ALT_API_URL,\n  PHANPY_GIPHY_API_KEY: GIPHY_API_KEY,\n} = import.meta.env;\n\nconst targetLanguages = Object.entries(languages.tl).map(([code, name]) => ({\n  code,\n  name,\n}));\n\nconst TRANSLATION_API_NAME = 'TransLang API';\n\nfunction Settings({ onClose }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const currentTheme = store.local.get('theme') || 'auto';\n  const themeFormRef = useRef();\n  const targetLanguage =\n    snapStates.settings.contentTranslationTargetLanguage || null;\n  const systemTargetLanguage = getTranslateTargetLanguage();\n  const systemTargetLanguageText = localeCode2Text(systemTargetLanguage);\n  const currentTextSize = store.local.get('textSize') || DEFAULT_TEXT_SIZE;\n\n  const [prefs, setPrefs] = useState(getPreferences());\n  const { masto, authenticated, instance } = api();\n  // Get preferences every time Settings is opened\n  // NOTE: Disabled for now because I don't expect this to change often. Also for some reason, the /api/v1/preferences endpoint is cached for a while and return old prefs if refresh immediately after changing them.\n  // useEffect(() => {\n  //   const { masto } = api();\n  //   (async () => {\n  //     try {\n  //       const preferences = await masto.v1.preferences.fetch();\n  //       setPrefs(preferences);\n  //       store.account.set('preferences', preferences);\n  //     } catch (e) {\n  //       // Silently fail\n  //       console.error(e);\n  //     }\n  //   })();\n  // }, []);\n\n  const [expTabBarV2, setExpTabBarV2] = useState(\n    store.local.get('experiments-tabBarV2') ?? false,\n  );\n\n  const disableQuotePolicy = prefs['posting:default:visibility'] === 'private';\n\n  return (\n    <div\n      id=\"settings-container\"\n      class=\"sheet\"\n      tabIndex=\"-1\"\n      style={{\n        '--current-text-size': `${currentTextSize}px`,\n      }}\n    >\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Settings</Trans>\n        </h2>\n      </header>\n      <main>\n        <section>\n          <ul>\n            <li>\n              <div>\n                <label>\n                  <Trans>Appearance</Trans>\n                </label>\n              </div>\n              <div>\n                <form\n                  ref={themeFormRef}\n                  onInput={(e) => {\n                    console.log(e);\n                    e.preventDefault();\n                    const formData = new FormData(themeFormRef.current);\n                    const theme = formData.get('theme');\n                    const html = document.documentElement;\n\n                    if (theme === 'auto') {\n                      html.classList.remove('is-light', 'is-dark');\n\n                      // Disable manual theme <meta>\n                      const $manualMeta = document.querySelector(\n                        'meta[data-theme-setting=\"manual\"]',\n                      );\n                      if ($manualMeta) {\n                        $manualMeta.name = '';\n                      }\n                      // Enable auto theme <meta>s\n                      const $autoMetas = document.querySelectorAll(\n                        'meta[data-theme-setting=\"auto\"]',\n                      );\n                      $autoMetas.forEach((m) => {\n                        m.name = 'theme-color';\n                      });\n                    } else {\n                      html.classList.toggle('is-light', theme === 'light');\n                      html.classList.toggle('is-dark', theme === 'dark');\n\n                      // Enable manual theme <meta>\n                      const $manualMeta = document.querySelector(\n                        'meta[data-theme-setting=\"manual\"]',\n                      );\n                      if ($manualMeta) {\n                        $manualMeta.name = 'theme-color';\n                        $manualMeta.content =\n                          theme === 'light'\n                            ? $manualMeta.dataset.themeLightColor\n                            : $manualMeta.dataset.themeDarkColor;\n                      }\n                      // Disable auto theme <meta>s\n                      const $autoMetas = document.querySelectorAll(\n                        'meta[data-theme-setting=\"auto\"]',\n                      );\n                      $autoMetas.forEach((m) => {\n                        m.name = '';\n                      });\n                    }\n                    document\n                      .querySelector('meta[name=\"color-scheme\"]')\n                      .setAttribute(\n                        'content',\n                        theme === 'auto' ? 'light dark' : theme,\n                      );\n\n                    if (theme === 'auto') {\n                      store.local.del('theme');\n                    } else {\n                      store.local.set('theme', theme);\n                    }\n                  }}\n                >\n                  <div class=\"radio-group\">\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"theme\"\n                        value=\"light\"\n                        defaultChecked={currentTheme === 'light'}\n                      />\n                      <span>\n                        <Trans>Light</Trans>\n                      </span>\n                    </label>\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"theme\"\n                        value=\"dark\"\n                        defaultChecked={currentTheme === 'dark'}\n                      />\n                      <span>\n                        <Trans>Dark</Trans>\n                      </span>\n                    </label>\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"theme\"\n                        value=\"auto\"\n                        defaultChecked={\n                          currentTheme !== 'light' && currentTheme !== 'dark'\n                        }\n                      />\n                      <span>\n                        <Trans>Auto</Trans>\n                      </span>\n                    </label>\n                  </div>\n                </form>\n              </div>\n            </li>\n            <li>\n              <div>\n                <label>\n                  <Trans>Text size</Trans>\n                </label>\n              </div>\n              <div class=\"range-group\">\n                <span style={{ fontSize: TEXT_SIZES[0] }}>\n                  <Trans comment=\"Preview of one character, in smallest size\">\n                    A\n                  </Trans>\n                </span>{' '}\n                <input\n                  type=\"range\"\n                  min={TEXT_SIZES[0]}\n                  max={TEXT_SIZES[TEXT_SIZES.length - 1]}\n                  step=\"1\"\n                  value={currentTextSize}\n                  list=\"sizes\"\n                  onChange={(e) => {\n                    const value = parseInt(e.target.value, 10);\n                    const html = document.documentElement;\n                    // set CSS variable\n                    html.style.setProperty('--text-size', `${value}px`);\n                    // save to local storage\n                    if (value === DEFAULT_TEXT_SIZE) {\n                      store.local.del('textSize');\n                    } else {\n                      store.local.set('textSize', e.target.value);\n                    }\n                  }}\n                />{' '}\n                <span style={{ fontSize: TEXT_SIZES[TEXT_SIZES.length - 1] }}>\n                  <Trans comment=\"Preview of one character, in largest size\">\n                    A\n                  </Trans>\n                </span>\n                <datalist id=\"sizes\">\n                  {TEXT_SIZES.map((size) => (\n                    <option value={size} />\n                  ))}\n                </datalist>\n              </div>\n            </li>\n            <li>\n              <span>\n                <label>\n                  <Trans>Display language</Trans>\n                </label>{' '}\n                <small>\n                  <a\n                    href=\"https://crowdin.com/project/phanpy\"\n                    target=\"_blank\"\n                    rel=\"noopener\"\n                  >\n                    <Trans>Volunteer translations</Trans>\n                  </a>\n                </small>\n              </span>\n              <LangSelector />\n            </li>\n          </ul>\n        </section>\n        {authenticated && (\n          <>\n            <h3>\n              <Trans>Posting</Trans>\n            </h3>\n            <section>\n              <ul>\n                <li>\n                  <label for=\"posting-privacy-field\">\n                    <Trans>Default visibility</Trans>{' '}\n                    <Icon icon=\"cloud\" alt={t`Synced`} class=\"synced-icon\" />\n                  </label>\n                  <select\n                    id=\"posting-privacy-field\"\n                    value={prefs['posting:default:visibility'] || 'public'}\n                    onChange={(e) => {\n                      const { value } = e.target;\n                      (async () => {\n                        try {\n                          await masto.v1.accounts.updateCredentials({\n                            source: {\n                              privacy: value,\n                            },\n                          });\n                          const newPrefs = {\n                            ...prefs,\n                            'posting:default:visibility': value,\n                          };\n                          if (value === 'private') {\n                            newPrefs['posting:default:quote_policy'] = 'nobody';\n                          }\n                          setPrefs(newPrefs);\n                          setPreferences(newPrefs);\n                          showToast(t`Default visibility updated`);\n                        } catch (e) {\n                          alert(t`Failed to update default visibility`);\n                          console.error(e);\n                        }\n                      })();\n                    }}\n                  >\n                    <option value=\"public\">\n                      <Trans>Public</Trans>\n                    </option>\n                    <option value=\"unlisted\">\n                      <Trans>Quiet public</Trans>\n                    </option>\n                    <option value=\"private\">\n                      <Trans>Followers</Trans>\n                    </option>\n                  </select>\n                </li>\n                {supportsNativeQuote() && (\n                  <li>\n                    <label for=\"posting-quote-policy-field\">\n                      <Trans>Quote settings</Trans>{' '}\n                      <Icon icon=\"cloud\" alt={t`Synced`} class=\"synced-icon\" />\n                    </label>\n                    <select\n                      id=\"posting-quote-policy-field\"\n                      value={\n                        disableQuotePolicy\n                          ? 'nobody'\n                          : prefs['posting:default:quote_policy'] || 'public'\n                      }\n                      disabled={disableQuotePolicy}\n                      onChange={(e) => {\n                        const { value } = e.target;\n                        (async () => {\n                          try {\n                            await masto.v1.accounts.updateCredentials({\n                              source: {\n                                quote_policy: value,\n                              },\n                            });\n                            const newPrefs = {\n                              ...prefs,\n                              'posting:default:quote_policy': value,\n                            };\n                            setPrefs(newPrefs);\n                            setPreferences(newPrefs);\n                            showToast(t`Quote settings updated`);\n                          } catch (e) {\n                            alert(t`Failed to update quote settings`);\n                            console.error(e);\n                          }\n                        })();\n                      }}\n                    >\n                      <option value=\"public\" disabled={disableQuotePolicy}>\n                        <Trans>Anyone can quote</Trans>\n                      </option>\n                      <option value=\"followers\" disabled={disableQuotePolicy}>\n                        <Trans>Your followers can quote</Trans>\n                      </option>\n                      <option value=\"nobody\">\n                        <Trans>Only you can quote</Trans>\n                      </option>\n                    </select>\n                  </li>\n                )}\n              </ul>\n            </section>\n            <p class=\"section-postnote\">\n              <Icon icon=\"cloud\" alt={t`Synced`} class=\"synced-icon\" />{' '}\n              <small>\n                <Trans>\n                  Synced to your instance server's settings.{' '}\n                  <a\n                    href={`https://${instance}/`}\n                    target=\"_blank\"\n                    rel=\"noopener\"\n                  >\n                    Go to your instance ({instance}) for more settings.\n                  </a>\n                </Trans>\n              </small>\n            </p>\n          </>\n        )}\n        <h3>\n          <Trans>Experiments</Trans>\n        </h3>\n        <section>\n          <ul>\n            <li class=\"block\">\n              <label>\n                <input\n                  type=\"checkbox\"\n                  checked={snapStates.settings.autoRefresh}\n                  onChange={(e) => {\n                    states.settings.autoRefresh = e.target.checked;\n                  }}\n                />{' '}\n                <Trans>Auto refresh timeline posts</Trans>\n              </label>\n            </li>\n            <li class=\"block\">\n              <label>\n                <input\n                  type=\"checkbox\"\n                  checked={snapStates.settings.boostsCarousel}\n                  onChange={(e) => {\n                    states.settings.boostsCarousel = e.target.checked;\n                  }}\n                />{' '}\n                <Trans>Boosts carousel</Trans>\n              </label>\n            </li>\n            {!!TRANSLANG_INSTANCES && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={snapStates.settings.contentTranslation}\n                    onChange={(e) => {\n                      const { checked } = e.target;\n                      states.settings.contentTranslation = checked;\n                      if (!checked) {\n                        states.settings.contentTranslationTargetLanguage = null;\n                      }\n                    }}\n                  />{' '}\n                  <Trans>Post translation</Trans>\n                </label>\n                <div\n                  class={`sub-section ${\n                    !snapStates.settings.contentTranslation\n                      ? 'more-insignificant'\n                      : ''\n                  }`}\n                >\n                  <div>\n                    <label>\n                      <Trans>Translate to </Trans>{' '}\n                      <select\n                        value={targetLanguage || ''}\n                        disabled={!snapStates.settings.contentTranslation}\n                        style={{ width: '10em' }}\n                        onChange={(e) => {\n                          states.settings.contentTranslationTargetLanguage =\n                            e.target.value || null;\n                        }}\n                      >\n                        <option value=\"\">\n                          <Trans>\n                            System language ({systemTargetLanguageText})\n                          </Trans>\n                        </option>\n                        <option disabled></option>\n                        {targetLanguages.map((lang) => {\n                          const common = localeCode2Text({\n                            code: lang.code,\n                            fallback: lang.name,\n                          });\n                          const native = localeCode2Text({\n                            code: lang.code,\n                            locale: lang.code,\n                          });\n                          const showCommon = native && common !== native;\n                          return (\n                            <option value={lang.code}>\n                              {showCommon ? `${native} - ${common}` : common}\n                            </option>\n                          );\n                        })}\n                      </select>\n                    </label>\n                  </div>\n                  <hr />\n                  <div class=\"checkbox-fieldset\">\n                    <Plural\n                      value={\n                        snapStates.settings.contentTranslationHideLanguages\n                          .length\n                      }\n                      _0={`Hide \"Translate\" button for:`}\n                      other={`Hide \"Translate\" button for (#):`}\n                    />\n                    <div class=\"checkbox-fields\">\n                      {targetLanguages.map((lang) => {\n                        const common = localeCode2Text({\n                          code: lang.code,\n                          fallback: lang.name,\n                        });\n                        const native = localeCode2Text({\n                          code: lang.code,\n                          locale: lang.code,\n                        });\n                        const showCommon = native && common !== native;\n                        return (\n                          <label>\n                            <input\n                              type=\"checkbox\"\n                              checked={snapStates.settings.contentTranslationHideLanguages.includes(\n                                lang.code,\n                              )}\n                              onChange={(e) => {\n                                const { checked } = e.target;\n                                if (checked) {\n                                  states.settings.contentTranslationHideLanguages.push(\n                                    lang.code,\n                                  );\n                                } else {\n                                  states.settings.contentTranslationHideLanguages =\n                                    snapStates.settings.contentTranslationHideLanguages.filter(\n                                      (code) => code !== lang.code,\n                                    );\n                                }\n                              }}\n                            />{' '}\n                            {showCommon ? (\n                              <span>\n                                {native}{' '}\n                                <span class=\"insignificant ib\">- {common}</span>\n                              </span>\n                            ) : (\n                              common\n                            )}\n                          </label>\n                        );\n                      })}\n                    </div>\n                  </div>\n                  <p class=\"insignificant\">\n                    <small>\n                      <Trans>\n                        Note: This feature uses external translation services,\n                        powered by{' '}\n                        <a\n                          href=\"https://github.com/cheeaun/translang-api\"\n                          target=\"_blank\"\n                          rel=\"noopener\"\n                        >\n                          {TRANSLATION_API_NAME}\n                        </a>\n                        .\n                      </Trans>\n                    </small>\n                  </p>\n                  <hr />\n                  <div>\n                    <label>\n                      <input\n                        type=\"checkbox\"\n                        checked={\n                          snapStates.settings.contentTranslationAutoInline\n                        }\n                        disabled={!snapStates.settings.contentTranslation}\n                        onChange={(e) => {\n                          states.settings.contentTranslationAutoInline =\n                            e.target.checked;\n                        }}\n                      />{' '}\n                      <Trans>Auto inline translation</Trans>\n                    </label>\n                    <p class=\"insignificant\">\n                      <small>\n                        <Trans>\n                          Automatically show translation for posts in timeline.\n                          Only works for <b>short</b> posts without content\n                          warning, media and poll.\n                        </Trans>\n                      </small>\n                    </p>\n                  </div>\n                </div>\n              </li>\n            )}\n            {!!GIPHY_API_KEY && authenticated && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={snapStates.settings.composerGIFPicker}\n                    onChange={(e) => {\n                      states.settings.composerGIFPicker = e.target.checked;\n                    }}\n                  />{' '}\n                  <Trans>GIF Picker for composer</Trans>\n                </label>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Note: This feature uses external GIF search service,\n                      powered by{' '}\n                      <a\n                        href=\"https://developers.giphy.com/\"\n                        target=\"_blank\"\n                        rel=\"noopener\"\n                      >\n                        GIPHY\n                      </a>\n                      . G-rated (suitable for viewing by all ages), tracking\n                      parameters are stripped, referrer information is omitted\n                      from requests, but search queries and IP address\n                      information will still reach their servers.\n                    </Trans>\n                  </small>\n                </div>\n              </li>\n            )}\n            {!!IMG_ALT_API_URL && authenticated && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={snapStates.settings.mediaAltGenerator}\n                    onChange={(e) => {\n                      states.settings.mediaAltGenerator = e.target.checked;\n                    }}\n                  />{' '}\n                  <Trans>Image description generator</Trans>{' '}\n                  <Icon icon=\"sparkles2\" class=\"more-insignificant\" />\n                </label>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Only for new images while composing new posts.\n                    </Trans>\n                  </small>\n                </div>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Note: This feature uses external AI service, powered by{' '}\n                      <a\n                        href=\"https://github.com/cheeaun/img-alt-api\"\n                        target=\"_blank\"\n                        rel=\"noopener\"\n                      >\n                        img-alt-api\n                      </a>\n                      . May not work well. Only for images and in English.\n                    </Trans>\n                  </small>\n                </div>\n              </li>\n            )}\n            {authenticated && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={\n                      snapStates.settings.shortcutSettingsCloudImportExport\n                    }\n                    onChange={(e) => {\n                      states.settings.shortcutSettingsCloudImportExport =\n                        e.target.checked;\n                    }}\n                  />{' '}\n                  <Trans>\"Cloud\" import/export for shortcuts settings</Trans>{' '}\n                  <Icon icon=\"cloud\" class=\"more-insignificant\" />\n                </label>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                       Very experimental.\n                      <br />\n                      Stored in your own profiles notes. Profile (private)\n                      notes are mainly used for other profiles, and hidden for\n                      own profile.\n                    </Trans>\n                  </small>\n                </div>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Note: This feature uses currently-logged-in instance\n                      server API.\n                    </Trans>\n                  </small>\n                </div>\n              </li>\n            )}\n            <li class=\"block\">\n              <label>\n                <input\n                  type=\"checkbox\"\n                  checked={snapStates.settings.cloakMode}\n                  onChange={(e) => {\n                    states.settings.cloakMode = e.target.checked;\n                  }}\n                />{' '}\n                <Trans>\n                  Cloak mode{' '}\n                  <span class=\"insignificant\">\n                    (<samp>Text</samp>  <samp></samp>)\n                  </span>\n                </Trans>\n              </label>\n              <div class=\"sub-section insignificant\">\n                <small>\n                  <Trans>\n                    Replace text as blocks, useful when taking screenshots, for\n                    privacy reasons.\n                  </Trans>\n                </small>\n              </div>\n            </li>\n            {authenticated && (\n              <li>\n                <button\n                  type=\"button\"\n                  class=\"light\"\n                  onClick={() => {\n                    states.showDrafts = true;\n                    states.showSettings = false;\n                  }}\n                >\n                  <Trans>Unsent drafts</Trans>\n                </button>\n              </li>\n            )}\n          </ul>\n        </section>\n        {authenticated && <PushNotificationsSection onClose={onClose} />}\n        <h3>\n          <Trans>About</Trans>\n        </h3>\n        <section>\n          <div\n            style={{\n              display: 'flex',\n              flexWrap: 'wrap',\n              gap: 8,\n              lineHeight: 1.25,\n              alignItems: 'center',\n              marginTop: 8,\n            }}\n          >\n            <img\n              src={logo}\n              alt=\"\"\n              width=\"64\"\n              height=\"64\"\n              style={{\n                aspectRatio: '1/1',\n                verticalAlign: 'middle',\n                background: '#b7cdf9',\n                borderRadius: 12,\n              }}\n            />\n            <div>\n              <b>Phanpy</b>{' '}\n              <a\n                href=\"https://hachyderm.io/@phanpy\"\n                // target=\"_blank\"\n                rel=\"noopener\"\n                onClick={(e) => {\n                  e.preventDefault();\n                  states.showAccount = 'phanpy@hachyderm.io';\n                }}\n              >\n                @phanpy\n              </a>\n              <br />\n              <Trans>\n                <a\n                  href=\"https://github.com/cheeaun/phanpy\"\n                  target=\"_blank\"\n                  rel=\"noopener\"\n                >\n                  Built\n                </a>{' '}\n                by{' '}\n                <a\n                  href=\"https://mastodon.social/@cheeaun\"\n                  // target=\"_blank\"\n                  rel=\"noopener\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.showAccount = 'cheeaun@mastodon.social';\n                  }}\n                >\n                  @cheeaun\n                </a>\n              </Trans>\n            </div>\n          </div>\n          <p>\n            <a\n              href=\"https://github.com/sponsors/cheeaun\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              <Trans>Sponsor</Trans>\n            </a>{' '}\n            &middot;{' '}\n            <a\n              href=\"https://www.buymeacoffee.com/cheeaun\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              <Trans>Donate</Trans>\n            </a>{' '}\n            &middot;{' '}\n            <a\n              href=\"https://patreon.com/cheeaun\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              Patreon\n            </a>{' '}\n            &middot;{' '}\n            <a\n              href=\"https://github.com/cheeaun/phanpy/blob/main/CHANGELOG.md\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              <Trans>What's new</Trans>\n            </a>{' '}\n            &middot;{' '}\n            <a href={PRIVACY_POLICY_URL} target=\"_blank\" rel=\"noopener\">\n              <Trans>Privacy Policy</Trans>\n            </a>\n          </p>\n          {__COMMIT_TIME__ && (\n            <p>\n              {WEBSITE && (\n                <>\n                  <Trans>\n                    <span class=\"insignificant\">Site:</span>{' '}\n                    {WEBSITE.replace(/https?:\\/\\//g, '').replace(/\\/$/, '')}\n                  </Trans>\n                  <br />\n                </>\n              )}\n              <Trans>\n                <span class=\"insignificant\">Version:</span>{' '}\n                <input\n                  type=\"text\"\n                  class=\"version-string\"\n                  readOnly\n                  size=\"18\" // Manually calculated here\n                  value={`${__COMMIT_TIME__.slice(0, 10).replace(/-/g, '.')}${\n                    __COMMIT_HASH__ ? `.${__COMMIT_HASH__}` : ''\n                  }`}\n                  onClick={(e) => {\n                    e.target.select();\n                    // Copy to clipboard\n                    try {\n                      navigator.clipboard.writeText(e.target.value);\n                      showToast(t`Version string copied`);\n                    } catch (e) {\n                      console.warn(e);\n                      showToast(t`Unable to copy version string`);\n                    }\n                  }}\n                />{' '}\n                {!__FAKE_COMMIT_HASH__ && (\n                  <span class=\"ib insignificant\">\n                    (\n                    <a\n                      href={`https://github.com/cheeaun/phanpy/commit/${__COMMIT_HASH__}`}\n                      target=\"_blank\"\n                      rel=\"noopener\"\n                    >\n                      <RelativeTime datetime={new Date(__BUILD_TIME__)} />\n                    </a>\n                    )\n                  </span>\n                )}\n              </Trans>\n            </p>\n          )}\n        </section>\n        {(import.meta.env.DEV || import.meta.env.PHANPY_DEV) && (\n          <details class=\"debug-info\">\n            <summary></summary>\n            <p class=\"side\">\n              <Link\n                to=\"/_sandbox\"\n                onClick={onClose}\n                class=\"button plain6 small\"\n              >\n                Sandbox\n              </Link>\n            </p>\n            <p>Debugging</p>\n            <p>\n              <b>Vapid key</b>: {getVapidKey()}\n            </p>\n            {__BENCH_RESULTS?.size > 0 && (\n              <ul>\n                {Array.from(__BENCH_RESULTS.entries()).map(\n                  ([name, duration]) => (\n                    <li>\n                      <b>{name}</b>: {duration}ms\n                    </li>\n                  ),\n                )}\n              </ul>\n            )}\n            <p>Service Worker Cache</p>\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={async () => alert(await getCachesKeys())}\n            >\n              Show keys count\n            </button>{' '}\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={async () => alert(await getCachesSize())}\n            >\n              Show cache size\n            </button>{' '}\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={() => {\n                const key = prompt('Enter cache key');\n                if (!key) return;\n                try {\n                  clearCacheKey(key);\n                } catch (e) {\n                  alert(e);\n                }\n              }}\n            >\n              Clear cache key\n            </button>{' '}\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={() => {\n                try {\n                  clearCaches();\n                } catch (e) {\n                  alert(e);\n                }\n              }}\n            >\n              Clear all caches\n            </button>\n            <p>Temporary Experiments</p>\n            <label>\n              <input\n                type=\"checkbox\"\n                checked={expTabBarV2}\n                onChange={(e) => {\n                  const { checked } = e.target;\n                  document.body.classList.toggle('exp-tab-bar-v2', checked);\n                  setExpTabBarV2(checked);\n                  if (checked) {\n                    store.local.set('experiments-tabBarV2', true);\n                  } else {\n                    store.local.del('experiments-tabBarV2');\n                  }\n                }}\n              />{' '}\n              Tab bar v2\n            </label>\n          </details>\n        )}\n      </main>\n    </div>\n  );\n}\n\nasync function getCachesKeys() {\n  const keys = await caches.keys();\n  const total = {};\n  for (const key of keys) {\n    const cache = await caches.open(key);\n    const k = await cache.keys();\n    total[key] = k.length;\n  }\n  return total;\n}\n\nasync function getCachesSize() {\n  const keys = await caches.keys();\n  let total = {};\n  let TOTAL = 0;\n  for (const key of keys) {\n    const cache = await caches.open(key);\n    const k = await cache.keys();\n    for (const item of k) {\n      try {\n        const response = await cache.match(item);\n        const blob = await response.blob();\n        total[key] = (total[key] || 0) + blob.size;\n        TOTAL += blob.size;\n      } catch (e) {\n        alert('Failed to get cache size for ' + item);\n        alert(e);\n      }\n    }\n  }\n  return {\n    ...Object.fromEntries(\n      Object.entries(total).map(([k, v]) => [k, prettyBytes(v)]),\n    ),\n    TOTAL: prettyBytes(TOTAL),\n  };\n}\n\nfunction clearCacheKey(key) {\n  return caches.delete(key);\n}\n\nasync function clearCaches() {\n  const keys = await caches.keys();\n  for (const key of keys) {\n    await caches.delete(key);\n  }\n}\n\nfunction PushNotificationsSection({ onClose }) {\n  const { t } = useLingui();\n  if (!isPushSupported()) return null;\n\n  const { instance } = api();\n  const [uiState, setUIState] = useState('default');\n  const pushFormRef = useRef();\n  const [allowNotifications, setAllowNotifications] = useState(false);\n  const [needRelogin, setNeedRelogin] = useState(false);\n  const previousPolicyRef = useRef();\n  useEffect(() => {\n    (async () => {\n      setUIState('loading');\n      try {\n        const { subscription, backendSubscription } = await initSubscription();\n        if (\n          backendSubscription?.policy &&\n          backendSubscription.policy !== 'none'\n        ) {\n          setAllowNotifications(true);\n          const { alerts, policy } = backendSubscription;\n          console.log('backendSubscription', backendSubscription);\n          previousPolicyRef.current = policy;\n          const { elements } = pushFormRef.current;\n          const policyEl = elements.namedItem('policy');\n          if (policyEl) policyEl.value = policy;\n          // alerts is {}, iterate it\n          Object.entries(alerts).forEach(([alert, value]) => {\n            const el = elements.namedItem(alert);\n            if (el?.type === 'checkbox') {\n              el.checked = !!value;\n            }\n          });\n        }\n        setUIState('default');\n      } catch (err) {\n        console.warn(err);\n        if (/outside.*authorized/i.test(err.message)) {\n          setNeedRelogin(true);\n        } else {\n          alert(err?.message || err);\n        }\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  const isLoading = uiState === 'loading';\n\n  return (\n    <form\n      ref={pushFormRef}\n      onChange={() => {\n        setTimeout(() => {\n          const values = Object.fromEntries(new FormData(pushFormRef.current));\n          const allowNotifications = !!values['policy-allow'];\n          const params = {\n            data: {\n              policy: values.policy,\n              alerts: {\n                mention: !!values.mention,\n                favourite: !!values.favourite,\n                reblog: !!values.reblog,\n                follow: !!values.follow,\n                follow_request: !!values.followRequest,\n                poll: !!values.poll,\n                update: !!values.update,\n                status: !!values.status,\n              },\n            },\n          };\n\n          let alertsCount = 0;\n          // Remove false values from data.alerts\n          // API defaults to false anyway\n          Object.keys(params.data.alerts).forEach((key) => {\n            if (!params.data.alerts[key]) {\n              delete params.data.alerts[key];\n            } else {\n              alertsCount++;\n            }\n          });\n          const policyChanged =\n            previousPolicyRef.current !== params.data.policy;\n\n          console.log('PN Form', {\n            values,\n            allowNotifications: allowNotifications,\n            params,\n          });\n\n          if (allowNotifications && alertsCount > 0) {\n            if (policyChanged) {\n              console.debug('Policy changed.');\n              removeSubscription()\n                .then(() => {\n                  updateSubscription(params);\n                })\n                .catch((err) => {\n                  console.warn(err);\n                  alert(t`Failed to update subscription. Please try again.`);\n                });\n            } else {\n              updateSubscription(params).catch((err) => {\n                console.warn(err);\n                alert(t`Failed to update subscription. Please try again.`);\n              });\n            }\n          } else {\n            removeSubscription().catch((err) => {\n              console.warn(err);\n              alert(t`Failed to remove subscription. Please try again.`);\n            });\n          }\n        }, 100);\n      }}\n    >\n      <h3>\n        <Trans>Push Notifications (beta)</Trans>\n      </h3>\n      <section>\n        <ul>\n          <li>\n            <label>\n              <input\n                type=\"checkbox\"\n                disabled={isLoading || needRelogin}\n                name=\"policy-allow\"\n                checked={allowNotifications}\n                onChange={async (e) => {\n                  const { checked } = e.target;\n                  if (checked) {\n                    // Request permission\n                    const permission = await Notification.requestPermission();\n                    if (permission === 'granted') {\n                      setAllowNotifications(true);\n                    } else {\n                      setAllowNotifications(false);\n                      if (permission === 'denied') {\n                        alert(\n                          t`Push notifications are blocked. Please enable them in your browser settings.`,\n                        );\n                      }\n                    }\n                  } else {\n                    setAllowNotifications(false);\n                  }\n                }}\n              />{' '}\n              <Trans>\n                Allow from{' '}\n                <select\n                  name=\"policy\"\n                  disabled={isLoading || needRelogin || !allowNotifications}\n                >\n                  {[\n                    {\n                      value: 'all',\n                      label: t`anyone`,\n                    },\n                    {\n                      value: 'followed',\n                      label: t`people I follow`,\n                    },\n                    {\n                      value: 'follower',\n                      label: t`followers`,\n                    },\n                  ].map((type) => (\n                    <option value={type.value}>{type.label}</option>\n                  ))}\n                </select>\n              </Trans>\n            </label>\n            <div\n              class=\"shazam-container no-animation\"\n              style={{\n                width: '100%',\n              }}\n              hidden={!allowNotifications}\n            >\n              <div class=\"shazam-container-inner\">\n                <div class=\"sub-section\">\n                  <ul>\n                    {[\n                      {\n                        value: 'mention',\n                        label: t`Mentions`,\n                      },\n                      {\n                        value: 'favourite',\n                        label: t`Likes`,\n                      },\n                      {\n                        value: 'reblog',\n                        label: t`Boosts`,\n                      },\n                      {\n                        value: 'follow',\n                        label: t`Follows`,\n                      },\n                      {\n                        value: 'followRequest',\n                        label: t`Follow requests`,\n                      },\n                      {\n                        value: 'poll',\n                        label: t`Polls`,\n                      },\n                      {\n                        value: 'update',\n                        label: t`Post edits`,\n                      },\n                      {\n                        value: 'status',\n                        label: t`New posts`,\n                      },\n                    ].map((alert) => (\n                      <li>\n                        <label>\n                          <input type=\"checkbox\" name={alert.value} />{' '}\n                          {alert.label}\n                        </label>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              </div>\n            </div>\n            {needRelogin && (\n              <div class=\"sub-section\">\n                <p>\n                  <Trans>\n                    Push permission was not granted since your last login.\n                    You'll need to{' '}\n                    <Link to={`/login?instance=${instance}`} onClick={onClose}>\n                      <b>log in</b> again to grant push permission\n                    </Link>\n                    .\n                  </Trans>\n                </p>\n              </div>\n            )}\n          </li>\n        </ul>\n      </section>\n      <p class=\"section-postnote\">\n        <small>\n          <Trans>\n            NOTE: Push notifications only work for <b>one account</b>.\n          </Trans>\n        </small>\n      </p>\n    </form>\n  );\n}\n\nexport default Settings;\n","const focusDeck = () => {\n  let timer = setTimeout(() => {\n    const columns = document.getElementById('columns');\n    if (columns) {\n      // Focus focused column\n      const focusedColumn = columns.querySelector('.deck-container.focus');\n      if (focusedColumn) {\n        focusedColumn.focus();\n      } else {\n        // Focus first column within viewport\n        const firstVisibleColumn = Array.from(\n          columns.querySelectorAll('.deck-container'),\n        ).find((column) => {\n          const columnRect = column.getBoundingClientRect();\n          return columnRect.left >= 0;\n        });\n        if (firstVisibleColumn) {\n          firstVisibleColumn.focus();\n        } else {\n          // Focus first column\n          columns.querySelector('.deck-container')?.focus?.();\n        }\n      }\n    } else {\n      const modals = document.querySelectorAll('#modal-container > *');\n      if (modals?.length) {\n        // Focus last modal\n        const modal = modals[modals.length - 1]; // last one\n        const modalFocusElement =\n          modal.querySelector('[tabindex=\"-1\"]') || modal;\n        if (modalFocusElement) {\n          modalFocusElement.focus();\n          return;\n        }\n      }\n      const backDrop = document.querySelector('.deck-backdrop');\n      if (backDrop) return;\n      // Focus last deck\n      const pages = document.querySelectorAll('.deck-container');\n      const page = pages[pages.length - 1]; // last one\n      if (page && page.tabIndex === -1) {\n        console.log('FOCUS', page);\n        page.focus();\n      }\n    }\n  }, 100);\n  return () => clearTimeout(timer);\n};\n\nexport default focusDeck;\n","import { useEffect, useRef } from 'preact/hooks';\nimport { useLocation } from 'react-router-dom';\n\n// Hook that runs a callback when the location changes\n// Won't run on the first render\n\nexport default function useLocationChange(fn) {\n  if (!fn) return;\n  const location = useLocation();\n  const currentLocationRef = useRef(location.pathname);\n  useEffect(() => {\n    // console.log('location', {\n    //   current: currentLocationRef.current,\n    //   next: location.pathname,\n    // });\n    if (\n      currentLocationRef.current &&\n      location.pathname !== currentLocationRef.current\n    ) {\n      fn?.();\n    }\n  }, [location.pathname, fn]);\n}\n","import { Trans } from '@lingui/react/macro';\nimport punycode from 'punycode/';\n\nfunction AccountHandleInfo({ acct, instance }) {\n  // acct = username or username@server\n  let [username, server] = acct.split('@');\n  if (!server) server = instance;\n  const encodedAcct = punycode.toASCII(acct);\n  return (\n    <div class=\"handle-info\">\n      <span class=\"handle-handle\" title={encodedAcct}>\n        <b class=\"handle-username\">{username}</b>\n        <span class=\"handle-at\">@</span>\n        <b class=\"handle-server\">{server}</b>\n      </span>\n      <div class=\"handle-legend\">\n        <span class=\"ib\">\n          <span class=\"handle-legend-icon username\" /> <Trans>username</Trans>\n        </span>{' '}\n        <span class=\"ib\">\n          <span class=\"handle-legend-icon server\" />{' '}\n          <Trans>server domain name</Trans>\n        </span>\n      </div>\n    </div>\n  );\n}\n\nexport default AccountHandleInfo;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport states from '../utils/states';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nconst SUPPORTED_IMAGE_FORMATS = [\n  'image/jpeg',\n  'image/png',\n  'image/gif',\n  'image/webp',\n];\nconst SUPPORTED_IMAGE_FORMATS_STR = SUPPORTED_IMAGE_FORMATS.join(',');\n\nfunction FieldsAttributesRow({ name, value, disabled, index: i }) {\n  const [hasValue, setHasValue] = useState(!!value);\n  return (\n    <tr>\n      <td>\n        <input\n          type=\"text\"\n          name={`fields_attributes[${i}][name]`}\n          defaultValue={name}\n          disabled={disabled}\n          maxLength={255}\n          required={hasValue}\n          dir=\"auto\"\n          enterKeyHint=\"done\"\n        />\n      </td>\n      <td>\n        <input\n          type=\"text\"\n          name={`fields_attributes[${i}][value]`}\n          defaultValue={value}\n          disabled={disabled}\n          maxLength={255}\n          onChange={(e) => setHasValue(!!e.currentTarget.value)}\n          dir=\"auto\"\n          enterKeyHint=\"done\"\n        />\n      </td>\n    </tr>\n  );\n}\n\nfunction EditProfileSheet({ onClose = () => {} }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('loading');\n  const [account, setAccount] = useState(null);\n  const [headerPreview, setHeaderPreview] = useState(null);\n  const [avatarPreview, setAvatarPreview] = useState(null);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const acc = await masto.v1.accounts.verifyCredentials();\n        setAccount(acc);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  console.log('EditProfileSheet', account);\n  const { displayName, source, avatar, header } = account || {};\n  const { note, fields } = source || {};\n  const fieldsAttributesRef = useRef(null);\n\n  const avatarMediaAttachments = [\n    ...(avatar ? [{ type: 'image', url: avatar }] : []),\n    ...(avatarPreview ? [{ type: 'image', url: avatarPreview }] : []),\n  ];\n  const headerMediaAttachments = [\n    ...(header ? [{ type: 'image', url: header }] : []),\n    ...(headerPreview ? [{ type: 'image', url: headerPreview }] : []),\n  ];\n\n  return (\n    <div class=\"sheet\" id=\"edit-profile-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <b>\n          <Trans>Edit profile</Trans>\n        </b>\n      </header>\n      <main>\n        {uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : (\n          <form\n            onSubmit={(e) => {\n              e.preventDefault();\n              const formData = new FormData(e.target);\n              const header = formData.get('header');\n              const avatar = formData.get('avatar');\n              const displayName = formData.get('display_name');\n              const note = formData.get('note');\n              const fieldsAttributesFields =\n                fieldsAttributesRef.current.querySelectorAll(\n                  'input[name^=\"fields_attributes\"]',\n                );\n              const fieldsAttributes = [];\n              fieldsAttributesFields.forEach((field) => {\n                const name = field.name;\n                const [_, index, key] =\n                  name.match(/fields_attributes\\[(\\d+)\\]\\[(.+)\\]/) || [];\n                const value = field.value ? field.value.trim() : '';\n                if (index && key && value) {\n                  if (!fieldsAttributes[index]) fieldsAttributes[index] = {};\n                  fieldsAttributes[index][key] = value;\n                }\n              });\n              // Fill in the blanks\n              fieldsAttributes.forEach((field) => {\n                if (field.name && !field.value) {\n                  field.value = '';\n                }\n              });\n\n              (async () => {\n                try {\n                  const newAccount = await masto.v1.accounts.updateCredentials({\n                    header,\n                    avatar,\n                    displayName,\n                    note,\n                    fieldsAttributes,\n                  });\n                  console.log('updated account', newAccount);\n                  onClose?.({\n                    state: 'success',\n                    account: newAccount,\n                  });\n                } catch (e) {\n                  console.error(e);\n                  alert(e?.message || t`Unable to update profile.`);\n                }\n              })();\n            }}\n          >\n            <div class=\"edit-profile-media-container\">\n              <label>\n                <Trans>Header picture</Trans>{' '}\n                <input\n                  type=\"file\"\n                  name=\"header\"\n                  accept={SUPPORTED_IMAGE_FORMATS_STR}\n                  onChange={(e) => {\n                    const file = e.target.files[0];\n                    if (file) {\n                      const blob = URL.createObjectURL(file);\n                      setHeaderPreview(blob);\n                    }\n                  }}\n                />\n              </label>\n              <div class=\"edit-profile-media-field\">\n                {header ? (\n                  <div\n                    class=\"edit-media\"\n                    tabIndex=\"0\"\n                    onClick={() => {\n                      states.showMediaModal = {\n                        mediaAttachments: headerMediaAttachments,\n                        mediaIndex: 0,\n                      };\n                    }}\n                  >\n                    <img src={header} alt=\"\" />\n                  </div>\n                ) : (\n                  <div class=\"edit-media\"></div>\n                )}\n                {headerPreview && (\n                  <>\n                    <Icon icon=\"arrow-right\" />\n                    <div\n                      class=\"edit-media\"\n                      tabIndex=\"0\"\n                      onClick={() => {\n                        states.showMediaModal = {\n                          mediaAttachments: headerMediaAttachments,\n                          mediaIndex: 1,\n                        };\n                      }}\n                    >\n                      <img src={headerPreview} alt=\"\" />\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n            <div class=\"edit-profile-media-container\">\n              <label>\n                <Trans>Profile picture</Trans>{' '}\n                <input\n                  type=\"file\"\n                  name=\"avatar\"\n                  accept={SUPPORTED_IMAGE_FORMATS_STR}\n                  onChange={(e) => {\n                    const file = e.target.files[0];\n                    if (file) {\n                      const blob = URL.createObjectURL(file);\n                      setAvatarPreview(blob);\n                    }\n                  }}\n                />\n              </label>\n              <div class=\"edit-profile-media-field\">\n                {avatar ? (\n                  <div\n                    class=\"edit-media\"\n                    tabIndex=\"0\"\n                    onClick={() => {\n                      states.showMediaModal = {\n                        mediaAttachments: avatarMediaAttachments,\n                        mediaIndex: 0,\n                      };\n                    }}\n                  >\n                    <img src={avatar} alt=\"\" />\n                  </div>\n                ) : (\n                  <div class=\"edit-media\"></div>\n                )}\n                {avatarPreview && (\n                  <>\n                    <Icon icon=\"arrow-right\" />\n                    <div\n                      class=\"edit-media\"\n                      tabIndex=\"0\"\n                      onClick={() => {\n                        states.showMediaModal = {\n                          mediaAttachments: avatarMediaAttachments,\n                          mediaIndex: 1,\n                        };\n                      }}\n                    >\n                      <img src={avatarPreview} alt=\"\" />\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n            <p>\n              <label>\n                <Trans>Name</Trans>{' '}\n                <input\n                  type=\"text\"\n                  name=\"display_name\"\n                  defaultValue={displayName}\n                  maxLength={30}\n                  disabled={uiState === 'loading'}\n                  dir=\"auto\"\n                  enterKeyHint=\"done\"\n                />\n              </label>\n            </p>\n            <p>\n              <label>\n                <Trans>Bio</Trans>\n                <textarea\n                  defaultValue={note}\n                  name=\"note\"\n                  maxLength={500}\n                  rows=\"5\"\n                  disabled={uiState === 'loading'}\n                  dir=\"auto\"\n                />\n              </label>\n            </p>\n            {/* Table for fields; name and values are in fields, min 4 rows */}\n            <p>\n              <Trans>Extra fields</Trans>\n            </p>\n            <table ref={fieldsAttributesRef}>\n              <thead>\n                <tr>\n                  <th>\n                    <Trans>Label</Trans>\n                  </th>\n                  <th>\n                    <Trans>Content</Trans>\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                {Array.from({ length: Math.max(4, fields.length) }).map(\n                  (_, i) => {\n                    const { name = '', value = '' } = fields[i] || {};\n                    return (\n                      <FieldsAttributesRow\n                        key={i}\n                        name={name}\n                        value={value}\n                        index={i}\n                        disabled={uiState === 'loading'}\n                      />\n                    );\n                  },\n                )}\n              </tbody>\n            </table>\n            <footer>\n              <button\n                type=\"button\"\n                class=\"light\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  onClose?.();\n                }}\n              >\n                <Trans>Cancel</Trans>\n              </button>\n              <button type=\"submit\" disabled={uiState === 'loading'}>\n                <Trans>Save</Trans>\n              </button>\n            </footer>\n          </form>\n        )}\n      </main>\n    </div>\n  );\n}\n\nexport default EditProfileSheet;\n","import { Trans } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport { fetchRelationships } from '../utils/relationships';\nimport supports from '../utils/supports';\n\nimport AccountBlock from './account-block';\nimport Loader from './loader';\n\nconst ENDORSEMENTS_LIMIT = 80;\n\nfunction Endorsements({\n  accountID: id,\n  info,\n  open = false,\n  onlyOpenIfHasEndorsements = false,\n}) {\n  const { masto } = api();\n  const endorsementsContainer = useRef();\n  const [endorsementsUIState, setEndorsementsUIState] = useState('default');\n  const [endorsements, setEndorsements] = useState([]);\n  const [relationshipsMap, setRelationshipsMap] = useState({});\n  useEffect(() => {\n    if (!supports('@mastodon/endorsements')) return;\n    if (!open) return;\n    (async () => {\n      setEndorsementsUIState('loading');\n      try {\n        const accounts = await masto.v1.accounts.$select(id).endorsements.list({\n          limit: ENDORSEMENTS_LIMIT,\n        });\n        console.log({ endorsements: accounts });\n        if (!accounts.length) {\n          setEndorsementsUIState('default');\n          return;\n        }\n        setEndorsements(accounts);\n        setEndorsementsUIState('default');\n        setTimeout(() => {\n          endorsementsContainer.current.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n          });\n        }, 300);\n\n        const relationships = await fetchRelationships(\n          accounts,\n          relationshipsMap,\n        );\n        if (relationships) {\n          setRelationshipsMap(relationships);\n        }\n      } catch (e) {\n        console.error(e);\n        setEndorsementsUIState('error');\n      }\n    })();\n  }, [open, id]);\n\n  const reallyOpen = onlyOpenIfHasEndorsements\n    ? open && endorsements.length > 0\n    : open;\n\n  if (!reallyOpen) return null;\n\n  return (\n    <div class=\"shazam-container\">\n      <div class=\"shazam-container-inner\">\n        <div class=\"endorsements-container\" ref={endorsementsContainer}>\n          <h3>\n            <Trans>Profiles featured by @{info.username}</Trans>\n          </h3>\n          {endorsementsUIState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader abrupt />\n            </p>\n          ) : endorsements.length > 0 ? (\n            <ul\n              class={`endorsements ${\n                endorsements.length > 10 ? 'expanded' : ''\n              }`}\n            >\n              {endorsements.map((account) => (\n                <li>\n                  <AccountBlock\n                    key={account.id}\n                    account={account}\n                    showStats\n                    avatarSize=\"xxl\"\n                    relationship={relationshipsMap[account.id]}\n                  />\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <p class=\"ui-state insignificant\">\n              <Trans>No featured profiles.</Trans>\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Endorsements;\n","import { api } from './api';\nimport pmem from './pmem';\nimport store from './store';\n\nconst FETCH_MAX_AGE = 1000 * 60; // 1 minute\nconst MAX_AGE = 24 * 60 * 60 * 1000; // 1 day\n\nexport const fetchLists = pmem(\n  async () => {\n    const { masto } = api();\n    const lists = await masto.v1.lists.list();\n    lists.sort((a, b) => a.title.localeCompare(b.title));\n\n    if (lists.length) {\n      setTimeout(() => {\n        // Save to local storage, with saved timestamp\n        store.account.set('lists', {\n          lists,\n          updatedAt: Date.now(),\n        });\n      }, 1);\n    }\n\n    return lists;\n  },\n  {\n    maxAge: FETCH_MAX_AGE,\n  },\n);\n\nexport async function getLists() {\n  try {\n    const { lists, updatedAt } = store.account.get('lists') || {};\n    if (!lists?.length) return await fetchLists();\n    if (Date.now() - updatedAt > MAX_AGE) {\n      // Stale-while-revalidate\n      fetchLists();\n      return lists;\n    }\n    return lists;\n  } catch (e) {\n    return [];\n  }\n}\n\nexport const fetchList = pmem(\n  (id) => {\n    const { masto } = api();\n    return masto.v1.lists.$select(id).fetch();\n  },\n  {\n    maxAge: FETCH_MAX_AGE,\n  },\n);\n\nexport async function getList(id) {\n  const { lists } = store.account.get('lists') || {};\n  console.log({ lists });\n  if (lists?.length) {\n    const theList = lists.find((l) => l.id === id);\n    if (theList) return theList;\n  }\n  try {\n    return fetchList(id);\n  } catch (e) {\n    return null;\n  }\n}\n\nexport async function getListTitle(id) {\n  const list = await getList(id);\n  return list?.title || '';\n}\n\nexport function addListStore(list) {\n  const { lists } = store.account.get('lists') || {};\n  if (lists?.length) {\n    lists.push(list);\n    lists.sort((a, b) => a.title.localeCompare(b.title));\n    store.account.set('lists', {\n      lists,\n      updatedAt: Date.now(),\n    });\n  }\n}\n\nexport function updateListStore(list) {\n  const { lists } = store.account.get('lists') || {};\n  if (lists?.length) {\n    const index = lists.findIndex((l) => l.id === list.id);\n    if (index !== -1) {\n      lists[index] = list;\n      lists.sort((a, b) => a.title.localeCompare(b.title));\n      store.account.set('lists', {\n        lists,\n        updatedAt: Date.now(),\n      });\n    }\n  }\n}\n\nexport function deleteListStore(listID) {\n  const { lists } = store.account.get('lists') || {};\n  if (lists?.length) {\n    const index = lists.findIndex((l) => l.id === listID);\n    if (index !== -1) {\n      lists.splice(index, 1);\n      store.account.set('lists', {\n        lists,\n        updatedAt: Date.now(),\n      });\n    }\n  }\n}\n","import './list-exclusive-badge.css';\n\nimport { useLingui } from '@lingui/react/macro';\n\nimport Icon from './icon';\n\nfunction ListExclusiveBadge({ insignificant }) {\n  const { t } = useLingui();\n  return (\n    <Icon\n      icon=\"filter\"\n      size=\"xs\"\n      class={`list-exclusive-badge ${insignificant ? 'insignificant' : ''}`}\n      title={t`Posts on this list are hidden from Home/Following`}\n    />\n  );\n}\n\nexport default ListExclusiveBadge;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport { addListStore, deleteListStore, updateListStore } from '../utils/lists';\nimport supports from '../utils/supports';\n\nimport Icon from './icon';\nimport ListExclusiveBadge from './list-exclusive-badge';\nimport MenuConfirm from './menu-confirm';\n\nfunction ListAddEdit({ list, onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const editMode = !!list;\n  const nameFieldRef = useRef();\n  const repliesPolicyFieldRef = useRef();\n  const exclusiveFieldRef = useRef();\n  useEffect(() => {\n    if (editMode) {\n      nameFieldRef.current.value = list.title;\n      repliesPolicyFieldRef.current.value = list.repliesPolicy;\n      if (exclusiveFieldRef.current) {\n        exclusiveFieldRef.current.checked = list.exclusive;\n      }\n    }\n  }, [editMode]);\n  const supportsExclusive =\n    supports('@mastodon/list-exclusive') ||\n    supports('@gotosocial/list-exclusive');\n\n  return (\n    <div class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}{' '}\n      <header>\n        <h2>{editMode ? t`Edit list` : t`New list`}</h2>\n      </header>\n      <main>\n        <form\n          class=\"list-form\"\n          onSubmit={(e) => {\n            e.preventDefault(); // Get form values\n\n            const formData = new FormData(e.target);\n            const title = formData.get('title');\n            const repliesPolicy = formData.get('replies_policy');\n            const exclusive = formData.get('exclusive') === 'on';\n            console.log({\n              title,\n              repliesPolicy,\n              exclusive,\n            });\n            setUIState('loading');\n\n            (async () => {\n              try {\n                let listResult;\n\n                if (editMode) {\n                  listResult = await masto.v1.lists.$select(list.id).update({\n                    title,\n                    replies_policy: repliesPolicy,\n                    exclusive,\n                  });\n                } else {\n                  listResult = await masto.v1.lists.create({\n                    title,\n                    replies_policy: repliesPolicy,\n                    exclusive,\n                  });\n                }\n\n                console.log(listResult);\n                setUIState('default');\n                onClose?.({\n                  state: 'success',\n                  list: listResult,\n                });\n\n                setTimeout(() => {\n                  if (editMode) {\n                    updateListStore(listResult);\n                  } else {\n                    addListStore(listResult);\n                  }\n                }, 1);\n              } catch (e) {\n                console.error(e);\n                setUIState('error');\n                alert(\n                  editMode\n                    ? t`Unable to edit list.`\n                    : t`Unable to create list.`,\n                );\n              }\n            })();\n          }}\n        >\n          <div class=\"list-form-row\">\n            <label for=\"list-title\">\n              <Trans>Name</Trans>{' '}\n              <input\n                ref={nameFieldRef}\n                type=\"text\"\n                id=\"list-title\"\n                name=\"title\"\n                required\n                disabled={uiState === 'loading'}\n                dir=\"auto\"\n              />\n            </label>\n          </div>\n          <div class=\"list-form-row\">\n            <select\n              ref={repliesPolicyFieldRef}\n              name=\"replies_policy\"\n              required\n              disabled={uiState === 'loading'}\n            >\n              <option value=\"list\">\n                <Trans>Show replies to list members</Trans>\n              </option>\n              <option value=\"followed\">\n                <Trans>Show replies to people I follow</Trans>\n              </option>\n              <option value=\"none\">\n                <Trans>Don't show replies</Trans>\n              </option>\n            </select>\n          </div>\n          {supportsExclusive && (\n            <div class=\"list-form-row\">\n              <label class=\"label-block\">\n                <input\n                  ref={exclusiveFieldRef}\n                  type=\"checkbox\"\n                  name=\"exclusive\"\n                  disabled={uiState === 'loading'}\n                />{' '}\n                <ListExclusiveBadge insignificant />{' '}\n                <Trans>Hide posts on this list from Home/Following</Trans>\n              </label>\n            </div>\n          )}\n          <div class=\"list-form-footer\">\n            <button type=\"submit\" disabled={uiState === 'loading'}>\n              {editMode ? t`Save` : t`Create`}\n            </button>\n            {editMode && (\n              <MenuConfirm\n                disabled={uiState === 'loading'}\n                align=\"end\"\n                menuItemClassName=\"danger\"\n                confirmLabel={t`Delete this list?`}\n                onClick={() => {\n                  // const yes = confirm('Delete this list?');\n                  // if (!yes) return;\n                  setUIState('loading');\n\n                  (async () => {\n                    try {\n                      await masto.v1.lists.$select(list.id).remove();\n                      setUIState('default');\n                      onClose?.({\n                        state: 'deleted',\n                      });\n                      setTimeout(() => {\n                        deleteListStore(list.id);\n                      }, 1);\n                    } catch (e) {\n                      console.error(e);\n                      setUIState('error');\n                      alert(t`Unable to delete list.`);\n                    }\n                  })();\n                }}\n              >\n                <button\n                  type=\"button\"\n                  class=\"light danger\"\n                  disabled={uiState === 'loading'}\n                >\n                  <Trans>Delete</Trans>\n                </button>\n              </MenuConfirm>\n            )}\n          </div>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nexport default ListAddEdit;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useReducer, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport { getLists } from '../utils/lists';\n\nimport Icon from './icon';\nimport ListAddEdit from './list-add-edit';\nimport Loader from './loader';\nimport Modal from './modal';\n\nfunction AddRemoveListsSheet({ accountID, onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [lists, setLists] = useState([]);\n  const [listsContainingAccount, setListsContainingAccount] = useState([]);\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const lists = await getLists();\n        setLists(lists);\n        const listsContainingAccount = await masto.v1.accounts\n          .$select(accountID)\n          .lists.list();\n        console.log({ lists, listsContainingAccount });\n        setListsContainingAccount(listsContainingAccount);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  const [showListAddEditModal, setShowListAddEditModal] = useState(false);\n\n  return (\n    <div class=\"sheet\" id=\"list-add-remove-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Add/Remove from Lists</Trans>\n        </h2>\n      </header>\n      <main>\n        {lists.length > 0 ? (\n          <ul class=\"list-add-remove\">\n            {lists.map((list) => {\n              const inList = listsContainingAccount.some(\n                (l) => l.id === list.id,\n              );\n              return (\n                <li>\n                  <button\n                    type=\"button\"\n                    class={`light ${inList ? 'checked' : ''}`}\n                    disabled={uiState === 'loading'}\n                    onClick={() => {\n                      setUIState('loading');\n                      (async () => {\n                        try {\n                          if (inList) {\n                            await masto.v1.lists\n                              .$select(list.id)\n                              .accounts.remove({\n                                accountIds: [accountID],\n                              });\n                          } else {\n                            await masto.v1.lists\n                              .$select(list.id)\n                              .accounts.create({\n                                accountIds: [accountID],\n                              });\n                          }\n                          // setUIState('default');\n                          reload();\n                        } catch (e) {\n                          console.error(e);\n                          setUIState('error');\n                          alert(\n                            inList\n                              ? t`Unable to remove from list.`\n                              : t`Unable to add to list.`,\n                          );\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"check-circle\" alt=\"\" />\n                    <span>{list.title}</span>\n                  </button>\n                </li>\n              );\n            })}\n          </ul>\n        ) : uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : uiState === 'error' ? (\n          <p class=\"ui-state\">\n            <Trans>Unable to load lists.</Trans>\n          </p>\n        ) : (\n          <p class=\"ui-state\">\n            <Trans>No lists.</Trans>\n          </p>\n        )}\n        <button\n          type=\"button\"\n          class=\"plain2\"\n          onClick={() => setShowListAddEditModal(true)}\n          disabled={uiState !== 'default'}\n        >\n          <Icon icon=\"plus\" size=\"l\" />{' '}\n          <span>\n            <Trans>New list</Trans>\n          </span>\n        </button>\n      </main>\n      {showListAddEditModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowListAddEditModal(false);\n            }\n          }}\n        >\n          <ListAddEdit\n            list={showListAddEditModal?.list}\n            onClose={(result) => {\n              if (result.state === 'success') {\n                reload();\n              }\n              setShowListAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nexport default AddRemoveListsSheet;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nfunction PrivateNoteSheet({\n  account,\n  note: initialNote,\n  onRelationshipChange = () => {},\n  onClose = () => {},\n}) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const textareaRef = useRef(null);\n\n  useEffect(() => {\n    let timer;\n    if (textareaRef.current && !initialNote) {\n      timer = setTimeout(() => {\n        textareaRef.current.focus?.();\n      }, 100);\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, []);\n\n  return (\n    <div class=\"sheet\" id=\"private-note-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <b>\n          <Trans>\n            Private note about{' '}\n            <span class=\"bidi-isolate\">\n              @{account?.username || account?.acct}\n            </span>\n          </Trans>\n        </b>\n      </header>\n      <main>\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n            const formData = new FormData(e.target);\n            const note = formData.get('note');\n            if (note?.trim() !== initialNote?.trim()) {\n              setUIState('loading');\n              (async () => {\n                try {\n                  const newRelationship = await masto.v1.accounts\n                    .$select(account?.id)\n                    .note.create({\n                      comment: note,\n                    });\n                  console.log('updated relationship', newRelationship);\n                  setUIState('default');\n                  onRelationshipChange(newRelationship);\n                  onClose();\n                } catch (e) {\n                  console.error(e);\n                  setUIState('error');\n                  alert(e?.message || t`Unable to update private note.`);\n                }\n              })();\n            }\n          }}\n        >\n          <textarea\n            ref={textareaRef}\n            name=\"note\"\n            disabled={uiState === 'loading'}\n            dir=\"auto\"\n          >\n            {initialNote}\n          </textarea>\n          <footer>\n            <button\n              type=\"button\"\n              class=\"light\"\n              disabled={uiState === 'loading'}\n              onClick={() => {\n                onClose?.();\n              }}\n            >\n              <Trans>Cancel</Trans>\n            </button>\n            <span>\n              <Loader abrupt hidden={uiState !== 'loading'} />\n              <button disabled={uiState === 'loading'} type=\"submit\">\n                <Trans>Save &amp; close</Trans>\n              </button>\n            </span>\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nexport default PrivateNoteSheet;\n","import { Trans, useLingui } from '@lingui/react/macro';\n\nimport getHTMLText from '../utils/getHTMLText';\n\nimport Icon from './icon';\nimport TranslationBlock from './translation-block';\n\nfunction TranslatedBioSheet({ note, fields, onClose }) {\n  const { t } = useLingui();\n  const fieldsText =\n    fields\n      ?.map(({ name, value }) => `${name}\\n${getHTMLText(value)}`)\n      .join('\\n\\n') || '';\n\n  const text = getHTMLText(note) + (fieldsText ? `\\n\\n${fieldsText}` : '');\n\n  return (\n    <div class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Translated Bio</Trans>\n        </h2>\n      </header>\n      <main>\n        <p\n          style={{\n            whiteSpace: 'pre-wrap',\n          }}\n        >\n          {text}\n        </p>\n        <TranslationBlock forceTranslate text={text} />\n      </main>\n    </div>\n  );\n}\n\nexport default TranslatedBioSheet;\n","import { msg } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport punycode from 'punycode/';\n\nimport { api } from '../utils/api';\nimport i18nDuration from '../utils/i18n-duration';\nimport niceDateTime from '../utils/nice-date-time';\nimport showCompose from '../utils/show-compose';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport { getCurrentAccountID, updateAccount } from '../utils/store-utils';\nimport supports from '../utils/supports';\n\nimport { handleScannerClick } from './account-info';\nimport AddRemoveListsSheet from './add-remove-lists-sheet';\nimport Icon from './icon';\nimport Loader from './loader';\nimport MenuConfirm from './menu-confirm';\nimport Menu2 from './menu2';\nimport Modal from './modal';\nimport PrivateNoteSheet from './private-note-sheet';\nimport SubMenu2 from './submenu2';\nimport TranslatedBioSheet from './translated-bio-sheet';\n\nconst MUTE_DURATIONS = [\n  60 * 5, // 5 minutes\n  60 * 30, // 30 minutes\n  60 * 60, // 1 hour\n  60 * 60 * 6, // 6 hours\n  60 * 60 * 24, // 1 day\n  60 * 60 * 24 * 3, // 3 days\n  60 * 60 * 24 * 7, // 1 week\n  60 * 60 * 24 * 30, // 30 days\n  0, // forever\n];\nconst MUTE_DURATIONS_LABELS = {\n  0: msg`Forever`,\n  300: i18nDuration(5, 'minute'),\n  1_800: i18nDuration(30, 'minute'),\n  3_600: i18nDuration(1, 'hour'),\n  21_600: i18nDuration(6, 'hour'),\n  86_400: i18nDuration(1, 'day'),\n  259_200: i18nDuration(3, 'day'),\n  604_800: i18nDuration(1, 'week'),\n  2592_000: i18nDuration(30, 'day'),\n};\n\nfunction RelatedActions({\n  info,\n  instance,\n  standalone,\n  authenticated,\n  onRelationshipChange = () => {},\n  setShowEditProfile = () => {},\n  showEndorsements = false,\n  renderEndorsements = false,\n  setRenderEndorsements = () => {},\n}) {\n  if (!info) return null;\n  const { _, t } = useLingui();\n  const {\n    masto: currentMasto,\n    instance: currentInstance,\n    authenticated: currentAuthenticated,\n  } = api();\n  const sameInstance = instance === currentInstance;\n\n  const [relationshipUIState, setRelationshipUIState] = useState('default');\n  const [relationship, setRelationship] = useState(null);\n\n  const { id, acct, url, username, locked, lastStatusAt, note, fields, moved } =\n    info;\n  const accountID = useRef(id);\n\n  const {\n    following,\n    showingReblogs,\n    notifying,\n    followedBy,\n    blocking,\n    blockedBy,\n    muting,\n    mutingNotifications,\n    requested,\n    domainBlocking,\n    endorsed,\n    note: privateNote,\n  } = relationship || {};\n\n  const [currentInfo, setCurrentInfo] = useState(null);\n  const [isSelf, setIsSelf] = useState(false);\n\n  const acctWithInstance = acct.includes('@') ? acct : `${acct}@${instance}`;\n\n  const supportsEndorsements = supports('@mastodon/endorsements');\n\n  useEffect(() => {\n    if (info) {\n      const currentAccount = getCurrentAccountID();\n      let currentID;\n      (async () => {\n        if (sameInstance && authenticated) {\n          currentID = id;\n        } else if (!sameInstance && currentAuthenticated) {\n          // Grab this account from my logged-in instance\n          const acctHasInstance = info.acct.includes('@');\n          try {\n            const results = await currentMasto.v2.search.list({\n              q: acctHasInstance ? info.acct : `${info.username}@${instance}`,\n              type: 'accounts',\n              limit: 1,\n              resolve: true,\n            });\n            console.log(' Fetched account from logged-in instance', results);\n            if (results.accounts.length) {\n              currentID = results.accounts[0].id;\n              setCurrentInfo(results.accounts[0]);\n            }\n          } catch (e) {\n            console.error(e);\n          }\n        }\n\n        if (!currentID) return;\n\n        if (currentAccount === currentID) {\n          // It's myself!\n          setIsSelf(true);\n          return;\n        }\n\n        accountID.current = currentID;\n\n        // if (moved) return;\n\n        setRelationshipUIState('loading');\n\n        const fetchRelationships = currentMasto.v1.accounts.relationships.fetch(\n          {\n            id: [currentID],\n          },\n        );\n\n        try {\n          const relationships = await fetchRelationships;\n          console.log('fetched relationship', relationships);\n          setRelationshipUIState('default');\n\n          if (relationships.length) {\n            const relationship = relationships[0];\n            setRelationship(relationship);\n            onRelationshipChange({ relationship, currentID });\n          }\n        } catch (e) {\n          console.error(e);\n          setRelationshipUIState('error');\n        }\n      })();\n    }\n  }, [info, authenticated]);\n\n  useEffect(() => {\n    if (info && isSelf) {\n      updateAccount(info);\n    }\n  }, [info, isSelf]);\n\n  const loading = relationshipUIState === 'loading';\n\n  const [showTranslatedBio, setShowTranslatedBio] = useState(false);\n  const [showAddRemoveLists, setShowAddRemoveLists] = useState(false);\n  const [showPrivateNoteModal, setShowPrivateNoteModal] = useState(false);\n  const [lists, setLists] = useState([]);\n\n  let { headerStatic, avatarStatic } = info;\n  if (!headerStatic || /missing\\.png$/.test(headerStatic)) {\n    if (avatarStatic && !/missing\\.png$/.test(avatarStatic)) {\n      headerStatic = avatarStatic;\n    }\n  }\n\n  return (\n    <>\n      <div class=\"actions\">\n        <span>\n          {followedBy ? (\n            <span class=\"tag\">\n              <Trans>Follows you</Trans>\n            </span>\n          ) : !!lastStatusAt ? (\n            <small class=\"insignificant\">\n              <Trans>\n                Last post:{' '}\n                <span class=\"ib\">\n                  {niceDateTime(lastStatusAt, {\n                    hideTime: true,\n                  })}\n                </span>\n              </Trans>\n            </small>\n          ) : (\n            <span />\n          )}\n          {muting && (\n            <span class=\"tag danger\">\n              <Trans>Muted</Trans>\n            </span>\n          )}\n          {blocking && (\n            <span class=\"tag danger\">\n              <Trans>Blocked</Trans>\n            </span>\n          )}\n        </span>{' '}\n        <span class=\"buttons\">\n          {!!privateNote && (\n            <button\n              type=\"button\"\n              class=\"private-note-tag\"\n              title={t`Private note`}\n              onClick={() => {\n                setShowPrivateNoteModal(true);\n              }}\n              dir=\"auto\"\n            >\n              <span>{privateNote}</span>\n            </button>\n          )}\n          {currentAuthenticated && isSelf && (\n            <button\n              type=\"button\"\n              class=\"plain\"\n              onClick={() => {\n                states.showQrCodeModal = {\n                  text: url,\n                  arena: avatarStatic,\n                  backgroundMask: headerStatic,\n                  caption: acct.includes('@') ? acct : `${acct}@${instance}`,\n                  onScannerClick: handleScannerClick,\n                };\n              }}\n            >\n              <Icon icon=\"qrcode\" alt={t`QR code`} />\n            </button>\n          )}\n          <Menu2\n            portal={{\n              target: document.body,\n            }}\n            containerProps={{\n              style: {\n                // Higher than the backdrop\n                zIndex: 1001,\n              },\n            }}\n            align=\"center\"\n            position=\"anchor\"\n            overflow=\"auto\"\n            menuButton={\n              <button type=\"button\" class=\"plain4\" disabled={loading}>\n                <Icon icon=\"more2\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n            onMenuChange={(e) => {\n              if (following && e.open) {\n                // Fetch lists that have this account\n                (async () => {\n                  try {\n                    const lists = await currentMasto.v1.accounts\n                      .$select(accountID.current)\n                      .lists.list();\n                    console.log('fetched account lists', lists);\n                    setLists(lists);\n                  } catch (e) {\n                    console.error(e);\n                  }\n                })();\n              }\n            }}\n          >\n            {currentAuthenticated && !isSelf ? (\n              <>\n                <MenuItem\n                  onClick={() => {\n                    showCompose({\n                      draftStatus: {\n                        status: `@${currentInfo?.acct || acct} `,\n                      },\n                    });\n                  }}\n                >\n                  <Icon icon=\"at\" />\n                  <span>\n                    <Trans>\n                      Mention <span class=\"bidi-isolate\">@{username}</span>\n                    </Trans>\n                  </span>\n                </MenuItem>\n                <MenuItem\n                  onClick={() => {\n                    setShowTranslatedBio(true);\n                  }}\n                >\n                  <Icon icon=\"translate\" />\n                  <span>\n                    <Trans>Translate bio</Trans>\n                  </span>\n                </MenuItem>\n                {supports('@mastodon/profile-private-note') && (\n                  <MenuItem\n                    onClick={() => {\n                      setShowPrivateNoteModal(true);\n                    }}\n                  >\n                    <Icon icon=\"pencil\" />\n                    <span>\n                      {privateNote ? t`Edit private note` : t`Add private note`}\n                    </span>\n                  </MenuItem>\n                )}\n                {following && !!relationship && (\n                  <>\n                    <MenuItem\n                      onClick={() => {\n                        setRelationshipUIState('loading');\n                        (async () => {\n                          try {\n                            const rel = await currentMasto.v1.accounts\n                              .$select(accountID.current)\n                              .follow({\n                                notify: !notifying,\n                              });\n                            if (rel) setRelationship(rel);\n                            setRelationshipUIState('default');\n                            showToast(\n                              rel.notifying\n                                ? t`Notifications enabled for @${username}'s posts.`\n                                : t` Notifications disabled for @${username}'s posts.`,\n                            );\n                          } catch (e) {\n                            alert(e);\n                            setRelationshipUIState('error');\n                          }\n                        })();\n                      }}\n                    >\n                      <Icon icon=\"notification\" />\n                      <span>\n                        {notifying\n                          ? t`Disable notifications`\n                          : t`Enable notifications`}\n                      </span>\n                    </MenuItem>\n                    <MenuItem\n                      onClick={() => {\n                        setRelationshipUIState('loading');\n                        (async () => {\n                          try {\n                            const rel = await currentMasto.v1.accounts\n                              .$select(accountID.current)\n                              .follow({\n                                reblogs: !showingReblogs,\n                              });\n                            if (rel) setRelationship(rel);\n                            setRelationshipUIState('default');\n                            showToast(\n                              rel.showingReblogs\n                                ? t`Boosts from @${username} enabled.`\n                                : t`Boosts from @${username} disabled.`,\n                            );\n                          } catch (e) {\n                            alert(e);\n                            setRelationshipUIState('error');\n                          }\n                        })();\n                      }}\n                    >\n                      <Icon icon=\"rocket\" />\n                      <span>\n                        {showingReblogs ? t`Disable boosts` : t`Enable boosts`}\n                      </span>\n                    </MenuItem>\n                  </>\n                )}\n                {supportsEndorsements && following && (\n                  <MenuItem\n                    onClick={() => {\n                      setRelationshipUIState('loading');\n                      (async () => {\n                        try {\n                          if (endorsed) {\n                            const newRelationship =\n                              await currentMasto.v1.accounts\n                                .$select(currentInfo?.id || id)\n                                .unpin();\n                            setRelationship(newRelationship);\n                            setRelationshipUIState('default');\n                            showToast(\n                              t`@${username} is no longer featured on your profile.`,\n                            );\n                          } else {\n                            const newRelationship =\n                              await currentMasto.v1.accounts\n                                .$select(currentInfo?.id || id)\n                                .pin();\n                            setRelationship(newRelationship);\n                            setRelationshipUIState('default');\n                            showToast(\n                              t`@${username} is now featured on your profile.`,\n                            );\n                          }\n                        } catch (e) {\n                          console.error(e);\n                          setRelationshipUIState('error');\n                          if (endorsed) {\n                            showToast(\n                              t`Unable to unfeature @${username} on your profile.`,\n                            );\n                          } else {\n                            showToast(\n                              t`Unable to feature @${username} on your profile.`,\n                            );\n                          }\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"endorsement\" />\n                    {endorsed\n                      ? t`Don't feature on profile`\n                      : t`Feature on profile`}\n                  </MenuItem>\n                )}\n                {showEndorsements &&\n                  supportsEndorsements &&\n                  !renderEndorsements && (\n                    <MenuItem onClick={() => setRenderEndorsements(true)}>\n                      <Icon icon=\"endorsement\" />\n                      <span>\n                        <Trans>Show featured profiles</Trans>\n                      </span>\n                    </MenuItem>\n                  )}\n                {/* Add/remove from lists is only possible if following the account */}\n                {following && (\n                  <MenuItem\n                    onClick={() => {\n                      setShowAddRemoveLists(true);\n                    }}\n                  >\n                    <Icon icon=\"list\" />\n                    {lists.length ? (\n                      <>\n                        <small class=\"menu-grow\">\n                          <Trans>Add/Remove from Lists</Trans>\n                          <br />\n                          <span class=\"more-insignificant\">\n                            {lists.map((list) => list.title).join(', ')}\n                          </span>\n                        </small>\n                        <small class=\"more-insignificant\">{lists.length}</small>\n                      </>\n                    ) : (\n                      <span>\n                        <Trans>Add/Remove from Lists</Trans>\n                      </span>\n                    )}\n                  </MenuItem>\n                )}\n                <MenuDivider />\n              </>\n            ) : (\n              supportsEndorsements &&\n              !renderEndorsements && (\n                <>\n                  <MenuItem onClick={() => setRenderEndorsements(true)}>\n                    <Icon icon=\"endorsement\" />\n                    <Trans>Show featured profiles</Trans>\n                  </MenuItem>\n                  <MenuDivider />\n                </>\n              )\n            )}\n            <MenuItem\n              onClick={() => {\n                const handle = `@${currentInfo?.acct || acctWithInstance}`;\n                try {\n                  navigator.clipboard.writeText(handle);\n                  showToast(t`Handle copied`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to copy handle`);\n                }\n              }}\n            >\n              <Icon icon=\"copy\" />\n              <small>\n                <Trans>Copy handle</Trans>\n                <br />\n                <span class=\"more-insignificant bidi-isolate\">\n                  @{currentInfo?.acct || acctWithInstance}\n                </span>\n              </small>\n            </MenuItem>\n            <MenuItem href={url} target=\"_blank\">\n              <Icon icon=\"external\" />\n              <small class=\"menu-double-lines\">{niceAccountURL(url)}</small>\n            </MenuItem>\n            <div class=\"menu-horizontal\">\n              <MenuItem\n                onClick={() => {\n                  // Copy url to clipboard\n                  try {\n                    navigator.clipboard.writeText(url);\n                    showToast(t`Link copied`);\n                  } catch (e) {\n                    console.error(e);\n                    showToast(t`Unable to copy link`);\n                  }\n                }}\n              >\n                <Icon icon=\"link\" />\n                <span>\n                  <Trans>Copy</Trans>\n                </span>\n              </MenuItem>\n              {navigator?.share &&\n                navigator?.canShare?.({\n                  url,\n                }) && (\n                  <MenuItem\n                    onClick={() => {\n                      try {\n                        navigator.share({\n                          url,\n                        });\n                      } catch (e) {\n                        console.error(e);\n                        alert(t`Sharing doesn't seem to work.`);\n                      }\n                    }}\n                  >\n                    <Icon icon=\"share\" />\n                    <span>\n                      <Trans>Share</Trans>\n                    </span>\n                  </MenuItem>\n                )}\n            </div>\n            <MenuItem\n              onClick={() => {\n                states.showQrCodeModal = {\n                  text: url,\n                  arena: avatarStatic,\n                  backgroundMask: headerStatic,\n                  caption: acct.includes('@') ? acct : `${acct}@${instance}`,\n                  onScannerClick: handleScannerClick,\n                };\n              }}\n            >\n              <Icon icon=\"qrcode\" />\n              <span>\n                <Trans>QR code</Trans>\n              </span>\n            </MenuItem>\n            {!!relationship && (\n              <>\n                <MenuDivider />\n                {muting ? (\n                  <MenuItem\n                    onClick={() => {\n                      setRelationshipUIState('loading');\n                      (async () => {\n                        try {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .unmute();\n                          console.log('unmuting', newRelationship);\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`Unmuted @${username}`);\n                          states.reloadGenericAccounts.id = 'mute';\n                          states.reloadGenericAccounts.counter++;\n                        } catch (e) {\n                          console.error(e);\n                          setRelationshipUIState('error');\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"unmute\" />\n                    <span>\n                      <Trans>\n                        Unmute <span class=\"bidi-isolate\">@{username}</span>\n                      </Trans>\n                    </span>\n                  </MenuItem>\n                ) : (\n                  <SubMenu2\n                    menuClassName=\"menu-blur\"\n                    openTrigger=\"clickOnly\"\n                    direction=\"bottom\"\n                    overflow=\"auto\"\n                    shift={16}\n                    label={\n                      <>\n                        <Icon icon=\"mute\" />\n                        <span class=\"menu-grow\">\n                          <Trans>\n                            Mute <span class=\"bidi-isolate\">@{username}</span>\n                          </Trans>\n                        </span>\n                        <span\n                          style={{\n                            textOverflow: 'clip',\n                          }}\n                        >\n                          <Icon icon=\"time\" />\n                          <Icon icon=\"chevron-right\" />\n                        </span>\n                      </>\n                    }\n                  >\n                    <div class=\"menu-wrap\">\n                      {MUTE_DURATIONS.map((duration) => (\n                        <MenuItem\n                          onClick={() => {\n                            setRelationshipUIState('loading');\n                            (async () => {\n                              try {\n                                const newRelationship =\n                                  await currentMasto.v1.accounts\n                                    .$select(currentInfo?.id || id)\n                                    .mute({\n                                      duration,\n                                    });\n                                console.log('muting', newRelationship);\n                                setRelationship(newRelationship);\n                                setRelationshipUIState('default');\n                                showToast(\n                                  t`Muted @${username} for ${\n                                    typeof MUTE_DURATIONS_LABELS[duration] ===\n                                    'function'\n                                      ? MUTE_DURATIONS_LABELS[duration]()\n                                      : _(MUTE_DURATIONS_LABELS[duration])\n                                  }`,\n                                );\n                                states.reloadGenericAccounts.id = 'mute';\n                                states.reloadGenericAccounts.counter++;\n                              } catch (e) {\n                                console.error(e);\n                                setRelationshipUIState('error');\n                                showToast(t`Unable to mute @${username}`);\n                              }\n                            })();\n                          }}\n                        >\n                          {typeof MUTE_DURATIONS_LABELS[duration] === 'function'\n                            ? MUTE_DURATIONS_LABELS[duration]()\n                            : _(MUTE_DURATIONS_LABELS[duration])}\n                        </MenuItem>\n                      ))}\n                    </div>\n                  </SubMenu2>\n                )}\n                {followedBy && (\n                  <MenuConfirm\n                    subMenu\n                    menuItemClassName=\"danger\"\n                    confirmLabel={\n                      <>\n                        <Icon icon=\"user-x\" />\n                        <span>\n                          <Trans>\n                            Remove <span class=\"bidi-isolate\">@{username}</span>{' '}\n                            from followers?\n                          </Trans>\n                        </span>\n                      </>\n                    }\n                    onClick={() => {\n                      setRelationshipUIState('loading');\n                      (async () => {\n                        try {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .removeFromFollowers();\n                          console.log(\n                            'removing from followers',\n                            newRelationship,\n                          );\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`@${username} removed from followers`);\n                          states.reloadGenericAccounts.id = 'followers';\n                          states.reloadGenericAccounts.counter++;\n                        } catch (e) {\n                          console.error(e);\n                          setRelationshipUIState('error');\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"user-x\" />\n                    <span>\n                      <Trans>Remove follower</Trans>\n                    </span>\n                  </MenuConfirm>\n                )}\n                <MenuConfirm\n                  subMenu\n                  confirm={!blocking}\n                  confirmLabel={\n                    <>\n                      <Icon icon=\"block\" />\n                      <span>\n                        <Trans>\n                          Block <span class=\"bidi-isolate\">@{username}</span>?\n                        </Trans>\n                      </span>\n                    </>\n                  }\n                  itemProps={{\n                    className: 'danger',\n                  }}\n                  menuItemClassName=\"danger\"\n                  onClick={() => {\n                    // if (!blocking && !confirm(`Block @${username}?`)) {\n                    //   return;\n                    // }\n                    setRelationshipUIState('loading');\n                    (async () => {\n                      try {\n                        if (blocking) {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .unblock();\n                          console.log('unblocking', newRelationship);\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`Unblocked @${username}`);\n                        } else {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .block();\n                          console.log('blocking', newRelationship);\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`Blocked @${username}`);\n                        }\n                        states.reloadGenericAccounts.id = 'block';\n                        states.reloadGenericAccounts.counter++;\n                      } catch (e) {\n                        console.error(e);\n                        setRelationshipUIState('error');\n                        if (blocking) {\n                          showToast(t`Unable to unblock @${username}`);\n                        } else {\n                          showToast(t`Unable to block @${username}`);\n                        }\n                      }\n                    })();\n                  }}\n                >\n                  {blocking ? (\n                    <>\n                      <Icon icon=\"unblock\" />\n                      <span>\n                        <Trans>\n                          Unblock <span class=\"bidi-isolate\">@{username}</span>\n                        </Trans>\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <Icon icon=\"block\" />\n                      <span>\n                        <Trans>\n                          Block <span class=\"bidi-isolate\">@{username}</span>\n                        </Trans>\n                      </span>\n                    </>\n                  )}\n                </MenuConfirm>\n                <MenuItem\n                  className=\"danger\"\n                  onClick={() => {\n                    states.showReportModal = {\n                      account: currentInfo || info,\n                    };\n                  }}\n                >\n                  <Icon icon=\"flag\" />\n                  <span>\n                    <Trans>\n                      Report <span class=\"bidi-isolate\">@{username}</span>\n                    </Trans>\n                  </span>\n                </MenuItem>\n              </>\n            )}\n            {currentAuthenticated &&\n              isSelf &&\n              standalone &&\n              supports('@mastodon/profile-edit') && (\n                <>\n                  <MenuDivider />\n                  <MenuItem\n                    onClick={() => {\n                      setShowEditProfile(true);\n                    }}\n                  >\n                    <Icon icon=\"pencil\" />\n                    <span>\n                      <Trans>Edit profile</Trans>\n                    </span>\n                  </MenuItem>\n                </>\n              )}\n            {import.meta.env.DEV && currentAuthenticated && isSelf && (\n              <>\n                <MenuDivider />\n                <MenuItem\n                  onClick={async () => {\n                    const relationships =\n                      await currentMasto.v1.accounts.relationships.fetch({\n                        id: [accountID.current],\n                      });\n                    const { note } = relationships[0] || {};\n                    if (note) {\n                      alert(note);\n                      console.log(note);\n                    }\n                  }}\n                >\n                  <Icon icon=\"pencil\" />\n                  <span>See note</span>\n                </MenuItem>\n              </>\n            )}\n          </Menu2>\n          {!relationship && relationshipUIState === 'loading' && (\n            <Loader abrupt />\n          )}\n          {!!relationship && !moved && (\n            <MenuConfirm\n              confirm={following || requested}\n              confirmLabel={\n                <span>\n                  {requested\n                    ? t`Withdraw follow request?`\n                    : t`Unfollow @${info.acct || info.username}?`}\n                </span>\n              }\n              menuItemClassName=\"danger\"\n              align=\"end\"\n              disabled={loading}\n              onClick={() => {\n                setRelationshipUIState('loading');\n                (async () => {\n                  try {\n                    let newRelationship;\n\n                    if (following || requested) {\n                      // const yes = confirm(\n                      //   requested\n                      //     ? 'Withdraw follow request?'\n                      //     : `Unfollow @${info.acct || info.username}?`,\n                      // );\n\n                      // if (yes) {\n                      newRelationship = await currentMasto.v1.accounts\n                        .$select(accountID.current)\n                        .unfollow();\n                      // }\n                    } else {\n                      newRelationship = await currentMasto.v1.accounts\n                        .$select(accountID.current)\n                        .follow();\n                    }\n\n                    if (newRelationship) {\n                      setRelationship(newRelationship);\n\n                      // Show endorsements if start following\n                      if (\n                        showEndorsements &&\n                        supportsEndorsements &&\n                        !renderEndorsements &&\n                        newRelationship.following\n                      ) {\n                        setRenderEndorsements('onlyOpenIfHasEndorsements');\n                      }\n                    }\n                    setRelationshipUIState('default');\n                  } catch (e) {\n                    alert(e);\n                    setRelationshipUIState('error');\n                  }\n                })();\n              }}\n            >\n              <button\n                type=\"button\"\n                class={`${following || requested ? 'light swap' : ''}`}\n                data-swap-state={following || requested ? 'danger' : ''}\n                disabled={loading}\n              >\n                {following ? (\n                  <>\n                    <span>\n                      <Trans>Following</Trans>\n                    </span>\n                    <span>\n                      <Trans>Unfollow</Trans>\n                    </span>\n                  </>\n                ) : requested ? (\n                  <>\n                    <span>\n                      <Trans>Requested</Trans>\n                    </span>\n                    <span>\n                      <Trans>Withdraw</Trans>\n                    </span>\n                  </>\n                ) : locked ? (\n                  <>\n                    <Icon icon=\"lock\" />{' '}\n                    <span>\n                      <Trans>Follow</Trans>\n                    </span>\n                  </>\n                ) : (\n                  t`Follow`\n                )}\n              </button>\n            </MenuConfirm>\n          )}\n        </span>\n      </div>\n      {!!showTranslatedBio && (\n        <Modal\n          onClose={() => {\n            setShowTranslatedBio(false);\n          }}\n        >\n          <TranslatedBioSheet\n            note={note}\n            fields={fields}\n            onClose={() => setShowTranslatedBio(false)}\n          />\n        </Modal>\n      )}\n      {!!showAddRemoveLists && (\n        <Modal\n          onClose={() => {\n            setShowAddRemoveLists(false);\n          }}\n        >\n          <AddRemoveListsSheet\n            accountID={accountID.current}\n            onClose={() => setShowAddRemoveLists(false)}\n          />\n        </Modal>\n      )}\n      {!!showPrivateNoteModal && (\n        <Modal\n          onClose={() => {\n            setShowPrivateNoteModal(false);\n          }}\n        >\n          <PrivateNoteSheet\n            account={info}\n            note={privateNote}\n            onRelationshipChange={(relationship) => {\n              setRelationship(relationship);\n              // onRelationshipChange({ relationship, currentID: accountID.current });\n            }}\n            onClose={() => setShowPrivateNoteModal(false)}\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n\nfunction niceAccountURL(url) {\n  if (!url) return;\n  const urlObj = URL.parse(url);\n  if (!urlObj) return;\n  const { host, pathname } = urlObj;\n  const path = pathname.replace(/\\/$/, '').replace(/^\\//, '');\n  return (\n    <>\n      <span class=\"more-insignificant\">{punycode.toUnicode(host)}/</span>\n      <wbr />\n      <span>{path}</span>\n    </>\n  );\n}\n\nexport default RelatedActions;\n","import './account-info.css';\n\nimport { msg, plural } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport enhanceContent from '../utils/enhance-content';\nimport getDomain from '../utils/get-domain';\nimport handleContentLinks from '../utils/handle-content-links';\nimport niceDateTime from '../utils/nice-date-time';\nimport pmem from '../utils/pmem';\nimport { supportsNativeQuote } from '../utils/quote-utils';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { hideAllModals } from '../utils/states';\nimport {\n  getAccounts,\n  getCurrentAccountID,\n  saveAccounts,\n} from '../utils/store-utils';\nimport supports from '../utils/supports';\n\nimport AccountBlock from './account-block';\nimport AccountHandleInfo from './account-handle-info';\nimport Avatar from './avatar';\nimport EditProfileSheet from './edit-profile-sheet';\nimport EmojiText from './emoji-text';\nimport Endorsements from './endorsements';\nimport Icon from './icon';\nimport Link from './link';\nimport Menu2 from './menu2';\nimport Modal from './modal';\nimport RelatedActions from './related-actions';\n\nconst LIMIT = 80;\n\nconst ACCOUNT_INFO_MAX_AGE = 1000 * 60 * 10; // 10 mins\n\nfunction fetchFamiliarFollowers(currentID, masto) {\n  return masto.v1.accounts.familiarFollowers.fetch({\n    id: [currentID],\n  });\n}\nconst memFetchFamiliarFollowers = pmem(fetchFamiliarFollowers, {\n  maxAge: ACCOUNT_INFO_MAX_AGE,\n});\n\nasync function fetchPostingStats(accountID, masto) {\n  const fetchStatuses = masto.v1.accounts\n    .$select(accountID)\n    .statuses.list({\n      limit: 20,\n    })\n    .values()\n    .next();\n\n  const { value: statuses } = await fetchStatuses;\n  console.log('fetched statuses', statuses);\n  const stats = {\n    total: statuses.length,\n    originals: 0,\n    replies: 0,\n    boosts: 0,\n    quotes: 0,\n  };\n  // Categories statuses by type\n  // - Original posts (not replies to others)\n  // - Threads (self-replies + 1st original post)\n  // - Boosts (reblogs)\n  // - Replies (not-self replies)\n  // - Quotes\n  statuses.forEach((status) => {\n    if (status.reblog) {\n      stats.boosts++;\n    } else if (\n      !!status.inReplyToId &&\n      status.inReplyToAccountId !== status.account.id // Not self-reply\n    ) {\n      stats.replies++;\n    } else if (\n      supportsNativeQuote() &&\n      (status.quote?.id || status.quote?.quotedStatus?.id)\n    ) {\n      stats.quotes++;\n    } else {\n      stats.originals++;\n    }\n  });\n\n  // Count days since last post\n  if (statuses.length) {\n    stats.daysSinceLastPost = Math.ceil(\n      (Date.now() - Date.parse(statuses[statuses.length - 1].createdAt)) /\n        86400000,\n    );\n  }\n\n  console.log('posting stats', stats);\n  return stats;\n}\nconst memFetchPostingStats = pmem(fetchPostingStats, {\n  maxAge: ACCOUNT_INFO_MAX_AGE,\n});\n\nconst isValidUrl = (string) => {\n  try {\n    new URL(string);\n    return true;\n  } catch (_) {\n    return false;\n  }\n};\nexport const handleScannerClick = () => {\n  states.showQrScannerModal = {\n    checkValidity: isValidUrl,\n    actionableText: msg`View profile`,\n    onClose: ({ text } = {}) => {\n      if (text) {\n        hideAllModals();\n        location.hash = `/${text}`;\n      }\n    },\n  };\n};\n\nfunction AccountInfo({\n  account,\n  fetchAccount = () => {},\n  standalone,\n  instance,\n  authenticated,\n  showEndorsements = false,\n}) {\n  const { i18n, t } = useLingui();\n  const { masto, authenticated: currentAuthenticated } = api({\n    instance,\n  });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const [uiState, setUIState] = useState('default');\n  const isString = typeof account === 'string';\n  const [info, setInfo] = useState(isString ? null : account);\n\n  const sameCurrentInstance = useMemo(\n    () => instance === currentInstance,\n    [instance, currentInstance],\n  );\n\n  useEffect(() => {\n    if (!isString) {\n      setInfo(account);\n      return;\n    }\n    setUIState('loading');\n    (async () => {\n      try {\n        const info = await fetchAccount();\n        states.accounts[`${info.id}@${instance}`] = info;\n        setInfo(info);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setInfo(null);\n        setUIState('error');\n      }\n    })();\n  }, [isString, account, fetchAccount]);\n\n  const {\n    acct,\n    avatar,\n    avatarStatic,\n    bot,\n    createdAt,\n    displayName,\n    emojis,\n    fields,\n    followersCount,\n    followingCount,\n    group,\n    // header,\n    // headerStatic,\n    id,\n    lastStatusAt,\n    locked,\n    note,\n    statusesCount,\n    url,\n    username,\n    memorial,\n    moved,\n    roles,\n    hideCollections,\n  } = info || {};\n  let headerIsAvatar = false;\n  let { header, headerStatic } = info || {};\n  if (!header || /missing\\.png$/.test(header)) {\n    if (avatar && !/missing\\.png$/.test(avatar)) {\n      header = avatar;\n      headerIsAvatar = true;\n      if (avatarStatic && !/missing\\.png$/.test(avatarStatic)) {\n        headerStatic = avatarStatic;\n      }\n    }\n  }\n\n  const isSelf = useMemo(() => id === getCurrentAccountID(), [id]);\n\n  useEffect(() => {\n    const infoHasEssentials = !!(\n      info?.id &&\n      info?.username &&\n      info?.acct &&\n      info?.avatar &&\n      info?.avatarStatic &&\n      info?.displayName &&\n      info?.url\n    );\n    if (isSelf && instance && infoHasEssentials) {\n      const accounts = getAccounts();\n      let updated = false;\n      accounts.forEach((account) => {\n        if (account.info.id === info.id && account.instanceURL === instance) {\n          account.info = info;\n          updated = true;\n        }\n      });\n      if (updated) {\n        console.log('Updated account info', info);\n        saveAccounts(accounts);\n      }\n    }\n  }, [isSelf, info, instance]);\n\n  const accountInstance = getDomain(url);\n\n  const [headerCornerColors, setHeaderCornerColors] = useState([]);\n\n  const followersIterator = useRef();\n  const familiarFollowersCache = useRef([]);\n  async function fetchFollowers(firstLoad) {\n    if (firstLoad || !followersIterator.current) {\n      followersIterator.current = masto.v1.accounts\n        .$select(id)\n        .followers.list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await followersIterator.current.next();\n    if (isSelf) return results;\n    if (!sameCurrentInstance) return results;\n\n    const { value } = results;\n    let newValue = [];\n    // On first load, fetch familiar followers, merge to top of results' `value`\n    // Remove dups on every fetch\n    if (firstLoad) {\n      let familiarFollowers = [];\n      try {\n        familiarFollowers = await masto.v1.accounts.familiarFollowers.fetch({\n          id: [id],\n        });\n      } catch (e) {}\n      familiarFollowersCache.current = familiarFollowers?.[0]?.accounts || [];\n      newValue = [\n        ...familiarFollowersCache.current,\n        ...value.filter(\n          (account) =>\n            !familiarFollowersCache.current.some(\n              (familiar) => familiar.id === account.id,\n            ),\n        ),\n      ];\n    } else if (value?.length) {\n      newValue = value.filter(\n        (account) =>\n          !familiarFollowersCache.current.some(\n            (familiar) => familiar.id === account.id,\n          ),\n      );\n    }\n\n    return {\n      ...results,\n      value: newValue,\n    };\n  }\n\n  const followingIterator = useRef();\n  async function fetchFollowing(firstLoad) {\n    if (firstLoad || !followingIterator.current) {\n      followingIterator.current = masto.v1.accounts\n        .$select(id)\n        .following.list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await followingIterator.current.next();\n    return results;\n  }\n\n  const LinkOrDiv = standalone ? 'div' : Link;\n  const accountLink = instance ? `/${instance}/a/${id}` : `/a/${id}`;\n\n  const [familiarFollowers, setFamiliarFollowers] = useState([]);\n  const [postingStats, setPostingStats] = useState();\n  const [postingStatsUIState, setPostingStatsUIState] = useState('default');\n  const hasPostingStats = !!postingStats?.total;\n\n  const renderFamiliarFollowers = async (currentID) => {\n    try {\n      const followers = await memFetchFamiliarFollowers(\n        currentID,\n        currentMasto,\n      );\n      console.log('fetched familiar followers', followers);\n      setFamiliarFollowers(\n        followers[0].accounts.slice(0, FAMILIAR_FOLLOWERS_LIMIT),\n      );\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  const renderPostingStats = async () => {\n    if (!id) return;\n    setPostingStatsUIState('loading');\n    try {\n      const stats = await memFetchPostingStats(id, masto);\n      setPostingStats(stats);\n      setPostingStatsUIState('default');\n    } catch (e) {\n      console.error(e);\n      setPostingStatsUIState('error');\n    }\n  };\n\n  const onRelationshipChange = useCallback(\n    ({ relationship, currentID }) => {\n      if (!relationship.following) {\n        renderFamiliarFollowers(currentID);\n        if (!standalone && statusesCount > 0) {\n          // Only render posting stats if not standalone and has posts\n          renderPostingStats();\n        }\n      }\n    },\n    [standalone, id, statusesCount],\n  );\n\n  const onProfileUpdate = useCallback(\n    (newAccount) => {\n      if (newAccount.id === id) {\n        console.log('Updated account info', newAccount);\n        setInfo(newAccount);\n        states.accounts[`${newAccount.id}@${instance}`] = newAccount;\n      }\n    },\n    [id, instance],\n  );\n\n  const isStringURL = isString && account && /^https?:\\/\\//.test(account);\n\n  const [showEditProfile, setShowEditProfile] = useState(false);\n\n  const [renderEndorsements, setRenderEndorsements] = useState(false);\n\n  return (\n    <>\n      <div\n        tabIndex=\"-1\"\n        class={`account-container ${uiState === 'loading' ? 'skeleton' : ''}`}\n        style={{\n          '--header-color-1': headerCornerColors[0],\n          '--header-color-2': headerCornerColors[1],\n          '--header-color-3': headerCornerColors[2],\n          '--header-color-4': headerCornerColors[3],\n        }}\n      >\n        {uiState === 'error' && (\n          <div class=\"ui-state\">\n            <p>\n              <Trans>Unable to load account.</Trans>\n            </p>\n            {isString ? (\n              <p>\n                {isStringURL ? (\n                  <a href={account} target=\"_blank\" rel=\"noopener\">\n                    {account}\n                  </a>\n                ) : (\n                  <code class=\"insignificant\">{account}</code>\n                )}\n              </p>\n            ) : (\n              <p>\n                <a href={url} target=\"_blank\" rel=\"noopener\">\n                  <Trans>Go to account page</Trans> <Icon icon=\"external\" />\n                </a>\n              </p>\n            )}\n          </div>\n        )}\n        {uiState === 'loading' ? (\n          <>\n            <header>\n              <AccountBlock avatarSize=\"xxxl\" skeleton />\n            </header>\n            <main>\n              <div class=\"note\">\n                <p>  </p>\n                <p>     </p>\n              </div>\n              <div class=\"account-metadata-box\">\n                <div class=\"profile-metadata\">\n                  <div class=\"profile-field\">\n                    <b class=\"more-insignificant\"></b>\n                    <p></p>\n                  </div>\n                  <div class=\"profile-field\">\n                    <b class=\"more-insignificant\"></b>\n                    <p></p>\n                  </div>\n                </div>\n                <div class=\"stats\">\n                  <div>\n                    <span></span> \n                  </div>\n                  <div>\n                    <span></span> \n                  </div>\n                  <div>\n                    <span></span> \n                  </div>\n                </div>\n              </div>\n              <div class=\"actions\">\n                <span />\n                <span class=\"buttons\">\n                  <button type=\"button\" class=\"plain4\" disabled>\n                    <Icon icon=\"more2\" size=\"l\" />\n                  </button>\n                </span>\n              </div>\n            </main>\n          </>\n        ) : (\n          info && (\n            <>\n              {!!moved && (\n                <div class=\"account-moved\">\n                  <p>\n                    <Trans>\n                      <b>{displayName}</b> has indicated that their new account\n                      is now:\n                    </Trans>\n                  </p>\n                  <AccountBlock\n                    account={moved}\n                    instance={instance}\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      states.showAccount = moved;\n                    }}\n                  />\n                </div>\n              )}\n              {!!header && !/missing\\.png$/.test(header) && (\n                <img\n                  src={header}\n                  alt=\"\"\n                  class={`header-banner ${\n                    headerIsAvatar ? 'header-is-avatar' : ''\n                  }`}\n                  onError={(e) => {\n                    if (e.target.crossOrigin) {\n                      if (e.target.src !== headerStatic) {\n                        e.target.src = headerStatic;\n                      } else {\n                        e.target.removeAttribute('crossorigin');\n                        e.target.src = header;\n                      }\n                    } else if (e.target.src !== headerStatic) {\n                      e.target.src = headerStatic;\n                    } else {\n                      e.target.remove();\n                    }\n                  }}\n                  crossOrigin=\"anonymous\"\n                  onLoad={(e) => {\n                    e.target.classList.add('loaded');\n                    try {\n                      // Get color from four corners of image\n                      const canvas = window.OffscreenCanvas\n                        ? new OffscreenCanvas(1, 1)\n                        : document.createElement('canvas');\n                      const ctx = canvas.getContext('2d', {\n                        willReadFrequently: true,\n                      });\n                      canvas.width = e.target.width;\n                      canvas.height = e.target.height;\n                      ctx.imageSmoothingEnabled = false;\n                      ctx.drawImage(e.target, 0, 0);\n                      // const colors = [\n                      //   ctx.getImageData(0, 0, 1, 1).data,\n                      //   ctx.getImageData(e.target.width - 1, 0, 1, 1).data,\n                      //   ctx.getImageData(0, e.target.height - 1, 1, 1).data,\n                      //   ctx.getImageData(\n                      //     e.target.width - 1,\n                      //     e.target.height - 1,\n                      //     1,\n                      //     1,\n                      //   ).data,\n                      // ];\n                      // Get 10x10 pixels from corners, get average color from each\n                      const pixelDimension = 10;\n                      const colors = [\n                        ctx.getImageData(0, 0, pixelDimension, pixelDimension)\n                          .data,\n                        ctx.getImageData(\n                          e.target.width - pixelDimension,\n                          0,\n                          pixelDimension,\n                          pixelDimension,\n                        ).data,\n                        ctx.getImageData(\n                          0,\n                          e.target.height - pixelDimension,\n                          pixelDimension,\n                          pixelDimension,\n                        ).data,\n                        ctx.getImageData(\n                          e.target.width - pixelDimension,\n                          e.target.height - pixelDimension,\n                          pixelDimension,\n                          pixelDimension,\n                        ).data,\n                      ].map((data) => {\n                        let r = 0;\n                        let g = 0;\n                        let b = 0;\n                        let a = 0;\n                        for (let i = 0; i < data.length; i += 4) {\n                          r += data[i];\n                          g += data[i + 1];\n                          b += data[i + 2];\n                          a += data[i + 3];\n                        }\n                        const dataLength = data.length / 4;\n                        return [\n                          r / dataLength,\n                          g / dataLength,\n                          b / dataLength,\n                          a / dataLength,\n                        ];\n                      });\n                      const rgbColors = colors.map((color) => {\n                        const [r, g, b, a] = lightenRGB(color);\n                        return `rgba(${r}, ${g}, ${b}, ${a})`;\n                      });\n                      setHeaderCornerColors(rgbColors);\n                      console.log({ colors, rgbColors });\n                    } catch (e) {\n                      // Silently fail\n                    }\n                  }}\n                />\n              )}\n              <header>\n                {standalone ? (\n                  <Menu2\n                    shift={\n                      window.matchMedia('(min-width: calc(40em))').matches\n                        ? 114\n                        : 64\n                    }\n                    menuButton={\n                      <div>\n                        <AccountBlock\n                          account={info}\n                          instance={instance}\n                          avatarSize=\"xxxl\"\n                          onClick={() => {}}\n                        />\n                      </div>\n                    }\n                  >\n                    <div class=\"szh-menu__header\">\n                      <AccountHandleInfo acct={acct} instance={instance} />\n                    </div>\n                    <MenuItem\n                      onClick={() => {\n                        const handleWithInstance = acct.includes('@')\n                          ? `@${acct}`\n                          : `@${acct}@${instance}`;\n                        try {\n                          navigator.clipboard.writeText(handleWithInstance);\n                          showToast(t`Handle copied`);\n                        } catch (e) {\n                          console.error(e);\n                          showToast(t`Unable to copy handle`);\n                        }\n                      }}\n                    >\n                      <Icon icon=\"link\" />\n                      <span>\n                        <Trans>Copy handle</Trans>\n                      </span>\n                    </MenuItem>\n                    <MenuItem\n                      onClick={() => {\n                        states.showQrCodeModal = {\n                          text: url,\n                          arena: avatarStatic,\n                          backgroundMask: headerStatic,\n                          caption: acct.includes('@')\n                            ? acct\n                            : `${acct}@${instance}`,\n                          onScannerClick: handleScannerClick,\n                        };\n                      }}\n                    >\n                      <Icon icon=\"qrcode\" />\n                      <span>\n                        <Trans>QR code</Trans>\n                      </span>\n                    </MenuItem>\n                    <MenuItem href={url} target=\"_blank\">\n                      <Icon icon=\"external\" />\n                      <span>\n                        <Trans>Go to original profile page</Trans>\n                      </span>\n                    </MenuItem>\n                    <MenuDivider />\n                    <MenuItem\n                      onClick={() => {\n                        states.showMediaModal = {\n                          mediaAttachments: [\n                            {\n                              type: 'image',\n                              url: avatarStatic,\n                            },\n                          ],\n                        };\n                      }}\n                    >\n                      <Icon icon=\"user\" />\n                      <span>\n                        <Trans>View profile image</Trans>\n                      </span>\n                    </MenuItem>\n                    {!!headerStatic && !headerIsAvatar && (\n                      <MenuItem\n                        onClick={() => {\n                          states.showMediaModal = {\n                            mediaAttachments: [\n                              {\n                                type: 'image',\n                                url: headerStatic,\n                              },\n                            ],\n                          };\n                        }}\n                      >\n                        <Icon icon=\"media\" />\n                        <span>\n                          <Trans>View profile header</Trans>\n                        </span>\n                      </MenuItem>\n                    )}\n                    {currentAuthenticated &&\n                      isSelf &&\n                      supports('@mastodon/profile-edit') && (\n                        <>\n                          <MenuDivider />\n                          <MenuItem\n                            onClick={() => {\n                              setShowEditProfile(true);\n                            }}\n                          >\n                            <Icon icon=\"pencil\" />\n                            <span>\n                              <Trans>Edit profile</Trans>\n                            </span>\n                          </MenuItem>\n                        </>\n                      )}\n                  </Menu2>\n                ) : (\n                  <AccountBlock\n                    account={info}\n                    instance={instance}\n                    avatarSize=\"xxxl\"\n                    internal\n                  />\n                )}\n              </header>\n              <div class=\"faux-header-bg\" aria-hidden=\"true\" />\n              <main>\n                {!!memorial && (\n                  <span class=\"tag\">\n                    <Trans>In Memoriam</Trans>\n                  </span>\n                )}\n                {!!bot && (\n                  <span class=\"tag\">\n                    <Icon icon=\"bot\" /> <Trans>Automated</Trans>\n                  </span>\n                )}\n                {!!group && (\n                  <span class=\"tag\">\n                    <Icon icon=\"group\" /> <Trans>Group</Trans>\n                  </span>\n                )}\n                {/* {roles?.map((role) => (\n                  <span class=\"tag\">\n                    {role.name}\n                    {!!accountInstance && (\n                      <>\n                        {' '}\n                        <span class=\"more-insignificant\">\n                          {accountInstance}\n                        </span>\n                      </>\n                    )}\n                  </span>\n                ))} */}\n                <div\n                  class=\"note\"\n                  dir=\"auto\"\n                  onClick={handleContentLinks({\n                    instance: currentInstance,\n                  })}\n                  dangerouslySetInnerHTML={{\n                    __html: enhanceContent(note, { emojis }),\n                  }}\n                />\n                <div class=\"account-metadata-box\">\n                  {fields?.length > 0 && (\n                    <div class=\"profile-metadata\">\n                      {fields.map(({ name, value, verifiedAt }, i) => (\n                        <div\n                          class={`profile-field ${\n                            verifiedAt ? 'profile-verified' : ''\n                          }`}\n                          key={name + i}\n                          dir=\"auto\"\n                        >\n                          <b>\n                            <EmojiText text={name} emojis={emojis} />{' '}\n                            {!!verifiedAt && (\n                              <Icon\n                                icon=\"check-circle\"\n                                size=\"s\"\n                                alt={t`Verified`}\n                              />\n                            )}\n                          </b>\n                          <p\n                            dangerouslySetInnerHTML={{\n                              __html: enhanceContent(value, { emojis }),\n                            }}\n                          />\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  <div class=\"stats\">\n                    <LinkOrDiv\n                      tabIndex={0}\n                      to={accountLink}\n                      onClick={() => {\n                        // states.showAccount = false;\n                        setTimeout(() => {\n                          states.showGenericAccounts = {\n                            id: 'followers',\n                            heading: t`Followers`,\n                            fetchAccounts: fetchFollowers,\n                            instance,\n                            excludeRelationshipAttrs: isSelf\n                              ? ['followedBy']\n                              : [],\n                            blankCopy: hideCollections\n                              ? t`This user has chosen to not make this information available.`\n                              : undefined,\n                          };\n                        }, 0);\n                      }}\n                    >\n                      {!!familiarFollowers.length && (\n                        <span class=\"shazam-container-horizontal\">\n                          <span class=\"shazam-container-inner stats-avatars-bunch\">\n                            {familiarFollowers.map((follower) => (\n                              <Avatar\n                                url={follower.avatarStatic}\n                                size=\"s\"\n                                alt={`${follower.displayName} @${follower.acct}`}\n                                squircle={follower?.bot}\n                              />\n                            ))}\n                          </span>\n                        </span>\n                      )}\n                      <Plural\n                        value={followersCount}\n                        one={\n                          <Trans>\n                            <span title={followersCount}>\n                              {shortenNumber(followersCount)}\n                            </span>{' '}\n                            Follower\n                          </Trans>\n                        }\n                        other={\n                          <Trans>\n                            <span title={followersCount}>\n                              {shortenNumber(followersCount)}\n                            </span>{' '}\n                            Followers\n                          </Trans>\n                        }\n                      />\n                    </LinkOrDiv>\n                    <LinkOrDiv\n                      class=\"insignificant\"\n                      tabIndex={0}\n                      to={accountLink}\n                      onClick={() => {\n                        // states.showAccount = false;\n                        setTimeout(() => {\n                          states.showGenericAccounts = {\n                            heading: t({\n                              id: 'following.stats',\n                              message: 'Following',\n                            }),\n                            fetchAccounts: fetchFollowing,\n                            instance,\n                            excludeRelationshipAttrs: isSelf\n                              ? ['following']\n                              : [],\n                            blankCopy: hideCollections\n                              ? t`This user has chosen to not make this information available.`\n                              : undefined,\n                          };\n                        }, 0);\n                      }}\n                    >\n                      <Plural\n                        value={followingCount}\n                        other={\n                          <Trans>\n                            <span title={followingCount}>\n                              {shortenNumber(followingCount)}\n                            </span>{' '}\n                            Following\n                          </Trans>\n                        }\n                      />\n                      <br />\n                    </LinkOrDiv>\n                    <LinkOrDiv\n                      class=\"insignificant\"\n                      to={accountLink}\n                      // onClick={\n                      //   standalone\n                      //     ? undefined\n                      //     : () => {\n                      //         hideAllModals();\n                      //       }\n                      // }\n                    >\n                      <Plural\n                        value={statusesCount}\n                        one={\n                          <Trans>\n                            <span title={statusesCount}>\n                              {shortenNumber(statusesCount)}\n                            </span>{' '}\n                            Post\n                          </Trans>\n                        }\n                        other={\n                          <Trans>\n                            <span title={statusesCount}>\n                              {shortenNumber(statusesCount)}\n                            </span>{' '}\n                            Posts\n                          </Trans>\n                        }\n                      />\n                    </LinkOrDiv>\n                    {!!createdAt && (\n                      <div class=\"insignificant\">\n                        <Trans>\n                          Joined{' '}\n                          <time datetime={createdAt}>\n                            {niceDateTime(createdAt, {\n                              hideTime: true,\n                            })}\n                          </time>\n                        </Trans>\n                      </div>\n                    )}\n                  </div>\n                </div>\n                {!!postingStats && (\n                  <LinkOrDiv\n                    to={accountLink}\n                    class=\"account-metadata-box\"\n                    // onClick={() => {\n                    //   states.showAccount = false;\n                    // }}\n                    onClick={\n                      import.meta.env.DEV && standalone\n                        ? () => {\n                            // Debug: undo back\n                            setPostingStats(null);\n                          }\n                        : undefined\n                    }\n                  >\n                    <div class=\"shazam-container\">\n                      <div class=\"shazam-container-inner\">\n                        {hasPostingStats ? (\n                          <div\n                            class=\"posting-stats\"\n                            title={\n                              supportsNativeQuote()\n                                ? t`${(\n                                    postingStats.originals / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} original posts, ${(\n                                    postingStats.replies / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} replies, ${(\n                                    postingStats.quotes / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} quotes, ${(\n                                    postingStats.boosts / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} boosts`\n                                : t`${(\n                                    postingStats.originals / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} original posts, ${(\n                                    postingStats.replies / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} replies, ${(\n                                    postingStats.boosts / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} boosts`\n                            }\n                          >\n                            <div>\n                              {postingStats.daysSinceLastPost < 365\n                                ? plural(postingStats.total, {\n                                    one: plural(\n                                      postingStats.daysSinceLastPost,\n                                      {\n                                        one: `Last 1 post in the past 1 day`,\n                                        other: `Last 1 post in the past ${postingStats.daysSinceLastPost} days`,\n                                      },\n                                    ),\n                                    other: plural(\n                                      postingStats.daysSinceLastPost,\n                                      {\n                                        one: `Last ${postingStats.total} posts in the past 1 day`,\n                                        other: `Last ${postingStats.total} posts in the past ${postingStats.daysSinceLastPost} days`,\n                                      },\n                                    ),\n                                  })\n                                : plural(postingStats.total, {\n                                    one: 'Last 1 post in the past year(s)',\n                                    other: `Last ${postingStats.total} posts in the past year(s)`,\n                                  })}\n                            </div>\n                            <div class=\"posting-stats-bar\">\n                              {postingStats.originals > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-originals\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.originals /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                              {postingStats.replies > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-replies\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.replies /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                              {postingStats.quotes > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-quotes\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.quotes /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                              {postingStats.boosts > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-boosts\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.boosts /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                            </div>\n                            <div class=\"posting-stats-legends\">\n                              <span class=\"ib\">\n                                <span class=\"posting-stats-legend-item posting-stats-bar-originals\" />{' '}\n                                <Trans>Original</Trans>\n                              </span>{' '}\n                              <span class=\"ib\">\n                                <span class=\"posting-stats-legend-item posting-stats-bar-replies\" />{' '}\n                                <Trans>Replies</Trans>\n                              </span>{' '}\n                              {supportsNativeQuote() && (\n                                <span class=\"ib\">\n                                  <span class=\"posting-stats-legend-item posting-stats-bar-quotes\" />{' '}\n                                  <Trans>Quotes</Trans>\n                                </span>\n                              )}\n                              <span class=\"ib\">\n                                <span class=\"posting-stats-legend-item posting-stats-bar-boosts\" />{' '}\n                                <Trans>Boosts</Trans>\n                              </span>\n                            </div>\n                          </div>\n                        ) : (\n                          <div class=\"posting-stats\">\n                            <Trans>Post stats unavailable.</Trans>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </LinkOrDiv>\n                )}\n                {!moved && (\n                  <div class=\"account-metadata-box\">\n                    <div\n                      class=\"shazam-container no-animation\"\n                      hidden={!!postingStats}\n                    >\n                      <div class=\"shazam-container-inner\">\n                        <button\n                          type=\"button\"\n                          class=\"posting-stats-button\"\n                          disabled={postingStatsUIState === 'loading'}\n                          onClick={() => {\n                            renderPostingStats();\n                          }}\n                        >\n                          <div\n                            class={`posting-stats-icon ${\n                              postingStatsUIState === 'loading' ? 'loading' : ''\n                            }`}\n                          />\n                          <Trans>View post stats</Trans>{' '}\n                          {/* <Loader\n                        abrupt\n                        hidden={postingStatsUIState !== 'loading'}\n                      /> */}\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </main>\n              <footer>\n                <RelatedActions\n                  info={info}\n                  instance={instance}\n                  standalone={standalone}\n                  authenticated={authenticated}\n                  onRelationshipChange={onRelationshipChange}\n                  onProfileUpdate={onProfileUpdate}\n                  setShowEditProfile={setShowEditProfile}\n                  showEndorsements={showEndorsements}\n                  renderEndorsements={renderEndorsements}\n                  setRenderEndorsements={setRenderEndorsements}\n                />\n              </footer>\n              <Endorsements\n                accountID={id}\n                info={info}\n                open={renderEndorsements}\n                onlyOpenIfHasEndorsements={\n                  renderEndorsements === 'onlyOpenIfHasEndorsements'\n                }\n              />\n            </>\n          )\n        )}\n      </div>\n      {!!showEditProfile && (\n        <Modal\n          onClose={() => {\n            setShowEditProfile(false);\n          }}\n        >\n          <EditProfileSheet\n            onClose={({ state, account } = {}) => {\n              setShowEditProfile(false);\n              if (state === 'success' && account) {\n                onProfileUpdate(account);\n              }\n            }}\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n\nconst FAMILIAR_FOLLOWERS_LIMIT = 3;\n\nfunction lightenRGB([r, g, b]) {\n  const luminence = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n  console.log('luminence', luminence);\n  let alpha;\n  if (luminence >= 220) {\n    alpha = 1;\n  } else if (luminence <= 50) {\n    alpha = 0.1;\n  } else {\n    alpha = luminence / 255;\n  }\n  alpha = Math.min(1, alpha);\n  return [r, g, b, alpha];\n}\n\nexport default AccountInfo;\n","import { useLingui } from '@lingui/react/macro';\nimport { useEffect } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport states from '../utils/states';\nimport useLocationChange from '../utils/useLocationChange';\n\nimport AccountInfo from './account-info';\nimport Icon from './icon';\n\nfunction AccountSheet({ account, instance: propInstance, onClose }) {\n  const { t } = useLingui();\n  const { masto, instance, authenticated } = api({ instance: propInstance });\n  const isString = typeof account === 'string';\n\n  useEffect(() => {\n    if (!isString) {\n      states.accounts[`${account.id}@${instance}`] = account;\n    }\n  }, [account]);\n\n  useLocationChange(onClose);\n\n  return (\n    <div\n      class=\"sheet\"\n      // onClick={(e) => {\n      //   const accountBlock = e.target.closest('.account-block');\n      //   if (accountBlock) {\n      //     onClose({\n      //       destination: 'account-statuses',\n      //     });\n      //   }\n      // }}\n    >\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close outer\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <AccountInfo\n        instance={instance}\n        authenticated={authenticated}\n        account={account}\n        fetchAccount={async () => {\n          if (isString) {\n            try {\n              const info = await masto.v1.accounts.lookup({\n                acct: account,\n                skip_webfinger: false,\n              });\n              return info;\n            } catch (e) {\n              const result = await masto.v2.search.list({\n                q: account,\n                type: 'accounts',\n                limit: authenticated ? 1 : 11, // Magic number\n                resolve: authenticated,\n              });\n              if (result.accounts.length) {\n                const accountWithSameString = result.accounts.find(\n                  (a) => a.url === account || account.startsWith(a.url),\n                );\n                if (accountWithSameString) {\n                  return accountWithSameString;\n                }\n              }\n              if (/^https?:\\/\\/[^/]+\\/@[^/]+$/.test(account)) {\n                const accountURL = URL.parse(account);\n                if (accountURL) {\n                  const { hostname, pathname } = accountURL;\n                  const acct =\n                    pathname.replace(/^\\//, '').replace(/\\/$/, '') +\n                    '@' +\n                    hostname;\n                  const result = await masto.v2.search.list({\n                    q: acct,\n                    type: 'accounts',\n                    limit: 1,\n                    resolve: authenticated,\n                  });\n                  if (result.accounts.length) {\n                    return result.accounts[0];\n                  }\n                }\n              }\n            }\n          } else {\n            return account;\n          }\n        }}\n      />\n    </div>\n  );\n}\n\nexport default AccountSheet;\n","import './drafts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useMemo, useReducer, useState } from 'react';\n\nimport { api } from '../utils/api';\nimport db from '../utils/db';\nimport niceDateTime from '../utils/nice-date-time';\nimport states from '../utils/states';\nimport { getCurrentAccountNS } from '../utils/store-utils';\n\nimport Icon from './icon';\nimport Loader from './loader';\nimport MenuConfirm from './menu-confirm';\n\nfunction Drafts({ onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [drafts, setDrafts] = useState([]);\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const keys = await db.drafts.keys();\n        if (keys.length) {\n          const ns = getCurrentAccountNS();\n          const ownKeys = keys.filter((key) => key.startsWith(ns));\n          if (ownKeys.length) {\n            const drafts = await db.drafts.getMany(ownKeys);\n            drafts.sort(\n              (a, b) => Date.parse(b.updatedAt) - Date.parse(a.updatedAt),\n            );\n            setDrafts(drafts);\n          } else {\n            setDrafts([]);\n          }\n        } else {\n          setDrafts([]);\n        }\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  const hasDrafts = drafts?.length > 0;\n\n  return (\n    <div class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Unsent drafts</Trans>{' '}\n          <Loader abrupt hidden={uiState !== 'loading'} />\n        </h2>\n        {hasDrafts && (\n          <div class=\"insignificant\">\n            <Trans>\n              Looks like you have unsent drafts. Let's continue where you left\n              off.\n            </Trans>\n          </div>\n        )}\n      </header>\n      <main>\n        {hasDrafts ? (\n          <>\n            <ul class=\"drafts-list\">\n              {drafts.map((draft) => {\n                const { updatedAt, key, draftStatus, replyTo, quote } = draft;\n                const updatedAtDate = new Date(updatedAt);\n                return (\n                  <li key={updatedAt}>\n                    <div class=\"mini-draft-meta\">\n                      <b>\n                        <Icon icon={replyTo ? 'reply' : 'quill'} size=\"s\" />{' '}\n                        <time>\n                          {!!replyTo && (\n                            <>\n                              <span class=\"bidi-isolate\">\n                                @{replyTo.account.acct}\n                              </span>\n                              <br />\n                            </>\n                          )}\n                          {niceDateTime(updatedAtDate)}\n                        </time>\n                      </b>\n                      <MenuConfirm\n                        confirmLabel={\n                          <span>\n                            <Trans>Delete this draft?</Trans>\n                          </span>\n                        }\n                        menuItemClassName=\"danger\"\n                        align=\"end\"\n                        disabled={uiState === 'loading'}\n                        onClick={() => {\n                          (async () => {\n                            try {\n                              // const yes = confirm('Delete this draft?');\n                              // if (yes) {\n                              await db.drafts.del(key);\n                              reload();\n                              // }\n                            } catch (e) {\n                              alert(t`Error deleting draft! Please try again.`);\n                            }\n                          })();\n                        }}\n                      >\n                        <button\n                          type=\"button\"\n                          class=\"small light\"\n                          disabled={uiState === 'loading'}\n                        >\n                          <Trans>Delete</Trans>\n                        </button>\n                      </MenuConfirm>\n                    </div>\n                    <button\n                      type=\"button\"\n                      disabled={uiState === 'loading'}\n                      class=\"draft-item\"\n                      onClick={async () => {\n                        // console.log({ draftStatus });\n                        let replyToStatus;\n                        let quoteStatus;\n                        if (replyTo?.id || quote?.id) {\n                          setUIState('loading');\n                          if (replyTo) {\n                            try {\n                              replyToStatus = await masto.v1.statuses\n                                .$select(replyTo.id)\n                                .fetch();\n                            } catch (e) {\n                              console.error(e);\n                              alert(t`Error fetching reply-to status!`);\n                              setUIState('default');\n                              return;\n                            }\n                          }\n                          if (quote) {\n                            try {\n                              quoteStatus = await masto.v1.statuses\n                                .$select(quote.id)\n                                .fetch();\n                            } catch (e) {\n                              console.error(e);\n                              alert(t`Error fetching quoted status!`);\n                              setUIState('default');\n                              // Don't return. Fail and still allow draft without quote\n                              // return;\n                            }\n                          }\n                          setUIState('default');\n                        }\n                        window.__COMPOSE__ = {\n                          draftStatus,\n                          replyToStatus,\n                          quoteStatus,\n                        };\n                        states.showCompose = true;\n                        states.showDrafts = false;\n                      }}\n                    >\n                      <MiniDraft draft={draft} />\n                    </button>\n                  </li>\n                );\n              })}\n            </ul>\n            {drafts.length > 1 && (\n              <p>\n                <MenuConfirm\n                  confirmLabel={\n                    <span>\n                      <Trans>Delete all drafts?</Trans>\n                    </span>\n                  }\n                  menuItemClassName=\"danger\"\n                  disabled={uiState === 'loading'}\n                  onClick={() => {\n                    (async () => {\n                      // const yes = confirm('Delete all drafts?');\n                      // if (yes) {\n                      setUIState('loading');\n                      try {\n                        await db.drafts.delMany(\n                          drafts.map((draft) => draft.key),\n                        );\n                        setUIState('default');\n                        reload();\n                      } catch (e) {\n                        console.error(e);\n                        alert(t`Error deleting drafts! Please try again.`);\n                        setUIState('error');\n                      }\n                      // }\n                    })();\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"light danger\"\n                    disabled={uiState === 'loading'}\n                  >\n                    <Trans>Delete all</Trans>\n                  </button>\n                </MenuConfirm>\n              </p>\n            )}\n          </>\n        ) : (\n          <p>\n            <Trans>No drafts found.</Trans>\n          </p>\n        )}\n      </main>\n    </div>\n  );\n}\n\nfunction MiniDraft({ draft }) {\n  const { t } = useLingui();\n  const { draftStatus, replyTo, quote } = draft;\n  const { status, spoilerText, poll, mediaAttachments } = draftStatus;\n  const hasPoll = poll?.options?.length > 0;\n  const hasMedia = mediaAttachments?.length > 0;\n  const hasQuote = !!quote?.id;\n  const hasPollOrMedia = hasPoll || hasMedia || hasQuote;\n  const firstImageMedia = useMemo(() => {\n    if (!hasMedia) return;\n    const image = mediaAttachments.find((media) => /image/.test(media.type));\n    if (!image) return;\n    const { file } = image;\n    const objectURL = URL.createObjectURL(file);\n    return objectURL;\n  }, [hasMedia, mediaAttachments]);\n  return (\n    <>\n      <div class=\"mini-draft\">\n        {hasPollOrMedia && (\n          <div\n            class={`mini-draft-aside ${firstImageMedia ? 'has-image' : ''}`}\n            style={\n              firstImageMedia\n                ? {\n                    '--bg-image': `url(${firstImageMedia})`,\n                  }\n                : {}\n            }\n          >\n            {hasPoll && <Icon icon=\"poll\" alt={t`Poll`} />}\n            {hasMedia && (\n              <span>\n                <Icon icon=\"attachment\" alt={t`Media`} />{' '}\n                <small>{mediaAttachments?.length}</small>\n              </span>\n            )}\n            {hasQuote && <Icon icon=\"quote\" alt={t`Quote`} />}\n          </div>\n        )}\n        <div class=\"mini-draft-main\">\n          {!!spoilerText && <div class=\"mini-draft-spoiler\">{spoilerText}</div>}\n          {!!status && <div class=\"mini-draft-status\">{status}</div>}\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default Drafts;\n","import './embed-modal.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\n\nimport Icon from './icon';\n\nfunction EmbedModal({ html, url, width, height, onClose = () => {} }) {\n  const { t } = useLingui();\n  return (\n    <div class=\"embed-modal-container\">\n      <div class=\"top-controls\">\n        <button type=\"button\" class=\"light\" onClick={() => onClose()}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n        {url && (\n          <a href={url} target=\"_blank\" rel=\"noopener\" class=\"button plain\">\n            <span>\n              <Trans>Open in new window</Trans>\n            </span>{' '}\n            <Icon icon=\"external\" />\n          </a>\n        )}\n      </div>\n      <div\n        class=\"embed-content\"\n        dangerouslySetInnerHTML={{ __html: html }}\n        style={{\n          '--width': width + 'px',\n          '--height': height + 'px',\n          '--aspect-ratio': `${width}/${height}`,\n        }}\n      />\n    </div>\n  );\n}\n\nexport default EmbedModal;\n","import './generic-accounts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { InView } from 'react-intersection-observer';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport { fetchRelationships } from '../utils/relationships';\nimport states from '../utils/states';\nimport useLocationChange from '../utils/useLocationChange';\n\nimport AccountBlock from './account-block';\nimport Icon from './icon';\nimport Link from './link';\nimport Loader from './loader';\nimport Status from './status';\n\nexport default function GenericAccounts({\n  instance,\n  excludeRelationshipAttrs = [],\n  postID,\n  onClose = () => {},\n  blankCopy,\n}) {\n  const { t } = useLingui();\n  const { masto, instance: currentInstance } = api();\n  const isCurrentInstance = instance ? instance === currentInstance : true;\n  const snapStates = useSnapshot(states);\n  ``;\n  const [uiState, setUIState] = useState('default');\n  const [showMore, setShowMore] = useState(false);\n\n  useLocationChange(onClose);\n\n  if (!snapStates.showGenericAccounts) {\n    return null;\n  }\n\n  const {\n    id,\n    heading,\n    fetchAccounts,\n    accounts: staticAccounts,\n    showReactions,\n  } = snapStates.showGenericAccounts;\n\n  const [accounts, setAccounts] = useState(\n    staticAccounts?.length ? staticAccounts : [],\n  );\n\n  const [relationshipsMap, setRelationshipsMap] = useState({});\n\n  const loadRelationships = async (accounts) => {\n    if (!accounts?.length) return;\n    if (!isCurrentInstance) return;\n    const relationships = await fetchRelationships(accounts, relationshipsMap);\n    if (relationships) {\n      setRelationshipsMap({\n        ...relationshipsMap,\n        ...relationships,\n      });\n    }\n  };\n\n  const loadAccounts = (firstLoad) => {\n    if (!fetchAccounts) return;\n    if (firstLoad && !accounts?.length) setAccounts([]);\n    setUIState('loading');\n    (async () => {\n      try {\n        const { done, value } = await fetchAccounts(firstLoad);\n        if (Array.isArray(value)) {\n          if (firstLoad) {\n            const accounts = [];\n            for (let i = 0; i < value.length; i++) {\n              const account = value[i];\n              const theAccount = accounts.find(\n                (a, j) => a.id === account.id && i !== j,\n              );\n              if (!theAccount) {\n                accounts.push({\n                  _types: [],\n                  ...account,\n                });\n              } else {\n                theAccount._types.push(...account._types);\n              }\n            }\n            setAccounts(accounts);\n          } else {\n            // setAccounts((prev) => [...prev, ...value]);\n            // Merge accounts by id and _types\n            setAccounts((prev) => {\n              const newAccounts = prev;\n              for (const account of value) {\n                const theAccount = newAccounts.find((a) => a.id === account.id);\n                if (!theAccount) {\n                  newAccounts.push(account);\n                } else {\n                  theAccount._types.push(...account._types);\n                }\n              }\n              return newAccounts;\n            });\n          }\n          setShowMore(!done);\n\n          loadRelationships(value);\n        } else {\n          setShowMore(false);\n        }\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  };\n\n  const firstLoad = useRef(true);\n  useEffect(() => {\n    if (accounts?.length > 0) {\n      // setAccounts(staticAccounts);\n      if (fetchAccounts) {\n        loadAccounts(true);\n        firstLoad.current = false;\n      } else {\n        loadRelationships(accounts);\n      }\n    } else {\n      loadAccounts(true);\n      firstLoad.current = false;\n    }\n  }, [fetchAccounts]);\n\n  useEffect(() => {\n    if (firstLoad.current) return;\n    // reloadGenericAccounts contains value like {id: 'mute', counter: 1}\n    // We only need to reload if the id matches\n    if (snapStates.reloadGenericAccounts?.id === id) {\n      loadAccounts(true);\n    }\n  }, [snapStates.reloadGenericAccounts.counter]);\n\n  const post = states.statuses[postID];\n\n  return (\n    <div id=\"generic-accounts-container\" class=\"sheet\" tabindex=\"-1\">\n      <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n        <Icon icon=\"x\" alt={t`Close`} />\n      </button>\n      <header>\n        <h2>{heading || t`Accounts`}</h2>\n      </header>\n      <main>\n        {post && (\n          <Link\n            to={`/${instance || currentInstance}/s/${post.id}`}\n            class=\"post-preview\"\n          >\n            <Status status={post} size=\"s\" readOnly />\n          </Link>\n        )}\n        {accounts.length > 0 ? (\n          <>\n            <ul class=\"accounts-list\">\n              {accounts.map((account) => {\n                const relationship = relationshipsMap[account.id];\n                const key = `${account.id}-${account._types?.length || ''}`;\n                return (\n                  <li key={key}>\n                    {showReactions && account._types?.length > 0 && (\n                      <div class=\"reactions-block\">\n                        {account._types.map((type) => (\n                          <Icon\n                            icon={\n                              {\n                                reblog: 'rocket',\n                                favourite: 'heart',\n                              }[type]\n                            }\n                            class={`${type}-icon`}\n                          />\n                        ))}\n                      </div>\n                    )}\n                    <div class=\"account-relationships\">\n                      <AccountBlock\n                        account={account}\n                        showStats\n                        relationship={relationship}\n                        excludeRelationshipAttrs={excludeRelationshipAttrs}\n                      />\n                    </div>\n                  </li>\n                );\n              })}\n            </ul>\n            {uiState === 'default' ? (\n              showMore ? (\n                <InView\n                  onChange={(inView) => {\n                    if (inView) {\n                      loadAccounts();\n                    }\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"plain block\"\n                    onClick={() => loadAccounts()}\n                  >\n                    <Trans>Show more</Trans>\n                  </button>\n                </InView>\n              ) : (\n                <p class=\"ui-state insignificant\">\n                  <Trans>The end.</Trans>\n                </p>\n              )\n            ) : (\n              uiState === 'loading' && (\n                <p class=\"ui-state\">\n                  <Loader abrupt />\n                </p>\n              )\n            )}\n          </>\n        ) : uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : uiState === 'error' ? (\n          <p class=\"ui-state\">\n            <Trans>Error loading accounts</Trans>\n          </p>\n        ) : (\n          <p class=\"ui-state insignificant\">\n            {blankCopy || t`Nothing to show`}\n          </p>\n        )}\n      </main>\n    </div>\n  );\n}\n","import './import-accounts-selection.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useMemo, useState } from 'preact/hooks';\n\nimport states from '../utils/states';\nimport { getAccounts, saveAccounts } from '../utils/store-utils';\n\nimport Avatar from './avatar';\nimport Icon from './icon';\nimport Loader from './loader';\nimport NameText from './name-text';\n\nfunction ImportAccountsSelection({ accounts: importedAccounts, onClose }) {\n  const { t } = useLingui();\n  const existingAccounts = getAccounts();\n\n  const { accountsToImport } = useMemo(() => {\n    if (!importedAccounts) return { accountsToImport: [] };\n\n    const statusOrder = { duplicate: 0, new: 1 };\n    const accountsToImport = importedAccounts\n      .map((account) => {\n        const existing = existingAccounts.find(\n          (a) =>\n            a.info.id === account.info.id &&\n            a.instanceURL === account.instanceURL,\n        );\n        const status = existing ? 'duplicate' : 'new';\n        return {\n          ...account,\n          __status: status,\n        };\n      })\n      .sort((a, b) => {\n        return statusOrder[a.__status] - statusOrder[b.__status];\n      });\n\n    return { accountsToImport };\n  }, [importedAccounts, existingAccounts]);\n\n  const [selectedAccounts, setSelectedAccounts] = useState(() => {\n    const initialSelection = {};\n    accountsToImport.forEach((a) => {\n      if (a.__status === 'duplicate') {\n        initialSelection[a.info.id + a.instanceURL] = false;\n      } else {\n        initialSelection[a.info.id + a.instanceURL] = true;\n      }\n    });\n    return initialSelection;\n  });\n\n  const [uiState, setUIState] = useState('default');\n\n  const handleImportSelection = () => {\n    setUIState('importing');\n    const newAccounts = [\n      ...existingAccounts,\n      ...importedAccounts.filter(\n        (account) => selectedAccounts[account.info.id + account.instanceURL],\n      ),\n    ];\n    saveAccounts(newAccounts);\n    onClose();\n    states.showImportExportAccounts = false;\n    states.showAccounts = true;\n  };\n\n  const selectedCount = Object.values(selectedAccounts).filter(Boolean).length;\n\n  return (\n    <div id=\"import-accounts-selection-container\" class=\"sheet\">\n      {!!onClose && (\n        <button\n          type=\"button\"\n          class=\"sheet-close\"\n          onClick={onClose}\n          disabled={uiState === 'importing'}\n        >\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <b>\n          <Trans>Select accounts to import</Trans>\n        </b>\n      </header>\n      <main>\n        <div class=\"import-selection\">\n          {accountsToImport.filter((a) => a.__status !== 'duplicate').length >\n            3 && (\n            <div class=\"accounts-list-header\">\n              <label class=\"account-item\">\n                <input\n                  type=\"checkbox\"\n                  checked={\n                    accountsToImport.filter((a) => a.__status !== 'duplicate')\n                      .length > 0 &&\n                    accountsToImport\n                      .filter((a) => a.__status !== 'duplicate')\n                      .every((a) => selectedAccounts[a.info.id + a.instanceURL])\n                  }\n                  onChange={(e) => {\n                    const newSelection = { ...selectedAccounts };\n                    const shouldSelect = e.target.checked;\n                    accountsToImport.forEach((a) => {\n                      if (a.__status !== 'duplicate') {\n                        newSelection[a.info.id + a.instanceURL] = shouldSelect;\n                      }\n                    });\n                    setSelectedAccounts(newSelection);\n                  }}\n                  disabled={uiState === 'importing'}\n                />\n                <span class=\"account-info\">\n                  <Trans>Select all</Trans>\n                </span>\n              </label>\n            </div>\n          )}\n          <ul class=\"accounts-list\">\n            {accountsToImport.map((account) => {\n              const key = account.info.id + account.instanceURL;\n              const isSelected = selectedAccounts[key];\n              const { __status: status } = account;\n              return (\n                <li key={key}>\n                  <label class=\"account-item\">\n                    <input\n                      type=\"checkbox\"\n                      checked={isSelected}\n                      onChange={(e) => {\n                        setSelectedAccounts({\n                          ...selectedAccounts,\n                          [key]: e.target.checked,\n                        });\n                      }}\n                      disabled={\n                        uiState === 'importing' || status === 'duplicate'\n                      }\n                    />\n                    <Avatar url={account.info.avatarStatic} size=\"xl\" />\n                    <div class=\"account-info\">\n                      <NameText\n                        account={{\n                          ...account.info,\n                          acct: /@/.test(account.info.acct)\n                            ? account.info.acct\n                            : `${account.info.acct}@${account.instanceURL}`,\n                        }}\n                        showAcct\n                      />\n                    </div>\n                    <div class=\"account-meta\">\n                      {status === 'duplicate' && (\n                        <span class=\"tag collapsed\">\n                          <Trans>Existing</Trans>\n                        </span>\n                      )}\n                    </div>\n                  </label>\n                </li>\n              );\n            })}\n          </ul>\n\n          <footer>\n            <button\n              type=\"button\"\n              class=\"light\"\n              onClick={onClose}\n              disabled={uiState === 'importing'}\n            >\n              <Trans>Cancel</Trans>\n            </button>\n            <Loader hidden={uiState !== 'importing'} />\n            <button\n              type=\"button\"\n              disabled={selectedCount === 0 || uiState === 'importing'}\n              onClick={handleImportSelection}\n            >\n              <Plural\n                value={selectedCount}\n                one=\"Import # account\"\n                other=\"Import # accounts\"\n              />\n            </button>\n          </footer>\n        </div>\n      </main>\n    </div>\n  );\n}\n\nexport default ImportAccountsSelection;\n","import './import-export-accounts.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useState } from 'preact/hooks';\n\nimport showToast from '../utils/show-toast';\nimport { getAccounts } from '../utils/store-utils';\n\nimport Icon from './icon';\nimport ImportAccountsSelection from './import-accounts-selection';\nimport Modal from './modal';\n\nexport default function ImportExportAccounts({ onClose }) {\n  const { t } = useLingui();\n  const accounts = getAccounts();\n  const [uiState, setUIState] = useState('default');\n  const [importedAccounts, setImportedAccounts] = useState(null);\n  const [dragOver, setDragOver] = useState(false);\n\n  const handleExport = async () => {\n    setUIState('exporting');\n    try {\n      const accounts = getAccounts();\n      const accountsToExport = accounts.map((account) => {\n        const { accessToken, ...rest } = account;\n        return rest;\n      });\n\n      const exportData = {\n        accounts: accountsToExport,\n        createdAt: Date.now(),\n      };\n      const json = JSON.stringify(exportData);\n\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      const now = new Date();\n      const date = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(\n        2,\n        '0',\n      )}-${String(now.getDate()).padStart(2, '0')}_${String(\n        now.getHours(),\n      ).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}`;\n      a.download = `accounts-${date}.phanpy.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n      onClose();\n    } catch (e) {\n      console.error(e);\n      showToast(t`Export failed`);\n      setUIState('error');\n    }\n  };\n\n  const processFile = async (file) => {\n    if (!file) return;\n\n    setUIState('importing');\n    try {\n      const text = await file.text();\n      const json = JSON.parse(text);\n\n      const accounts = json?.accounts;\n      if (!Array.isArray(accounts)) throw new Error('Invalid backup file');\n\n      setImportedAccounts(accounts);\n      setUIState('default');\n    } catch (e) {\n      console.error(e);\n      showToast(t`Import failed`);\n      setUIState('error');\n    }\n  };\n\n  const handleImport = (e) => {\n    const file = e.target.files[0];\n    processFile(file);\n  };\n\n  const onDragOver = (e) => {\n    e.preventDefault();\n    setDragOver(true);\n  };\n\n  const onDragLeave = () => {\n    setDragOver(false);\n  };\n\n  const onDrop = (e) => {\n    e.preventDefault();\n    setDragOver(false);\n    const file = e.dataTransfer.files[0];\n    processFile(file);\n  };\n\n  return (\n    <div\n      id=\"import-export-accounts-container\"\n      class=\"sheet\"\n      onDragOver={onDragOver}\n      onDragLeave={onDragLeave}\n      onDrop={onDrop}\n    >\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>\n            Import/Export <small class=\"ib insignificant\">Accounts</small>\n          </Trans>\n        </h2>\n      </header>\n      <main>\n        <section>\n          <label\n            class={`section-button button-import button plain4 ${\n              dragOver ? 'drag-over' : ''\n            }`}\n            tabindex=\"0\"\n          >\n            <Icon icon=\"arrow-down-circle\" size=\"xxl\" />\n            <b>\n              <Trans>Import</Trans>\n            </b>\n            <input\n              type=\"file\"\n              accept=\".json\"\n              onChange={handleImport}\n              disabled={uiState === 'importing'}\n              style={{ display: 'none' }}\n            />\n            <div>\n              <small class=\"insignificant\">\n                <Trans>Select file</Trans>\n              </small>\n            </div>\n          </label>{' '}\n          <button\n            type=\"button\"\n            class=\"section-button button-export plain4\"\n            onClick={handleExport}\n            disabled={uiState === 'exporting' || accounts.length === 0}\n          >\n            <Icon icon=\"arrow-up-circle\" size=\"xxl\" />\n            <b>\n              <Trans>Export</Trans>\n            </b>\n            <div>\n              <small class=\"insignificant\">\n                <Plural\n                  value={accounts.length}\n                  one=\"# account\"\n                  other=\"# accounts\"\n                />\n              </small>\n            </div>\n          </button>\n        </section>\n\n        <p class=\"insignificant\">\n          <small>\n            <Trans>\n              No login information or account access details are stored in the\n              exported files. You will need to log in again for each account\n              after importing.\n            </Trans>\n          </small>\n        </p>\n      </main>\n      {importedAccounts && (\n        <Modal\n          onClose={() => {\n            setImportedAccounts(null);\n          }}\n        >\n          <ImportAccountsSelection\n            accounts={importedAccounts}\n            onClose={() => {\n              setImportedAccounts(null);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { Menu, MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport getTranslateTargetLanguage from '../utils/get-translate-target-language';\nimport localeMatch from '../utils/locale-match';\nimport { speak, supportsTTS } from '../utils/speech';\nimport states from '../utils/states';\n\nimport Icon from './icon';\nimport Menu2 from './menu2';\nimport TranslationBlock from './translation-block';\n\nconst FORCE_TRANSLATE_LIMIT = 140;\n\nexport default function MediaAltModal({ alt, lang, onClose }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const [forceTranslate, setForceTranslate] = useState(false);\n  const targetLanguage = getTranslateTargetLanguage(true);\n  const contentTranslationHideLanguages =\n    snapStates.settings.contentTranslationHideLanguages || [];\n  const differentLanguage =\n    !!lang &&\n    lang !== targetLanguage &&\n    !localeMatch([lang], [targetLanguage]) &&\n    !contentTranslationHideLanguages.find(\n      (l) => lang === l || localeMatch([lang], [l]),\n    );\n\n  useEffect(() => {\n    const isShortAlt = alt?.length > 0 && alt?.length <= FORCE_TRANSLATE_LIMIT;\n    if (differentLanguage && isShortAlt) {\n      setForceTranslate(true);\n    }\n  }, [differentLanguage, alt]);\n\n  return (\n    <div class=\"sheet\" tabindex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close outer\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header class=\"header-grid\">\n        <h2>\n          <Trans>Media description</Trans>\n        </h2>\n        <div class=\"header-side\">\n          <Menu2\n            align=\"end\"\n            menuButton={\n              <button type=\"button\" class=\"plain4\">\n                <Icon icon=\"more\" alt={t`More`} size=\"xl\" />\n              </button>\n            }\n          >\n            <MenuItem\n              disabled={forceTranslate}\n              onClick={() => {\n                setForceTranslate(true);\n              }}\n            >\n              <Icon icon=\"translate\" />\n              <span>\n                <Trans>Translate</Trans>\n              </span>\n            </MenuItem>\n            {supportsTTS && (\n              <MenuItem\n                onClick={() => {\n                  speak(alt, lang);\n                }}\n              >\n                <Icon icon=\"speak\" />\n                <span>\n                  <Trans>Speak</Trans>\n                </span>\n              </MenuItem>\n            )}\n          </Menu2>\n        </div>\n      </header>\n      <main lang={lang} dir=\"auto\">\n        <p\n          style={{\n            whiteSpace: 'pre-wrap',\n            textWrap: 'pretty',\n          }}\n        >\n          {alt}\n        </p>\n        {(differentLanguage || forceTranslate) && (\n          <TranslationBlock\n            forceTranslate={forceTranslate}\n            sourceLanguage={lang}\n            text={alt}\n          />\n        )}\n      </main>\n    </div>\n  );\n}\n","const { min, max } = Math;\n\nexport default (x, low = 0, high = 1) => {\n    return min(max(low, x), high);\n};\n","// ported from jQuery's $.type\nconst classToType = {};\nfor (let name of [\n    'Boolean',\n    'Number',\n    'String',\n    'Function',\n    'Array',\n    'Date',\n    'RegExp',\n    'Undefined',\n    'Null'\n]) {\n    classToType[`[object ${name}]`] = name.toLowerCase();\n}\nexport default function (obj) {\n    return classToType[Object.prototype.toString.call(obj)] || 'object';\n}\n","import type from './type.js';\n\nexport default (args, keyOrder = null) => {\n    // if called with more than 3 arguments, we return the arguments\n    if (args.length >= 3) return Array.prototype.slice.call(args);\n    // with less than 3 args we check if first arg is object\n    // and use the keyOrder string to extract and sort properties\n    if (type(args[0]) == 'object' && keyOrder) {\n        return keyOrder\n            .split('')\n            .filter((k) => args[0][k] !== undefined)\n            .map((k) => args[0][k]);\n    }\n    // otherwise we just return the first argument\n    // (which we suppose is an array of args)\n    return args[0].slice(0);\n};\n","const { PI, min, max } = Math;\n\nconst rnd2 = (a) => Math.round(a * 100) / 100;\nconst rnd3 = (a) => Math.round(a * 100) / 100;\n\nexport { default as clip_rgb } from './clip_rgb.js';\nexport { default as limit } from './limit.js';\nexport { default as type } from './type.js';\nexport { default as unpack } from './unpack.js';\nexport { default as last } from './last.js';\n\nconst TWOPI = PI * 2;\nconst PITHIRD = PI / 3;\nconst DEG2RAD = PI / 180;\nconst RAD2DEG = 180 / PI;\n\n/**\n * Reverse the first three elements of an array\n *\n * @param {any[]} arr\n * @returns {any[]}\n */\nfunction reverse3(arr) {\n    return [...arr.slice(0, 3).reverse(), ...arr.slice(3)];\n}\n\nexport { PI, TWOPI, PITHIRD, DEG2RAD, RAD2DEG, min, max, rnd2, rnd3, reverse3 };\n","// from https://www.w3.org/TR/css-color-4/multiply-matrices.js\nexport default function multiplyMatrices(A, B) {\n    let m = A.length;\n\n    if (!Array.isArray(A[0])) {\n        // A is vector, convert to [[a, b, c, ...]]\n        A = [A];\n    }\n\n    if (!Array.isArray(B[0])) {\n        // B is vector, convert to [[a], [b], [c], ...]]\n        B = B.map((x) => [x]);\n    }\n\n    let p = B[0].length;\n    let B_cols = B[0].map((_, i) => B.map((x) => x[i])); // transpose B\n    let product = A.map((row) =>\n        B_cols.map((col) => {\n            if (!Array.isArray(row)) {\n                return col.reduce((a, c) => a + c * row, 0);\n            }\n\n            return row.reduce((a, c, i) => a + c * (col[i] || 0), 0);\n        })\n    );\n\n    if (m === 1) {\n        product = product[0]; // Avoid [[a, b, c, ...]]\n    }\n\n    if (p === 1) {\n        return product.map((x) => x[0]); // Avoid [[a], [b], [c], ...]]\n    }\n\n    return product;\n}\n","const labConstants = {\n    // Corresponds roughly to RGB brighter/darker\n    Kn: 18,\n\n    // D65 standard referent\n    labWhitePoint: 'd65',\n    Xn: 0.95047,\n    Yn: 1,\n    Zn: 1.08883,\n\n    t0: 0.137931034, // 4 / 29\n    t1: 0.206896552, // 6 / 29\n    t2: 0.12841855, // 3 * t1 * t1\n    t3: 0.008856452, // t1 * t1 * t1,\n\n    kE: 216.0 / 24389.0,\n    kKE: 8.0,\n    kK: 24389.0 / 27.0,\n\n    RefWhiteRGB: {\n        // sRGB\n        X: 0.95047,\n        Y: 1,\n        Z: 1.08883\n    },\n\n    MtxRGB2XYZ: {\n        m00: 0.4124564390896922,\n        m01: 0.21267285140562253,\n        m02: 0.0193338955823293,\n        m10: 0.357576077643909,\n        m11: 0.715152155287818,\n        m12: 0.11919202588130297,\n        m20: 0.18043748326639894,\n        m21: 0.07217499330655958,\n        m22: 0.9503040785363679\n    },\n\n    MtxXYZ2RGB: {\n        m00: 3.2404541621141045,\n        m01: -0.9692660305051868,\n        m02: 0.055643430959114726,\n        m10: -1.5371385127977166,\n        m11: 1.8760108454466942,\n        m12: -0.2040259135167538,\n        m20: -0.498531409556016,\n        m21: 0.041556017530349834,\n        m22: 1.0572251882231791\n    },\n\n    // used in rgb2xyz\n    As: 0.9414285350000001,\n    Bs: 1.040417467,\n    Cs: 1.089532651,\n\n    MtxAdaptMa: {\n        m00: 0.8951,\n        m01: -0.7502,\n        m02: 0.0389,\n        m10: 0.2664,\n        m11: 1.7135,\n        m12: -0.0685,\n        m20: -0.1614,\n        m21: 0.0367,\n        m22: 1.0296\n    },\n\n    MtxAdaptMaI: {\n        m00: 0.9869929054667123,\n        m01: 0.43230526972339456,\n        m02: -0.008528664575177328,\n        m10: -0.14705425642099013,\n        m11: 0.5183602715367776,\n        m12: 0.04004282165408487,\n        m20: 0.15996265166373125,\n        m21: 0.0492912282128556,\n        m22: 0.9684866957875502\n    }\n};\n\nexport default labConstants;\n\n// taken from https://de.mathworks.com/help/images/ref/whitepoint.html\nconst ILLUMINANTS = new Map([\n    // ASTM E308-01\n    ['a', [1.0985, 0.35585]],\n    // Wyszecki & Stiles, p. 769\n    ['b', [1.0985, 0.35585]],\n    // C ASTM E308-01\n    ['c', [0.98074, 1.18232]],\n    // D50 (ASTM E308-01)\n    ['d50', [0.96422, 0.82521]],\n    // D55 (ASTM E308-01)\n    ['d55', [0.95682, 0.92149]],\n    // D65 (ASTM E308-01)\n    ['d65', [0.95047, 1.08883]],\n    // E (ASTM E308-01)\n    ['e', [1, 1, 1]],\n    // F2 (ASTM E308-01)\n    ['f2', [0.99186, 0.67393]],\n    // F7 (ASTM E308-01)\n    ['f7', [0.95041, 1.08747]],\n    // F11 (ASTM E308-01)\n    ['f11', [1.00962, 0.6435]],\n    ['icc', [0.96422, 0.82521]]\n]);\n\nexport function setLabWhitePoint(name) {\n    const ill = ILLUMINANTS.get(String(name).toLowerCase());\n    if (!ill) {\n        throw new Error('unknown Lab illuminant ' + name);\n    }\n    labConstants.labWhitePoint = name;\n    labConstants.Xn = ill[0];\n    labConstants.Zn = ill[1];\n}\n\nexport function getLabWhitePoint() {\n    return labConstants.labWhitePoint;\n}\n","import LAB_CONSTANTS from './lab-constants.js';\nimport { unpack } from '../../utils/index.js';\n\n/*\n * L* [0..100]\n * a [-100..100]\n * b [-100..100]\n */\nconst lab2rgb = (...args) => {\n    args = unpack(args, 'lab');\n    const [L, a, b] = args;\n    const [x, y, z] = lab2xyz(L, a, b);\n    const [r, g, b_] = xyz2rgb(x, y, z);\n    return [r, g, b_, args.length > 3 ? args[3] : 1];\n};\n\nconst lab2xyz = (L, a, b) => {\n    const { kE, kK, kKE, Xn, Yn, Zn } = LAB_CONSTANTS;\n\n    const fy = (L + 16.0) / 116.0;\n    const fx = 0.002 * a + fy;\n    const fz = fy - 0.005 * b;\n\n    const fx3 = fx * fx * fx;\n    const fz3 = fz * fz * fz;\n\n    const xr = fx3 > kE ? fx3 : (116.0 * fx - 16.0) / kK;\n    const yr = L > kKE ? Math.pow((L + 16.0) / 116.0, 3.0) : L / kK;\n    const zr = fz3 > kE ? fz3 : (116.0 * fz - 16.0) / kK;\n\n    const x = xr * Xn;\n    const y = yr * Yn;\n    const z = zr * Zn;\n\n    return [x, y, z];\n};\n\nconst compand = (linear) => {\n    /* sRGB */\n    const sign = Math.sign(linear);\n    linear = Math.abs(linear);\n    return (\n        (linear <= 0.0031308\n            ? linear * 12.92\n            : 1.055 * Math.pow(linear, 1.0 / 2.4) - 0.055) * sign\n    );\n};\n\nconst xyz2rgb = (x, y, z) => {\n    const { MtxAdaptMa, MtxAdaptMaI, MtxXYZ2RGB, RefWhiteRGB, Xn, Yn, Zn } =\n        LAB_CONSTANTS;\n\n    const As = Xn * MtxAdaptMa.m00 + Yn * MtxAdaptMa.m10 + Zn * MtxAdaptMa.m20;\n    const Bs = Xn * MtxAdaptMa.m01 + Yn * MtxAdaptMa.m11 + Zn * MtxAdaptMa.m21;\n    const Cs = Xn * MtxAdaptMa.m02 + Yn * MtxAdaptMa.m12 + Zn * MtxAdaptMa.m22;\n\n    const Ad =\n        RefWhiteRGB.X * MtxAdaptMa.m00 +\n        RefWhiteRGB.Y * MtxAdaptMa.m10 +\n        RefWhiteRGB.Z * MtxAdaptMa.m20;\n    const Bd =\n        RefWhiteRGB.X * MtxAdaptMa.m01 +\n        RefWhiteRGB.Y * MtxAdaptMa.m11 +\n        RefWhiteRGB.Z * MtxAdaptMa.m21;\n    const Cd =\n        RefWhiteRGB.X * MtxAdaptMa.m02 +\n        RefWhiteRGB.Y * MtxAdaptMa.m12 +\n        RefWhiteRGB.Z * MtxAdaptMa.m22;\n\n    const X1 =\n        (x * MtxAdaptMa.m00 + y * MtxAdaptMa.m10 + z * MtxAdaptMa.m20) *\n        (Ad / As);\n    const Y1 =\n        (x * MtxAdaptMa.m01 + y * MtxAdaptMa.m11 + z * MtxAdaptMa.m21) *\n        (Bd / Bs);\n    const Z1 =\n        (x * MtxAdaptMa.m02 + y * MtxAdaptMa.m12 + z * MtxAdaptMa.m22) *\n        (Cd / Cs);\n\n    const X2 =\n        X1 * MtxAdaptMaI.m00 + Y1 * MtxAdaptMaI.m10 + Z1 * MtxAdaptMaI.m20;\n    const Y2 =\n        X1 * MtxAdaptMaI.m01 + Y1 * MtxAdaptMaI.m11 + Z1 * MtxAdaptMaI.m21;\n    const Z2 =\n        X1 * MtxAdaptMaI.m02 + Y1 * MtxAdaptMaI.m12 + Z1 * MtxAdaptMaI.m22;\n\n    const r = compand(\n        X2 * MtxXYZ2RGB.m00 + Y2 * MtxXYZ2RGB.m10 + Z2 * MtxXYZ2RGB.m20\n    );\n    const g = compand(\n        X2 * MtxXYZ2RGB.m01 + Y2 * MtxXYZ2RGB.m11 + Z2 * MtxXYZ2RGB.m21\n    );\n    const b = compand(\n        X2 * MtxXYZ2RGB.m02 + Y2 * MtxXYZ2RGB.m12 + Z2 * MtxXYZ2RGB.m22\n    );\n\n    return [r * 255, g * 255, b * 255];\n};\n\nexport default lab2rgb;\nexport { xyz2rgb };\n","import { unpack } from '../../utils/index.js';\nimport multiplyMatrices from '../../utils/multiply-matrices.js';\nimport { xyz2rgb } from '../lab/lab2rgb.js';\n\nconst oklab2rgb = (...args) => {\n    args = unpack(args, 'lab');\n    const [L, a, b, ...rest] = args;\n    const [X, Y, Z] = OKLab_to_XYZ([L, a, b]);\n    const [r, g, b_] = xyz2rgb(X, Y, Z);\n    return [r, g, b_, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\n// from https://www.w3.org/TR/css-color-4/#color-conversion-code\nfunction OKLab_to_XYZ(OKLab) {\n    // Given OKLab, convert to XYZ relative to D65\n    var LMStoXYZ = [\n        [1.2268798758459243, -0.5578149944602171, 0.2813910456659647],\n        [-0.0405757452148008, 1.112286803280317, -0.0717110580655164],\n        [-0.0763729366746601, -0.4214933324022432, 1.5869240198367816]\n    ];\n    var OKLabtoLMS = [\n        [1.0, 0.3963377773761749, 0.2158037573099136],\n        [1.0, -0.1055613458156586, -0.0638541728258133],\n        [1.0, -0.0894841775298119, -1.2914855480194092]\n    ];\n\n    var LMSnl = multiplyMatrices(OKLabtoLMS, OKLab);\n    return multiplyMatrices(\n        LMStoXYZ,\n        LMSnl.map((c) => c ** 3)\n    );\n}\n\nexport default oklab2rgb;\n","import LAB_CONSTANTS from './lab-constants.js';\nimport { unpack } from '../../utils/index.js';\n\nconst rgb2lab = (...args) => {\n    const [r, g, b, ...rest] = unpack(args, 'rgb');\n    const [x, y, z] = rgb2xyz(r, g, b);\n    const [L, a, b_] = xyz2lab(x, y, z);\n    return [L, a, b_, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\nfunction xyz2lab(x, y, z) {\n    const { Xn, Yn, Zn, kE, kK } = LAB_CONSTANTS;\n    const xr = x / Xn;\n    const yr = y / Yn;\n    const zr = z / Zn;\n\n    const fx = xr > kE ? Math.pow(xr, 1.0 / 3.0) : (kK * xr + 16.0) / 116.0;\n    const fy = yr > kE ? Math.pow(yr, 1.0 / 3.0) : (kK * yr + 16.0) / 116.0;\n    const fz = zr > kE ? Math.pow(zr, 1.0 / 3.0) : (kK * zr + 16.0) / 116.0;\n\n    return [116.0 * fy - 16.0, 500.0 * (fx - fy), 200.0 * (fy - fz)];\n}\n\nfunction gammaAdjustSRGB(companded) {\n    const sign = Math.sign(companded);\n    companded = Math.abs(companded);\n    const linear =\n        companded <= 0.04045\n            ? companded / 12.92\n            : Math.pow((companded + 0.055) / 1.055, 2.4);\n    return linear * sign;\n}\n\nconst rgb2xyz = (r, g, b) => {\n    // normalize and gamma adjust\n    r = gammaAdjustSRGB(r / 255);\n    g = gammaAdjustSRGB(g / 255);\n    b = gammaAdjustSRGB(b / 255);\n\n    const { MtxRGB2XYZ, MtxAdaptMa, MtxAdaptMaI, Xn, Yn, Zn, As, Bs, Cs } =\n        LAB_CONSTANTS;\n\n    let x = r * MtxRGB2XYZ.m00 + g * MtxRGB2XYZ.m10 + b * MtxRGB2XYZ.m20;\n    let y = r * MtxRGB2XYZ.m01 + g * MtxRGB2XYZ.m11 + b * MtxRGB2XYZ.m21;\n    let z = r * MtxRGB2XYZ.m02 + g * MtxRGB2XYZ.m12 + b * MtxRGB2XYZ.m22;\n\n    const Ad = Xn * MtxAdaptMa.m00 + Yn * MtxAdaptMa.m10 + Zn * MtxAdaptMa.m20;\n    const Bd = Xn * MtxAdaptMa.m01 + Yn * MtxAdaptMa.m11 + Zn * MtxAdaptMa.m21;\n    const Cd = Xn * MtxAdaptMa.m02 + Yn * MtxAdaptMa.m12 + Zn * MtxAdaptMa.m22;\n\n    let X = x * MtxAdaptMa.m00 + y * MtxAdaptMa.m10 + z * MtxAdaptMa.m20;\n    let Y = x * MtxAdaptMa.m01 + y * MtxAdaptMa.m11 + z * MtxAdaptMa.m21;\n    let Z = x * MtxAdaptMa.m02 + y * MtxAdaptMa.m12 + z * MtxAdaptMa.m22;\n\n    X *= Ad / As;\n    Y *= Bd / Bs;\n    Z *= Cd / Cs;\n\n    x = X * MtxAdaptMaI.m00 + Y * MtxAdaptMaI.m10 + Z * MtxAdaptMaI.m20;\n    y = X * MtxAdaptMaI.m01 + Y * MtxAdaptMaI.m11 + Z * MtxAdaptMaI.m21;\n    z = X * MtxAdaptMaI.m02 + Y * MtxAdaptMaI.m12 + Z * MtxAdaptMaI.m22;\n\n    return [x, y, z];\n};\n\nexport default rgb2lab;\nexport { rgb2xyz };\n","import { unpack } from '../../utils/index.js';\nimport multiplyMatrices from '../../utils/multiply-matrices.js';\nimport { rgb2xyz } from '../lab/rgb2lab.js';\n\nconst rgb2oklab = (...args) => {\n    const [r, g, b, ...rest] = unpack(args, 'rgb');\n    const xyz = rgb2xyz(r, g, b);\n    const oklab = XYZ_to_OKLab(xyz);\n    return [...oklab, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\n// from https://www.w3.org/TR/css-color-4/#color-conversion-code\nfunction XYZ_to_OKLab(XYZ) {\n    // Given XYZ relative to D65, convert to OKLab\n    const XYZtoLMS = [\n        [0.819022437996703, 0.3619062600528904, -0.1288737815209879],\n        [0.0329836539323885, 0.9292868615863434, 0.0361446663506424],\n        [0.0481771893596242, 0.2642395317527308, 0.6335478284694309]\n    ];\n    const LMStoOKLab = [\n        [0.210454268309314, 0.7936177747023054, -0.0040720430116193],\n        [1.9779985324311684, -2.4285922420485799, 0.450593709617411],\n        [0.0259040424655478, 0.7827717124575296, -0.8086757549230774]\n    ];\n\n    const LMS = multiplyMatrices(XYZtoLMS, XYZ);\n    // JavaScript Math.cbrt returns a sign-matched cube root\n    // beware if porting to other languages\n    // especially if tempted to use a general power function\n    return multiplyMatrices(\n        LMStoOKLab,\n        LMS.map((c) => Math.cbrt(c))\n    );\n    // L in range [0,1]. For use in CSS, multiply by 100 and add a percent\n}\n\nexport default rgb2oklab;\n","import { unpack, DEG2RAD } from '../../utils/index.js';\nconst { sin, cos } = Math;\n\nconst lch2lab = (...args) => {\n    /*\n    Convert from a qualitative parameter h and a quantitative parameter l to a 24-bit pixel.\n    These formulas were invented by David Dalrymple to obtain maximum contrast without going\n    out of gamut if the parameters are in the range 0-1.\n\n    A saturation multiplier was added by Gregor Aisch\n    */\n    let [l, c, h] = unpack(args, 'lch');\n    if (isNaN(h)) h = 0;\n    h = h * DEG2RAD;\n    return [l, cos(h) * c, sin(h) * c];\n};\n\nexport default lch2lab;\n","import { unpack } from '../../utils/index.js';\nimport lch2lab from '../lch/lch2lab.js';\nimport oklab2rgb from '../oklab/oklab2rgb.js';\n\nconst oklch2rgb = (...args) => {\n    args = unpack(args, 'lch');\n    const [l, c, h, ...rest] = args;\n    const [L, a, b_] = lch2lab(l, c, h);\n    const [r, g, b] = oklab2rgb(L, a, b_);\n    return [r, g, b, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\nexport default oklch2rgb;\n","import { unpack, RAD2DEG } from '../../utils/index.js';\nconst { sqrt, atan2, round } = Math;\n\nconst lab2lch = (...args) => {\n    const [l, a, b] = unpack(args, 'lab');\n    const c = sqrt(a * a + b * b);\n    let h = (atan2(b, a) * RAD2DEG + 360) % 360;\n    if (round(c * 10000) === 0) h = Number.NaN;\n    return [l, c, h];\n};\n\nexport default lab2lch;\n","import { unpack } from '../../utils/index.js';\nimport rgb2oklab from '../oklab/rgb2oklab.js';\nimport lab2lch from '../lch/lab2lch.js';\n\nconst rgb2oklch = (...args) => {\n    const [r, g, b, ...rest] = unpack(args, 'rgb');\n    const [l, a, b_] = rgb2oklab(r, g, b);\n    const [L, c, h] = lab2lch(l, a, b_);\n    return [L, c, h, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\nexport default rgb2oklch;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { getBlurHashAverageColor } from 'fast-blurhash';\nimport {\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\nimport { oklch2rgb, rgb2oklch } from '../utils/color-utils';\nimport isRTL from '../utils/is-rtl';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport store from '../utils/store';\n\nimport Icon from './icon';\nimport Link from './link';\nimport Media from './media';\nimport MenuLink from './menu-link';\nimport Menu2 from './menu2';\n\nconst { PHANPY_IMG_ALT_API_URL: IMG_ALT_API_URL } = import.meta.env;\n\nfunction MediaModal({\n  mediaAttachments,\n  statusID,\n  instance,\n  lang,\n  index = 0,\n  onClose = () => {},\n}) {\n  const { t } = useLingui();\n  const [uiState, setUIState] = useState('default');\n  const carouselRef = useRef(null);\n\n  const [currentIndex, setCurrentIndex] = useState(index);\n  const carouselFocusItem = useRef(null);\n  useLayoutEffect(() => {\n    carouselFocusItem.current?.scrollIntoView();\n\n    // history.pushState({ mediaModal: true }, '');\n    // const handlePopState = (e) => {\n    //   if (e.state?.mediaModal) {\n    //     onClose();\n    //   }\n    // };\n    // window.addEventListener('popstate', handlePopState);\n    // return () => {\n    //   window.removeEventListener('popstate', handlePopState);\n    // };\n  }, []);\n  const prevStatusID = useRef(statusID);\n  useEffect(() => {\n    const scrollLeft = index * carouselRef.current.clientWidth;\n    const differentStatusID = prevStatusID.current !== statusID;\n    if (differentStatusID) prevStatusID.current = statusID;\n    carouselRef.current.focus();\n    carouselRef.current.scrollTo({\n      left: scrollLeft * (isRTL() ? -1 : 1),\n      behavior: differentStatusID ? 'auto' : 'smooth',\n    });\n  }, [index, statusID]);\n\n  const [showControls, setShowControls] = useState(true);\n\n  useEffect(() => {\n    let handleSwipe = (e) => {\n      onClose(e, currentIndex, mediaAttachments, carouselRef);\n    };\n    if (carouselRef.current) {\n      carouselRef.current.addEventListener('swiped-down', handleSwipe);\n    }\n    return () => {\n      if (carouselRef.current) {\n        carouselRef.current.removeEventListener('swiped-down', handleSwipe);\n      }\n    };\n  }, [currentIndex, mediaAttachments]);\n\n  useHotkeys(\n    'esc',\n    (e) => {\n      onClose(e, currentIndex, mediaAttachments, carouselRef);\n    },\n    {\n      ignoreEventWhen: (e) => {\n        const hasModal = !!document.querySelector('#modal-container > *');\n        return hasModal || e.metaKey || e.ctrlKey || e.altKey || e.shiftKey;\n      },\n      useKey: true,\n    },\n    [onClose, currentIndex, mediaAttachments],\n  );\n\n  useEffect(() => {\n    let handleScroll = () => {\n      const { clientWidth, scrollLeft } = carouselRef.current;\n      const index = Math.round(Math.abs(scrollLeft) / clientWidth);\n      setCurrentIndex(index);\n    };\n    if (carouselRef.current) {\n      carouselRef.current.addEventListener('scroll', handleScroll, {\n        passive: true,\n      });\n    }\n    return () => {\n      if (carouselRef.current) {\n        carouselRef.current.removeEventListener('scroll', handleScroll);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      carouselRef.current?.focus?.();\n    }, 100);\n    return () => clearTimeout(timer);\n  }, []);\n\n  const mediaOkColors = useMemo(() => {\n    return mediaAttachments?.map((media) => {\n      const { blurhash } = media;\n      if (blurhash) {\n        const averageColor = getBlurHashAverageColor(blurhash);\n        return rgb2oklch(averageColor);\n      }\n      return null;\n    });\n  }, [mediaAttachments]);\n  const mediaAccentColors = useMemo(() => {\n    return mediaOkColors?.map((okColor) => {\n      if (okColor) {\n        return {\n          light: oklch2rgb([0.95, 0.01, okColor[2]]),\n          dark: oklch2rgb([0.35, 0.01, okColor[2]]),\n          default: oklch2rgb([0.6, okColor[1], okColor[2]]),\n        };\n      }\n      return null;\n    });\n  });\n  const mediaAccentGradients = useMemo(() => {\n    const gap = 5;\n    const range = 100 / mediaAccentColors.length;\n    const colors = mediaAccentColors.map((color, i) => {\n      const start = i * range + gap;\n      const end = (i + 1) * range - gap;\n      if (color?.light && color?.dark) {\n        return {\n          light: `\n                rgb(${color.light?.join(',')}) ${start}%, \n                rgb(${color.light?.join(',')}) ${end}%\n              `,\n          dark: `\n                rgb(${color.dark?.join(',')}) ${start}%, \n                rgb(${color.dark?.join(',')}) ${end}%\n              `,\n        };\n      }\n\n      return {\n        light: `\n              transparent ${start}%, \n              transparent ${end}%\n            `,\n        dark: `\n              transparent ${start}%, \n              transparent ${end}%\n            `,\n      };\n    });\n    const lightGradient = colors.map((color) => color.light).join(', ');\n    const darkGradient = colors.map((color) => color.dark).join(', ');\n    return {\n      light: lightGradient,\n      dark: darkGradient,\n    };\n  }, [mediaAccentColors]);\n\n  let toastRef = useRef(null);\n  useEffect(() => {\n    return () => {\n      toastRef.current?.hideToast?.();\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    const currentColor = mediaAccentColors[currentIndex];\n    let $meta;\n    let metaColor;\n    if (currentColor) {\n      const theme = store.local.get('theme');\n      if (theme) {\n        const mediaColor = `rgb(${currentColor[theme].join(',')})`;\n        console.log({ mediaColor });\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][data-theme-setting=\"manual\"]`,\n        );\n        if ($meta) {\n          metaColor = $meta.content;\n          $meta.content = mediaColor;\n        }\n      } else {\n        const colorScheme = window.matchMedia('(prefers-color-scheme: dark)')\n          .matches\n          ? 'dark'\n          : 'light';\n        const mediaColor = `rgb(${currentColor[colorScheme].join(',')})`;\n        console.log({ mediaColor });\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][media*=\"${colorScheme}\"]`,\n        );\n        if ($meta) {\n          metaColor = $meta.content;\n          $meta.content = mediaColor;\n        }\n      }\n    }\n    return () => {\n      // Reset meta color\n      if ($meta && metaColor) {\n        $meta.content = metaColor;\n      }\n    };\n  }, [currentIndex, mediaAccentColors]);\n\n  return (\n    <div\n      class={`media-modal-container media-modal-count-${mediaAttachments?.length}`}\n    >\n      <div\n        ref={carouselRef}\n        tabIndex=\"0\"\n        data-swipe-threshold=\"44\"\n        class=\"carousel\"\n        onClick={(e) => {\n          if (\n            e.target.classList.contains('carousel-item') ||\n            e.target.classList.contains('media') ||\n            e.target.classList.contains('media-zoom')\n          ) {\n            onClose(e, currentIndex, mediaAttachments, carouselRef);\n          }\n        }}\n        style={\n          mediaAttachments.length > 1\n            ? {\n                backgroundAttachment: 'local',\n                '--accent-gradient-light': mediaAccentGradients?.light,\n                '--accent-gradient-dark': mediaAccentGradients?.dark,\n                //     backgroundImage: `linear-gradient(\n                // to ${isRTL() ? 'left' : 'right'}, ${mediaAccentGradient})`,\n              }\n            : {}\n        }\n      >\n        {mediaAttachments?.map((media, i) => {\n          const accentColor =\n            mediaAttachments.length === 1 ? mediaAccentColors[i] : null;\n          return (\n            <div\n              class=\"carousel-item\"\n              style={\n                accentColor\n                  ? {\n                      '--accent-color': `rgb(${accentColor.default.join(',')})`,\n                      '--accent-light-color': `rgb(${accentColor.light?.join(\n                        ',',\n                      )})`,\n                      '--accent-dark-color': `rgb(${accentColor.dark?.join(\n                        ',',\n                      )})`,\n                      '--accent-alpha-color': `rgba(${accentColor.default.join(\n                        ',',\n                      )}, 0.4)`,\n                    }\n                  : {}\n              }\n              tabindex=\"0\"\n              key={media.id}\n              ref={i === currentIndex ? carouselFocusItem : null}\n              onClick={(e) => {\n                // console.log(e);\n                // if (e.target !== e.currentTarget) {\n                //   setShowControls(!showControls);\n                // }\n                if (!e.target.classList.contains('media')) {\n                  setShowControls(!showControls);\n                }\n              }}\n            >\n              {!!media.description && (\n                <button\n                  type=\"button\"\n                  class=\"media-alt\"\n                  hidden={!showControls}\n                  onClick={() => {\n                    states.showMediaAlt = {\n                      alt: media.description,\n                      lang,\n                    };\n                  }}\n                >\n                  <span class=\"alt-badge\">ALT</span>\n                  <span class=\"media-alt-desc\" lang={lang} dir=\"auto\">\n                    {media.description}\n                  </span>\n                </button>\n              )}\n              <Media media={media} showOriginal lang={lang} />\n            </div>\n          );\n        })}\n      </div>\n      <div class=\"carousel-top-controls\" hidden={!showControls}>\n        <span>\n          <button\n            type=\"button\"\n            class=\"carousel-button\"\n            onClick={(e) =>\n              onClose(e, currentIndex, mediaAttachments, carouselRef)\n            }\n          >\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n        </span>\n        {mediaAttachments?.length > 1 ? (\n          <span class=\"carousel-dots\">\n            {mediaAttachments?.map((media, i) => (\n              <button\n                key={media.id}\n                type=\"button\"\n                disabled={i === currentIndex}\n                class={`carousel-dot ${i === currentIndex ? 'active' : ''}`}\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  const left =\n                    carouselRef.current.clientWidth * i * (isRTL() ? -1 : 1);\n                  carouselRef.current.focus();\n                  carouselRef.current.scrollTo({ left, behavior: 'smooth' });\n                }}\n              >\n                <Icon icon=\"round\" size=\"s\" alt=\"\" />\n              </button>\n            ))}\n          </span>\n        ) : (\n          <span />\n        )}\n        <span>\n          <Menu2\n            overflow=\"auto\"\n            align=\"end\"\n            position=\"anchor\"\n            gap={4}\n            menuClassName=\"glass-menu\"\n            menuButton={\n              <button type=\"button\" class=\"carousel-button\">\n                <Icon icon=\"more2\" alt={t`More`} />\n              </button>\n            }\n          >\n            <MenuLink\n              href={\n                mediaAttachments[currentIndex]?.remoteUrl ||\n                mediaAttachments[currentIndex]?.url\n              }\n              class=\"carousel-button\"\n              target=\"_blank\"\n              title={t`Open original media in new window`}\n            >\n              <Icon icon=\"popout\" />\n              <span>\n                <Trans>Open original media</Trans>\n              </span>\n            </MenuLink>\n            {import.meta.env.DEV && // Only dev for now\n              !!states.settings.mediaAltGenerator &&\n              !!IMG_ALT_API_URL &&\n              !!mediaAttachments[currentIndex]?.url &&\n              !mediaAttachments[currentIndex]?.description &&\n              mediaAttachments[currentIndex]?.type === 'image' && (\n                <>\n                  <MenuDivider />\n                  <MenuItem\n                    disabled={uiState === 'loading'}\n                    onClick={() => {\n                      setUIState('loading');\n                      toastRef.current = showToast({\n                        text: t`Attempting to describe image. Please wait`,\n                        duration: -1,\n                      });\n                      (async function () {\n                        try {\n                          const response = await fetch(\n                            `${IMG_ALT_API_URL}?image=${encodeURIComponent(\n                              mediaAttachments[currentIndex]?.url,\n                            )}`,\n                          ).then((r) => r.json());\n                          states.showMediaAlt = {\n                            alt: response.description,\n                          };\n                        } catch (e) {\n                          console.error(e);\n                          showToast(t`Failed to describe image`);\n                        } finally {\n                          setUIState('default');\n                          toastRef.current?.hideToast?.();\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"sparkles2\" />\n                    <span>\n                      <Trans>Describe image</Trans>\n                    </span>\n                  </MenuItem>\n                </>\n              )}\n          </Menu2>{' '}\n          {!!statusID && (\n            <Link\n              to={`${instance ? `/${instance}` : ''}/s/${statusID}${\n                window.matchMedia('(min-width: calc(40em + 350px))').matches\n                  ? `?media=${currentIndex + 1}`\n                  : ''\n              }`}\n              class=\"button carousel-button media-post-link\"\n              // onClick={() => {\n              //   // if small screen (not media query min-width 40em + 350px), run onClose\n              //   if (\n              //     !window.matchMedia('(min-width: calc(40em + 350px))').matches\n              //   ) {\n              //     onClose();\n              //   }\n              // }}\n            >\n              <span class=\"button-label\">\n                <Trans>View post</Trans>{' '}\n              </span>\n              &raquo;\n            </Link>\n          )}\n        </span>\n      </div>\n      {mediaAttachments?.length > 1 && (\n        <div class=\"carousel-controls\" hidden={!showControls}>\n          <button\n            type=\"button\"\n            class=\"carousel-button\"\n            hidden={currentIndex === 0}\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              carouselRef.current.focus();\n              carouselRef.current.scrollTo({\n                left:\n                  carouselRef.current.clientWidth *\n                  (currentIndex - 1) *\n                  (isRTL() ? -1 : 1),\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"arrow-left\" alt={t`Previous`} />\n          </button>\n          <button\n            type=\"button\"\n            class=\"carousel-button\"\n            hidden={currentIndex === mediaAttachments.length - 1}\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              carouselRef.current.focus();\n              carouselRef.current.scrollTo({\n                left:\n                  carouselRef.current.clientWidth *\n                  (currentIndex + 1) *\n                  (isRTL() ? -1 : 1),\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"arrow-right\" alt={t`Next`} />\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default MediaModal;\n","import './open-link-sheet.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\n\nimport showToast from '../utils/show-toast';\n\nimport Icon from './icon';\n\nexport default function OpenLinkSheet({ url, linkText, onClose }) {\n  const { t } = useLingui();\n  if (!url) return null;\n\n  let displayUrl = url;\n  try {\n    const urlObj = URL.parse(url);\n    const protocol = urlObj.protocol;\n    const hostname = urlObj.hostname;\n    const rest = url.slice(urlObj.origin.length);\n    displayUrl = (\n      <>\n        {protocol}//<strong>{hostname}</strong>\n        {rest}\n      </>\n    );\n  } catch (e) {}\n\n  const handleCopy = () => {\n    try {\n      navigator.clipboard.writeText(url);\n      showToast(t`Link copied`);\n    } catch (e) {\n      console.error(e);\n      showToast(t`Unable to copy link`);\n    }\n  };\n\n  const handleShare = () => {\n    if (navigator.share && navigator.canShare({ url })) {\n      try {\n        navigator.share({ url });\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  };\n\n  return (\n    <div class=\"sheet sheet-modal\" id=\"open-link-sheet\" tabindex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header class=\"header-grid\">\n        <h2>\n          <Trans>Open link?</Trans>\n        </h2>\n      </header>\n      <main>\n        {!!linkText && (\n          <>\n            <p class=\"link-text\">\n              <Icon icon=\"cursor-hand\" size=\"xl\" /> {linkText}\n            </p>\n            <div class=\"arrow\">\n              <Icon icon=\"arrow-down\" />\n            </div>\n          </>\n        )}\n        <p class=\"full-url\">{displayUrl}</p>\n      </main>\n      <footer>\n        <button type=\"button\" class=\"light\" onClick={onClose}>\n          <Trans>Cancel</Trans>\n        </button>\n        <span class=\"spacer\" />\n        <button type=\"button\" class=\"plain6\" onClick={handleCopy}>\n          <Icon icon=\"copy\" alt={t`Copy`} />\n        </button>\n        {navigator.canShare && navigator.canShare({ url }) && (\n          <button type=\"button\" class=\"plain6\" onClick={handleShare}>\n            <Icon icon=\"share\" alt={t`Share`} />\n          </button>\n        )}\n        <a\n          class=\"button\"\n          href={url}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          onClick={onClose}\n        >\n          <Trans>Open</Trans>\n        </a>\n      </footer>\n    </div>\n  );\n}\n","/*!\nCopyright (c) 2023 Paul Miller (paulmillr.com)\nThe library paulmillr-qr is dual-licensed under the Apache 2.0 OR MIT license.\nYou can select a license of your choice.\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Methods for encoding (generating) QR code patterns.\n * Check out decode.ts for decoding (reading).\n * @module\n * @example\n```js\nimport encodeQR from 'qr';\nconst txt = 'Hello world';\nconst ascii = encodeQR(txt, 'ascii'); // Not all fonts are supported\nconst terminalFriendly = encodeQR(txt, 'term'); // 2x larger, all fonts are OK\nconst gifBytes = encodeQR(txt, 'gif'); // Uncompressed GIF\nconst svgElement = encodeQR(txt, 'svg'); // SVG vector image element\nconst array = encodeQR(txt, 'raw'); // 2d array for canvas or other libs\n// import decodeQR from 'qr/decode.js';\n```\n */\n// We do not use newline escape code directly in strings because it's not parser-friendly\nconst chCodes = { newline: 10, reset: 27 };\nfunction assertNumber(n) {\n    if (!Number.isSafeInteger(n))\n        throw new Error(`integer expected: ${n}`);\n}\nfunction validateVersion(ver) {\n    if (!Number.isSafeInteger(ver) || ver < 1 || ver > 40)\n        throw new Error(`Invalid version=${ver}. Expected number [1..40]`);\n}\nfunction bin(dec, pad) {\n    return dec.toString(2).padStart(pad, '0');\n}\nfunction mod(a, b) {\n    const result = a % b;\n    return result >= 0 ? result : b + result;\n}\nfunction fillArr(length, val) {\n    return new Array(length).fill(val);\n}\n/**\n * Interleaves byte blocks.\n * @param blocks [[1, 2, 3], [4, 5, 6]]\n * @returns [1, 4, 2, 5, 3, 6]\n */\nfunction interleaveBytes(...blocks) {\n    let len = 0;\n    for (const b of blocks)\n        len = Math.max(len, b.length);\n    const res = [];\n    for (let i = 0; i < len; i++) {\n        for (const b of blocks) {\n            if (i >= b.length)\n                continue; // outside of block, skip\n            res.push(b[i]);\n        }\n    }\n    return new Uint8Array(res);\n}\nfunction includesAt(lst, pattern, index) {\n    if (index < 0 || index + pattern.length > lst.length)\n        return false;\n    for (let i = 0; i < pattern.length; i++)\n        if (pattern[i] !== lst[index + i])\n            return false;\n    return true;\n}\n// Optimize for minimal score/penalty\nfunction best() {\n    let best;\n    let bestScore = Infinity;\n    return {\n        add(score, value) {\n            if (score >= bestScore)\n                return;\n            best = value;\n            bestScore = score;\n        },\n        get: () => best,\n        score: () => bestScore,\n    };\n}\n// Based on https://github.com/paulmillr/scure-base/blob/main/index.ts\nfunction alphabet(alphabet) {\n    return {\n        has: (char) => alphabet.includes(char),\n        decode: (input) => {\n            if (!Array.isArray(input) || (input.length && typeof input[0] !== 'string'))\n                throw new Error('alphabet.decode input should be array of strings');\n            return input.map((letter) => {\n                if (typeof letter !== 'string')\n                    throw new Error(`alphabet.decode: not string element=${letter}`);\n                const index = alphabet.indexOf(letter);\n                if (index === -1)\n                    throw new Error(`Unknown letter: \"${letter}\". Allowed: ${alphabet}`);\n                return index;\n            });\n        },\n        encode: (digits) => {\n            if (!Array.isArray(digits) || (digits.length && typeof digits[0] !== 'number'))\n                throw new Error('alphabet.encode input should be an array of numbers');\n            return digits.map((i) => {\n                assertNumber(i);\n                if (i < 0 || i >= alphabet.length)\n                    throw new Error(`Digit index outside alphabet: ${i} (alphabet: ${alphabet.length})`);\n                return alphabet[i];\n            });\n        },\n    };\n}\nexport class Bitmap {\n    static size(size, limit) {\n        if (typeof size === 'number')\n            size = { height: size, width: size };\n        if (!Number.isSafeInteger(size.height) && size.height !== Infinity)\n            throw new Error(`Bitmap: invalid height=${size.height} (${typeof size.height})`);\n        if (!Number.isSafeInteger(size.width) && size.width !== Infinity)\n            throw new Error(`Bitmap: invalid width=${size.width} (${typeof size.width})`);\n        if (limit !== undefined) {\n            // Clamp length, so it won't overflow, also allows to use Infinity, so we draw until end\n            size = {\n                width: Math.min(size.width, limit.width),\n                height: Math.min(size.height, limit.height),\n            };\n        }\n        return size;\n    }\n    static fromString(s) {\n        // Remove linebreaks on start and end, so we draw in `` section\n        s = s.replace(/^\\n+/g, '').replace(/\\n+$/g, '');\n        const lines = s.split(String.fromCharCode(chCodes.newline));\n        const height = lines.length;\n        const data = new Array(height);\n        let width;\n        for (const line of lines) {\n            const row = line.split('').map((i) => {\n                if (i === 'X')\n                    return true;\n                if (i === ' ')\n                    return false;\n                if (i === '?')\n                    return undefined;\n                throw new Error(`Bitmap.fromString: unknown symbol=${i}`);\n            });\n            if (width && row.length !== width)\n                throw new Error(`Bitmap.fromString different row sizes: width=${width} cur=${row.length}`);\n            width = row.length;\n            data.push(row);\n        }\n        if (!width)\n            width = 0;\n        return new Bitmap({ height, width }, data);\n    }\n    data;\n    height;\n    width;\n    constructor(size, data) {\n        const { height, width } = Bitmap.size(size);\n        this.data = data || Array.from({ length: height }, () => fillArr(width, undefined));\n        this.height = height;\n        this.width = width;\n    }\n    point(p) {\n        return this.data[p.y][p.x];\n    }\n    isInside(p) {\n        return 0 <= p.x && p.x < this.width && 0 <= p.y && p.y < this.height;\n    }\n    size(offset) {\n        if (!offset)\n            return { height: this.height, width: this.width };\n        const { x, y } = this.xy(offset);\n        return { height: this.height - y, width: this.width - x };\n    }\n    xy(c) {\n        if (typeof c === 'number')\n            c = { x: c, y: c };\n        if (!Number.isSafeInteger(c.x))\n            throw new Error(`Bitmap: invalid x=${c.x}`);\n        if (!Number.isSafeInteger(c.y))\n            throw new Error(`Bitmap: invalid y=${c.y}`);\n        // Do modulo, so we can use negative positions\n        c.x = mod(c.x, this.width);\n        c.y = mod(c.y, this.height);\n        return c;\n    }\n    // Basically every operation can be represented as rect\n    rect(c, size, value) {\n        const { x, y } = this.xy(c);\n        const { height, width } = Bitmap.size(size, this.size({ x, y }));\n        for (let yPos = 0; yPos < height; yPos++) {\n            for (let xPos = 0; xPos < width; xPos++) {\n                // NOTE: we use give function relative coordinates inside box\n                this.data[y + yPos][x + xPos] =\n                    typeof value === 'function'\n                        ? value({ x: xPos, y: yPos }, this.data[y + yPos][x + xPos])\n                        : value;\n            }\n        }\n        return this;\n    }\n    // returns rectangular part of bitmap\n    rectRead(c, size, fn) {\n        return this.rect(c, size, (c, cur) => {\n            fn(c, cur);\n            return cur;\n        });\n    }\n    // Horizontal & vertical lines\n    hLine(c, len, value) {\n        return this.rect(c, { width: len, height: 1 }, value);\n    }\n    vLine(c, len, value) {\n        return this.rect(c, { width: 1, height: len }, value);\n    }\n    // add border\n    border(border = 2, value) {\n        const height = this.height + 2 * border;\n        const width = this.width + 2 * border;\n        const v = fillArr(border, value);\n        const h = Array.from({ length: border }, () => fillArr(width, value));\n        return new Bitmap({ height, width }, [...h, ...this.data.map((i) => [...v, ...i, ...v]), ...h]);\n    }\n    // Embed another bitmap on coordinates\n    embed(c, bm) {\n        return this.rect(c, bm.size(), ({ x, y }) => bm.data[y][x]);\n    }\n    // returns rectangular part of bitmap\n    rectSlice(c, size = this.size()) {\n        const rect = new Bitmap(Bitmap.size(size, this.size(this.xy(c))));\n        this.rect(c, size, ({ x, y }, cur) => (rect.data[y][x] = cur));\n        return rect;\n    }\n    // Change shape, replace rows with columns (data[y][x] -> data[x][y])\n    inverse() {\n        const { height, width } = this;\n        const res = new Bitmap({ height: width, width: height });\n        return res.rect({ x: 0, y: 0 }, Infinity, ({ x, y }) => this.data[x][y]);\n    }\n    // Each pixel size is multiplied by factor\n    scale(factor) {\n        if (!Number.isSafeInteger(factor) || factor > 1024)\n            throw new Error(`invalid scale factor: ${factor}`);\n        const { height, width } = this;\n        const res = new Bitmap({ height: factor * height, width: factor * width });\n        return res.rect({ x: 0, y: 0 }, Infinity, ({ x, y }) => this.data[Math.floor(y / factor)][Math.floor(x / factor)]);\n    }\n    clone() {\n        const res = new Bitmap(this.size());\n        return res.rect({ x: 0, y: 0 }, this.size(), ({ x, y }) => this.data[y][x]);\n    }\n    // Ensure that there is no undefined values left\n    assertDrawn() {\n        this.rectRead(0, Infinity, (_, cur) => {\n            if (typeof cur !== 'boolean')\n                throw new Error(`Invalid color type=${typeof cur}`);\n        });\n    }\n    // Simple string representation for debugging\n    toString() {\n        return this.data\n            .map((i) => i.map((j) => (j === undefined ? '?' : j ? 'X' : ' ')).join(''))\n            .join(String.fromCharCode(chCodes.newline));\n    }\n    toASCII() {\n        const { height, width, data } = this;\n        let out = '';\n        // Terminal character height is x2 of character width, so we process two rows of bitmap\n        // to produce one row of ASCII\n        for (let y = 0; y < height; y += 2) {\n            for (let x = 0; x < width; x++) {\n                const first = data[y][x];\n                const second = y + 1 >= height ? true : data[y + 1][x]; // if last row outside bitmap, make it black\n                if (!first && !second)\n                    out += ''; // both rows white (empty)\n                else if (!first && second)\n                    out += ''; // top row white\n                else if (first && !second)\n                    out += ''; // down row white\n                else if (first && second)\n                    out += ' '; // both rows black\n            }\n            out += String.fromCharCode(chCodes.newline);\n        }\n        return out;\n    }\n    toTerm() {\n        const cc = String.fromCharCode(chCodes.reset);\n        const reset = cc + '[0m';\n        const whiteBG = cc + '[1;47m  ' + reset;\n        const darkBG = cc + `[40m  ` + reset;\n        return this.data\n            .map((i) => i.map((j) => (j ? darkBG : whiteBG)).join(''))\n            .join(String.fromCharCode(chCodes.newline));\n    }\n    toSVG(optimize = true) {\n        let out = `<svg viewBox=\"0 0 ${this.width} ${this.height}\" xmlns=\"http://www.w3.org/2000/svg\">`;\n        // Construct optimized SVG path data.\n        let pathData = '';\n        let prevPoint;\n        this.rectRead(0, Infinity, (point, val) => {\n            if (!val)\n                return;\n            const { x, y } = point;\n            if (!optimize) {\n                out += `<rect x=\"${x}\" y=\"${y}\" width=\"1\" height=\"1\" />`;\n                return;\n            }\n            // https://developer.mozilla.org/en-US/docs/Web/SVG/Reference/Attribute/d#path_commands\n            // Determine the shortest way to represent the initial cursor movement.\n            // M - Move cursor (without drawing) to absolute coordinate pair.\n            let m = `M${x} ${y}`;\n            // Only allow using the relative cursor move command if previous points\n            // were drawn.\n            if (prevPoint) {\n                // m - Move cursor (without drawing) to relative coordinate pair.\n                const relM = `m${x - prevPoint.x} ${y - prevPoint.y}`;\n                if (relM.length <= m.length)\n                    m = relM;\n            }\n            // Determine the shortest way to represent the cell's bottom line draw.\n            // H - Draw line from cursor position to absolute x coordinate.\n            // h - Draw line from cursor position to relative x coordinate.\n            const bH = x < 10 ? `H${x}` : 'h-1';\n            // v - Draw line from cursor position to relative y coordinate.\n            // Z - Close path (draws line from cursor position to M coordinate).\n            pathData += `${m}h1v1${bH}Z`;\n            prevPoint = point;\n        });\n        if (optimize)\n            out += `<path d=\"${pathData}\"/>`;\n        out += `</svg>`;\n        return out;\n    }\n    toGIF() {\n        // NOTE: Small, but inefficient implementation.\n        // Uses 1 byte per pixel.\n        const u16le = (i) => [i & 0xff, (i >>> 8) & 0xff];\n        const dims = [...u16le(this.width), ...u16le(this.height)];\n        const data = [];\n        this.rectRead(0, Infinity, (_, cur) => data.push(+(cur === true)));\n        const N = 126; // Block size\n        // prettier-ignore\n        const bytes = [\n            0x47, 0x49, 0x46, 0x38, 0x37, 0x61, ...dims, 0xf6, 0x00, 0x00, 0xff, 0xff, 0xff,\n            ...fillArr(3 * 127, 0x00), 0x2c, 0x00, 0x00, 0x00, 0x00, ...dims, 0x00, 0x07\n        ];\n        const fullChunks = Math.floor(data.length / N);\n        // Full blocks\n        for (let i = 0; i < fullChunks; i++)\n            bytes.push(N + 1, 0x80, ...data.slice(N * i, N * (i + 1)).map((i) => +i));\n        // Remaining bytes\n        bytes.push((data.length % N) + 1, 0x80, ...data.slice(fullChunks * N).map((i) => +i));\n        bytes.push(0x01, 0x81, 0x00, 0x3b);\n        return new Uint8Array(bytes);\n    }\n    toImage(isRGB = false) {\n        const { height, width } = this.size();\n        const data = new Uint8Array(height * width * (isRGB ? 3 : 4));\n        let i = 0;\n        for (let y = 0; y < height; y++) {\n            for (let x = 0; x < width; x++) {\n                const value = !!this.data[y][x] ? 0 : 255;\n                data[i++] = value;\n                data[i++] = value;\n                data[i++] = value;\n                if (!isRGB)\n                    data[i++] = 255; // alpha channel\n            }\n        }\n        return { height, width, data };\n    }\n}\n// End of utils\n// Runtime type-checking\n/** Error correction mode. low: 7%, medium: 15%, quartile: 25%, high: 30% */\nexport const ECMode = ['low', 'medium', 'quartile', 'high'];\n/** QR Code encoding */\nexport const Encoding = ['numeric', 'alphanumeric', 'byte', 'kanji', 'eci'];\n// Various constants & tables\n// prettier-ignore\nconst BYTES = [\n    // 1,  2,  3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15,  16,  17,  18,  19,   20,\n    26, 44, 70, 100, 134, 172, 196, 242, 292, 346, 404, 466, 532, 581, 655, 733, 815, 901, 991, 1085,\n    //  21,   22,   23,   24,   25,   26,   27,   28,   29,   30,   31,   32,   33,   34,   35,   36,   37,   38,   39,   40\n    1156, 1258, 1364, 1474, 1588, 1706, 1828, 1921, 2051, 2185, 2323, 2465, 2611, 2761, 2876, 3034, 3196, 3362, 3532, 3706,\n];\n// prettier-ignore\nconst WORDS_PER_BLOCK = {\n    // Version 1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40\n    low: [7, 10, 15, 20, 26, 18, 20, 24, 30, 18, 20, 24, 26, 30, 22, 24, 28, 30, 28, 28, 28, 28, 30, 30, 26, 28, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n    medium: [10, 16, 26, 18, 24, 16, 18, 22, 22, 26, 30, 22, 22, 24, 24, 28, 28, 26, 26, 26, 26, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28],\n    quartile: [13, 22, 18, 26, 18, 24, 18, 22, 20, 24, 28, 26, 24, 20, 30, 24, 28, 28, 26, 30, 28, 30, 30, 30, 30, 28, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n    high: [17, 28, 22, 16, 22, 28, 26, 26, 24, 28, 24, 28, 22, 24, 24, 30, 28, 28, 26, 28, 30, 24, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n};\n// prettier-ignore\nconst ECC_BLOCKS = {\n    // Version   1, 2, 3, 4, 5, 6, 7, 8, 9,10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40\n    low: [1, 1, 1, 1, 1, 2, 2, 2, 2, 4, 4, 4, 4, 4, 6, 6, 6, 6, 7, 8, 8, 9, 9, 10, 12, 12, 12, 13, 14, 15, 16, 17, 18, 19, 19, 20, 21, 22, 24, 25],\n    medium: [1, 1, 1, 2, 2, 4, 4, 4, 5, 5, 5, 8, 9, 9, 10, 10, 11, 13, 14, 16, 17, 17, 18, 20, 21, 23, 25, 26, 28, 29, 31, 33, 35, 37, 38, 40, 43, 45, 47, 49],\n    quartile: [1, 1, 2, 2, 4, 4, 6, 6, 8, 8, 8, 10, 12, 16, 12, 17, 16, 18, 21, 20, 23, 23, 25, 27, 29, 34, 34, 35, 38, 40, 43, 45, 48, 51, 53, 56, 59, 62, 65, 68],\n    high: [1, 1, 2, 4, 4, 4, 5, 6, 8, 8, 11, 11, 16, 16, 18, 16, 19, 21, 25, 25, 25, 34, 30, 32, 35, 37, 40, 42, 45, 48, 51, 54, 57, 60, 63, 66, 70, 74, 77, 81],\n};\nconst info = {\n    size: {\n        encode: (ver) => 21 + 4 * (ver - 1), // ver1 = 21, ver40=177 blocks\n        decode: (size) => (size - 17) / 4,\n    },\n    sizeType: (ver) => Math.floor((ver + 7) / 17),\n    // Based on https://codereview.stackexchange.com/questions/74925/algorithm-to-generate-this-alignment-pattern-locations-table-for-qr-codes\n    alignmentPatterns(ver) {\n        if (ver === 1)\n            return [];\n        const first = 6;\n        const last = info.size.encode(ver) - first - 1;\n        const distance = last - first;\n        const count = Math.ceil(distance / 28);\n        let interval = Math.floor(distance / count);\n        if (interval % 2)\n            interval += 1;\n        else if ((distance % count) * 2 >= count)\n            interval += 2;\n        const res = [first];\n        for (let m = 1; m < count; m++)\n            res.push(last - (count - m) * interval);\n        res.push(last);\n        return res;\n    },\n    ECCode: {\n        low: 0b01,\n        medium: 0b00,\n        quartile: 0b11,\n        high: 0b10,\n    },\n    formatMask: 0b101010000010010,\n    formatBits(ecc, maskIdx) {\n        const data = (info.ECCode[ecc] << 3) | maskIdx;\n        let d = data;\n        for (let i = 0; i < 10; i++)\n            d = (d << 1) ^ ((d >> 9) * 0b10100110111);\n        return ((data << 10) | d) ^ info.formatMask;\n    },\n    versionBits(ver) {\n        let d = ver;\n        for (let i = 0; i < 12; i++)\n            d = (d << 1) ^ ((d >> 11) * 0b1111100100101);\n        return (ver << 12) | d;\n    },\n    alphabet: {\n        numeric: alphabet('0123456789'),\n        alphanumerc: alphabet('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:'),\n    }, // as Record<EncodingType, ReturnType<typeof alphabet>>,\n    lengthBits(ver, type) {\n        const table = {\n            numeric: [10, 12, 14],\n            alphanumeric: [9, 11, 13],\n            byte: [8, 16, 16],\n            kanji: [8, 10, 12],\n            eci: [0, 0, 0],\n        };\n        return table[type][info.sizeType(ver)];\n    },\n    modeBits: {\n        numeric: '0001',\n        alphanumeric: '0010',\n        byte: '0100',\n        kanji: '1000',\n        eci: '0111',\n    },\n    capacity(ver, ecc) {\n        const bytes = BYTES[ver - 1];\n        const words = WORDS_PER_BLOCK[ecc][ver - 1];\n        const numBlocks = ECC_BLOCKS[ecc][ver - 1];\n        const blockLen = Math.floor(bytes / numBlocks) - words;\n        const shortBlocks = numBlocks - (bytes % numBlocks);\n        return {\n            words,\n            numBlocks,\n            shortBlocks,\n            blockLen,\n            capacity: (bytes - words * numBlocks) * 8,\n            total: (words + blockLen) * numBlocks + numBlocks - shortBlocks,\n        };\n    },\n};\nconst PATTERNS = [\n    (x, y) => (x + y) % 2 == 0,\n    (_x, y) => y % 2 == 0,\n    (x, _y) => x % 3 == 0,\n    (x, y) => (x + y) % 3 == 0,\n    (x, y) => (Math.floor(y / 2) + Math.floor(x / 3)) % 2 == 0,\n    (x, y) => ((x * y) % 2) + ((x * y) % 3) == 0,\n    (x, y) => (((x * y) % 2) + ((x * y) % 3)) % 2 == 0,\n    (x, y) => (((x + y) % 2) + ((x * y) % 3)) % 2 == 0,\n];\n// Galois field && reed-solomon encoding\nconst GF = {\n    tables: ((p_poly) => {\n        const exp = fillArr(256, 0);\n        const log = fillArr(256, 0);\n        for (let i = 0, x = 1; i < 256; i++) {\n            exp[i] = x;\n            log[x] = i;\n            x <<= 1;\n            if (x & 0x100)\n                x ^= p_poly;\n        }\n        return { exp, log };\n    })(0x11d),\n    exp: (x) => GF.tables.exp[x],\n    log(x) {\n        if (x === 0)\n            throw new Error(`GF.log: invalid arg=${x}`);\n        return GF.tables.log[x] % 255;\n    },\n    mul(x, y) {\n        if (x === 0 || y === 0)\n            return 0;\n        return GF.tables.exp[(GF.tables.log[x] + GF.tables.log[y]) % 255];\n    },\n    add: (x, y) => x ^ y,\n    pow: (x, e) => GF.tables.exp[(GF.tables.log[x] * e) % 255],\n    inv(x) {\n        if (x === 0)\n            throw new Error(`GF.inverse: invalid arg=${x}`);\n        return GF.tables.exp[255 - GF.tables.log[x]];\n    },\n    polynomial(poly) {\n        if (poly.length == 0)\n            throw new Error('GF.polymomial: invalid length');\n        if (poly[0] !== 0)\n            return poly;\n        // Strip leading zeros\n        let i = 0;\n        for (; i < poly.length - 1 && poly[i] == 0; i++)\n            ;\n        return poly.slice(i);\n    },\n    monomial(degree, coefficient) {\n        if (degree < 0)\n            throw new Error(`GF.monomial: invalid degree=${degree}`);\n        if (coefficient == 0)\n            return [0];\n        let coefficients = fillArr(degree + 1, 0);\n        coefficients[0] = coefficient;\n        return GF.polynomial(coefficients);\n    },\n    degree: (a) => a.length - 1,\n    coefficient: (a, degree) => a[GF.degree(a) - degree],\n    mulPoly(a, b) {\n        if (a[0] === 0 || b[0] === 0)\n            return [0];\n        const res = fillArr(a.length + b.length - 1, 0);\n        for (let i = 0; i < a.length; i++) {\n            for (let j = 0; j < b.length; j++) {\n                res[i + j] = GF.add(res[i + j], GF.mul(a[i], b[j]));\n            }\n        }\n        return GF.polynomial(res);\n    },\n    mulPolyScalar(a, scalar) {\n        if (scalar == 0)\n            return [0];\n        if (scalar == 1)\n            return a;\n        const res = fillArr(a.length, 0);\n        for (let i = 0; i < a.length; i++)\n            res[i] = GF.mul(a[i], scalar);\n        return GF.polynomial(res);\n    },\n    mulPolyMonomial(a, degree, coefficient) {\n        if (degree < 0)\n            throw new Error('GF.mulPolyMonomial: invalid degree');\n        if (coefficient == 0)\n            return [0];\n        const res = fillArr(a.length + degree, 0);\n        for (let i = 0; i < a.length; i++)\n            res[i] = GF.mul(a[i], coefficient);\n        return GF.polynomial(res);\n    },\n    addPoly(a, b) {\n        if (a[0] === 0)\n            return b;\n        if (b[0] === 0)\n            return a;\n        let smaller = a;\n        let larger = b;\n        if (smaller.length > larger.length)\n            [smaller, larger] = [larger, smaller];\n        let sumDiff = fillArr(larger.length, 0);\n        let lengthDiff = larger.length - smaller.length;\n        let s = larger.slice(0, lengthDiff);\n        for (let i = 0; i < s.length; i++)\n            sumDiff[i] = s[i];\n        for (let i = lengthDiff; i < larger.length; i++)\n            sumDiff[i] = GF.add(smaller[i - lengthDiff], larger[i]);\n        return GF.polynomial(sumDiff);\n    },\n    remainderPoly(data, divisor) {\n        const out = Array.from(data);\n        for (let i = 0; i < data.length - divisor.length + 1; i++) {\n            const elm = out[i];\n            if (elm === 0)\n                continue;\n            for (let j = 1; j < divisor.length; j++) {\n                if (divisor[j] !== 0)\n                    out[i + j] = GF.add(out[i + j], GF.mul(divisor[j], elm));\n            }\n        }\n        return out.slice(data.length - divisor.length + 1, out.length);\n    },\n    divisorPoly(degree) {\n        let g = [1];\n        for (let i = 0; i < degree; i++)\n            g = GF.mulPoly(g, [1, GF.pow(2, i)]);\n        return g;\n    },\n    evalPoly(poly, a) {\n        if (a == 0)\n            return GF.coefficient(poly, 0); // Just return the x^0 coefficient\n        let res = poly[0];\n        for (let i = 1; i < poly.length; i++)\n            res = GF.add(GF.mul(a, res), poly[i]);\n        return res;\n    },\n    // TODO: cleanup\n    euclidian(a, b, R) {\n        // Force degree(a) >= degree(b)\n        if (GF.degree(a) < GF.degree(b))\n            [a, b] = [b, a];\n        let rLast = a;\n        let r = b;\n        let tLast = [0];\n        let t = [1];\n        // while degree of Ri  t/2\n        while (2 * GF.degree(r) >= R) {\n            let rLastLast = rLast;\n            let tLastLast = tLast;\n            rLast = r;\n            tLast = t;\n            if (rLast[0] === 0)\n                throw new Error('rLast[0] === 0');\n            r = rLastLast;\n            let q = [0];\n            const dltInverse = GF.inv(rLast[0]);\n            while (GF.degree(r) >= GF.degree(rLast) && r[0] !== 0) {\n                const degreeDiff = GF.degree(r) - GF.degree(rLast);\n                const scale = GF.mul(r[0], dltInverse);\n                q = GF.addPoly(q, GF.monomial(degreeDiff, scale));\n                r = GF.addPoly(r, GF.mulPolyMonomial(rLast, degreeDiff, scale));\n            }\n            q = GF.mulPoly(q, tLast);\n            t = GF.addPoly(q, tLastLast);\n            if (GF.degree(r) >= GF.degree(rLast))\n                throw new Error(`Division failed r: ${r}, rLast: ${rLast}`);\n        }\n        const sigmaTildeAtZero = GF.coefficient(t, 0);\n        if (sigmaTildeAtZero == 0)\n            throw new Error('sigmaTilde(0) was zero');\n        const inverse = GF.inv(sigmaTildeAtZero);\n        return [GF.mulPolyScalar(t, inverse), GF.mulPolyScalar(r, inverse)];\n    },\n};\nfunction RS(eccWords) {\n    return {\n        encode(from) {\n            const d = GF.divisorPoly(eccWords);\n            const pol = Array.from(from);\n            pol.push(...d.slice(0, -1).fill(0));\n            return Uint8Array.from(GF.remainderPoly(pol, d));\n        },\n        decode(to) {\n            const res = to.slice();\n            const poly = GF.polynomial(Array.from(to));\n            // Find errors\n            let syndrome = fillArr(eccWords, 0);\n            let hasError = false;\n            for (let i = 0; i < eccWords; i++) {\n                const evl = GF.evalPoly(poly, GF.exp(i));\n                syndrome[syndrome.length - 1 - i] = evl;\n                if (evl !== 0)\n                    hasError = true;\n            }\n            if (!hasError)\n                return res;\n            syndrome = GF.polynomial(syndrome);\n            const monomial = GF.monomial(eccWords, 1);\n            const [errorLocator, errorEvaluator] = GF.euclidian(monomial, syndrome, eccWords);\n            // Error locations\n            const locations = fillArr(GF.degree(errorLocator), 0);\n            let e = 0;\n            for (let i = 1; i < 256 && e < locations.length; i++) {\n                if (GF.evalPoly(errorLocator, i) === 0)\n                    locations[e++] = GF.inv(i);\n            }\n            if (e !== locations.length)\n                throw new Error('RS.decode: invalid errors number');\n            for (let i = 0; i < locations.length; i++) {\n                const pos = res.length - 1 - GF.log(locations[i]);\n                if (pos < 0)\n                    throw new Error('RS.decode: invalid error location');\n                const xiInverse = GF.inv(locations[i]);\n                let denominator = 1;\n                for (let j = 0; j < locations.length; j++) {\n                    if (i === j)\n                        continue;\n                    denominator = GF.mul(denominator, GF.add(1, GF.mul(locations[j], xiInverse)));\n                }\n                res[pos] = GF.add(res[pos], GF.mul(GF.evalPoly(errorEvaluator, xiInverse), GF.inv(denominator)));\n            }\n            return res;\n        },\n    };\n}\n// Interleaves blocks\nfunction interleave(ver, ecc) {\n    const { words, shortBlocks, numBlocks, blockLen, total } = info.capacity(ver, ecc);\n    const rs = RS(words);\n    return {\n        encode(bytes) {\n            // Add error correction to bytes\n            const blocks = [];\n            const eccBlocks = [];\n            for (let i = 0; i < numBlocks; i++) {\n                const isShort = i < shortBlocks;\n                const len = blockLen + (isShort ? 0 : 1);\n                blocks.push(bytes.subarray(0, len));\n                eccBlocks.push(rs.encode(bytes.subarray(0, len)));\n                bytes = bytes.subarray(len);\n            }\n            const resBlocks = interleaveBytes(...blocks);\n            const resECC = interleaveBytes(...eccBlocks);\n            const res = new Uint8Array(resBlocks.length + resECC.length);\n            res.set(resBlocks);\n            res.set(resECC, resBlocks.length);\n            return res;\n        },\n        decode(data) {\n            if (data.length !== total)\n                throw new Error(`interleave.decode: len(data)=${data.length}, total=${total}`);\n            const blocks = [];\n            for (let i = 0; i < numBlocks; i++) {\n                const isShort = i < shortBlocks;\n                blocks.push(new Uint8Array(words + blockLen + (isShort ? 0 : 1)));\n            }\n            // Short blocks\n            let pos = 0;\n            for (let i = 0; i < blockLen; i++) {\n                for (let j = 0; j < numBlocks; j++)\n                    blocks[j][i] = data[pos++];\n            }\n            // Long blocks\n            for (let j = shortBlocks; j < numBlocks; j++)\n                blocks[j][blockLen] = data[pos++];\n            // ECC\n            for (let i = blockLen; i < blockLen + words; i++) {\n                for (let j = 0; j < numBlocks; j++) {\n                    const isShort = j < shortBlocks;\n                    blocks[j][i + (isShort ? 0 : 1)] = data[pos++];\n                }\n            }\n            // Decode\n            // Error-correct and copy data blocks together into a stream of bytes\n            const res = [];\n            for (const block of blocks)\n                res.push(...Array.from(rs.decode(block)).slice(0, -words));\n            return Uint8Array.from(res);\n        },\n    };\n}\n// Draw\n// Generic template per version+ecc+mask. Can be cached, to speedup calculations.\nfunction drawTemplate(ver, ecc, maskIdx, test = false) {\n    const size = info.size.encode(ver);\n    let b = new Bitmap(size + 2);\n    // Finder patterns\n    // We draw full pattern and later slice, since before addition of borders finder is truncated by one pixel on sides\n    const finder = new Bitmap(3).rect(0, 3, true).border(1, false).border(1, true).border(1, false);\n    b = b\n        .embed(0, finder) // top left\n        .embed({ x: -finder.width, y: 0 }, finder) // top right\n        .embed({ x: 0, y: -finder.height }, finder); // bottom left\n    b = b.rectSlice(1, size);\n    // Alignment patterns\n    const align = new Bitmap(1).rect(0, 1, true).border(1, false).border(1, true);\n    const alignPos = info.alignmentPatterns(ver);\n    for (const y of alignPos) {\n        for (const x of alignPos) {\n            if (b.data[y][x] !== undefined)\n                continue;\n            b.embed({ x: x - 2, y: y - 2 }, align); // center of pattern should be at position\n        }\n    }\n    // Timing patterns\n    b = b\n        .hLine({ x: 0, y: 6 }, Infinity, ({ x }, cur) => (cur === undefined ? x % 2 == 0 : cur))\n        .vLine({ x: 6, y: 0 }, Infinity, ({ y }, cur) => (cur === undefined ? y % 2 == 0 : cur));\n    // Format information\n    {\n        const bits = info.formatBits(ecc, maskIdx);\n        const getBit = (i) => !test && ((bits >> i) & 1) == 1;\n        // vertical\n        for (let i = 0; i < 6; i++)\n            b.data[i][8] = getBit(i); // right of top-left finder\n        // TODO: re-write as lines, like:\n        // b.vLine({ x: 8, y: 0 }, 6, ({ x, y }) => getBit(y));\n        for (let i = 6; i < 8; i++)\n            b.data[i + 1][8] = getBit(i); // after timing pattern\n        for (let i = 8; i < 15; i++)\n            b.data[size - 15 + i][8] = getBit(i); // right of bottom-left finder\n        // horizontal\n        for (let i = 0; i < 8; i++)\n            b.data[8][size - i - 1] = getBit(i); // under top-right finder\n        for (let i = 8; i < 9; i++)\n            b.data[8][15 - i - 1 + 1] = getBit(i); // VVV, after timing\n        for (let i = 9; i < 15; i++)\n            b.data[8][15 - i - 1] = getBit(i); // under top-left finder\n        b.data[size - 8][8] = !test; // bottom-left finder, right\n    }\n    // Version information\n    if (ver >= 7) {\n        const bits = info.versionBits(ver);\n        for (let i = 0; i < 18; i += 1) {\n            const bit = !test && ((bits >> i) & 1) == 1;\n            const x = Math.floor(i / 3);\n            const y = (i % 3) + size - 8 - 3;\n            // two copies\n            b.data[x][y] = bit;\n            b.data[y][x] = bit;\n        }\n    }\n    return b;\n}\n// zigzag: bottom->top && top->bottom\nfunction zigzag(tpl, maskIdx, fn) {\n    const size = tpl.height;\n    const pattern = PATTERNS[maskIdx];\n    // zig-zag pattern\n    let dir = -1;\n    let y = size - 1;\n    // two columns at time\n    for (let xOffset = size - 1; xOffset > 0; xOffset -= 2) {\n        if (xOffset == 6)\n            xOffset = 5; // skip vertical timing pattern\n        for (;; y += dir) {\n            for (let j = 0; j < 2; j += 1) {\n                const x = xOffset - j;\n                if (tpl.data[y][x] !== undefined)\n                    continue; // skip already written elements\n                fn(x, y, pattern(x, y));\n            }\n            if (y + dir < 0 || y + dir >= size)\n                break;\n        }\n        dir = -dir; // change direction\n    }\n}\n// NOTE: byte encoding is just representation, QR works with strings only. Most decoders will fail on raw byte array,\n// since they expect unicode or other text encoding inside bytes\nfunction detectType(str) {\n    let type = 'numeric';\n    for (let x of str) {\n        if (info.alphabet.numeric.has(x))\n            continue;\n        type = 'alphanumeric';\n        if (!info.alphabet.alphanumerc.has(x))\n            return 'byte';\n    }\n    return type;\n}\n/**\n * @example utf8ToBytes('abc') // new Uint8Array([97, 98, 99])\n */\nexport function utf8ToBytes(str) {\n    if (typeof str !== 'string')\n        throw new Error(`utf8ToBytes expected string, got ${typeof str}`);\n    return new Uint8Array(new TextEncoder().encode(str)); // https://bugzil.la/1681809\n}\nfunction encode(ver, ecc, data, type) {\n    let encoded = '';\n    let dataLen = data.length;\n    if (type === 'numeric') {\n        const t = info.alphabet.numeric.decode(data.split(''));\n        const n = t.length;\n        for (let i = 0; i < n - 2; i += 3)\n            encoded += bin(t[i] * 100 + t[i + 1] * 10 + t[i + 2], 10);\n        if (n % 3 === 1) {\n            encoded += bin(t[n - 1], 4);\n        }\n        else if (n % 3 === 2) {\n            encoded += bin(t[n - 2] * 10 + t[n - 1], 7);\n        }\n    }\n    else if (type === 'alphanumeric') {\n        const t = info.alphabet.alphanumerc.decode(data.split(''));\n        const n = t.length;\n        for (let i = 0; i < n - 1; i += 2)\n            encoded += bin(t[i] * 45 + t[i + 1], 11);\n        if (n % 2 == 1)\n            encoded += bin(t[n - 1], 6); // pad if odd number of chars\n    }\n    else if (type === 'byte') {\n        const utf8 = utf8ToBytes(data);\n        dataLen = utf8.length;\n        encoded = Array.from(utf8)\n            .map((i) => bin(i, 8))\n            .join('');\n    }\n    else {\n        throw new Error('encode: unsupported type');\n    }\n    const { capacity } = info.capacity(ver, ecc);\n    const len = bin(dataLen, info.lengthBits(ver, type));\n    let bits = info.modeBits[type] + len + encoded;\n    if (bits.length > capacity)\n        throw new Error('Capacity overflow');\n    // Terminator\n    bits += '0'.repeat(Math.min(4, Math.max(0, capacity - bits.length)));\n    // Pad bits string untill full byte\n    if (bits.length % 8)\n        bits += '0'.repeat(8 - (bits.length % 8));\n    // Add padding until capacity is full\n    const padding = '1110110000010001';\n    for (let idx = 0; bits.length !== capacity; idx++)\n        bits += padding[idx % padding.length];\n    // Convert a bitstring to array of bytes\n    const bytes = Uint8Array.from(bits.match(/(.{8})/g).map((i) => Number(`0b${i}`)));\n    return interleave(ver, ecc).encode(bytes);\n}\n// DRAW\nfunction drawQR(ver, ecc, data, maskIdx, test = false) {\n    const b = drawTemplate(ver, ecc, maskIdx, test);\n    let i = 0;\n    const need = 8 * data.length;\n    zigzag(b, maskIdx, (x, y, mask) => {\n        let value = false;\n        if (i < need) {\n            value = ((data[i >>> 3] >> ((7 - i) & 7)) & 1) !== 0;\n            i++;\n        }\n        b.data[y][x] = value !== mask; // !== as xor\n    });\n    if (i !== need)\n        throw new Error('QR: bytes left after draw');\n    return b;\n}\nfunction penalty(bm) {\n    const inverse = bm.inverse();\n    // Adjacent modules in row/column in same | No. of modules = (5 + i) color\n    const sameColor = (row) => {\n        let res = 0;\n        for (let i = 0, same = 1, last = undefined; i < row.length; i++) {\n            if (last === row[i]) {\n                same++;\n                if (i !== row.length - 1)\n                    continue; // handle last element\n            }\n            if (same >= 5)\n                res += 3 + (same - 5);\n            last = row[i];\n            same = 1;\n        }\n        return res;\n    };\n    let adjacent = 0;\n    bm.data.forEach((row) => (adjacent += sameColor(row)));\n    inverse.data.forEach((column) => (adjacent += sameColor(column)));\n    // Block of modules in same color (Block size = 2x2)\n    let box = 0;\n    let b = bm.data;\n    const lastW = bm.width - 1;\n    const lastH = bm.height - 1;\n    for (let x = 0; x < lastW; x++) {\n        for (let y = 0; y < lastH; y++) {\n            const x1 = x + 1;\n            const y1 = y + 1;\n            if (b[x][y] === b[x1][y] && b[x1][y] === b[x][y1] && b[x1][y] === b[x1][y1]) {\n                box += 3;\n            }\n        }\n    }\n    // 1:1:3:1:1 ratio (dark:light:dark:light:dark) pattern in row/column, preceded or followed by light area 4 modules wide\n    const finderPattern = (row) => {\n        const finderPattern = [true, false, true, true, true, false, true]; // dark:light:dark:light:dark\n        const lightPattern = [false, false, false, false]; // light area 4 modules wide\n        const p1 = [...finderPattern, ...lightPattern];\n        const p2 = [...lightPattern, ...finderPattern];\n        let res = 0;\n        for (let i = 0; i < row.length; i++) {\n            if (includesAt(row, p1, i))\n                res += 40;\n            if (includesAt(row, p2, i))\n                res += 40;\n        }\n        return res;\n    };\n    let finder = 0;\n    for (const row of bm.data)\n        finder += finderPattern(row);\n    for (const column of inverse.data)\n        finder += finderPattern(column);\n    // Proportion of dark modules in entire symbol\n    // Add 10 points to a deviation of 5% increment or decrement in the proportion\n    // ratio of dark module from the referential 50%\n    let darkPixels = 0;\n    bm.rectRead(0, Infinity, (_c, val) => (darkPixels += val ? 1 : 0));\n    const darkPercent = (darkPixels / (bm.height * bm.width)) * 100;\n    const dark = 10 * Math.floor(Math.abs(darkPercent - 50) / 5);\n    return adjacent + box + finder + dark;\n}\n// Selects best mask according to penalty, if no mask is provided\nfunction drawQRBest(ver, ecc, data, maskIdx) {\n    if (maskIdx === undefined) {\n        const bestMask = best();\n        for (let mask = 0; mask < PATTERNS.length; mask++)\n            bestMask.add(penalty(drawQR(ver, ecc, data, mask, true)), mask);\n        maskIdx = bestMask.get();\n    }\n    if (maskIdx === undefined)\n        throw new Error('Cannot find mask'); // Should never happen\n    return drawQR(ver, ecc, data, maskIdx);\n}\nfunction validateECC(ec) {\n    if (!ECMode.includes(ec))\n        throw new Error(`Invalid error correction mode=${ec}. Expected: ${ECMode}`);\n}\nfunction validateEncoding(enc) {\n    if (!Encoding.includes(enc))\n        throw new Error(`Encoding: invalid mode=${enc}. Expected: ${Encoding}`);\n    if (enc === 'kanji' || enc === 'eci')\n        throw new Error(`Encoding: ${enc} is not supported (yet?).`);\n}\nfunction validateMask(mask) {\n    if (![0, 1, 2, 3, 4, 5, 6, 7].includes(mask) || !PATTERNS[mask])\n        throw new Error(`Invalid mask=${mask}. Expected number [0..7]`);\n}\nexport function encodeQR(text, output = 'raw', opts = {}) {\n    const ecc = opts.ecc !== undefined ? opts.ecc : 'medium';\n    validateECC(ecc);\n    const encoding = opts.encoding !== undefined ? opts.encoding : detectType(text);\n    validateEncoding(encoding);\n    if (opts.mask !== undefined)\n        validateMask(opts.mask);\n    let ver = opts.version;\n    let data, err = new Error('Unknown error');\n    if (ver !== undefined) {\n        validateVersion(ver);\n        data = encode(ver, ecc, text, encoding);\n    }\n    else {\n        // If no version is provided, try to find smallest one which fits\n        // Currently just scans all version, can be significantly speedup if needed\n        for (let i = 1; i <= 40; i++) {\n            try {\n                data = encode(i, ecc, text, encoding);\n                ver = i;\n                break;\n            }\n            catch (e) {\n                err = e;\n            }\n        }\n    }\n    if (!ver || !data)\n        throw err;\n    let res = drawQRBest(ver, ecc, data, opts.mask);\n    res.assertDrawn();\n    const border = opts.border === undefined ? 2 : opts.border;\n    if (!Number.isSafeInteger(border))\n        throw new Error(`invalid border type=${typeof border}`);\n    res = res.border(border, false); // Add border\n    if (opts.scale !== undefined)\n        res = res.scale(opts.scale); // Scale image\n    if (output === 'raw')\n        return res.data;\n    else if (output === 'ascii')\n        return res.toASCII();\n    else if (output === 'svg')\n        return res.toSVG(opts.optimize);\n    else if (output === 'gif')\n        return res.toGIF();\n    else if (output === 'term')\n        return res.toTerm();\n    else\n        throw new Error(`Unknown output: ${output}`);\n}\nexport default encodeQR;\nexport const utils = {\n    best,\n    bin,\n    drawTemplate,\n    fillArr,\n    info,\n    interleave,\n    validateVersion,\n    zigzag,\n};\n// Unsafe API utils, exported only for tests\nexport const _tests = {\n    Bitmap,\n    info,\n    detectType,\n    encode,\n    drawQR,\n    penalty,\n    PATTERNS,\n};\n// Type tests\n// const o1 = qr('test', 'ascii');\n// const o2 = qr('test', 'raw');\n// const o3 = qr('test', 'gif');\n// const o4 = qr('test', 'svg');\n// const o5 = qr('test', 'term');\n//# sourceMappingURL=index.js.map","import './qr-code.css';\n\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport encodeQR from 'qr';\n\nconst canvas = window.OffscreenCanvas\n  ? new OffscreenCanvas(1, 1)\n  : document.createElement('canvas');\nconst ctx = canvas.getContext('2d', {\n  willReadFrequently: true,\n});\nctx.imageSmoothingEnabled = false;\n\nexport default function QrCode({\n  text,\n  arena,\n  backgroundMask,\n  arenaCircle = true,\n  caption,\n}) {\n  const captionRef = useRef(null);\n  const [captionHeight, setCaptionHeight] = useState(0);\n  const [arenaLoaded, setArenaLoaded] = useState(false);\n  const [arenaHasAlpha, setArenaHasAlpha] = useState(false);\n\n  const effectiveArenaCircle = arenaHasAlpha ? false : arenaCircle;\n\n  useEffect(() => {\n    if (caption && captionRef.current) {\n      const height = captionRef.current.offsetHeight;\n      setCaptionHeight(height);\n    }\n  }, [caption]);\n\n  useEffect(() => {\n    if (arena) {\n      const img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.onload = () => {\n        setArenaLoaded(true);\n        try {\n          const { width, height } = img;\n          canvas.width = width;\n          canvas.height = height;\n          ctx.drawImage(img, 0, 0);\n          const allPixels = ctx.getImageData(0, 0, width, height);\n          const data = allPixels.data;\n          const totalPixels = data.length / 4;\n          let lowAlphaCount = 0;\n          let hasAlpha = false;\n          for (let i = 3; i < data.length; i += 4) {\n            if (data[i] <= 128) lowAlphaCount++;\n            if (lowAlphaCount / totalPixels > 0.1) {\n              hasAlpha = true;\n              break;\n            }\n          }\n          setArenaHasAlpha(hasAlpha);\n        } catch (e) {\n          setArenaHasAlpha(false);\n        }\n      };\n      img.onerror = (error) => {\n        console.error('Failed to load arena image:', error);\n        setArenaLoaded(true); // Still show the image even on CORS error\n      };\n      img.src = arena;\n    } else {\n      setArenaLoaded(false);\n    }\n  }, [arena]);\n\n  if (!text) return null;\n\n  const qrData = useMemo(\n    () =>\n      encodeQR(text, 'raw', {\n        ecc: 'high',\n        border: 0,\n        scale: 1,\n      }),\n    [text],\n  );\n  const gridSize = qrData.length;\n\n  const centerExcludeSize = arenaLoaded ? Math.ceil(gridSize * 0.3) : 0;\n  const centerStart = Math.floor((gridSize - centerExcludeSize) / 2);\n  const centerEnd = centerStart + centerExcludeSize;\n\n  const isFilled = (x, y) => {\n    if (x < 0 || x >= gridSize || y < 0 || y >= gridSize) return false;\n\n    if (\n      arenaLoaded &&\n      x >= centerStart &&\n      x < centerEnd &&\n      y >= centerStart &&\n      y < centerEnd\n    ) {\n      if (arenaCircle) {\n        const centerX = (centerStart + centerEnd) / 2;\n        const centerY = (centerStart + centerEnd) / 2;\n        const radius = centerExcludeSize / 2;\n        const dx = x + 0.5 - centerX;\n        const dy = y + 0.5 - centerY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        if (distance < radius) return false;\n      } else {\n        return false;\n      }\n    }\n\n    return qrData[y][x];\n  };\n\n  const isFilledInGrid = (x, y) => {\n    if (x < 0 || x >= gridSize || y < 0 || y >= gridSize) return false;\n    return isFilled(x, y);\n  };\n\n  const isInPositionMarker = (x, y) => {\n    if (x < 7 && y < 7) return true;\n    if (x >= gridSize - 7 && y < 7) return true;\n    if (x < 7 && y >= gridSize - 7) return true;\n    return false;\n  };\n\n  const pathData = useMemo(() => {\n    let data = '';\n\n    for (let y = 0; y < gridSize; y++) {\n      for (let x = 0; x < gridSize; x++) {\n        if (!isFilledInGrid(x, y)) continue;\n        if (isInPositionMarker(x, y)) continue;\n\n        const cx = x + 0.5;\n        const cy = y + 0.5;\n        const hasTop =\n          isFilledInGrid(x, y - 1) && !isInPositionMarker(x, y - 1);\n        const hasRight =\n          isFilledInGrid(x + 1, y) && !isInPositionMarker(x + 1, y);\n        const hasBottom =\n          isFilledInGrid(x, y + 1) && !isInPositionMarker(x, y + 1);\n        const hasLeft =\n          isFilledInGrid(x - 1, y) && !isInPositionMarker(x - 1, y);\n\n        if (hasRight) {\n          data += `M ${cx} ${cy} L ${cx + 1} ${cy} `;\n        }\n        if (hasBottom) {\n          data += `M ${cx} ${cy} L ${cx} ${cy + 1} `;\n        }\n        if (!hasTop && !hasRight && !hasBottom && !hasLeft) {\n          data += `M ${cx} ${cy} L ${cx} ${cy} `;\n        }\n      }\n    }\n\n    return data;\n  }, [\n    gridSize,\n    qrData,\n    arenaLoaded,\n    centerStart,\n    centerEnd,\n    centerExcludeSize,\n    effectiveArenaCircle,\n  ]);\n\n  const markerPositions = [\n    { x: 0, y: 0 }, // Top-left\n    { x: gridSize - 7, y: 0 }, // Top-right\n    { x: 0, y: gridSize - 7 }, // Bottom-left\n  ];\n\n  const markerOuterRadius = 1.1; // Outer 7x7 square corner radius\n  const markerInnerRadius = 0.6; // Inner 3x3 square corner radius\n\n  const centerImagePadding = 1; // 1 cell width padding around the image\n  const centerImageSize = centerExcludeSize - centerImagePadding * 2;\n  const centerImageX = centerStart + centerImagePadding;\n  const centerImageY = centerStart + centerImagePadding;\n  const padding = 2;\n  const captionSpacing = 2; // Space between QR code and caption\n\n  const viewBoxWidth = gridSize + padding * 2;\n  const viewBoxHeight =\n    gridSize + padding * 2 + (caption ? captionSpacing + captionHeight : 0);\n  const bleed = viewBoxWidth * 0.25;\n\n  return (\n    <svg\n      class=\"qr-code\"\n      viewBox={`${-padding} ${-padding} ${viewBoxWidth} ${viewBoxHeight}`}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      shape-rendering=\"geometricPrecision\"\n    >\n      <defs>\n        <g id=\"position-marker\">\n          <rect\n            x=\"0.5\"\n            y=\"0.5\"\n            width=\"6\"\n            height=\"6\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            stroke-width=\"1\"\n            rx={markerOuterRadius}\n            ry={markerOuterRadius}\n          />\n          <rect\n            x=\"2\"\n            y=\"2\"\n            width=\"3\"\n            height=\"3\"\n            fill=\"currentColor\"\n            rx={markerInnerRadius}\n            ry={markerInnerRadius}\n          />\n        </g>\n        <g id=\"position-marker-mask\">\n          <rect\n            x=\"0.5\"\n            y=\"0.5\"\n            width=\"6\"\n            height=\"6\"\n            fill=\"none\"\n            stroke=\"white\"\n            stroke-width=\"1\"\n            rx={markerOuterRadius}\n            ry={markerOuterRadius}\n          />\n          <rect\n            x=\"2\"\n            y=\"2\"\n            width=\"3\"\n            height=\"3\"\n            fill=\"white\"\n            rx={markerInnerRadius}\n            ry={markerInnerRadius}\n          />\n        </g>\n        {backgroundMask && (\n          <filter id=\"blur-mask\">\n            <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"2\" />\n            <feColorMatrix type=\"saturate\" values=\"2\" />\n            <feComponentTransfer>\n              <feFuncR type=\"linear\" slope=\"1.2\" intercept=\"0.3\" />\n              <feFuncG type=\"linear\" slope=\"1.2\" intercept=\"0.3\" />\n              <feFuncB type=\"linear\" slope=\"1.2\" intercept=\"0.3\" />\n            </feComponentTransfer>\n          </filter>\n        )}\n        {backgroundMask && (\n          <mask id=\"qr-pattern-mask\">\n            <path\n              fill=\"white\"\n              stroke=\"white\"\n              stroke-width=\"1\"\n              stroke-linejoin=\"round\"\n              stroke-linecap=\"round\"\n              d={pathData}\n            />\n            <g id=\"position-markers-mask\">\n              {markerPositions.map((pos) => (\n                <use\n                  key={`${pos.x}-${pos.y}`}\n                  href=\"#position-marker-mask\"\n                  x={pos.x}\n                  y={pos.y}\n                />\n              ))}\n            </g>\n            {arenaLoaded && effectiveArenaCircle && (\n              <circle\n                cx={centerImageX + centerImageSize / 2}\n                cy={centerImageY + centerImageSize / 2}\n                r={centerImageSize / 2}\n                fill=\"black\"\n              />\n            )}\n            {arenaLoaded && !arenaCircle && (\n              <rect\n                x={centerImageX}\n                y={centerImageY}\n                width={centerImageSize}\n                height={centerImageSize}\n                fill=\"black\"\n              />\n            )}\n          </mask>\n        )}\n        <path\n          id=\"qr-pattern\"\n          fill=\"currentColor\"\n          stroke=\"currentColor\"\n          stroke-width=\"1\"\n          stroke-linejoin=\"round\"\n          stroke-linecap=\"round\"\n          d={pathData}\n        />\n      </defs>\n      <use href=\"#qr-pattern\" />\n      <g id=\"position-markers\">\n        {markerPositions.map((pos) => (\n          <use\n            key={`${pos.x}-${pos.y}`}\n            href=\"#position-marker\"\n            x={pos.x}\n            y={pos.y}\n          />\n        ))}\n      </g>\n      {backgroundMask && (\n        <g mask=\"url(#qr-pattern-mask)\">\n          <image\n            href={backgroundMask}\n            x={-padding - bleed}\n            y={-padding - bleed}\n            width={viewBoxWidth + bleed * 2}\n            height={viewBoxWidth + bleed * 2}\n            preserveAspectRatio=\"none\"\n            opacity=\"0.5\"\n            filter=\"url(#blur-mask)\"\n          />\n        </g>\n      )}\n      {arena && arenaLoaded && (\n        <image\n          href={arena}\n          x={centerImageX}\n          y={centerImageY}\n          width={centerImageSize}\n          height={centerImageSize}\n          preserveAspectRatio=\"xMidYMid slice\"\n          clip-path={\n            effectiveArenaCircle\n              ? `circle(${centerImageSize / 2}px at ${centerImageSize / 2}px ${centerImageSize / 2}px)`\n              : undefined\n          }\n        />\n      )}\n      {caption && (\n        <foreignObject\n          x={0}\n          y={gridSize + captionSpacing}\n          width={gridSize}\n          height={captionHeight}\n        >\n          <div\n            ref={captionRef}\n            xmlns=\"http://www.w3.org/1999/xhtml\"\n            class=\"qr-code-caption\"\n            dangerouslySetInnerHTML={{ __html: caption }}\n          />\n        </foreignObject>\n      )}\n    </svg>\n  );\n}\n","import './qr-code-modal.css';\n\nimport { useLingui } from '@lingui/react/macro';\n\nimport Icon from './icon';\nimport QrCode from './qr-code';\n\nexport const mediaDevicesSupported = !!navigator.mediaDevices?.getUserMedia;\n\nfunction QrCodeModal({\n  text,\n  arena,\n  backgroundMask,\n  caption,\n  onClose,\n  onScannerClick,\n}) {\n  const { t } = useLingui();\n  console.log('onScannerClick', onScannerClick);\n\n  return (\n    <div class=\"qr-code-modal-container\">\n      <div class=\"qr-code-modal-controls\">\n        {mediaDevicesSupported && typeof onScannerClick === 'function' ? (\n          <button type=\"button\" class=\"plain4\" onClick={onScannerClick}>\n            <Icon icon=\"scan\" alt={t`Scan QR code`} />\n          </button>\n        ) : (\n          <span />\n        )}\n        {!!onClose && (\n          <button type=\"button\" class=\"plain4\" onClick={onClose}>\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n        )}\n      </div>\n      <QrCode\n        text={text}\n        arena={arena}\n        backgroundMask={backgroundMask}\n        caption={caption}\n      />\n      <div class=\"qr-code-text\">{text}</div>\n    </div>\n  );\n}\n\nexport default QrCodeModal;\n","import './qr-scanner-modal.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nconst hasBarcodeDetector = 'BarcodeDetector' in window;\n\nif (!hasBarcodeDetector) {\n  // Prefetch qr/dom.js for caching\n  setTimeout(() => {\n    import('qr/dom.js').catch(() => {});\n  }, 1000);\n}\n\nimport Icon from './icon';\nimport Loader from './loader';\n\n// Copied from qr/dom.js because it's not exported\nclass QRCamera {\n  constructor(stream, player) {\n    this.stream = stream;\n    this.player = player;\n    this.setStream(stream);\n  }\n  setStream(stream) {\n    this.stream = stream;\n    const { player } = this;\n    player.setAttribute('autoplay', '');\n    player.setAttribute('muted', '');\n    player.setAttribute('playsinline', '');\n    player.srcObject = stream;\n  }\n  async listDevices() {\n    if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices)\n      throw new Error('Media Devices not supported');\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    return devices\n      .filter((device) => device.kind === 'videoinput')\n      .map((i) => ({\n        deviceId: i.deviceId,\n        label: i.label || `Camera ${i.deviceId}`,\n      }));\n  }\n  async setDevice(deviceId) {\n    this.stop();\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: { deviceId: { exact: deviceId } },\n    });\n    this.setStream(stream);\n  }\n  readFrame(canvas, fullSize = false) {\n    const { player } = this;\n    if (fullSize)\n      return canvas.drawImage(player, player.videoHeight, player.videoWidth);\n    const size = getSize(player);\n    return canvas.drawImage(player, size.height, size.width);\n  }\n  stop() {\n    for (const track of this.stream.getTracks()) track.stop();\n  }\n}\n\n// Copy of frontalCamera from qr/dom.js, but with custom constraints\nconst createQRCamera = async (player) => {\n  if (navigator.permissions?.query) {\n    try {\n      const permission = await navigator.permissions.query({\n        name: 'camera',\n      });\n      console.log('Camera permission status:', permission.state);\n\n      permission.addEventListener('change', () => {\n        console.log('Camera permission changed to:', permission.state);\n      });\n    } catch (err) {\n      console.warn('Permissions API camera query not supported:', err);\n    }\n  }\n\n  const stream = await navigator.mediaDevices.getUserMedia({\n    video: {\n      height: { ideal: 720 },\n      width: { ideal: 1280 },\n      facingMode: 'environment',\n    },\n  });\n  return new QRCamera(stream, player);\n};\n\nfunction QrScannerModal({ onClose, checkValidity, actionableText }) {\n  const { t, _ } = useLingui();\n  const containerRef = useRef(null);\n  const videoRef = useRef(null);\n  const overlayRef = useRef(null);\n  const [decodedText, setDecodedText] = useState('');\n  const [isScanning, setIsScanning] = useState(true);\n  const [uiState, setUIState] = useState('loading');\n\n  // Based on screen, not viewport or window\n  useEffect(() => {\n    // portrait as default\n    let handleScreenOrientationChange;\n    if (screen?.orientation?.type && containerRef.current) {\n      handleScreenOrientationChange = () => {\n        const screenOrientation = /landscape/.test(\n          window.screen.orientation.type,\n        )\n          ? 'landscape'\n          : 'portrait';\n        containerRef.current.classList.toggle(\n          'landscape',\n          screenOrientation === 'landscape',\n        );\n      };\n\n      screen.orientation.addEventListener(\n        'change',\n        handleScreenOrientationChange,\n      );\n      handleScreenOrientationChange();\n    }\n    return () => {\n      if (\n        handleScreenOrientationChange &&\n        screen?.orientation?.removeEventListener\n      ) {\n        screen.orientation.removeEventListener(\n          'change',\n          handleScreenOrientationChange,\n        );\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    let cancelMainLoop;\n    let cam;\n    let qrCanvas;\n    let detector;\n    let qrDom;\n\n    const startCamera = async () => {\n      try {\n        cam = await createQRCamera(videoRef.current);\n\n        if (hasBarcodeDetector) {\n          detector = new BarcodeDetector({ formats: ['qr_code'] });\n        } else {\n          qrDom = await import('qr/dom.js');\n          qrCanvas = new qrDom.QRCanvas(\n            {\n              overlay: overlayRef.current,\n            },\n            {\n              cropToSquare: false,\n              overlayMainColor: 'transparent',\n              overlayFinderColor: 'rgba(255, 0, 255, 0.5)',\n            },\n          );\n        }\n\n        // Start scanning loop when video plays (following demo pattern)\n        const video = videoRef.current;\n        if (video) {\n          video.addEventListener('loadedmetadata', () => {\n            setUIState('default');\n          });\n          video.addEventListener('play', () => {\n            // We won't have correct size until video starts playing\n            console.log('Video started playing, beginning scan loop');\n\n            // Get width, height from video\n            const { videoWidth: width, videoHeight: height } = video;\n\n            console.log('', { cam, video });\n\n            if (width && height) {\n              containerRef.current.style.setProperty(\n                '--long-dimension',\n                Math.max(width, height),\n              );\n              containerRef.current.style.setProperty(\n                '--short-dimension',\n                Math.min(width, height),\n              );\n            }\n\n            if (hasBarcodeDetector) {\n              const mainLoop = async () => {\n                try {\n                  const results = await detector.detect(videoRef.current);\n                  if (results.length > 0) {\n                    console.log('Scan result:', results[0].rawValue);\n                    setDecodedText(results[0].rawValue);\n                  }\n                } catch (e) {\n                  console.error('Error in barcode detection:', e);\n                }\n              };\n\n              let animationId;\n              const rafLoop = () => {\n                mainLoop();\n                animationId = requestAnimationFrame(rafLoop);\n              };\n              rafLoop();\n              cancelMainLoop = () => cancelAnimationFrame(animationId);\n            } else {\n              const mainLoop = () => {\n                try {\n                  const result = cam.readFrame(qrCanvas, true);\n                  if (result !== undefined && result !== null) {\n                    console.log('Scan result:', result);\n                    setDecodedText(result);\n                  }\n                } catch (e) {\n                  console.error('Error in scan loop:', e);\n                }\n              };\n\n              cancelMainLoop = qrDom.frameLoop(mainLoop);\n            }\n          });\n        }\n      } catch (err) {\n        console.error('Error accessing camera:', err);\n        setUIState('error');\n        setIsScanning(false);\n      }\n    };\n\n    if (isScanning) {\n      startCamera();\n    }\n\n    return () => {\n      if (cancelMainLoop) cancelMainLoop();\n      if (cam) {\n        cam.stop();\n      }\n      if (qrCanvas) {\n        qrCanvas.clear();\n      }\n    };\n  }, [isScanning]);\n\n  const showActionableButton =\n    typeof checkValidity === 'function'\n      ? checkValidity(decodedText)\n      : !!decodedText;\n\n  return (\n    <div class=\"qr-scanner-modal\">\n      <div class=\"qr-scanner-header\">\n        <Loader abrupt hidden={uiState !== 'loading'} />\n        <button type=\"button\" class=\"plain4\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      </div>\n      {uiState === 'error' ? (\n        <div class=\"ui-state\">\n          <p>\n            <Trans>Unable to access camera. Please check permissions.</Trans>\n          </p>\n        </div>\n      ) : (\n        <>\n          <div ref={containerRef} class=\"qr-scanner-video-container\">\n            <video ref={videoRef} playsInline muted disablepictureinpicture />\n            {!hasBarcodeDetector && (\n              <canvas ref={overlayRef} class=\"qr-scanner-canvas\" />\n            )}\n            <svg\n              class=\"qr-scanner-corner-hint\"\n              viewBox=\"0 0 100 100\"\n              preserveAspectRatio=\"xMidYMid meet\"\n            >\n              <path\n                d=\"M 25 10 L 15 10 Q 10 10 10 15 L 10 25\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n              <path\n                d=\"M 75 10 L 85 10 Q 90 10 90 15 L 90 25\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n              <path\n                d=\"M 25 90 L 15 90 Q 10 90 10 85 L 10 75\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n              <path\n                d=\"M 75 90 L 85 90 Q 90 90 90 85 L 90 75\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n            </svg>\n          </div>\n          <div class=\"qr-scanner-result\">\n            {!!decodedText && (\n              <>\n                <p class=\"qr-scanner-text\">{decodedText}</p>\n                {showActionableButton && (\n                  <button\n                    type=\"button\"\n                    class=\"button plain6\"\n                    onClick={() => {\n                      onClose({ text: decodedText });\n                    }}\n                  >\n                    {actionableText ? (\n                      _(actionableText)\n                    ) : (\n                      <Icon icon=\"arrow-right\" />\n                    )}\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default QrScannerModal;\n","import './report-modal.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { Fragment } from 'preact';\nimport { useMemo, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport localeMatch from '../utils/locale-match';\nimport showToast from '../utils/show-toast';\nimport { getCurrentInstance } from '../utils/store-utils';\n\nimport AccountBlock from './account-block';\nimport Icon from './icon';\nimport Loader from './loader';\nimport Status from './status';\n\n// NOTE: `dislike` hidden for now, it's actually not used for reporting\n// Mastodon shows another screen for unfollowing, muting or blocking instead of reporting\n\nconst CATEGORIES = [/*'dislike' ,*/ 'spam', 'legal', 'violation', 'other'];\n// `violation` will be set if there are `rule_ids[]`\n\nconst CATEGORIES_INFO = {\n  // dislike: {\n  //   label: 'Dislike',\n  //   description: 'Not something you want to see',\n  // },\n  spam: {\n    label: msg`Spam`,\n    description: msg`Malicious links, fake engagement, or repetitive replies`,\n  },\n  legal: {\n    label: msg`Illegal`,\n    description: msg`Violates the law of your or the server's country`,\n  },\n  violation: {\n    label: msg`Server rule violation`,\n    description: msg`Breaks specific server rules`,\n    stampLabel: msg`Violation`,\n  },\n  other: {\n    label: msg`Other`,\n    description: msg`Issue doesn't fit other categories`,\n    excludeStamp: true,\n  },\n};\n\nfunction findMatchingLanguage(rule, currentLang) {\n  if (!rule.translations || !currentLang) return null;\n  const availableLanguages = Object.keys(rule.translations);\n  if (!availableLanguages?.length) return null;\n\n  let matchedLang = localeMatch([currentLang], availableLanguages, null);\n  if (!matchedLang) {\n    // localeMatch fails if there are keys like zhCn, zhTw\n    // Convert them something like zh-CN first, try again\n    // Detect uppercase, then split by dash\n    const normalizedLanguages = availableLanguages.map((lang) => {\n      const parts = lang.split(/(?=[A-Z])/);\n      return parts\n        .map((part, i) => (i === 0 ? part : part.toLowerCase()))\n        .join('-');\n    });\n    matchedLang = localeMatch([currentLang], normalizedLanguages, null);\n  }\n\n  // If matchedLang has dash, convert back to original format\n  // E.g. zh-cn to zhCn\n  if (matchedLang && matchedLang.includes('-')) {\n    const [lang, region] = matchedLang.split('-');\n    matchedLang = lang + region.charAt(0).toUpperCase() + region.slice(1);\n  }\n\n  return matchedLang;\n}\n\nfunction translateRules(rules, currentLang) {\n  if (!rules?.length) return [];\n  if (!currentLang) return rules;\n  return rules.map((rule) => {\n    const matchedLang = findMatchingLanguage(rule, currentLang);\n    return {\n      ...rule,\n      _translatedText: rule.translations?.[matchedLang]?.text || null,\n    };\n  });\n}\n\nfunction ReportModal({ account, post, onClose }) {\n  const { _, t, i18n } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [username, domain] = account.acct.split('@');\n\n  const [translatedRules, currentDomain] = useMemo(() => {\n    const { rules, domain } = getCurrentInstance();\n    const rawRules = rules || [];\n    return [translateRules(rawRules, i18n.locale), domain];\n  }, [i18n.locale]);\n\n  const [selectedCategory, setSelectedCategory] = useState(null);\n  const [showRules, setShowRules] = useState(false);\n\n  const rulesRef = useRef(null);\n  const [hasRules, setHasRules] = useState(false);\n\n  return (\n    <div class=\"report-modal-container\">\n      <div class=\"top-controls\">\n        <h1>{post ? t`Report Post` : t`Report @${username}`}</h1>\n        <button\n          type=\"button\"\n          class=\"plain4 small\"\n          disabled={uiState === 'loading'}\n          onClick={() => onClose()}\n        >\n          <Icon icon=\"x\" size=\"xl\" alt={t`Close`} />\n        </button>\n      </div>\n      <main>\n        <div class=\"report-preview\">\n          {post ? (\n            <Status status={post} size=\"s\" previewMode />\n          ) : (\n            <AccountBlock\n              account={account}\n              avatarSize=\"xxl\"\n              useAvatarStatic\n              showStats\n              showActivity\n            />\n          )}\n        </div>\n        {!!selectedCategory &&\n          !CATEGORIES_INFO[selectedCategory].excludeStamp && (\n            <span\n              class=\"rubber-stamp\"\n              key={selectedCategory}\n              aria-hidden=\"true\"\n            >\n              {_(\n                CATEGORIES_INFO[selectedCategory].stampLabel ||\n                  _(CATEGORIES_INFO[selectedCategory].label),\n              )}\n              <small>\n                <Trans>Pending review</Trans>\n              </small>\n            </span>\n          )}\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n\n            const formData = new FormData(e.target);\n            const entries = Object.fromEntries(formData.entries());\n            console.log('ENTRIES', entries);\n\n            let { category, comment, forward } = entries;\n            if (!comment) comment = undefined;\n            if (forward === 'on') forward = true;\n            const ruleIds =\n              category === 'violation'\n                ? Object.entries(entries)\n                    .filter(([key]) => key.startsWith('rule_ids'))\n                    .map(([key, value]) => value)\n                : undefined;\n\n            const params = {\n              category,\n              comment,\n              forward,\n              ruleIds,\n            };\n            console.log('PARAMS', params);\n\n            setUIState('loading');\n            (async () => {\n              try {\n                await masto.v1.reports.create({\n                  accountId: account.id,\n                  statusIds: post?.id ? [post.id] : undefined,\n                  category,\n                  comment,\n                  ruleIds,\n                  forward,\n                });\n                setUIState('success');\n                showToast(post ? t`Post reported` : t`Profile reported`);\n                onClose();\n              } catch (error) {\n                console.error(error);\n                setUIState('error');\n                showToast(\n                  error?.message ||\n                    (post\n                      ? t`Unable to report post`\n                      : t`Unable to report profile`),\n                );\n              }\n            })();\n          }}\n        >\n          <p>\n            {post\n              ? t`What's the issue with this post?`\n              : t`What's the issue with this profile?`}\n          </p>\n          <section class=\"report-categories\">\n            {CATEGORIES.map((category) =>\n              category === 'violation' && !translatedRules?.length ? null : (\n                <Fragment key={category}>\n                  <label class=\"report-category\">\n                    <input\n                      type=\"radio\"\n                      name=\"category\"\n                      value={category}\n                      required\n                      disabled={uiState === 'loading'}\n                      onChange={(e) => {\n                        setSelectedCategory(e.target.value);\n                        setShowRules(e.target.value === 'violation');\n                      }}\n                    />\n                    <span>\n                      {_(CATEGORIES_INFO[category].label)} &nbsp;\n                      <small class=\"ib insignificant\">\n                        {_(CATEGORIES_INFO[category].description)}\n                      </small>\n                    </span>\n                  </label>\n                  {category === 'violation' && !!translatedRules?.length && (\n                    <div\n                      class=\"shazam-container no-animation\"\n                      hidden={!showRules}\n                    >\n                      <div class=\"shazam-container-inner\">\n                        <div class=\"report-rules\" ref={rulesRef}>\n                          {translatedRules.map((rule, i) => (\n                            <label class=\"report-rule\" key={rule.id}>\n                              <input\n                                type=\"checkbox\"\n                                name={`rule_ids[${i}]`}\n                                value={rule.id}\n                                required={showRules && !hasRules}\n                                disabled={uiState === 'loading'}\n                                onChange={(e) => {\n                                  const { checked } = e.target;\n                                  if (checked) {\n                                    setHasRules(true);\n                                  } else {\n                                    const checkedInputs =\n                                      rulesRef.current.querySelectorAll(\n                                        'input:checked',\n                                      );\n                                    if (!checkedInputs.length) {\n                                      setHasRules(false);\n                                    }\n                                  }\n                                }}\n                              />\n                              <span>{rule._translatedText || rule.text}</span>\n                            </label>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </Fragment>\n              ),\n            )}\n          </section>\n          <section class=\"report-comment\">\n            <p>\n              <label for=\"report-comment\">\n                <Trans>Additional info</Trans>\n              </label>\n            </p>\n            <textarea\n              maxlength=\"1000\"\n              rows=\"1\"\n              name=\"comment\"\n              id=\"report-comment\"\n              disabled={uiState === 'loading'}\n              required={!post} // Required if not reporting a post\n            />\n          </section>\n          {!!domain && domain !== currentDomain && (\n            <section>\n              <p>\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    switch\n                    name=\"forward\"\n                    disabled={uiState === 'loading'}\n                  />{' '}\n                  <span>\n                    <Trans>\n                      Forward to <i>{domain}</i>\n                    </Trans>\n                  </span>\n                </label>\n              </p>\n            </section>\n          )}\n          <footer>\n            <button type=\"submit\" disabled={uiState === 'loading'}>\n              <Trans>Send Report</Trans>\n            </button>{' '}\n            <button\n              type=\"submit\"\n              class=\"plain2\"\n              disabled={uiState === 'loading'}\n              onClick={async () => {\n                try {\n                  await masto.v1.accounts.$select(account.id).mute(); // Infinite duration\n                  showToast(t`Muted ${username}`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to mute ${username}`);\n                }\n                // onSubmit will still run\n              }}\n            >\n              <Trans>\n                Send Report <small class=\"ib\">+ Mute profile</small>\n              </Trans>\n            </button>{' '}\n            <button\n              type=\"submit\"\n              class=\"plain2\"\n              disabled={uiState === 'loading'}\n              onClick={async () => {\n                try {\n                  await masto.v1.accounts.$select(account.id).block();\n                  showToast(t`Blocked ${username}`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to block ${username}`);\n                }\n                // onSubmit will still run\n              }}\n            >\n              <Trans>\n                Send Report <small class=\"ib\">+ Block profile</small>\n              </Trans>\n            </button>\n            <Loader hidden={uiState !== 'loading'} />\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nexport default ReportModal;\n","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.5\nvar LZString = (function() {\n\n// private property\nvar f = String.fromCharCode;\nvar keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nvar keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\nvar baseReverseDic = {};\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i=0 ; i<alphabet.length ; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\nvar LZString = {\n  compressToBase64 : function (input) {\n    if (input == null) return \"\";\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\n    switch (res.length % 4) { // To produce valid Base64\n    default: // When could this happen ?\n    case 0 : return res;\n    case 1 : return res+\"===\";\n    case 2 : return res+\"==\";\n    case 3 : return res+\"=\";\n    }\n  },\n\n  decompressFromBase64 : function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\n  },\n\n  compressToUTF16 : function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \" \";\n  },\n\n  decompressFromUTF16: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\n  },\n\n  //compress into uint8array (UCS-2 big endian format)\n  compressToUint8Array: function (uncompressed) {\n    var compressed = LZString.compress(uncompressed);\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\n\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\n      var current_value = compressed.charCodeAt(i);\n      buf[i*2] = current_value >>> 8;\n      buf[i*2+1] = current_value % 256;\n    }\n    return buf;\n  },\n\n  //decompress from uint8array (UCS-2 big endian format)\n  decompressFromUint8Array:function (compressed) {\n    if (compressed===null || compressed===undefined){\n        return LZString.decompress(compressed);\n    } else {\n        var buf=new Array(compressed.length/2); // 2 bytes per character\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\n        }\n\n        var result = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(''));\n\n    }\n\n  },\n\n\n  //compress into a string that is already URI encoded\n  compressToEncodedURIComponent: function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\n  },\n\n  //decompress from an output of compressToEncodedURIComponent\n  decompressFromEncodedURIComponent:function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    input = input.replace(/ /g, \"+\");\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\n  },\n\n  compress: function (uncompressed) {\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\n  },\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\n    if (uncompressed == null) return \"\";\n    var i, value,\n        context_dictionary= {},\n        context_dictionaryToCreate= {},\n        context_c=\"\",\n        context_wc=\"\",\n        context_w=\"\",\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\n        context_dictSize= 3,\n        context_numBits= 2,\n        context_data=[],\n        context_data_val=0,\n        context_data_position=0,\n        ii;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n          if (context_w.charCodeAt(0)<256) {\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<8 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position ==bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<16 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n\n\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        // Add wc to the dictionary.\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    }\n\n    // Output the code for w.\n    if (context_w !== \"\") {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n        if (context_w.charCodeAt(0)<256) {\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<8 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<16 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i=0 ; i<context_numBits ; i++) {\n          context_data_val = (context_data_val << 1) | (value&1);\n          if (context_data_position == bitsPerChar-1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n\n\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    }\n\n    // Mark the end of the stream\n    value = 2;\n    for (i=0 ; i<context_numBits ; i++) {\n      context_data_val = (context_data_val << 1) | (value&1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data_position = 0;\n        context_data.push(getCharFromInt(context_data_val));\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n      value = value >> 1;\n    }\n\n    // Flush the last char\n    while (true) {\n      context_data_val = (context_data_val << 1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data.push(getCharFromInt(context_data_val));\n        break;\n      }\n      else context_data_position++;\n    }\n    return context_data.join('');\n  },\n\n  decompress: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\n  },\n\n  _decompress: function (length, resetValue, getNextValue) {\n    var dictionary = [],\n        next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits, resb, maxpower, power,\n        c,\n        data = {val:getNextValue(0), position:resetValue, index:1};\n\n    for (i = 0; i < 3; i += 1) {\n      dictionary[i] = i;\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2,2);\n    power=1;\n    while (power!=maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb>0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch (next = bits) {\n      case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 2:\n        return \"\";\n    }\n    dictionary[3] = c;\n    w = c;\n    result.push(c);\n    while (true) {\n      if (data.index > length) {\n        return \"\";\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2,numBits);\n      power=1;\n      while (power!=maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb>0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (c = bits) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 2:\n          return result.join('');\n      }\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n      if (dictionary[c]) {\n        entry = dictionary[c];\n      } else {\n        if (c === dictSize) {\n          entry = w + w.charAt(0);\n        } else {\n          return null;\n        }\n      }\n      result.push(entry);\n\n      // Add w+entry[0] to the dictionary.\n      dictionary[dictSize++] = w + entry.charAt(0);\n      enlargeIn--;\n\n      w = entry;\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n    }\n  }\n};\n  return LZString;\n})();\n\nif (typeof define === 'function' && define.amd) {\n  define(function () { return LZString; });\n} else if( typeof module !== 'undefined' && module != null ) {\n  module.exports = LZString\n} else if( typeof angular !== 'undefined' && angular != null ) {\n  angular.module('LZString', [])\n  .factory('LZString', function () {\n    return LZString;\n  });\n}\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e\"","import { api } from '../utils/api';\nimport store from '../utils/store';\n\nconst LIMIT = 200;\nconst MAX_FETCH = 10;\n\nexport async function fetchFollowedTags() {\n  const { masto } = api();\n  const iterator = masto.v1.followedTags\n    .list({\n      limit: LIMIT,\n    })\n    .values();\n  const tags = [];\n  let fetchCount = 0;\n  do {\n    const { value, done } = await iterator.next();\n    if (done || value?.length === 0) break;\n    tags.push(...value);\n    fetchCount++;\n  } while (fetchCount < MAX_FETCH);\n  tags.sort((a, b) => a.name.localeCompare(b.name));\n  console.log(tags);\n\n  if (tags.length) {\n    setTimeout(() => {\n      // Save to local storage, with saved timestamp\n      store.account.set('followedTags', {\n        tags,\n        updatedAt: Date.now(),\n      });\n    }, 1);\n  }\n\n  return tags;\n}\n\nconst MAX_AGE = 24 * 60 * 60 * 1000; // 1 day\nexport async function getFollowedTags() {\n  try {\n    const { tags, updatedAt } = store.account.get('followedTags') || {};\n    if (!tags?.length) return await fetchFollowedTags();\n    if (Date.now() - updatedAt > MAX_AGE) {\n      // Stale-while-revalidate\n      fetchFollowedTags();\n      return tags;\n    }\n    return tags;\n  } catch (e) {\n    return [];\n  }\n}\n\nconst fauxDiv = document.createElement('div');\nexport const extractTagsFromStatus = (content) => {\n  if (!content) return [];\n  if (content.indexOf('#') === -1) return [];\n  fauxDiv.innerHTML = content;\n  const hashtagLinks = fauxDiv.querySelectorAll('a.hashtag');\n  if (!hashtagLinks.length) return [];\n  return Array.from(hashtagLinks).map((a) =>\n    a.innerText.trim().replace(/^[^#]*#+/, ''),\n  );\n};\n","import { useEffect, useState } from 'preact/hooks';\n\nfunction AsyncText({ children }) {\n  if (typeof children === 'string') return children;\n  const [text, setText] = useState('');\n  useEffect(() => {\n    Promise.resolve(children).then(setText);\n  }, [children]);\n  return text;\n}\n\nexport default AsyncText;\n","import './shortcuts-settings.css';\n\nimport { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { msg, t } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport {\n  compressToEncodedURIComponent,\n  decompressFromEncodedURIComponent,\n} from 'lz-string';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport floatingButtonUrl from '../assets/floating-button.svg';\nimport multiColumnUrl from '../assets/multi-column.svg';\nimport tabMenuBarUrl from '../assets/tab-menu-bar.svg';\n\nimport { api } from '../utils/api';\nimport { fetchFollowedTags } from '../utils/followed-tags';\nimport { getLists, getListTitle } from '../utils/lists';\nimport pmem from '../utils/pmem';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport { getCurrentAccountID } from '../utils/store-utils';\n\nimport AsyncText from './AsyncText';\nimport Icon from './icon';\nimport MenuConfirm from './menu-confirm';\nimport Modal from './modal';\nimport { mediaDevicesSupported } from './qr-code-modal';\n\nexport const SHORTCUTS_LIMIT = 9;\n\nconst TYPES = [\n  'following',\n  'mentions',\n  'notifications',\n  'list',\n  'public',\n  'trending',\n  'search',\n  'hashtag',\n  'bookmarks',\n  'favourites',\n  // NOTE: Hide for now\n  // 'account-statuses', // Need @acct search first\n];\nconst TYPE_TEXT = {\n  following: msg`Home / Following`,\n  notifications: msg`Notifications`,\n  list: msg`Lists`,\n  public: msg`Public (Local / Federated)`,\n  search: msg`Search`,\n  'account-statuses': msg`Account`,\n  bookmarks: msg`Bookmarks`,\n  favourites: msg`Likes`,\n  hashtag: msg`Hashtag`,\n  trending: msg`Trending`,\n  mentions: msg`Mentions`,\n};\nconst TYPE_PARAMS = {\n  list: [\n    {\n      text: msg`List ID`,\n      name: 'id',\n      notRequired: true,\n    },\n  ],\n  public: [\n    {\n      text: msg`Local only`,\n      name: 'local',\n      type: 'checkbox',\n    },\n    {\n      text: msg`Instance`,\n      name: 'instance',\n      type: 'text',\n      placeholder: msg`Optional, e.g. mastodon.social`,\n      notRequired: true,\n    },\n  ],\n  trending: [\n    {\n      text: msg`Instance`,\n      name: 'instance',\n      type: 'text',\n      placeholder: msg`Optional, e.g. mastodon.social`,\n      notRequired: true,\n    },\n  ],\n  search: [\n    {\n      text: msg`Search term`,\n      name: 'query',\n      type: 'text',\n      placeholder: msg`Optional, unless for multi-column mode`,\n      notRequired: true,\n    },\n  ],\n  'account-statuses': [\n    {\n      text: '@',\n      name: 'id',\n      type: 'text',\n      placeholder: 'cheeaun@mastodon.social',\n    },\n  ],\n  hashtag: [\n    {\n      text: '#',\n      name: 'hashtag',\n      type: 'text',\n      placeholder: msg`e.g. PixelArt (Max 5, space-separated)`,\n      pattern: '[^#]+',\n    },\n    {\n      text: msg`Media only`,\n      name: 'media',\n      type: 'checkbox',\n    },\n    {\n      text: msg`Instance`,\n      name: 'instance',\n      type: 'text',\n      placeholder: msg`Optional, e.g. mastodon.social`,\n      notRequired: true,\n    },\n  ],\n};\nconst fetchAccountTitle = pmem(async ({ id }) => {\n  const account = await api().masto.v1.accounts.$select(id).fetch();\n  return account.username || account.acct || account.displayName;\n});\nexport const SHORTCUTS_META = {\n  following: {\n    id: 'home',\n    title: (_, index) =>\n      index === 0\n        ? t`Home`\n        : t({ id: 'following.title', message: 'Following' }),\n    path: '/',\n    icon: 'home',\n  },\n  mentions: {\n    id: 'mentions',\n    title: msg`Mentions`,\n    path: '/mentions',\n    icon: 'at',\n  },\n  notifications: {\n    id: 'notifications',\n    title: msg`Notifications`,\n    path: '/notifications',\n    icon: 'notification',\n  },\n  list: {\n    id: ({ id }) => (id ? 'list' : 'lists'),\n    title: ({ id }) => (id ? getListTitle(id) : t`Lists`),\n    path: ({ id }) => (id ? `/l/${id}` : '/l'),\n    icon: 'list',\n    excludeViewMode: ({ id }) => (!id ? ['multi-column'] : []),\n  },\n  public: {\n    id: 'public',\n    title: ({ local }) => (local ? t`Local` : t`Federated`),\n    subtitle: ({ instance }) => instance || api().instance,\n    path: ({ local, instance }) => `/${instance}/p${local ? '/l' : ''}`,\n    icon: ({ local }) => (local ? 'building' : 'earth'),\n  },\n  trending: {\n    id: 'trending',\n    title: msg`Trending`,\n    subtitle: ({ instance }) => instance || api().instance,\n    path: ({ instance }) => `/${instance}/trending`,\n    icon: 'chart',\n  },\n  search: {\n    id: 'search',\n    title: ({ query }) => (query ? `${query}` : t`Search`),\n    path: ({ query }) =>\n      query\n        ? `/search?q=${encodeURIComponent(query)}&type=statuses`\n        : '/search',\n    icon: 'search',\n    excludeViewMode: ({ query }) => (!query ? ['multi-column'] : []),\n  },\n  'account-statuses': {\n    id: 'account-statuses',\n    title: fetchAccountTitle,\n    path: ({ id }) => `/a/${id}`,\n    icon: 'user',\n  },\n  bookmarks: {\n    id: 'bookmarks',\n    title: msg`Bookmarks`,\n    path: '/b',\n    icon: 'bookmark',\n  },\n  favourites: {\n    id: 'favourites',\n    title: msg`Likes`,\n    path: '/f',\n    icon: 'heart',\n  },\n  hashtag: {\n    id: 'hashtag',\n    title: ({ hashtag }) => hashtag,\n    subtitle: ({ instance }) => instance || api().instance,\n    path: ({ hashtag, instance, media }) =>\n      `${instance ? `/${instance}` : ''}/t/${hashtag.split(/\\s+/).join('+')}${\n        media ? '?media=1' : ''\n      }`,\n    icon: 'hashtag',\n  },\n};\n\nfunction ShortcutsSettings({ onClose }) {\n  const { _ } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { shortcuts } = snapStates;\n  const [showForm, setShowForm] = useState(false);\n  const [showImportExport, setShowImportExport] = useState(false);\n\n  const [shortcutsListParent] = useAutoAnimate();\n\n  return (\n    <div id=\"shortcuts-settings-container\" class=\"sheet\" tabindex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Icon icon=\"shortcut\" /> <Trans>Shortcuts</Trans>{' '}\n          <sup\n            style={{\n              fontSize: 12,\n              opacity: 0.5,\n              textTransform: 'uppercase',\n            }}\n          >\n            <Trans>beta</Trans>\n          </sup>\n        </h2>\n      </header>\n      <main>\n        <p>\n          <Trans>Specify a list of shortcuts that'll appear&nbsp;as:</Trans>\n        </p>\n        <div class=\"shortcuts-view-mode\">\n          {[\n            {\n              value: 'float-button',\n              label: t`Floating button`,\n              imgURL: floatingButtonUrl,\n            },\n            {\n              value: 'tab-menu-bar',\n              label: t`Tab/Menu bar`,\n              imgURL: tabMenuBarUrl,\n            },\n            {\n              value: 'multi-column',\n              label: t`Multi-column`,\n              imgURL: multiColumnUrl,\n            },\n          ].map(({ value, label, imgURL }) => {\n            const checked =\n              snapStates.settings.shortcutsViewMode === value ||\n              (value === 'float-button' &&\n                !snapStates.settings.shortcutsViewMode);\n            return (\n              <label key={value} class={checked ? 'checked' : ''}>\n                <input\n                  type=\"radio\"\n                  name=\"shortcuts-view-mode\"\n                  value={value}\n                  checked={checked}\n                  onChange={(e) => {\n                    states.settings.shortcutsViewMode = e.target.value;\n                  }}\n                />{' '}\n                <img src={imgURL} alt=\"\" width=\"80\" height=\"58\" />{' '}\n                <span>{label}</span>\n              </label>\n            );\n          })}\n        </div>\n        {shortcuts.length > 0 ? (\n          <>\n            <ol class=\"shortcuts-list\" ref={shortcutsListParent}>\n              {shortcuts.filter(Boolean).map((shortcut, i) => {\n                // const key = i + Object.values(shortcut);\n                const key = Object.values(shortcut).join('-');\n                const { type } = shortcut;\n                if (!SHORTCUTS_META[type]) return null;\n                let { icon, title, subtitle, excludeViewMode } =\n                  SHORTCUTS_META[type];\n                if (typeof title === 'function') {\n                  title = title(shortcut, i);\n                } else {\n                  title = _(title);\n                }\n                if (typeof subtitle === 'function') {\n                  subtitle = subtitle(shortcut, i);\n                } else {\n                  subtitle = _(subtitle);\n                }\n                if (typeof icon === 'function') {\n                  icon = icon(shortcut, i);\n                }\n                if (typeof excludeViewMode === 'function') {\n                  excludeViewMode = excludeViewMode(shortcut, i);\n                }\n                const excludedViewMode = excludeViewMode?.includes(\n                  snapStates.settings.shortcutsViewMode,\n                );\n                return (\n                  <li key={key}>\n                    <Icon icon={icon} />\n                    <span class=\"shortcut-text\">\n                      <AsyncText>{title}</AsyncText>\n                      {subtitle && (\n                        <>\n                          {' '}\n                          <small class=\"ib insignificant\">{subtitle}</small>\n                        </>\n                      )}\n                      {excludedViewMode && (\n                        <span class=\"tag\">\n                          <Trans>Not available in current view mode</Trans>\n                        </span>\n                      )}\n                    </span>\n                    <span class=\"shortcut-actions\">\n                      <button\n                        type=\"button\"\n                        class=\"plain small\"\n                        disabled={i === 0}\n                        onClick={() => {\n                          const shortcutsArr = Array.from(states.shortcuts);\n                          if (i > 0) {\n                            const temp = states.shortcuts[i - 1];\n                            shortcutsArr[i - 1] = shortcut;\n                            shortcutsArr[i] = temp;\n                            states.shortcuts = shortcutsArr;\n                          }\n                        }}\n                      >\n                        <Icon icon=\"arrow-up\" alt={t`Move up`} />\n                      </button>\n                      <button\n                        type=\"button\"\n                        class=\"plain small\"\n                        disabled={i === shortcuts.length - 1}\n                        onClick={() => {\n                          const shortcutsArr = Array.from(states.shortcuts);\n                          if (i < states.shortcuts.length - 1) {\n                            const temp = states.shortcuts[i + 1];\n                            shortcutsArr[i + 1] = shortcut;\n                            shortcutsArr[i] = temp;\n                            states.shortcuts = shortcutsArr;\n                          }\n                        }}\n                      >\n                        <Icon icon=\"arrow-down\" alt={t`Move down`} />\n                      </button>\n                      <button\n                        type=\"button\"\n                        class=\"plain small\"\n                        onClick={() => {\n                          setShowForm({\n                            shortcut,\n                            shortcutIndex: i,\n                          });\n                        }}\n                      >\n                        <Icon icon=\"pencil\" alt={t`Edit`} />\n                      </button>\n                      {/* <button\n                      type=\"button\"\n                      class=\"plain small\"\n                      onClick={() => {\n                        states.shortcuts.splice(i, 1);\n                      }}\n                    >\n                      <Icon icon=\"x\" alt=\"Remove\" />\n                    </button> */}\n                    </span>\n                  </li>\n                );\n              })}\n            </ol>\n            {shortcuts.length === 1 &&\n              snapStates.settings.shortcutsViewMode !== 'float-button' && (\n                <div class=\"ui-state insignificant\">\n                  <Icon icon=\"info\" />{' '}\n                  <small>\n                    <Trans>\n                      Add more than one shortcut/column to make this work.\n                    </Trans>\n                  </small>\n                </div>\n              )}\n          </>\n        ) : (\n          <div class=\"ui-state insignificant\">\n            <p>\n              {snapStates.settings.shortcutsViewMode === 'multi-column'\n                ? t`No columns yet. Tap on the Add column button.`\n                : t`No shortcuts yet. Tap on the Add shortcut button.`}\n            </p>\n            <p>\n              <Trans>\n                Not sure what to add?\n                <br />\n                Try adding{' '}\n                <a\n                  href=\"#\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.shortcuts = [\n                      {\n                        type: 'following',\n                      },\n                      {\n                        type: 'notifications',\n                      },\n                    ];\n                  }}\n                >\n                  Home / Following and Notifications\n                </a>{' '}\n                first.\n              </Trans>\n            </p>\n          </div>\n        )}\n        <p class=\"insignificant\">\n          {shortcuts.length >= SHORTCUTS_LIMIT &&\n            (snapStates.settings.shortcutsViewMode === 'multi-column'\n              ? t`Max ${SHORTCUTS_LIMIT} columns`\n              : t`Max ${SHORTCUTS_LIMIT} shortcuts`)}\n        </p>\n        <p\n          style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n          }}\n        >\n          <button\n            type=\"button\"\n            class=\"light\"\n            onClick={() => setShowImportExport(true)}\n          >\n            <Trans>Import/export</Trans>\n          </button>\n          <button\n            type=\"button\"\n            disabled={shortcuts.length >= SHORTCUTS_LIMIT}\n            onClick={() => setShowForm(true)}\n          >\n            <Icon icon=\"plus\" />{' '}\n            <span>\n              {snapStates.settings.shortcutsViewMode === 'multi-column'\n                ? t`Add column`\n                : t`Add shortcut`}\n            </span>\n          </button>\n        </p>\n      </main>\n      {showForm && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowForm(false);\n            }\n          }}\n        >\n          <ShortcutForm\n            shortcut={showForm.shortcut}\n            shortcutIndex={showForm.shortcutIndex}\n            onSubmit={({ result, mode }) => {\n              console.log('onSubmit', result);\n              if (mode === 'edit') {\n                states.shortcuts[showForm.shortcutIndex] = result;\n              } else {\n                states.shortcuts.push(result);\n              }\n            }}\n            onClose={() => setShowForm(false)}\n          />\n        </Modal>\n      )}\n      {showImportExport && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowImportExport(false);\n            }\n          }}\n        >\n          <ImportExport\n            shortcuts={shortcuts}\n            onClose={() => setShowImportExport(false)}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nconst FORM_NOTES = {\n  list: msg`Specific list is optional. For multi-column mode, list is required, else the column will not be shown.`,\n  search: msg`For multi-column mode, search term is required, else the column will not be shown.`,\n  hashtag: msg`Multiple hashtags are supported. Space-separated.`,\n};\n\nfunction ShortcutForm({\n  onSubmit,\n  disabled,\n  shortcut,\n  shortcutIndex,\n  onClose,\n}) {\n  const { _ } = useLingui();\n  console.log('shortcut', shortcut);\n  const editMode = !!shortcut;\n  const [currentType, setCurrentType] = useState(shortcut?.type || null);\n\n  const [uiState, setUIState] = useState('default');\n  const [lists, setLists] = useState([]);\n  const [followedHashtags, setFollowedHashtags] = useState([]);\n  useEffect(() => {\n    (async () => {\n      if (currentType !== 'list') return;\n      try {\n        setUIState('loading');\n        const lists = await getLists();\n        setLists(lists);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n\n    (async () => {\n      if (currentType !== 'hashtag') return;\n      try {\n        const tags = await fetchFollowedTags();\n        setFollowedHashtags(tags);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [currentType]);\n\n  const formRef = useRef();\n  useEffect(() => {\n    if (editMode && currentType && TYPE_PARAMS[currentType]) {\n      // Populate form\n      const form = formRef.current;\n      TYPE_PARAMS[currentType].forEach(({ name, type }) => {\n        const input = form.querySelector(`[name=\"${name}\"]`);\n        if (input && shortcut[name]) {\n          if (type === 'checkbox') {\n            input.checked = shortcut[name] === 'on' ? true : false;\n          } else {\n            input.value = shortcut[name];\n          }\n        }\n      });\n    }\n  }, [editMode, currentType]);\n\n  return (\n    <div id=\"shortcut-settings-form\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>{editMode ? t`Edit shortcut` : t`Add shortcut`}</h2>\n      </header>\n      <main tabindex=\"-1\">\n        <form\n          ref={formRef}\n          onSubmit={(e) => {\n            // Construct a nice object from form\n            e.preventDefault();\n            const data = new FormData(e.target);\n            const result = {};\n            data.forEach((value, key) => {\n              result[key] = value?.trim();\n              if (key === 'instance') {\n                // Remove protocol and trailing slash\n                result[key] = result[key]\n                  .replace(/^https?:\\/\\//, '')\n                  .replace(/\\/+$/, '');\n                // Remove @acct@ or acct@ from instance URL\n                result[key] = result[key].replace(/^@?[^@]+@/, '');\n              }\n            });\n            console.log('result', result);\n            if (!result.type) return;\n            onSubmit({\n              result,\n              mode: editMode ? 'edit' : 'add',\n            });\n            // Reset\n            e.target.reset();\n            setCurrentType(null);\n            onClose?.();\n          }}\n        >\n          <p>\n            <label>\n              <span>\n                <Trans>Timeline</Trans>\n              </span>\n              <select\n                required\n                disabled={disabled}\n                onChange={(e) => {\n                  setCurrentType(e.target.value);\n                }}\n                defaultValue={editMode ? shortcut.type : undefined}\n                name=\"type\"\n                dir=\"auto\"\n              >\n                <option></option>\n                {TYPES.map((type) => (\n                  <option value={type}>{_(TYPE_TEXT[type])}</option>\n                ))}\n              </select>\n            </label>\n          </p>\n          {TYPE_PARAMS[currentType]?.map?.(\n            ({ text, name, type, placeholder, pattern, notRequired }) => {\n              if (currentType === 'list') {\n                return (\n                  <p>\n                    <label>\n                      <span>\n                        <Trans>List</Trans>\n                      </span>\n                      <select\n                        name=\"id\"\n                        required={!notRequired}\n                        disabled={disabled || uiState === 'loading'}\n                        defaultValue={editMode ? shortcut.id : undefined}\n                        dir=\"auto\"\n                      >\n                        <option value=\"\"></option>\n                        {lists.map((list) => (\n                          <option value={list.id}>{list.title}</option>\n                        ))}\n                      </select>\n                    </label>\n                  </p>\n                );\n              }\n\n              return (\n                <p>\n                  <label>\n                    <span>{_(text)}</span>{' '}\n                    <input\n                      type={type}\n                      switch={type === 'checkbox' || undefined}\n                      name={name}\n                      placeholder={_(placeholder)}\n                      required={type === 'text' && !notRequired}\n                      disabled={disabled}\n                      list={\n                        currentType === 'hashtag'\n                          ? 'followed-hashtags-datalist'\n                          : null\n                      }\n                      autocorrect=\"off\"\n                      autocapitalize=\"off\"\n                      spellCheck={false}\n                      pattern={pattern}\n                      dir=\"auto\"\n                    />\n                    {currentType === 'hashtag' &&\n                      followedHashtags.length > 0 && (\n                        <datalist id=\"followed-hashtags-datalist\">\n                          {followedHashtags.map((tag) => (\n                            <option value={tag.name} />\n                          ))}\n                        </datalist>\n                      )}\n                  </label>\n                </p>\n              );\n            },\n          )}\n          {!!FORM_NOTES[currentType] && (\n            <p class=\"form-note insignificant\">\n              <Icon icon=\"info\" />\n              {_(FORM_NOTES[currentType])}\n            </p>\n          )}\n          <footer>\n            <button\n              type=\"submit\"\n              class=\"block\"\n              disabled={disabled || uiState === 'loading'}\n            >\n              {editMode ? t`Save` : t`Add`}\n            </button>\n            {editMode && (\n              <button\n                type=\"button\"\n                class=\"light danger\"\n                onClick={() => {\n                  states.shortcuts.splice(shortcutIndex, 1);\n                  onClose?.();\n                }}\n              >\n                <Trans>Remove</Trans>\n              </button>\n            )}\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nfunction ImportExport({ shortcuts, onClose }) {\n  const { _ } = useLingui();\n  const { masto } = api();\n  const shortcutsStr = useMemo(() => {\n    if (!shortcuts) return '';\n    if (!shortcuts.filter(Boolean).length) return '';\n    return compressToEncodedURIComponent(\n      JSON.stringify(shortcuts.filter(Boolean)),\n    );\n  }, [shortcuts]);\n  const [importShortcutStr, setImportShortcutStr] = useState('');\n  const [importUIState, setImportUIState] = useState('default');\n  const parsedImportShortcutStr = useMemo(() => {\n    if (!importShortcutStr) {\n      setImportUIState('default');\n      return null;\n    }\n    try {\n      const parsed = JSON.parse(\n        decompressFromEncodedURIComponent(importShortcutStr),\n      );\n      // Very basic validation, I know\n      if (!Array.isArray(parsed)) throw new Error('Not an array');\n      setImportUIState('default');\n      console.log(' Parsed imported shortcuts', parsed);\n      return parsed;\n    } catch (err) {\n      // Fallback to JSON string parsing\n      // There's a chance that someone might want to import a JSON string instead of the compressed version\n      try {\n        const parsed = JSON.parse(importShortcutStr);\n        if (!Array.isArray(parsed)) throw new Error('Not an array');\n        setImportUIState('default');\n        return parsed;\n      } catch (err) {\n        setImportUIState('error');\n        return null;\n      }\n    }\n  }, [importShortcutStr]);\n  const hasCurrentSettings = states.shortcuts.length > 0;\n\n  const shortcutsImportFieldRef = useRef();\n\n  return (\n    <div id=\"import-export-container\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>\n            Import/Export <small class=\"ib insignificant\">Shortcuts</small>\n          </Trans>\n        </h2>\n      </header>\n      <main tabindex=\"-1\">\n        <section>\n          <h3>\n            <Icon icon=\"arrow-down-circle\" size=\"l\" class=\"insignificant\" />{' '}\n            <span>\n              <Trans>Import</Trans>\n            </span>\n          </h3>\n          <p class=\"field-button\">\n            <input\n              ref={shortcutsImportFieldRef}\n              type=\"text\"\n              name=\"import\"\n              placeholder={t`Paste shortcuts here`}\n              class=\"block\"\n              onInput={(e) => {\n                setImportShortcutStr(e.target.value);\n              }}\n              dir=\"auto\"\n            />\n            {mediaDevicesSupported && (\n              <button\n                type=\"button\"\n                class=\"plain2 small\"\n                onClick={() => {\n                  states.showQrScannerModal = {\n                    onClose: ({ text } = {}) => {\n                      if (text) {\n                        setImportShortcutStr(text);\n                        shortcutsImportFieldRef.current.value = text;\n                        shortcutsImportFieldRef.current.dispatchEvent(\n                          new Event('input'),\n                        );\n                      }\n                    },\n                  };\n                }}\n              >\n                <Icon icon=\"scan\" alt={t`Scan QR code`} />\n              </button>\n            )}\n            {states.settings.shortcutSettingsCloudImportExport && (\n              <button\n                type=\"button\"\n                class=\"plain2 small\"\n                disabled={importUIState === 'cloud-downloading'}\n                onClick={async () => {\n                  setImportUIState('cloud-downloading');\n                  const currentAccount = getCurrentAccountID();\n                  showToast(\n                    t`Downloading saved shortcuts from instance server`,\n                  );\n                  try {\n                    const relationships =\n                      await masto.v1.accounts.relationships.fetch({\n                        id: [currentAccount],\n                      });\n                    const relationship = relationships[0];\n                    if (relationship) {\n                      const { note = '' } = relationship;\n                      if (\n                        /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/.test(\n                          note,\n                        )\n                      ) {\n                        const settings = note.match(\n                          /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/,\n                        )[1];\n                        const { v, dt, data } = JSON.parse(settings);\n                        shortcutsImportFieldRef.current.value = data;\n                        shortcutsImportFieldRef.current.dispatchEvent(\n                          new Event('input'),\n                        );\n                      }\n                    }\n                    setImportUIState('default');\n                  } catch (e) {\n                    console.error(e);\n                    setImportUIState('error');\n                    showToast(t`Unable to download shortcuts`);\n                  }\n                }}\n                title={t`Download shortcuts from instance server`}\n              >\n                <Icon icon=\"cloud\" />\n                <Icon icon=\"arrow-down\" size=\"s\" />\n              </button>\n            )}\n          </p>\n          {!!parsedImportShortcutStr &&\n            Array.isArray(parsedImportShortcutStr) && (\n              <>\n                <p>\n                  <b>{parsedImportShortcutStr.length}</b> shortcut\n                  {parsedImportShortcutStr.length > 1 ? 's' : ''}{' '}\n                  <small class=\"insignificant\">\n                    ({importShortcutStr.length} characters)\n                  </small>\n                </p>\n                <ol class=\"import-settings-list\">\n                  {parsedImportShortcutStr.map((shortcut) => (\n                    <li>\n                      <span\n                        style={{\n                          opacity: shortcuts.some((s) =>\n                            // Compare all properties\n                            Object.keys(s).every((key) => {\n                              if (!(key in shortcut)) return true;\n                              const val = shortcut[key];\n                              if (\n                                val === '' ||\n                                val === null ||\n                                val === undefined\n                              ) {\n                                return true;\n                              }\n                              return s[key] === val;\n                            }),\n                          )\n                            ? 1\n                            : 0,\n                        }}\n                      >\n                        *\n                      </span>\n                      <span>\n                        {_(TYPE_TEXT[shortcut.type])}\n                        {shortcut.type === 'list' && !!shortcut.id && ' '}{' '}\n                        {TYPE_PARAMS[shortcut.type]?.map?.(\n                          ({ text, name, type }) =>\n                            shortcut[name] ? (\n                              <>\n                                <span class=\"tag collapsed insignificant\">\n                                  {_(text)}:{' '}\n                                  {type === 'checkbox'\n                                    ? shortcut[name] === 'on'\n                                      ? ''\n                                      : ''\n                                    : shortcut[name]}\n                                </span>{' '}\n                              </>\n                            ) : null,\n                        )}\n                      </span>\n                    </li>\n                  ))}\n                </ol>\n                <p>\n                  <small>\n                    <Trans>* Exists in current shortcuts</Trans>\n                  </small>\n                  <br />\n                  <small>\n                    {' '}\n                    <Trans>\n                      List may not work if it's from a different account.\n                    </Trans>\n                  </small>\n                </p>\n              </>\n            )}\n          {importUIState === 'error' && (\n            <p class=\"error\">\n              <small>\n                 <Trans>Invalid settings format</Trans>\n              </small>\n            </p>\n          )}\n          <p>\n            {hasCurrentSettings && (\n              <>\n                <MenuConfirm\n                  confirmLabel={t`Append to current shortcuts?`}\n                  menuFooter={\n                    <div class=\"footer\">\n                      <Trans>\n                        Only shortcuts that dont exist in current shortcuts\n                        will be appended.\n                      </Trans>\n                    </div>\n                  }\n                  onClick={() => {\n                    // states.shortcuts = [\n                    //   ...states.shortcuts,\n                    //   ...parsedImportShortcutStr,\n                    // ];\n                    // Append non-unique shortcuts only\n                    const nonUniqueShortcuts = parsedImportShortcutStr.filter(\n                      (shortcut) =>\n                        !states.shortcuts.some((s) =>\n                          // Compare all properties\n                          Object.keys(s).every(\n                            (key) => s[key] === shortcut[key],\n                          ),\n                        ),\n                    );\n                    if (!nonUniqueShortcuts.length) {\n                      showToast(t`No new shortcuts to import`);\n                      return;\n                    }\n                    let newShortcuts = [\n                      ...states.shortcuts,\n                      ...nonUniqueShortcuts,\n                    ];\n                    const exceededLimit = newShortcuts.length > SHORTCUTS_LIMIT;\n                    if (exceededLimit) {\n                      // If exceeded, trim it\n                      newShortcuts = newShortcuts.slice(0, SHORTCUTS_LIMIT);\n                    }\n                    states.shortcuts = newShortcuts;\n                    showToast(\n                      exceededLimit\n                        ? t`Shortcuts imported. Exceeded max ${SHORTCUTS_LIMIT}, so the rest are not imported.`\n                        : t`Shortcuts imported`,\n                    );\n                    onClose?.();\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"plain2\"\n                    disabled={!parsedImportShortcutStr}\n                  >\n                    <Trans>Import & append</Trans>\n                  </button>\n                </MenuConfirm>{' '}\n              </>\n            )}\n            <MenuConfirm\n              confirmLabel={\n                hasCurrentSettings\n                  ? t`Override current shortcuts?`\n                  : t`Import shortcuts?`\n              }\n              menuItemClassName={hasCurrentSettings ? 'danger' : undefined}\n              onClick={() => {\n                states.shortcuts = parsedImportShortcutStr;\n                showToast(t`Shortcuts imported`);\n                onClose?.();\n              }}\n            >\n              <button\n                type=\"button\"\n                class=\"plain2\"\n                disabled={!parsedImportShortcutStr}\n              >\n                {hasCurrentSettings ? t`or override` : t`Import`}\n              </button>\n            </MenuConfirm>\n          </p>\n        </section>\n        <section>\n          <h3>\n            <Icon icon=\"arrow-up-circle\" size=\"l\" class=\"insignificant\" />{' '}\n            <span>\n              <Trans>Export</Trans>\n            </span>\n          </h3>\n          <p class=\"field-button\">\n            <input\n              style={{ width: '100%' }}\n              type=\"text\"\n              value={shortcutsStr}\n              readOnly\n              onClick={(e) => {\n                if (!e.target.value) return;\n                e.target.select();\n                // Copy url to clipboard\n                try {\n                  navigator.clipboard.writeText(e.target.value);\n                  showToast(t`Shortcuts copied`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to copy shortcuts`);\n                }\n              }}\n              dir=\"auto\"\n            />\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              disabled={!shortcutsStr}\n              onClick={() => {\n                states.showQrCodeModal = {\n                  text: shortcutsStr,\n                };\n              }}\n            >\n              <Icon icon=\"qrcode\" alt={t`QR code`} />\n            </button>\n            {states.settings.shortcutSettingsCloudImportExport && (\n              <button\n                type=\"button\"\n                class=\"plain2 small\"\n                disabled={importUIState === 'cloud-uploading'}\n                onClick={async () => {\n                  setImportUIState('cloud-uploading');\n                  const currentAccount = getCurrentAccountID();\n                  try {\n                    const relationships =\n                      await masto.v1.accounts.relationships.fetch({\n                        id: [currentAccount],\n                      });\n                    const relationship = relationships[0];\n                    if (relationship) {\n                      const { note = '' } = relationship;\n                      // const newNote = `${note}\\n\\n\\n$<phanpy-shortcuts-settings>{shortcutsStr}</phanpy-shortcuts-settings>`;\n                      let newNote = '';\n                      const settingsJSON = JSON.stringify({\n                        v: '1', // version\n                        dt: Date.now(), // datetime stamp\n                        data: shortcutsStr, // shortcuts settings string\n                      });\n                      if (\n                        /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/.test(\n                          note,\n                        )\n                      ) {\n                        newNote = note.replace(\n                          /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/,\n                          `<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`,\n                        );\n                      } else {\n                        newNote = `${note}\\n\\n\\n<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;\n                      }\n                      showToast(t`Saving shortcuts to instance server`);\n                      await masto.v1.accounts\n                        .$select(currentAccount)\n                        .note.create({\n                          comment: newNote,\n                        });\n                      setImportUIState('default');\n                      showToast(t`Shortcuts saved`);\n                    }\n                  } catch (e) {\n                    console.error(e);\n                    setImportUIState('error');\n                    showToast(t`Unable to save shortcuts`);\n                  }\n                }}\n                title={t`Sync to instance server`}\n              >\n                <Icon icon=\"cloud\" />\n                <Icon icon=\"arrow-up\" size=\"s\" />\n              </button>\n            )}\n          </p>\n          <p>\n            <button\n              type=\"button\"\n              class=\"plain2\"\n              disabled={!shortcutsStr}\n              onClick={() => {\n                try {\n                  navigator.clipboard.writeText(shortcutsStr);\n                  showToast(t`Shortcut settings copied`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to copy shortcut settings`);\n                }\n              }}\n            >\n              <Icon icon=\"clipboard\" />{' '}\n              <span>\n                <Trans>Copy</Trans>\n              </span>\n            </button>{' '}\n            {navigator?.share &&\n              navigator?.canShare?.({\n                text: shortcutsStr,\n              }) && (\n                <button\n                  type=\"button\"\n                  class=\"plain2\"\n                  disabled={!shortcutsStr}\n                  onClick={() => {\n                    try {\n                      navigator.share({\n                        text: shortcutsStr,\n                      });\n                    } catch (e) {\n                      console.error(e);\n                      alert(t`Sharing doesn't seem to work.`);\n                    }\n                  }}\n                >\n                  <Icon icon=\"share\" />{' '}\n                  <span>\n                    <Trans>Share</Trans>\n                  </span>\n                </button>\n              )}{' '}\n            {shortcutsStr.length > 0 && (\n              <small class=\"insignificant ib\">\n                <Plural\n                  value={shortcutsStr.length}\n                  one=\"# character\"\n                  other=\"# characters\"\n                />\n              </small>\n            )}\n          </p>\n          {!!shortcutsStr && (\n            <details>\n              <summary class=\"insignificant\">\n                <small>\n                  <Trans>Raw Shortcuts JSON</Trans>\n                </small>\n              </summary>\n              <textarea style={{ width: '100%' }} rows={10} readOnly>\n                {JSON.stringify(shortcuts.filter(Boolean), null, 2)}\n              </textarea>\n            </details>\n          )}\n        </section>\n        {states.settings.shortcutSettingsCloudImportExport && (\n          <footer>\n            <p>\n              <Icon icon=\"cloud\" />{' '}\n              <Trans>\n                Import/export settings from/to instance server (Very\n                experimental)\n              </Trans>\n            </p>\n          </footer>\n        )}\n      </main>\n    </div>\n  );\n}\n\nexport default ShortcutsSettings;\n","import { useLingui } from '@lingui/react/macro';\nimport { useEffect } from 'preact/hooks';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { subscribe, useSnapshot } from 'valtio';\n\nimport Accounts from '../pages/accounts';\nimport Settings from '../pages/settings';\nimport focusDeck from '../utils/focus-deck';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\n\nimport AccountSheet from './account-sheet';\nimport ComposeSuspense, { preload } from './compose-suspense';\nimport Drafts from './drafts';\nimport EmbedModal from './embed-modal';\nimport GenericAccounts from './generic-accounts';\nimport ImportExportAccounts from './import-export-accounts';\nimport MediaAltModal from './media-alt-modal';\nimport MediaModal from './media-modal';\nimport Modal from './modal';\nimport OpenLinkSheet from './open-link-sheet';\nimport QrCodeModal from './qr-code-modal';\nimport QrScannerModal from './qr-scanner-modal';\nimport ReportModal from './report-modal';\nimport ShortcutsSettings from './shortcuts-settings';\n\nsubscribe(states, (changes) => {\n  for (const [action, path, value, prevValue] of changes) {\n    // When closing modal, focus on deck\n    if (/^show/i.test(path) && !value) {\n      focusDeck();\n    }\n  }\n});\n\nexport default function Modals() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  useEffect(() => {\n    setTimeout(preload, 1000);\n  }, []);\n\n  return (\n    <>\n      {!!snapStates.showCompose && (\n        <Modal\n          class={`solid ${snapStates.composerState.minimized ? 'min' : ''}`}\n          minimized={!!snapStates.composerState.minimized}\n        >\n          <ComposeSuspense\n            replyToStatus={\n              typeof snapStates.showCompose !== 'boolean'\n                ? snapStates.showCompose.replyToStatus\n                : window.__COMPOSE__?.replyToStatus || null\n            }\n            replyMode={\n              states.showCompose?.replyMode ||\n              window.__COMPOSE__?.replyMode ||\n              'all'\n            }\n            editStatus={\n              states.showCompose?.editStatus ||\n              window.__COMPOSE__?.editStatus ||\n              null\n            }\n            draftStatus={\n              states.showCompose?.draftStatus ||\n              window.__COMPOSE__?.draftStatus ||\n              null\n            }\n            quoteStatus={\n              states.showCompose?.quoteStatus ||\n              window.__COMPOSE__?.quoteStatus ||\n              null\n            }\n            onClose={(results) => {\n              const { newStatus, instance, type, scheduledAt } = results || {};\n              states.showCompose = false;\n              window.__COMPOSE__ = null;\n              if (newStatus) {\n                states.reloadStatusPage++;\n                if (scheduledAt) states.reloadScheduledPosts++;\n                showToast({\n                  text: {\n                    post: scheduledAt\n                      ? t`Post scheduled`\n                      : t`Post published. Check it out.`,\n                    reply: scheduledAt\n                      ? t`Reply scheduled`\n                      : t`Reply posted. Check it out.`,\n                    edit: t`Post updated. Check it out.`,\n                  }[type || 'post'],\n                  delay: 1000,\n                  duration: 10_000, // 10 seconds\n                  onClick: (toast) => {\n                    toast.hideToast();\n                    states.prevLocation = location;\n                    if (scheduledAt) {\n                      navigate('/sp');\n                    } else {\n                      navigate(\n                        instance\n                          ? `/${instance}/s/${newStatus.id}`\n                          : `/s/${newStatus.id}`,\n                      );\n                    }\n                  },\n                });\n              }\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showSettings && (\n        <Modal\n          onClose={() => {\n            states.showSettings = false;\n          }}\n        >\n          <Settings\n            onClose={() => {\n              states.showSettings = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showAccounts && (\n        <Modal\n          onClose={() => {\n            states.showAccounts = false;\n          }}\n        >\n          <Accounts\n            onClose={() => {\n              states.showAccounts = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showAccount && (\n        <Modal\n          onClose={() => {\n            states.showAccount = false;\n          }}\n        >\n          <AccountSheet\n            account={snapStates.showAccount?.account || snapStates.showAccount}\n            instance={snapStates.showAccount?.instance}\n            onClose={({ destination } = {}) => {\n              states.showAccount = false;\n              // states.showGenericAccounts = false;\n              // if (destination) {\n              //   states.showAccounts = false;\n              // }\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showOpenLink && (\n        <Modal\n          onClose={() => {\n            states.showOpenLink = false;\n          }}\n        >\n          <OpenLinkSheet\n            url={snapStates.showOpenLink.url}\n            linkText={snapStates.showOpenLink.linkText}\n            onClose={() => {\n              states.showOpenLink = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showDrafts && (\n        <Modal\n          onClose={() => {\n            states.showDrafts = false;\n          }}\n        >\n          <Drafts onClose={() => (states.showDrafts = false)} />\n        </Modal>\n      )}\n      {!!snapStates.showMediaModal && (\n        <Modal\n          onClick={(e) => {\n            if (\n              e.target === e.currentTarget ||\n              e.target.classList.contains('media')\n            ) {\n              states.showMediaModal = false;\n            }\n          }}\n        >\n          <MediaModal\n            mediaAttachments={snapStates.showMediaModal.mediaAttachments}\n            instance={snapStates.showMediaModal.instance}\n            index={snapStates.showMediaModal.mediaIndex}\n            statusID={snapStates.showMediaModal.statusID}\n            onClose={() => {\n              states.showMediaModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showShortcutsSettings && (\n        <Modal\n          onClose={() => {\n            states.showShortcutsSettings = false;\n          }}\n        >\n          <ShortcutsSettings\n            onClose={() => (states.showShortcutsSettings = false)}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showGenericAccounts && (\n        <Modal\n          onClose={() => {\n            states.showGenericAccounts = false;\n          }}\n        >\n          <GenericAccounts\n            instance={snapStates.showGenericAccounts.instance}\n            excludeRelationshipAttrs={\n              snapStates.showGenericAccounts.excludeRelationshipAttrs\n            }\n            postID={snapStates.showGenericAccounts.postID}\n            onClose={() => (states.showGenericAccounts = false)}\n            blankCopy={snapStates.showGenericAccounts.blankCopy}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showMediaAlt && (\n        <Modal\n          onClose={(e) => {\n            states.showMediaAlt = false;\n          }}\n        >\n          <MediaAltModal\n            alt={snapStates.showMediaAlt.alt || snapStates.showMediaAlt}\n            lang={snapStates.showMediaAlt?.lang}\n            onClose={() => {\n              states.showMediaAlt = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showEmbedModal && (\n        <Modal\n          class=\"solid\"\n          onClose={() => {\n            states.showEmbedModal = false;\n          }}\n        >\n          <EmbedModal\n            html={snapStates.showEmbedModal.html}\n            url={snapStates.showEmbedModal.url}\n            width={snapStates.showEmbedModal.width}\n            height={snapStates.showEmbedModal.height}\n            onClose={() => {\n              states.showEmbedModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showReportModal && (\n        <Modal\n          onClose={() => {\n            states.showReportModal = false;\n          }}\n        >\n          <ReportModal\n            account={snapStates.showReportModal.account}\n            post={snapStates.showReportModal.post}\n            onClose={() => {\n              states.showReportModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showQrCodeModal && (\n        <Modal\n          class=\"solid\"\n          onClose={() => {\n            states.showQrCodeModal = false;\n          }}\n        >\n          <QrCodeModal\n            text={snapStates.showQrCodeModal.text}\n            arena={snapStates.showQrCodeModal.arena}\n            backgroundMask={snapStates.showQrCodeModal.backgroundMask}\n            caption={snapStates.showQrCodeModal.caption}\n            onClose={() => {\n              states.showQrCodeModal = false;\n            }}\n            onScannerClick={snapStates.showQrCodeModal.onScannerClick}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showQrScannerModal && (\n        <Modal\n          class=\"solid\"\n          onClose={() => {\n            states.showQrScannerModal = false;\n          }}\n        >\n          <QrScannerModal\n            checkValidity={snapStates.showQrScannerModal.checkValidity}\n            actionableText={snapStates.showQrScannerModal.actionableText}\n            onClose={(...args) => {\n              if (snapStates.showQrScannerModal.onClose) {\n                snapStates.showQrScannerModal.onClose(...args);\n              }\n              states.showQrScannerModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showImportExportAccounts && (\n        <Modal\n          onClose={() => {\n            states.showImportExportAccounts = false;\n          }}\n        >\n          <ImportExportAccounts\n            onClose={() => {\n              states.showImportExportAccounts = false;\n            }}\n            exportDisabled={\n              typeof snapStates.showImportExportAccounts === 'object'\n                ? snapStates.showImportExportAccounts.exportDisabled\n                : false\n            }\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n","import { memo } from 'preact/compat';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useNavigate } from 'react-router-dom';\n\nexport default memo(function NavigationCommand() {\n  const navigate = useNavigate();\n\n  const hotkeyOptions = {\n    useKey: true,\n    ignoreEventWhen: (e) => {\n      const hasModal = !!document.querySelector('#modal-container > *');\n      return hasModal || e.metaKey || e.ctrlKey || e.altKey;\n    },\n  };\n\n  useHotkeys('g>h', () => navigate('/'), hotkeyOptions);\n  useHotkeys('g>n', () => navigate('/notifications'), hotkeyOptions);\n\n  return null;\n});\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nfunction FollowRequestButtons({ accountID, onChange }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [requestState, setRequestState] = useState(null); // accept, reject\n  const [relationship, setRelationship] = useState(null);\n\n  const hasRelationship = relationship !== null;\n\n  return (\n    <p class=\"follow-request-buttons\">\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRelationship}\n        onClick={() => {\n          setUIState('loading');\n          setRequestState('accept');\n          (async () => {\n            try {\n              const rel = await masto.v1.followRequests\n                .$select(accountID)\n                .authorize();\n              if (!rel?.followedBy) {\n                throw new Error('Follow request not accepted');\n              }\n              setRelationship(rel);\n              onChange();\n            } catch (e) {\n              console.error(e);\n            }\n            setUIState('default');\n          })();\n        }}\n      >\n        <Trans>Accept</Trans>\n      </button>{' '}\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRelationship}\n        class=\"light danger\"\n        onClick={() => {\n          setUIState('loading');\n          setRequestState('reject');\n          (async () => {\n            try {\n              const rel = await masto.v1.followRequests\n                .$select(accountID)\n                .reject();\n              if (rel?.followedBy) {\n                throw new Error('Follow request not rejected');\n              }\n              setRelationship(rel);\n              onChange();\n            } catch (e) {\n              console.error(e);\n              setUIState('default');\n            }\n          })();\n        }}\n      >\n        <Trans>Reject</Trans>\n      </button>\n      <span class=\"follow-request-states\">\n        {hasRelationship && requestState ? (\n          requestState === 'accept' ? (\n            <Icon\n              icon=\"check-circle\"\n              alt={t`Accepted`}\n              class=\"follow-accepted\"\n            />\n          ) : (\n            <Icon icon=\"x-circle\" alt={t`Rejected`} class=\"follow-rejected\" />\n          )\n        ) : (\n          <Loader hidden={uiState !== 'loading'} />\n        )}\n      </span>\n    </p>\n  );\n}\n\nexport default FollowRequestButtons;\n","import { msg, t } from '@lingui/core/macro';\nimport { Plural, Select, Trans, useLingui } from '@lingui/react/macro';\nimport { Fragment } from 'preact';\nimport { memo } from 'preact/compat';\n\nimport { api } from '../utils/api';\nimport { isFiltered } from '../utils/filters';\nimport shortenNumber from '../utils/shorten-number';\nimport states, { statusKey } from '../utils/states';\nimport { getCurrentAccountID } from '../utils/store-utils';\nimport useTruncated from '../utils/useTruncated';\n\nimport Avatar from './avatar';\nimport CustomEmoji from './custom-emoji';\nimport FollowRequestButtons from './follow-request-buttons';\nimport Icon from './icon';\nimport Link from './link';\nimport NameText from './name-text';\nimport Status from './status';\n\nconst NOTIFICATION_ICONS = {\n  mention: 'comment',\n  status: 'notification',\n  reblog: 'rocket',\n  follow: 'follow',\n  follow_request: 'follow-add',\n  favourite: 'heart',\n  poll: 'poll',\n  update: 'pencil',\n  'admin.signup': 'account-edit',\n  'admin.report': 'account-warning',\n  severed_relationships: 'heart-break',\n  moderation_warning: 'alert',\n  emoji_reaction: 'emoji2',\n  'pleroma:emoji_reaction': 'emoji2',\n  annual_report: 'celebrate',\n  quote: 'quote',\n  quoted_update: 'pencil',\n};\n\n/*\nNotification types\n==================\nmention = Someone mentioned you in their status\nstatus = Someone you enabled notifications for has posted a status\nreblog = Someone boosted one of your statuses\nfollow = Someone followed you\nfollow_request = Someone requested to follow you\nfavourite = Someone favourited one of your statuses\npoll = A poll you have voted in or created has ended\nupdate = A status you interacted with has been edited\nadmin.sign_up = Someone signed up (optionally sent to admins)\nadmin.report = A new report has been filed\nsevered_relationships = Severed relationships\nmoderation_warning = Moderation warning\nquote = Someone quoted one of your statuses\nquoted_update = A status you have quoted has been edited\n*/\n\nfunction emojiText({ account, emoji, emoji_url }) {\n  let url;\n  let staticUrl;\n  if (typeof emoji_url === 'string') {\n    url = emoji_url;\n  } else {\n    url = emoji_url?.url;\n    staticUrl = emoji_url?.staticUrl;\n  }\n  const emojiObject = url ? (\n    <CustomEmoji url={url} staticUrl={staticUrl} alt={emoji} />\n  ) : (\n    emoji\n  );\n  return (\n    <Trans>\n      {account} reacted to your post with {emojiObject}\n    </Trans>\n  );\n}\n\nconst contentText = {\n  status: ({ account }) => <Trans>{account} published a post.</Trans>,\n  reblog: ({\n    count,\n    account,\n    postsCount,\n    postType,\n    components: { Subject },\n  }) => (\n    <Plural\n      value={count}\n      _1={\n        <Plural\n          value={postsCount}\n          _1={\n            <Select\n              value={postType}\n              _reply={<Trans>{account} boosted your reply.</Trans>}\n              other={<Trans>{account} boosted your post.</Trans>}\n            />\n          }\n          other={\n            <Trans>\n              {account} boosted {postsCount} of your posts.\n            </Trans>\n          }\n        />\n      }\n      other={\n        <Select\n          value={postType}\n          _reply={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted your reply.\n            </Trans>\n          }\n          other={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted your post.\n            </Trans>\n          }\n        />\n      }\n    />\n  ),\n  follow: ({ account, count, components: { Subject } }) => (\n    <Plural\n      value={count}\n      _1={<Trans>{account} followed you.</Trans>}\n      other={\n        <Trans>\n          <Subject clickable={count > 1}>\n            <span title={count}>{shortenNumber(count)}</span> people\n          </Subject>{' '}\n          followed you.\n        </Trans>\n      }\n    />\n  ),\n  follow_request: ({ account }) => (\n    <Trans>{account} requested to follow you.</Trans>\n  ),\n  favourite: ({\n    account,\n    count,\n    postsCount,\n    postType,\n    components: { Subject },\n  }) => (\n    <Plural\n      value={count}\n      _1={\n        <Plural\n          value={postsCount}\n          _1={\n            <Select\n              value={postType}\n              _reply={<Trans>{account} liked your reply.</Trans>}\n              other={<Trans>{account} liked your post.</Trans>}\n            />\n          }\n          other={\n            <Trans>\n              {account} liked {postsCount} of your posts.\n            </Trans>\n          }\n        />\n      }\n      other={\n        <Select\n          value={postType}\n          _reply={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              liked your reply.\n            </Trans>\n          }\n          other={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              liked your post.\n            </Trans>\n          }\n        />\n      }\n    />\n  ),\n  poll: () => t`A poll you have voted in or created has ended.`,\n  'poll-self': () => t`A poll you have created has ended.`,\n  'poll-voted': () => t`A poll you have voted in has ended.`,\n  update: ({ account }) =>\n    account ? (\n      <Trans>{account} edited a post.</Trans>\n    ) : (\n      t`A post you interacted with has been edited.`\n    ),\n  'favourite+reblog': ({\n    count,\n    account,\n    postsCount,\n    postType,\n    components: { Subject },\n  }) => (\n    <Plural\n      value={count}\n      _1={\n        <Plural\n          value={postsCount}\n          _1={\n            <Select\n              value={postType}\n              _reply={<Trans>{account} boosted & liked your reply.</Trans>}\n              other={<Trans>{account} boosted & liked your post.</Trans>}\n            />\n          }\n          other={\n            <Trans>\n              {account} boosted & liked {postsCount} of your posts.\n            </Trans>\n          }\n        />\n      }\n      other={\n        <Select\n          value={postType}\n          _reply={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted & liked your reply.\n            </Trans>\n          }\n          other={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted & liked your post.\n            </Trans>\n          }\n        />\n      }\n    />\n  ),\n  quoted_update: ({ account }) => (\n    <Trans>{account} edited a post you have quoted.</Trans>\n  ),\n  'admin.sign_up': ({ account }) => <Trans>{account} signed up.</Trans>,\n  'admin.report': ({ account, targetAccount }) => (\n    <Trans>\n      {account} reported {targetAccount}\n    </Trans>\n  ),\n  severed_relationships: ({ name }) => (\n    <Trans>\n      Lost connections with <i>{name}</i>.\n    </Trans>\n  ),\n  moderation_warning: () => (\n    <b>\n      <Trans>Moderation warning</Trans>\n    </b>\n  ),\n  emoji_reaction: emojiText,\n  'pleroma:emoji_reaction': emojiText,\n  annual_report: ({ year }) => <Trans>Your {year} #Wrapstodon is here!</Trans>,\n};\n\n// account_suspension, domain_block, user_domain_block\nconst SEVERED_RELATIONSHIPS_TEXT = {\n  account_suspension: ({ from, targetName }) => (\n    <Trans>\n      An admin from <i>{from}</i> has suspended <i>{targetName}</i>, which means\n      you can no longer receive updates from them or interact with them.\n    </Trans>\n  ),\n  domain_block: ({ from, targetName, followersCount, followingCount }) => (\n    <Trans>\n      An admin from <i>{from}</i> has blocked <i>{targetName}</i>. Affected\n      followers: {followersCount}, followings: {followingCount}.\n    </Trans>\n  ),\n  user_domain_block: ({ targetName, followersCount, followingCount }) => (\n    <Trans>\n      You have blocked <i>{targetName}</i>. Removed followers: {followersCount},\n      followings: {followingCount}.\n    </Trans>\n  ),\n};\n\nconst MODERATION_WARNING_TEXT = {\n  none: msg`Your account has received a moderation warning.`,\n  disable: msg`Your account has been disabled.`,\n  mark_statuses_as_sensitive: msg`Some of your posts have been marked as sensitive.`,\n  delete_statuses: msg`Some of your posts have been deleted.`,\n  sensitive: msg`Your posts will be marked as sensitive from now on.`,\n  silence: msg`Your account has been limited.`,\n  suspend: msg`Your account has been suspended.`,\n};\n\nconst AVATARS_LIMIT = 30;\n\nfunction Notification({\n  notification,\n  instance,\n  isStatic,\n  disableContextMenu,\n}) {\n  const { _ } = useLingui();\n  const { masto } = api();\n  const {\n    id,\n    status,\n    account,\n    report,\n    event,\n    moderation_warning,\n    annualReport,\n    // Client-side grouped notification\n    _ids,\n    _accounts,\n    _statuses,\n    _groupKeys,\n    // Server-side grouped notification\n    sampleAccounts,\n    notificationsCount,\n    groupKey,\n    _notificationsCount,\n    _sampleAccountsCount,\n  } = notification;\n  let { type } = notification;\n\n  if ((type === 'mention' || type === 'quote') && !status) {\n    // Could be deleted\n    return null;\n  }\n\n  // status = Attached when type of the notification is favourite, reblog, status, mention, poll, or update\n  const actualStatus = status?.reblog || status;\n  const actualStatusID = actualStatus?.id;\n\n  const currentAccount = getCurrentAccountID();\n  const isSelf = currentAccount === account?.id;\n  const isVoted = status?.poll?.voted;\n  const isReplyToOthers =\n    !!status?.inReplyToAccountId &&\n    status?.inReplyToAccountId !== currentAccount &&\n    status?.account?.id === currentAccount;\n\n  let favsCount = 0;\n  let reblogsCount = 0;\n  if (type === 'favourite+reblog') {\n    if (_accounts) {\n      for (const account of _accounts) {\n        if (account._types?.includes('favourite')) {\n          favsCount++;\n        }\n        if (account._types?.includes('reblog')) {\n          reblogsCount++;\n        }\n      }\n    }\n    if (!reblogsCount && favsCount) type = 'favourite';\n    if (!favsCount && reblogsCount) type = 'reblog';\n  }\n\n  let text;\n  if (type === 'poll') {\n    text = contentText[isSelf ? 'poll-self' : isVoted ? 'poll-voted' : 'poll'];\n  } else if (contentText[type]) {\n    text = contentText[type];\n  } else {\n    // Anticipate unhandled notification types, possibly from Mastodon forks or non-Mastodon instances\n    // This surfaces the error to the user, hoping that users will report it\n    text = t`[Unknown notification type: ${type}]`;\n  }\n\n  const Subject = ({ clickable, ...props }) =>\n    clickable ? (\n      <b tabIndex=\"0\" onClick={handleOpenGenericAccounts} {...props} />\n    ) : (\n      <b {...props} />\n    );\n\n  const diffCount =\n    notificationsCount > 0 && notificationsCount > sampleAccounts?.length;\n  const expandAccounts = diffCount ? 'remote' : 'local';\n\n  if (typeof text === 'function') {\n    const count =\n      (type === 'favourite' || type === 'reblog') && notificationsCount\n        ? diffCount\n          ? notificationsCount\n          : sampleAccounts?.length\n        : _accounts?.length || sampleAccounts?.length || (account ? 1 : 0);\n    const postsCount = _statuses?.length || (status ? 1 : 0);\n    if (type === 'admin.report') {\n      const targetAccount = report?.targetAccount;\n      if (targetAccount) {\n        text = text({\n          account: <NameText account={account} showAvatar />,\n          targetAccount: <NameText account={targetAccount} showAvatar />,\n        });\n      }\n    } else if (type === 'severed_relationships') {\n      const targetName = event?.targetName;\n      if (targetName) {\n        text = text({ name: targetName });\n      }\n    } else if (\n      (type === 'emoji_reaction' || type === 'pleroma:emoji_reaction') &&\n      notification.emoji\n    ) {\n      const emojiURL =\n        notification.emoji_url || // This is string\n        status?.emojis?.find?.(\n          (emoji) =>\n            emoji?.shortcode ===\n            notification.emoji.replace(/^:/, '').replace(/:$/, ''),\n        ); // Emoji object instead of string\n      text = text({\n        account: <NameText account={account} showAvatar />,\n        emoji: notification.emoji,\n        emojiURL,\n      });\n    } else if (type === 'annual_report') {\n      text = text({\n        ...notification.annualReport,\n      });\n    } else {\n      text = text({\n        account: account ? (\n          <NameText account={account} showAvatar />\n        ) : (\n          sampleAccounts?.[0] && (\n            <NameText account={sampleAccounts[0]} showAvatar />\n          )\n        ),\n        count,\n        postsCount,\n        postType: isReplyToOthers ? 'reply' : 'post',\n        components: { Subject },\n      });\n    }\n  }\n\n  const formattedCreatedAt =\n    notification.createdAt && new Date(notification.createdAt).toLocaleString();\n\n  const genericAccountsHeading =\n    {\n      'favourite+reblog': t`Boosted/Liked by`,\n      favourite: t`Liked by`,\n      reblog: t`Boosted by`,\n      follow: t`Followed by`,\n    }[type] || t`Accounts`;\n  const handleOpenGenericAccounts = () => {\n    states.showGenericAccounts = {\n      heading: genericAccountsHeading,\n      accounts: _accounts,\n      showReactions: type === 'favourite+reblog',\n      excludeRelationshipAttrs: type === 'follow' ? ['followedBy'] : [],\n      postID: statusKey(actualStatusID, instance),\n    };\n  };\n\n  console.debug('RENDER Notification', notification.id);\n\n  // If there's a status and filter action is 'hide', then the notification is hidden\n  if (!!status?.filtered) {\n    const isOwnPost = status?.account?.id === currentAccount;\n    const filterInfo = isFiltered(status.filtered, 'notifications');\n    if (!isSelf && !isOwnPost && filterInfo?.action === 'hide') {\n      return null;\n    }\n  }\n\n  return (\n    <div\n      class={`notification notification-${type}`}\n      data-notification-id={_ids || id}\n      data-group-key={_groupKeys?.join(' ') || groupKey}\n      tabIndex=\"0\"\n    >\n      <div\n        class={`notification-type notification-${type}`}\n        title={formattedCreatedAt}\n      >\n        {type === 'favourite+reblog' ? (\n          <>\n            <Icon icon=\"rocket\" size=\"xl\" alt={type} class=\"reblog-icon\" />\n            <Icon icon=\"heart\" size=\"xl\" alt={type} class=\"favourite-icon\" />\n          </>\n        ) : (\n          <Icon\n            icon={NOTIFICATION_ICONS[type] || 'notification'}\n            size=\"xl\"\n            alt={type}\n          />\n        )}\n      </div>\n      <div class=\"notification-content\">\n        {/* {(type === 'favourite+reblog' ||\n          type === 'favourite' ||\n          type === 'reblog') && (\n          <>\n             {type} {expandAccounts}{' '}\n            <mark>\n              N{_notificationsCount?.join(',')} + A\n              {_sampleAccountsCount?.join(',')}\n            </mark>{' '}\n            {' '}\n            <mark>\n              N{notificationsCount} + A{sampleAccounts?.length}\n            </mark>\n          </>\n        )} */}\n        {type !== 'mention' && type !== 'quote' && (\n          <>\n            <p>{text}</p>\n            {type === 'follow_request' && (\n              <FollowRequestButtons accountID={account.id} />\n            )}\n            {type === 'severed_relationships' && (\n              <div>\n                {SEVERED_RELATIONSHIPS_TEXT[event.type]({\n                  from: instance,\n                  ...event,\n                })}\n                <br />\n                <a\n                  href={`https://${instance}/severed_relationships`}\n                  target=\"_blank\"\n                  rel=\"noopener\"\n                >\n                  <Trans>\n                    Learn more <Icon icon=\"external\" size=\"s\" />\n                  </Trans>\n                </a>\n                .\n              </div>\n            )}\n            {type === 'moderation_warning' && !!moderation_warning && (\n              <div>\n                {_(MODERATION_WARNING_TEXT[moderation_warning.action]())}\n                <br />\n                <a\n                  href={`/disputes/strikes/${moderation_warning.id}`}\n                  target=\"_blank\"\n                  rel=\"noopener\"\n                >\n                  <Trans>\n                    Learn more <Icon icon=\"external\" size=\"s\" />\n                  </Trans>\n                </a>\n              </div>\n            )}\n            {type === 'annual_report' && (\n              <div>\n                <Link to={`/annual_report/${annualReport?.year}`}>\n                  <Trans>View #Wrapstodon</Trans>\n                </Link>\n              </div>\n            )}\n          </>\n        )}\n        {_accounts?.length > 1 && (\n          <p class=\"avatars-stack\">\n            {_accounts.slice(0, AVATARS_LIMIT).map((account) => (\n              <Fragment key={account.id}>\n                <a\n                  key={account.id}\n                  href={account.url}\n                  rel=\"noopener\"\n                  class=\"account-avatar-stack\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.showAccount = account;\n                  }}\n                >\n                  <Avatar\n                    url={account.avatarStatic}\n                    size={\n                      _accounts.length <= 10\n                        ? 'xxl'\n                        : _accounts.length < 20\n                          ? 'xl'\n                          : 'l'\n                    }\n                    key={account.id}\n                    alt={`${account.displayName} @${account.acct}`}\n                    squircle={account?.bot}\n                  />\n                  {type === 'favourite+reblog' && (\n                    <div class=\"account-sub-icons\">\n                      {account._types.map((type) => (\n                        <Icon\n                          icon={NOTIFICATION_ICONS[type]}\n                          size=\"s\"\n                          class={`${type}-icon`}\n                        />\n                      ))}\n                    </div>\n                  )}\n                </a>{' '}\n              </Fragment>\n            ))}\n            {(type === 'favourite+reblog' ||\n              type === 'favourite' ||\n              type === 'reblog') &&\n            expandAccounts === 'remote' ? (\n              <button\n                type=\"button\"\n                class=\"small plain\"\n                data-group-keys={_groupKeys?.join(' ')}\n                onClick={() => {\n                  states.showGenericAccounts = {\n                    heading: genericAccountsHeading,\n                    accounts: _accounts,\n                    fetchAccounts: async () => {\n                      const keyAccounts = await Promise.allSettled(\n                        _groupKeys.map(async (gKey) => {\n                          const iterator = masto.v2.notifications\n                            .$select(gKey)\n                            .accounts.list()\n                            .values();\n                          return [gKey, (await iterator.next()).value];\n                        }),\n                      );\n                      const accounts = [];\n                      for (const keyAccount of keyAccounts) {\n                        const [key, _accounts] = keyAccount.value;\n                        const type = /^favourite/.test(key)\n                          ? 'favourite'\n                          : /^reblog/.test(key)\n                            ? 'reblog'\n                            : null;\n                        if (!type) continue;\n                        for (const account of _accounts) {\n                          const theAccount = accounts.find(\n                            (a) => a.id === account.id,\n                          );\n                          if (theAccount) {\n                            theAccount._types.push(type);\n                          } else {\n                            account._types = [type];\n                            accounts.push(account);\n                          }\n                        }\n                      }\n                      return {\n                        done: true,\n                        value: accounts,\n                      };\n                    },\n                    showReactions: type === 'favourite+reblog',\n                    postID: statusKey(actualStatusID, instance),\n                  };\n                }}\n              >\n                +\n                {(type === 'favourite' || type === 'reblog') &&\n                  notificationsCount - _accounts.length}\n                <Icon icon=\"chevron-down\" />\n              </button>\n            ) : (\n              <button\n                type=\"button\"\n                class=\"small plain\"\n                onClick={handleOpenGenericAccounts}\n              >\n                {_accounts.length > AVATARS_LIMIT &&\n                  `+${_accounts.length - AVATARS_LIMIT}`}\n                <Icon icon=\"chevron-down\" />\n              </button>\n            )}\n          </p>\n        )}\n        {!_accounts?.length && sampleAccounts?.length > 1 && (\n          <p class=\"avatars-stack\">\n            {sampleAccounts.map((account) => (\n              <Fragment key={account.id}>\n                <a\n                  key={account.id}\n                  href={account.url}\n                  rel=\"noopener\"\n                  class=\"account-avatar-stack\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.showAccount = account;\n                  }}\n                >\n                  <Avatar\n                    url={account.avatarStatic}\n                    size=\"xxl\"\n                    key={account.id}\n                    alt={`${account.displayName} @${account.acct}`}\n                    squircle={account?.bot}\n                  />\n                  {/* {type === 'favourite+reblog' && (\n                    <div class=\"account-sub-icons\">\n                      {account._types.map((type) => (\n                        <Icon\n                          icon={NOTIFICATION_ICONS[type]}\n                          size=\"s\"\n                          class={`${type}-icon`}\n                        />\n                      ))}\n                    </div>\n                  )} */}\n                </a>{' '}\n              </Fragment>\n            ))}\n            {notificationsCount > sampleAccounts.length && (\n              <Link\n                to={\n                  instance ? `/${instance}/s/${status.id}` : `/s/${status.id}`\n                }\n                class=\"button small plain centered\"\n              >\n                +{notificationsCount - sampleAccounts.length}\n                <Icon icon=\"chevron-right\" />\n              </Link>\n            )}\n          </p>\n        )}\n        {_statuses?.length > 1 && (\n          <ul class=\"notification-group-statuses\">\n            {_statuses.map((status) => (\n              <li key={status.id}>\n                <TruncatedLink\n                  class={`status-link status-type-${type}`}\n                  to={\n                    instance ? `/${instance}/s/${status.id}` : `/s/${status.id}`\n                  }\n                >\n                  <Status\n                    status={status}\n                    size=\"s\"\n                    previewMode\n                    allowContextMenu\n                    allowFilters\n                  />\n                </TruncatedLink>\n              </li>\n            ))}\n          </ul>\n        )}\n        {status && (!_statuses?.length || _statuses?.length <= 1) && (\n          <TruncatedLink\n            class={`status-link status-type-${type}`}\n            to={\n              instance\n                ? `/${instance}/s/${actualStatusID}`\n                : `/s/${actualStatusID}`\n            }\n            onContextMenu={\n              !disableContextMenu\n                ? (e) => {\n                    const post = e.target.querySelector('.status');\n                    if (post) {\n                      // Fire a custom event to open the context menu\n                      if (e.metaKey) return;\n                      e.preventDefault();\n                      post.dispatchEvent(\n                        new MouseEvent('contextmenu', {\n                          clientX: e.clientX,\n                          clientY: e.clientY,\n                        }),\n                      );\n                    }\n                  }\n                : undefined\n            }\n          >\n            {isStatic ? (\n              <Status\n                status={actualStatus}\n                size=\"s\"\n                readOnly\n                allowContextMenu\n                allowFilters\n              />\n            ) : (\n              <Status\n                statusID={actualStatusID}\n                size=\"s\"\n                readOnly\n                allowContextMenu\n                allowFilters\n              />\n            )}\n          </TruncatedLink>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction TruncatedLink(props) {\n  const ref = useTruncated();\n  return <Link {...props} data-read-more={t`Read more `} ref={ref} />;\n}\n\nexport default memo(Notification, (oldProps, newProps) => {\n  return oldProps.notification?.id === newProps.notification?.id;\n});\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useLayoutEffect, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport states from '../utils/states';\nimport {\n  getAccountByAccessToken,\n  getCurrentAccount,\n} from '../utils/store-utils';\nimport usePageVisibility from '../utils/usePageVisibility';\n\nimport Icon from './icon';\nimport Link from './link';\nimport Modal from './modal';\nimport Notification from './notification';\n\n{\n  if ('serviceWorker' in navigator) {\n    console.log(' Listen to message');\n    navigator.serviceWorker.addEventListener('message', (event) => {\n      console.log(' Message event', event);\n      const { type, id, accessToken } = event?.data || {};\n      if (type === 'notification') {\n        states.routeNotification = {\n          id,\n          accessToken,\n        };\n      }\n    });\n  }\n}\n\nexport default memo(function NotificationService() {\n  const { t } = useLingui();\n  if (!('serviceWorker' in navigator)) return null;\n\n  const snapStates = useSnapshot(states);\n  const { routeNotification } = snapStates;\n\n  console.log(' Notification service', routeNotification);\n\n  const { id, accessToken } = routeNotification || {};\n  const [showNotificationSheet, setShowNotificationSheet] = useState(false);\n\n  useLayoutEffect(() => {\n    if (!id || !accessToken) return;\n    const { instance: currentInstance } = api();\n    const { masto, instance } = api({\n      accessToken,\n    });\n    console.log('API', { accessToken, currentInstance, instance });\n    const sameInstance = currentInstance === instance;\n    const account = accessToken\n      ? getAccountByAccessToken(accessToken)\n      : getCurrentAccount();\n    (async () => {\n      const notification = await masto.v1.notifications.$select(id).fetch();\n      if (notification && account) {\n        console.log(' Notification', { id, notification, account });\n        const accountInstance = account.instanceURL;\n        const { type, status, account: notificationAccount } = notification;\n        const hasModal = !!document.querySelector('#modal-container > *');\n        const isFollow = type === 'follow' && !!notificationAccount?.id;\n        const hasAccount = !!notificationAccount?.id;\n        const hasStatus = !!status?.id;\n        if (isFollow && sameInstance) {\n          // Show account sheet, can handle different instances\n          states.showAccount = {\n            account: notificationAccount,\n            instance: accountInstance,\n          };\n        } else if (hasModal || !sameInstance || (hasAccount && hasStatus)) {\n          // Show sheet of notification, if\n          // - there is a modal open\n          // - the notification is from another instance\n          // - the notification has both account and status, gives choice for users to go to account or status\n          setShowNotificationSheet({\n            id,\n            account,\n            notification,\n            sameInstance,\n          });\n        } else {\n          if (hasStatus) {\n            // Go to status page\n            location.hash = `/${currentInstance}/s/${status.id}`;\n          } else if (isFollow) {\n            // Go to profile page\n            location.hash = `/${currentInstance}/a/${notificationAccount.id}`;\n          } else {\n            // Go to notifications page\n            location.hash = '/notifications';\n          }\n        }\n      } else {\n        console.warn(' Notification not found', id);\n      }\n    })();\n  }, [id, accessToken]);\n\n  // useLayoutEffect(() => {\n  //   // Listen to message from service worker\n  //   const handleMessage = (event) => {\n  //     console.log(' Message event', event);\n  //     const { type, id, accessToken } = event?.data || {};\n  //     if (type === 'notification') {\n  //       states.routeNotification = {\n  //         id,\n  //         accessToken,\n  //       };\n  //     }\n  //   };\n  //   console.log(' Listen to message');\n  //   navigator.serviceWorker.addEventListener('message', handleMessage);\n  //   return () => {\n  //     console.log(' Remove listen to message');\n  //     navigator.serviceWorker.removeEventListener('message', handleMessage);\n  //   };\n  // }, []);\n\n  useLayoutEffect(() => {\n    if (navigator?.clearAppBadge) {\n      navigator.clearAppBadge();\n    }\n  }, []);\n  usePageVisibility((visible) => {\n    if (visible && navigator?.clearAppBadge) {\n      console.log(' Clear app badge');\n      navigator.clearAppBadge();\n    }\n  });\n\n  const onClose = () => {\n    setShowNotificationSheet(false);\n    states.routeNotification = null;\n\n    // If url is #/notifications?id=123, go to #/notifications\n    if (/\\/notifications\\?id=/i.test(location.hash)) {\n      location.hash = '/notifications';\n    }\n  };\n\n  if (showNotificationSheet) {\n    const { id, account, notification, sameInstance } = showNotificationSheet;\n    return (\n      <Modal\n        onClick={(e) => {\n          if (e.target === e.currentTarget) {\n            onClose();\n          }\n        }}\n      >\n        <div class=\"sheet\" tabIndex=\"-1\">\n          <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n          <header>\n            <b>\n              <Trans>Notification</Trans>\n            </b>\n          </header>\n          <main>\n            {!sameInstance && (\n              <p>\n                <Trans>This notification is from your other account.</Trans>\n              </p>\n            )}\n            <div\n              class=\"notification-peek\"\n              // style={{\n              //   pointerEvents: sameInstance ? '' : 'none',\n              // }}\n              onClick={(e) => {\n                const { target } = e;\n                // If button or links\n                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A') {\n                  onClose();\n                }\n              }}\n            >\n              <Notification\n                instance={account.instanceURL}\n                notification={notification}\n                isStatic\n              />\n            </div>\n            <div\n              style={{\n                textAlign: 'end',\n              }}\n            >\n              <Link to=\"/notifications\" class=\"button light\" onClick={onClose}>\n                <span>\n                  <Trans>View all notifications</Trans>\n                </span>{' '}\n                <Icon icon=\"arrow-right\" />\n              </Link>\n            </div>\n          </main>\n        </div>\n      </Modal>\n    );\n  }\n\n  return null;\n});\n","import store from './store';\n\nexport const getSearchHistory = ({ limit } = {}) => {\n  const history = store.account.get('searchHistory') || [];\n  return limit ? history.slice(0, limit) : history;\n};\n\nconst MAX_HISTORY_LENGTH = 10;\nexport const addToSearchHistory = (query, queryType = null) => {\n  if (!query?.trim?.()) return;\n\n  const history = getSearchHistory();\n  const existingIndex = history.findIndex(\n    (item) => item.query === query && item.queryType === queryType,\n  );\n\n  // LRU\n  // Remove existing entry if found\n  if (existingIndex !== -1) {\n    history.splice(existingIndex, 1);\n  }\n  // Add to beginning (most recent)\n  history.unshift({\n    query: query.trim(),\n    queryType,\n    timestamp: Date.now(),\n  });\n  const limitedHistory = history.slice(0, MAX_HISTORY_LENGTH);\n\n  store.account.set('searchHistory', limitedHistory);\n};\n\nexport const removeFromSearchHistory = (query, queryType = null) => {\n  const history = getSearchHistory();\n  const filteredHistory = history.filter(\n    (item) => !(item.query === query && item.queryType === queryType),\n  );\n  store.account.set('searchHistory', filteredHistory);\n};\n\nexport const clearAllSearchHistory = () => {\n  store.account.set('searchHistory', []);\n};\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { forwardRef } from 'preact/compat';\nimport { useImperativeHandle, useMemo, useRef, useState } from 'preact/hooks';\nimport { useSearchParams } from 'react-router-dom';\n\nimport { api } from '../utils/api';\nimport { addToSearchHistory, getSearchHistory } from '../utils/search-history';\n\nimport Icon from './icon';\nimport Link from './link';\n\n// Helper function to generate search item data (label and URL)\nexport const generateSearchItemData = (query, queryType, instance) => {\n  let label, to, icon;\n\n  if (queryType === 'statuses') {\n    label = (\n      <Trans>\n        Posts with <q>{query}</q>\n      </Trans>\n    );\n    to = `/search?q=${encodeURIComponent(query)}&type=statuses`;\n    icon = 'document';\n  } else if (queryType === 'accounts') {\n    label = (\n      <Trans>\n        Accounts with <q>{query}</q>\n      </Trans>\n    );\n    to = `/search?q=${encodeURIComponent(query)}&type=accounts`;\n    icon = 'group';\n  } else if (queryType === 'hashtags') {\n    const [, hashSymbol = '#', hashtagText = query] =\n      query.match(/^([#])?(.*)$/);\n    const hashtag = `${hashSymbol}${hashtagText}`;\n    label = (\n      <Trans>\n        Posts tagged with <mark>{hashtag}</mark>\n      </Trans>\n    );\n    to = `/${instance}/t/${hashtagText}`;\n    icon = 'hashtag';\n  } else {\n    // Default/general search\n    label = (\n      <Trans>\n        {query}{' '}\n        <small class=\"insignificant\"> accounts, hashtags &amp; posts</small>\n      </Trans>\n    );\n    to = `/search?q=${encodeURIComponent(query)}`;\n    icon = 'search';\n  }\n\n  return { label, to, icon };\n};\n\nconst SearchForm = forwardRef((props, ref) => {\n  const { t } = useLingui();\n  const { instance } = api();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const [searchMenuOpen, setSearchMenuOpen] = useState(false);\n  const [query, setQuery] = useState(searchParams.get('q') || '');\n  const type = searchParams.get('type');\n  const formRef = useRef(null);\n\n  const searchFieldRef = useRef(null);\n  useImperativeHandle(ref, () => ({\n    setValue: (value) => {\n      setQuery(value);\n    },\n    focus: () => {\n      searchFieldRef.current.focus();\n    },\n    select: () => {\n      searchFieldRef.current.select();\n    },\n    blur: () => {\n      searchFieldRef.current.blur();\n    },\n  }));\n\n  const searchHistory = useMemo(\n    () => getSearchHistory({ limit: 5 }),\n    [props?.hidden],\n  );\n\n  const searchSuggestionsData = useMemo(() => {\n    if (!query) return [];\n\n    const matchingHistory = searchHistory\n      .filter((historyItem) => {\n        // Filter out exact matches with current query\n        if (historyItem.query === query) return false;\n        // Check if history item contains the current query (case insensitive)\n        return historyItem.query.toLowerCase().includes(query.toLowerCase());\n      })\n      .slice(0, 2); // Max 2 recent searches\n\n    const recentSearchItems = matchingHistory.map((historyItem) => ({\n      ...generateSearchItemData(\n        historyItem.query,\n        historyItem.queryType,\n        instance,\n      ),\n      queryType: historyItem.queryType,\n      isRecentSearch: true,\n      historyItem,\n    }));\n\n    const allItems = [\n      // General search\n      {\n        ...generateSearchItemData(query, null, instance),\n        top: !type && !/\\s/.test(query),\n        hidden: !!type,\n      },\n      // Recent searches\n      ...recentSearchItems,\n      // Posts search\n      {\n        ...generateSearchItemData(query, 'statuses', instance),\n        hidden: /^https?:/.test(query),\n        top: /\\s/.test(query),\n        queryType: 'statuses',\n      },\n      // Hashtag search\n      {\n        ...generateSearchItemData(query, 'hashtags', instance),\n        hidden:\n          /^[@]/.test(query) || /^https?:/.test(query) || /\\s/.test(query),\n        top: /^[#]/.test(query),\n        type: 'link',\n        queryType: 'hashtags',\n      },\n      // URL lookup (unique case)\n      {\n        label: (\n          <Trans>\n            Look up <mark>{query}</mark>\n          </Trans>\n        ),\n        to: `/${query}`,\n        hidden: !/^https?:/.test(query),\n        top: /^https?:/.test(query),\n        type: 'link',\n        icon: 'arrow-right',\n      },\n      // Accounts search\n      {\n        ...generateSearchItemData(query, 'accounts', instance),\n        queryType: 'accounts',\n      },\n    ];\n\n    return allItems\n      .sort((a, b) => {\n        if (type) {\n          if (a.queryType === type) return -1;\n          if (b.queryType === type) return 1;\n        }\n        if (a.top && !b.top) return -1;\n        if (!a.top && b.top) return 1;\n        return 0;\n      })\n      .filter(({ hidden }) => !hidden);\n  }, [query, type, instance]);\n\n  return (\n    <form\n      ref={formRef}\n      class=\"search-popover-container\"\n      onSubmit={(e) => {\n        e.preventDefault();\n\n        const isSearchPage = /\\/search/.test(location.hash);\n        if (isSearchPage) {\n          if (query) {\n            const params = {\n              q: query,\n            };\n            if (type) params.type = type; // Preserve type\n            setSearchParams(params);\n          } else {\n            setSearchParams({});\n          }\n        } else {\n          if (query) {\n            location.hash = `/search?q=${encodeURIComponent(query)}${\n              type ? `&type=${type}` : ''\n            }`;\n          } else {\n            location.hash = `/search`;\n          }\n        }\n\n        addToSearchHistory(query, type);\n\n        props?.onSubmit?.(e);\n      }}\n    >\n      <input\n        ref={searchFieldRef}\n        value={query}\n        name=\"q\"\n        type=\"search\"\n        // autofocus\n        placeholder={t`Search`}\n        dir=\"auto\"\n        autocomplete=\"off\"\n        autocorrect=\"off\"\n        autocapitalize=\"off\"\n        spellCheck=\"false\"\n        enterKeyHint=\"search\"\n        onSearch={(e) => {\n          if (!e.target.value) {\n            setSearchParams({});\n          }\n        }}\n        onInput={(e) => {\n          setQuery(e.target.value);\n          setSearchMenuOpen(true);\n        }}\n        onFocus={() => {\n          setSearchMenuOpen(true);\n          // Focus first item\n          const firstItem = formRef.current?.querySelector(\n            '.search-popover-item',\n          );\n          if (firstItem) {\n            firstItem.classList.add('focus');\n          }\n        }}\n        onBlur={() => {\n          setTimeout(() => {\n            setSearchMenuOpen(false);\n          }, 100);\n          formRef.current\n            ?.querySelector('.search-popover-item.focus')\n            ?.classList.remove('focus');\n        }}\n        onKeyDown={(e) => {\n          const { key } = e;\n          switch (key) {\n            case 'Escape':\n              setSearchMenuOpen(false);\n              break;\n            case 'Down':\n            case 'ArrowDown':\n              e.preventDefault();\n              if (searchMenuOpen) {\n                const focusItem = formRef.current.querySelector(\n                  '.search-popover-item.focus',\n                );\n                if (focusItem) {\n                  let nextItem = focusItem.nextElementSibling;\n                  while (nextItem && nextItem.hidden) {\n                    nextItem = nextItem.nextElementSibling;\n                  }\n                  if (nextItem) {\n                    nextItem.classList.add('focus');\n                    const siblings = Array.from(\n                      nextItem.parentElement.children,\n                    ).filter((el) => el !== nextItem);\n                    siblings.forEach((el) => {\n                      el.classList.remove('focus');\n                    });\n                  }\n                } else {\n                  const firstItem = formRef.current.querySelector(\n                    '.search-popover-item',\n                  );\n                  if (firstItem) {\n                    firstItem.classList.add('focus');\n                  }\n                }\n              }\n              break;\n            case 'Up':\n            case 'ArrowUp':\n              e.preventDefault();\n              if (searchMenuOpen) {\n                const focusItem = document.querySelector(\n                  '.search-popover-item.focus',\n                );\n                if (focusItem) {\n                  let prevItem = focusItem.previousElementSibling;\n                  while (prevItem && prevItem.hidden) {\n                    prevItem = prevItem.previousElementSibling;\n                  }\n                  if (prevItem) {\n                    prevItem.classList.add('focus');\n                    const siblings = Array.from(\n                      prevItem.parentElement.children,\n                    ).filter((el) => el !== prevItem);\n                    siblings.forEach((el) => {\n                      el.classList.remove('focus');\n                    });\n                  }\n                } else {\n                  const items = document.querySelectorAll(\n                    '.search-popover-item',\n                  );\n                  const lastItem = items[items.length - 1];\n                  if (lastItem) {\n                    lastItem.classList.add('focus');\n                  }\n                }\n              }\n              break;\n            case 'Enter':\n              if (searchMenuOpen) {\n                const focusItem = document.querySelector(\n                  '.search-popover-item.focus',\n                );\n                if (focusItem) {\n                  e.preventDefault();\n                  focusItem.click();\n                }\n                setSearchMenuOpen(false);\n                props?.onSubmit?.(e);\n              }\n              break;\n          }\n        }}\n      />\n      <div class=\"search-popover\" hidden={!searchMenuOpen}>\n        {/* Search History - show when no query */}\n        {!query && searchHistory.length > 0 && (\n          <div class=\"search-popover-recent-searches\">\n            <div class=\"search-popover-header\">\n              <Icon icon=\"history\" size=\"s\" />\n              <Trans>Recent searches</Trans>\n            </div>\n            {searchHistory.map((historyItem, i) => {\n              const { label, to, icon } = generateSearchItemData(\n                historyItem.query,\n                historyItem.queryType,\n                instance,\n              );\n\n              return (\n                <Link\n                  key={`${historyItem.query}-${historyItem.queryType}-${historyItem.timestamp}`}\n                  to={to}\n                  class={`search-popover-item ${i === 0 ? 'focus' : ''}`}\n                  onClick={(e) => {\n                    addToSearchHistory(\n                      historyItem.query,\n                      historyItem.queryType,\n                    );\n                    props?.onSubmit?.(e);\n                  }}\n                >\n                  <Icon icon={icon} class=\"more-insignificant\" />\n                  <span>{label}</span>\n                </Link>\n              );\n            })}\n            <Link\n              to=\"/search\"\n              class=\"search-popover-item search-history-see-all\"\n            >\n              <Icon icon=\"more2\" class=\"more-insignificant\" />\n              <span>\n                <Trans>See all</Trans>\n              </span>\n            </Link>\n          </div>\n        )}\n\n        {/* Search Suggestions - show when there's a query */}\n        {searchSuggestionsData.map(\n          ({ label, to, icon, queryType, isRecentSearch, historyItem }, i) => (\n            <Link\n              key={\n                isRecentSearch\n                  ? `recent-${historyItem.query}-${historyItem.queryType}-${historyItem.timestamp}`\n                  : `suggestion-${queryType || 'general'}-${i}`\n              }\n              to={to}\n              class={`search-popover-item ${isRecentSearch ? 'search-popover-item-recent' : ''} ${i === 0 ? 'focus' : ''}`}\n              onClick={(e) => {\n                if (!isRecentSearch) {\n                  addToSearchHistory(query, queryType);\n                }\n                props?.onSubmit?.(e);\n              }}\n            >\n              <Icon icon={icon} class=\"more-insignificant\" />\n              <span>{label}</span>\n            </Link>\n          ),\n        )}\n      </div>\n    </form>\n  );\n});\n\nexport default SearchForm;\n","import './search-command.css';\n\nimport { memo } from 'preact/compat';\nimport { useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\nimport SearchForm from './search-form';\n\nexport default memo(function SearchCommand({ onClose = () => {} }) {\n  const [showSearch, setShowSearch] = useState(false);\n  const searchFormRef = useRef(null);\n\n  useHotkeys(\n    ['Slash', '/'],\n    (e) => {\n      setShowSearch(true);\n      setTimeout(() => {\n        searchFormRef.current?.focus?.();\n        searchFormRef.current?.select?.();\n      }, 0);\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => {\n        const isSearchPage = /\\/search/.test(location.hash);\n        const hasModal = !!document.querySelector('#modal-container > *');\n        return (\n          isSearchPage ||\n          hasModal ||\n          e.metaKey ||\n          e.ctrlKey ||\n          e.altKey ||\n          e.shiftKey\n        );\n      },\n    },\n  );\n\n  const closeSearch = () => {\n    setShowSearch(false);\n    onClose();\n  };\n\n  useHotkeys(\n    'esc',\n    (e) => {\n      searchFormRef.current?.blur?.();\n      closeSearch();\n    },\n    {\n      enabled: showSearch,\n      enableOnFormTags: true,\n      preventDefault: true,\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const hidden = !showSearch;\n\n  return (\n    <div\n      id=\"search-command-container\"\n      hidden={hidden}\n      onClick={(e) => {\n        console.log(e);\n        if (e.target === e.currentTarget) {\n          closeSearch();\n        }\n      }}\n    >\n      <SearchForm\n        ref={searchFormRef}\n        hidden={hidden}\n        onSubmit={() => {\n          closeSearch();\n        }}\n      />\n    </div>\n  );\n});\n","import './shortcuts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider } from '@szhsin/react-menu';\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useNavigate } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport { SHORTCUTS_META } from '../components/shortcuts-settings';\nimport { api } from '../utils/api';\nimport { getLists } from '../utils/lists';\nimport states from '../utils/states';\n\nimport AsyncText from './AsyncText';\nimport Icon from './icon';\nimport Link from './link';\nimport ListExclusiveBadge from './list-exclusive-badge';\nimport MenuLink from './menu-link';\nimport Menu2 from './menu2';\nimport SubMenu2 from './submenu2';\n\nfunction Shortcuts() {\n  const { t, _ } = useLingui();\n  const { instance } = api();\n  const snapStates = useSnapshot(states);\n  const { shortcuts, settings } = snapStates;\n\n  if (!shortcuts.length) {\n    return null;\n  }\n  const isMultiColumnMode =\n    settings.shortcutsViewMode === 'multi-column' ||\n    (!settings.shortcutsViewMode && settings.shortcutsColumnsMode);\n\n  const menuRef = useRef();\n  const tabBarRef = useRef();\n\n  const hasLists = useRef(false);\n  const formattedShortcuts = shortcuts\n    .map((pin, i) => {\n      const { type, ...data } = pin;\n      if (!SHORTCUTS_META[type]) return null;\n      let { id, path, title, subtitle, icon } = SHORTCUTS_META[type];\n\n      if (typeof id === 'function') {\n        id = id(data, i);\n      }\n      if (typeof path === 'function') {\n        path = path(\n          {\n            ...data,\n            instance: data.instance || instance,\n          },\n          i,\n        );\n      }\n      if (typeof title === 'function') {\n        title = title(data, i);\n      } else if (title?.id) {\n        // Check if it's MessageDescriptor\n        title = _(title);\n      }\n      if (typeof subtitle === 'function') {\n        subtitle = subtitle(data, i);\n      } else if (subtitle?.id) {\n        // Check if it's MessageDescriptor\n        subtitle = _(subtitle);\n      }\n      if (typeof icon === 'function') {\n        icon = icon(data, i);\n      }\n\n      if (id === 'lists') {\n        hasLists.current = true;\n      }\n\n      return {\n        id,\n        path,\n        title,\n        subtitle,\n        icon,\n      };\n    })\n    .filter(Boolean);\n\n  // Auto-scroll to active tab on first render\n  useEffect(() => {\n    if (\n      snapStates.settings.shortcutsViewMode === 'tab-menu-bar' &&\n      tabBarRef.current\n    ) {\n      const timeoutId = setTimeout(() => {\n        const activeTab = tabBarRef.current?.querySelector('.is-active');\n        if (activeTab) {\n          activeTab.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n            inline: 'center',\n          });\n        }\n      }, 100);\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, []);\n\n  const navigate = useNavigate();\n  useHotkeys(\n    ['1', '2', '3', '4', '5', '6', '7', '8', '9'],\n    (e) => {\n      const index = parseInt(e.key, 10) - 1;\n      if (index < formattedShortcuts.length) {\n        const { path } = formattedShortcuts[index];\n        if (path) {\n          navigate(path);\n          menuRef.current?.closeMenu?.();\n        }\n      }\n    },\n    {\n      enabled: !isMultiColumnMode,\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const [lists, setLists] = useState([]);\n\n  if (isMultiColumnMode) {\n    return null;\n  }\n\n  return (\n    <div id=\"shortcuts\">\n      {snapStates.settings.shortcutsViewMode === 'tab-menu-bar' ? (\n        <nav\n          ref={tabBarRef}\n          class=\"tab-bar\"\n          onContextMenu={(e) => {\n            e.preventDefault();\n            states.showShortcutsSettings = true;\n          }}\n        >\n          <ul>\n            {formattedShortcuts.map(\n              ({ id, path, title, subtitle, icon }, i) => {\n                return (\n                  <li key={`${i}-${id}-${title}-${subtitle}-${path}`}>\n                    <Link\n                      class={subtitle ? 'has-subtitle' : ''}\n                      to={path}\n                      onClick={(e) => {\n                        if (e.target.classList.contains('is-active')) {\n                          e.preventDefault();\n                          const page = document.getElementById(`${id}-page`);\n                          console.log(id, page);\n                          if (page) {\n                            page.scrollTop = 0;\n                            const updatesButton =\n                              page.querySelector('.updates-button');\n                            if (updatesButton) {\n                              updatesButton.click();\n                            }\n                          }\n                        }\n                      }}\n                    >\n                      <Icon icon={icon} size=\"xl\" />\n                      <span>\n                        <AsyncText>{title}</AsyncText>\n                        {subtitle && (\n                          <>\n                            <br />\n                            <small>{subtitle}</small>\n                          </>\n                        )}\n                      </span>\n                    </Link>\n                  </li>\n                );\n              },\n            )}\n          </ul>\n        </nav>\n      ) : (\n        <Menu2\n          instanceRef={menuRef}\n          overflow=\"auto\"\n          viewScroll=\"close\"\n          menuClassName=\"glass-menu shortcuts-menu\"\n          gap={8}\n          position=\"anchor\"\n          onMenuChange={(e) => {\n            if (e.open && hasLists.current) {\n              getLists().then(setLists);\n            }\n          }}\n          menuButton={\n            <button\n              type=\"button\"\n              id=\"shortcuts-button\"\n              class=\"plain\"\n              onContextMenu={(e) => {\n                e.preventDefault();\n                states.showShortcutsSettings = true;\n              }}\n              onTransitionStart={(e) => {\n                // Close menu if the button disappears\n                try {\n                  const { target } = e;\n                  if (getComputedStyle(target).pointerEvents === 'none') {\n                    menuRef.current?.closeMenu?.();\n                  }\n                } catch (e) {}\n              }}\n            >\n              <Icon icon=\"shortcut\" size=\"xl\" alt={t`Shortcuts`} />\n            </button>\n          }\n        >\n          {formattedShortcuts.map(({ id, path, title, subtitle, icon }, i) => {\n            if (id === 'lists') {\n              return (\n                <SubMenu2\n                  menuClassName=\"glass-menu\"\n                  overflow=\"auto\"\n                  gap={-8}\n                  label={\n                    <>\n                      <Icon icon={icon} size=\"l\" />\n                      <span class=\"menu-grow\">\n                        <AsyncText>{title}</AsyncText>\n                      </span>\n                      <Icon icon=\"chevron-right\" />\n                    </>\n                  }\n                >\n                  <MenuLink to=\"/l\">\n                    <span>\n                      <Trans>All Lists</Trans>\n                    </span>\n                  </MenuLink>\n                  <MenuDivider />\n                  {lists?.map((list) => (\n                    <MenuLink key={list.id} to={`/l/${list.id}`}>\n                      <span>\n                        {list.title}\n                        {list.exclusive && (\n                          <>\n                            {' '}\n                            <ListExclusiveBadge />\n                          </>\n                        )}\n                      </span>\n                    </MenuLink>\n                  ))}\n                </SubMenu2>\n              );\n            }\n\n            return (\n              <MenuLink\n                to={path}\n                key={`${i}-${id}-${title}-${subtitle}-${path}`}\n                class=\"glass-menu-item\"\n              >\n                <Icon icon={icon} size=\"l\" />{' '}\n                <span class=\"menu-grow\">\n                  <span>\n                    <AsyncText>{title}</AsyncText>\n                  </span>\n                  {subtitle && (\n                    <>\n                      {' '}\n                      <small class=\"more-insignificant\">{subtitle}</small>\n                    </>\n                  )}\n                </span>\n                <span class=\"menu-shortcut hide-until-focus-visible\">\n                  {i + 1}\n                </span>\n              </MenuLink>\n            );\n          })}\n        </Menu2>\n      )}\n    </div>\n  );\n}\n\nexport default memo(Shortcuts);\n","import { api } from './api';\nimport { extractTagsFromStatus, getFollowedTags } from './followed-tags';\nimport pmem from './pmem';\nimport { fetchRelationships } from './relationships';\nimport states, { saveStatus, statusKey } from './states';\nimport store from './store';\nimport supports from './supports';\n\nexport function groupBoosts(values) {\n  let newValues = [];\n  let boostStash = [];\n  let serialBoosts = 0;\n  for (let i = 0; i < values.length; i++) {\n    const item = values[i];\n    if (item.reblog && !item.account?.group) {\n      boostStash.push(item);\n      serialBoosts++;\n    } else {\n      newValues.push(item);\n      if (serialBoosts < 3) {\n        serialBoosts = 0;\n      }\n    }\n  }\n  // if boostStash is more than quarter of values\n  // or if there are 3 or more boosts in a row\n  if (\n    values.length > 10 &&\n    (boostStash.length > values.length / 4 || serialBoosts >= 3)\n  ) {\n    // if boostStash is more than 3 quarter of values\n    const boostStashID = boostStash.map((status) => status.id);\n    if (boostStash.length > (values.length * 3) / 4) {\n      // insert boost array at the end of specialHome list\n      newValues = [\n        ...newValues,\n        { id: boostStashID, items: boostStash, type: 'boosts' },\n      ];\n    } else {\n      // insert boosts array in the middle of specialHome list\n      const half = Math.floor(newValues.length / 2);\n      newValues = [\n        ...newValues.slice(0, half),\n        {\n          id: boostStashID,\n          items: boostStash,\n          type: 'boosts',\n        },\n        ...newValues.slice(half),\n      ];\n    }\n    return newValues;\n  } else {\n    return values;\n  }\n}\n\nexport function dedupeBoosts(items, instance) {\n  const boostedStatusIDs = store.account.get('boostedStatusIDs') || {};\n  const filteredItems = items.filter((item) => {\n    if (!item.reblog) return true;\n    const statusKey = `${instance}-${item.reblog.id}`;\n    const boosterID = boostedStatusIDs[statusKey];\n    if (boosterID && boosterID !== item.id) {\n      console.warn(\n        ` Duplicate boost by ${item.account.displayName}`,\n        item,\n        item.reblog,\n      );\n      return false;\n    } else {\n      boostedStatusIDs[statusKey] = item.id;\n    }\n    return true;\n  });\n  // Limit to 50\n  const keys = Object.keys(boostedStatusIDs);\n  if (keys.length > 50) {\n    keys.slice(0, keys.length - 50).forEach((key) => {\n      delete boostedStatusIDs[key];\n    });\n  }\n  store.account.set('boostedStatusIDs', boostedStatusIDs);\n  return filteredItems;\n}\n\nexport function groupContext(items, instance) {\n  const contexts = [];\n  let contextIndex = 0;\n  items.forEach((item) => {\n    for (let i = 0; i < contexts.length; i++) {\n      if (contexts[i].find((t) => t.id === item.id)) return;\n      if (\n        contexts[i].find((t) => t.id === item.inReplyToId) ||\n        contexts[i].find((t) => t.inReplyToId === item.id)\n      ) {\n        contexts[i].push(item);\n        return;\n      }\n    }\n    const repliedItem = items.find((i) => i.id === item.inReplyToId);\n    if (repliedItem) {\n      contexts[contextIndex++] = [item, repliedItem];\n    }\n  });\n\n  // Check for cross-item contexts\n  // Merge contexts into one if they have a common item (same id)\n  for (let i = 0; i < contexts.length; i++) {\n    for (let j = i + 1; j < contexts.length; j++) {\n      const commonItem = contexts[i].find((t) => contexts[j].includes(t));\n      if (commonItem) {\n        contexts[i] = [...contexts[i], ...contexts[j]];\n        // Remove duplicate items\n        contexts[i] = contexts[i].filter(\n          (item, index, self) =>\n            self.findIndex((t) => t.id === item.id) === index,\n        );\n        contexts.splice(j, 1);\n        j--;\n      }\n    }\n  }\n\n  // Sort items by checking inReplyToId\n  contexts.forEach((context) => {\n    context.sort((a, b) => {\n      if (!a.inReplyToId && !b.inReplyToId) {\n        return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n      }\n      if (a.inReplyToId === b.id) return 1;\n      if (b.inReplyToId === a.id) return -1;\n      if (!a.inReplyToId) return -1;\n      if (!b.inReplyToId) return 1;\n      return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n    });\n  });\n\n  // Tag items that has different author than first post's author\n  contexts.forEach((context) => {\n    const firstItemAccountID = context[0].account.id;\n    context.forEach((item) => {\n      if (item.account.id !== firstItemAccountID) {\n        item._differentAuthor = true;\n      }\n    });\n  });\n\n  if (contexts.length) console.log(' Contexts', contexts);\n\n  const newItems = [];\n  const appliedContextIndices = [];\n  const inReplyToIds = [];\n  items.forEach((item) => {\n    if (item.reblog) {\n      newItems.push(item);\n      return;\n    }\n    for (let i = 0; i < contexts.length; i++) {\n      if (contexts[i].find((t) => t.id === item.id)) {\n        if (appliedContextIndices.includes(i)) return;\n        const contextItems = contexts[i];\n        contextItems.sort((a, b) => {\n          return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n        });\n        const firstItemAccountID = contextItems[0].account.id;\n        newItems.push({\n          id: contextItems.map((i) => i.id),\n          items: contextItems,\n          type: contextItems.every((it) => it.account.id === firstItemAccountID)\n            ? 'thread'\n            : 'conversation',\n        });\n        appliedContextIndices.push(i);\n        return;\n      }\n    }\n\n    // PREPARE FOR REPLY HINTS\n    if (item.inReplyToId && item.inReplyToAccountId !== item.account.id) {\n      const sKey = statusKey(item.id, instance);\n      if (!states.statusReply[sKey]) {\n        // If it's a reply and not a thread\n        inReplyToIds.push({\n          sKey,\n          inReplyToId: item.inReplyToId,\n        });\n        // queueMicrotask(async () => {\n        //   try {\n        //     const { masto } = api({ instance });\n        //     // const replyToStatus = await masto.v1.statuses\n        //     //   .$select(item.inReplyToId)\n        //     //   .fetch();\n        //     const replyToStatus = await fetchStatus(item.inReplyToId, masto);\n        //     saveStatus(replyToStatus, instance, {\n        //       skipThreading: true,\n        //       skipUnfurling: true,\n        //     });\n        //     states.statusReply[sKey] = {\n        //       id: replyToStatus.id,\n        //       instance,\n        //     };\n        //   } catch (e) {\n        //     // Silently fail\n        //     console.error(e);\n        //   }\n        // });\n      }\n    }\n\n    newItems.push(item);\n  });\n\n  // FETCH AND SHOW REPLY HINTS\n  if (inReplyToIds?.length) {\n    queueMicrotask(() => {\n      const { masto } = api({ instance });\n      console.log('REPLYHINT', inReplyToIds);\n\n      // Fallback if batch fetch fails or returns nothing or not supported\n      async function fallbackFetch() {\n        for (let i = 0; i < inReplyToIds.length; i++) {\n          const { sKey, inReplyToId } = inReplyToIds[i];\n          try {\n            const replyToStatus = await fetchStatus(inReplyToId, masto);\n            saveStatus(replyToStatus, instance, {\n              skipThreading: true,\n            });\n            states.statusReply[sKey] = {\n              id: replyToStatus.id,\n              instance,\n            };\n            // Pause 1s\n            await new Promise((resolve) => setTimeout(resolve, 1000));\n          } catch (e) {\n            // Silently fail\n            console.error(e);\n          }\n        }\n      }\n\n      if (supports('@mastodon/fetch-multiple-statuses')) {\n        // This is batch fetching yooo, woot\n        // Limit 20, returns 422 if exceeded https://github.com/mastodon/mastodon/pull/27871\n        const ids = inReplyToIds.map(({ inReplyToId }) => inReplyToId);\n        (async () => {\n          try {\n            const replyToStatuses = await masto.v1.statuses.list({ id: ids });\n            if (replyToStatuses?.length) {\n              for (const replyToStatus of replyToStatuses) {\n                saveStatus(replyToStatus, instance, {\n                  skipThreading: true,\n                });\n                const sKey = inReplyToIds.find(\n                  ({ inReplyToId }) => inReplyToId === replyToStatus.id,\n                )?.sKey;\n                if (sKey) {\n                  states.statusReply[sKey] = {\n                    id: replyToStatus.id,\n                    instance,\n                  };\n                }\n              }\n            } else {\n              fallbackFetch();\n            }\n          } catch (e) {\n            // Silently fail\n            console.error(e);\n            fallbackFetch();\n          }\n        })();\n      } else {\n        fallbackFetch();\n      }\n    });\n  }\n\n  return newItems;\n}\n\nconst fetchStatus = pmem((statusID, masto) => {\n  return masto.v1.statuses.$select(statusID).fetch();\n});\n\nexport async function assignFollowedTags(items, instance) {\n  const followedTags = await getFollowedTags(); // [{name: 'tag'}, {...}]\n  if (!followedTags.length) return;\n  const { statusFollowedTags } = states;\n  console.log('statusFollowedTags', statusFollowedTags);\n  const statusWithFollowedTags = [];\n  items.forEach((item) => {\n    if (item.reblog) return;\n    const { id, content, tags = [] } = item;\n    const sKey = statusKey(id, instance);\n    if (statusFollowedTags[sKey]?.length) return;\n    const extractedTags = extractTagsFromStatus(content);\n    if (!extractedTags.length && !tags.length) return;\n    const itemFollowedTags = followedTags.reduce((acc, tag) => {\n      if (\n        extractedTags.some((t) => t.toLowerCase() === tag.name.toLowerCase()) ||\n        tags.some((t) => t.name.toLowerCase() === tag.name.toLowerCase())\n      ) {\n        acc.push(tag.name);\n      }\n      return acc;\n    }, []);\n    if (itemFollowedTags.length) {\n      // statusFollowedTags[sKey] = itemFollowedTags;\n      statusWithFollowedTags.push({\n        item,\n        sKey,\n        followedTags: itemFollowedTags,\n      });\n    }\n  });\n\n  if (statusWithFollowedTags.length) {\n    const accounts = statusWithFollowedTags.map((s) => s.item.account);\n    const relationships = await fetchRelationships(accounts);\n    if (!relationships) return;\n\n    statusWithFollowedTags.forEach((s) => {\n      const { item, sKey, followedTags } = s;\n      const r = relationships[item.account.id];\n      if (r && !r.following) {\n        statusFollowedTags[sKey] = followedTags;\n      }\n    });\n  }\n}\n\nexport function clearFollowedTagsState() {\n  states.statusFollowedTags = {};\n}\n","import { useLayoutEffect, useState } from 'preact/hooks';\n\nexport default function useScroll({\n  scrollableRef,\n  distanceFromStart = 1, // ratio of clientHeight/clientWidth\n  distanceFromEnd = 1, // ratio of clientHeight/clientWidth\n  scrollThresholdStart = 10,\n  scrollThresholdEnd = 10,\n  direction = 'vertical',\n  distanceFromStartPx: _distanceFromStartPx,\n  distanceFromEndPx: _distanceFromEndPx,\n} = {}) {\n  const [scrollDirection, setScrollDirection] = useState(null);\n  const [reachStart, setReachStart] = useState(false);\n  const [reachEnd, setReachEnd] = useState(false);\n  const [nearReachStart, setNearReachStart] = useState(false);\n  const [nearReachEnd, setNearReachEnd] = useState(false);\n  const isVertical = direction === 'vertical';\n\n  useLayoutEffect(() => {\n    const scrollableElement = scrollableRef.current;\n    if (!scrollableElement) return {};\n    let previousScrollStart = isVertical\n      ? scrollableElement.scrollTop\n      : scrollableElement.scrollLeft;\n\n    function onScroll() {\n      const {\n        scrollTop,\n        scrollLeft,\n        scrollHeight,\n        scrollWidth,\n        clientHeight,\n        clientWidth,\n      } = scrollableElement;\n      const scrollStart = isVertical ? scrollTop : scrollLeft;\n      const scrollDimension = isVertical ? scrollHeight : scrollWidth;\n      const clientDimension = isVertical ? clientHeight : clientWidth;\n      const scrollDistance = Math.abs(scrollStart - previousScrollStart);\n      const distanceFromStartPx =\n        _distanceFromStartPx ||\n        Math.min(\n          clientDimension * distanceFromStart,\n          scrollDimension,\n          scrollStart,\n        );\n      const distanceFromEndPx =\n        _distanceFromEndPx ||\n        Math.min(\n          clientDimension * distanceFromEnd,\n          scrollDimension,\n          scrollDimension - scrollStart - clientDimension,\n        );\n\n      if (\n        scrollDistance >=\n        (previousScrollStart < scrollStart\n          ? scrollThresholdEnd\n          : scrollThresholdStart)\n      ) {\n        setScrollDirection(previousScrollStart < scrollStart ? 'end' : 'start');\n        previousScrollStart = scrollStart;\n      }\n\n      setReachStart(scrollStart <= 0);\n      setReachEnd(scrollStart + clientDimension >= scrollDimension);\n      setNearReachStart(scrollStart <= distanceFromStartPx);\n      setNearReachEnd(\n        scrollStart + clientDimension >= scrollDimension - distanceFromEndPx,\n      );\n    }\n\n    scrollableElement.addEventListener('scroll', onScroll, { passive: true });\n\n    return () => scrollableElement.removeEventListener('scroll', onScroll);\n  }, [\n    distanceFromStart,\n    distanceFromEnd,\n    scrollThresholdStart,\n    scrollThresholdEnd,\n  ]);\n\n  return {\n    scrollDirection,\n    reachStart,\n    reachEnd,\n    nearReachStart,\n    nearReachEnd,\n    init: () => {\n      if (scrollableRef.current) {\n        scrollableRef.current.dispatchEvent(new Event('scroll'));\n      }\n    },\n  };\n}\n","import { useEffect, useLayoutEffect, useRef, useState } from 'preact/hooks';\nimport { useThrottledCallback } from 'use-debounce';\n\nexport default function useScrollFn(\n  {\n    scrollableRef,\n    distanceFromStart = 1, // ratio of clientHeight/clientWidth\n    distanceFromEnd = 1, // ratio of clientHeight/clientWidth\n    scrollThresholdStart = 10,\n    scrollThresholdEnd = 10,\n    direction = 'vertical',\n    distanceFromStartPx: _distanceFromStartPx,\n    distanceFromEndPx: _distanceFromEndPx,\n    init,\n  } = {},\n  callback,\n) {\n  if (!callback) return;\n  const isVertical = direction === 'vertical';\n  const previousScrollStart = useRef(null);\n  const scrollDirection = useRef(null);\n\n  const onScroll = useThrottledCallback(\n    () => {\n      let reachStart = false;\n      let reachEnd = false;\n      let nearReachStart = false;\n      let nearReachEnd = false;\n\n      const scrollableElement = scrollableRef.current;\n      const {\n        scrollTop,\n        scrollLeft,\n        scrollHeight,\n        scrollWidth,\n        clientHeight,\n        clientWidth,\n      } = scrollableElement;\n      const scrollStart = isVertical ? scrollTop : scrollLeft;\n      const scrollDimension = isVertical ? scrollHeight : scrollWidth;\n      const clientDimension = isVertical ? clientHeight : clientWidth;\n      const scrollDelta = scrollStart - previousScrollStart.current;\n      const isScrollingForward = scrollDelta > 0;\n      const threshold = isScrollingForward\n        ? scrollThresholdEnd\n        : scrollThresholdStart;\n      const distanceFromStartPx =\n        _distanceFromStartPx ||\n        Math.min(\n          clientDimension * distanceFromStart,\n          scrollDimension,\n          scrollStart,\n        );\n      const distanceFromEndPx =\n        _distanceFromEndPx ||\n        Math.min(\n          clientDimension * distanceFromEnd,\n          scrollDimension,\n          scrollDimension - scrollStart - clientDimension,\n        );\n\n      if (Math.abs(scrollDelta) >= threshold) {\n        scrollDirection.current = isScrollingForward ? 'end' : 'start';\n        previousScrollStart.current = scrollStart;\n      }\n\n      reachStart = scrollStart <= 0;\n      reachEnd = scrollStart + clientDimension >= scrollDimension;\n      nearReachStart = scrollStart <= distanceFromStartPx;\n      nearReachEnd =\n        scrollStart + clientDimension >= scrollDimension - distanceFromEndPx;\n\n      callback({\n        scrollDirection: scrollDirection.current,\n        reachStart,\n        reachEnd,\n        nearReachStart,\n        nearReachEnd,\n      });\n    },\n    500,\n    {\n      leading: false,\n    },\n  );\n\n  useLayoutEffect(() => {\n    const scrollableElement = scrollableRef.current;\n    if (scrollableElement) {\n      previousScrollStart.current =\n        scrollableElement[isVertical ? 'scrollTop' : 'scrollLeft'];\n      scrollableElement.addEventListener('scroll', onScroll, { passive: true });\n    }\n    return () => {\n      if (scrollableElement) {\n        scrollableElement.removeEventListener('scroll', onScroll);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (init && scrollableRef.current) {\n      queueMicrotask(() => {\n        scrollableRef.current.dispatchEvent(new Event('scroll'));\n      });\n    }\n  }, [init]);\n\n  return {\n    resetScrollDirection: () => {\n      scrollDirection.current = null;\n    },\n  };\n}\n","import './media-post.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useContext, useMemo } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport { getPreferences } from '../utils/api';\nimport FilterContext from '../utils/filter-context';\nimport { isFiltered } from '../utils/filters';\nimport states, { statusKey } from '../utils/states';\nimport store from '../utils/store';\nimport { getCurrentAccountID } from '../utils/store-utils';\n\nimport Media from './media';\n\nfunction MediaPost({\n  class: className,\n  statusID,\n  status,\n  instance,\n  parent,\n  // allowFilters,\n  onMediaClick,\n}) {\n  const { t } = useLingui();\n  let sKey = statusKey(statusID, instance);\n  const snapStates = useSnapshot(states);\n  if (!status) {\n    status = snapStates.statuses[sKey] || snapStates.statuses[statusID];\n    sKey = statusKey(status?.id, instance);\n  }\n  if (!status) {\n    return null;\n  }\n\n  const {\n    account: {\n      acct,\n      avatar,\n      avatarStatic,\n      id: accountId,\n      url: accountURL,\n      displayName,\n      username,\n      emojis: accountEmojis,\n      bot,\n      group,\n    },\n    id,\n    repliesCount,\n    reblogged,\n    reblogsCount,\n    favourited,\n    favouritesCount,\n    bookmarked,\n    poll,\n    muted,\n    sensitive,\n    spoilerText,\n    visibility, // public, unlisted, private, direct\n    language,\n    editedAt,\n    filtered,\n    card,\n    createdAt,\n    inReplyToId,\n    inReplyToAccountId,\n    content,\n    mentions,\n    mediaAttachments,\n    reblog,\n    uri,\n    url,\n    emojis,\n    // Non-API props\n    _deleted,\n    _pinned,\n    // _filtered,\n  } = status;\n\n  if (!mediaAttachments?.length) {\n    return null;\n  }\n\n  const debugHover = (e) => {\n    if (e.shiftKey) {\n      console.log({\n        ...status,\n      });\n    }\n  };\n\n  const currentAccount = useMemo(() => {\n    return getCurrentAccountID();\n  }, []);\n  const isSelf = useMemo(() => {\n    return currentAccount && currentAccount === accountId;\n  }, [accountId, currentAccount]);\n\n  const filterContext = useContext(FilterContext);\n  const filterInfo = !isSelf && isFiltered(filtered, filterContext);\n\n  if (filterInfo?.action === 'hide') {\n    return null;\n  }\n\n  console.debug('RENDER Media post', id, status?.account.displayName);\n\n  const hasSpoiler = sensitive;\n  const prefs = getPreferences();\n  const readingExpandMedia =\n    prefs['reading:expand:media']?.toLowerCase() || 'default';\n  const showSpoilerMedia = readingExpandMedia === 'show_all';\n\n  const Parent = parent || 'div';\n\n  return mediaAttachments.map((media, i) => {\n    const mediaKey = `${sKey}-${media.id}`;\n    const filterTitleStr = filterInfo?.titlesStr;\n    return (\n      <Parent\n        data-state-post-id={sKey}\n        onMouseEnter={debugHover}\n        key={mediaKey}\n        data-spoiler-text={\n          spoilerText || (sensitive ? t`Sensitive media` : undefined)\n        }\n        data-filtered-text={\n          filterInfo\n            ? filterTitleStr\n              ? t`Filtered: ${filterTitleStr}`\n              : t`Filtered`\n            : undefined\n        }\n        class={`\n          media-post\n          ${filterInfo ? 'filtered' : ''}\n          ${hasSpoiler ? 'has-spoiler' : ''}\n          ${showSpoilerMedia ? 'show-media' : ''}\n        `}\n      >\n        <Media\n          class={className}\n          media={media}\n          lang={language}\n          to={`/${instance}/s/${id}?media-only=${i + 1}`}\n          onClick={\n            onMediaClick ? (e) => onMediaClick(e, i, media, status) : undefined\n          }\n        />\n      </Parent>\n    );\n  });\n}\n\nexport default memo(MediaPost);\n","import './nav-menu.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { ControlledMenu, MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { memo } from 'preact/compat';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useLongPress } from 'use-long-press';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport { getLists } from '../utils/lists';\nimport safeBoundingBoxPadding from '../utils/safe-bounding-box-padding';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport { getAccounts, getCurrentAccountID } from '../utils/store-utils';\nimport supports from '../utils/supports';\n\nimport Avatar from './avatar';\nimport Icon from './icon';\nimport ListExclusiveBadge from './list-exclusive-badge';\nimport MenuLink from './menu-link';\nimport SubMenu2 from './submenu2';\n\nfunction NavMenu(props) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { masto, instance, authenticated } = api();\n\n  const [currentAccount, moreThanOneAccount] = useMemo(() => {\n    const accounts = getAccounts();\n    const acc =\n      accounts.find((account) => account.info.id === getCurrentAccountID()) ||\n      accounts[0];\n    return [acc, accounts.length > 1];\n  }, []);\n\n  // Home = Following\n  // But when in multi-column mode, Home becomes columns of anything\n  // User may choose pin or not to pin Following\n  // If user doesn't pin Following, we show it in the menu\n  const showFollowing =\n    (snapStates.settings.shortcutsViewMode === 'multi-column' ||\n      (!snapStates.settings.shortcutsViewMode &&\n        snapStates.settings.shortcutsColumnsMode)) &&\n    !snapStates.shortcuts.find((pin) => pin.type === 'following');\n\n  const bindLongPress = useLongPress(\n    () => {\n      states.showAccounts = true;\n    },\n    {\n      threshold: 600,\n      detect: 'touch',\n      cancelOnMovement: true,\n    },\n  );\n\n  const buttonRef = useRef();\n  const [menuState, setMenuState] = useState(undefined);\n\n  const boundingBoxPadding = safeBoundingBoxPadding([\n    0,\n    0,\n    snapStates.settings.shortcutsViewMode === 'tab-menu-bar' ? 50 : 0,\n    0,\n  ]);\n\n  const mutesIterator = useRef();\n  async function fetchMutes(firstLoad) {\n    if (firstLoad || !mutesIterator.current) {\n      mutesIterator.current = masto.v1.mutes\n        .list({\n          limit: 80,\n        })\n        .values();\n    }\n    const results = await mutesIterator.current.next();\n    return results;\n  }\n\n  const blocksIterator = useRef();\n  async function fetchBlocks(firstLoad) {\n    if (firstLoad || !blocksIterator.current) {\n      blocksIterator.current = masto.v1.blocks\n        .list({\n          limit: 80,\n        })\n        .values();\n    }\n    const results = await blocksIterator.current.next();\n    return results;\n  }\n\n  const buttonClickTS = useRef();\n  return (\n    <>\n      <button\n        ref={buttonRef}\n        type=\"button\"\n        class={`button plain nav-menu-button ${\n          moreThanOneAccount ? 'with-avatar' : ''\n        } ${menuState === 'open' ? 'active' : ''}`}\n        style={{ position: 'relative' }}\n        onClick={() => {\n          buttonClickTS.current = Date.now();\n          setMenuState((state) => (!state ? 'open' : undefined));\n        }}\n        onContextMenu={(e) => {\n          e.preventDefault();\n          states.showAccounts = true;\n        }}\n        {...bindLongPress()}\n      >\n        {moreThanOneAccount && (\n          <Avatar\n            url={\n              currentAccount?.info?.avatar || currentAccount?.info?.avatarStatic\n            }\n            size=\"l\"\n            squircle={currentAccount?.info?.bot}\n          />\n        )}\n        <Icon icon=\"menu\" size={moreThanOneAccount ? 's' : 'l'} alt={t`Menu`} />\n      </button>\n      <ControlledMenu\n        menuClassName=\"nav-menu\"\n        state={menuState}\n        anchorRef={buttonRef}\n        onClose={() => {\n          setMenuState(undefined);\n        }}\n        containerProps={{\n          style: {\n            zIndex: 10,\n          },\n          onClick: () => {\n            if (Date.now() - buttonClickTS.current < 300) {\n              return;\n            }\n            // setMenuState(undefined);\n          },\n        }}\n        portal={{\n          target: document.body,\n        }}\n        {...props}\n        overflow=\"auto\"\n        viewScroll=\"close\"\n        position=\"anchor\"\n        align=\"center\"\n        boundingBoxPadding={boundingBoxPadding}\n        unmountOnClose\n      >\n        {!!snapStates.appVersion?.commitHash &&\n          __COMMIT_HASH__ !== snapStates.appVersion.commitHash && (\n            <div class=\"top-menu\">\n              <MenuItem\n                onClick={() => {\n                  const yes = confirm(t`Reload page now to update?`);\n                  if (yes) {\n                    (async () => {\n                      try {\n                        location.reload();\n                      } catch (e) {}\n                    })();\n                  }\n                }}\n              >\n                <Icon icon=\"sparkles\" class=\"sparkle-icon\" size=\"l\" />{' '}\n                <span>\n                  <Trans>New update available</Trans>\n                </span>\n              </MenuItem>\n              <MenuDivider />\n            </div>\n          )}\n        <section>\n          <MenuLink to=\"/\">\n            <Icon icon=\"home\" size=\"l\" />{' '}\n            <span>\n              <Trans>Home</Trans>\n            </span>\n          </MenuLink>\n          {authenticated ? (\n            <>\n              {showFollowing && (\n                <MenuLink to=\"/following\">\n                  <Icon icon=\"following\" size=\"l\" />{' '}\n                  <span>\n                    <Trans id=\"following.title\">Following</Trans>\n                  </span>\n                </MenuLink>\n              )}\n              <MenuLink to=\"/catchup\">\n                <Icon icon=\"history2\" size=\"l\" />\n                <span>\n                  <Trans>Catch-up</Trans>\n                </span>\n              </MenuLink>\n              {supports('@mastodon/mentions') && (\n                <MenuLink to=\"/mentions\">\n                  <Icon icon=\"at\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Mentions</Trans>\n                  </span>\n                </MenuLink>\n              )}\n              <MenuLink to=\"/notifications\">\n                <Icon icon=\"notification\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Notifications</Trans>\n                </span>\n                {snapStates.notificationsShowNew && (\n                  <sup title={t`New`} style={{ opacity: 0.5 }}>\n                    {' '}\n                    &bull;\n                  </sup>\n                )}\n              </MenuLink>\n              <MenuDivider />\n              {currentAccount?.info?.id && (\n                <MenuLink to={`/${instance}/a/${currentAccount.info.id}`}>\n                  <Icon icon=\"user\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Profile</Trans>\n                  </span>\n                </MenuLink>\n              )}\n              <ListMenu menuState={menuState} />\n              <MenuLink to=\"/b\">\n                <Icon icon=\"bookmark\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Bookmarks</Trans>\n                </span>\n              </MenuLink>\n              <SubMenu2\n                menuClassName=\"nav-submenu\"\n                overflow=\"auto\"\n                gap={-8}\n                label={\n                  <>\n                    <Icon icon=\"more\" size=\"l\" />\n                    <span class=\"menu-grow\">\n                      <Trans>More</Trans>\n                    </span>\n                    <Icon icon=\"chevron-right\" />\n                  </>\n                }\n              >\n                <MenuLink to=\"/f\">\n                  <Icon icon=\"heart\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Likes</Trans>\n                  </span>\n                </MenuLink>\n                <MenuLink to=\"/fh\">\n                  <Icon icon=\"hashtag\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Followed Hashtags</Trans>\n                  </span>\n                </MenuLink>\n                <MenuLink to=\"/sp\">\n                  <Icon icon=\"schedule\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Scheduled Posts</Trans>\n                  </span>\n                </MenuLink>\n                <MenuDivider />\n                {supports('@mastodon/filters') && (\n                  <MenuLink to=\"/ft\">\n                    <Icon icon=\"filters\" size=\"l\" />{' '}\n                    <span>\n                      <Trans>Filters</Trans>\n                    </span>\n                  </MenuLink>\n                )}\n                <MenuItem\n                  onClick={() => {\n                    states.showGenericAccounts = {\n                      id: 'mute',\n                      heading: t`Muted users`,\n                      fetchAccounts: fetchMutes,\n                      excludeRelationshipAttrs: ['muting'],\n                    };\n                  }}\n                >\n                  <Icon icon=\"mute\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Muted users</Trans>\n                  </span>\n                </MenuItem>\n                <MenuItem\n                  onClick={() => {\n                    states.showGenericAccounts = {\n                      id: 'block',\n                      heading: t`Blocked users`,\n                      fetchAccounts: fetchBlocks,\n                      excludeRelationshipAttrs: ['blocking'],\n                    };\n                  }}\n                >\n                  <Icon icon=\"block\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Blocked users</Trans>\n                  </span>\n                </MenuItem>{' '}\n              </SubMenu2>\n              <MenuDivider />\n              <MenuItem\n                onClick={() => {\n                  states.showAccounts = true;\n                }}\n              >\n                <Icon icon=\"group\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Accounts</Trans>\n                </span>\n              </MenuItem>\n            </>\n          ) : (\n            <>\n              <MenuDivider />\n              <MenuLink to=\"/login\">\n                <Icon icon=\"user\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Log in</Trans>\n                </span>\n              </MenuLink>\n            </>\n          )}\n        </section>\n        <section>\n          <MenuDivider />\n          <MenuLink to={`/search`}>\n            <Icon icon=\"search\" size=\"l\" />{' '}\n            <span>\n              <Trans>Search</Trans>\n            </span>\n          </MenuLink>\n          <MenuLink to={`/${instance}/trending`}>\n            <Icon icon=\"chart\" size=\"l\" />{' '}\n            <span>\n              <Trans>Trending</Trans>\n            </span>\n          </MenuLink>\n          <MenuLink to={`/${instance}/p/l`}>\n            <Icon icon=\"building\" size=\"l\" />{' '}\n            <span>\n              <Trans>Local</Trans>\n            </span>\n          </MenuLink>\n          <MenuLink to={`/${instance}/p`}>\n            <Icon icon=\"earth\" size=\"l\" />{' '}\n            <span>\n              <Trans>Federated</Trans>\n            </span>\n          </MenuLink>\n          {authenticated ? (\n            <>\n              <MenuDivider className=\"divider-grow\" />\n              <MenuItem\n                onClick={() => {\n                  states.showKeyboardShortcutsHelp = true;\n                }}\n              >\n                <Icon icon=\"keyboard\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Keyboard shortcuts</Trans>\n                </span>\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  states.showShortcutsSettings = true;\n                }}\n              >\n                <Icon icon=\"shortcut\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Shortcuts / Columns</Trans>\n                </span>\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  states.showSettings = true;\n                }}\n              >\n                <Icon icon=\"gear\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Settings</Trans>\n                </span>\n              </MenuItem>\n            </>\n          ) : (\n            <>\n              <MenuDivider />\n              <MenuItem\n                onClick={() => {\n                  states.showSettings = true;\n                }}\n              >\n                <Icon icon=\"gear\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Settings</Trans>\n                </span>\n              </MenuItem>\n            </>\n          )}\n        </section>\n      </ControlledMenu>\n    </>\n  );\n}\n\nfunction ListMenu({ menuState }) {\n  const supportsLists = supports('@mastodon/lists');\n  const [lists, setLists] = useState([]);\n  useEffect(() => {\n    if (!supportsLists) return;\n    if (menuState === 'open') {\n      getLists().then(setLists);\n    }\n  }, [menuState, supportsLists]);\n\n  return lists.length > 0 ? (\n    <SubMenu2\n      menuClassName=\"nav-submenu\"\n      overflow=\"auto\"\n      gap={-8}\n      label={\n        <>\n          <Icon icon=\"list\" size=\"l\" />\n          <span class=\"menu-grow\">\n            <Trans>Lists</Trans>\n          </span>\n          <Icon icon=\"chevron-right\" />\n        </>\n      }\n    >\n      <MenuLink to=\"/l\">\n        <span>\n          <Trans>All Lists</Trans>\n        </span>\n      </MenuLink>\n      {lists?.length > 0 && (\n        <>\n          <MenuDivider />\n          {lists.map((list) => (\n            <MenuLink key={list.id} to={`/l/${list.id}`}>\n              <span>\n                {list.title}\n                {list.exclusive && (\n                  <>\n                    {' '}\n                    <ListExclusiveBadge />\n                  </>\n                )}\n              </span>\n            </MenuLink>\n          ))}\n        </>\n      )}\n    </SubMenu2>\n  ) : (\n    supportsLists && (\n      <MenuLink to=\"/l\">\n        <Icon icon=\"list\" size=\"l\" />\n        <span>\n          <Trans>Lists</Trans>\n        </span>\n      </MenuLink>\n    )\n  );\n}\n\nexport default memo(NavMenu);\n","import { plural } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { useDebouncedCallback } from 'use-debounce';\nimport { useSnapshot } from 'valtio';\n\nimport FilterContext from '../utils/filter-context';\nimport { filteredItems, isFiltered } from '../utils/filters';\nimport isRTL from '../utils/is-rtl';\nimport showToast from '../utils/show-toast';\nimport states, { statusKey } from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport { isMediaFirstInstance } from '../utils/store-utils';\nimport { groupBoosts, groupContext } from '../utils/timeline-utils';\nimport useInterval from '../utils/useInterval';\nimport usePageVisibility from '../utils/usePageVisibility';\nimport useScroll from '../utils/useScroll';\nimport useScrollFn from '../utils/useScrollFn';\n\nimport Icon from './icon';\nimport Link from './link';\nimport MediaPost from './media-post';\nimport NavMenu from './nav-menu';\nimport Status from './status';\nimport ThreadBadge from './thread-badge';\n\nconst scrollIntoViewOptions = {\n  block: 'start',\n  inline: 'center',\n  behavior: 'smooth',\n};\n\nfunction Timeline({\n  title,\n  titleComponent,\n  id,\n  instance,\n  emptyText,\n  errorText,\n  useItemID, // use statusID instead of status object, assuming it's already in states\n  boostsCarousel,\n  fetchItems = () => {},\n  checkForUpdates = () => {},\n  checkForUpdatesInterval = 15_000, // 15 seconds\n  headerStart,\n  headerEnd,\n  timelineStart,\n  // allowFilters,\n  refresh,\n  view,\n  filterContext,\n  showFollowedTags,\n  showReplyParent,\n  clearWhenRefresh,\n}) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const [items, setItems] = useState([]);\n  const [uiState, setUIState] = useState('start');\n  const [showMore, setShowMore] = useState(false);\n  const [showNew, setShowNew] = useState(false);\n  const [visible, setVisible] = useState(true);\n  const scrollableRef = useRef();\n\n  console.debug('RENDER Timeline', id, refresh);\n  __BENCHMARK.start(`timeline-${id}-load`);\n\n  const mediaFirst = useMemo(() => isMediaFirstInstance(), []);\n\n  const allowGrouping = view !== 'media';\n  const loadItemsTS = useRef(0); // Ensures only one loadItems at a time\n  const loadItems = useDebouncedCallback(\n    (firstLoad) => {\n      setShowNew(false);\n      // if (uiState === 'loading') return;\n      setUIState('loading');\n      (async () => {\n        try {\n          const ts = (loadItemsTS.current = Date.now());\n          let { done, value } = await fetchItems(firstLoad);\n          if (ts !== loadItemsTS.current) return;\n          if (Array.isArray(value)) {\n            // Avoid grouping for pinned posts\n            const [pinnedPosts, otherPosts] = value.reduce(\n              (acc, item) => {\n                if (item._pinned) {\n                  acc[0].push(item);\n                } else {\n                  acc[1].push(item);\n                }\n                return acc;\n              },\n              [[], []],\n            );\n            value = otherPosts;\n            if (allowGrouping) {\n              if (boostsCarousel) {\n                value = groupBoosts(value);\n              }\n              value = groupContext(value, instance);\n            }\n            if (pinnedPosts.length) {\n              value = pinnedPosts.concat(value);\n            }\n            console.log(value);\n            if (firstLoad) {\n              setItems(value);\n            } else {\n              setItems((items) => [...items, ...value]);\n            }\n            if (!value.length) done = true;\n            setShowMore(!done);\n          } else {\n            setShowMore(false);\n          }\n          setUIState('default');\n          __BENCHMARK.end(`timeline-${id}-load`);\n        } catch (e) {\n          console.error(e);\n          setUIState('error');\n          if (firstLoad && !items.length && errorText) {\n            showToast(errorText);\n          }\n        } finally {\n          loadItems.cancel();\n        }\n      })();\n    },\n    1_000,\n    {\n      leading: true,\n      // trailing: false,\n    },\n  );\n\n  const itemsSelector = '.timeline-item, .timeline-item-alt';\n\n  const jRef = useHotkeys(\n    'j, shift+j',\n    (e, handler) => {\n      // Fix bug: shift+j is fired even when j is pressed due to useKey: true\n      if (e.shiftKey !== handler.shift) return;\n\n      // focus on next status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      ).filter((item) => !!item.offsetHeight);\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let nextItem = allItems[activeItemIndex + 1];\n        if (handler.shift) {\n          // get next status that's not .timeline-item-alt\n          nextItem = allItems.find(\n            (item, index) =>\n              index > activeItemIndex &&\n              !item.classList.contains('timeline-item-alt'),\n          );\n        }\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k, shift+k',\n    (e, handler) => {\n      // Fix bug: shift+k is fired even when k is pressed due to useKey: true\n      if (e.shiftKey !== handler.shift) return;\n\n      // focus on previous status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      ).filter((item) => !!item.offsetHeight);\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (handler.shift) {\n          // get prev status that's not .timeline-item-alt\n          prevItem = allItems.findLast(\n            (item, index) =>\n              index < activeItemIndex &&\n              !item.classList.contains('timeline-item-alt'),\n          );\n        }\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey,\n    },\n  );\n\n  const oRef = useHotkeys(\n    ['enter', 'o'],\n    () => {\n      // open active status\n      const activeItem = document.activeElement;\n      if (activeItem?.matches(itemsSelector)) {\n        activeItem.click();\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const showNewPostsIndicator =\n    items.length > 0 && uiState !== 'loading' && showNew;\n  const handleLoadNewPosts = useCallback(() => {\n    if (showNewPostsIndicator) loadItems(true);\n    scrollableRef.current?.scrollTo({\n      top: 0,\n      behavior: 'smooth',\n    });\n  }, [loadItems, showNewPostsIndicator]);\n  const dotRef = useHotkeys('.', handleLoadNewPosts, {\n    useKey: true,\n    ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n  });\n\n  // const {\n  //   scrollDirection,\n  //   nearReachStart,\n  //   nearReachEnd,\n  //   reachStart,\n  //   reachEnd,\n  // } = useScroll({\n  //   scrollableRef,\n  //   distanceFromEnd: 2,\n  //   scrollThresholdStart: 44,\n  // });\n  const headerRef = useRef();\n  // const [hiddenUI, setHiddenUI] = useState(false);\n  const [nearReachStart, setNearReachStart] = useState(false);\n  const scrollFnCallback = useCallback(\n    ({ scrollDirection, nearReachStart, reachStart }) => {\n      if (headerRef.current) {\n        const hiddenUI = scrollDirection === 'end' && !nearReachStart;\n        headerRef.current.hidden = hiddenUI;\n      }\n      setNearReachStart(nearReachStart);\n      if (reachStart) {\n        loadItems(true);\n      }\n    },\n    [setNearReachStart, loadItems],\n  );\n  const { resetScrollDirection } = useScrollFn(\n    {\n      scrollableRef,\n      distanceFromEnd: 2,\n      scrollThresholdStart: 44,\n    },\n    scrollFnCallback,\n  );\n\n  useEffect(() => {\n    scrollableRef.current?.scrollTo({ top: 0 });\n    loadItems(true);\n  }, []);\n  const firstLoad = useRef(true);\n  useEffect(() => {\n    if (firstLoad.current) {\n      firstLoad.current = false;\n      return;\n    }\n    if (clearWhenRefresh && items?.length) {\n      loadItems.cancel?.();\n      setItems([]);\n    }\n    loadItems(true);\n  }, [clearWhenRefresh, refresh]);\n\n  // useEffect(() => {\n  //   if (reachStart) {\n  //     loadItems(true);\n  //   }\n  // }, [reachStart]);\n\n  // useEffect(() => {\n  //   if (nearReachEnd || (reachEnd && showMore)) {\n  //     loadItems();\n  //   }\n  // }, [nearReachEnd, showMore]);\n\n  const prevView = useRef(view);\n  useEffect(() => {\n    if (prevView.current !== view) {\n      prevView.current = view;\n      setItems([]);\n    }\n  }, [view]);\n\n  const loadOrCheckUpdates = useCallback(\n    async ({ disableIdleCheck = false } = {}) => {\n      const noPointers = scrollableRef.current\n        ? getComputedStyle(scrollableRef.current).pointerEvents === 'none'\n        : false;\n      console.log(' Load or check updates', id, {\n        autoRefresh: snapStates.settings.autoRefresh,\n        scrollTop: scrollableRef.current.scrollTop,\n        disableIdleCheck,\n        idle: window.__IDLE__,\n        inBackground: inBackground(),\n        noPointers,\n      });\n      if (\n        snapStates.settings.autoRefresh &&\n        scrollableRef.current.scrollTop < 16 &&\n        (disableIdleCheck || window.__IDLE__) &&\n        !inBackground() &&\n        !noPointers\n      ) {\n        console.log(' Load updates', id, snapStates.settings.autoRefresh);\n        loadItems(true);\n      } else {\n        console.log(' Check updates', id, snapStates.settings.autoRefresh);\n        const hasUpdate = await checkForUpdates();\n        if (hasUpdate) {\n          console.log(' Has new updates', id);\n          setShowNew(true);\n        }\n      }\n    },\n    [id, loadItems, checkForUpdates, snapStates.settings.autoRefresh],\n  );\n\n  const lastHiddenTime = useRef();\n  usePageVisibility(\n    (visible) => {\n      if (visible) {\n        const timeDiff = Date.now() - lastHiddenTime.current;\n        if (!lastHiddenTime.current || timeDiff > 1000 * 3) {\n          // 3 seconds\n          loadOrCheckUpdates({\n            disableIdleCheck: true,\n          });\n        }\n      } else {\n        lastHiddenTime.current = Date.now();\n      }\n      setVisible(visible);\n    },\n    [checkForUpdates, loadOrCheckUpdates, snapStates.settings.autoRefresh],\n  );\n\n  // checkForUpdates interval\n  useInterval(\n    loadOrCheckUpdates,\n    visible && !showNew\n      ? checkForUpdatesInterval * (nearReachStart ? 1 : 2)\n      : null,\n  );\n\n  // const hiddenUI = scrollDirection === 'end' && !nearReachStart;\n\n  return (\n    <FilterContext.Provider value={filterContext}>\n      <div\n        id={`${id}-page`}\n        class={`deck-container ${\n          mediaFirst ? 'deck-container-media-first' : ''\n        }`}\n        ref={(node) => {\n          scrollableRef.current = node;\n          jRef.current = node;\n          kRef.current = node;\n          oRef.current = node;\n          dotRef.current = node;\n        }}\n        tabIndex=\"-1\"\n        onClick={(e) => {\n          // If click on timeline item, unhide header\n          if (\n            headerRef.current &&\n            e.target.closest('.timeline-item, .timeline-item-alt')\n          ) {\n            setTimeout(() => {\n              headerRef.current.hidden = false;\n              resetScrollDirection();\n            }, 250);\n          }\n        }}\n      >\n        <div class=\"timeline-deck deck\">\n          <header\n            ref={headerRef}\n            // hidden={hiddenUI}\n            onClick={(e) => {\n              if (!e.target.closest('a, button')) {\n                scrollableRef.current?.scrollTo({\n                  top: 0,\n                  behavior: 'smooth',\n                });\n              }\n            }}\n            onDblClick={(e) => {\n              if (!e.target.closest('a, button')) {\n                loadItems(true);\n              }\n            }}\n            class={uiState === 'loading' ? 'loading' : ''}\n          >\n            <div class=\"header-grid\">\n              <div class=\"header-side\">\n                <NavMenu />\n                {headerStart !== null && headerStart !== undefined ? (\n                  headerStart\n                ) : (\n                  <Link to=\"/\" class=\"button plain home-button\">\n                    <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n                  </Link>\n                )}\n              </div>\n              {title && (titleComponent ? titleComponent : <h1>{title}</h1>)}\n              <div class=\"header-side\">\n                {/* <Loader hidden={uiState !== 'loading'} /> */}\n                {!!headerEnd && headerEnd}\n              </div>\n            </div>\n            {showNewPostsIndicator && (\n              <button\n                class=\"updates-button shiny-pill\"\n                type=\"button\"\n                onClick={handleLoadNewPosts}\n              >\n                <Icon icon=\"arrow-up\" /> <Trans>New posts</Trans>\n              </button>\n            )}\n          </header>\n          {!!timelineStart && (\n            <div\n              class={`timeline-start ${uiState === 'loading' ? 'loading' : ''}`}\n            >\n              {timelineStart}\n            </div>\n          )}\n          {!!items.length ? (\n            <>\n              <ul class={`timeline ${view ? `timeline-${view}` : ''}`}>\n                {items.map((status) => (\n                  <TimelineItem\n                    status={status}\n                    instance={instance}\n                    useItemID={useItemID}\n                    // allowFilters={allowFilters}\n                    filterContext={filterContext}\n                    key={status.id + status?._pinned + view}\n                    view={view}\n                    showFollowedTags={showFollowedTags}\n                    showReplyParent={showReplyParent}\n                    mediaFirst={mediaFirst}\n                  />\n                ))}\n                {showMore &&\n                  uiState === 'loading' &&\n                  (view === 'media' ? null : (\n                    <>\n                      <li\n                        style={{\n                          height: '20vh',\n                        }}\n                      >\n                        <Status skeleton mediaFirst={mediaFirst} />\n                      </li>\n                      <li\n                        style={{\n                          height: '25vh',\n                        }}\n                      >\n                        <Status skeleton mediaFirst={mediaFirst} />\n                      </li>\n                    </>\n                  ))}\n              </ul>\n              {uiState === 'default' &&\n                (showMore ? (\n                  <InView\n                    root={scrollableRef.current}\n                    rootMargin={`0px 0px ${screen.height * 1.5}px 0px`}\n                    onChange={(inView) => {\n                      if (inView) {\n                        loadItems();\n                      }\n                    }}\n                  >\n                    <button\n                      type=\"button\"\n                      class=\"plain block\"\n                      onClick={() => loadItems()}\n                      style={{ marginBlockEnd: '6em' }}\n                    >\n                      <Trans>Show more</Trans>\n                    </button>\n                  </InView>\n                ) : (\n                  <p class=\"ui-state insignificant\">\n                    <Trans>The end.</Trans>\n                  </p>\n                ))}\n            </>\n          ) : uiState === 'loading' ? (\n            <ul class=\"timeline\">\n              {Array.from({ length: 5 }).map((_, i) =>\n                view === 'media' ? (\n                  <div\n                    style={{\n                      height: '50vh',\n                    }}\n                  />\n                ) : (\n                  <li key={i}>\n                    <Status skeleton mediaFirst={mediaFirst} />\n                  </li>\n                ),\n              )}\n            </ul>\n          ) : (\n            uiState !== 'error' &&\n            uiState !== 'start' && <p class=\"ui-state\">{emptyText}</p>\n          )}\n          {uiState === 'error' && (\n            <p class=\"ui-state\">\n              {errorText}\n              <br />\n              <br />\n              <button type=\"button\" onClick={() => loadItems(!items.length)}>\n                <Trans>Try again</Trans>\n              </button>\n            </p>\n          )}\n        </div>\n      </div>\n    </FilterContext.Provider>\n  );\n}\n\nconst TimelineItem = memo(\n  ({\n    status,\n    instance,\n    useItemID,\n    // allowFilters,\n    filterContext,\n    view,\n    showFollowedTags,\n    showReplyParent,\n    mediaFirst,\n  }) => {\n    const { t } = useLingui();\n    console.debug('RENDER TimelineItem', status.id);\n    const { id: statusID, reblog, items, type, _pinned } = status;\n    if (_pinned) useItemID = false;\n    const actualStatusID = reblog?.id || statusID;\n    const url = instance\n      ? `/${instance}/s/${actualStatusID}`\n      : `/s/${actualStatusID}`;\n\n    if (items) {\n      let fItems = filteredItems(items, filterContext);\n      let title = '';\n      if (type === 'boosts') {\n        title = plural(fItems.length, {\n          one: '# Boost',\n          other: '# Boosts',\n        });\n      } else if (type === 'pinned') {\n        title = t`Pinned posts`;\n      }\n      const isCarousel = type === 'boosts' || type === 'pinned';\n      if (isCarousel) {\n        const filteredItemsIDs = new Set();\n        // Here, we don't hide filtered posts, but we sort them last\n        fItems.sort((a, b) => {\n          // if (a._filtered && !b._filtered) {\n          //   return 1;\n          // }\n          // if (!a._filtered && b._filtered) {\n          //   return -1;\n          // }\n          const aFiltered = isFiltered(a.filtered, filterContext);\n          const bFiltered = isFiltered(b.filtered, filterContext);\n          if (aFiltered && aFiltered?.action !== 'blur') {\n            filteredItemsIDs.add(a.id);\n          }\n          if (bFiltered && bFiltered?.action !== 'blur') {\n            filteredItemsIDs.add(b.id);\n          }\n          if (aFiltered && !bFiltered) {\n            return 1;\n          }\n          if (!aFiltered && bFiltered) {\n            return -1;\n          }\n          return 0;\n        });\n\n        if (filteredItemsIDs.size >= 2) {\n          const GROUP_SIZE = 5;\n          // If 2 or more, group filtered items into one, limit to GROUP_SIZE in a group\n          const unfiltered = [];\n          const filtered = [];\n          fItems.forEach((item) => {\n            if (filteredItemsIDs.has(item.id)) {\n              filtered.push(item);\n            } else {\n              unfiltered.push(item);\n            }\n          });\n          const filteredItems = [];\n          for (let i = 0; i < filtered.length; i += GROUP_SIZE) {\n            filteredItems.push({\n              _grouped: true,\n              posts: filtered.slice(i, i + GROUP_SIZE),\n            });\n          }\n          fItems = unfiltered.concat(filteredItems);\n        }\n\n        return (\n          <li key={`timeline-${statusID}`} class=\"timeline-item-carousel\">\n            <StatusCarousel title={title} class={`${type}-carousel`}>\n              {fItems.map((item) => {\n                const { id: statusID, reblog, _pinned, _grouped } = item;\n                if (_grouped) {\n                  return (\n                    <li key={statusID} class=\"timeline-item-carousel-group\">\n                      {item.posts.map((item) => {\n                        const { id: statusID, reblog, _pinned } = item;\n                        const actualStatusID = reblog?.id || statusID;\n                        const url = instance\n                          ? `/${instance}/s/${actualStatusID}`\n                          : `/s/${actualStatusID}`;\n                        if (_pinned) useItemID = false;\n                        return (\n                          <Link\n                            class=\"status-carousel-link timeline-item-alt\"\n                            to={url}\n                          >\n                            {useItemID ? (\n                              <Status\n                                statusID={statusID}\n                                instance={instance}\n                                size=\"s\"\n                              />\n                            ) : (\n                              <Status\n                                status={item}\n                                instance={instance}\n                                size=\"s\"\n                              />\n                            )}\n                          </Link>\n                        );\n                      })}\n                    </li>\n                  );\n                }\n\n                const actualStatusID = reblog?.id || statusID;\n                const url = instance\n                  ? `/${instance}/s/${actualStatusID}`\n                  : `/s/${actualStatusID}`;\n                if (_pinned) useItemID = false;\n                return (\n                  <li key={statusID}>\n                    <Link\n                      class=\"status-carousel-link timeline-item-alt\"\n                      to={url}\n                    >\n                      {useItemID ? (\n                        <Status\n                          statusID={statusID}\n                          instance={instance}\n                          size=\"s\"\n                          contentTextWeight\n                          enableCommentHint\n                          // allowFilters={allowFilters}\n                          mediaFirst={mediaFirst}\n                        />\n                      ) : (\n                        <Status\n                          status={item}\n                          instance={instance}\n                          size=\"s\"\n                          contentTextWeight\n                          enableCommentHint\n                          // allowFilters={allowFilters}\n                          mediaFirst={mediaFirst}\n                        />\n                      )}\n                    </Link>\n                  </li>\n                );\n              })}\n            </StatusCarousel>\n          </li>\n        );\n      }\n      const manyItems = fItems.length > 3;\n      return fItems.map((item, i) => {\n        const { id: statusID, _differentAuthor } = item;\n        const url = instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`;\n        const isMiddle = i > 0 && i < fItems.length - 1;\n        const isSpoiler = item.sensitive && !!item.spoilerText;\n        const showCompact =\n          (!_differentAuthor && isSpoiler && i > 0) ||\n          (manyItems &&\n            isMiddle &&\n            (type === 'thread' ||\n              (type === 'conversation' &&\n                !_differentAuthor &&\n                !fItems[i - 1]._differentAuthor &&\n                !fItems[i + 1]._differentAuthor)));\n        const isStart = i === 0;\n        const isEnd = i === fItems.length - 1;\n        return (\n          <li\n            key={`timeline-${statusID}`}\n            class={`timeline-item-container timeline-item-container-type-${type} timeline-item-container-${\n              isStart ? 'start' : isEnd ? 'end' : 'middle'\n            } ${_differentAuthor ? 'timeline-item-diff-author' : ''}`}\n          >\n            <Link class=\"status-link timeline-item\" to={url}>\n              {showCompact ? (\n                <TimelineStatusCompact\n                  status={item}\n                  instance={instance}\n                  filterContext={filterContext}\n                />\n              ) : useItemID ? (\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  enableCommentHint={isEnd}\n                  showFollowedTags={showFollowedTags}\n                  // allowFilters={allowFilters}\n                />\n              ) : (\n                <Status\n                  status={item}\n                  instance={instance}\n                  enableCommentHint={isEnd}\n                  showFollowedTags={showFollowedTags}\n                  // allowFilters={allowFilters}\n                />\n              )}\n            </Link>\n          </li>\n        );\n      });\n    }\n\n    const itemKey = `timeline-${statusID + _pinned}`;\n\n    if (view === 'media') {\n      return useItemID ? (\n        <MediaPost\n          class=\"timeline-item\"\n          parent=\"li\"\n          key={itemKey}\n          statusID={statusID}\n          instance={instance}\n          // allowFilters={allowFilters}\n        />\n      ) : (\n        <MediaPost\n          class=\"timeline-item\"\n          parent=\"li\"\n          key={itemKey}\n          status={status}\n          instance={instance}\n          // allowFilters={allowFilters}\n        />\n      );\n    }\n\n    return (\n      <li key={itemKey}>\n        <Link class=\"status-link timeline-item\" to={url}>\n          {useItemID ? (\n            <Status\n              statusID={statusID}\n              instance={instance}\n              enableCommentHint\n              showFollowedTags={showFollowedTags}\n              showReplyParent={showReplyParent}\n              // allowFilters={allowFilters}\n              mediaFirst={mediaFirst}\n            />\n          ) : (\n            <Status\n              status={status}\n              instance={instance}\n              enableCommentHint\n              showFollowedTags={showFollowedTags}\n              showReplyParent={showReplyParent}\n              // allowFilters={allowFilters}\n              mediaFirst={mediaFirst}\n            />\n          )}\n        </Link>\n      </li>\n    );\n  },\n  (oldProps, newProps) => {\n    const oldID = (oldProps.status?.id || '').toString();\n    const newID = (newProps.status?.id || '').toString();\n    return (\n      oldID === newID &&\n      oldProps.instance === newProps.instance &&\n      oldProps.view === newProps.view\n    );\n  },\n);\n\nfunction StatusCarousel({ title, class: className, children }) {\n  const { t } = useLingui();\n  const carouselRef = useRef();\n  const startButtonRef = useRef();\n  const endButtonRef = useRef();\n\n  const [render, setRender] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setRender(true);\n    }, 1);\n  }, []);\n\n  return (\n    <div class={`status-carousel ${className}`}>\n      <header>\n        <h3>{title}</h3>\n        <span>\n          <button\n            ref={startButtonRef}\n            type=\"button\"\n            class=\"small plain2\"\n            // disabled={reachStart}\n            onClick={() => {\n              const left =\n                Math.min(320, carouselRef.current?.offsetWidth) *\n                (isRTL() ? 1 : -1);\n              carouselRef.current?.scrollBy({\n                left,\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"chevron-left\" alt={t`Previous`} />\n          </button>{' '}\n          <button\n            ref={endButtonRef}\n            type=\"button\"\n            class=\"small plain2\"\n            // disabled={reachEnd}\n            onClick={() => {\n              const left =\n                Math.min(320, carouselRef.current?.offsetWidth) *\n                (isRTL() ? -1 : 1);\n              carouselRef.current?.scrollBy({\n                left,\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"chevron-right\" alt={t`Next`} />\n          </button>\n        </span>\n      </header>\n      <ul ref={carouselRef}>\n        <InView\n          class=\"status-carousel-beacon\"\n          onChange={(inView) => {\n            if (startButtonRef.current)\n              startButtonRef.current.disabled = inView;\n          }}\n        />\n        {children[0]}\n        {render && children.slice(1)}\n        <InView\n          class=\"status-carousel-beacon\"\n          onChange={(inView) => {\n            if (endButtonRef.current) endButtonRef.current.disabled = inView;\n          }}\n        />\n      </ul>\n    </div>\n  );\n}\n\nfunction TimelineStatusCompact({ status, instance, filterContext }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { id, visibility, language } = status;\n  const statusPeekText = statusPeek(status);\n  const sKey = statusKey(id, instance);\n  const filterInfo = isFiltered(status.filtered, filterContext);\n  return (\n    <article\n      class={`status compact-thread ${\n        visibility === 'direct' ? 'visibility-direct' : ''\n      }`}\n      tabindex=\"-1\"\n    >\n      <div class=\"status-thread-badge-container\">\n        <ThreadBadge index={snapStates.statusThreadNumber[sKey]} />\n      </div>\n      <div\n        class=\"content-compact\"\n        title={statusPeekText}\n        lang={language}\n        dir=\"auto\"\n      >\n        {!!filterInfo && filterInfo?.action !== 'blur' ? (\n          <b\n            class=\"status-filtered-badge badge-meta horizontal\"\n            title={filterInfo?.titlesStr || ''}\n          >\n            {filterInfo?.titlesStr ? (\n              <Trans>\n                <span>Filtered</span>: <span>{filterInfo.titlesStr}</span>\n              </Trans>\n            ) : (\n              <span>\n                <Trans>Filtered</Trans>\n              </span>\n            )}\n          </b>\n        ) : (\n          <>\n            {statusPeekText}\n            {status.sensitive && status.spoilerText && (\n              <>\n                {' '}\n                <span class=\"spoiler-badge\">\n                  <Icon icon=\"eye-close\" size=\"s\" alt={t`Content warning`} />\n                </span>\n              </>\n            )}\n          </>\n        )}\n      </div>\n    </article>\n  );\n}\n\nfunction inBackground() {\n  return !!document.querySelector('.deck-backdrop, #modal-container > *');\n}\n\nexport default Timeline;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuItem } from '@szhsin/react-menu';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport punycode from 'punycode/';\nimport { useParams, useSearchParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport AccountInfo from '../components/account-info';\nimport EmojiText from '../components/emoji-text';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Menu2 from '../components/menu2';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport mem from '../utils/mem';\nimport pmem from '../utils/pmem';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport {\n  getCurrentAccountID,\n  isMediaFirstInstance,\n} from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\nconst MIN_YEAR = 1983;\nconst MIN_YEAR_MONTH = `${MIN_YEAR}-01`; // Birth of the Internet\n\nconst supportsInputMonth = mem(() => {\n  try {\n    const input = document.createElement('input');\n    input.setAttribute('type', 'month');\n    return input.type === 'month';\n  } catch (e) {\n    return false;\n  }\n});\n\nasync function _isSearchEnabled(instance) {\n  const { masto } = api({ instance });\n  const results = await masto.v2.search.list({\n    q: 'from:me',\n    type: 'statuses',\n    limit: 1,\n  });\n  return !!results?.statuses?.length;\n}\nconst isSearchEnabled = pmem(_isSearchEnabled);\n\nfunction AccountStatuses() {\n  const { i18n, t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { id, ...params } = useParams();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const month = searchParams.get('month');\n  const excludeReplies = !searchParams.get('replies');\n  const excludeBoosts = !!searchParams.get('boosts');\n  const tagged = searchParams.get('tagged');\n  const media = !!searchParams.get('media');\n  const { masto, instance, authenticated } = api({ instance: params.instance });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const accountStatusesIterator = useRef();\n\n  const allSearchParams = [month, excludeReplies, excludeBoosts, tagged, media];\n  const [account, setAccount] = useState();\n  const searchOffsetRef = useRef(0);\n  useEffect(() => {\n    searchOffsetRef.current = 0;\n  }, allSearchParams);\n\n  const mediaFirst = useMemo(() => isMediaFirstInstance(), []);\n\n  const sameCurrentInstance = useMemo(\n    () => instance === currentInstance,\n    [instance, currentInstance],\n  );\n  const [searchEnabled, setSearchEnabled] = useState(false);\n  useEffect(() => {\n    // Only enable for current logged-in instance\n    // Most remote instances don't allow unauthenticated searches\n    if (!sameCurrentInstance) return;\n    if (!account?.acct) return;\n    (async () => {\n      const enabled = await isSearchEnabled(instance);\n      console.log({ enabled });\n      setSearchEnabled(enabled);\n    })();\n  }, [instance, sameCurrentInstance, account?.acct]);\n\n  async function fetchAccountStatuses(firstLoad) {\n    const isValidMonth = /^\\d{4}-[01]\\d$/.test(month);\n    const isValidYear = month?.split?.('-')?.[0] >= MIN_YEAR;\n    if (isValidMonth && isValidYear) {\n      if (!account) {\n        return {\n          value: [],\n          done: true,\n        };\n      }\n      const [_year, _month] = month.split('-');\n      const monthIndex = parseInt(_month, 10) - 1;\n      // YYYY-MM (no day)\n      // Search options:\n      // - from:account\n      // - after:YYYY-MM-DD (non-inclusive)\n      // - before:YYYY-MM-DD (non-inclusive)\n\n      // Last day of previous month\n      const after = new Date(_year, monthIndex, 0);\n      const afterStr = `${after.getFullYear()}-${(after.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}-${after.getDate().toString().padStart(2, '0')}`;\n      // First day of next month\n      const before = new Date(_year, monthIndex + 1, 1);\n      const beforeStr = `${before.getFullYear()}-${(before.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}-${before.getDate().toString().padStart(2, '0')}`;\n      console.log({\n        month,\n        _year,\n        _month,\n        monthIndex,\n        after,\n        before,\n        afterStr,\n        beforeStr,\n      });\n\n      let limit;\n      if (firstLoad) {\n        limit = LIMIT + 1;\n        searchOffsetRef.current = 0;\n      } else {\n        limit = LIMIT + searchOffsetRef.current + 1;\n        searchOffsetRef.current += LIMIT;\n      }\n\n      const searchResults = await masto.v2.search.list({\n        q: `from:${account.acct} after:${afterStr} before:${beforeStr}`,\n        type: 'statuses',\n        limit,\n        offset: searchOffsetRef.current,\n      });\n      if (searchResults?.statuses?.length) {\n        const value = searchResults.statuses.slice(0, LIMIT);\n        value.forEach((item) => {\n          saveStatus(item, instance);\n        });\n        const done = searchResults.statuses.length <= LIMIT;\n        return { value, done };\n      } else {\n        return { value: [], done: true };\n      }\n    }\n\n    let results = [];\n    if (firstLoad) {\n      const { value } = await masto.v1.accounts\n        .$select(id)\n        .statuses.list({\n          pinned: true,\n        })\n        .values()\n        .next();\n      if (value?.length && !tagged && !media) {\n        const pinnedStatuses = value.map((status) => {\n          saveStatus(status, instance);\n          return {\n            ...status,\n            _pinned: true,\n          };\n        });\n        if (pinnedStatuses.length >= 3) {\n          const pinnedStatusesIds = pinnedStatuses.map((status) => status.id);\n          results.push({\n            id: pinnedStatusesIds,\n            items: pinnedStatuses,\n            type: 'pinned',\n          });\n        } else {\n          results.push(...pinnedStatuses);\n        }\n      }\n    }\n    if (firstLoad || !accountStatusesIterator.current) {\n      accountStatusesIterator.current = masto.v1.accounts\n        .$select(id)\n        .statuses.list({\n          limit: LIMIT,\n          exclude_replies: excludeReplies,\n          exclude_reblogs: excludeBoosts,\n          only_media: media || undefined,\n          tagged,\n        })\n        .values();\n    }\n    const { value, done } = await accountStatusesIterator.current.next();\n    if (value?.length) {\n      if (!supports('@mastodon/pinned-posts')) {\n        // Check if value is same as pinned post (results)\n        // If the index for every post is the same, means API might not support pinned posts\n        // TODO: This is a really weird check, fix this at some point\n        if (results.length) {\n          let pinnedStatusesIds = [];\n          if (results[0]?.type === 'pinned') {\n            pinnedStatusesIds = results[0].id;\n          } else {\n            pinnedStatusesIds = results\n              .filter((status) => status._pinned)\n              .map((status) => status.id);\n          }\n          const containsAllPinned = pinnedStatusesIds.every((postId) =>\n            value.some((status) => status.id === postId),\n          );\n          if (containsAllPinned) {\n            // Remove pinned posts\n            results = [];\n          }\n        }\n      }\n\n      results.push(...value);\n\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      value: results,\n      done,\n    };\n  }\n\n  const [featuredTags, setFeaturedTags] = useState([]);\n  let title = t`Account posts`;\n  if (account?.acct) {\n    const acctDisplay = (/@/.test(account.acct) ? '' : '@') + account.acct;\n    const accountDisplay = account?.displayName\n      ? `${account.displayName} (${acctDisplay})`\n      : `${acctDisplay}`;\n    if (!excludeReplies) {\n      title = t`${accountDisplay} (+ Replies)`;\n    } else if (excludeBoosts) {\n      title = t`${accountDisplay} (- Boosts)`;\n    } else if (tagged) {\n      title = t`${accountDisplay} (#${tagged})`;\n    } else if (media) {\n      title = t`${accountDisplay} (Media)`;\n    } else if (month) {\n      const monthYear = new Date(month).toLocaleString(i18n.locale, {\n        month: 'long',\n        year: 'numeric',\n      });\n      title = t`${accountDisplay} (${monthYear})`;\n    } else {\n      title = accountDisplay;\n    }\n  }\n  useTitle(title, '/:instance?/a/:id');\n\n  const fetchAccount = useCallback(() => {\n    return memFetchAccount(id, masto);\n  }, [id, masto]);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const acc = await fetchAccount();\n        console.log(acc);\n        setAccount(acc);\n      } catch (e) {\n        console.error(e);\n      }\n      // No need, because the whole filter bar is hidden\n      // TODO: Revisit this\n      if (!mediaFirst) {\n        try {\n          const featuredTags = await masto.v1.accounts\n            .$select(id)\n            .featuredTags.list();\n          console.log({ featuredTags });\n          setFeaturedTags(featuredTags);\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    })();\n  }, [id, mediaFirst]);\n\n  const { displayName, acct, emojis } = account || {};\n\n  const isSelf = useMemo(\n    () => account?.id === getCurrentAccountID(),\n    [account?.id],\n  );\n\n  const filterBarRef = useRef();\n  const TimelineStart = useMemo(() => {\n    const filtered =\n      !excludeReplies || excludeBoosts || tagged || media || !!month;\n    const cachedAccount = snapStates.accounts[`${id}@${instance}`];\n\n    return (\n      <>\n        <AccountInfo\n          instance={instance}\n          account={cachedAccount || id}\n          fetchAccount={fetchAccount}\n          authenticated={authenticated}\n          standalone\n          showEndorsements\n        />\n        {!mediaFirst && (\n          <div\n            class=\"filter-bar\"\n            ref={filterBarRef}\n            style={{\n              position: 'relative',\n            }}\n          >\n            {filtered ? (\n              <Link\n                to={`/${instance}/a/${id}`}\n                class=\"insignificant filter-clear\"\n                title={t`Clear filters`}\n                key=\"clear-filters\"\n              >\n                <Icon icon=\"x\" size=\"l\" alt={t`Clear`} />\n              </Link>\n            ) : (\n              <Icon\n                icon=\"filter\"\n                class=\"insignificant\"\n                size=\"l\"\n                alt={t`Filters`}\n              />\n            )}\n            <Link\n              to={`/${instance}/a/${id}${excludeReplies ? '?replies=1' : ''}`}\n              onClick={() => {\n                if (excludeReplies) {\n                  showToast(t`Showing post with replies`);\n                }\n              }}\n              class={excludeReplies ? '' : 'is-active'}\n            >\n              <Trans>+ Replies</Trans>\n            </Link>\n            <Link\n              to={`/${instance}/a/${id}${excludeBoosts ? '' : '?boosts=0'}`}\n              onClick={() => {\n                if (!excludeBoosts) {\n                  showToast(t`Showing posts without boosts`);\n                }\n              }}\n              class={!excludeBoosts ? '' : 'is-active'}\n            >\n              <Trans>- Boosts</Trans>\n            </Link>\n            <Link\n              to={`/${instance}/a/${id}${media ? '' : '?media=1'}`}\n              onClick={() => {\n                if (!media) {\n                  showToast(t`Showing posts with media`);\n                }\n              }}\n              class={media ? 'is-active' : ''}\n            >\n              <Trans>Media</Trans>\n            </Link>\n            {featuredTags.map((tag) => (\n              <Link\n                key={tag.id}\n                to={`/${instance}/a/${id}${\n                  tagged === tag.name\n                    ? ''\n                    : `?tagged=${encodeURIComponent(tag.name)}`\n                }`}\n                onClick={() => {\n                  if (tagged !== tag.name) {\n                    showToast(t`Showing posts tagged with #${tag.name}`);\n                  }\n                }}\n                class={tagged === tag.name ? 'is-active' : ''}\n              >\n                <span>\n                  <span class=\"more-insignificant\">#</span>\n                  {tag.name}\n                </span>\n                {\n                  // The count differs based on instance \n                }\n                {/* <span class=\"filter-count\">{tag.statusesCount}</span> */}\n              </Link>\n            ))}\n            {searchEnabled &&\n              (supportsInputMonth() ? (\n                <label class={`filter-field ${month ? 'is-active' : ''}`}>\n                  <Icon icon=\"month\" size=\"l\" />\n                  <input\n                    type=\"month\"\n                    disabled={!account?.acct}\n                    value={month || ''}\n                    min={MIN_YEAR_MONTH}\n                    max={new Date().toISOString().slice(0, 7)}\n                    onInput={(e) => {\n                      const { value, validity } = e.currentTarget;\n                      if (!validity.valid) return;\n                      setSearchParams(\n                        value\n                          ? {\n                              month: value,\n                            }\n                          : {},\n                      );\n                      const [year, month] = value.split('-');\n                      const monthIndex = parseInt(month, 10) - 1;\n                      const date = new Date(year, monthIndex);\n                      showToast(\n                        t`Showing posts in ${date.toLocaleString(i18n.locale, {\n                          month: 'long',\n                          year: 'numeric',\n                        })}`,\n                      );\n                    }}\n                  />\n                </label>\n              ) : (\n                // Fallback to <select> for month and <input type=\"number\"> for year\n                <MonthPicker\n                  class={`filter-field ${month ? 'is-active' : ''}`}\n                  disabled={!account?.acct}\n                  value={month || ''}\n                  min={MIN_YEAR_MONTH}\n                  max={new Date().toISOString().slice(0, 7)}\n                  onInput={(e) => {\n                    const { value, validity } = e;\n                    if (!validity.valid) return;\n                    setSearchParams(\n                      value\n                        ? {\n                            month: value,\n                          }\n                        : {},\n                    );\n                  }}\n                />\n              ))}\n          </div>\n        )}\n      </>\n    );\n  }, [\n    id,\n    instance,\n    authenticated,\n    featuredTags,\n    fetchAccount,\n    searchEnabled,\n    ...allSearchParams,\n  ]);\n\n  useEffect(() => {\n    // Focus on .is-active\n    const active = filterBarRef.current?.querySelector('.is-active');\n    if (active) {\n      console.log('active', active, active.offsetLeft);\n      filterBarRef.current.scrollTo({\n        behavior: 'smooth',\n        left:\n          active.offsetLeft -\n          (filterBarRef.current.offsetWidth - active.offsetWidth) / 2,\n      });\n    }\n  }, [featuredTags, searchEnabled, ...allSearchParams]);\n\n  const accountInstance = useMemo(() => {\n    if (!account?.url) return null;\n    const domain = URL.parse(account.url)?.hostname;\n    return domain;\n  }, [account]);\n  const sameInstance = instance === accountInstance;\n  const allowSwitch = !!account && !sameInstance;\n\n  return (\n    <>\n      <Timeline\n        key={id}\n        title={`${account?.acct ? '@' + account.acct : t`Posts`}`}\n        titleComponent={\n          <h1\n            class=\"header-double-lines header-account\"\n            // onClick={() => {\n            //   states.showAccount = {\n            //     account,\n            //     instance,\n            //   };\n            // }}\n          >\n            <b>\n              <EmojiText\n                text={displayName}\n                emojis={emojis}\n                resolverURL={account?.url}\n              />\n            </b>\n            <div>\n              <span class=\"bidi-isolate\">@{acct}</span>\n            </div>\n          </h1>\n        }\n        id=\"account-statuses\"\n        instance={instance}\n        emptyText={t`Nothing to see here yet.`}\n        errorText={t`Unable to load posts`}\n        fetchItems={fetchAccountStatuses}\n        useItemID\n        view={media || mediaFirst ? 'media' : undefined}\n        boostsCarousel={snapStates.settings.boostsCarousel}\n        timelineStart={TimelineStart}\n        refresh={[\n          excludeReplies,\n          excludeBoosts,\n          tagged,\n          media,\n          month + account?.acct,\n        ].toString()}\n        headerEnd={\n          <Menu2\n            portal\n            // setDownOverflow\n            overflow=\"auto\"\n            viewScroll=\"close\"\n            position=\"anchor\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n          >\n            <MenuItem\n              disabled={!allowSwitch}\n              onClick={() => {\n                (async () => {\n                  try {\n                    const { masto } = api({\n                      instance: accountInstance,\n                    });\n                    const acc = await masto.v1.accounts.lookup({\n                      acct: account.acct,\n                    });\n                    const { id } = acc;\n                    location.hash = `/${accountInstance}/a/${id}`;\n                  } catch (e) {\n                    console.error(e);\n                    alert(t`Unable to fetch account info`);\n                  }\n                })();\n              }}\n            >\n              <Icon icon=\"transfer\" />{' '}\n              <small class=\"menu-double-lines\">\n                <Trans>\n                  Switch to account's instance{' '}\n                  {accountInstance ? (\n                    <>\n                      {' '}\n                      (<b>{punycode.toUnicode(accountInstance)}</b>)\n                    </>\n                  ) : null}\n                </Trans>\n              </small>\n            </MenuItem>\n            {!sameCurrentInstance && (\n              <MenuItem\n                onClick={() => {\n                  (async () => {\n                    try {\n                      const acc = await currentMasto.v1.accounts.lookup({\n                        acct: account.acct + '@' + instance,\n                      });\n                      const { id } = acc;\n                      location.hash = `/${currentInstance}/a/${id}`;\n                    } catch (e) {\n                      console.error(e);\n                      alert(t`Unable to fetch account info`);\n                    }\n                  })();\n                }}\n              >\n                <Icon icon=\"transfer\" />{' '}\n                <small class=\"menu-double-lines\">\n                  <Trans>\n                    Switch to my instance (<b>{currentInstance}</b>)\n                  </Trans>\n                </small>\n              </MenuItem>\n            )}\n          </Menu2>\n        }\n      />\n      {acct && !isSelf && (\n        <data\n          class=\"compose-data\"\n          value={JSON.stringify({\n            draftStatus: {\n              status: `@${acct} `,\n            },\n          })}\n        />\n      )}\n    </>\n  );\n}\n\nfunction MonthPicker(props) {\n  const { i18n } = useLingui();\n  const {\n    class: className,\n    disabled,\n    value,\n    min,\n    max,\n    onInput = () => {},\n  } = props;\n  const [_year, _month] = value?.split('-') || [];\n  const monthFieldRef = useRef();\n  const yearFieldRef = useRef();\n\n  const checkValidity = (month, year) => {\n    const [minYear, minMonth] = min?.split('-') || [];\n    const [maxYear, maxMonth] = max?.split('-') || [];\n    if (year < minYear) return false;\n    if (year > maxYear) return false;\n    if (year === minYear && month < minMonth) return false;\n    if (year === maxYear && month > maxMonth) return false;\n    return true;\n  };\n\n  return (\n    <div class={className}>\n      <Icon icon=\"month\" size=\"l\" />\n      <select\n        ref={monthFieldRef}\n        disabled={disabled}\n        value={_month || ''}\n        onInput={(e) => {\n          const { value: month } = e.currentTarget;\n          const year = yearFieldRef.current.value;\n          if (!checkValidity(month, year))\n            return {\n              value: '',\n              validity: {\n                valid: false,\n              },\n            };\n          onInput({\n            value: month ? `${year}-${month}` : '',\n            validity: {\n              valid: true,\n            },\n          });\n        }}\n      >\n        <option value=\"\">\n          <Trans>Month</Trans>\n        </option>\n        <option disabled>-----</option>\n        {Array.from({ length: 12 }, (_, i) => (\n          <option\n            value={\n              // Month is 1-indexed\n              (i + 1)\n                .toString()\n                .padStart(2, '0')\n            }\n            key={i}\n          >\n            {new Date(0, i).toLocaleString(i18n.locale, {\n              month: 'long',\n            })}\n          </option>\n        ))}\n      </select>{' '}\n      <input\n        ref={yearFieldRef}\n        type=\"number\"\n        disabled={disabled}\n        value={_year || new Date().getFullYear()}\n        min={min?.slice(0, 4) || MIN_YEAR}\n        max={max?.slice(0, 4) || new Date().getFullYear()}\n        onInput={(e) => {\n          const { value: year, validity } = e.currentTarget;\n          const month = monthFieldRef.current.value;\n          if (!validity.valid || !checkValidity(month, year))\n            return {\n              value: '',\n              validity: {\n                valid: false,\n              },\n            };\n          onInput({\n            value: year ? `${year}-${month}` : '',\n            validity: {\n              valid: true,\n            },\n          });\n        }}\n        style={{\n          width: '4.5em',\n        }}\n      />\n    </div>\n  );\n}\n\nfunction fetchAccount(id, masto) {\n  return masto.v1.accounts.$select(id).fetch();\n}\nconst memFetchAccount = pmem(fetchAccount, {\n  maxAge: 30 * 60 * 1000, // 30 minutes\n});\n\nexport default AccountStatuses;\n","import './annual-report.css';\n\nimport { Trans } from '@lingui/react/macro';\nimport { useEffect, useState } from 'preact/hooks';\nimport { useParams } from 'react-router-dom';\n\nimport Link from '../components/link';\nimport NameText from '../components/name-text';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport useTitle from '../utils/useTitle';\n\nexport default function AnnualReport() {\n  const params = useParams();\n  const { year } = params;\n  useTitle(\n    year ? `${year} #Wrapstodon` : '#Wrapstodon',\n    '/annual_report/:year',\n  );\n  const { masto, instance } = api();\n  const [results, setResults] = useState(null);\n  const [uiState, setUIState] = useState('default');\n\n  useEffect(() => {\n    if (year) {\n      (async () => {\n        setUIState('loading');\n        const results = await masto.v1.annualReports.$select(year).fetch();\n        console.log('REPORT', results);\n        setResults(results);\n        setUIState('default');\n      })();\n    }\n  }, [year]);\n\n  const { accounts, annualReports, statuses } = results || {};\n  const report = annualReports?.find((report) => report.year == year)?.data;\n\n  const datePlaceholder = new Date();\n\n  return (\n    <div id=\"annual-report-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class={`report ${uiState === 'loading' ? 'loading-mask' : ''}`}>\n        <h1>{year} #Wrapstodon</h1>\n        {!!report && (\n          <dl>\n            {Object.entries(report).map(([key, value]) => {\n              console.log('value', value);\n              const totals = {};\n              if (Array.isArray(value)) {\n                value.forEach((item) => {\n                  Object.entries(item).forEach(([k, v]) => {\n                    if (typeof v === 'number') {\n                      totals[k] = (totals[k] || 0) + v;\n                    }\n                  });\n                });\n              }\n\n              return (\n                <>\n                  <dt>{key}</dt>\n                  <dd class={`report-${key}`}>\n                    {Array.isArray(value) ? (\n                      <table>\n                        <thead>\n                          <tr>\n                            {Object.entries(value[0]).map(([key, value]) => (\n                              <th\n                                class={\n                                  key !== 'month' && typeof value === 'number'\n                                    ? 'number'\n                                    : ''\n                                }\n                              >\n                                {key}\n                              </th>\n                            ))}\n                          </tr>\n                        </thead>\n                        <tbody>\n                          {value.map((item) => (\n                            <tr>\n                              {Object.entries(item).map(([k, value]) => (\n                                <td\n                                  class={\n                                    k !== 'month' && typeof value === 'number'\n                                      ? 'number'\n                                      : ''\n                                  }\n                                  style={{\n                                    '--percentage':\n                                      typeof value === 'number'\n                                        ? `${(value / totals[k]) * 100}%`\n                                        : 0,\n                                  }}\n                                >\n                                  {value &&\n                                  /(accountId)/i.test(k) &&\n                                  /^(mostRebloggedAccounts|commonlyInteractedWithAccounts)$/i.test(\n                                    key,\n                                  ) ? (\n                                    accounts?.find((a) => a.id === value) ? (\n                                      <NameText\n                                        account={accounts?.find(\n                                          (a) => a.id === value,\n                                        )}\n                                        showAvatar\n                                      />\n                                    ) : (\n                                      ''\n                                    )\n                                  ) : k === 'month' ? (\n                                    datePlaceholder.setMonth(value - 1) &&\n                                    datePlaceholder.toLocaleString(undefined, {\n                                      month: 'long',\n                                    })\n                                  ) : typeof value === 'number' ? (\n                                    value.toLocaleString()\n                                  ) : (\n                                    value\n                                  )}\n                                </td>\n                              ))}\n                            </tr>\n                          ))}\n                        </tbody>\n                      </table>\n                    ) : typeof value === 'object' ? (\n                      /^(topStatuses)$/i.test(key) ? (\n                        <dl>\n                          {Object.entries(value).map(([k, value]) => (\n                            <>\n                              <dt>{k}</dt>\n                              <dd>\n                                {value && (\n                                  <Link to={`/${instance}/s/${value}`}>\n                                    <Status\n                                      status={statuses?.find(\n                                        (s) => s.id === value,\n                                      )}\n                                      size=\"s\"\n                                      readOnly\n                                      showCommentCount\n                                    />\n                                  </Link>\n                                )}\n                              </dd>\n                            </>\n                          ))}\n                        </dl>\n                      ) : (\n                        <table>\n                          <tbody>\n                            {Object.entries(value).map(([k, value]) => (\n                              <tr>\n                                <th>{k}</th>\n                                <td\n                                  class={\n                                    typeof value === 'number' ? 'number' : ''\n                                  }\n                                >\n                                  {value}\n                                </td>\n                              </tr>\n                            ))}\n                          </tbody>\n                        </table>\n                      )\n                    ) : typeof value === 'string' ? (\n                      value\n                    ) : (\n                      // Last resort\n                      JSON.stringify(value, null, 2)\n                    )}\n                  </dd>\n                </>\n              );\n            })}\n          </dl>\n        )}\n      </div>\n      <hr />\n      <p style={{ textAlign: 'center' }}>\n        <Link to=\"/\">\n          <Trans>Go home</Trans>\n        </Link>\n      </p>\n    </div>\n  );\n}\n","import { useLingui } from '@lingui/react/macro';\nimport { useRef } from 'preact/hooks';\n\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Bookmarks() {\n  const { t } = useLingui();\n  useTitle(t`Bookmarks`, '/b');\n  const { masto, instance } = api();\n  const bookmarksIterator = useRef();\n  async function fetchBookmarks(firstLoad) {\n    if (firstLoad || !bookmarksIterator.current) {\n      bookmarksIterator.current = masto.v1.bookmarks\n        .list({ limit: LIMIT })\n        .values();\n    }\n    return await bookmarksIterator.current.next();\n  }\n\n  return (\n    <Timeline\n      title={t`Bookmarks`}\n      id=\"bookmarks\"\n      emptyText={t`No bookmarks yet. Go bookmark something!`}\n      errorText={t`Unable to load bookmarks.`}\n      instance={instance}\n      fetchItems={fetchBookmarks}\n    />\n  );\n}\n\nexport default Bookmarks;\n","export default \"__VITE_ASSET__BL_1JinT__\"","import '../components/links-bar.css';\nimport './catchup.css';\n\nimport autoAnimate from '@formkit/auto-animate';\nimport { msg, select } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { getBlurHashAverageColor } from 'fast-blurhash';\nimport { Fragment } from 'preact';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSearchParams } from 'react-router-dom';\nimport { uid } from 'uid/single';\n\nimport catchupUrl from '../assets/features/catch-up.png';\n\nimport Avatar from '../components/avatar';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Modal from '../components/modal';\nimport NameText from '../components/name-text';\nimport NavMenu from '../components/nav-menu';\nimport RelativeTime from '../components/relative-time';\nimport { api, getPreferences } from '../utils/api';\nimport { oklab2rgb, rgb2oklab } from '../utils/color-utils';\nimport db from '../utils/db';\nimport emojifyText from '../utils/emojify-text';\nimport { isFiltered } from '../utils/filters';\nimport getDomain from '../utils/get-domain';\nimport htmlContentLength from '../utils/html-content-length';\nimport mem from '../utils/mem';\nimport niceDateTime from '../utils/nice-date-time';\nimport { supportsNativeQuote } from '../utils/quote-utils';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { statusKey } from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport store from '../utils/store';\nimport { getCurrentAccountID, getCurrentAccountNS } from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport { assignFollowedTags } from '../utils/timeline-utils';\nimport useTitle from '../utils/useTitle';\n\nconst FILTER_CONTEXT = 'home';\nconst CATCHUP_NS = 'catchup';\n\nconst RANGES = [\n  { label: msg`last 1 hour`, value: 1 },\n  { label: msg`last 2 hours`, value: 2 },\n  { label: msg`last 3 hours`, value: 3 },\n  { label: msg`last 4 hours`, value: 4 },\n  { label: msg`last 5 hours`, value: 5 },\n  { label: msg`last 6 hours`, value: 6 },\n  { label: msg`last 7 hours`, value: 7 },\n  { label: msg`last 8 hours`, value: 8 },\n  { label: msg`last 9 hours`, value: 9 },\n  { label: msg`last 10 hours`, value: 10 },\n  { label: msg`last 11 hours`, value: 11 },\n  { label: msg`last 12 hours`, value: 12 },\n  { label: msg`beyond 12 hours`, value: 13 },\n];\n\nconst FILTER_KEYS = {\n  original: msg`Original`,\n  replies: msg`Replies`,\n  quotes: msg`Quotes`,\n  boosts: msg`Boosts`,\n  followedTags: msg`Followed tags`,\n  groups: msg`Groups`,\n  filtered: msg`Filtered`,\n};\nconst FILTER_SORTS = [\n  'createdAt',\n  'repliesCount',\n  'favouritesCount',\n  'reblogsCount',\n  // TODO: Add this later when there's enough usage\n  // Sorting by quotes count seems not useful yet?\n  // And we're combining it with boosts count, so that's even weirder\n  // 'quotesCount',\n  'density',\n];\nconst FILTER_GROUPS = [null, 'account'];\n\nconst DTF = mem(\n  (locale) =>\n    new Intl.DateTimeFormat(locale || undefined, {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n    }),\n);\n\nfunction hasQuote(quote) {\n  return quote?.id || quote?.quotedStatus?.id;\n}\n\nfunction Catchup() {\n  const { i18n, _, t } = useLingui();\n  const dtf = DTF(i18n.locale);\n\n  useTitle(`Catch-up`, '/catchup');\n  const { masto, instance } = api();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const id = searchParams.get('id');\n  const [uiState, setUIState] = useState('start');\n  const [showTopLinks, setShowTopLinks] = useState(false);\n\n  const currentAccount = useMemo(() => {\n    return getCurrentAccountID();\n  }, []);\n  const isSelf = (accountID) => accountID === currentAccount;\n\n  const supportsPixelfed = supports('@pixelfed/home-include-reblogs');\n\n  async function fetchHome({ maxCreatedAt }) {\n    console.debug('fetchHome', maxCreatedAt);\n    const allResults = [];\n    const homeIterable = masto.v1.timelines.home.list({ limit: 40 });\n    const homeIterator = homeIterable.values();\n    mainloop: while (true) {\n      try {\n        if (supportsPixelfed && homeIterable.params) {\n          if (typeof homeIterable.params === 'string') {\n            homeIterable.params += '&include_reblogs=true';\n          } else {\n            homeIterable.params.include_reblogs = true;\n          }\n        }\n        const results = await homeIterator.next();\n        const { value } = results;\n        if (value?.length) {\n          // This ignores maxCreatedAt filter, but it's ok for now\n          await assignFollowedTags(value, instance);\n          let addedResults = false;\n          for (let i = 0; i < value.length; i++) {\n            const item = value[i];\n            const createdAtTime = Date.parse(item.createdAt);\n            if (!maxCreatedAt || createdAtTime >= maxCreatedAt) {\n              // Filtered\n              const selfPost = isSelf(\n                item.reblog?.account?.id || item.account.id,\n              );\n              const filterInfo =\n                !selfPost &&\n                isFiltered(\n                  item.reblog?.filtered || item.filtered,\n                  FILTER_CONTEXT,\n                );\n              if (filterInfo?.action === 'hide') continue;\n              item._filtered = filterInfo;\n\n              // Followed tags\n              const sKey = statusKey(item.id, instance);\n              item._followedTags = states.statusFollowedTags[sKey]\n                ? [...states.statusFollowedTags[sKey]]\n                : [];\n\n              allResults.push(item);\n              addedResults = true;\n            } else {\n              // Don't immediately stop, still add the other items that might still be within range\n              // break mainloop;\n            }\n            // Only stop when ALL items are outside of range\n            if (!addedResults) {\n              break mainloop;\n            }\n          }\n        } else {\n          break mainloop;\n        }\n        // Pause 1s\n        await new Promise((resolve) => setTimeout(resolve, 1000));\n      } catch (e) {\n        console.error(e);\n        break mainloop;\n      }\n    }\n\n    // Post-process all results\n    // 1. Threadify - tag 1st-post in a thread\n    allResults.forEach((status) => {\n      if (status?.inReplyToId) {\n        const replyToStatus = allResults.find(\n          (s) => s.id === status.inReplyToId,\n        );\n        if (replyToStatus && !replyToStatus.inReplyToId) {\n          replyToStatus._thread = true;\n        }\n      }\n    });\n\n    return allResults;\n  }\n\n  const [posts, setPosts] = useState([]);\n  const catchupRangeRef = useRef();\n  const catchupLastRef = useRef();\n  const NS = useMemo(() => getCurrentAccountNS(), []);\n  const handleCatchupClick = useCallback(async ({ duration } = {}) => {\n    const now = Date.now();\n    const maxCreatedAt = duration ? now - duration : null;\n    setUIState('loading');\n    const results = await fetchHome({ maxCreatedAt });\n    // Namespaced by account ID\n    // Possible conflict if ID matches between different accounts from different instances\n    const catchupID = `${NS}-${uid()}`;\n    try {\n      await db.catchup.set(catchupID, {\n        id: catchupID,\n        posts: results,\n        count: results.length,\n        startAt: maxCreatedAt,\n        endAt: now,\n      });\n      setSearchParams({ id: catchupID });\n    } catch (e) {\n      console.error(e, results);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (id) {\n      (async () => {\n        const catchup = await db.catchup.get(id);\n        if (catchup) {\n          catchup.posts.sort((a, b) => (a.createdAt > b.createdAt ? 1 : -1));\n          setPosts(catchup.posts);\n          setUIState('results');\n        }\n      })();\n    } else if (uiState === 'results') {\n      setPosts([]);\n      setUIState('start');\n    }\n  }, [id]);\n\n  const [reloadCatchupsCount, reloadCatchups] = useReducer((c) => c + 1, 0);\n  const [lastCatchupEndAt, setLastCatchupEndAt] = useState(null);\n  const [prevCatchups, setPrevCatchups] = useState([]);\n\n  useEffect(() => {\n    const catchupIds = new Set(prevCatchups.map((pc) => pc.id));\n    for (let i = sessionStorage.length - 1; i >= 0; i--) {\n      const key = sessionStorage.key(i);\n      if (key?.startsWith(`${CATCHUP_NS}-`)) {\n        const catchupId = key.replace(`${CATCHUP_NS}-`, '');\n        if (!catchupIds.has(catchupId)) {\n          store.session.del(key);\n        }\n      }\n    }\n  }, [prevCatchups]);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const catchups = await db.catchup.keys();\n        if (catchups.length) {\n          const ns = getCurrentAccountNS();\n          const ownKeys = catchups.filter((key) => key.startsWith(`${ns}-`));\n          if (ownKeys.length) {\n            let ownCatchups = await db.catchup.getMany(ownKeys);\n            ownCatchups.sort((a, b) => b.endAt - a.endAt);\n\n            // Split to 1st 3 last catchups, and the rest\n            let lastCatchups = ownCatchups.slice(0, 3);\n            let restCatchups = ownCatchups.slice(3);\n\n            const trimmedCatchups = lastCatchups.map((c) => {\n              const { id, count, startAt, endAt } = c;\n              return {\n                id,\n                count,\n                startAt,\n                endAt,\n              };\n            });\n            setPrevCatchups(trimmedCatchups);\n            setLastCatchupEndAt(lastCatchups[0].endAt);\n\n            // GC time\n            ownCatchups = null;\n            lastCatchups = null;\n\n            queueMicrotask(() => {\n              if (restCatchups.length) {\n                // delete them\n                db.catchup\n                  .delMany(restCatchups.map((c) => c.id))\n                  .then(() => {\n                    // GC time\n                    restCatchups = null;\n                  })\n                  .catch((e) => {\n                    console.error(e);\n                  });\n              }\n            });\n\n            return;\n          }\n        }\n      } catch (e) {\n        console.error(e);\n      }\n      setPrevCatchups([]);\n    })();\n  }, [reloadCatchupsCount]);\n  useEffect(() => {\n    if (uiState === 'start') {\n      reloadCatchups();\n    }\n  }, [uiState === 'start']);\n\n  const [filterCounts, links] = useMemo(() => {\n    let filtered = 0,\n      groups = 0,\n      boosts = 0,\n      quotes = 0,\n      replies = 0,\n      followedTags = 0,\n      original = 0;\n    const links = {};\n    for (const post of posts) {\n      if (post._filtered && post._filtered?.action !== 'blur') {\n        filtered++;\n        post.__FILTER = 'filtered';\n      } else if (post.group) {\n        groups++;\n        post.__FILTER = 'groups';\n      } else if (post.reblog) {\n        boosts++;\n        post.__FILTER = 'boosts';\n      } else if (supportsNativeQuote() && hasQuote(post.quote)) {\n        quotes++;\n        post.__FILTER = 'quotes';\n      } else if (post._followedTags?.length) {\n        followedTags++;\n        post.__FILTER = 'followedTags';\n      } else if (\n        post.inReplyToId &&\n        post.inReplyToAccountId !== post.account?.id\n      ) {\n        replies++;\n        post.__FILTER = 'replies';\n      } else {\n        original++;\n        post.__FILTER = 'original';\n      }\n\n      const thePost = post.reblog || post;\n      if (\n        post.__FILTER !== 'filtered' &&\n        thePost.card?.url &&\n        thePost.card?.image &&\n        thePost.card?.type === 'link'\n      ) {\n        const { card, favouritesCount, reblogsCount } = thePost;\n        let { url } = card;\n        url = url.replace(/\\/$/, '');\n        if (!links[url]) {\n          links[url] = {\n            postID: thePost.id,\n            card,\n            shared: 1,\n            sharers: [post.account],\n            likes: favouritesCount,\n            boosts: reblogsCount,\n          };\n        } else {\n          if (links[url].sharers.find((a) => a.id === post.account.id)) {\n            continue;\n          }\n          links[url].shared++;\n          links[url].sharers.push(post.account);\n          if (links[url].postID !== thePost.id) {\n            links[url].likes += favouritesCount;\n            links[url].boosts += reblogsCount;\n          }\n        }\n      }\n    }\n\n    let topLinks = [];\n    for (const link in links) {\n      topLinks.push({\n        url: link,\n        ...links[link],\n      });\n    }\n    topLinks.sort((a, b) => {\n      if (a.shared > b.shared) return -1;\n      if (a.shared < b.shared) return 1;\n      if (a.boosts > b.boosts) return -1;\n      if (a.boosts < b.boosts) return 1;\n      if (a.likes > b.likes) return -1;\n      if (a.likes < b.likes) return 1;\n      if (a.quotes > b.quotes) return -1;\n      if (a.quotes < b.quotes) return 1;\n      return 0;\n    });\n\n    // Slice links to shared > 1 but min 10 links\n    if (topLinks.length > 10) {\n      linksLoop: for (let i = 10; i < topLinks.length; i++) {\n        const { shared } = topLinks[i];\n        if (shared <= 1) {\n          topLinks = topLinks.slice(0, i);\n          break linksLoop;\n        }\n      }\n    }\n\n    return [\n      {\n        filtered,\n        groups,\n        boosts,\n        quotes,\n        replies,\n        followedTags,\n        original,\n      },\n      topLinks,\n    ];\n  }, [posts]);\n\n  const [selectedFilterCategory, setSelectedFilterCategory] = useState('all');\n  const [selectedAuthor, setSelectedAuthor] = useState(null);\n\n  const [range, setRange] = useState(1);\n\n  const [sortBy, setSortBy] = useState('createdAt');\n  const [sortOrder, setSortOrder] = useState('asc');\n  const [groupBy, setGroupBy] = useState(null);\n\n  useEffect(() => {\n    if (!id) return;\n    const savedState = store.session.getJSON(`${CATCHUP_NS}-${id}`);\n    if (savedState) {\n      if (savedState.selectedFilterCategory !== undefined) {\n        setSelectedFilterCategory(savedState.selectedFilterCategory);\n      }\n      if (savedState.selectedAuthor !== undefined) {\n        setSelectedAuthor(savedState.selectedAuthor);\n      }\n      if (savedState.sortBy !== undefined) {\n        setSortBy(savedState.sortBy);\n      }\n      if (savedState.sortOrder !== undefined) {\n        setSortOrder(savedState.sortOrder);\n      }\n      if (savedState.groupBy !== undefined) {\n        setGroupBy(savedState.groupBy);\n      }\n      if (savedState.showTopLinks !== undefined) {\n        setShowTopLinks(savedState.showTopLinks);\n      }\n    }\n  }, [id]);\n\n  useEffect(() => {\n    if (!id || uiState !== 'results') return;\n    const state = {\n      selectedFilterCategory,\n      selectedAuthor,\n      sortBy,\n      sortOrder,\n      groupBy,\n      showTopLinks,\n    };\n    store.session.setJSON(`${CATCHUP_NS}-${id}`, state);\n  }, [\n    id,\n    uiState,\n    selectedFilterCategory,\n    selectedAuthor,\n    sortBy,\n    sortOrder,\n    groupBy,\n    showTopLinks,\n  ]);\n\n  const [filteredPosts, authors, authorCounts] = useMemo(() => {\n    const authorsHash = {};\n    const authorCountsMap = new Map();\n\n    let filteredPosts = posts.filter((post) => {\n      const postFilterMatches =\n        selectedFilterCategory === 'all' ||\n        post.__FILTER === selectedFilterCategory;\n\n      if (postFilterMatches) {\n        authorsHash[post.account.id] = post.account;\n        authorCountsMap.set(\n          post.account.id,\n          (authorCountsMap.get(post.account.id) || 0) + 1,\n        );\n      }\n\n      return postFilterMatches;\n    });\n\n    // Deduplicate boosts\n    const boostedPosts = {};\n    filteredPosts.forEach((post) => {\n      if (post.reblog) {\n        if (boostedPosts[post.reblog.id]) {\n          if (boostedPosts[post.reblog.id].__BOOSTERS) {\n            boostedPosts[post.reblog.id].__BOOSTERS.add(post.account);\n          } else {\n            boostedPosts[post.reblog.id].__BOOSTERS = new Set([post.account]);\n          }\n          post.__HIDDEN = true;\n        } else {\n          boostedPosts[post.reblog.id] = post;\n        }\n      }\n    });\n\n    if (selectedAuthor && authorCountsMap.has(selectedAuthor)) {\n      filteredPosts = filteredPosts.filter(\n        (post) =>\n          post.account.id === selectedAuthor ||\n          [...(post.__BOOSTERS || [])].find((a) => a.id === selectedAuthor),\n      );\n    }\n\n    return [filteredPosts, authorsHash, Object.fromEntries(authorCountsMap)];\n  }, [selectedFilterCategory, selectedAuthor, posts]);\n\n  const filteredPostsMap = useMemo(() => {\n    const map = {};\n    filteredPosts.forEach((post) => {\n      map[post.id] = post;\n    });\n    return map;\n  }, [filteredPosts]);\n\n  const authorCountsList = useMemo(\n    () =>\n      Object.keys(authorCounts).sort(\n        (a, b) => authorCounts[b] - authorCounts[a],\n      ),\n    [authorCounts],\n  );\n\n  const sortedFilteredPosts = useMemo(() => {\n    const authorIndices = {};\n    authorCountsList.forEach((authorID, index) => {\n      authorIndices[authorID] = index;\n    });\n    return filteredPosts\n      .filter((post) => !post.__HIDDEN)\n      .sort((a, b) => {\n        if (groupBy === 'account') {\n          const aAccountID = a.account.id;\n          const bAccountID = b.account.id;\n          const aIndex = authorIndices[aAccountID];\n          const bIndex = authorIndices[bAccountID];\n          const order = aIndex - bIndex;\n          if (order !== 0) {\n            return order;\n          }\n        }\n        if (sortBy !== 'createdAt') {\n          a = a.reblog || a;\n          b = b.reblog || b;\n          if (sortBy !== 'density' && a[sortBy] === b[sortBy]) {\n            return a.createdAt > b.createdAt ? 1 : -1;\n          }\n        }\n        if (sortBy === 'density') {\n          const aDensity = postDensity(a);\n          const bDensity = postDensity(b);\n          if (sortOrder === 'asc') {\n            return aDensity > bDensity ? 1 : -1;\n          } else {\n            return bDensity > aDensity ? 1 : -1;\n          }\n        }\n        if (sortOrder === 'asc') {\n          return a[sortBy] > b[sortBy] ? 1 : -1;\n        } else {\n          return b[sortBy] > a[sortBy] ? 1 : -1;\n        }\n      });\n  }, [filteredPosts, sortBy, sortOrder, groupBy, authorCountsList]);\n\n  const prevGroup = useRef(null);\n\n  const authorsListParent = useRef(null);\n  const autoAnimated = useRef(false);\n  useEffect(() => {\n    if (posts.length > 100 || autoAnimated.current) return;\n    if (authorsListParent.current) {\n      autoAnimate(authorsListParent.current, {\n        duration: 200,\n      });\n      autoAnimated.current = true;\n    }\n  }, [posts, authorsListParent]);\n\n  const postsBarType = posts.length > 160 ? '3d' : '2d';\n\n  const postsBar = useMemo(() => {\n    if (postsBarType !== '2d') return null;\n    return posts.map((post) => {\n      // If part of filteredPosts\n      const isFiltered = filteredPostsMap[post.id];\n      return (\n        <span\n          key={post.id}\n          class={`post-dot ${isFiltered ? 'post-dot-highlight' : ''}`}\n        />\n      );\n    });\n  }, [filteredPostsMap]);\n\n  const postsBins = useMemo(() => {\n    if (postsBarType !== '3d') return null;\n    if (!posts?.length) return null;\n    const bins = binByTime(posts, 'createdAt', 320);\n    return bins.map((posts, i) => {\n      return (\n        <div class=\"posts-bin\" key={i}>\n          {posts.map((post) => {\n            const isFiltered = filteredPostsMap[post.id];\n            return (\n              <span\n                key={post.id}\n                class={`post-dot ${isFiltered ? 'post-dot-highlight' : ''}`}\n              />\n            );\n          })}\n        </div>\n      );\n    });\n  }, [filteredPostsMap]);\n\n  const scrollableRef = useRef(null);\n\n  useLayoutEffect(() => {\n    if (!id || uiState !== 'results' || !scrollableRef.current) return;\n    if (!sortedFilteredPosts.length) return;\n\n    const savedState = store.session.getJSON(`${CATCHUP_NS}-${id}`);\n    if (savedState?.scrollTop !== undefined && savedState.scrollTop > 0) {\n      const timeoutId = setTimeout(() => {\n        if (scrollableRef.current) {\n          scrollableRef.current.scrollTo({\n            top: savedState.scrollTop,\n            behavior: 'instant',\n          });\n        }\n      }, 100);\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, [id, uiState, sortedFilteredPosts.length]);\n\n  useEffect(() => {\n    if (!id || uiState !== 'results' || !scrollableRef.current) return;\n\n    const handleScroll = () => {\n      if (!scrollableRef.current) return;\n      const savedState = store.session.getJSON(`${CATCHUP_NS}-${id}`) || {};\n      savedState.scrollTop = scrollableRef.current.scrollTop;\n      store.session.setJSON(`${CATCHUP_NS}-${id}`, savedState);\n    };\n\n    const scrollElement = scrollableRef.current;\n    scrollElement.addEventListener('scroll', handleScroll, { passive: true });\n\n    return () => {\n      scrollElement.removeEventListener('scroll', handleScroll);\n    };\n  }, [id, uiState]);\n\n  // if range value exceeded lastCatchupEndAt, show error\n  const lastCatchupRange = useMemo(() => {\n    // return hour, not ms\n    if (!lastCatchupEndAt) return null;\n    return (Date.now() - lastCatchupEndAt) / 1000 / 60 / 60;\n  }, [lastCatchupEndAt, range]);\n\n  useEffect(() => {\n    if (uiState !== 'results') return;\n    const authorUsername =\n      selectedAuthor && authors[selectedAuthor]\n        ? authors[selectedAuthor].username\n        : '';\n    const sortOrderIndex = sortOrder === 'asc' ? 0 : 1;\n    const groupByText = {\n      account: 'authors',\n    };\n    let toast = showToast({\n      duration: 5_000, // 5 seconds\n      // Note: I'm sorry, translators\n      text: t`Showing ${select(selectedFilterCategory, {\n        all: 'all posts',\n        original: 'original posts',\n        replies: 'replies',\n        boosts: 'boosts',\n        quotes: 'quotes',\n        followedTags: 'followed tags',\n        groups: 'groups',\n        filtered: 'filtered posts',\n      })}, ${select(sortBy, {\n        createdAt: select(sortOrder, {\n          asc: 'oldest',\n          desc: 'latest',\n        }),\n        reblogsCount: select(sortOrder, {\n          asc: 'fewest boosts',\n          desc: 'most boosts',\n        }),\n        favouritesCount: select(sortOrder, {\n          asc: 'fewest likes',\n          desc: 'most likes',\n        }),\n        repliesCount: select(sortOrder, {\n          asc: 'fewest replies',\n          desc: 'most replies',\n        }),\n        density: select(sortOrder, { asc: 'least dense', desc: 'most dense' }),\n      })} first${select(groupBy, {\n        account: ', grouped by authors',\n        other: '',\n      })}`,\n    });\n    return () => {\n      toast?.hideToast?.();\n    };\n  }, [\n    uiState,\n    selectedFilterCategory,\n    selectedAuthor,\n    sortBy,\n    sortOrder,\n    groupBy,\n    authors,\n  ]);\n\n  useEffect(() => {\n    if (selectedAuthor) {\n      if (authors[selectedAuthor]) {\n        // Check if author is visible and within the scrollable area viewport\n        const authorElement = authorsListParent.current.querySelector(\n          `[data-author=\"${selectedAuthor}\"]`,\n        );\n        const scrollableRect =\n          authorsListParent.current?.getBoundingClientRect();\n        const authorRect = authorElement?.getBoundingClientRect();\n        console.log({\n          sLeft: scrollableRect.left,\n          sRight: scrollableRect.right,\n          aLeft: authorRect.left,\n          aRight: authorRect.right,\n        });\n        if (\n          authorRect.left < scrollableRect.left ||\n          authorRect.right > scrollableRect.right\n        ) {\n          authorElement.scrollIntoView({\n            block: 'nearest',\n            inline: 'center',\n            behavior: 'smooth',\n          });\n        } else if (authorRect.top < 0) {\n          authorElement.scrollIntoView({\n            block: 'nearest',\n            inline: 'nearest',\n            behavior: 'smooth',\n          });\n        }\n      }\n    }\n  }, [selectedAuthor, authors]);\n\n  const [showHelp, setShowHelp] = useState(false);\n\n  const itemsSelector = '.catchup-list > li > a';\n  const jRef = useHotkeys(\n    'j',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        const nextItem = allItems[activeItemIndex + 1];\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView({\n            block: 'center',\n            inline: 'center',\n            behavior: 'smooth',\n          });\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView({\n            block: 'nearest',\n            inline: 'center',\n            behavior: 'smooth',\n          });\n        }\n      }\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView({\n            block: 'center',\n            inline: 'center',\n            behavior: 'smooth',\n          });\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView({\n            block: 'nearest',\n            inline: 'center',\n            behavior: 'smooth',\n          });\n        }\n      }\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const hlRef = useHotkeys(\n    'h, l',\n    (_, handler) => {\n      // Go next/prev selectedAuthor in authorCountsList list\n      const key = handler.keys[0];\n      if (selectedAuthor) {\n        const index = authorCountsList.indexOf(selectedAuthor);\n        if (key === 'h') {\n          if (index > 0 && index < authorCountsList.length) {\n            setSelectedAuthor(authorCountsList[index - 1]);\n            scrollableRef.current?.focus();\n          }\n        } else if (key === 'l') {\n          if (index < authorCountsList.length - 1 && index >= 0) {\n            setSelectedAuthor(authorCountsList[index + 1]);\n            scrollableRef.current?.focus();\n          }\n        }\n      } else if (key === 'l') {\n        setSelectedAuthor(authorCountsList[0]);\n        scrollableRef.current?.focus();\n      }\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n      enableOnFormTags: ['input'],\n    },\n  );\n\n  const escRef = useHotkeys(\n    'esc',\n    () => {\n      setSelectedAuthor(null);\n      scrollableRef.current?.focus();\n    },\n    {\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n      enableOnFormTags: ['input'],\n      useKey: true,\n    },\n  );\n\n  const dotRef = useHotkeys(\n    '.',\n    () => {\n      scrollableRef.current?.scrollTo({\n        top: 0,\n        behavior: 'smooth',\n      });\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n      enableOnFormTags: ['input'],\n    },\n  );\n\n  const handleArrowKeys = useCallback((e) => {\n    const activeElement = document.activeElement;\n    const isRadio =\n      activeElement?.tagName === 'INPUT' && activeElement.type === 'radio';\n    const isArrowKeys =\n      e.key === 'ArrowDown' ||\n      e.key === 'ArrowUp' ||\n      e.key === 'ArrowLeft' ||\n      e.key === 'ArrowRight';\n    if (isArrowKeys && isRadio) {\n      // Note: page scroll won't trigger on first arrow key press due to this. Subsequent presses will.\n      activeElement.blur();\n      return;\n    }\n  }, []);\n\n  return (\n    <div\n      ref={(node) => {\n        scrollableRef.current = node;\n        jRef.current = node;\n        kRef.current = node;\n        hlRef.current = node;\n        escRef.current = node;\n        dotRef.current = node;\n      }}\n      id=\"catchup-page\"\n      class=\"deck-container\"\n      tabIndex=\"-1\"\n    >\n      <div class=\"timeline-deck deck wide\">\n        <header\n          class={`${uiState === 'loading' ? 'loading' : ''}`}\n          onClick={(e) => {\n            if (!e.target.closest('a, button')) {\n              scrollableRef.current?.scrollTo({\n                top: 0,\n                behavior: 'smooth',\n              });\n            }\n          }}\n        >\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              {uiState === 'results' && (\n                <Link to=\"/catchup\" class=\"button plain\">\n                  <Icon icon=\"history2\" size=\"l\" alt={t`Catch-up`} />\n                </Link>\n              )}\n              {uiState === 'start' && (\n                <Link to=\"/\" class=\"button plain\">\n                  <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n                </Link>\n              )}\n            </div>\n            <h1>\n              {uiState !== 'start' && (\n                <Trans>\n                  Catch-up <sup>beta</sup>\n                </Trans>\n              )}\n            </h1>\n            <div class=\"header-side\">\n              {uiState !== 'start' && uiState !== 'loading' && (\n                <button\n                  type=\"button\"\n                  class=\"plain\"\n                  onClick={() => {\n                    setShowHelp(true);\n                  }}\n                >\n                  <Trans>Help</Trans>\n                </button>\n              )}\n            </div>\n          </div>\n        </header>\n        <main onKeyDown={handleArrowKeys}>\n          {uiState === 'start' && (\n            <div class=\"catchup-start\">\n              <h1>\n                <Trans>\n                  Catch-up <sup>beta</sup>\n                </Trans>\n              </h1>\n              <details>\n                <summary>\n                  <Trans>What is this?</Trans>\n                </summary>\n                <p>\n                  <Trans>\n                    Catch-up is a separate timeline for your followings,\n                    offering a high-level view at a glance, with a simple,\n                    email-inspired interface to effortlessly sort and filter\n                    through posts.\n                  </Trans>\n                </p>\n                <img\n                  src={catchupUrl}\n                  width=\"1200\"\n                  height=\"900\"\n                  alt={t`Preview of Catch-up UI`}\n                />\n                <p>\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.target.closest('details').open = false;\n                    }}\n                  >\n                    <Trans>Let's catch up</Trans>\n                  </button>\n                </p>\n              </details>\n              <p>\n                <Trans>Let's catch up on the posts from your followings.</Trans>\n              </p>\n              <p>\n                <b>\n                  <Trans>Show me all posts from</Trans>\n                </b>\n              </p>\n              <div class=\"catchup-form\">\n                <input\n                  ref={catchupRangeRef}\n                  type=\"range\"\n                  value={range}\n                  min={RANGES[0].value}\n                  max={RANGES[RANGES.length - 1].value}\n                  step=\"1\"\n                  list=\"catchup-ranges\"\n                  onChange={(e) => setRange(+e.target.value)}\n                />{' '}\n                <span\n                  style={{\n                    width: '8em',\n                  }}\n                >\n                  {_(RANGES[range - 1].label)}\n                  <br />\n                  <small class=\"insignificant\">\n                    {range == RANGES[RANGES.length - 1].value\n                      ? t`until the max`\n                      : niceDateTime(\n                          new Date(Date.now() - range * 60 * 60 * 1000),\n                        )}\n                  </small>\n                </span>\n                <datalist id=\"catchup-ranges\">\n                  {RANGES.map(({ label, value }) => (\n                    <option value={value} label={_(label)} />\n                  ))}\n                </datalist>{' '}\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    if (range < RANGES[RANGES.length - 1].value) {\n                      let duration;\n                      if (\n                        range === RANGES[RANGES.length - 1].value &&\n                        catchupLastRef.current?.checked\n                      ) {\n                        duration = Date.now() - lastCatchupEndAt;\n                      } else {\n                        duration = range * 60 * 60 * 1000;\n                      }\n                      handleCatchupClick({ duration });\n                    } else {\n                      handleCatchupClick();\n                    }\n                  }}\n                >\n                  <Trans>Catch up</Trans>\n                </button>\n              </div>\n              {lastCatchupRange && range > lastCatchupRange ? (\n                <p class=\"catchup-info\">\n                  <Icon icon=\"info\" />{' '}\n                  <Trans>Overlaps with your last catch-up</Trans>\n                </p>\n              ) : range === RANGES[RANGES.length - 1].value &&\n                lastCatchupEndAt ? (\n                <p class=\"catchup-info\">\n                  <label>\n                    <input\n                      type=\"checkbox\"\n                      switch\n                      checked\n                      ref={catchupLastRef}\n                    />{' '}\n                    <Trans>\n                      Until the last catch-up (\n                      {dtf.format(new Date(lastCatchupEndAt))})\n                    </Trans>\n                  </label>\n                </p>\n              ) : null}\n              <p class=\"insignificant\">\n                <small>\n                  <Trans>\n                    Note: your instance might only show a maximum of 800 posts\n                    in the Home timeline regardless of the time range. Could be\n                    less or more.\n                  </Trans>\n                </small>\n              </p>\n              {!!prevCatchups?.length && (\n                <div class=\"catchup-prev\">\n                  <p>\n                    <Trans>Previously</Trans>\n                  </p>\n                  <ul>\n                    {prevCatchups.map((pc) => (\n                      <li key={pc.id}>\n                        <Link to={`/catchup?id=${pc.id}`}>\n                          <Icon icon=\"history2\" />{' '}\n                          <span>\n                            {pc.startAt\n                              ? dtf.formatRange(\n                                  new Date(pc.startAt),\n                                  new Date(pc.endAt),\n                                )\n                              : `${dtf.format(new Date(pc.endAt))}`}\n                          </span>\n                        </Link>{' '}\n                        <span>\n                          <small class=\"ib insignificant\">\n                            <Plural\n                              value={pc.count}\n                              one=\"# post\"\n                              other=\"# posts\"\n                            />\n                          </small>{' '}\n                          <button\n                            type=\"button\"\n                            class=\"light danger small\"\n                            onClick={async () => {\n                              const yes = confirm(t`Remove this catch-up?`);\n                              if (yes) {\n                                let st = showToast(\n                                  t`Removing Catch-up ${pc.id}`,\n                                );\n                                await db.catchup.del(pc.id);\n                                st?.hideToast?.();\n                                showToast(t`Catch-up ${pc.id} removed`);\n                                reloadCatchups();\n                              }\n                            }}\n                          >\n                            <Icon icon=\"x\" alt={t`Remove`} />\n                          </button>\n                        </span>\n                      </li>\n                    ))}\n                  </ul>\n                  {prevCatchups.length >= 3 && (\n                    <p>\n                      <small>\n                        <Trans>\n                          Note: Only max 3 will be stored. The rest will be\n                          automatically removed.\n                        </Trans>\n                      </small>\n                    </p>\n                  )}\n                </div>\n              )}\n            </div>\n          )}\n          {uiState === 'loading' && (\n            <div class=\"ui-state catchup-start\">\n              <Loader abrupt />\n              <p class=\"insignificant\">\n                <Trans>Fetching posts</Trans>\n              </p>\n              <p class=\"insignificant\">\n                <Trans>This might take a while.</Trans>\n              </p>\n            </div>\n          )}\n          {uiState === 'results' && (\n            <>\n              <div class=\"catchup-header\">\n                {posts.length > 0 && (\n                  <p>\n                    <b class=\"ib\">\n                      {dtf.formatRange(\n                        new Date(posts[0].createdAt),\n                        new Date(posts[posts.length - 1].createdAt),\n                      )}\n                    </b>\n                  </p>\n                )}\n                <aside>\n                  <button\n                    hidden={\n                      selectedFilterCategory === 'all' &&\n                      !selectedAuthor &&\n                      sortBy === 'createdAt' &&\n                      sortOrder === 'asc'\n                    }\n                    type=\"button\"\n                    class=\"plain4 small\"\n                    onClick={() => {\n                      setSelectedFilterCategory('all');\n                      setSelectedAuthor(null);\n                      setSortBy('createdAt');\n                      setGroupBy(null);\n                      setSortOrder('asc');\n                    }}\n                  >\n                    <Trans>Reset filters</Trans>\n                  </button>\n                  {links?.length > 0 && (\n                    <button\n                      type=\"button\"\n                      class=\"plain small\"\n                      onClick={() => setShowTopLinks(!showTopLinks)}\n                    >\n                      <Trans>Top links</Trans>{' '}\n                      <Icon\n                        icon=\"chevron-down\"\n                        style={{\n                          transform: showTopLinks\n                            ? 'rotate(180deg)'\n                            : 'rotate(0deg)',\n                        }}\n                      />\n                    </button>\n                  )}\n                </aside>\n              </div>\n              <div class=\"shazam-container no-animation\" hidden={!showTopLinks}>\n                <div class=\"shazam-container-inner\">\n                  <div class=\"catchup-top-links links-bar\">\n                    {links.map((link) => {\n                      const { card, shared, sharers, likes, boosts } = link;\n                      const {\n                        blurhash,\n                        title,\n                        description,\n                        url,\n                        image,\n                        imageDescription,\n                        language,\n                        width,\n                        height,\n                        publishedAt,\n                      } = card;\n                      const domain = getDomain(url);\n                      let accentColor;\n                      if (blurhash) {\n                        const averageColor = getBlurHashAverageColor(blurhash);\n                        const labAverageColor = rgb2oklab(averageColor);\n                        accentColor = oklab2rgb([\n                          0.6,\n                          labAverageColor[1],\n                          labAverageColor[2],\n                        ]);\n                      }\n\n                      return (\n                        <a\n                          key={url}\n                          href={url}\n                          target=\"_blank\"\n                          rel=\"noopener\"\n                          class=\"link-block\"\n                          style={\n                            accentColor\n                              ? {\n                                  '--accent-color': `rgb(${accentColor.join(\n                                    ',',\n                                  )})`,\n                                  '--accent-alpha-color': `rgba(${accentColor.join(\n                                    ',',\n                                  )}, 0.4)`,\n                                }\n                              : {}\n                          }\n                        >\n                          <article>\n                            <figure>\n                              <img\n                                src={image}\n                                alt={imageDescription}\n                                width={width}\n                                height={height}\n                                loading=\"lazy\"\n                              />\n                            </figure>\n                            <div class=\"article-body\">\n                              <header>\n                                <div class=\"article-meta\">\n                                  <span class=\"domain\">{domain}</span>{' '}\n                                  {!!publishedAt && <>&middot; </>}\n                                  {!!publishedAt && (\n                                    <>\n                                      <RelativeTime\n                                        datetime={publishedAt}\n                                        format=\"micro\"\n                                      />\n                                    </>\n                                  )}\n                                </div>\n                                {!!title && (\n                                  <h1\n                                    class=\"title\"\n                                    lang={language}\n                                    dir=\"auto\"\n                                    title={title}\n                                  >\n                                    {title}\n                                  </h1>\n                                )}\n                              </header>\n                              {!!description && (\n                                <p\n                                  class=\"description\"\n                                  lang={language}\n                                  dir=\"auto\"\n                                  title={description}\n                                >\n                                  {description}\n                                </p>\n                              )}\n                              <hr />\n                              <p\n                                style={{\n                                  whiteSpace: 'nowrap',\n                                }}\n                              >\n                                <Trans>\n                                  Shared by{' '}\n                                  {sharers.map((s) => {\n                                    const { avatarStatic, displayName } = s;\n                                    return (\n                                      <button\n                                        type=\"button\"\n                                        class=\"plain\"\n                                        style={{\n                                          padding: 0,\n                                        }}\n                                        onClick={(e) => {\n                                          e.preventDefault();\n                                          e.stopPropagation();\n                                          // Reset and filter to author\n                                          const { id } = s;\n                                          setSelectedAuthor(id);\n                                          setSelectedFilterCategory('all');\n                                        }}\n                                      >\n                                        <Avatar\n                                          url={avatarStatic}\n                                          size=\"s\"\n                                          alt={displayName}\n                                        />\n                                      </button>\n                                    );\n                                  })}\n                                </Trans>\n                              </p>\n                            </div>\n                          </article>\n                        </a>\n                      );\n                    })}\n                  </div>\n                </div>\n              </div>\n              {posts.length >= 5 &&\n                (postsBarType === '3d' ? (\n                  <div class=\"catchup-posts-viz-time-bar\">{postsBins}</div>\n                ) : (\n                  <div class=\"catchup-posts-viz-bar\">{postsBar}</div>\n                ))}\n              {posts.length >= 2 && (\n                <div class=\"catchup-filters\">\n                  <label class=\"filter-cat\">\n                    <input\n                      type=\"radio\"\n                      name=\"filter-cat\"\n                      checked={selectedFilterCategory.toLowerCase() === 'all'}\n                      onChange={() => {\n                        setSelectedFilterCategory('all');\n                      }}\n                    />\n                    <Trans>All</Trans> <span class=\"count\">{posts.length}</span>\n                  </label>\n                  {Object.entries(FILTER_KEYS).map(\n                    ([key, label]) =>\n                      !!filterCounts[key] && (\n                        <label\n                          class=\"filter-cat\"\n                          key={_(label)}\n                          title={\n                            ((filterCounts[key] / posts.length) * 100).toFixed(\n                              2,\n                            ) + '%'\n                          }\n                        >\n                          <input\n                            type=\"radio\"\n                            name=\"filter-cat\"\n                            checked={\n                              selectedFilterCategory.toLowerCase() ===\n                              key.toLowerCase()\n                            }\n                            onChange={() => {\n                              setSelectedFilterCategory(key);\n                              if (key === 'boosts') {\n                                setSortBy('reblogsCount');\n                                setSortOrder('desc');\n                                setGroupBy(null);\n                              }\n                              // setSelectedAuthor(null);\n                            }}\n                          />\n                          {_(label)}{' '}\n                          <span class=\"count\">{filterCounts[key]}</span>\n                        </label>\n                      ),\n                  )}\n                </div>\n              )}\n              {posts.length >= 2 && !!authorCounts && (\n                <div\n                  class=\"catchup-filters authors-filters\"\n                  ref={authorsListParent}\n                >\n                  {authorCountsList.map((author) => (\n                    <label\n                      class=\"filter-author\"\n                      data-author={author}\n                      key={`${author}-${authorCounts[author]}`}\n                      // Preact messed up the order sometimes, need additional key besides just `author`\n                      // https://github.com/preactjs/preact/issues/2849\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"filter-author\"\n                        checked={selectedAuthor === author}\n                        onChange={() => {\n                          setSelectedAuthor(author);\n                          // setGroupBy(null);\n                        }}\n                        onClick={() => {\n                          if (selectedAuthor === author) {\n                            setSelectedAuthor(null);\n                          }\n                        }}\n                      />\n                      <Avatar\n                        url={\n                          authors[author].avatarStatic || authors[author].avatar\n                        }\n                        size=\"xxl\"\n                        alt={`${authors[author].displayName} (@${authors[author].acct})`}\n                      />{' '}\n                      <span class=\"count\">{authorCounts[author]}</span>\n                      <span class=\"username\">{authors[author].username}</span>\n                    </label>\n                  ))}\n                  {authorCountsList.length > 5 && (\n                    <small\n                      key=\"authors-count\"\n                      style={{\n                        whiteSpace: 'nowrap',\n                        paddingInline: '1em',\n                        opacity: 0.33,\n                      }}\n                    >\n                      <Plural\n                        value={authorCountsList.length}\n                        one=\"# author\"\n                        other=\"# authors\"\n                      />\n                    </small>\n                  )}\n                </div>\n              )}\n              {posts.length >= 2 && (\n                <div class=\"catchup-filters\">\n                  <span class=\"filter-label\">\n                    <Trans>Sort</Trans>\n                  </span>{' '}\n                  <fieldset class=\"radio-field-group\">\n                    {FILTER_SORTS.map((key) => (\n                      <label\n                        class=\"filter-sort\"\n                        key={key}\n                        onClick={(e) => {\n                          if (sortBy === key) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"radio\"\n                          name=\"filter-sort-cat\"\n                          checked={sortBy === key}\n                          onChange={() => {\n                            setSortBy(key);\n                            const order =\n                              /(replies|favourites|reblogs|quotes)/.test(key)\n                                ? 'desc'\n                                : 'asc';\n                            setSortOrder(order);\n                          }}\n                        />\n                        {\n                          {\n                            createdAt: t`Date`,\n                            repliesCount: t`Replies`,\n                            favouritesCount: t`Likes`,\n                            reblogsCount: t`Boosts`,\n                            quotesCount: t`Quotes`,\n                            density: t`Density`,\n                          }[key]\n                        }\n                        {sortBy === key && (sortOrder === 'asc' ? ' ' : ' ')}\n                      </label>\n                    ))}\n                  </fieldset>\n                  {/* <fieldset class=\"radio-field-group\">\n                    {['asc', 'desc'].map((key) => (\n                      <label class=\"filter-sort\" key={key}>\n                        <input\n                          type=\"radio\"\n                          name=\"filter-sort-dir\"\n                          checked={sortOrder === key}\n                          onChange={() => {\n                            setSortOrder(key);\n                          }}\n                        />\n                        {key === 'asc' ? '' : ''}\n                      </label>\n                    ))}\n                  </fieldset> */}\n                  <span class=\"filter-label\">\n                    <Trans id=\"group.filter\">Group</Trans>\n                  </span>{' '}\n                  <fieldset class=\"radio-field-group\">\n                    {FILTER_GROUPS.map((key) => (\n                      <label class=\"filter-group\" key={key || 'none'}>\n                        <input\n                          type=\"radio\"\n                          name=\"filter-group\"\n                          checked={groupBy === key}\n                          onChange={() => {\n                            setGroupBy(key);\n                          }}\n                          disabled={key === 'account' && selectedAuthor}\n                        />\n                        {{\n                          account: t`Authors`,\n                        }[key] || t`None`}\n                      </label>\n                    ))}\n                  </fieldset>\n                  {\n                    selectedAuthor && authorCountsList.length > 1 ? (\n                      <button\n                        type=\"button\"\n                        class=\"plain6 small\"\n                        onClick={() => {\n                          setSelectedAuthor(null);\n                        }}\n                        style={{\n                          whiteSpace: 'nowrap',\n                        }}\n                      >\n                        <Trans>Show all authors</Trans>\n                      </button>\n                    ) : null\n                    // <button\n                    //   type=\"button\"\n                    //   class=\"plain4 small\"\n                    //   onClick={() => {}}\n                    // >\n                    //   Group by authors\n                    // </button>\n                  }\n                </div>\n              )}\n              <ul\n                class={`catchup-list catchup-filter-${\n                  selectedFilterCategory || ''\n                } ${sortBy ? `catchup-sort-${sortBy}` : ''} ${\n                  selectedAuthor && authors[selectedAuthor]\n                    ? `catchup-selected-author`\n                    : ''\n                } ${groupBy ? `catchup-group-${groupBy}` : ''}`}\n              >\n                {sortedFilteredPosts.map((post, i) => {\n                  const id = post.reblog?.id || post.id;\n                  let showSeparator = false;\n                  if (groupBy === 'account') {\n                    if (\n                      prevGroup.current &&\n                      post.account.id !== prevGroup.current &&\n                      i > 0\n                    ) {\n                      showSeparator = true;\n                    }\n                    prevGroup.current = post.account.id;\n                  }\n                  return (\n                    <Fragment key={`${post.id}-${showSeparator}`}>\n                      {showSeparator && <li class=\"separator\" />}\n                      <IntersectionPostLineItem\n                        to={`/${instance}/s/${id}`}\n                        post={post}\n                        root={scrollableRef.current}\n                      />\n                    </Fragment>\n                  );\n                })}\n              </ul>\n              <footer>\n                {filteredPosts.length > 5 && (\n                  <p>\n                    {selectedFilterCategory === 'boosts'\n                      ? t`You don't have to read everything.`\n                      : t`That's all.`}{' '}\n                    <button\n                      type=\"button\"\n                      class=\"textual\"\n                      onClick={() => {\n                        scrollableRef.current.scrollTop = 0;\n                      }}\n                    >\n                      <Trans>Back to top</Trans>\n                    </button>\n                    .\n                  </p>\n                )}\n              </footer>\n            </>\n          )}\n        </main>\n      </div>\n      {showHelp && (\n        <Modal onClose={() => setShowHelp(false)}>\n          <div class=\"sheet\" id=\"catchup-help-sheet\">\n            <button\n              type=\"button\"\n              class=\"sheet-close\"\n              onClick={() => setShowHelp(false)}\n            >\n              <Icon icon=\"x\" alt={t`Close`} />\n            </button>\n            <header>\n              <h2>\n                <Trans>Help</Trans>\n              </h2>\n            </header>\n            <main>\n              <dl>\n                <dt>\n                  <Trans>Top links</Trans>\n                </dt>\n                <dd>\n                  <Trans>\n                    Links shared by followings, sorted by shared counts, boosts\n                    and likes.\n                  </Trans>\n                </dd>\n                <dt>\n                  <Trans>Sort: Density</Trans>\n                </dt>\n                <dd>\n                  <Trans>\n                    Posts are sorted by information density or depth. Shorter\n                    posts are \"lighter\" while longer posts are \"heavier\". Posts\n                    with photos are \"heavier\" than posts without photos.\n                  </Trans>\n                </dd>\n                <dt>\n                  <Trans>Group: Authors</Trans>\n                </dt>\n                <dd>\n                  <Trans>\n                    Posts are grouped by authors, sorted by posts count per\n                    author.\n                  </Trans>\n                </dd>\n                <dt>\n                  <Trans>Keyboard shortcuts</Trans>\n                </dt>\n                {/* <dd>\n                  <kbd>j</kbd>: <Trans>Next post</Trans>\n                </dd>\n                <dd>\n                  <kbd>k</kbd>: <Trans>Previous post</Trans>\n                </dd>\n                <dd>\n                  <kbd>l</kbd>: <Trans>Next author</Trans>\n                </dd>\n                <dd>\n                  <kbd>h</kbd>: <Trans>Previous author</Trans>\n                </dd>\n                <dd>\n                  <kbd>Enter</kbd>: <Trans>Open post details</Trans>\n                </dd>\n                <dd>\n                  <kbd>.</kbd>: <Trans>Scroll to top</Trans>\n                </dd> */}\n                <dd>\n                  <table>\n                    <tbody>\n                      <tr>\n                        <td>\n                          <Trans>Next post</Trans>\n                        </td>\n                        <td>\n                          <kbd>j</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Previous post</Trans>\n                        </td>\n                        <td>\n                          <kbd>k</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Next author</Trans>\n                        </td>\n                        <td>\n                          <kbd>l</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Previous author</Trans>\n                        </td>\n                        <td>\n                          <kbd>h</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Open post details</Trans>\n                        </td>\n                        <td>\n                          <kbd>Enter</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Scroll to top</Trans>\n                        </td>\n                        <td>\n                          <kbd>.</kbd>\n                        </td>\n                      </tr>\n                    </tbody>\n                  </table>\n                </dd>\n              </dl>\n            </main>\n          </div>\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nconst PostLine = memo(\n  function ({ post }) {\n    const {\n      id,\n      account,\n      group,\n      reblog,\n      quote,\n      inReplyToId,\n      inReplyToAccountId,\n      _followedTags: isFollowedTags,\n      _filtered: filterInfo,\n      visibility,\n      __BOOSTERS,\n    } = post;\n    const isReplyTo = inReplyToId && inReplyToAccountId !== account.id;\n    const isFiltered = !!filterInfo && filterInfo?.action !== 'blur';\n\n    const debugHover = (e) => {\n      if (e.shiftKey) {\n        console.log({\n          ...post,\n        });\n      }\n    };\n\n    return (\n      <article\n        class={`post-line ${\n          group\n            ? 'group'\n            : reblog\n              ? 'reblog'\n              : supportsNativeQuote() && hasQuote(quote)\n                ? 'quote'\n                : isFollowedTags?.length\n                  ? 'followed-tags'\n                  : ''\n        } ${isReplyTo ? 'reply-to' : ''} ${\n          isFiltered ? 'filtered' : ''\n        } visibility-${visibility}`}\n        onMouseEnter={debugHover}\n      >\n        <span class=\"post-author\">\n          {reblog ? (\n            <span class=\"post-reblog-avatar\">\n              <Avatar\n                url={account.avatarStatic || account.avatar}\n                squircle={account.bot}\n              />\n              {__BOOSTERS?.size > 0\n                ? [...__BOOSTERS].map((b) => (\n                    <Avatar url={b.avatarStatic || b.avatar} squircle={b.bot} />\n                  ))\n                : ''}{' '}\n              <Icon icon=\"rocket\" />{' '}\n              {/* <Avatar\n              url={reblog.account.avatarStatic || reblog.account.avatar}\n              squircle={reblog.account.bot}\n            /> */}\n              <NameText account={reblog.account} showAvatar />\n            </span>\n          ) : hasQuote(quote) ? (\n            <span class=\"post-quote-avatar\">\n              <Avatar\n                url={account.avatarStatic || account.avatar}\n                squircle={account.bot}\n              />{' '}\n              <Icon icon=\"quote\" />{' '}\n              <NameText\n                account={quote.quotedStatus?.account || quote.account}\n                showAvatar\n              />\n            </span>\n          ) : (\n            <NameText account={account} showAvatar />\n          )}\n        </span>\n        <PostPeek post={reblog || post} filterInfo={filterInfo} />\n        <span class=\"post-meta\">\n          <PostStats post={reblog || post} />{' '}\n          <RelativeTime\n            datetime={new Date(reblog?.createdAt || post.createdAt)}\n            format=\"micro\"\n          />\n        </span>\n      </article>\n    );\n  },\n  (oldProps, newProps) => {\n    return oldProps?.post?.id === newProps?.post?.id;\n  },\n);\n\nconst IntersectionPostLineItem = ({ root, to, ...props }) => {\n  const ref = useRef();\n  const [show, setShow] = useState(false);\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        const entry = entries[0];\n        if (entry.isIntersecting) {\n          queueMicrotask(() => setShow(true));\n          observer.unobserve(ref.current);\n        }\n      },\n      {\n        root,\n        rootMargin: `${Math.max(320, screen.height * 0.75)}px`,\n      },\n    );\n    if (ref.current) observer.observe(ref.current);\n    return () => {\n      if (ref.current) observer.unobserve(ref.current);\n    };\n  }, []);\n\n  return show ? (\n    <li>\n      <Link to={to}>\n        <PostLine {...props} />\n      </Link>\n    </li>\n  ) : (\n    <li ref={ref} style={{ height: '4em' }} />\n  );\n};\n\n// A media speak a thousand words\nconst MEDIA_DENSITY = 8;\nconst CARD_DENSITY = 8;\nfunction postDensity(post) {\n  const { spoilerText, content, poll, mediaAttachments, card } = post;\n  const pollContent = poll?.options?.length\n    ? poll.options.reduce((acc, cur) => acc + cur.title, '')\n    : '';\n  const density =\n    (spoilerText.length + htmlContentLength(content) + pollContent.length) /\n      140 +\n    (mediaAttachments?.length\n      ? MEDIA_DENSITY * mediaAttachments.length\n      : card?.image\n        ? CARD_DENSITY\n        : 0);\n  return density;\n}\n\nconst MEDIA_SIZE = 48;\n\nfunction PostPeek({ post, filterInfo }) {\n  const { t } = useLingui();\n  let {\n    spoilerText,\n    sensitive,\n    content,\n    emojis,\n    poll,\n    mediaAttachments,\n    card,\n    inReplyToId,\n    inReplyToAccountId,\n    account,\n    _thread,\n    quote,\n  } = post;\n  const isThread =\n    (inReplyToId && inReplyToAccountId === account.id) || !!_thread;\n  let theQuote =\n    supportsNativeQuote() && hasQuote(quote)\n      ? quote.quotedStatus || quote\n      : null;\n  if (theQuote?.spoilerText || theQuote?.sensitive) theQuote = null;\n  if (theQuote?.emojis) emojis.push(...theQuote.emojis);\n  if (!mediaAttachments?.length && theQuote?.mediaAttachments?.length) {\n    mediaAttachments = theQuote.mediaAttachments;\n  }\n\n  const prefs = getPreferences();\n  const readingExpandSpoilers = !!prefs['reading:expand:spoilers'];\n  // const readingExpandSpoilers = true;\n  const showMedia =\n    readingExpandSpoilers ||\n    (!spoilerText && !sensitive && filterInfo?.action !== 'blur');\n  const postText = content ? statusPeek(post) : '';\n\n  const showPostContent = !spoilerText || readingExpandSpoilers;\n\n  return (\n    <div class=\"post-peek\" title={!spoilerText ? postText : ''}>\n      <span class=\"post-peek-content\">\n        {isThread && !showPostContent && (\n          <>\n            <span class=\"post-peek-tag post-peek-thread\">Thread</span>{' '}\n          </>\n        )}\n        {!!filterInfo && filterInfo?.action !== 'blur' ? (\n          <span class=\"post-peek-filtered\">\n            {/* Filtered{filterInfo?.titlesStr ? `: ${filterInfo.titlesStr}` : ''} */}\n            {filterInfo?.titlesStr\n              ? t`Filtered: ${filterInfo.titlesStr}`\n              : t`Filtered`}\n          </span>\n        ) : (\n          <>\n            {!!spoilerText && (\n              <span class=\"post-peek-spoiler\">\n                <Icon\n                  icon={`${readingExpandSpoilers ? 'eye-open' : 'eye-close'}`}\n                />{' '}\n                {spoilerText}\n              </span>\n            )}\n            {showPostContent && (\n              <div class=\"post-peek-html\">\n                {isThread && (\n                  <>\n                    <span class=\"post-peek-tag post-peek-thread\">\n                      <Trans>Thread</Trans>\n                    </span>{' '}\n                  </>\n                )}\n                {!!content && (\n                  <div\n                    dangerouslySetInnerHTML={{\n                      __html:\n                        emojifyText(content, emojis) +\n                        (!!theQuote?.content\n                          ? `<blockquote class=\"post-peek-quote\">${theQuote.content}</blockquote>`\n                          : ''),\n                    }}\n                  />\n                )}\n                {!!poll?.options?.length &&\n                  poll.options.map((o) => (\n                    <div>\n                      {poll.multiple ? '' : ''} {o.title}\n                    </div>\n                  ))}\n                {!content &&\n                  mediaAttachments?.length === 1 &&\n                  mediaAttachments[0].description && (\n                    <>\n                      <span class=\"post-peek-tag post-peek-alt\">ALT</span>{' '}\n                      <div>{mediaAttachments[0].description}</div>\n                    </>\n                  )}\n              </div>\n            )}\n          </>\n        )}\n      </span>\n      {(!filterInfo || filterInfo?.action === 'blur') && (\n        <span class=\"post-peek-post-content\">\n          {!!poll && (\n            <span class=\"post-peek-tag post-peek-poll\">\n              <Icon icon=\"poll\" size=\"s\" />\n              <Trans>Poll</Trans>\n            </span>\n          )}\n          {!!mediaAttachments?.length\n            ? mediaAttachments.map((m) => {\n                const mediaURL = m.previewUrl || m.url;\n                const remoteMediaURL = m.previewRemoteUrl || m.remoteUrl;\n                const width = m.meta?.original\n                  ? m.meta.original.width\n                  : m.meta?.small?.width || m.meta?.original?.width;\n                const height = m.meta?.original\n                  ? m.meta.original.height\n                  : m.meta?.small?.height || m.meta?.original?.height;\n                return (\n                  <span key={m.id} class=\"post-peek-media\">\n                    {{\n                      image:\n                        (mediaURL || remoteMediaURL) && showMedia ? (\n                          <img\n                            src={mediaURL}\n                            width={MEDIA_SIZE}\n                            height={MEDIA_SIZE}\n                            alt={m.description}\n                            loading=\"lazy\"\n                            onError={(e) => {\n                              const { src } = e.target;\n                              if (\n                                src === mediaURL &&\n                                remoteMediaURL &&\n                                mediaURL !== remoteMediaURL\n                              ) {\n                                e.target.src = remoteMediaURL;\n                              }\n                            }}\n                            style={{\n                              '--anim-duration': `${Math.min(\n                                Math.max(Math.max(width, height) / 100, 5),\n                                120,\n                              )}s`,\n                            }}\n                          />\n                        ) : (\n                          <span class=\"post-peek-faux-media\"></span>\n                        ),\n                      gifv:\n                        (mediaURL || remoteMediaURL) && showMedia ? (\n                          <img\n                            src={mediaURL}\n                            width={MEDIA_SIZE}\n                            height={MEDIA_SIZE}\n                            alt={m.description}\n                            loading=\"lazy\"\n                            onError={(e) => {\n                              const { src } = e.target;\n                              if (\n                                src === mediaURL &&\n                                remoteMediaURL &&\n                                mediaURL !== remoteMediaURL\n                              ) {\n                                e.target.src = remoteMediaURL;\n                              }\n                            }}\n                          />\n                        ) : (\n                          <span class=\"post-peek-faux-media\"></span>\n                        ),\n                      video:\n                        (mediaURL || remoteMediaURL) && showMedia ? (\n                          <img\n                            src={mediaURL}\n                            width={MEDIA_SIZE}\n                            height={MEDIA_SIZE}\n                            alt={m.description}\n                            loading=\"lazy\"\n                            onError={(e) => {\n                              const { src } = e.target;\n                              if (\n                                src === mediaURL &&\n                                remoteMediaURL &&\n                                mediaURL !== remoteMediaURL\n                              ) {\n                                e.target.src = remoteMediaURL;\n                              }\n                            }}\n                          />\n                        ) : (\n                          <span class=\"post-peek-faux-media\"></span>\n                        ),\n                      audio: <span class=\"post-peek-faux-media\"></span>,\n                    }[m.type] || null}\n                  </span>\n                );\n              })\n            : !!card &&\n              card.image &&\n              showMedia && (\n                <span\n                  class={`post-peek-media post-peek-card card-${\n                    card.type || ''\n                  }`}\n                >\n                  {card.image ? (\n                    <img\n                      src={card.image}\n                      width={MEDIA_SIZE}\n                      height={MEDIA_SIZE}\n                      alt={\n                        card.title || card.description || card.imageDescription\n                      }\n                      loading=\"lazy\"\n                      style={{\n                        '--anim-duration':\n                          card.width &&\n                          card.height &&\n                          `${Math.min(\n                            Math.max(\n                              Math.max(card.width, card.height) / 100,\n                              5,\n                            ),\n                            120,\n                          )}s`,\n                      }}\n                    />\n                  ) : (\n                    <span class=\"post-peek-faux-media\"></span>\n                  )}\n                </span>\n              )}\n        </span>\n      )}\n    </div>\n  );\n}\n\nfunction PostStats({ post }) {\n  const { t } = useLingui();\n  const { reblogsCount, repliesCount, favouritesCount, quotesCount } = post;\n  return (\n    <span class=\"post-stats\">\n      {repliesCount > 0 && (\n        <span class=\"post-stat-replies\">\n          <Icon icon=\"comment2\" size=\"s\" alt={t`Replies`} />{' '}\n          {shortenNumber(repliesCount)}\n        </span>\n      )}\n      {favouritesCount > 0 && (\n        <span class=\"post-stat-likes\">\n          <Icon icon=\"heart\" size=\"s\" alt={t`Likes`} />{' '}\n          {shortenNumber(favouritesCount)}\n        </span>\n      )}\n      {reblogsCount > 0 || quotesCount > 0 ? (\n        <span class=\"post-stat-boosts\">\n          <Icon icon=\"rocket\" size=\"s\" alt={t`Boosts`} />{' '}\n          {reblogsCount > 0 || quotesCount > 0\n            ? `${reblogsCount > 0 ? shortenNumber(reblogsCount) : ''}${\n                reblogsCount > 0 && quotesCount > 0 ? '+' : ''\n              }${quotesCount > 0 ? shortenNumber(quotesCount) : ''}`\n            : shortenNumber(reblogsCount)}\n        </span>\n      ) : null}\n    </span>\n  );\n}\n\nfunction binByTime(data, key, numBins) {\n  // Extract dates from data objects\n  const dates = data.map((item) => new Date(item[key]));\n\n  // Find minimum and maximum dates directly (avoiding Math.min/max)\n  const minDate = dates.reduce(\n    (acc, date) => (date < acc ? date : acc),\n    dates[0],\n  );\n  const maxDate = dates.reduce(\n    (acc, date) => (date > acc ? date : acc),\n    dates[0],\n  );\n\n  // Calculate the time span in milliseconds\n  const range = Math.min(maxDate.getTime(), Date.now()) - minDate.getTime();\n\n  // Create empty bins and loop through data\n  const bins = Array.from({ length: numBins }, () => []);\n  data.forEach((item) => {\n    const dateTime = Date.parse(item[key]);\n    if (dateTime > Date.now()) {\n      // Future dates go into the last bin\n      bins[bins.length - 1].push(item);\n    } else {\n      const normalized = (dateTime - minDate.getTime()) / range;\n      const binIndex = Math.floor(normalized * (numBins - 1));\n      bins[binIndex].push(item);\n    }\n  });\n\n  return bins;\n}\n\nexport default Catchup;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useRef } from 'preact/hooks';\n\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Favourites() {\n  const { t } = useLingui();\n  useTitle(t`Likes`, '/favourites');\n  const { masto, instance } = api();\n  const favouritesIterator = useRef();\n  async function fetchFavourites(firstLoad) {\n    if (firstLoad || !favouritesIterator.current) {\n      favouritesIterator.current = masto.v1.favourites\n        .list({ limit: LIMIT })\n        .values();\n    }\n    return await favouritesIterator.current.next();\n  }\n\n  return (\n    <Timeline\n      title={t`Likes`}\n      id=\"favourites\"\n      emptyText={t`No likes yet. Go like something!`}\n      errorText={t`Unable to load likes.`}\n      instance={instance}\n      fetchItems={fetchFavourites}\n    />\n  );\n}\n\nexport default Favourites;\n","import './filters.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useReducer, useRef, useState } from 'preact/hooks';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport MenuConfirm from '../components/menu-confirm';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport RelativeTime from '../components/relative-time';\nimport { api } from '../utils/api';\nimport i18nDuration from '../utils/i18n-duration';\nimport { getAPIVersions } from '../utils/store-utils';\nimport useInterval from '../utils/useInterval';\nimport useTitle from '../utils/useTitle';\n\nconst FILTER_CONTEXT = ['home', 'public', 'notifications', 'thread', 'account'];\nconst FILTER_CONTEXT_UNIMPLEMENTED = ['thread', 'account'];\nconst FILTER_CONTEXT_LABELS = {\n  home: msg`Home and lists`,\n  notifications: msg`Notifications`,\n  public: msg`Public timelines`,\n  thread: msg`Conversations`,\n  account: msg`Profiles`,\n};\n\nconst EXPIRY_DURATIONS = [\n  0, // forever\n  30 * 60, // 30 minutes\n  60 * 60, // 1 hour\n  6 * 60 * 60, // 6 hours\n  12 * 60 * 60, // 12 hours\n  60 * 60 * 24, // 24 hours\n  60 * 60 * 24 * 7, // 7 days\n  60 * 60 * 24 * 30, // 30 days\n];\n\nconst EXPIRY_DURATIONS_LABELS = {\n  0: msg`Never`,\n  1800: i18nDuration(30, 'minute'),\n  3600: i18nDuration(1, 'hour'),\n  21600: i18nDuration(6, 'hour'),\n  43200: i18nDuration(12, 'hour'),\n  86_400: i18nDuration(24, 'hour'),\n  604_800: i18nDuration(7, 'day'),\n  2_592_000: i18nDuration(30, 'day'),\n};\n\nfunction Filters() {\n  const { t } = useLingui();\n  const { masto } = api();\n  useTitle(t`Filters`, `/ft`);\n  const [uiState, setUIState] = useState('default');\n  const [showFiltersAddEditModal, setShowFiltersAddEditModal] = useState(false);\n\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n  const [filters, setFilters] = useState([]);\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const filters = await masto.v2.filters.list();\n        filters.sort((a, b) => a.title.localeCompare(b.title));\n        filters.forEach((filter) => {\n          if (filter.keywords?.length) {\n            filter.keywords.sort((a, b) => a.id - b.id);\n          }\n        });\n        console.log(filters);\n        setFilters(filters);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  return (\n    <div id=\"filters-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Filters</Trans>\n            </h1>\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain\"\n                onClick={() => {\n                  setShowFiltersAddEditModal(true);\n                }}\n              >\n                <Icon icon=\"plus\" size=\"l\" alt={t`New filter`} />\n              </button>\n            </div>\n          </div>\n        </header>\n        <main>\n          {filters.length > 0 ? (\n            <>\n              <ul class=\"filters-list\">\n                {filters.map((filter) => {\n                  const { id, title, expiresAt, keywords } = filter;\n                  return (\n                    <li key={id}>\n                      <div>\n                        <h2>{title}</h2>\n                        {keywords?.length > 0 && (\n                          <div>\n                            {keywords.map((k) => (\n                              <>\n                                <span class=\"tag collapsed insignificant\">\n                                  {k.wholeWord ? `${k.keyword}` : k.keyword}\n                                </span>{' '}\n                              </>\n                            ))}\n                          </div>\n                        )}\n                        <small class=\"insignificant\">\n                          <ExpiryStatus expiresAt={expiresAt} />\n                        </small>\n                      </div>\n                      <button\n                        type=\"button\"\n                        class=\"plain\"\n                        onClick={() => {\n                          setShowFiltersAddEditModal({\n                            filter,\n                          });\n                        }}\n                      >\n                        <Icon icon=\"pencil\" size=\"l\" alt=\"Edit filter\" />\n                      </button>\n                    </li>\n                  );\n                })}\n              </ul>\n              {filters.length > 1 && (\n                <footer class=\"ui-state\">\n                  <small class=\"insignificant\">\n                    <Plural\n                      value={filters.length}\n                      one=\"# filter\"\n                      other=\"# filters\"\n                    />\n                  </small>\n                </footer>\n              )}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader />\n            </p>\n          ) : uiState === 'error' ? (\n            <p class=\"ui-state\">\n              <Trans>Unable to load filters.</Trans>\n            </p>\n          ) : (\n            <p class=\"ui-state\">\n              <Trans>No filters yet.</Trans>\n            </p>\n          )}\n        </main>\n      </div>\n      {!!showFiltersAddEditModal && (\n        <Modal\n          title={t`Add filter`}\n          onClose={() => {\n            setShowFiltersAddEditModal(false);\n          }}\n        >\n          <FiltersAddEdit\n            filter={showFiltersAddEditModal?.filter}\n            onClose={(result) => {\n              if (result.state === 'success') {\n                reload();\n              }\n              setShowFiltersAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nlet _id = 1;\nconst incID = () => _id++;\nfunction FiltersAddEdit({ filter, onClose }) {\n  const { _, t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const editMode = !!filter;\n  const { context, expiresAt, id, keywords, title, filterAction } =\n    filter || {};\n  const hasExpiry = !!expiresAt;\n  const expiresAtDate = hasExpiry && new Date(expiresAt);\n  const [editKeywords, setEditKeywords] = useState(keywords || []);\n  const keywordsRef = useRef();\n\n  // Hacky way of handling removed keywords for both existing and new ones\n  const [removedKeywordIDs, setRemovedKeywordIDs] = useState([]);\n  const [removedKeyword_IDs, setRemovedKeyword_IDs] = useState([]);\n\n  const filteredEditKeywords = editKeywords.filter(\n    (k) =>\n      !removedKeywordIDs.includes(k.id) && !removedKeyword_IDs.includes(k._id),\n  );\n\n  return (\n    <div class=\"sheet\" id=\"filters-add-edit-modal\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>{editMode ? t`Edit filter` : t`New filter`}</h2>\n      </header>\n      <main>\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n            const formData = new FormData(e.target);\n            const title = formData.get('title');\n            const keywordIDs = formData.getAll('keyword_attributes[][id]');\n            const keywordKeywords = formData.getAll(\n              'keyword_attributes[][keyword]',\n            );\n            // const keywordWholeWords = formData.getAll(\n            //   'keyword_attributes[][whole_word]',\n            // );\n            // Not using getAll because it skips the empty checkboxes\n            const keywordWholeWords = [\n              ...keywordsRef.current.querySelectorAll(\n                'input[name=\"keyword_attributes[][whole_word]\"]',\n              ),\n            ].map((i) => i.checked);\n            const keywordsAttributes = keywordKeywords.map((k, i) => ({\n              id: keywordIDs[i] || undefined,\n              keyword: k,\n              wholeWord: keywordWholeWords[i],\n            }));\n            // if (editMode && keywords?.length) {\n            //   // Find which one got deleted and add to keywordsAttributes\n            //   keywords.forEach((k) => {\n            //     if (!keywordsAttributes.find((ka) => ka.id === k.id)) {\n            //       keywordsAttributes.push({\n            //         ...k,\n            //         _destroy: true,\n            //       });\n            //     }\n            //   });\n            // }\n            if (editMode && removedKeywordIDs?.length) {\n              removedKeywordIDs.forEach((id) => {\n                keywordsAttributes.push({\n                  id,\n                  _destroy: true,\n                });\n              });\n            }\n            const context = formData.getAll('context');\n            let expiresIn = formData.get('expires_in');\n            const filterAction = formData.get('filter_action');\n            console.log({\n              title,\n              keywordIDs,\n              keywords: keywordKeywords,\n              wholeWords: keywordWholeWords,\n              keywordsAttributes,\n              context,\n              expiresIn,\n              filterAction,\n            });\n\n            // Required fields\n            if (!title || !context?.length) {\n              return;\n            }\n\n            setUIState('loading');\n\n            (async () => {\n              try {\n                let filterResult;\n\n                if (editMode) {\n                  if (expiresIn === '' || expiresIn === null) {\n                    // No value\n                    // Preserve existing expiry if not specified\n                    // Seconds from now to expiresAtDate\n                    // Other clients don't do this\n                    if (hasExpiry) {\n                      expiresIn = Math.floor(\n                        (expiresAtDate - Date.now()) / 1000,\n                      );\n                    } else {\n                      expiresIn = null;\n                    }\n                  } else if (expiresIn === '0' || expiresIn === 0) {\n                    // 0 = Never\n                    expiresIn = null;\n                  } else {\n                    expiresIn = +expiresIn;\n                  }\n                  filterResult = await masto.v2.filters.$select(id).update({\n                    title,\n                    context,\n                    expiresIn,\n                    keywordsAttributes,\n                    filterAction,\n                  });\n                } else {\n                  expiresIn = +expiresIn || null;\n                  filterResult = await masto.v2.filters.create({\n                    title,\n                    context,\n                    expiresIn,\n                    keywordsAttributes,\n                    filterAction,\n                  });\n                }\n                console.log({ filterResult });\n                setUIState('default');\n                onClose?.({\n                  state: 'success',\n                  filter: filterResult,\n                });\n              } catch (error) {\n                console.error(error);\n                setUIState('error');\n                alert(\n                  editMode\n                    ? t`Unable to edit filter`\n                    : t`Unable to create filter`,\n                );\n              }\n            })();\n          }}\n        >\n          <div class=\"filter-form-row\">\n            <label>\n              <b>\n                <Trans>Title</Trans>\n              </b>\n              <input\n                type=\"text\"\n                name=\"title\"\n                defaultValue={title}\n                disabled={uiState === 'loading'}\n                dir=\"auto\"\n                enterKeyHint=\"done\"\n                required\n              />\n            </label>\n          </div>\n          <div class=\"filter-form-keywords\" ref={keywordsRef}>\n            {filteredEditKeywords.length ? (\n              <ul class=\"filter-keywords\">\n                {filteredEditKeywords.map((k) => {\n                  const { id, keyword, wholeWord, _id } = k;\n                  return (\n                    <li key={`${id}-${_id}`}>\n                      <input\n                        type=\"hidden\"\n                        name=\"keyword_attributes[][id]\"\n                        value={id}\n                      />\n                      <input\n                        name=\"keyword_attributes[][keyword]\"\n                        type=\"text\"\n                        defaultValue={keyword}\n                        disabled={uiState === 'loading'}\n                        required\n                        dir=\"auto\"\n                        enterKeyHint=\"done\"\n                      />\n                      <div class=\"filter-keyword-actions\">\n                        <label>\n                          <input\n                            name=\"keyword_attributes[][whole_word]\"\n                            type=\"checkbox\"\n                            value={id} // Hacky way to map checkbox boolean to the keyword id\n                            defaultChecked={wholeWord}\n                            disabled={uiState === 'loading'}\n                          />{' '}\n                          <Trans>Whole word</Trans>\n                        </label>\n                        <button\n                          type=\"button\"\n                          class=\"light danger small\"\n                          disabled={uiState === 'loading'}\n                          onClick={() => {\n                            if (id) {\n                              removedKeywordIDs.push(id);\n                              setRemovedKeywordIDs([...removedKeywordIDs]);\n                            } else if (_id) {\n                              removedKeyword_IDs.push(_id);\n                              setRemovedKeyword_IDs([...removedKeyword_IDs]);\n                            }\n                          }}\n                        >\n                          <Icon icon=\"x\" alt={t`Remove`} />\n                        </button>\n                      </div>\n                    </li>\n                  );\n                })}\n              </ul>\n            ) : (\n              <div class=\"filter-keywords\">\n                <div class=\"insignificant\">\n                  <Trans>No keywords. Add one.</Trans>\n                </div>\n              </div>\n            )}\n            <footer class=\"filter-keywords-footer\">\n              <button\n                type=\"button\"\n                class=\"light\"\n                onClick={() => {\n                  setEditKeywords([\n                    ...editKeywords,\n                    {\n                      _id: incID(),\n                      keyword: '',\n                      wholeWord: true,\n                    },\n                  ]);\n                  setTimeout(() => {\n                    // Focus last input\n                    const fields =\n                      keywordsRef.current.querySelectorAll(\n                        'input[type=\"text\"]',\n                      );\n                    fields[fields.length - 1]?.focus?.();\n                  }, 10);\n                }}\n              >\n                <Trans>Add keyword</Trans>\n              </button>{' '}\n              {filteredEditKeywords?.length > 1 && (\n                <small class=\"insignificant\">\n                  <Plural\n                    value={filteredEditKeywords.length}\n                    one=\"# keyword\"\n                    other=\"# keywords\"\n                  />\n                </small>\n              )}\n            </footer>\n          </div>\n          <div class=\"filter-form-cols\">\n            <div class=\"filter-form-col\">\n              <div>\n                <b>\n                  <Trans>Filter from</Trans>\n                </b>\n              </div>\n              {FILTER_CONTEXT.map((ctx) => (\n                <div>\n                  <label\n                    class={\n                      FILTER_CONTEXT_UNIMPLEMENTED.includes(ctx)\n                        ? 'insignificant'\n                        : ''\n                    }\n                  >\n                    <input\n                      type=\"checkbox\"\n                      name=\"context\"\n                      value={ctx}\n                      defaultChecked={!!context ? context.includes(ctx) : true}\n                      disabled={uiState === 'loading'}\n                    />{' '}\n                    {_(FILTER_CONTEXT_LABELS[ctx])}\n                    {FILTER_CONTEXT_UNIMPLEMENTED.includes(ctx) ? '*' : ''}\n                  </label>{' '}\n                </div>\n              ))}\n              <p>\n                <small class=\"insignificant\">\n                  <Trans>* Not implemented yet</Trans>\n                </small>\n              </p>\n            </div>\n            <div class=\"filter-form-col\">\n              {editMode && (\n                <Trans>\n                  Status:{' '}\n                  <b>\n                    <ExpiryStatus expiresAt={expiresAt} showNeverExpires />\n                  </b>\n                </Trans>\n              )}\n              <div>\n                <label for=\"filters-expires_in\">\n                  {editMode ? t`Change expiry` : t`Expiry`}\n                </label>\n                <select\n                  id=\"filters-expires_in\"\n                  name=\"expires_in\"\n                  disabled={uiState === 'loading'}\n                  defaultValue={editMode ? undefined : 0}\n                >\n                  {editMode && <option></option>}\n                  {EXPIRY_DURATIONS.map((v) => (\n                    <option value={v}>\n                      {typeof EXPIRY_DURATIONS_LABELS[v] === 'function'\n                        ? EXPIRY_DURATIONS_LABELS[v]()\n                        : _(EXPIRY_DURATIONS_LABELS[v])}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <p>\n                <Trans>Filtered post will be</Trans>\n                <br />\n                {getAPIVersions()?.mastodon >= 5 && (\n                  <label class=\"ib\">\n                    <input\n                      type=\"radio\"\n                      name=\"filter_action\"\n                      value=\"blur\"\n                      defaultChecked={filterAction === 'blur'}\n                      disabled={uiState === 'loading'}\n                    />{' '}\n                    <Trans>obscured (media only)</Trans>\n                  </label>\n                )}{' '}\n                <label class=\"ib\">\n                  <input\n                    type=\"radio\"\n                    name=\"filter_action\"\n                    value=\"warn\"\n                    defaultChecked={\n                      (filterAction !== 'hide' && filterAction !== 'blur') ||\n                      !editMode\n                    }\n                    disabled={uiState === 'loading'}\n                  />{' '}\n                  <Trans>minimized</Trans>\n                </label>{' '}\n                <label class=\"ib\">\n                  <input\n                    type=\"radio\"\n                    name=\"filter_action\"\n                    value=\"hide\"\n                    defaultChecked={filterAction === 'hide'}\n                    disabled={uiState === 'loading'}\n                  />{' '}\n                  <Trans>hidden</Trans>\n                </label>\n              </p>\n            </div>\n          </div>\n          <footer class=\"filter-form-footer\">\n            <span>\n              <button type=\"submit\" disabled={uiState === 'loading'}>\n                {editMode ? t`Save` : t`Create`}\n              </button>{' '}\n              <Loader abrupt hidden={uiState !== 'loading'} />\n            </span>\n            {editMode && (\n              <MenuConfirm\n                disabled={uiState === 'loading'}\n                align=\"end\"\n                menuItemClassName=\"danger\"\n                confirmLabel={t`Delete this filter?`}\n                onClick={() => {\n                  setUIState('loading');\n                  (async () => {\n                    try {\n                      await masto.v2.filters.$select(id).remove();\n                      setUIState('default');\n                      onClose?.({\n                        state: 'success',\n                      });\n                    } catch (e) {\n                      console.error(e);\n                      setUIState('error');\n                      alert(t`Unable to delete filter.`);\n                    }\n                  })();\n                }}\n              >\n                <button\n                  type=\"button\"\n                  class=\"light danger\"\n                  onClick={() => {}}\n                  disabled={uiState === 'loading'}\n                >\n                  <Trans>Delete</Trans>\n                </button>\n              </MenuConfirm>\n            )}\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nfunction ExpiryStatus({ expiresAt, showNeverExpires }) {\n  const { t } = useLingui();\n  const hasExpiry = !!expiresAt;\n  const expiresAtDate = hasExpiry && new Date(expiresAt);\n  const expired = hasExpiry && Date.parse(expiresAt) <= Date.now();\n\n  // If less than a minute left, re-render interval every second, else every minute\n  const [_, rerender] = useReducer((c) => c + 1, 0);\n  useInterval(rerender, expired || 30_000);\n\n  return expired ? (\n    t`Expired`\n  ) : hasExpiry ? (\n    <Trans>\n      Expiring <RelativeTime datetime={expiresAtDate} />\n    </Trans>\n  ) : (\n    showNeverExpires && t`Never expires`\n  );\n}\n\nexport default Filters;\n","import { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useState } from 'preact/hooks';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport NavMenu from '../components/nav-menu';\nimport { api } from '../utils/api';\nimport { fetchFollowedTags } from '../utils/followed-tags';\nimport useTitle from '../utils/useTitle';\n\nfunction FollowedHashtags() {\n  const { t } = useLingui();\n  const { masto, instance } = api();\n  useTitle(t`Followed Hashtags`, `/fh`);\n  const [uiState, setUIState] = useState('default');\n\n  const [followedHashtags, setFollowedHashtags] = useState([]);\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const tags = await fetchFollowedTags();\n        setFollowedHashtags(tags);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  return (\n    <div id=\"followed-hashtags-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Followed Hashtags</Trans>\n            </h1>\n            <div class=\"header-side\" />\n          </div>\n        </header>\n        <main>\n          {followedHashtags.length > 0 ? (\n            <>\n              <ul class=\"link-list\">\n                {followedHashtags.map((tag) => (\n                  <li>\n                    <Link\n                      to={\n                        instance\n                          ? `/${instance}/t/${tag.name}`\n                          : `/t/${tag.name}`\n                      }\n                    >\n                      <Icon icon=\"hashtag\" alt=\"#\" /> <span>{tag.name}</span>\n                    </Link>\n                  </li>\n                ))}\n              </ul>\n              {followedHashtags.length > 1 && (\n                <footer class=\"ui-state\">\n                  <small class=\"insignificant\">\n                    <Plural\n                      value={followedHashtags.length}\n                      one=\"# hashtag\"\n                      other=\"# hashtags\"\n                    />\n                  </small>\n                </footer>\n              )}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader abrupt />\n            </p>\n          ) : uiState === 'error' ? (\n            <p class=\"ui-state\">\n              <Trans>Unable to load followed hashtags.</Trans>\n            </p>\n          ) : (\n            <p class=\"ui-state\">\n              <Trans>No hashtags followed yet.</Trans>\n            </p>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}\n\nexport default FollowedHashtags;\n","import { useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport states, { getStatus, saveStatus } from '../utils/states';\nimport supports from '../utils/supports';\nimport {\n  assignFollowedTags,\n  clearFollowedTagsState,\n  dedupeBoosts,\n} from '../utils/timeline-utils';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Following({ title, path, id, ...props }) {\n  const { t } = useLingui();\n  useTitle(\n    title ||\n      t({\n        id: 'following.title',\n        message: 'Following',\n      }),\n    path || '/following',\n  );\n  const { masto, streaming, instance, client } = api();\n  const [streamingClient, setStreamingClient] = useState(streaming);\n\n  const snapStates = useSnapshot(states);\n  const homeIterable = useRef();\n  const homeIterator = useRef();\n  const latestItem = useRef();\n\n  // Streaming only happens after instance is initialized\n  useEffect(() => {\n    if (!streaming && client?.onStreamingReady) {\n      client.onStreamingReady((streamingClient) => {\n        setStreamingClient(streamingClient);\n      });\n    }\n  }, [client]);\n  __BENCHMARK.end('time-to-following');\n\n  console.debug('RENDER Following', title, id);\n  const supportsPixelfed = supports('@pixelfed/home-include-reblogs');\n\n  async function fetchHome(firstLoad) {\n    if (firstLoad || !homeIterator.current) {\n      __BENCHMARK.start('fetch-home-first');\n      homeIterable.current = masto.v1.timelines.home.list({ limit: LIMIT });\n      homeIterator.current = homeIterable.current.values();\n    }\n    if (supportsPixelfed && homeIterable.current?.params) {\n      if (typeof homeIterable.current.params === 'string') {\n        homeIterable.current.params += '&include_reblogs=true';\n      } else {\n        homeIterable.current.params.include_reblogs = true;\n      }\n    }\n    const results = await homeIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      let latestItemChanged = false;\n      if (firstLoad) {\n        if (value[0].id !== latestItem.current) {\n          latestItemChanged = true;\n        }\n        latestItem.current = value[0].id;\n        console.log('First load', latestItem.current);\n      }\n\n      // value = filteredItems(value, 'home');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n      value = dedupeBoosts(value, instance);\n      if (firstLoad && latestItemChanged) clearFollowedTagsState();\n      setTimeout(() => {\n        assignFollowedTags(value, instance);\n      }, 100);\n\n      // ENFORCE sort by datetime (Latest first)\n      value.sort((a, b) => {\n        return Date.parse(b.createdAt) - Date.parse(a.createdAt);\n      });\n    }\n    __BENCHMARK.end('fetch-home-first');\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const opts = {\n        limit: 5,\n        since_id: latestItem.current,\n      };\n      if (supports('@pixelfed/home-include-reblogs')) {\n        opts.include_reblogs = true;\n      }\n      const results = await masto.v1.timelines.home.list(opts).values().next();\n      let { value } = results;\n      console.log('checkForUpdates', latestItem.current, value);\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        latestItem.current = value[0].id;\n        value = dedupeBoosts(value, instance);\n        value = filteredItems(value, 'home');\n        if (value.some((item) => !item.reblog)) {\n          return true;\n        }\n      }\n      return false;\n    } catch (e) {\n      console.error(e);\n      return false;\n    }\n  }\n\n  useEffect(() => {\n    let sub;\n    (async () => {\n      if (streamingClient) {\n        sub = streamingClient.user.subscribe();\n        console.log(' Streaming user', sub);\n        for await (const entry of sub) {\n          if (!sub) break;\n          if (entry.event === 'status.update') {\n            const status = entry.payload;\n            console.log(` Status ${status.id} updated`);\n            saveStatus(status, instance);\n          } else if (entry.event === 'delete') {\n            const statusID = entry.payload;\n            console.log(` Status ${statusID} deleted`);\n            // delete states.statuses[statusID];\n            const s = getStatus(statusID, instance);\n            if (s) s._deleted = true;\n          }\n        }\n        console.log(' Streaming user loop STOPPED');\n      }\n    })();\n    return () => {\n      sub?.unsubscribe?.();\n      sub = null;\n    };\n  }, [streamingClient]);\n\n  return (\n    <Timeline\n      title={title || t({ id: 'following.title', message: 'Following' })}\n      id={id || 'following'}\n      emptyText={t`Nothing to see here.`}\n      errorText={t`Unable to load posts.`}\n      instance={instance}\n      fetchItems={fetchHome}\n      checkForUpdates={checkForUpdates}\n      useItemID\n      boostsCarousel={snapStates.settings.boostsCarousel}\n      {...props}\n      // allowFilters\n      filterContext=\"home\"\n      showFollowedTags\n      showReplyParent\n    />\n  );\n}\n\nexport default Following;\n","import { plural } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport {\n  FocusableItem,\n  MenuDivider,\n  MenuGroup,\n  MenuHeader,\n  MenuItem,\n} from '@szhsin/react-menu';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useNavigate, useParams, useSearchParams } from 'react-router-dom';\n\nimport Icon from '../components/icon';\nimport MenuConfirm from '../components/menu-confirm';\nimport Menu2 from '../components/menu2';\nimport { SHORTCUTS_LIMIT } from '../components/shortcuts-settings';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport { isMediaFirstInstance } from '../utils/store-utils';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\n// Limit is 4 per \"mode\"\n// https://github.com/mastodon/mastodon/issues/15194\n// Hard-coded https://github.com/mastodon/mastodon/blob/19614ba2477f3d12468f5ec251ce1cc5f8c6210c/app/models/tag_feed.rb#L4\nconst TAGS_LIMIT_PER_MODE = 4;\nconst TOTAL_TAGS_LIMIT = TAGS_LIMIT_PER_MODE + 1;\n\nfunction Hashtags({ media: mediaView, columnMode, ...props }) {\n  const { t } = useLingui();\n  // const navigate = useNavigate();\n  let { hashtag, ...params } = columnMode ? {} : useParams();\n  if (props.hashtag) hashtag = props.hashtag;\n  let hashtags = hashtag.trim().split(/[\\s+]+/);\n  hashtags.sort();\n  hashtag = hashtags[0];\n  const [searchParams, setSearchParams] = useSearchParams();\n  const media = mediaView || !!searchParams.get('media');\n  const linkParams = media ? '?media=1' : '';\n\n  const { masto, instance, authenticated } = api({\n    instance: props?.instance || params.instance,\n  });\n  const {\n    masto: currentMasto,\n    instance: currentInstance,\n    authenticated: currentAuthenticated,\n  } = api();\n  const hashtagTitle = hashtags.map((t) => `#${t}`).join(' ');\n  const title = instance\n    ? media\n      ? t`${hashtagTitle} (Media only) on ${instance}`\n      : t`${hashtagTitle} on ${instance}`\n    : media\n      ? t`${hashtagTitle} (Media only)`\n      : t`${hashtagTitle}`;\n  useTitle(title, `/:instance?/t/:hashtag`);\n  const latestItem = useRef();\n\n  const mediaFirst = useMemo(() => isMediaFirstInstance(), []);\n\n  // const hashtagsIterator = useRef();\n  const maxID = useRef(undefined);\n  async function fetchHashtags(firstLoad) {\n    // if (firstLoad || !hashtagsIterator.current) {\n    //   hashtagsIterator.current = masto.v1.timelines.tag.$select(hashtag).list({\n    //     limit: LIMIT,\n    //     any: hashtags.slice(1),\n    //   }).values();\n    // }\n    // const results = await hashtagsIterator.current.next();\n\n    // NOTE: Temporary fix for listHashtag not persisting `any` in subsequent calls.\n    const results = await masto.v1.timelines.tag\n      .$select(hashtag)\n      .list({\n        limit: LIMIT,\n        any: hashtags.slice(1),\n        maxId: firstLoad ? undefined : maxID.current,\n        onlyMedia: media ? true : undefined,\n      })\n      .values()\n      .next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'public');\n      value.forEach((item) => {\n        saveStatus(item, instance, {\n          skipThreading: media || mediaFirst, // If media view, no need to form threads\n        });\n      });\n\n      maxID.current = value[value.length - 1].id;\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.timelines.tag\n        .$select(hashtag)\n        .list({\n          limit: 1,\n          any: hashtags.slice(1),\n          since_id: latestItem.current,\n          onlyMedia: media,\n        })\n        .values()\n        .next();\n      let { value } = results;\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        value = filteredItems(value, 'public');\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  const [followUIState, setFollowUIState] = useState('default');\n  const [info, setInfo] = useState();\n  // Get hashtag info\n  useEffect(() => {\n    (async () => {\n      try {\n        const info = await masto.v1.tags.$select(hashtag).fetch();\n        console.log(info);\n        setInfo(info);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [hashtag]);\n\n  const reachLimit = hashtags.length >= TOTAL_TAGS_LIMIT;\n\n  const [featuredUIState, setFeaturedUIState] = useState('default');\n  const [featuredTags, setFeaturedTags] = useState([]);\n  const [isFeaturedTag, setIsFeaturedTag] = useState(false);\n  useEffect(() => {\n    if (!authenticated) return;\n    (async () => {\n      try {\n        const featuredTags = await masto.v1.featuredTags.list();\n        setFeaturedTags(featuredTags);\n        setIsFeaturedTag(\n          featuredTags.some(\n            (tag) => tag.name.toLowerCase() === hashtag.toLowerCase(),\n          ),\n        );\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  return (\n    <>\n      <Timeline\n        key={instance + hashtagTitle}\n        title={title}\n        titleComponent={\n          !!instance && (\n            <h1 class=\"header-double-lines\">\n              <b dir=\"auto\">{hashtagTitle}</b>\n              <div>{instance}</div>\n            </h1>\n          )\n        }\n        id=\"hashtag\"\n        instance={instance}\n        emptyText={t`No one has posted anything with this tag yet.`}\n        errorText={t`Unable to load posts with this tag`}\n        fetchItems={fetchHashtags}\n        checkForUpdates={checkForUpdates}\n        useItemID\n        view={media || mediaFirst ? 'media' : undefined}\n        refresh={media}\n        // allowFilters\n        filterContext=\"public\"\n        headerEnd={\n          <Menu2\n            portal\n            setDownOverflow\n            overflow=\"auto\"\n            // viewScroll=\"close\"\n            position=\"anchor\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n          >\n            {!!info && hashtags.length === 1 && (\n              <>\n                <MenuConfirm\n                  subMenu\n                  confirm={info.following}\n                  confirmLabel={t`Unfollow #${hashtag}?`}\n                  disabled={followUIState === 'loading' || !authenticated}\n                  onClick={() => {\n                    setFollowUIState('loading');\n                    if (info.following) {\n                      // const yes = confirm(`Unfollow #${hashtag}?`);\n                      // if (!yes) {\n                      //   setFollowUIState('default');\n                      //   return;\n                      // }\n                      masto.v1.tags\n                        .$select(hashtag)\n                        .unfollow()\n                        .then(() => {\n                          setInfo({ ...info, following: false });\n                          showToast(t`Unfollowed #${hashtag}`);\n                        })\n                        .catch((e) => {\n                          alert(e);\n                          console.error(e);\n                        })\n                        .finally(() => {\n                          setFollowUIState('default');\n                        });\n                    } else {\n                      masto.v1.tags\n                        .$select(hashtag)\n                        .follow()\n                        .then(() => {\n                          setInfo({ ...info, following: true });\n                          showToast(t`Followed #${hashtag}`);\n                        })\n                        .catch((e) => {\n                          alert(e);\n                          console.error(e);\n                        })\n                        .finally(() => {\n                          setFollowUIState('default');\n                        });\n                    }\n                  }}\n                >\n                  {info.following ? (\n                    <>\n                      <Icon icon=\"check-circle\" />{' '}\n                      <span>\n                        <Trans>Following</Trans>\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <Icon icon=\"plus\" />{' '}\n                      <span>\n                        <Trans>Follow</Trans>\n                      </span>\n                    </>\n                  )}\n                </MenuConfirm>\n                <MenuItem\n                  type=\"checkbox\"\n                  checked={isFeaturedTag}\n                  disabled={featuredUIState === 'loading' || !authenticated}\n                  onClick={() => {\n                    setFeaturedUIState('loading');\n                    if (isFeaturedTag) {\n                      const featuredTagID = featuredTags.find(\n                        (tag) =>\n                          tag.name.toLowerCase() === hashtag.toLowerCase(),\n                      ).id;\n                      if (featuredTagID) {\n                        masto.v1.featuredTags\n                          .$select(featuredTagID)\n                          .remove()\n                          .then(() => {\n                            setIsFeaturedTag(false);\n                            showToast(t`Unfeatured on profile`);\n                            setFeaturedTags(\n                              featuredTags.filter(\n                                (tag) => tag.id !== featuredTagID,\n                              ),\n                            );\n                          })\n                          .catch((e) => {\n                            console.error(e);\n                          })\n                          .finally(() => {\n                            setFeaturedUIState('default');\n                          });\n                      } else {\n                        showToast(t`Unable to unfeature on profile`);\n                      }\n                    } else {\n                      masto.v1.featuredTags\n                        .create({\n                          name: hashtag,\n                        })\n                        .then((value) => {\n                          setIsFeaturedTag(true);\n                          showToast(t`Featured on profile`);\n                          setFeaturedTags(featuredTags.concat(value));\n                        })\n                        .catch((e) => {\n                          console.error(e);\n                        })\n                        .finally(() => {\n                          setFeaturedUIState('default');\n                        });\n                    }\n                  }}\n                >\n                  {isFeaturedTag ? (\n                    <>\n                      <Icon icon=\"check-circle\" />\n                      <span>\n                        <Trans>Featured on profile</Trans>\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <Icon icon=\"check-circle\" />\n                      <span>\n                        <Trans>Feature on profile</Trans>\n                      </span>\n                    </>\n                  )}\n                </MenuItem>\n                <MenuDivider />\n              </>\n            )}\n            {!mediaFirst && (\n              <>\n                <MenuHeader className=\"plain\">\n                  <Trans>Filters</Trans>\n                </MenuHeader>\n                <MenuItem\n                  type=\"checkbox\"\n                  checked={!!media}\n                  onClick={() => {\n                    if (media) {\n                      searchParams.delete('media');\n                    } else {\n                      searchParams.set('media', '1');\n                    }\n                    setSearchParams(searchParams);\n                  }}\n                >\n                  <Icon icon=\"check-circle\" alt=\"\" />{' '}\n                  <span class=\"menu-grow\">\n                    <Trans>Media only</Trans>\n                  </span>\n                </MenuItem>\n                <MenuDivider />\n              </>\n            )}\n            <FocusableItem className=\"menu-field\" disabled={reachLimit}>\n              {({ ref }) => (\n                <form\n                  onSubmit={(e) => {\n                    e.preventDefault();\n                    const newHashtag = e.target[0].value?.trim?.();\n                    // Use includes but need to be case insensitive\n                    if (\n                      newHashtag &&\n                      !hashtags.some(\n                        (t) => t.toLowerCase() === newHashtag.toLowerCase(),\n                      )\n                    ) {\n                      hashtags.push(newHashtag);\n                      hashtags.sort();\n                      // navigate(\n                      //   instance\n                      //     ? `/${instance}/t/${hashtags.join('+')}`\n                      //     : `/t/${hashtags.join('+')}`,\n                      // );\n                      location.hash = instance\n                        ? `/${instance}/t/${hashtags.join('+')}${linkParams}`\n                        : `/t/${hashtags.join('+')}${linkParams}`;\n                    }\n                  }}\n                >\n                  <Icon icon=\"hashtag\" />\n                  <input\n                    ref={ref}\n                    type=\"text\"\n                    placeholder={\n                      reachLimit\n                        ? plural(TOTAL_TAGS_LIMIT, {\n                            other: 'Max # tags',\n                          })\n                        : t`Add hashtag`\n                    }\n                    required\n                    autocorrect=\"off\"\n                    autocapitalize=\"off\"\n                    spellCheck={false}\n                    // no spaces, no hashtags\n                    pattern=\"[^#][^\\s#]+[^#]\"\n                    disabled={reachLimit}\n                    dir=\"auto\"\n                    enterKeyHint=\"go\"\n                  />\n                </form>\n              )}\n            </FocusableItem>\n            <MenuGroup takeOverflow>\n              {hashtags.map((tag, i) => (\n                <MenuItem\n                  key={tag}\n                  disabled={hashtags.length === 1}\n                  onClick={(e) => {\n                    hashtags.splice(i, 1);\n                    hashtags.sort();\n                    // navigate(\n                    //   instance\n                    //     ? `/${instance}/t/${hashtags.join('+')}`\n                    //     : `/t/${hashtags.join('+')}`,\n                    // );\n                    location.hash = instance\n                      ? `/${instance}/t/${hashtags.join('+')}${linkParams}`\n                      : `/t/${hashtags.join('+')}${linkParams}`;\n                  }}\n                >\n                  <Icon icon=\"x\" alt={t`Remove hashtag`} class=\"danger-icon\" />\n                  <span class=\"bidi-isolate\">\n                    <span class=\"more-insignificant\">#</span>\n                    {tag}\n                  </span>\n                </MenuItem>\n              ))}\n            </MenuGroup>\n            <MenuDivider />\n            <MenuItem\n              disabled={!currentAuthenticated}\n              onClick={() => {\n                if (states.shortcuts.length >= SHORTCUTS_LIMIT) {\n                  alert(\n                    plural(SHORTCUTS_LIMIT, {\n                      one: 'Max # shortcut reached. Unable to add shortcut.',\n                      other: 'Max # shortcuts reached. Unable to add shortcut.',\n                    }),\n                  );\n                  return;\n                }\n                const shortcut = {\n                  type: 'hashtag',\n                  hashtag: hashtags.join(' '),\n                  instance,\n                  media: media ? 'on' : undefined,\n                };\n                // Check if already exists\n                const exists = states.shortcuts.some(\n                  (s) =>\n                    s.type === shortcut.type &&\n                    s.hashtag\n                      .split(/[\\s+]+/)\n                      .sort()\n                      .join(' ') ===\n                      shortcut.hashtag\n                        .split(/[\\s+]+/)\n                        .sort()\n                        .join(' ') &&\n                    (s.instance ? s.instance === shortcut.instance : true) &&\n                    (s.media ? !!s.media === !!shortcut.media : true),\n                );\n                if (exists) {\n                  alert(t`This shortcut already exists`);\n                } else {\n                  states.shortcuts.push(shortcut);\n                  showToast(t`Hashtag shortcut added`);\n                }\n              }}\n            >\n              <Icon icon=\"shortcut\" />{' '}\n              <span>\n                <Trans>Add to Shortcuts</Trans>\n              </span>\n            </MenuItem>\n            <MenuItem\n              onClick={() => {\n                let newInstance = prompt(\n                  t`Enter a new instance e.g. \"mastodon.social\"`,\n                );\n                if (!/\\./.test(newInstance)) {\n                  if (newInstance) alert(t`Invalid instance`);\n                  return;\n                }\n                if (newInstance) {\n                  newInstance = newInstance.toLowerCase().trim();\n                  // navigate(`/${newInstance}/t/${hashtags.join('+')}`);\n                  location.hash = `/${newInstance}/t/${hashtags.join(\n                    '+',\n                  )}${linkParams}`;\n                }\n              }}\n            >\n              <Icon icon=\"bus\" />{' '}\n              <span>\n                <Trans>Go to another instance</Trans>\n              </span>\n            </MenuItem>\n            {currentInstance !== instance && (\n              <MenuItem\n                onClick={() => {\n                  location.hash = `/${currentInstance}/t/${hashtags.join(\n                    '+',\n                  )}${linkParams}`;\n                }}\n              >\n                <Icon icon=\"bus\" />{' '}\n                <small class=\"menu-double-lines\">\n                  <Trans>\n                    Go to my instance (<b>{currentInstance}</b>)\n                  </Trans>\n                </small>\n              </MenuItem>\n            )}\n          </Menu2>\n        }\n      />\n      {!columnMode && !!hashtags?.length && (\n        <data\n          class=\"compose-data\"\n          value={JSON.stringify({\n            draftStatus: {\n              status: `${hashtags.length > 1 ? '\\n\\n' : ' '}${hashtagTitle}`,\n            },\n          })}\n        />\n      )}\n    </>\n  );\n}\n\nexport default Hashtags;\n","import './lists.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { Menu, MenuDivider, MenuHeader, MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { InView } from 'react-intersection-observer';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport AccountBlock from '../components/account-block';\nimport Icon from '../components/icon';\nimport ListAddEdit from '../components/list-add-edit';\nimport ListExclusiveBadge from '../components/list-exclusive-badge';\nimport MenuConfirm from '../components/menu-confirm';\nimport MenuLink from '../components/menu-link';\nimport Menu2 from '../components/menu2';\nimport Modal from '../components/modal';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport { getList, getLists } from '../utils/lists';\nimport states, { saveStatus } from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction List(props) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { masto, instance } = api();\n  const id = props?.id || useParams()?.id;\n  // const navigate = useNavigate();\n  const latestItem = useRef();\n  // const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n\n  const listIterator = useRef();\n  async function fetchList(firstLoad) {\n    if (firstLoad || !listIterator.current) {\n      listIterator.current = masto.v1.timelines.list\n        .$select(id)\n        .list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await listIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'home');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.timelines.list.$select(id).list({\n        limit: 1,\n        since_id: latestItem.current,\n      });\n      let { value } = results;\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        value = filteredItems(value, 'home');\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  const [lists, setLists] = useState([]);\n\n  const [list, setList] = useState({ title: 'List' });\n  // const [title, setTitle] = useState(`List`);\n  useTitle(list.title, `/l/:id`);\n  useEffect(() => {\n    (async () => {\n      try {\n        const list = await getList(id);\n        setList(list);\n        // setTitle(list.title);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [id]);\n\n  const [showListAddEditModal, setShowListAddEditModal] = useState(false);\n  const [showManageMembersModal, setShowManageMembersModal] = useState(false);\n\n  return (\n    <>\n      <Timeline\n        key={id}\n        title={list.title}\n        id=\"list\"\n        emptyText={t`Nothing yet.`}\n        errorText={t`Unable to load posts.`}\n        instance={instance}\n        fetchItems={fetchList}\n        checkForUpdates={checkForUpdates}\n        useItemID\n        boostsCarousel={snapStates.settings.boostsCarousel}\n        // allowFilters\n        filterContext=\"home\"\n        showReplyParent\n        // refresh={reloadCount}\n        headerStart={\n          // <Link to=\"/l\" class=\"button plain\">\n          //   <Icon icon=\"list\" size=\"l\" />\n          // </Link>\n          <Menu2\n            overflow=\"auto\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"list\" size=\"l\" alt={t`Lists`} />\n                <Icon icon=\"chevron-down\" size=\"s\" />\n              </button>\n            }\n            onMenuChange={(e) => {\n              if (e.open) {\n                getLists().then(setLists);\n              }\n            }}\n          >\n            <MenuLink to=\"/l\">\n              <span>\n                <Trans>All Lists</Trans>\n              </span>\n            </MenuLink>\n            {lists?.length > 0 && (\n              <>\n                <MenuDivider />\n                {lists.map((list) => (\n                  <MenuLink key={list.id} to={`/l/${list.id}`}>\n                    <span>\n                      {list.title}\n                      {list.exclusive && (\n                        <>\n                          {' '}\n                          <ListExclusiveBadge />\n                        </>\n                      )}\n                    </span>\n                  </MenuLink>\n                ))}\n              </>\n            )}\n          </Menu2>\n        }\n        headerEnd={\n          <Menu2\n            portal\n            setDownOverflow\n            overflow=\"auto\"\n            viewScroll=\"close\"\n            position=\"anchor\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n          >\n            {list?.exclusive && (\n              <>\n                <MenuHeader className=\"plain\">\n                  <ListExclusiveBadge />{' '}\n                  <Trans>\n                    Posts on this list are hidden from Home/Following\n                  </Trans>\n                </MenuHeader>\n                <MenuDivider />\n              </>\n            )}\n            <MenuItem\n              onClick={() =>\n                setShowListAddEditModal({\n                  list,\n                })\n              }\n            >\n              <Icon icon=\"pencil\" size=\"l\" />\n              <span>\n                <Trans>Edit</Trans>\n              </span>\n            </MenuItem>\n            <MenuItem onClick={() => setShowManageMembersModal(true)}>\n              <Icon icon=\"group\" size=\"l\" />\n              <span>\n                <Trans>Manage members</Trans>\n              </span>\n            </MenuItem>\n          </Menu2>\n        }\n      />\n      {showListAddEditModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowListAddEditModal(false);\n            }\n          }}\n        >\n          <ListAddEdit\n            list={showListAddEditModal?.list}\n            onClose={(result) => {\n              if (result.state === 'success' && result.list) {\n                setList(result.list);\n                // reload();\n              } else if (result.state === 'deleted') {\n                // navigate('/l');\n                location.hash = '/l';\n              }\n              setShowListAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n      {showManageMembersModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowManageMembersModal(false);\n            }\n          }}\n        >\n          <ListManageMembers\n            listID={id}\n            onClose={() => setShowManageMembersModal(false)}\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n\nconst MEMBERS_LIMIT = 40;\n\nfunction ListManageMembers({ listID, onClose }) {\n  const { t } = useLingui();\n  // Show list of members with [Remove] button\n  // API only returns 40 members at a time, so this need to be paginated with infinite scroll\n  // Show [Add] button after removing a member\n  const { masto, instance } = api();\n  const [members, setMembers] = useState([]);\n  const [uiState, setUIState] = useState('default');\n  const [showMore, setShowMore] = useState(false);\n\n  const membersIterator = useRef();\n\n  async function fetchMembers(firstLoad) {\n    setShowMore(false);\n    setUIState('loading');\n    (async () => {\n      try {\n        if (firstLoad || !membersIterator.current) {\n          membersIterator.current = masto.v1.lists\n            .$select(listID)\n            .accounts.list({\n              limit: MEMBERS_LIMIT,\n            })\n            .values();\n        }\n        const results = await membersIterator.current.next();\n        let { done, value } = results;\n        if (value?.length) {\n          if (firstLoad) {\n            setMembers(value);\n          } else {\n            setMembers(members.concat(value));\n          }\n          setShowMore(!done);\n        } else {\n          setShowMore(false);\n        }\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n      }\n    })();\n  }\n\n  useEffect(() => {\n    fetchMembers(true);\n  }, []);\n\n  return (\n    <div class=\"sheet\" id=\"list-manage-members-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Manage members</Trans>\n        </h2>\n      </header>\n      <main>\n        <ul>\n          {members.map((member) => (\n            <li key={member.id}>\n              <AccountBlock account={member} instance={instance} />\n              <RemoveAddButton account={member} listID={listID} />\n            </li>\n          ))}\n          {showMore && uiState === 'default' && (\n            <InView as=\"li\" onChange={(inView) => inView && fetchMembers()}>\n              <button type=\"button\" class=\"light block\" onClick={fetchMembers}>\n                <Trans>Show more</Trans>\n              </button>\n            </InView>\n          )}\n        </ul>\n      </main>\n    </div>\n  );\n}\n\nfunction RemoveAddButton({ account, listID }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [removed, setRemoved] = useState(false);\n\n  return (\n    <MenuConfirm\n      confirm={!removed}\n      confirmLabel={\n        <span>\n          <Trans>\n            Remove <span class=\"bidi-isolate\">@{account.username}</span> from\n            list?\n          </Trans>\n        </span>\n      }\n      align=\"end\"\n      menuItemClassName=\"danger\"\n      onClick={() => {\n        if (removed) {\n          setUIState('loading');\n          (async () => {\n            try {\n              await masto.v1.lists.$select(listID).accounts.create({\n                accountIds: [account.id],\n              });\n              setUIState('default');\n              setRemoved(false);\n            } catch (e) {\n              setUIState('error');\n            }\n          })();\n        } else {\n          // const yes = confirm(`Remove ${account.username} from this list?`);\n          // if (!yes) return;\n          setUIState('loading');\n\n          (async () => {\n            try {\n              await masto.v1.lists.$select(listID).accounts.remove({\n                accountIds: [account.id],\n              });\n              setUIState('default');\n              setRemoved(true);\n            } catch (e) {\n              setUIState('error');\n            }\n          })();\n        }\n      }}\n    >\n      <button\n        type=\"button\"\n        class={`light ${removed ? '' : 'danger'}`}\n        disabled={uiState === 'loading'}\n      >\n        {removed ? t`Add` : t`Remove`}\n      </button>\n    </MenuConfirm>\n  );\n}\n\nexport default List;\n","// This is like very lame \"type-checking\" lol\nconst notificationTypeKeys = {\n  mention: ['account', 'status'],\n  quote: ['account', 'status'],\n  status: ['account', 'status'],\n  reblog: ['account', 'status'],\n  follow: ['account'],\n  follow_request: ['account'],\n  favourite: ['account', 'status'],\n  poll: ['status'],\n  update: ['status'],\n};\n\nconst GROUP_TYPES = ['favourite', 'reblog', 'follow'];\nconst groupable = (type) => GROUP_TYPES.includes(type);\n\nexport function fixNotifications(notifications) {\n  return notifications.filter((notification) => {\n    const { type, id, createdAt } = notification;\n    if (!type) {\n      console.warn('Notification missing type', notification);\n      return false;\n    }\n    if (!id || !createdAt) {\n      console.warn('Notification missing id or createdAt', notification);\n      // Continue processing this despite missing id or createdAt\n    }\n    const keys = notificationTypeKeys[type];\n    if (keys?.length) {\n      return keys.every((key) => !!notification[key]);\n    }\n    return true; // skip other types\n  });\n}\n\nexport function massageNotifications2(notifications) {\n  if (notifications?.notificationGroups) {\n    const {\n      accounts = [],\n      notificationGroups = [],\n      statuses = [],\n    } = notifications;\n    return notificationGroups.map((group) => {\n      const { sampleAccountIds, statusId } = group;\n      const sampleAccounts =\n        sampleAccountIds?.map((id) => accounts.find((a) => a.id === id)) || [];\n      const status = statuses?.find((s) => s.id === statusId) || null;\n      return {\n        ...group,\n        sampleAccounts,\n        status,\n      };\n    });\n  }\n  return notifications;\n}\n\nexport function groupNotifications2(groupNotifications) {\n  // Make grouped notifications to look like faux grouped notifications\n  const newGroupNotifications = groupNotifications.map((gn) => {\n    const {\n      latestPageNotificationAt,\n      mostRecentNotificationId,\n      sampleAccounts,\n      notificationsCount,\n    } = gn;\n\n    return {\n      id: '' + mostRecentNotificationId,\n      createdAt: latestPageNotificationAt,\n      account: sampleAccounts[0],\n      ...gn,\n    };\n  });\n\n  // Merge favourited and reblogged of same status into a single notification\n  // - new type: \"favourite+reblog\"\n  // - sum numbers for `notificationsCount` and `sampleAccounts`\n  const notificationsMap = {};\n  const newGroupNotifications1 = [];\n  for (let i = 0; i < newGroupNotifications.length; i++) {\n    const gn = newGroupNotifications[i];\n    const {\n      type,\n      status,\n      createdAt,\n      notificationsCount,\n      sampleAccounts,\n      groupKey,\n    } = gn;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    let virtualType = type;\n    // const sameCount = notificationsCount > 0 && notificationsCount === sampleAccounts?.length;\n    // if (sameCount && (type === 'favourite' || type === 'reblog')) {\n    const sampleCountDiffNotificationsCount =\n      notificationsCount > 0 &&\n      sampleAccounts?.length > 0 &&\n      notificationsCount > sampleAccounts?.length;\n    if (\n      !sampleCountDiffNotificationsCount &&\n      (type === 'favourite' || type === 'reblog')\n    ) {\n      virtualType = 'favourite+reblog';\n    }\n    // const key = `${status?.id}-${virtualType}-${date}-${sameCount ? 1 : 0}`;\n    const key = `${status?.id}-${virtualType}-${date}`;\n    const mappedNotification = notificationsMap[key];\n    if (!groupable(type)) {\n      newGroupNotifications1.push(gn);\n    } else if (mappedNotification) {\n      // Merge sampleAccounts + merge _types\n      sampleAccounts.forEach((a) => {\n        const mappedAccount = mappedNotification.sampleAccounts.find(\n          (ma) => ma.id === a.id,\n        );\n        if (!mappedAccount) {\n          mappedNotification.sampleAccounts.push({\n            ...a,\n            _types: [type],\n          });\n        } else {\n          mappedAccount._types.push(type);\n          mappedAccount._types.sort().reverse();\n        }\n      });\n      // mappedNotification.notificationsCount =\n      //   mappedNotification.sampleAccounts.length;\n      mappedNotification.notificationsCount = Math.min(\n        mappedNotification.notificationsCount,\n        notificationsCount,\n      );\n      mappedNotification._notificationsCount.push(notificationsCount);\n      mappedNotification._sampleAccountsCount.push(sampleAccounts?.length);\n      mappedNotification._accounts = mappedNotification.sampleAccounts;\n      mappedNotification._groupKeys.push(groupKey);\n    } else {\n      const accounts = sampleAccounts.map((a) => ({\n        ...a,\n        _types: [type],\n      }));\n      notificationsMap[key] = {\n        ...gn,\n        sampleAccounts: accounts,\n        type: virtualType,\n        _accounts: accounts,\n        _groupKeys: groupKey ? [groupKey] : [],\n        _notificationsCount: [notificationsCount],\n        _sampleAccountsCount: [sampleAccounts?.length],\n      };\n      newGroupNotifications1.push(notificationsMap[key]);\n    }\n  }\n\n  // 2nd pass.\n  // - Group 1 account favourte/reblog multiple posts\n  // - _statuses: [status, status, ...]\n  const notificationsMap2 = {};\n  const newGroupNotifications2 = [];\n  for (let i = 0; i < newGroupNotifications1.length; i++) {\n    const gn = newGroupNotifications1[i];\n    const { type, account, _accounts, sampleAccounts, createdAt, groupKey } =\n      gn;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    const hasOneAccount =\n      sampleAccounts?.length === 1 || _accounts?.length === 1;\n    if (\n      (type === 'favourite' ||\n        type === 'reblog' ||\n        type === 'favourite+reblog') &&\n      hasOneAccount\n    ) {\n      const key = `${account?.id}-${type}-${date}`;\n      const mappedNotification = notificationsMap2[key];\n      if (mappedNotification) {\n        mappedNotification._statuses.push(gn.status);\n        mappedNotification._ids += `-${gn.id}`;\n        mappedNotification._groupKeys.push(groupKey);\n      } else {\n        let n = (notificationsMap2[key] = {\n          ...gn,\n          type,\n          _ids: gn.id,\n          _statuses: [gn.status],\n          _groupKeys: groupKey ? [groupKey] : [],\n        });\n        newGroupNotifications2.push(n);\n      }\n    } else {\n      newGroupNotifications2.push(gn);\n    }\n  }\n\n  console.log('newGroupNotifications2', newGroupNotifications2);\n\n  return newGroupNotifications2;\n}\n\nexport default function groupNotifications(notifications) {\n  // Filter out invalid notifications\n  notifications = fixNotifications(notifications);\n\n  // Create new flat list of notifications\n  // Combine sibling notifications based on type and status id\n  // Concat all notification.account into an array of _accounts\n  const notificationsMap = {};\n  const cleanNotifications = [];\n  for (let i = 0, j = 0; i < notifications.length; i++) {\n    const notification = notifications[i];\n    const { id, status, account, type, createdAt } = notification;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    let virtualType = type;\n    if (type === 'favourite' || type === 'reblog') {\n      virtualType = 'favourite+reblog';\n    }\n    const key = `${status?.id}-${virtualType}-${date}`;\n    const mappedNotification = notificationsMap[key];\n    if (!groupable(type)) {\n      cleanNotifications[j++] = notification;\n    } else if (mappedNotification?.account) {\n      const mappedAccount = mappedNotification._accounts.find(\n        (a) => a.id === account.id,\n      );\n      if (mappedAccount) {\n        mappedAccount._types.push(type);\n        mappedAccount._types.sort().reverse();\n        mappedNotification._ids += `-${id}`;\n      } else {\n        account._types = [type];\n        mappedNotification._accounts.push(account);\n        mappedNotification._ids += `-${id}`;\n      }\n    } else {\n      if (account) account._types = [type];\n      let n = (notificationsMap[key] = {\n        ...notification,\n        type: virtualType,\n        _ids: id,\n        _accounts: account ? [account] : [],\n      });\n      cleanNotifications[j++] = n;\n    }\n  }\n\n  // 2nd pass to group \"favourite+reblog\"-type notifications by account if _accounts.length <= 1\n  // This means one acount has favourited and reblogged the multiple statuses\n  // The grouped notification\n  // - type: \"favourite+reblog+account\"\n  // - _statuses: [status, status, ...]\n  const notificationsMap2 = {};\n  const cleanNotifications2 = [];\n  for (let i = 0, j = 0; i < cleanNotifications.length; i++) {\n    const notification = cleanNotifications[i];\n    const { id, account, _accounts, type, createdAt } = notification;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    if (type === 'favourite+reblog' && account && _accounts.length === 1) {\n      const key = `${account?.id}-${type}-${date}`;\n      const mappedNotification = notificationsMap2[key];\n      if (mappedNotification) {\n        mappedNotification._statuses.push(notification.status);\n        mappedNotification._ids += `-${id}`;\n      } else {\n        let n = (notificationsMap2[key] = {\n          ...notification,\n          type,\n          _ids: id,\n          _statuses: [notification.status],\n        });\n        cleanNotifications2[j++] = n;\n      }\n    } else {\n      cleanNotifications2[j++] = notification;\n    }\n  }\n\n  console.log({ notifications, cleanNotifications, cleanNotifications2 });\n\n  // return cleanNotifications;\n  return cleanNotifications2;\n}\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useMemo, useRef, useState } from 'preact/hooks';\nimport { useSearchParams } from 'react-router-dom';\n\nimport Link from '../components/link';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { fixNotifications } from '../utils/group-notifications';\nimport { saveStatus } from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\nconst emptySearchParams = new URLSearchParams();\n\nfunction Mentions({ columnMode, ...props }) {\n  const { t } = useLingui();\n  const { masto, instance } = api();\n  const [searchParams] = columnMode ? [emptySearchParams] : useSearchParams();\n  const [stateType, setStateType] = useState(null);\n  const type = props?.type || searchParams.get('type') || stateType;\n  useTitle(type === 'private' ? t`Private mentions` : t`Mentions`, '/mentions');\n\n  const mentionsIterator = useRef();\n  const latestItem = useRef();\n\n  async function fetchMentions(firstLoad) {\n    if (firstLoad || !mentionsIterator.current) {\n      mentionsIterator.current = masto.v1.notifications\n        .list({\n          limit: LIMIT,\n          types: ['mention'],\n        })\n        .values();\n    }\n    const results = await mentionsIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      value = fixNotifications(value);\n\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n        console.log('First load', latestItem.current);\n      }\n\n      value.forEach(({ status: item }) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value: value?.map((item) => item.status),\n    };\n  }\n\n  const conversationsIterator = useRef();\n  const latestConversationItem = useRef();\n  async function fetchConversations(firstLoad) {\n    if (firstLoad || !conversationsIterator.current) {\n      conversationsIterator.current = masto.v1.conversations\n        .list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await conversationsIterator.current.next();\n    let { value } = results;\n    value = value?.filter((item) => item.lastStatus);\n    if (value?.length) {\n      if (firstLoad) {\n        latestConversationItem.current = value[0].lastStatus.id;\n        console.log('First load', latestConversationItem.current);\n      }\n\n      value.forEach(({ lastStatus: item }) => {\n        saveStatus(item, instance);\n      });\n    }\n    console.log('results', results);\n    return {\n      ...results,\n      value: value?.map((item) => item.lastStatus),\n    };\n  }\n\n  function fetchItems(...args) {\n    if (type === 'private') {\n      return fetchConversations(...args);\n    }\n    return fetchMentions(...args);\n  }\n\n  async function checkForUpdates() {\n    if (type === 'private') {\n      try {\n        const results = await masto.v1.conversations\n          .list({\n            limit: 1,\n            since_id: latestConversationItem.current,\n          })\n          .values()\n          .next();\n        let { value } = results;\n        console.log(\n          'checkForUpdates PRIVATE',\n          latestConversationItem.current,\n          value,\n        );\n        const valueContainsLatestItem =\n          value[0]?.id === latestConversationItem.current; // since_id might not be supported\n        if (value?.length && !valueContainsLatestItem) {\n          latestConversationItem.current = value[0].lastStatus.id;\n          return true;\n        }\n        return false;\n      } catch (e) {\n        return false;\n      }\n    } else {\n      try {\n        const results = await masto.v1.notifications\n          .list({\n            limit: 1,\n            types: ['mention'],\n            since_id: latestItem.current,\n          })\n          .values()\n          .next();\n        let { value } = results;\n        console.log('checkForUpdates ALL', latestItem.current, value);\n        if (value?.length) {\n          latestItem.current = value[0].id;\n          return true;\n        }\n        return false;\n      } catch (e) {\n        return false;\n      }\n    }\n  }\n\n  const TimelineStart = useMemo(() => {\n    return (\n      <div class=\"filter-bar centered\">\n        <Link\n          to=\"/mentions\"\n          class={!type ? 'is-active' : ''}\n          onClick={(e) => {\n            if (columnMode) {\n              e.preventDefault();\n              setStateType(null);\n            }\n          }}\n        >\n          <Trans>All</Trans>\n        </Link>\n        <Link\n          to=\"/mentions?type=private\"\n          class={type === 'private' ? 'is-active' : ''}\n          onClick={(e) => {\n            if (columnMode) {\n              e.preventDefault();\n              setStateType('private');\n            }\n          }}\n        >\n          <Trans>Private</Trans>\n        </Link>\n      </div>\n    );\n  }, [type]);\n\n  return (\n    <Timeline\n      title={t`Mentions`}\n      id=\"mentions\"\n      emptyText={t`No one mentioned you :(`}\n      errorText={t`Unable to load mentions.`}\n      instance={instance}\n      fetchItems={fetchItems}\n      checkForUpdates={checkForUpdates}\n      useItemID\n      timelineStart={TimelineStart}\n      refresh={type}\n      filterContext=\"notifications\"\n    />\n  );\n}\n\nexport default Mentions;\n","import './notifications.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { Fragment } from 'preact';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { useSearchParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\nimport { subscribeKey } from 'valtio/utils';\n\nimport AccountBlock from '../components/account-block';\nimport FollowRequestButtons from '../components/follow-request-buttons';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport Notification from '../components/notification';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport enhanceContent from '../utils/enhance-content';\nimport FilterContext from '../utils/filter-context';\nimport groupNotifications, {\n  groupNotifications2,\n  massageNotifications2,\n} from '../utils/group-notifications';\nimport handleContentLinks from '../utils/handle-content-links';\nimport mem from '../utils/mem';\nimport niceDateTime from '../utils/nice-date-time';\nimport { getRegistration } from '../utils/push-notifications';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport store from '../utils/store';\nimport { getAPIVersions, getCurrentInstance } from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport usePageVisibility from '../utils/usePageVisibility';\nimport useScroll from '../utils/useScroll';\nimport useTitle from '../utils/useTitle';\n\nconst NOTIFICATIONS_LIMIT = 80;\nconst NOTIFICATIONS_GROUPED_LIMIT = 20;\nconst emptySearchParams = new URLSearchParams();\n\nconst scrollIntoViewOptions = {\n  block: 'center',\n  inline: 'center',\n  behavior: 'smooth',\n};\n\nconst memSupportsGroupedNotifications = mem(\n  () => getAPIVersions()?.mastodon >= 2,\n  {\n    maxAge: 1000 * 60 * 5, // 5 minutes\n  },\n);\n\nfunction mastoFetchNotificationsIterable(opts = {}) {\n  const { masto } = api();\n  if (memSupportsGroupedNotifications()) {\n    // https://github.com/mastodon/mastodon/pull/29889\n    return masto.v2.notifications.list({\n      limit: NOTIFICATIONS_GROUPED_LIMIT,\n      ...opts,\n    });\n  } else {\n    return masto.v1.notifications.list({\n      limit: NOTIFICATIONS_LIMIT,\n      ...opts,\n    });\n  }\n}\nexport function mastoFetchNotifications(opts = {}) {\n  return mastoFetchNotificationsIterable(opts).values();\n}\n\nexport function getGroupedNotifications(notifications) {\n  if (memSupportsGroupedNotifications()) {\n    return groupNotifications2(notifications);\n  } else {\n    return groupNotifications(notifications);\n  }\n}\n\nconst NOTIFICATIONS_POLICIES = [\n  'forNotFollowing',\n  'forNotFollowers',\n  'forNewAccounts',\n  'forPrivateMentions',\n  'forLimitedAccounts',\n];\nconst NOTIFICATIONS_POLICIES_TEXT = {\n  forNotFollowing: msg`You don't follow`,\n  forNotFollowers: msg`Who don't follow you`,\n  forNewAccounts: msg`With a new account`,\n  forPrivateMentions: msg`Who unsolicitedly private mention you`,\n  forLimitedAccounts: msg`Who are limited by server moderators`,\n};\n\nfunction Notifications({ columnMode }) {\n  const { _, t } = useLingui();\n  useTitle(t`Notifications`, '/notifications');\n  const { masto, instance } = api();\n  const snapStates = useSnapshot(states);\n  const [uiState, setUIState] = useState('default');\n  const [searchParams] = columnMode ? [emptySearchParams] : useSearchParams();\n  const notificationID = searchParams.get('id');\n  const notificationAccessToken = searchParams.get('access_token');\n  const [showMore, setShowMore] = useState(false);\n  const [onlyMentions, setOnlyMentions] = useState(false);\n  const scrollableRef = useRef();\n  const { nearReachEnd, scrollDirection, reachStart, nearReachStart } =\n    useScroll({\n      scrollableRef,\n    });\n  const hiddenUI = scrollDirection === 'end' && !nearReachStart;\n  const [followRequests, setFollowRequests] = useState([]);\n  const [announcements, setAnnouncements] = useState([]);\n\n  console.debug('RENDER Notifications');\n\n  const notificationsIterable = useRef();\n  const notificationsIterator = useRef();\n  async function fetchNotifications(firstLoad) {\n    if (firstLoad || !notificationsIterator.current) {\n      // Reset iterator\n      notificationsIterable.current = mastoFetchNotificationsIterable({\n        excludeTypes: ['follow_request'],\n      });\n      notificationsIterator.current = notificationsIterable.current.values();\n    }\n    if (/max_id=($|&)/i.test(notificationsIterator.current?.nextParams)) {\n      // Pixelfed returns next paginationed link with empty max_id\n      // I assume, it's done (end of list)\n      return {\n        done: true,\n      };\n    }\n    const allNotifications = await notificationsIterator.current.next();\n    const notifications = massageNotifications2(allNotifications.value);\n\n    if (notifications?.length) {\n      notifications.forEach((notification) => {\n        saveStatus(notification.status, instance, {\n          skipThreading: true,\n        });\n      });\n\n      // TEST: Slot in a fake notification to test 'severed_relationships'\n      // notifications.unshift({\n      //   id: '123123',\n      //   type: 'severed_relationships',\n      //   createdAt: '2024-03-22T19:20:08.316Z',\n      //   event: {\n      //     type: 'account_suspension',\n      //     targetName: 'mastodon.dev',\n      //     followersCount: 0,\n      //     followingCount: 0,\n      //   },\n      // });\n\n      // TEST: Slot in a fake notification to test 'moderation_warning'\n      // notifications.unshift({\n      //   id: '123123',\n      //   type: 'moderation_warning',\n      //   createdAt: new Date().toISOString(),\n      //   moderation_warning: {\n      //     id: '1231234',\n      //     action: 'mark_statuses_as_sensitive',\n      //   },\n      // });\n\n      // console.log({ notifications });\n\n      const groupedNotifications = getGroupedNotifications(notifications);\n\n      if (firstLoad) {\n        states.notificationsLast = groupedNotifications[0];\n        states.notifications = groupedNotifications;\n\n        // Update last read marker\n        masto.v1.markers\n          .create({\n            notifications: {\n              lastReadId: groupedNotifications[0].id,\n            },\n          })\n          .catch(() => {});\n      } else {\n        states.notifications.push(...groupedNotifications);\n      }\n    }\n\n    states.notificationsShowNew = false;\n    states.notificationsLastFetchTime = Date.now();\n    return allNotifications;\n  }\n\n  async function fetchFollowRequests() {\n    // Note: no pagination here yet because this better be on a separate page. Should be rare use-case???\n    try {\n      return await masto.v1.followRequests.list({\n        limit: 80,\n      });\n    } catch (e) {\n      // Silently fail\n      return [];\n    }\n  }\n\n  const loadFollowRequests = () => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const requests = await fetchFollowRequests();\n        setFollowRequests(requests);\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n      }\n    })();\n  };\n\n  async function fetchAnnouncements() {\n    try {\n      return await masto.v1.announcements.list();\n    } catch (e) {\n      // Silently fail\n      return [];\n    }\n  }\n\n  const supportsFilteredNotifications = supports(\n    '@mastodon/filtered-notifications',\n  );\n  const [showNotificationsSettings, setShowNotificationsSettings] =\n    useState(false);\n  const [notificationsPolicy, setNotificationsPolicy] = useState({});\n  function fetchNotificationsPolicy() {\n    return masto.v2.notifications.policy.fetch().catch(() => {});\n  }\n  function loadNotificationsPolicy() {\n    fetchNotificationsPolicy()\n      .then((policy) => {\n        console.log(' Notifications policy', policy);\n        setNotificationsPolicy(policy);\n      })\n      .catch(() => {});\n  }\n  const [notificationsRequests, setNotificationsRequests] = useState(null);\n  function fetchNotificationsRequest() {\n    return masto.v1.notifications.requests.list();\n  }\n\n  const loadNotifications = (firstLoad) => {\n    setShowNew(false);\n    setUIState('loading');\n    (async () => {\n      try {\n        const fetchNotificationsPromise = fetchNotifications(firstLoad);\n\n        if (firstLoad) {\n          fetchAnnouncements()\n            .then((announcements) => {\n              announcements.sort((a, b) => {\n                // Sort by updatedAt first, then createdAt\n                return (\n                  Date.parse(b.updatedAt || b.createdAt) -\n                  Date.parse(a.updatedAt || a.createdAt)\n                );\n              });\n              setAnnouncements(announcements);\n            })\n            .catch(() => {});\n\n          fetchFollowRequests()\n            .then((requests) => {\n              setFollowRequests(requests);\n            })\n            .catch(() => {});\n\n          if (supportsFilteredNotifications) {\n            loadNotificationsPolicy();\n          }\n        }\n\n        const { done } = await fetchNotificationsPromise;\n        setShowMore(!done);\n\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  };\n\n  useEffect(() => {\n    loadNotifications(true);\n  }, []);\n  useEffect(() => {\n    if (reachStart) {\n      loadNotifications(true);\n    }\n  }, [reachStart]);\n\n  // useEffect(() => {\n  //   if (nearReachEnd && showMore) {\n  //     loadNotifications();\n  //   }\n  // }, [nearReachEnd, showMore]);\n\n  const [showNew, setShowNew] = useState(false);\n\n  const loadUpdates = useCallback(\n    ({ disableIdleCheck = false } = {}) => {\n      if (uiState === 'loading') {\n        return;\n      }\n      console.log(' Load updates', {\n        autoRefresh: snapStates.settings.autoRefresh,\n        scrollTop: scrollableRef.current?.scrollTop,\n        inBackground: inBackground(),\n        disableIdleCheck,\n      });\n      if (\n        snapStates.settings.autoRefresh &&\n        scrollableRef.current?.scrollTop < 16 &&\n        (disableIdleCheck || window.__IDLE__) &&\n        !inBackground()\n      ) {\n        loadNotifications(true);\n      }\n    },\n    [snapStates.notificationsShowNew, snapStates.settings.autoRefresh, uiState],\n  );\n  // useEffect(loadUpdates, [snapStates.notificationsShowNew]);\n\n  const lastHiddenTime = useRef();\n  usePageVisibility((visible) => {\n    if (visible) {\n      const timeDiff = Date.now() - lastHiddenTime.current;\n      if (!lastHiddenTime.current || timeDiff > 1000 * 3) {\n        // 3 seconds\n        loadUpdates({\n          disableIdleCheck: true,\n        });\n      } else {\n        lastHiddenTime.current = Date.now();\n      }\n    }\n  });\n  const firstLoad = useRef(true);\n  useEffect(() => {\n    let unsub = subscribeKey(states, 'notificationsShowNew', (v) => {\n      if (firstLoad.current) {\n        firstLoad.current = false;\n        return;\n      }\n      if (uiState === 'loading') return;\n      if (v) loadUpdates();\n      setShowNew(v);\n    });\n    return () => unsub?.();\n  }, []);\n\n  const todayDate = new Date();\n  const yesterdayDate = new Date(todayDate - 24 * 60 * 60 * 1000);\n  let currentDay = new Date();\n  const showTodayEmpty = !snapStates.notifications.some(\n    (notification) =>\n      new Date(notification.createdAt).toDateString() ===\n      todayDate.toDateString(),\n  );\n\n  const announcementsListRef = useRef();\n\n  useEffect(() => {\n    if (notificationID) {\n      states.routeNotification = {\n        id: notificationID,\n        accessToken: atob(notificationAccessToken),\n      };\n    }\n  }, [notificationID, notificationAccessToken]);\n\n  // useEffect(() => {\n  //   if (uiState === 'default') {\n  //     (async () => {\n  //       try {\n  //         const registration = await getRegistration();\n  //         if (registration?.getNotifications) {\n  //           const notifications = await registration.getNotifications();\n  //           console.log(' Push notifications', notifications);\n  //           // Close all notifications?\n  //           // notifications.forEach((notification) => {\n  //           //   notification.close();\n  //           // });\n  //         }\n  //       } catch (e) {}\n  //     })();\n  //   }\n  // }, [uiState]);\n\n  const [annualReportNotification, setAnnualReportNotification] =\n    useState(null);\n  useEffect(async () => {\n    // Skip this if not in December\n    const date = new Date();\n    if (date.getMonth() !== 11) return;\n\n    // Skip if doesn't support annual report\n    if (!supports('@mastodon/annual-report')) return;\n\n    let annualReportNotification = store.account.get(\n      'annualReportNotification',\n    );\n    if (annualReportNotification) {\n      setAnnualReportNotification(annualReportNotification);\n      return;\n    }\n    const notificationIterator = mastoFetchNotifications({\n      types: ['annual_report'],\n    });\n    try {\n      const notification = await notificationIterator.next();\n      annualReportNotification = notification?.value?.notificationGroups?.[0];\n      const annualReportYear = annualReportNotification?.annualReport?.year;\n      // If same year, show the annual report\n      if (annualReportYear == date.getFullYear()) {\n        console.log(\n          'ANNUAL REPORT',\n          annualReportYear,\n          annualReportNotification,\n        );\n        setAnnualReportNotification(annualReportNotification);\n        store.account.set('annualReportNotification', annualReportNotification);\n      }\n    } catch (e) {\n      console.warn(e);\n    }\n  }, []);\n\n  const itemsSelector = '.notification';\n  const jRef = useHotkeys(\n    'j',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let nextItem = allItems[activeItemIndex + 1];\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k',\n    () => {\n      // focus on previous status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const oRef = useHotkeys(\n    ['enter', 'o'],\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const statusLink = activeItem?.querySelector('.status-link');\n      if (statusLink) {\n        statusLink.click();\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const today = new Date();\n  const todaySubHeading = useMemo(() => {\n    return niceDateTime(today, {\n      forceOpts: {\n        weekday: 'long',\n      },\n    });\n  }, [today]);\n\n  return (\n    <div\n      id=\"notifications-page\"\n      class=\"deck-container\"\n      ref={(node) => {\n        scrollableRef.current = node;\n        jRef.current = node;\n        kRef.current = node;\n        oRef.current = node;\n      }}\n      tabIndex=\"-1\"\n    >\n      <div class={`timeline-deck deck ${onlyMentions ? 'only-mentions' : ''}`}>\n        <header\n          hidden={hiddenUI}\n          onClick={(e) => {\n            if (!e.target.closest('a, button')) {\n              scrollableRef.current?.scrollTo({ top: 0, behavior: 'smooth' });\n            }\n          }}\n          onDblClick={(e) => {\n            if (!e.target.closest('a, button')) {\n              loadNotifications(true);\n            }\n          }}\n          class={uiState === 'loading' ? 'loading' : ''}\n        >\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Notifications</Trans>\n            </h1>\n            <div class=\"header-side\">\n              {supportsFilteredNotifications && (\n                <button\n                  type=\"button\"\n                  class=\"button plain4\"\n                  onClick={() => {\n                    setShowNotificationsSettings(true);\n                  }}\n                >\n                  <Icon\n                    icon=\"settings\"\n                    size=\"l\"\n                    alt={t`Notifications settings`}\n                  />\n                </button>\n              )}\n            </div>\n          </div>\n          {showNew && uiState !== 'loading' && (\n            <button\n              class=\"updates-button shiny-pill\"\n              type=\"button\"\n              onClick={() => {\n                loadNotifications(true);\n                scrollableRef.current?.scrollTo({\n                  top: 0,\n                  behavior: 'smooth',\n                });\n              }}\n            >\n              <Icon icon=\"arrow-up\" /> <Trans>New notifications</Trans>\n            </button>\n          )}\n        </header>\n        {announcements.length > 0 && (\n          <div class=\"shazam-container\">\n            <div class=\"shazam-container-inner\">\n              <details class=\"announcements\">\n                <summary>\n                  <span>\n                    <Icon icon=\"announce\" class=\"announcement-icon\" size=\"l\" />{' '}\n                    <Plural\n                      value={announcements.length}\n                      one=\"Announcement\"\n                      other=\"Announcements\"\n                    />{' '}\n                    <small class=\"insignificant\">{instance}</small>\n                  </span>\n                  {announcements.length > 1 && (\n                    <span class=\"announcements-nav-buttons\">\n                      {announcements.map((announcement, index) => (\n                        <button\n                          type=\"button\"\n                          class=\"plain2 small\"\n                          onClick={() => {\n                            announcementsListRef.current?.children[\n                              index\n                            ].scrollIntoView({\n                              behavior: 'smooth',\n                              block: 'nearest',\n                            });\n                          }}\n                        >\n                          {index + 1}\n                        </button>\n                      ))}\n                    </span>\n                  )}\n                </summary>\n                <ul\n                  class={`announcements-list-${\n                    announcements.length > 1 ? 'multiple' : 'single'\n                  }`}\n                  ref={announcementsListRef}\n                >\n                  {announcements.map((announcement) => (\n                    <li>\n                      <AnnouncementBlock announcement={announcement} />\n                    </li>\n                  ))}\n                </ul>\n              </details>\n            </div>\n          </div>\n        )}\n        {followRequests.length > 0 && (\n          <div class=\"follow-requests\">\n            <h2 class=\"timeline-header\">\n              <Trans>Follow requests</Trans>\n            </h2>\n            {followRequests.length > 5 ? (\n              <details>\n                <summary>\n                  <Plural\n                    value={followRequests.length}\n                    one=\"# follow request\"\n                    other=\"# follow requests\"\n                  />\n                </summary>\n                <ul>\n                  {followRequests.map((account) => (\n                    <li key={account.id}>\n                      <AccountBlock account={account} />\n                      <FollowRequestButtons\n                        accountID={account.id}\n                        onChange={() => {\n                          // loadFollowRequests();\n                          // loadNotifications(true);\n                        }}\n                      />\n                    </li>\n                  ))}\n                </ul>\n              </details>\n            ) : (\n              <ul>\n                {followRequests.map((account) => (\n                  <li key={account.id}>\n                    <AccountBlock account={account} />\n                    <FollowRequestButtons\n                      accountID={account.id}\n                      onChange={() => {\n                        // loadFollowRequests();\n                        // loadNotifications(true);\n                      }}\n                    />\n                  </li>\n                ))}\n              </ul>\n            )}\n          </div>\n        )}\n        {supportsFilteredNotifications &&\n          notificationsPolicy?.summary?.pendingRequestsCount > 0 && (\n            <div class=\"shazam-container\">\n              <div class=\"shazam-container-inner\">\n                <div class=\"filtered-notifications\">\n                  <details\n                    onToggle={async (e) => {\n                      const { open } = e.target;\n                      if (open) {\n                        const requests = await fetchNotificationsRequest();\n                        setNotificationsRequests(requests);\n                        console.log({ open, requests });\n                      }\n                    }}\n                  >\n                    <summary>\n                      <Plural\n                        value={notificationsPolicy.summary.pendingRequestsCount}\n                        one=\"Filtered notifications from # person\"\n                        other=\"Filtered notifications from # people\"\n                      />\n                    </summary>\n                    {!notificationsRequests ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      notificationsRequests?.length > 0 && (\n                        <ul>\n                          {notificationsRequests.map((request) => (\n                            <li key={request.id}>\n                              <div class=\"request-notifcations\">\n                                {!request.lastStatus?.id && (\n                                  <AccountBlock\n                                    useAvatarStatic\n                                    showStats\n                                    account={request.account}\n                                  />\n                                )}\n                                {request.lastStatus?.id && (\n                                  <div class=\"last-post\">\n                                    <Link\n                                      class=\"status-link\"\n                                      to={`/${instance}/s/${request.lastStatus.id}`}\n                                    >\n                                      <Status\n                                        status={request.lastStatus}\n                                        size=\"s\"\n                                        readOnly\n                                      />\n                                    </Link>\n                                  </div>\n                                )}\n                                <NotificationRequestModalButton\n                                  request={request}\n                                />\n                              </div>\n                              <NotificationRequestButtons\n                                request={request}\n                                onChange={() => {\n                                  loadNotifications(true);\n                                }}\n                              />\n                            </li>\n                          ))}\n                        </ul>\n                      )\n                    )}\n                  </details>\n                </div>\n              </div>\n            </div>\n          )}\n        {annualReportNotification && (\n          <div class=\"shazam-container\">\n            <div class=\"shazam-container-inner\">\n              <Notification notification={annualReportNotification} />\n            </div>\n          </div>\n        )}\n        <div id=\"mentions-option\">\n          <label>\n            <input\n              type=\"checkbox\"\n              checked={onlyMentions}\n              onChange={(e) => {\n                setOnlyMentions(e.target.checked);\n              }}\n            />{' '}\n            <Trans>Only mentions</Trans>\n          </label>\n        </div>\n        <h2 class=\"timeline-header\">\n          <Trans>Today</Trans>{' '}\n          <small class=\"insignificant bidi-isolate\">{todaySubHeading}</small>\n        </h2>\n        {showTodayEmpty && (\n          <p class=\"ui-state insignificant\">\n            {uiState === 'default' ? t`You're all caught up.` : <>&hellip;</>}\n          </p>\n        )}\n        {snapStates.notifications.length ? (\n          <FilterContext.Provider value=\"notifications\">\n            {snapStates.notifications\n              // This is leaked from Notifications popover\n              .filter((n) => n.type !== 'follow_request')\n              .map((notification) => {\n                if (onlyMentions && notification.type !== 'mention') {\n                  return null;\n                }\n                const notificationDay = new Date(notification.createdAt);\n                const differentDay =\n                  notificationDay.toDateString() !== currentDay.toDateString();\n                if (differentDay) {\n                  currentDay = notificationDay;\n                }\n                // if notificationDay is yesterday, show \"Yesterday\"\n                // if notificationDay is before yesterday, show date\n                const heading =\n                  notificationDay.toDateString() ===\n                  yesterdayDate.toDateString()\n                    ? t`Yesterday`\n                    : niceDateTime(currentDay, {\n                        hideTime: true,\n                      });\n                const subHeading = niceDateTime(currentDay, {\n                  forceOpts: {\n                    weekday: 'long',\n                  },\n                });\n                return (\n                  <Fragment key={notification._ids || notification.id}>\n                    {differentDay && (\n                      <h2 class=\"timeline-header\">\n                        <span>{heading}</span>{' '}\n                        <small class=\"insignificant bidi-isolate\">\n                          {subHeading}\n                        </small>\n                      </h2>\n                    )}\n                    <Notification\n                      instance={instance}\n                      notification={notification}\n                      key={notification._ids || notification.id}\n                    />\n                  </Fragment>\n                );\n              })}\n          </FilterContext.Provider>\n        ) : (\n          <>\n            {uiState === 'loading' && (\n              <>\n                <ul class=\"timeline flat\">\n                  {Array.from({ length: 5 }).map((_, i) => (\n                    <li class=\"notification skeleton\">\n                      <div class=\"notification-type\">\n                        <Icon icon=\"notification\" size=\"xl\" />\n                      </div>\n                      <div class=\"notification-content\">\n                        <p> </p>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              </>\n            )}\n            {uiState === 'error' && (\n              <p class=\"ui-state\">\n                <Trans>Unable to load notifications</Trans>\n                <br />\n                <br />\n                <button type=\"button\" onClick={() => loadNotifications(true)}>\n                  <Trans>Try again</Trans>\n                </button>\n              </p>\n            )}\n          </>\n        )}\n        {showMore && (\n          <InView\n            onChange={(inView) => {\n              if (inView) {\n                loadNotifications();\n              }\n            }}\n          >\n            <button\n              type=\"button\"\n              class=\"plain block\"\n              disabled={uiState === 'loading'}\n              onClick={() => loadNotifications()}\n              style={{ marginBlockEnd: '6em' }}\n            >\n              {uiState === 'loading' ? (\n                <Loader abrupt />\n              ) : (\n                <Trans>Show more</Trans>\n              )}\n            </button>\n          </InView>\n        )}\n      </div>\n      {supportsFilteredNotifications && showNotificationsSettings && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowNotificationsSettings(false);\n            }\n          }}\n        >\n          <div class=\"sheet\" id=\"notifications-settings\" tabIndex=\"-1\">\n            <button\n              type=\"button\"\n              class=\"sheet-close\"\n              onClick={() => setShowNotificationsSettings(false)}\n            >\n              <Icon icon=\"x\" alt={t`Close`} />\n            </button>\n            <header>\n              <h2>\n                <Trans>Notifications settings</Trans>\n              </h2>\n            </header>\n            <main>\n              <form\n                onSubmit={(e) => {\n                  e.preventDefault();\n                  const {\n                    forNotFollowing,\n                    forNotFollowers,\n                    forNewAccounts,\n                    forPrivateMentions,\n                    forLimitedAccounts,\n                  } = e.target;\n                  const newPolicy = {\n                    ...notificationsPolicy,\n                    forNotFollowing: forNotFollowing.value,\n                    forNotFollowers: forNotFollowers.value,\n                    forNewAccounts: forNewAccounts.value,\n                    forPrivateMentions: forPrivateMentions.value,\n                    forLimitedAccounts: forLimitedAccounts.value,\n                  };\n                  setNotificationsPolicy(newPolicy);\n                  setShowNotificationsSettings(false);\n                  (async () => {\n                    try {\n                      await masto.v2.notifications.policy.update(newPolicy);\n                      showToast(t`Notifications settings updated`);\n                    } catch (e) {\n                      console.error(e);\n                    }\n                  })();\n                }}\n              >\n                <p>\n                  <Trans>Filter out notifications from people:</Trans>\n                </p>\n                <div class=\"notification-policy-fields\">\n                  {NOTIFICATIONS_POLICIES.map((key) => {\n                    const value = notificationsPolicy[key];\n                    return (\n                      <div key={key}>\n                        <label>\n                          {_(NOTIFICATIONS_POLICIES_TEXT[key])}\n                          <select name={key} defaultValue={value} class=\"small\">\n                            <option value=\"accept\">\n                              <Trans>Accept</Trans>\n                            </option>\n                            <option value=\"filter\">\n                              <Trans>Filter</Trans>\n                            </option>\n                            <option value=\"drop\">\n                              <Trans>Ignore</Trans>\n                            </option>\n                          </select>\n                        </label>\n                      </div>\n                    );\n                  })}\n                </div>\n                <p>\n                  <button type=\"submit\">\n                    <Trans>Save</Trans>\n                  </button>\n                </p>\n              </form>\n            </main>\n          </div>\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nfunction inBackground() {\n  return !!document.querySelector('.deck-backdrop, #modal-container > *');\n}\n\nfunction AnnouncementBlock({ announcement }) {\n  const { instance } = api();\n  const { contact } = getCurrentInstance();\n  const contactAccount = contact?.account;\n  const {\n    id,\n    content,\n    startsAt,\n    endsAt,\n    published,\n    allDay,\n    publishedAt,\n    updatedAt,\n    read,\n    mentions,\n    statuses,\n    tags,\n    emojis,\n    reactions,\n  } = announcement;\n\n  const publishedAtDate = new Date(publishedAt);\n  const publishedDateText = niceDateTime(publishedAtDate);\n  const updatedAtDate = new Date(updatedAt);\n  const updatedAtText = niceDateTime(updatedAtDate);\n\n  return (\n    <div class=\"announcement-block\">\n      <AccountBlock account={contactAccount} />\n      <div\n        class=\"announcement-content\"\n        onClick={handleContentLinks({ mentions, instance })}\n        dangerouslySetInnerHTML={{\n          __html: enhanceContent(content, {\n            emojis,\n          }),\n        }}\n      />\n      <p class=\"insignificant\">\n        <time datetime={publishedAtDate.toISOString()}>\n          {niceDateTime(publishedAtDate)}\n        </time>\n        {updatedAt && updatedAtText !== publishedDateText && (\n          <>\n            {' '}\n            &bull;{' '}\n            <span class=\"ib\">\n              <Trans>\n                Updated{' '}\n                <time datetime={updatedAtDate.toISOString()}>\n                  {niceDateTime(updatedAtDate)}\n                </time>\n              </Trans>\n            </span>\n          </>\n        )}\n      </p>\n      <div class=\"announcement-reactions\" hidden>\n        {reactions.map((reaction) => {\n          const { name, count, me, staticUrl, url } = reaction;\n          return (\n            <button type=\"button\" class={`plain4 small ${me ? 'reacted' : ''}`}>\n              {url || staticUrl ? (\n                <img src={url || staticUrl} alt={name} width=\"16\" height=\"16\" />\n              ) : (\n                <span>{name}</span>\n              )}{' '}\n              <span class=\"count\">{shortenNumber(count)}</span>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nfunction fetchNotficationsByAccount(accountID) {\n  const { masto } = api();\n  return masto.v1.notifications.list({\n    accountID,\n  });\n}\nfunction NotificationRequestModalButton({ request }) {\n  const { instance } = api();\n  const [uiState, setUIState] = useState('loading');\n  const { account, lastStatus } = request;\n  const [showModal, setShowModal] = useState(false);\n  const [notifications, setNotifications] = useState([]);\n\n  function onClose() {\n    setShowModal(false);\n  }\n\n  useEffect(() => {\n    if (!request?.account?.id) return;\n    if (!showModal) return;\n    setUIState('loading');\n    (async () => {\n      const notifs = await fetchNotficationsByAccount(request.account.id);\n      setNotifications(notifs || []);\n      setUIState('default');\n    })();\n  }, [showModal, request?.account?.id]);\n\n  return (\n    <>\n      <button\n        type=\"button\"\n        class=\"plain4 request-notifications-account\"\n        onClick={() => {\n          setShowModal(true);\n        }}\n      >\n        <Icon icon=\"notification\" class=\"more-insignificant\" />{' '}\n        <small>\n          <Trans>\n            View notifications from{' '}\n            <span class=\"bidi-isolate\">@{account.username}</span>\n          </Trans>\n        </small>{' '}\n        <Icon icon=\"chevron-down\" />\n      </button>\n      {showModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              onClose();\n            }\n          }}\n        >\n          <div class=\"sheet\" tabIndex=\"-1\">\n            <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n              <Icon icon=\"x\" alt={t`Close`} />\n            </button>\n            <header>\n              <b>\n                <Trans>\n                  Notifications from{' '}\n                  <span class=\"bidi-isolate\">@{account.username}</span>\n                </Trans>\n              </b>\n            </header>\n            <main>\n              {uiState === 'loading' ? (\n                <p class=\"ui-state\">\n                  <Loader abrupt />\n                </p>\n              ) : (\n                notifications.map((notification) => (\n                  <div\n                    class=\"notification-peek\"\n                    onClick={(e) => {\n                      const { target } = e;\n                      // If button or links\n                      if (\n                        e.target.tagName === 'BUTTON' ||\n                        e.target.tagName === 'A'\n                      ) {\n                        onClose();\n                      }\n                    }}\n                  >\n                    <Notification\n                      instance={instance}\n                      notification={notification}\n                      isStatic\n                    />\n                  </div>\n                ))\n              )}\n            </main>\n          </div>\n        </Modal>\n      )}\n    </>\n  );\n}\n\nfunction NotificationRequestButtons({ request, onChange }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [requestState, setRequestState] = useState(null); // accept, dismiss\n  const hasRequestState = requestState !== null;\n\n  return (\n    <p class=\"notification-request-buttons\">\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRequestState}\n        onClick={() => {\n          setUIState('loading');\n          (async () => {\n            try {\n              await masto.v1.notifications.requests\n                .$select(request.id)\n                .accept();\n              setRequestState('accept');\n              setUIState('default');\n              onChange({\n                request,\n                state: 'accept',\n              });\n              showToast(\n                t`Notifications from @${request.account.username} will not be filtered from now on.`,\n              );\n            } catch (error) {\n              setUIState('error');\n              console.error(error);\n              showToast(t`Unable to accept notification request`);\n            }\n          })();\n        }}\n      >\n        <Trans>Allow</Trans>\n      </button>{' '}\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRequestState}\n        class=\"light danger\"\n        onClick={() => {\n          setUIState('loading');\n          (async () => {\n            try {\n              await masto.v1.notifications.requests\n                .$select(request.id)\n                .dismiss();\n              setRequestState('dismiss');\n              setUIState('default');\n              onChange({\n                request,\n                state: 'dismiss',\n              });\n              showToast(\n                t`Notifications from @${request.account.username} will not show up in Filtered notifications from now on.`,\n              );\n            } catch (error) {\n              setUIState('error');\n              console.error(error);\n              showToast(t`Unable to dismiss notification request`);\n            }\n          })();\n        }}\n      >\n        <Trans>Dismiss</Trans>\n      </button>\n      <span class=\"notification-request-states\">\n        {uiState === 'loading' ? (\n          <Loader abrupt />\n        ) : requestState === 'accept' ? (\n          <Icon\n            icon=\"check-circle\"\n            alt={t`Accepted`}\n            class=\"notification-accepted\"\n          />\n        ) : (\n          requestState === 'dismiss' && (\n            <Icon\n              icon=\"x-circle\"\n              alt={t`Dismissed`}\n              class=\"notification-dismissed\"\n            />\n          )\n        )}\n      </span>\n    </p>\n  );\n}\n\nexport default memo(Notifications);\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { Menu, MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useRef } from 'preact/hooks';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport Icon from '../components/icon';\nimport Menu2 from '../components/menu2';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport states, { saveStatus } from '../utils/states';\nimport supports from '../utils/supports';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Public({ local, columnMode, ...props }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const isLocal = !!local;\n  const params = columnMode ? {} : useParams();\n  const { masto, instance } = api({\n    instance: props?.instance || params.instance,\n  });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const title = isLocal\n    ? t`Local timeline (${instance})`\n    : t`Federated timeline (${instance})`;\n  useTitle(title, isLocal ? `/:instance?/p/l` : `/:instance?/p`);\n  // const navigate = useNavigate();\n  const latestItem = useRef();\n\n  const publicIterator = useRef();\n  async function fetchPublic(firstLoad) {\n    if (firstLoad || !publicIterator.current) {\n      const opts = {\n        limit: LIMIT,\n        local: isLocal || undefined,\n      };\n      if (!isLocal && supports('@pixelfed/global-feed')) {\n        opts.remote = true;\n      }\n      publicIterator.current = masto.v1.timelines.public.list(opts).values();\n    }\n    const results = await publicIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'public');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.timelines.public\n        .list({\n          limit: 1,\n          local: isLocal,\n          since_id: latestItem.current,\n        })\n        .values()\n        .next();\n      let { value } = results;\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        value = filteredItems(value, 'public');\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  return (\n    <Timeline\n      key={instance + isLocal}\n      title={title}\n      titleComponent={\n        <h1 class=\"header-double-lines\">\n          <b>{isLocal ? t`Local timeline` : t`Federated timeline`}</b>\n          <div>{instance}</div>\n        </h1>\n      }\n      id=\"public\"\n      instance={instance}\n      emptyText={t`No one has posted anything yet.`}\n      errorText={t`Unable to load posts`}\n      fetchItems={fetchPublic}\n      checkForUpdates={checkForUpdates}\n      useItemID\n      headerStart={<></>}\n      boostsCarousel={snapStates.settings.boostsCarousel}\n      // allowFilters\n      filterContext=\"public\"\n      headerEnd={\n        <Menu2\n          portal\n          // setDownOverflow\n          overflow=\"auto\"\n          viewScroll=\"close\"\n          position=\"anchor\"\n          menuButton={\n            <button type=\"button\" class=\"plain\">\n              <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n            </button>\n          }\n        >\n          <MenuItem href={isLocal ? `/#/${instance}/p` : `/#/${instance}/p/l`}>\n            {isLocal ? (\n              <>\n                <Icon icon=\"transfer\" />{' '}\n                <span>\n                  <Trans>Switch to Federated</Trans>\n                </span>\n              </>\n            ) : (\n              <>\n                <Icon icon=\"transfer\" />{' '}\n                <span>\n                  <Trans>Switch to Local</Trans>\n                </span>\n              </>\n            )}\n          </MenuItem>\n          <MenuDivider />\n          <MenuItem\n            onClick={() => {\n              let newInstance = prompt(\n                t`Enter a new instance e.g. \"mastodon.social\"`,\n              );\n              if (!/\\./.test(newInstance)) {\n                if (newInstance) alert(t`Invalid instance`);\n                return;\n              }\n              if (newInstance) {\n                newInstance = newInstance.toLowerCase().trim();\n                // navigate(isLocal ? `/${newInstance}/p/l` : `/${newInstance}/p`);\n                location.hash = isLocal\n                  ? `/${newInstance}/p/l`\n                  : `/${newInstance}/p`;\n              }\n            }}\n          >\n            <Icon icon=\"bus\" />{' '}\n            <span>\n              <Trans>Go to another instance</Trans>\n            </span>\n          </MenuItem>\n          {currentInstance !== instance && (\n            <MenuItem\n              onClick={() => {\n                location.hash = isLocal\n                  ? `/${currentInstance}/p/l`\n                  : `/${currentInstance}/p`;\n              }}\n            >\n              <Icon icon=\"bus\" />{' '}\n              <small class=\"menu-double-lines\">\n                <Trans>\n                  Go to my instance (<b>{currentInstance}</b>)\n                </Trans>\n              </small>\n            </MenuItem>\n          )}\n        </Menu2>\n      }\n    />\n  );\n}\n\nexport default Public;\n","import { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useReducer } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport {\n  addToSearchHistory,\n  clearAllSearchHistory,\n  getSearchHistory,\n  removeFromSearchHistory,\n} from '../utils/search-history';\nimport showToast from '../utils/show-toast';\n\nimport Icon from './icon';\nimport Link from './link';\nimport { generateSearchItemData } from './search-form';\n\nexport default function RecentSearches({ onItemClick }) {\n  const { t } = useLingui();\n  const { instance } = api();\n  const [, reload] = useReducer((c) => c + 1, 0);\n  const history = getSearchHistory();\n\n  const handleClearAll = () => {\n    clearAllSearchHistory();\n    showToast({\n      text: t`Cleared recent searches`,\n      delay: 1000,\n    });\n    reload();\n  };\n\n  const handleRemoveItem = (query, queryType) => {\n    removeFromSearchHistory(query, queryType);\n    reload();\n  };\n\n  const [listRef] = useAutoAnimate();\n\n  if (history.length === 0) {\n    return null;\n  }\n\n  return (\n    <div class=\"recent-searches\">\n      <div class=\"recent-searches-header\">\n        <Icon icon=\"history\" />{' '}\n        <span>\n          <Trans>Recent searches</Trans>\n        </span>\n        <span class=\"spacer\" />\n        <button\n          type=\"button\"\n          class=\"plain4 small\"\n          onClick={handleClearAll}\n          disabled={history.length <= 0}\n        >\n          <span>\n            <Trans>Clear all</Trans>\n          </span>\n        </button>\n      </div>\n      <ul class=\"link-list recent-searches-list\" ref={listRef}>\n        {history.map((historyItem) => {\n          const { label, to, icon } = generateSearchItemData(\n            historyItem.query,\n            historyItem.queryType,\n            instance,\n          );\n\n          return (\n            <li\n              key={`${historyItem.query}-${historyItem.queryType}-${historyItem.timestamp}`}\n              class=\"recent-searches-item\"\n            >\n              <Link\n                to={to}\n                class=\"recent-searches-link\"\n                onClick={(e) => {\n                  addToSearchHistory(historyItem.query, historyItem.queryType);\n                  onItemClick?.(e);\n                }}\n              >\n                <Icon icon={icon} class=\"more-insignificant\" />\n                <span class=\"recent-searches-label\">{label}</span>\n              </Link>\n              <button\n                type=\"button\"\n                class=\"plain4 small\"\n                onClick={() =>\n                  handleRemoveItem(historyItem.query, historyItem.queryType)\n                }\n              >\n                <Icon icon=\"trash\" alt={t`Clear`} />\n              </button>\n            </li>\n          );\n        })}\n      </ul>\n    </div>\n  );\n}\n","import './search.css';\n\nimport { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useLayoutEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { useParams, useSearchParams } from 'react-router-dom';\n\nimport AccountBlock from '../components/account-block';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport NavMenu from '../components/nav-menu';\nimport RecentSearches from '../components/recent-searches';\nimport SearchForm from '../components/search-form';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport { fetchRelationships } from '../utils/relationships';\nimport shortenNumber from '../utils/shorten-number';\nimport usePageVisibility from '../utils/usePageVisibility';\nimport useTitle from '../utils/useTitle';\n\nconst SHORT_LIMIT = 5;\nconst LIMIT = 40;\nconst emptySearchParams = new URLSearchParams();\n\nconst scrollIntoViewOptions = {\n  block: 'nearest',\n  inline: 'center',\n  behavior: 'smooth',\n};\n\nfunction Search({ columnMode, ...props }) {\n  const { t } = useLingui();\n  const params = columnMode ? {} : useParams();\n  const { masto, instance, authenticated } = api({\n    instance: params.instance,\n  });\n  const [uiState, setUIState] = useState('default');\n  const [searchParams] = columnMode ? [emptySearchParams] : useSearchParams();\n  const searchFormRef = useRef();\n  const q = props?.query || searchParams.get('q');\n  const type = columnMode\n    ? 'statuses'\n    : props?.type || searchParams.get('type');\n  let title = t`Search`;\n  if (q) {\n    switch (type) {\n      case 'statuses':\n        title = t`Search: ${q} (Posts)`;\n        break;\n      case 'accounts':\n        title = t`Search: ${q} (Accounts)`;\n        break;\n      case 'hashtags':\n        title = t`Search: ${q} (Hashtags)`;\n        break;\n      default:\n        title = t`Search: ${q}`;\n    }\n  }\n  useTitle(title, `/search`);\n\n  const [showMore, setShowMore] = useState(false);\n  const offsetRef = useRef(0);\n  useEffect(() => {\n    offsetRef.current = 0;\n  }, [q, type]);\n\n  const scrollableRef = useRef();\n  useLayoutEffect(() => {\n    scrollableRef.current?.scrollTo?.(0, 0);\n  }, [q, type]);\n\n  const [statusResults, setStatusResults] = useState([]);\n  const [accountResults, setAccountResults] = useState([]);\n  const [hashtagResults, setHashtagResults] = useState([]);\n  useEffect(() => {\n    setStatusResults([]);\n    setAccountResults([]);\n    setHashtagResults([]);\n  }, [q]);\n  const typeResults = {\n    statuses: statusResults,\n    accounts: accountResults,\n    hashtags: hashtagResults,\n  };\n  const setTypeResultsFunc = {\n    statuses: setStatusResults,\n    accounts: setAccountResults,\n    hashtags: setHashtagResults,\n  };\n\n  const [relationshipsMap, setRelationshipsMap] = useState({});\n  const loadRelationships = async (accounts) => {\n    if (!accounts?.length) return;\n    const relationships = await fetchRelationships(accounts, relationshipsMap);\n    if (relationships) {\n      setRelationshipsMap({\n        ...relationshipsMap,\n        ...relationships,\n      });\n    }\n  };\n\n  function loadResults(firstLoad) {\n    if (firstLoad) {\n      offsetRef.current = 0;\n    }\n\n    if (!firstLoad && !authenticated) {\n      // Search results pagination is only available to authenticated users\n      return;\n    }\n\n    setUIState('loading');\n    if (firstLoad && !type) {\n      setStatusResults(statusResults.slice(0, SHORT_LIMIT));\n      setAccountResults(accountResults.slice(0, SHORT_LIMIT));\n      setHashtagResults(hashtagResults.slice(0, SHORT_LIMIT));\n    }\n\n    (async () => {\n      const params = {\n        q,\n        resolve: authenticated,\n        limit: SHORT_LIMIT,\n      };\n      if (type) {\n        params.limit = LIMIT;\n        params.type = type;\n        if (authenticated) params.offset = offsetRef.current;\n      }\n\n      try {\n        const results = await masto.v2.search.list(params);\n        console.log(results);\n        if (type) {\n          if (firstLoad) {\n            setTypeResultsFunc[type](results[type]);\n            const length = results[type]?.length;\n            offsetRef.current = LIMIT;\n            setShowMore(!!length);\n          } else {\n            // If first item is the same, it means API doesn't support offset\n            // I know this is a very basic check, but it works for now\n            if (results[type]?.[0]?.id === typeResults[type]?.[0]?.id) {\n              setShowMore(false);\n            } else {\n              setTypeResultsFunc[type]((prev) => [...prev, ...results[type]]);\n              const length = results[type]?.length;\n              offsetRef.current = offsetRef.current + LIMIT;\n              setShowMore(!!length);\n            }\n          }\n        } else {\n          setStatusResults(results.statuses || []);\n          setAccountResults(results.accounts || []);\n          setHashtagResults(results.hashtags || []);\n          offsetRef.current = 0;\n          setShowMore(false);\n        }\n        loadRelationships(results.accounts);\n\n        setUIState('default');\n      } catch (err) {\n        console.error(err);\n        setUIState('error');\n      }\n    })();\n  }\n\n  const lastHiddenTime = useRef();\n  usePageVisibility((visible) => {\n    const reachStart = scrollableRef.current?.scrollTop === 0;\n    if (visible && reachStart) {\n      const timeDiff = Date.now() - lastHiddenTime.current;\n      if (!lastHiddenTime.current || timeDiff > 1000 * 3) {\n        // 3 seconds\n        loadResults(true);\n      } else {\n        lastHiddenTime.current = Date.now();\n      }\n    }\n  });\n\n  useEffect(() => {\n    let timer;\n    searchFormRef.current?.setValue?.(q || '');\n    if (q) {\n      loadResults(true);\n    } else {\n      timer = setTimeout(() => {\n        searchFormRef.current?.focus?.();\n      }, 150); // Right after focusDeck runs\n    }\n    return () => clearTimeout(timer);\n  }, [q, type, instance]);\n\n  useHotkeys(\n    ['Slash', '/'],\n    (e) => {\n      searchFormRef.current?.focus?.();\n      searchFormRef.current?.select?.();\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const itemsSelector = '.timeline > li > a, .hashtag-list > li > a';\n  const jRef = useHotkeys(\n    'j',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let nextItem = allItems[activeItemIndex + 1];\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k',\n    () => {\n      // focus on previous status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const [filterBarParent] = useAutoAnimate();\n\n  return (\n    <div\n      id=\"search-page\"\n      class=\"deck-container\"\n      tabIndex=\"-1\"\n      ref={(node) => {\n        scrollableRef.current = node;\n        jRef.current = node;\n        kRef.current = node;\n      }}\n    >\n      <div class=\"timeline-deck deck\">\n        <header class={uiState === 'loading' ? 'loading' : ''}>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n            </div>\n            <SearchForm ref={searchFormRef} />\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain\"\n                onClick={() => {\n                  loadResults(true);\n                }}\n                disabled={uiState === 'loading'}\n              >\n                <Icon icon=\"search\" size=\"l\" alt={t`Search`} />\n              </button>\n            </div>\n          </div>\n        </header>\n        <main>\n          {!!q && !columnMode && (\n            <div\n              ref={filterBarParent}\n              class={`filter-bar ${uiState === 'loading' ? 'loading' : ''}`}\n            >\n              {!!type && (\n                <Link to={`/search${q ? `?q=${encodeURIComponent(q)}` : ''}`}>\n                  <Icon icon=\"chevron-left\" /> <Trans>All</Trans>\n                </Link>\n              )}\n              {[\n                {\n                  label: t`Accounts`,\n                  type: 'accounts',\n                  to: `/search?q=${encodeURIComponent(q)}&type=accounts`,\n                },\n                {\n                  label: t`Hashtags`,\n                  type: 'hashtags',\n                  to: `/search?q=${encodeURIComponent(q)}&type=hashtags`,\n                },\n                {\n                  label: t`Posts`,\n                  type: 'statuses',\n                  to: `/search?q=${encodeURIComponent(q)}&type=statuses`,\n                },\n              ]\n                .sort((a, b) => {\n                  if (a.type === type) return -1;\n                  if (b.type === type) return 1;\n                  return 0;\n                })\n                .map((link) => (\n                  <Link to={link.to} key={link.type}>\n                    {link.label}\n                  </Link>\n                ))}\n            </div>\n          )}\n          {!!q ? (\n            <>\n              {(!type || type === 'accounts') && (\n                <>\n                  {type !== 'accounts' && (\n                    <h2 class=\"timeline-header\">\n                      <Trans>Accounts</Trans>{' '}\n                      <Link\n                        to={`/search?q=${encodeURIComponent(q)}&type=accounts`}\n                      >\n                        <Icon icon=\"arrow-right\" size=\"l\" alt={t`See more`} />\n                      </Link>\n                    </h2>\n                  )}\n                  {accountResults.length > 0 ? (\n                    <>\n                      <ul class=\"timeline flat accounts-list\">\n                        {accountResults.map((account) => (\n                          <li key={account.id}>\n                            <AccountBlock\n                              account={account}\n                              instance={instance}\n                              showStats\n                              relationship={relationshipsMap[account.id]}\n                            />\n                          </li>\n                        ))}\n                      </ul>\n                      {type !== 'accounts' && (\n                        <div class=\"ui-state\">\n                          <Link\n                            class=\"plain button\"\n                            to={`/search?q=${encodeURIComponent(\n                              q,\n                            )}&type=accounts`}\n                          >\n                            <Trans>See more accounts</Trans>{' '}\n                            <Icon icon=\"arrow-right\" />\n                          </Link>\n                        </div>\n                      )}\n                    </>\n                  ) : (\n                    !type &&\n                    (uiState === 'loading' ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      <p class=\"ui-state\">\n                        <Trans>No accounts found.</Trans>\n                      </p>\n                    ))\n                  )}\n                </>\n              )}\n              {(!type || type === 'hashtags') && (\n                <>\n                  {type !== 'hashtags' && (\n                    <h2 class=\"timeline-header\">\n                      <Trans>Hashtags</Trans>{' '}\n                      <Link\n                        to={`/search?q=${encodeURIComponent(q)}&type=hashtags`}\n                      >\n                        <Icon icon=\"arrow-right\" size=\"l\" alt={t`See more`} />\n                      </Link>\n                    </h2>\n                  )}\n                  {hashtagResults.length > 0 ? (\n                    <>\n                      <ul class=\"link-list hashtag-list\">\n                        {hashtagResults.map((hashtag) => {\n                          const { name, history } = hashtag;\n                          const total = history?.reduce?.(\n                            (acc, cur) => acc + +cur.uses,\n                            0,\n                          );\n                          return (\n                            <li key={`${name}-${total}`}>\n                              <Link\n                                to={\n                                  instance\n                                    ? `/${instance}/t/${name}`\n                                    : `/t/${name}`\n                                }\n                              >\n                                <Icon icon=\"hashtag\" alt=\"#\" />\n                                <span>{name}</span>\n                                {!!total && (\n                                  <span class=\"count\">\n                                    {shortenNumber(total)}\n                                  </span>\n                                )}\n                              </Link>\n                            </li>\n                          );\n                        })}\n                      </ul>\n                      {type !== 'hashtags' && (\n                        <div class=\"ui-state\">\n                          <Link\n                            class=\"plain button\"\n                            to={`/search?q=${encodeURIComponent(\n                              q,\n                            )}&type=hashtags`}\n                          >\n                            <Trans>See more hashtags</Trans>{' '}\n                            <Icon icon=\"arrow-right\" />\n                          </Link>\n                        </div>\n                      )}\n                    </>\n                  ) : (\n                    !type &&\n                    (uiState === 'loading' ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      <p class=\"ui-state\">\n                        <Trans>No hashtags found.</Trans>\n                      </p>\n                    ))\n                  )}\n                </>\n              )}\n              {(!type || type === 'statuses') && (\n                <>\n                  {type !== 'statuses' && (\n                    <h2 class=\"timeline-header\">\n                      <Trans>Posts</Trans>{' '}\n                      <Link\n                        to={`/search?q=${encodeURIComponent(q)}&type=statuses`}\n                      >\n                        <Icon icon=\"arrow-right\" size=\"l\" alt={t`See more`} />\n                      </Link>\n                    </h2>\n                  )}\n                  {statusResults.length > 0 ? (\n                    <>\n                      <ul class=\"timeline\">\n                        {statusResults.map((status) => (\n                          <li key={status.id}>\n                            <Link\n                              class=\"status-link\"\n                              to={\n                                instance\n                                  ? `/${instance}/s/${status.id}`\n                                  : `/s/${status.id}`\n                              }\n                            >\n                              <Status status={status} />\n                            </Link>\n                          </li>\n                        ))}\n                      </ul>\n                      {type !== 'statuses' && (\n                        <div class=\"ui-state\">\n                          <Link\n                            class=\"plain button\"\n                            to={`/search?q=${encodeURIComponent(\n                              q,\n                            )}&type=statuses`}\n                          >\n                            <Trans>See more posts</Trans>{' '}\n                            <Icon icon=\"arrow-right\" />\n                          </Link>\n                        </div>\n                      )}\n                    </>\n                  ) : (\n                    !type &&\n                    (uiState === 'loading' ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      <p class=\"ui-state\">\n                        <Trans>No posts found.</Trans>\n                      </p>\n                    ))\n                  )}\n                </>\n              )}\n              {!!type &&\n                (uiState === 'default' ? (\n                  showMore ? (\n                    <InView\n                      onChange={(inView) => {\n                        if (inView) {\n                          loadResults();\n                        }\n                      }}\n                    >\n                      <button\n                        type=\"button\"\n                        class=\"plain block\"\n                        onClick={() => loadResults()}\n                        style={{ marginBlockEnd: '6em' }}\n                      >\n                        <Trans>Show more</Trans>\n                      </button>\n                    </InView>\n                  ) : (\n                    <p class=\"ui-state insignificant\">\n                      <Trans>The end.</Trans>\n                    </p>\n                  )\n                ) : (\n                  uiState === 'loading' && (\n                    <p class=\"ui-state\">\n                      <Loader abrupt />\n                    </p>\n                  )\n                ))}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader abrupt />\n            </p>\n          ) : (\n            <>\n              <p class=\"ui-state insignificant\">\n                <Trans>\n                  Enter your search term or paste a URL above to get started.\n                </Trans>\n              </p>\n              <RecentSearches />\n            </>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}\n\nexport default Search;\n","import '../components/links-bar.css';\nimport './trending.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuItem } from '@szhsin/react-menu';\nimport { getBlurHashAverageColor } from 'fast-blurhash';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport punycode from 'punycode/';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Menu2 from '../components/menu2';\nimport NameText from '../components/name-text';\nimport RelativeTime from '../components/relative-time';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { oklab2rgb, rgb2oklab } from '../utils/color-utils';\nimport { filteredItems } from '../utils/filters';\nimport getDomain from '../utils/get-domain';\nimport pmem from '../utils/pmem';\nimport shortenNumber from '../utils/shorten-number';\nimport states, { saveStatus } from '../utils/states';\nimport supports from '../utils/supports';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\nconst TREND_CACHE_TIME = 10 * 60 * 1000; // 10 minutes\n\nconst fetchLinks = pmem(\n  (masto) => {\n    return masto.v1.trends.links.list().values().next();\n  },\n  {\n    maxAge: TREND_CACHE_TIME,\n  },\n);\n\nconst fetchHashtags = pmem(\n  (masto) => {\n    return masto.v1.trends.tags.list().values().next();\n  },\n  {\n    maxAge: TREND_CACHE_TIME,\n  },\n);\n\nfunction fetchTrendsStatuses(masto) {\n  if (supports('@pixelfed/trending')) {\n    return masto.pixelfed.v2.discover.posts.trending\n      .list({\n        range: 'daily',\n      })\n      .values();\n  }\n  return masto.v1.trends.statuses\n    .list({\n      limit: LIMIT,\n    })\n    .values();\n}\n\nfunction fetchLinkList(masto, params) {\n  return masto.v1.timelines.link.list(params).values();\n}\n\nfunction Trending({ columnMode, ...props }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const params = columnMode ? {} : useParams();\n  const { masto, instance } = api({\n    instance: props?.instance || params.instance,\n  });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const title = t`Trending (${instance})`;\n  useTitle(title, `/:instance?/trending`);\n  // const navigate = useNavigate();\n  const latestItem = useRef();\n\n  const sameCurrentInstance = instance === currentInstance;\n\n  const [hashtags, setHashtags] = useState([]);\n  const [links, setLinks] = useState([]);\n  const trendIterator = useRef();\n\n  async function fetchTrends(firstLoad) {\n    console.log('fetchTrend', firstLoad);\n    if (firstLoad || !trendIterator.current) {\n      trendIterator.current = fetchTrendsStatuses(masto);\n\n      // Get hashtags\n      if (supports('@mastodon/trending-hashtags')) {\n        try {\n          // const iterator = masto.v1.trends.tags.list();\n          const { value: tags } = await fetchHashtags(masto);\n          console.log('tags', tags);\n          if (tags?.length) {\n            setHashtags(tags);\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      }\n\n      // Get links\n      if (supports('@mastodon/trending-links')) {\n        try {\n          const { value } = await fetchLinks(masto, instance);\n          // 4 types available: link, photo, video, rich\n          // Only want links for now\n          const links = value?.filter?.((link) => link.type === 'link');\n          console.log('links', links);\n          if (links?.length) {\n            setLinks(links);\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    }\n    const results = await trendIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'public'); // Might not work here\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  // Link mentions\n  // https://github.com/mastodon/mastodon/pull/30381\n  const [currentLinkMentionsLoading, setCurrentLinkMentionsLoading] =\n    useState(false);\n  const currentLinkMentionsIterator = useRef();\n  const [currentLink, setCurrentLink] = useState(null);\n  const hasCurrentLink = !!currentLink;\n  const currentLinkRef = useRef();\n  const supportsTrendingLinkPosts =\n    sameCurrentInstance && supports('@mastodon/trending-link-posts');\n\n  useEffect(() => {\n    if (currentLink && currentLinkRef.current) {\n      currentLinkRef.current.scrollIntoView({\n        behavior: 'smooth',\n        block: 'nearest',\n        inline: 'center',\n      });\n    }\n  }, [currentLink]);\n\n  const prevCurrentLink = useRef();\n  async function fetchLinkMentions(firstLoad) {\n    if (firstLoad || !currentLinkMentionsIterator.current) {\n      setCurrentLinkMentionsLoading(true);\n      currentLinkMentionsIterator.current = fetchLinkList(masto, {\n        url: currentLink,\n      });\n    }\n    prevCurrentLink.current = currentLink;\n    const results = await currentLinkMentionsIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      value = filteredItems(value, 'public');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    if (prevCurrentLink.current === currentLink) {\n      setCurrentLinkMentionsLoading(false);\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.trends.statuses\n        .list({\n          limit: 1,\n          // NOT SUPPORTED\n          // since_id: latestItem.current,\n        })\n        .values()\n        .next();\n      let { value } = results;\n      value = filteredItems(value, 'public');\n      if (value?.length && value[0].id !== latestItem.current) {\n        latestItem.current = value[0].id;\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  const TimelineStart = useMemo(() => {\n    return (\n      <>\n        {!!hashtags.length && (\n          <div class=\"filter-bar expandable\">\n            <Icon icon=\"chart\" class=\"insignificant\" size=\"l\" />\n            {hashtags.map((tag, i) => {\n              const { name, history } = tag;\n              const total = history.reduce((acc, cur) => acc + +cur.uses, 0);\n              return (\n                <Link to={`/${instance}/t/${name}`} key={name}>\n                  <span dir=\"auto\">\n                    <span class=\"more-insignificant\">#</span>\n                    {name}\n                  </span>\n                  <span class=\"filter-count\">{shortenNumber(total)}</span>\n                </Link>\n              );\n            })}\n          </div>\n        )}\n        {!!links.length && (\n          <div class=\"links-bar\">\n            <header>\n              <h3>\n                <Trans>Trending News</Trans>\n              </h3>\n            </header>\n            {links.map((link) => {\n              const {\n                authors,\n                authorName,\n                authorUrl,\n                blurhash,\n                description,\n                height,\n                image,\n                imageDescription,\n                language,\n                providerName,\n                providerUrl,\n                publishedAt,\n                title,\n                url,\n                width,\n              } = link;\n              const author = authors?.[0]?.account?.id\n                ? authors[0].account\n                : null;\n              const isShortTitle = title.length < 30;\n              const hasAuthor = !!(authorName || author);\n              const domain = getDomain(url);\n              let accentColor;\n              if (blurhash) {\n                const averageColor = getBlurHashAverageColor(blurhash);\n                const labAverageColor = rgb2oklab(averageColor);\n                accentColor = oklab2rgb([\n                  0.6,\n                  labAverageColor[1],\n                  labAverageColor[2],\n                ]);\n              }\n\n              return (\n                <div key={url}>\n                  <a\n                    ref={currentLink === url ? currentLinkRef : null}\n                    href={url}\n                    target=\"_blank\"\n                    rel=\"noopener\"\n                    class={`link-block ${\n                      hasCurrentLink\n                        ? currentLink === url\n                          ? 'active'\n                          : 'inactive'\n                        : ''\n                    }`}\n                    style={\n                      accentColor\n                        ? {\n                            '--accent-color': `rgb(${accentColor.join(',')})`,\n                            '--accent-alpha-color': `rgba(${accentColor.join(\n                              ',',\n                            )}, 0.4)`,\n                          }\n                        : {}\n                    }\n                  >\n                    <article>\n                      <figure>\n                        <img\n                          src={image}\n                          alt={imageDescription}\n                          width={width}\n                          height={height}\n                          loading=\"lazy\"\n                        />\n                      </figure>\n                      <div class=\"article-body\">\n                        <header>\n                          <div class=\"article-meta\">\n                            <span class=\"domain\">{domain}</span>{' '}\n                            {!!publishedAt && <>&middot; </>}\n                            {!!publishedAt && (\n                              <>\n                                <RelativeTime\n                                  datetime={publishedAt}\n                                  format=\"micro\"\n                                />\n                              </>\n                            )}\n                          </div>\n                          {!!title && (\n                            <h1\n                              class=\"title\"\n                              lang={language}\n                              dir=\"auto\"\n                              title={title}\n                            >\n                              {title}\n                            </h1>\n                          )}\n                        </header>\n                        {!!description && (\n                          <p\n                            class={`description ${\n                              hasAuthor && !isShortTitle ? '' : 'more-lines'\n                            }`}\n                            lang={language}\n                            dir=\"auto\"\n                            title={description}\n                          >\n                            {description}\n                          </p>\n                        )}\n                        {hasAuthor && (\n                          <>\n                            <hr />\n                            <p class=\"byline\">\n                              <small>\n                                <Trans comment=\"By [Author]\">\n                                  By{' '}\n                                  {author ? (\n                                    <NameText account={author} showAvatar />\n                                  ) : authorUrl ? (\n                                    <a\n                                      href={authorUrl}\n                                      target=\"_blank\"\n                                      rel=\"noopener\"\n                                    >\n                                      {authorName}\n                                    </a>\n                                  ) : (\n                                    authorName\n                                  )}\n                                </Trans>\n                              </small>\n                            </p>\n                          </>\n                        )}\n                      </div>\n                    </article>\n                  </a>\n                  {supportsTrendingLinkPosts && (\n                    <button\n                      type=\"button\"\n                      class=\"small plain4 block\"\n                      onClick={() => {\n                        setCurrentLink(url);\n                      }}\n                      disabled={url === currentLink}\n                    >\n                      <Icon icon=\"comment2\" />{' '}\n                      <span>\n                        <Trans>Mentions</Trans>\n                      </span>{' '}\n                      <Icon icon=\"chevron-down\" />\n                    </button>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        )}\n        {supportsTrendingLinkPosts && !!links.length && (\n          <div\n            class={`timeline-header-block ${hasCurrentLink ? 'blended' : ''}`}\n          >\n            {hasCurrentLink ? (\n              <>\n                <div style={{ width: 50, flexShrink: 0, textAlign: 'center' }}>\n                  {currentLinkMentionsLoading ? (\n                    <Loader abrupt />\n                  ) : (\n                    <button\n                      type=\"button\"\n                      class=\"light\"\n                      onClick={() => {\n                        setCurrentLink(null);\n                      }}\n                    >\n                      <Icon icon=\"x\" alt={t`Back to showing trending posts`} />\n                    </button>\n                  )}\n                </div>\n                <p>\n                  <Trans>\n                    Showing posts mentioning{' '}\n                    <span class=\"link-text\">\n                      {currentLink\n                        .replace(/^https?:\\/\\/(www\\.)?/i, '')\n                        .replace(/\\/$/, '')}\n                    </span>\n                  </Trans>\n                </p>\n              </>\n            ) : (\n              <p class=\"insignificant\">\n                <Trans>Trending posts</Trans>\n              </p>\n            )}\n          </div>\n        )}\n      </>\n    );\n  }, [hashtags, links, currentLink, currentLinkMentionsLoading]);\n\n  return (\n    <Timeline\n      key={instance}\n      title={title}\n      titleComponent={\n        <h1 class=\"header-double-lines\">\n          <b>\n            <Trans>Trending</Trans>\n          </b>\n          <div>{instance}</div>\n        </h1>\n      }\n      id=\"trending\"\n      instance={instance}\n      emptyText={t`No trending posts.`}\n      errorText={t`Unable to load posts`}\n      fetchItems={hasCurrentLink ? fetchLinkMentions : fetchTrends}\n      checkForUpdates={hasCurrentLink ? undefined : checkForUpdates}\n      checkForUpdatesInterval={5 * 60 * 1000} // 5 minutes\n      useItemID\n      headerStart={<></>}\n      boostsCarousel={snapStates.settings.boostsCarousel}\n      // allowFilters\n      filterContext=\"public\"\n      timelineStart={TimelineStart}\n      refresh={currentLink}\n      clearWhenRefresh\n      view={hasCurrentLink ? 'link-mentions' : undefined}\n      headerEnd={\n        <Menu2\n          portal\n          // setDownOverflow\n          overflow=\"auto\"\n          viewScroll=\"close\"\n          position=\"anchor\"\n          menuButton={\n            <button type=\"button\" class=\"plain\">\n              <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n            </button>\n          }\n        >\n          <MenuItem\n            onClick={() => {\n              let newInstance = prompt(\n                t`Enter a new instance e.g. \"mastodon.social\"`,\n              );\n              if (!/\\./.test(newInstance)) {\n                if (newInstance) alert(t`Invalid instance`);\n                return;\n              }\n              if (newInstance) {\n                newInstance = newInstance.toLowerCase().trim();\n                // navigate(`/${newInstance}/trending`);\n                location.hash = `/${newInstance}/trending`;\n              }\n            }}\n          >\n            <Icon icon=\"bus\" />{' '}\n            <span>\n              <Trans>Go to another instance</Trans>\n            </span>\n          </MenuItem>\n          {currentInstance !== instance && (\n            <MenuItem\n              onClick={() => {\n                location.hash = `/${currentInstance}/trending`;\n              }}\n            >\n              <Icon icon=\"bus\" />{' '}\n              <small class=\"menu-double-lines\">\n                <Trans>\n                  Go to my instance (<b>{currentInstance}</b>)\n                </Trans>\n              </small>\n            </MenuItem>\n          )}\n        </Menu2>\n      }\n    />\n  );\n}\n\nexport default Trending;\n","import { useLingui } from '@lingui/react/macro';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSnapshot } from 'valtio';\n\nimport Bookmarks from '../pages/bookmarks';\nimport Favourites from '../pages/favourites';\nimport Following from '../pages/following';\nimport Hashtag from '../pages/hashtag';\nimport List from '../pages/list';\nimport Mentions from '../pages/mentions';\nimport Notifications from '../pages/notifications';\nimport Public from '../pages/public';\nimport Search from '../pages/search';\nimport Trending from '../pages/trending';\nimport isRTL from '../utils/is-rtl';\nimport states from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst scrollIntoViewOptions = {\n  block: 'nearest',\n  inline: 'nearest',\n  behavior: 'smooth',\n};\n\nfunction Columns() {\n  const { t } = useLingui();\n  useTitle(t`Home`, '/');\n  const snapStates = useSnapshot(states);\n  const { shortcuts } = snapStates;\n\n  console.debug('RENDER Columns', shortcuts);\n\n  const components = shortcuts.map((shortcut) => {\n    if (!shortcut) return null;\n    const { type, ...params } = shortcut;\n    const Component = {\n      following: Following,\n      notifications: Notifications,\n      list: List,\n      public: Public,\n      bookmarks: Bookmarks,\n      favourites: Favourites,\n      hashtag: Hashtag,\n      mentions: Mentions,\n      trending: Trending,\n      search: Search,\n    }[type];\n    if (!Component) return null;\n    // Don't show Search column with no query, for now\n    if (type === 'search' && !params.query) return null;\n    // Don't show List column with no list, for now\n    if (type === 'list' && !params.id) return null;\n    return (\n      <Component key={type + JSON.stringify(params)} {...params} columnMode />\n    );\n  });\n\n  useHotkeys(\n    ['1', '2', '3', '4', '5', '6', '7', '8', '9'],\n    (e) => {\n      try {\n        const index = parseInt(e.key, 10) - 1;\n        const $column = document.querySelectorAll('#columns > *')[index];\n        if ($column) {\n          $column.focus();\n          $column.scrollIntoView(scrollIntoViewOptions);\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  useHotkeys(\n    ['[', ']'],\n    (e, handler) => {\n      const key = handler.keys[0];\n      const currentFocusedColumn =\n        document.activeElement.closest('#columns > *');\n\n      const rtl = isRTL();\n      const prevColKey = rtl ? ']' : '[';\n      const nextColKey = rtl ? '[' : ']';\n      let $column;\n\n      if (key === prevColKey) {\n        // If [, focus on left of focused column, else first column\n        $column = currentFocusedColumn\n          ? currentFocusedColumn.previousElementSibling\n          : document.querySelectorAll('#columns > *')[0];\n      } else if (key === nextColKey) {\n        // If ], focus on right of focused column, else 2nd column\n        $column = currentFocusedColumn\n          ? currentFocusedColumn.nextElementSibling\n          : document.querySelectorAll('#columns > *')[1];\n      }\n      if ($column) {\n        $column.focus();\n        $column.scrollIntoView(scrollIntoViewOptions);\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  return (\n    <div\n      id=\"columns\"\n      onContextMenu={(e) => {\n        // If right-click on header, but not links or buttons\n        if (\n          e.target.closest('.deck > header') &&\n          !e.target.closest('a') &&\n          !e.target.closest('button')\n        ) {\n          e.preventDefault();\n          states.showShortcutsSettings = true;\n        }\n      }}\n      onFocus={() => {\n        // Get current focused column\n        const currentFocusedColumn =\n          document.activeElement.closest('#columns > *');\n        if (currentFocusedColumn) {\n          // Remove focus classes from all columns\n          // Add focus class to current focused column\n          document.querySelectorAll('#columns > *').forEach((column) => {\n            column.classList.toggle('focus', column === currentFocusedColumn);\n          });\n        }\n      }}\n    >\n      {components}\n    </div>\n  );\n}\n\nexport default Columns;\n","import './notifications-menu.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { ControlledMenu } from '@szhsin/react-menu';\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport Columns from '../components/columns';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Notification from '../components/notification';\nimport { api } from '../utils/api';\nimport db from '../utils/db';\nimport FilterContext from '../utils/filter-context';\nimport { massageNotifications2 } from '../utils/group-notifications';\nimport states, { saveStatus } from '../utils/states';\nimport { getCurrentAccountNS } from '../utils/store-utils';\n\nimport Following from './following';\nimport {\n  getGroupedNotifications,\n  mastoFetchNotifications,\n} from './notifications';\n\nfunction Home() {\n  const { _ } = useLingui();\n  const snapStates = useSnapshot(states);\n  __BENCHMARK.end('time-to-home');\n  useEffect(() => {\n    (async () => {\n      const keys = await db.drafts.keys();\n      if (keys.length) {\n        const ns = getCurrentAccountNS();\n        const ownKeys = keys.filter((key) => key.startsWith(ns));\n        if (ownKeys.length) {\n          states.showDrafts = true;\n        }\n      }\n    })();\n  }, []);\n\n  return (\n    <>\n      {(snapStates.settings.shortcutsViewMode === 'multi-column' ||\n        (!snapStates.settings.shortcutsViewMode &&\n          snapStates.settings.shortcutsColumnsMode)) &&\n      !!snapStates.shortcuts?.length ? (\n        <Columns />\n      ) : (\n        <Following\n          title={_(msg`Home`)}\n          path=\"/\"\n          id=\"home\"\n          headerStart={false}\n          headerEnd={<NotificationsLink />}\n        />\n      )}\n    </>\n  );\n}\n\nfunction NotificationsLink() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const notificationLinkRef = useRef();\n  const [menuState, setMenuState] = useState(undefined);\n  return (\n    <>\n      <Link\n        ref={notificationLinkRef}\n        to=\"/notifications\"\n        class={`button plain notifications-button ${\n          snapStates.notificationsShowNew ? 'has-badge' : ''\n        } ${menuState || ''}`}\n        onClick={(e) => {\n          e.stopPropagation();\n          if (window.matchMedia('(min-width: calc(40em))').matches) {\n            e.preventDefault();\n            setMenuState((state) => (!state ? 'open' : undefined));\n          }\n        }}\n      >\n        <Icon icon=\"notification\" size=\"l\" alt={t`Notifications`} />\n      </Link>\n      <NotificationsMenu\n        state={menuState}\n        anchorRef={notificationLinkRef}\n        onClose={() => setMenuState(undefined)}\n      />\n    </>\n  );\n}\n\nconst NOTIFICATIONS_DISPLAY_LIMIT = 5;\nfunction NotificationsMenu({ anchorRef, state, onClose }) {\n  const { masto, instance } = api();\n  const snapStates = useSnapshot(states);\n  const [uiState, setUIState] = useState('default');\n\n  const notificationsIterator = mastoFetchNotifications();\n\n  async function fetchNotifications() {\n    const allNotifications = await notificationsIterator.next();\n    const notifications = massageNotifications2(allNotifications.value);\n\n    if (notifications?.length) {\n      notifications.forEach((notification) => {\n        saveStatus(notification.status, instance, {\n          skipThreading: true,\n        });\n      });\n\n      const groupedNotifications = getGroupedNotifications(notifications);\n\n      states.notificationsLast = groupedNotifications[0];\n      states.notifications = groupedNotifications;\n\n      // Update last read marker\n      masto.v1.markers\n        .create({\n          notifications: {\n            lastReadId: groupedNotifications[0].id,\n          },\n        })\n        .catch(() => {});\n    }\n\n    states.notificationsShowNew = false;\n    states.notificationsLastFetchTime = Date.now();\n    return allNotifications;\n  }\n\n  const [hasFollowRequests, setHasFollowRequests] = useState(false);\n  function fetchFollowRequests() {\n    return masto.v1.followRequests.list({\n      limit: 1,\n    });\n  }\n\n  function loadNotifications({ skipFollowRequests = false } = {}) {\n    setUIState('loading');\n    (async () => {\n      try {\n        await fetchNotifications();\n        if (!skipFollowRequests) {\n          const followRequests = await fetchFollowRequests();\n          setHasFollowRequests(!!followRequests?.length);\n        }\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n      }\n    })();\n  }\n\n  const menuRef = useRef();\n  const headerHeight = 52;\n  useEffect(() => {\n    if (state !== 'open') return;\n    if (snapStates.notificationsShowNew) {\n      const menuElement = menuRef.current;\n      if (menuElement?.scrollTop <= headerHeight) {\n        loadNotifications({\n          skipFollowRequests: true,\n        });\n      }\n    } else {\n      loadNotifications();\n    }\n  }, [state, snapStates.notificationsShowNew]);\n\n  return (\n    <ControlledMenu\n      ref={menuRef}\n      menuClassName=\"notifications-menu\"\n      state={state}\n      anchorRef={anchorRef}\n      onClose={onClose}\n      portal={{\n        target: document.body,\n      }}\n      containerProps={{\n        onClick: () => {\n          menuRef.current?.closeMenu?.();\n        },\n      }}\n      overflow=\"auto\"\n      viewScroll=\"close\"\n      position=\"anchor\"\n      align=\"center\"\n      boundingBoxPadding=\"8 8 8 8\"\n    >\n      <header>\n        <h2>\n          <Trans>Notifications</Trans>\n        </h2>\n      </header>\n      <FilterContext.Provider value=\"notifications\">\n        <main>\n          {snapStates.notifications.length ? (\n            <>\n              {snapStates.notifications\n                .slice(0, NOTIFICATIONS_DISPLAY_LIMIT)\n                .map((notification) => (\n                  <Notification\n                    key={notification._ids || notification.id}\n                    instance={instance}\n                    notification={notification}\n                    disableContextMenu\n                  />\n                ))}\n            </>\n          ) : uiState === 'loading' ? (\n            <div class=\"ui-state\">\n              <Loader abrupt />\n            </div>\n          ) : (\n            uiState === 'error' && (\n              <div class=\"ui-state\">\n                <p>\n                  <Trans>Unable to fetch notifications.</Trans>\n                </p>\n                <p>\n                  <button type=\"button\" onClick={loadNotifications}>\n                    <Trans>Try again</Trans>\n                  </button>\n                </p>\n              </div>\n            )\n          )}\n        </main>\n      </FilterContext.Provider>\n      <footer>\n        <Link to=\"/mentions\" class=\"button plain\">\n          <Icon icon=\"at\" />{' '}\n          <span>\n            <Trans>Mentions</Trans>\n          </span>\n        </Link>\n        <Link to=\"/notifications\" class=\"button plain2\">\n          {hasFollowRequests ? (\n            <Trans>\n              <span class=\"tag collapsed\">New</span>{' '}\n              <span>Follow Requests</span>\n            </Trans>\n          ) : (\n            <b>\n              <Trans>See all</Trans>\n            </b>\n          )}{' '}\n          <Icon icon=\"arrow-right\" />\n        </Link>\n      </footer>\n    </ControlledMenu>\n  );\n}\n\nexport default memo(Home);\n","// export const statusRegex = /\\/@([^@\\/]+)@?([^\\/]+)?\\/([^\\/]+)\\/?$/i;\n// export const statusNoteRegex = /\\/notes\\/([^\\/]+)\\/?$/i;\n\nconst statusPostRegexes = [\n  /^\\/@[^@\\/]+\\/(?:statuses|posts)\\/([^\\/]+)/i, // GoToSocial, Takahe\n  /\\/notes\\/([^\\/]+)/i, // Misskey, Firefish\n  /^\\/(?:notice|objects)\\/([a-z0-9-]+)/i, // Pleroma\n  /\\/@[^@\\/]+\\/post\\/([^\\/]+)/i, // Threads\n  /\\/@[^@\\/]+@?[^\\/]+?\\/([^\\/]+)/i, // Mastodon\n  /^\\/p\\/[^\\/]+\\/([^\\/]+)/i, // Pixelfed\n];\n\nexport function getInstanceStatusObject(url) {\n  // Regex /:username/:id, where username = @username or @username@domain, id = anything\n  const theURL = URL.parse(url);\n  if (!theURL) return {};\n  const { hostname, pathname } = theURL;\n  // const [, username, domain, id] = pathname.match(statusRegex) || [];\n  for (const regex of statusPostRegexes) {\n    const [, id] = pathname.match(regex) || [];\n    console.log(pathname, regex, id);\n    if (id) {\n      return {\n        instance: hostname,\n        id,\n      };\n    }\n  }\n  return {};\n}\n\nfunction getInstanceStatusURL(url) {\n  const { instance, id } = getInstanceStatusObject(url);\n  if (instance && id) {\n    return `/${instance}/s/${id}`;\n  }\n  return null;\n}\n\nexport default getInstanceStatusURL;\n","import { Trans } from '@lingui/react/macro';\nimport { useLayoutEffect, useState } from 'preact/hooks';\nimport { useLocation } from 'react-router-dom';\n\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport { api } from '../utils/api';\nimport getInstanceStatusURL, {\n  getInstanceStatusObject,\n} from '../utils/get-instance-status-url';\n\nexport default function HttpRoute() {\n  const location = useLocation();\n  const url = location.pathname.replace(/^\\//, '');\n  const statusObject = getInstanceStatusObject(url);\n  // const statusURL = getInstanceStatusURL(url);\n  const statusURL = statusObject?.instance\n    ? `/${statusObject.instance}/s/${statusObject.id}`\n    : null;\n  const [uiState, setUIState] = useState('loading');\n\n  useLayoutEffect(() => {\n    setUIState('loading');\n    (async () => {\n      // Check if status returns 200\n      try {\n        const { instance, id } = statusObject;\n        if (id) {\n          const { masto } = api({ instance });\n          const status = await masto.v1.statuses.$select(id).fetch();\n          if (status) {\n            window.location.hash = statusURL + '?view=full';\n            return;\n          }\n        }\n      } catch (e) {}\n\n      // Fallback to search\n      {\n        const { masto: currentMasto, instance: currentInstance } = api();\n        const result = await currentMasto.v2.search.list({\n          q: url,\n          limit: 1,\n          resolve: true,\n        });\n        if (result.statuses.length) {\n          const status = result.statuses[0];\n          window.location.hash = `/${currentInstance}/s/${status.id}?view=full`;\n        } else if (result.accounts.length) {\n          const account = result.accounts[0];\n          window.location.hash = `/${currentInstance}/a/${account.id}`;\n        } else if (statusURL) {\n          // Fallback to original URL, which will probably show error\n          window.location.hash = statusURL + '?view=full';\n        } else {\n          setUIState('error');\n        }\n      }\n    })();\n  }, [statusURL]);\n\n  return (\n    <div class=\"ui-state\" tabIndex=\"-1\">\n      {uiState === 'loading' ? (\n        <>\n          <Loader abrupt />\n          <h2>\n            <Trans>Resolving</Trans>\n          </h2>\n          <p>\n            <a href={url} target=\"_blank\" rel=\"noopener\">\n              {url}\n            </a>\n          </p>\n        </>\n      ) : (\n        <>\n          <h2>\n            <Trans>Unable to resolve URL</Trans>\n          </h2>\n          <p>\n            <a href={url} target=\"_blank\" rel=\"noopener\">\n              {url}\n            </a>\n          </p>\n        </>\n      )}\n      <hr />\n      <p>\n        <Link to=\"/\">\n          <Trans>Go home</Trans>\n        </Link>\n      </p>\n    </div>\n  );\n}\n","import './lists.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useReducer, useState } from 'preact/hooks';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport ListAddEdit from '../components/list-add-edit';\nimport ListExclusiveBadge from '../components/list-exclusive-badge';\nimport Loader from '../components/loader';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport { fetchLists } from '../utils/lists';\nimport useTitle from '../utils/useTitle';\n\nfunction Lists() {\n  const { t } = useLingui();\n  useTitle(t`Lists`, `/l`);\n  const [uiState, setUIState] = useState('default');\n\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n  const [lists, setLists] = useState([]);\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const lists = await fetchLists();\n        console.log(lists);\n        setLists(lists);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  const [showListAddEditModal, setShowListAddEditModal] = useState(false);\n\n  const hasExclusiveLists = lists.some((list) => list.exclusive);\n\n  return (\n    <div id=\"lists-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Lists</Trans>\n            </h1>\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain\"\n                onClick={() => setShowListAddEditModal(true)}\n              >\n                <Icon icon=\"plus\" size=\"l\" alt={t`New list`} />\n              </button>\n            </div>\n          </div>\n        </header>\n        <main>\n          {lists.length > 0 ? (\n            <>\n              <ul class=\"link-list\">\n                {lists.map((list) => (\n                  <li>\n                    <Link to={`/l/${list.id}`}>\n                      <Icon icon=\"list\" />{' '}\n                      <span>\n                        {list.title}\n                        {list.exclusive && (\n                          <>\n                            {' '}\n                            <ListExclusiveBadge insignificant />\n                          </>\n                        )}\n                      </span>\n                      {/* <button\n                      type=\"button\"\n                      class=\"plain\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setShowListAddEditModal({\n                          list,\n                        });\n                      }}\n                    >\n                      <Icon icon=\"pencil\" />\n                    </button> */}\n                    </Link>\n                  </li>\n                ))}\n              </ul>\n              {lists.length > 1 && (\n                <footer class=\"ui-state\">\n                  {hasExclusiveLists && (\n                    <p>\n                      <small class=\"insignificant\">\n                        <ListExclusiveBadge />{' '}\n                        <Trans>\n                          Posts on this list are hidden from Home/Following\n                        </Trans>\n                      </small>\n                    </p>\n                  )}\n                  <p>\n                    <small class=\"insignificant\">\n                      <Plural\n                        value={lists.length}\n                        one=\"# list\"\n                        other=\"# lists\"\n                      />\n                    </small>\n                  </p>\n                </footer>\n              )}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader />\n            </p>\n          ) : uiState === 'error' ? (\n            <p class=\"ui-state\">\n              <Trans>Unable to load lists.</Trans>\n            </p>\n          ) : (\n            <p class=\"ui-state\">\n              <Trans>No lists yet.</Trans>\n            </p>\n          )}\n        </main>\n      </div>\n      {showListAddEditModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowListAddEditModal(false);\n            }\n          }}\n        >\n          <ListAddEdit\n            list={showListAddEditModal?.list}\n            onClose={(result) => {\n              if (result.state === 'success') {\n                reload();\n              }\n              setShowListAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nexport default Lists;\n","export default \"__VITE_ASSET__Bj_CmqRM__\"","export function openAuthPopup(url) {\n  const width = Math.min(500, Math.floor(window.screen.width * 0.9));\n  const height = Math.min(600, Math.floor(window.screen.height * 0.8));\n\n  const features = `popup,width=${width},height=${height}`;\n\n  try {\n    const popup = window.open(url, 'auth-popup', features);\n    if (!popup || popup.closed || typeof popup.closed === 'undefined') {\n      return null;\n    }\n    return popup;\n  } catch (e) {\n    console.error('Failed to open popup:', e);\n    return null;\n  }\n}\n\nexport function closeAuthPopup(popup) {\n  if (popup && !popup.closed) {\n    try {\n      popup.close();\n    } catch (e) {\n      console.error('Failed to close popup:', e);\n    }\n  }\n}\n\nexport function watchAuthPopup(popup, onSuccess, onError) {\n  let resolved = false;\n\n  const messageHandler = (event) => {\n    // Security: verify event origin matches current origin\n    if (event.origin !== window.location.origin) {\n      return;\n    }\n\n    if (event.data && event.data.type === 'oauth-callback') {\n      resolved = true;\n      cleanup();\n\n      if (event.data.code) {\n        onSuccess(event.data.code);\n      } else {\n        onError(new Error('No authorization code received'));\n      }\n    }\n  };\n\n  window.addEventListener('message', messageHandler);\n\n  const pollInterval = setInterval(() => {\n    if (!popup || popup.closed) {\n      clearInterval(pollInterval);\n      if (!resolved) {\n        resolved = true;\n        cleanup();\n        onError(new Error('Popup was closed before authentication completed'));\n      }\n    }\n  }, 500);\n\n  const cleanup = () => {\n    window.removeEventListener('message', messageHandler);\n    clearInterval(pollInterval);\n    closeAuthPopup(popup);\n  };\n\n  return cleanup;\n}\n","import './login.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport Fuse from 'fuse.js';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSearchParams } from 'react-router-dom';\n\nimport logo from '../assets/logo.svg';\n\nimport LangSelector from '../components/lang-selector';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport instancesListURL from '../data/instances.json?url';\nimport {\n  getAuthorizationURL,\n  getPKCEAuthorizationURL,\n  registerApplication,\n} from '../utils/auth';\nimport { openAuthPopup, watchAuthPopup } from '../utils/auth-popup';\nimport { supportsPKCE } from '../utils/oauth-pkce';\nimport store from '../utils/store';\nimport {\n  getCredentialApplication,\n  hasAccountInInstance,\n  storeCredentialApplication,\n} from '../utils/store-utils';\nimport useTitle from '../utils/useTitle';\n\nconst { PHANPY_DEFAULT_INSTANCE: DEFAULT_INSTANCE } = import.meta.env;\n\nfunction Login() {\n  const { t } = useLingui();\n  useTitle(t`Log in`, '/login');\n  const instanceURLRef = useRef();\n  const cachedInstanceURL = store.local.get('instanceURL');\n  const [uiState, setUIState] = useState('default');\n  const [searchParams] = useSearchParams();\n  const instance = searchParams.get('instance');\n  const submit = searchParams.get('submit');\n  const [instanceText, setInstanceText] = useState(\n    instance || cachedInstanceURL?.toLowerCase() || '',\n  );\n\n  const [instancesList, setInstancesList] = useState([]);\n  const searcher = useRef();\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(instancesListURL);\n        const data = await res.json();\n        setInstancesList(data);\n        searcher.current = new Fuse(data);\n      } catch (e) {\n        // Silently fail\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  // useEffect(() => {\n  //   if (cachedInstanceURL) {\n  //     instanceURLRef.current.value = cachedInstanceURL.toLowerCase();\n  //   }\n  // }, []);\n\n  const submitInstance = (instanceURL) => {\n    if (!instanceURL) return;\n\n    (async () => {\n      // WEB_DOMAIN vs LOCAL_DOMAIN negotiation time\n      // https://docs.joinmastodon.org/admin/config/#web_domain\n      try {\n        const res = await fetch(`https://${instanceURL}/.well-known/host-meta`); // returns XML\n        const text = await res.text();\n        // Parse XML\n        const parser = new DOMParser();\n        const xmlDoc = parser.parseFromString(text, 'text/xml');\n        // Get Link[template]\n        const link = xmlDoc.getElementsByTagName('Link')[0];\n        const template = link.getAttribute('template');\n        const url = URL.parse(template);\n        const { host } = url; // host includes the port\n        if (instanceURL !== host) {\n          console.log(` ${instanceURL} -> ${host}`);\n          instanceURL = host;\n        }\n      } catch (e) {\n        // Silently fail\n        console.error(e);\n      }\n\n      store.local.set('instanceURL', instanceURL);\n\n      setUIState('loading');\n      try {\n        let credentialApplication = getCredentialApplication(instanceURL);\n        if (\n          !credentialApplication ||\n          !credentialApplication.client_id ||\n          !credentialApplication.client_secret\n        ) {\n          credentialApplication = await registerApplication({\n            instanceURL,\n          });\n          storeCredentialApplication(instanceURL, credentialApplication);\n        }\n\n        const { client_id, client_secret } = credentialApplication;\n\n        const authPKCE = await supportsPKCE({ instanceURL });\n        console.log({ authPKCE });\n        const forceLogin = hasAccountInInstance(instanceURL);\n\n        let authUrl;\n        if (authPKCE && window.isSecureContext) {\n          if (client_id && client_secret) {\n            const [url, verifier] = await getPKCEAuthorizationURL({\n              instanceURL,\n              client_id,\n              forceLogin,\n            });\n            store.sessionCookie.set('codeVerifier', verifier);\n            authUrl = url;\n          } else {\n            alert(t`Failed to register application`);\n            setUIState('default');\n            return;\n          }\n        } else {\n          if (client_id && client_secret) {\n            authUrl = await getAuthorizationURL({\n              instanceURL,\n              client_id,\n              forceLogin,\n            });\n          } else {\n            alert(t`Failed to register application`);\n            setUIState('default');\n            return;\n          }\n        }\n\n        const popup = openAuthPopup(authUrl);\n\n        if (popup) {\n          watchAuthPopup(\n            popup,\n            (code) => {\n              const callbackUrl = `${window.location.origin}${window.location.pathname}?code=${encodeURIComponent(code)}`;\n              window.location.href = callbackUrl;\n            },\n            (error) => {\n              console.error('Popup auth error:', error);\n              setUIState('error');\n            },\n          );\n        } else {\n          // Popup blocked, fallback to redirect\n          console.log('Popup blocked, falling back to redirect');\n          location.href = authUrl;\n        }\n\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  };\n\n  const cleanInstanceText = instanceText\n    ? instanceText\n        .replace(/^https?:\\/\\//, '') // Remove protocol from instance URL\n        .replace(/\\/+$/, '') // Remove trailing slash\n        .replace(/^@?[^@]+@/, '') // Remove @?acct@\n        .trim()\n    : null;\n  const instanceTextLooksLikeDomain =\n    /[^\\s\\r\\n\\t\\/\\\\]+\\.[^\\s\\r\\n\\t\\/\\\\]+/.test(cleanInstanceText) &&\n    !/[\\s\\/\\\\@]/.test(cleanInstanceText);\n\n  const instancesSuggestions = cleanInstanceText\n    ? searcher.current\n        ?.search(cleanInstanceText, {\n          limit: 10,\n        })\n        ?.map((match) => match.item)\n    : [];\n\n  const selectedInstanceText = instanceTextLooksLikeDomain\n    ? cleanInstanceText\n    : instancesSuggestions?.length\n      ? instancesSuggestions[0]\n      : instanceText\n        ? instancesList.find((instance) => instance.includes(instanceText))\n        : null;\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    // const { elements } = e.target;\n    // let instanceURL = elements.instanceURL.value.toLowerCase();\n    // // Remove protocol from instance URL\n    // instanceURL = instanceURL.replace(/^https?:\\/\\//, '').replace(/\\/+$/, '');\n    // // Remove @acct@ or acct@ from instance URL\n    // instanceURL = instanceURL.replace(/^@?[^@]+@/, '');\n    // if (!/\\./.test(instanceURL)) {\n    //   instanceURL = instancesList.find((instance) =>\n    //     instance.includes(instanceURL),\n    //   );\n    // }\n    // submitInstance(instanceURL);\n    submitInstance(selectedInstanceText);\n  };\n\n  if (submit) {\n    useEffect(() => {\n      submitInstance(instance || selectedInstanceText);\n    }, []);\n  }\n\n  return (\n    <main id=\"login\" style={{ textAlign: 'center' }}>\n      <form onSubmit={onSubmit}>\n        <h1>\n          <img src={logo} alt=\"\" width=\"80\" height=\"80\" />\n          <br />\n          <Trans>Log in</Trans>\n        </h1>\n        <label>\n          <p>\n            <Trans>Instance</Trans>\n          </p>\n          <input\n            value={instanceText}\n            required\n            type=\"text\"\n            class=\"large\"\n            id=\"instanceURL\"\n            ref={instanceURLRef}\n            disabled={uiState === 'loading'}\n            // list=\"instances-list\"\n            autocorrect=\"off\"\n            autocapitalize=\"off\"\n            autocomplete=\"off\"\n            spellCheck={false}\n            placeholder={t`instance domain`}\n            enterKeyHint=\"go\"\n            onInput={(e) => {\n              setInstanceText(e.target.value);\n            }}\n            dir=\"auto\"\n          />\n          {instancesSuggestions?.length > 0 ? (\n            <ul id=\"instances-suggestions\">\n              {instancesSuggestions.map((instance, i) => (\n                <li>\n                  <button\n                    type=\"button\"\n                    class=\"plain5\"\n                    onClick={() => {\n                      submitInstance(instance);\n                    }}\n                  >\n                    {instance}\n                  </button>\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <div id=\"instances-eg\">\n              <Trans>e.g. &ldquo;mastodon.social&rdquo;</Trans>\n            </div>\n          )}\n          {/* <datalist id=\"instances-list\">\n            {instancesList.map((instance) => (\n              <option value={instance} />\n            ))}\n          </datalist> */}\n        </label>\n        {uiState === 'error' && (\n          <p class=\"error\">\n            <Trans>\n              Failed to log in. Please try again or try another instance.\n            </Trans>\n          </p>\n        )}\n        <div>\n          <button\n            disabled={\n              uiState === 'loading' || !instanceText || !selectedInstanceText\n            }\n          >\n            {selectedInstanceText\n              ? t`Continue with ${selectedInstanceText}`\n              : t`Continue`}\n          </button>{' '}\n        </div>\n        <Loader hidden={uiState !== 'loading'} />\n        <hr />\n        {!DEFAULT_INSTANCE && (\n          <p>\n            <a href=\"https://joinmastodon.org/servers\" target=\"_blank\">\n              <Trans>Don't have an account? Create one!</Trans>\n            </a>\n          </p>\n        )}\n        <p>\n          <Link to=\"/\">\n            <Trans>Go home</Trans>\n          </Link>\n        </p>\n        <LangSelector />\n      </form>\n    </main>\n  );\n}\n\nexport default Login;\n","import './scheduled-posts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useMemo, useReducer, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport MenuConfirm from '../components/menu-confirm';\nimport Menu2 from '../components/menu2';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport RelativeTime from '../components/relative-time';\nimport ScheduledAtField, {\n  getLocalTimezoneName,\n} from '../components/ScheduledAtField';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport niceDateTime from '../utils/nice-date-time';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus, statusKey } from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 40;\n\nexport default function ScheduledPosts() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  useTitle(t`Scheduled Posts`, '/sp');\n  const { masto } = api();\n  const [scheduledPosts, setScheduledPosts] = useState([]);\n  const [uiState, setUIState] = useState('default');\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n  const [showScheduledPostModal, setShowScheduledPostModal] = useState(false);\n\n  useEffect(reload, [snapStates.reloadScheduledPosts]);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const postsIterator = masto.v1.scheduledStatuses\n          .list({ limit: LIMIT })\n          .values();\n        const allPosts = [];\n        let posts;\n        do {\n          const result = await postsIterator.next();\n          posts = result.value;\n          if (posts?.length) {\n            allPosts.push(...posts);\n          }\n        } while (posts?.length);\n        setScheduledPosts(allPosts);\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      } finally {\n        setUIState('default');\n      }\n    })();\n  }, [reloadCount]);\n\n  return (\n    <div id=\"scheduled-posts-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Scheduled Posts</Trans>\n            </h1>\n            <div class=\"header-side\">\n              <Menu2\n                portal\n                setDownOverflow\n                overflow=\"auto\"\n                viewScroll=\"close\"\n                position=\"anchor\"\n                menuButton={\n                  <button type=\"button\" class=\"plain\">\n                    <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n                  </button>\n                }\n              >\n                <MenuItem\n                  onClick={() => {\n                    reload();\n                  }}\n                >\n                  <Icon icon=\"refresh\" size=\"l\" />\n                  <span>\n                    <Trans>Refresh</Trans>\n                  </span>\n                </MenuItem>\n              </Menu2>\n            </div>\n          </div>\n        </header>\n        <main>\n          {!scheduledPosts.length ? (\n            <p class=\"ui-state\">\n              {uiState === 'loading' ? <Loader /> : t`No scheduled posts.`}\n            </p>\n          ) : (\n            <ul class=\"posts-list\">\n              {scheduledPosts.map((post) => {\n                const { id, params, scheduledAt, mediaAttachments } = post;\n                const {\n                  inReplyToId,\n                  language,\n                  poll,\n                  sensitive,\n                  spoilerText,\n                  text,\n                  visibility,\n                  quotedStatusId,\n                  quoteApprovalPolicy,\n                } = params;\n                const status = {\n                  // account: account.info,\n                  id,\n                  inReplyToId,\n                  language,\n                  mediaAttachments,\n                  poll: poll\n                    ? {\n                        ...poll,\n                        expiresAt: new Date(Date.now() + poll.expiresIn * 1000),\n                        options: poll.options.map((option) => ({\n                          title: option,\n                          votesCount: 0,\n                        })),\n                      }\n                    : undefined,\n                  sensitive,\n                  spoilerText,\n                  text,\n                  visibility,\n                  content: `<p>${text}</p>`,\n                  // createdAt: scheduledAt,\n                  quotedStatusId,\n                  quoteApprovalPolicy,\n                };\n\n                return (\n                  <li key={id}>\n                    <ScheduledPostPreview\n                      status={status}\n                      scheduledAt={scheduledAt}\n                      onClick={() => {\n                        setShowScheduledPostModal({\n                          post: status,\n                          scheduledAt: new Date(scheduledAt),\n                        });\n                      }}\n                    />\n                  </li>\n                );\n              })}\n            </ul>\n          )}\n          {showScheduledPostModal && (\n            <Modal\n              onClick={(e) => {\n                if (e.target === e.currentTarget) {\n                  setShowScheduledPostModal(false);\n                }\n              }}\n            >\n              <ScheduledPostEdit\n                post={showScheduledPostModal.post}\n                scheduledAt={showScheduledPostModal.scheduledAt}\n                onClose={() => setShowScheduledPostModal(false)}\n              />\n            </Modal>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}\n\nfunction ScheduledPostPreview({ status, scheduledAt, onClick }) {\n  // Look at scheduledAt, if it's months away, ICON = 'month'. If it's days away, ICON = 'day', else ICON = 'time'\n  const icon = useMemo(() => {\n    const hours = (Date.parse(scheduledAt) - Date.now()) / (1000 * 60 * 60);\n    if (hours < 24) {\n      return 'time';\n    } else if (hours < 720) {\n      // 30 days\n      return 'day';\n    } else {\n      return 'month';\n    }\n  }, [scheduledAt]);\n\n  return (\n    <button type=\"button\" class=\"textual block\" onClick={onClick}>\n      <div class={`post-schedule-meta post-schedule-${icon}`}>\n        <Icon icon={icon} class=\"insignificant\" />{' '}\n        <span>\n          <Trans comment=\"Scheduled [in 1 day] ([Thu, Feb 27, 6:30:00 PM])\">\n            Scheduled{' '}\n            <b>\n              <RelativeTime datetime={scheduledAt} />\n            </b>{' '}\n            <small>\n              (\n              {niceDateTime(scheduledAt, {\n                formatOpts: {\n                  weekday: 'short',\n                  second: 'numeric',\n                },\n              })}\n              )\n            </small>\n          </Trans>\n        </span>\n      </div>\n      <Status status={status} size=\"s\" previewMode readOnly />\n    </button>\n  );\n}\n\nfunction ScheduledPostEdit({ post, scheduledAt, onClose }) {\n  const { masto, instance } = api();\n  const { t } = useLingui();\n  const [uiState, setUIState] = useState('default');\n  const [newScheduledAt, setNewScheduledAt] = useState();\n  const differentScheduledAt =\n    newScheduledAt && newScheduledAt.getTime() !== scheduledAt.getTime();\n  const localTZ = getLocalTimezoneName();\n  const pastSchedule = scheduledAt && scheduledAt <= Date.now();\n\n  const { inReplyToId } = post;\n  const [replyToStatus, setReplyToStatus] = useState(null);\n  // TODO: Uncomment this once https://github.com/mastodon/mastodon/issues/34000 is fixed\n  // useEffect(() => {\n  //   if (inReplyToId) {\n  //     (async () => {\n  //       try {\n  //         const status = await masto.v1.statuses.$select(inReplyToId).fetch();\n  //         setReplyToStatus(status);\n  //       } catch (e) {\n  //         console.error(e);\n  //       }\n  //     })();\n  //   }\n  // }, [inReplyToId]);\n\n  const { quotedStatusId } = post;\n  // TODO: Uncomment this once https://github.com/mastodon/mastodon/issues/36536 is fixed\n  // useEffect(() => {\n  //   if (post.id && quotedStatusId) {\n  //     (async () => {\n  //       try {\n  //         const quotedStatus = await masto.v1.statuses\n  //           .$select(quotedStatusId)\n  //           .fetch();\n  //         saveStatus(quotedStatus, instance);\n  //         const sKey = statusKey(post.id, instance);\n  //         states.statusQuotes[sKey] = [\n  //           {\n  //             id: quotedStatus.id,\n  //             instance,\n  //             url: `/${instance}/s/${quotedStatus.id}`,\n  //             native: true,\n  //           },\n  //         ];\n  //       } catch (e) {\n  //         console.error('Failed to fetch quoted status:', e);\n  //       }\n  //     })();\n  //   }\n  // }, [post.id, quotedStatusId]);\n\n  return (\n    <div id=\"scheduled-post-sheet\" class=\"sheet\">\n      <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n        <Icon icon=\"x\" size=\"l\" alt={t`Close`} />\n      </button>\n      <header>\n        <h2>\n          <Trans comment=\"Scheduled [in 1 day]\">\n            Scheduled{' '}\n            <b>\n              <RelativeTime datetime={scheduledAt} />\n            </b>\n          </Trans>\n          <br />\n          <small>\n            {niceDateTime(scheduledAt, {\n              formatOpts: {\n                weekday: 'short',\n                second: 'numeric',\n              },\n            })}\n          </small>\n        </h2>\n      </header>\n      <main tabIndex=\"-1\">\n        {!!replyToStatus && (\n          <div class=\"status-reply\">\n            <Status status={replyToStatus} size=\"s\" previewMode readOnly />\n          </div>\n        )}\n        <Status\n          status={post}\n          size=\"s\"\n          previewMode\n          readOnly\n          onMediaClick={(e, i, media, status) => {\n            e.preventDefault();\n            states.showMediaModal = {\n              mediaAttachments: post.mediaAttachments,\n              mediaIndex: i,\n            };\n          }}\n        />\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n            setUIState('loading');\n            (async () => {\n              try {\n                await masto.v1.scheduledStatuses.$select(post.id).update({\n                  scheduledAt: newScheduledAt.toISOString(),\n                });\n                showToast(t`Scheduled post rescheduled`);\n                onClose();\n                setUIState('default');\n                states.reloadScheduledPosts++;\n              } catch (e) {\n                setUIState('error');\n                console.error(e);\n                showToast(t`Failed to reschedule post`);\n              }\n            })();\n          }}\n        >\n          <footer>\n            <div class=\"row\">\n              <span>\n                <ScheduledAtField\n                  scheduledAt={scheduledAt}\n                  setScheduledAt={(date) => {\n                    setNewScheduledAt(date);\n                  }}\n                />{' '}\n                <small class=\"ib\">{localTZ}</small>\n              </span>\n            </div>\n            <div class=\"row\">\n              <button\n                disabled={\n                  !differentScheduledAt || uiState === 'loading' || pastSchedule\n                }\n              >\n                <Trans>Reschedule</Trans>\n              </button>\n              <span class=\"grow\" />\n              <MenuConfirm\n                align=\"end\"\n                menuItemClassName=\"danger\"\n                confirmLabel={t`Delete scheduled post?`}\n                onClick={() => {\n                  setUIState('loading');\n                  (async () => {\n                    try {\n                      await api()\n                        .masto.v1.scheduledStatuses.$select(post.id)\n                        .remove();\n                      showToast(t`Scheduled post deleted`);\n                      onClose();\n                      setUIState('default');\n                      states.reloadScheduledPosts++;\n                    } catch (e) {\n                      setUIState('error');\n                      console.error(e);\n                      showToast(t`Failed to delete scheduled post`);\n                    }\n                  })();\n                }}\n              >\n                <button\n                  type=\"button\"\n                  class=\"light danger\"\n                  disabled={uiState === 'loading' || pastSchedule}\n                >\n                  <Trans>Delete</Trans>\n                </button>\n              </MenuConfirm>\n            </div>\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n","import { useLingui } from '@lingui/react/macro';\n\nimport { useEditHistory } from '../utils/edit-history-context';\n\nimport Icon from './icon';\n\nexport default function EditHistoryControls() {\n  const { t } = useLingui();\n  const {\n    prevEditedAt,\n    nextEditedAt,\n    editedAtIndex,\n    editHistoryMode,\n    editHistoryRef,\n    exitEditHistory,\n  } = useEditHistory();\n  if (!editHistoryMode) return null;\n  return (\n    <div class=\"edit-history-controls\">\n      <Icon icon=\"edit\" />\n      <b class=\"edit-history-heading\">{t`Edit History Snapshots`}</b>\n      <span class=\"spacer\" />\n      <span class=\"edit-history-pagination\">\n        <button\n          type=\"button\"\n          class=\"plain4\"\n          onClick={() => {\n            prevEditedAt();\n          }}\n          disabled={\n            !editHistoryMode ||\n            editedAtIndex + 1 >= editHistoryRef.current.length\n          }\n        >\n          <Icon icon=\"chevron-left\" alt={t`Previous`} />\n        </button>{' '}\n        {editHistoryRef.current.length - editedAtIndex} /{' '}\n        {editHistoryRef.current.length}{' '}\n        <button\n          type=\"button\"\n          class=\"plain4\"\n          onClick={() => {\n            nextEditedAt();\n          }}\n          disabled={!editHistoryMode || editedAtIndex <= 0}\n        >\n          <Icon icon=\"chevron-right\" alt={t`Next`} />\n        </button>\n      </span>\n      <button\n        type=\"button\"\n        class=\"plain3\"\n        onClick={() => {\n          exitEditHistory();\n        }}\n      >\n        <Icon icon=\"exit\" alt={t`Exit`} />\n      </button>\n    </div>\n  );\n}\n","import './status.css';\n\nimport { plural } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuHeader, MenuItem } from '@szhsin/react-menu';\nimport debounce from 'just-debounce-it';\nimport pRetry from 'p-retry';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport punycode from 'punycode/';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { matchPath, useSearchParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport Avatar from '../components/avatar';\nimport EditHistoryControls from '../components/edit-history-controls';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport { getSafeViewTransitionName } from '../components/media';\nimport MediaModal from '../components/media-modal';\nimport Menu2 from '../components/menu2';\nimport NameText from '../components/name-text';\nimport RelativeTime from '../components/relative-time';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport {\n  EditHistoryProvider,\n  useEditHistory,\n} from '../utils/edit-history-context';\nimport htmlContentLength from '../utils/html-content-length';\nimport shortenNumber from '../utils/shorten-number';\nimport states, {\n  getStatus,\n  saveStatus,\n  statusKey,\n  threadifyStatus,\n} from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport { getCurrentAccount } from '../utils/store-utils';\nimport useTitle from '../utils/useTitle';\n\nimport getInstanceStatusURL from './../utils/get-instance-status-url';\n\nconst { PHANPY_DEFAULT_INSTANCE: DEFAULT_INSTANCE } = import.meta.env;\n\nconst LIMIT = 40;\nconst SUBCOMMENTS_OPEN_ALL_LIMIT = 10;\nconst MAX_WEIGHT = 5;\n\nlet cachedRepliesToggle = {};\nlet cachedStatusesMap = {};\nlet scrollPositions = {};\nfunction resetScrollPosition(id) {\n  delete cachedStatusesMap[id];\n  delete scrollPositions[id];\n}\n\nconst scrollIntoViewOptions = {\n  block: 'nearest',\n  inline: 'center',\n  behavior: 'smooth',\n};\n\n// Select all statuses except those inside collapsed details/summary\n// Hat-tip to @AmeliaBR@front-end.social\n// https://front-end.social/@AmeliaBR/109784776146144471\nconst STATUSES_SELECTOR =\n  '.status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)';\n\nconst STATUS_URL_REGEX = /\\/s\\//i;\n\nimport { ThreadCountContext } from '../utils/thread-count-context';\n\nfunction StatusPage(params) {\n  const { id } = params;\n  const { masto, instance } = api({ instance: params.instance });\n  const snapStates = useSnapshot(states);\n  const [searchParams, setSearchParams] = useSearchParams();\n  const mediaParam = searchParams.get('media');\n  const mediaOnlyParam = searchParams.get('media-only');\n  const mediaIndex = parseInt(mediaParam || mediaOnlyParam, 10);\n  let showMedia = mediaIndex > 0;\n  const mediaStatusID = searchParams.get('mediaStatusID');\n  const mediaStatus = getStatus(mediaStatusID, instance);\n  if (mediaStatusID && !mediaStatus) {\n    showMedia = false;\n  }\n  const showMediaOnly = showMedia && !!mediaOnlyParam;\n\n  const sKey = statusKey(id, instance);\n  const [heroStatus, setHeroStatus] = useState(states.statuses[sKey]);\n  useEffect(() => {\n    if (states.statuses[sKey]) {\n      setHeroStatus(states.statuses[sKey]);\n    }\n  }, [sKey]);\n\n  const closeLink = useMemo(() => {\n    const { prevLocation } = states;\n    const pathname =\n      (prevLocation?.pathname || '') + (prevLocation?.search || '');\n    const matchStatusPath =\n      matchPath('/:instance/s/:id', pathname) || matchPath('/s/:id', pathname);\n    if (!pathname || matchStatusPath) {\n      return '/';\n    }\n    return pathname;\n  }, []);\n\n  useEffect(() => {\n    if (!heroStatus && showMedia) {\n      (async () => {\n        try {\n          const status = await masto.v1.statuses.$select(id).fetch();\n          saveStatus(status, instance);\n          setHeroStatus(status);\n        } catch (err) {\n          console.error(err);\n          alert('Unable to load post.');\n          location.hash = closeLink;\n        }\n      })();\n    }\n  }, [showMedia]);\n\n  const mediaAttachments = mediaStatusID\n    ? snapStates.statuses[statusKey(mediaStatusID, instance)]?.mediaAttachments\n    : heroStatus?.mediaAttachments;\n\n  const postViewState = () =>\n    window.matchMedia('(min-width: calc(40em + 350px))').matches\n      ? 'large'\n      : 'small';\n  const mediaClose = useCallback(() => {\n    console.log('xxx', {\n      postViewState: postViewState(),\n      showMediaOnly,\n    });\n    if (postViewState() === 'small' && snapStates.prevLocation) {\n      history.back();\n    } else {\n      if (showMediaOnly) {\n        location.hash = closeLink;\n      } else {\n        searchParams.delete('media');\n        searchParams.delete('mediaStatusID');\n        setSearchParams(searchParams);\n      }\n    }\n  }, [showMediaOnly, closeLink, snapStates.prevLocation]);\n  const handleMediaClose = useCallback(\n    (e, currentIndex, mediaAttachments, carouselRef) => {\n      if (postViewState() === 'large' && !showMediaOnly) {\n        mediaClose();\n        return;\n      }\n      if (showMedia && document.startViewTransition) {\n        const media = mediaAttachments[currentIndex];\n        const { id, blurhash, url } = media;\n        const mediaVTN = getSafeViewTransitionName(id || blurhash || url);\n        const els = document.querySelectorAll(\n          `.status .media [data-view-transition-name=\"${mediaVTN}\"]`,\n        );\n        const foundEls = [...els]?.filter?.((el) => {\n          const elBounds = el.getBoundingClientRect();\n          return (\n            elBounds.top < window.innerHeight &&\n            elBounds.bottom > 0 &&\n            elBounds.left < window.innerWidth &&\n            elBounds.right > 0\n          );\n        });\n        // If more than one, get the one in status page\n        const el =\n          foundEls.length === 1\n            ? foundEls[0]\n            : foundEls.find((el) => !!el.closest('.status-deck'));\n\n        console.log('xxx', { media, id, els, el });\n        if (el) {\n          const transition = document.startViewTransition(() => {\n            el.style.viewTransitionName = mediaVTN;\n            if (carouselRef?.current) {\n              carouselRef.current\n                .querySelectorAll('.media img, .media video')\n                ?.forEach((el) => {\n                  el.style.viewTransitionName = '';\n                });\n            }\n            mediaClose();\n          });\n          transition.ready.finally(() => {\n            el.style.viewTransitionName = '';\n            el.dataset.viewTransitioned = mediaVTN;\n          });\n        } else {\n          mediaClose();\n        }\n      } else {\n        mediaClose();\n      }\n    },\n    [showMedia, showMediaOnly],\n  );\n\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      // carouselRef.current?.focus?.();\n      const $carousel = document.querySelector('.carousel');\n      if ($carousel) {\n        $carousel.focus();\n      }\n    }, 100);\n    return () => clearTimeout(timer);\n  }, [showMediaOnly]);\n\n  useEffect(() => {\n    const $deckContainers = document.querySelectorAll('.deck-container');\n    $deckContainers.forEach(($deckContainer) => {\n      $deckContainer.setAttribute('inert', '');\n    });\n    return () => {\n      $deckContainers.forEach(($deckContainer) => {\n        $deckContainer.removeAttribute('inert');\n      });\n    };\n  }, []);\n\n  return (\n    <div class=\"deck-backdrop\">\n      {showMedia ? (\n        mediaAttachments?.length ? (\n          <MediaModal\n            mediaAttachments={mediaAttachments}\n            statusID={mediaStatusID || id}\n            instance={instance}\n            lang={heroStatus?.language}\n            index={mediaIndex - 1}\n            onClose={handleMediaClose}\n          />\n        ) : (\n          <div class=\"media-modal-container loading\">\n            <Loader abrupt />\n          </div>\n        )\n      ) : (\n        <Link to={closeLink} />\n      )}\n      {!showMediaOnly && (\n        <EditHistoryProvider statusID={id}>\n          <StatusThread\n            id={id}\n            instance={params.instance}\n            closeLink={closeLink}\n          />\n        </EditHistoryProvider>\n      )}\n    </div>\n  );\n}\n\nfunction StatusParent(props) {\n  const { linkable, to, onClick, ...restProps } = props;\n  return linkable ? (\n    <Link class=\"status-link\" to={to} onClick={onClick} {...restProps} />\n  ) : (\n    <div class=\"status-focus\" tabIndex={0} {...restProps} />\n  );\n}\n\n// oldest first\nfunction createdAtSort(a, b) {\n  return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n}\n\nconst MONTH_IN_MS = 1000 * 60 * 60 * 24 * 30;\n\nfunction StatusThread({ id, closeLink = '/', instance: propInstance }) {\n  const { t } = useLingui();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const mediaParam = searchParams.get('media');\n  const mediaStatusID = searchParams.get('mediaStatusID');\n  const showMedia = parseInt(mediaParam, 10) > 0;\n  const firstLoad = useRef(\n    !states.prevLocation &&\n      (history.length === 1 ||\n        ('navigation' in window && navigation?.entries?.()?.length === 1)),\n  );\n  const [viewMode, setViewMode] = useState(\n    searchParams.get('view') || firstLoad.current ? 'full' : null,\n  );\n  const translate = !!parseInt(searchParams.get('translate'));\n  const { masto, instance } = api({ instance: propInstance });\n  const {\n    masto: currentMasto,\n    instance: currentInstance,\n    authenticated,\n  } = api();\n  const sameInstance = instance === currentInstance;\n  const snapStates = useSnapshot(states);\n  const [statuses, setStatuses] = useState([]);\n  const [uiState, setUIState] = useState('default');\n  const heroStatusRef = useRef();\n  const sKey = statusKey(id, instance);\n  const totalDescendants = useRef(0);\n\n  const scrollableRef = useRef();\n  useEffect(() => {\n    scrollableRef.current?.focus();\n  }, []);\n  useEffect(() => {\n    const onScroll = debounce(() => {\n      // console.log('onScroll');\n      if (!scrollableRef.current) return;\n      const { scrollTop } = scrollableRef.current;\n      if (uiState !== 'loading') {\n        scrollPositions[id] = scrollTop;\n      }\n    }, 50);\n    scrollableRef.current?.addEventListener('scroll', onScroll, {\n      passive: true,\n    });\n    onScroll();\n    return () => {\n      onScroll.cancel();\n      scrollableRef.current?.removeEventListener('scroll', onScroll);\n    };\n  }, [id, uiState !== 'loading']);\n\n  const { editHistoryMode, initEditHistory, editedAtIndex, editHistoryRef } =\n    useEditHistory();\n\n  const scrollOffsets = useRef();\n  const lastInitContextTS = useRef();\n  const [threadsCount, setThreadsCount] = useState(0);\n  const fullContext = useRef(null);\n  const restructureContext = () => {\n    console.log({ fullContext: fullContext.current });\n    if (!fullContext.current) return;\n    let { ancestors, descendants, heroStatus } = fullContext.current;\n\n    if (editHistoryMode && descendants?.length) {\n      // Filter descendants based on createdAt/editedAt dates\n      // - editHistory items only has createdAt\n      // - descendants items has createdAt and optional editedAt\n      const currentEditedAtStatus = editHistoryRef.current[editedAtIndex];\n      const currentEditedAtStatusCreatedAt = Date.parse(\n        currentEditedAtStatus.createdAt,\n      );\n      const nextEditedAtStatus = editHistoryRef.current[editedAtIndex - 1];\n      const nextEditedAtStatusCreatedAt = nextEditedAtStatus\n        ? Date.parse(nextEditedAtStatus.createdAt)\n        : null;\n      descendants = descendants.filter((s) => {\n        // Show descendants created between current and next editedAt dates\n        const sCreatedAt = Date.parse(s.editedAt || s.createdAt);\n        return (\n          sCreatedAt >= currentEditedAtStatusCreatedAt &&\n          (!nextEditedAtStatusCreatedAt ||\n            sCreatedAt <= nextEditedAtStatusCreatedAt)\n        );\n      });\n    }\n\n    ancestors.sort(createdAtSort);\n    descendants.sort(createdAtSort);\n\n    totalDescendants.current = descendants?.length || 0;\n\n    const missingStatuses = new Set();\n    ancestors.forEach((status) => {\n      saveStatus(status, instance, {\n        skipThreading: true,\n      });\n      if (\n        status.inReplyToId &&\n        !ancestors.find((s) => s.id === status.inReplyToId)\n      ) {\n        missingStatuses.add(status.inReplyToId);\n      }\n    });\n    const ancestorsIsThread = ancestors.every(\n      (s) => s.account.id === heroStatus.account.id,\n    );\n    const nestedDescendants = [];\n    descendants.forEach((status) => {\n      saveStatus(status, instance, {\n        // skipThreading: true,\n      });\n\n      if (\n        status.inReplyToId &&\n        !descendants.find((s) => s.id === status.inReplyToId) &&\n        status.inReplyToId !== heroStatus.id\n      ) {\n        missingStatuses.add(status.inReplyToId);\n      }\n\n      if (status.inReplyToAccountId === status.account.id) {\n        // If replying to self, it's part of the thread, level 1\n        nestedDescendants.push(status);\n      } else if (status.inReplyToId === heroStatus.id) {\n        // If replying to the hero status, it's a reply, level 1\n        nestedDescendants.push(status);\n      } else if (\n        !status.inReplyToAccountId &&\n        nestedDescendants.find(\n          (s) =>\n            s.id === status.inReplyToId &&\n            s.account.id === heroStatus.account.id,\n        ) &&\n        status.account.id === heroStatus.account.id\n      ) {\n        // If replying to hero's own statuses, it's part of the thread, level 1\n        nestedDescendants.push(status);\n      } else {\n        // If replying to someone else, it's a reply to a reply, level 2\n        const parent = descendants.find((s) => s.id === status.inReplyToId);\n        if (parent) {\n          if (!parent.__replies) {\n            parent.__replies = [];\n          }\n          parent.__replies.push(status);\n        } else {\n          // If no parent, something is wrong\n          console.warn('No parent found for', status);\n        }\n      }\n    });\n\n    // sort hero author to top\n    nestedDescendants.sort((a, b) => {\n      const heroAccountID = heroStatus.account.id;\n      if (a.account.id === heroAccountID && b.account.id !== heroAccountID)\n        return -1;\n      if (b.account.id === heroAccountID && a.account.id !== heroAccountID)\n        return 1;\n      return 0;\n    });\n\n    console.log({ ancestors, descendants, nestedDescendants });\n    if (missingStatuses.size) {\n      console.error('Missing statuses', [...missingStatuses]);\n    }\n\n    let descendantLevelsCount = 1;\n    function expandReplies(_replies, level) {\n      const nextLevel = level + 1;\n      if (nextLevel > descendantLevelsCount) {\n        descendantLevelsCount = level;\n      }\n      return _replies?.map((_r) => ({\n        id: _r.id,\n        account: _r.account,\n        repliesCount: _r.repliesCount,\n        content: _r.content,\n        weight: calcStatusWeight(_r),\n        level: nextLevel,\n        replies: expandReplies(_r.__replies, nextLevel),\n      }));\n    }\n\n    const mappedNestedDescendants = nestedDescendants.map((s) => ({\n      id: s.id,\n      account: s.account,\n      accountID: s.account.id,\n      descendant: true,\n      thread: s.account.id === heroStatus.account.id,\n      weight: calcStatusWeight(s),\n      level: 1,\n      replies: expandReplies(s.__replies, 1),\n      createdAt: s.createdAt,\n    }));\n    const allStatuses = [\n      ...ancestors.map((s) => ({\n        id: s.id,\n        ancestor: true,\n        isThread: ancestorsIsThread,\n        accountID: s.account.id,\n        account: s.account,\n        repliesCount: s.repliesCount,\n        weight: calcStatusWeight(s),\n        createdAt: s.createdAt,\n      })),\n      {\n        id,\n        accountID: heroStatus.account.id,\n        weight: calcStatusWeight(heroStatus),\n        createdAt: heroStatus.createdAt,\n      },\n      ...mappedNestedDescendants,\n    ];\n\n    console.log({ allStatuses, descendantLevelsCount });\n    return { allStatuses, ancestorsIsThread, mappedNestedDescendants };\n  };\n\n  const initContext = ({ reloadHero } = {}) => {\n    console.debug('initContext', id);\n    setUIState('loading');\n    let heroTimer;\n\n    const cachedStatuses = cachedStatusesMap[id];\n    if (cachedStatuses) {\n      // Case 1: It's cached, let's restore them to make it snappy\n      const reallyCachedStatuses = cachedStatuses.filter(\n        (s) => states.statuses[sKey],\n        // Some are not cached in the global state, so we need to filter them out\n      );\n      setStatuses(reallyCachedStatuses);\n    } else {\n      // const heroIndex = statuses.findIndex((s) => s.id === id);\n      // if (heroIndex !== -1) {\n      //   // Case 2: It's in current statuses. Slice off all descendant statuses after the hero status to be safe\n      //   const slicedStatuses = statuses.slice(0, heroIndex + 1);\n      //   setStatuses(slicedStatuses);\n      // } else {\n      // Case 3: Not cached and not in statuses, let's start from scratch\n      setStatuses([{ id }]);\n      // }\n    }\n\n    (async () => {\n      const heroFetch = () =>\n        pRetry(() => masto.v1.statuses.$select(id).fetch(), {\n          retries: 4,\n        });\n      const contextFetch = pRetry(\n        () => masto.v1.statuses.$select(id).context.fetch(),\n        {\n          retries: 8,\n        },\n      );\n\n      const hasStatus = !!snapStates.statuses[sKey];\n      let heroStatus = snapStates.statuses[sKey];\n      if (hasStatus && !reloadHero) {\n        console.debug('Hero status is cached');\n      } else {\n        try {\n          heroStatus = await heroFetch();\n          saveStatus(heroStatus, instance);\n          // Give time for context to appear\n          await new Promise((resolve) => {\n            setTimeout(resolve, 100);\n          });\n        } catch (e) {\n          console.error(e);\n          setUIState('error');\n          return;\n        }\n      }\n\n      try {\n        const context = await contextFetch;\n        const { ancestors } = context;\n        fullContext.current = { ...context, heroStatus };\n        const { allStatuses, ancestorsIsThread, mappedNestedDescendants } =\n          restructureContext();\n\n        const descendantsThread =\n          ancestors.length && !ancestorsIsThread\n            ? []\n            : mappedNestedDescendants.filter((s) => s.thread);\n        const threadsCount =\n          (ancestorsIsThread ? ancestors.length : 0) + descendantsThread.length;\n        if (threadsCount > 0 && threadsCount < 100) {\n          // Cap at 100 because there's no point showing 100+\n          // Include hero as part of thread count\n          setThreadsCount(threadsCount + 1);\n        }\n\n        setUIState('default');\n        scrollOffsets.current = {\n          offsetTop: heroStatusRef.current?.offsetTop,\n          scrollTop: scrollableRef.current?.scrollTop,\n        };\n\n        // Set limit to hero's index\n        // const heroLimit = allStatuses.findIndex((s) => s.id === id);\n        const heroLimit = ancestors.length || 0; // 0-indexed\n        if (heroLimit >= limit) {\n          setLimit(heroLimit + 1);\n        }\n\n        setStatuses(allStatuses);\n        cachedStatusesMap[id] = allStatuses;\n\n        // Let's threadify this one\n        // Note that all non-hero statuses will trigger saveStatus which will threadify them too\n        // By right, at this point, all descendant statuses should be cached\n        threadifyStatus(heroStatus, instance);\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n\n    lastInitContextTS.current = Date.now();\n\n    return () => {\n      clearTimeout(heroTimer);\n    };\n  };\n\n  useEffect(initContext, [id, masto]);\n\n  useEffect(() => {\n    try {\n      const { allStatuses } = restructureContext();\n      setStatuses(allStatuses);\n    } catch (e) {}\n    // Only run this when editHistoryMode changes\n    // If id changes, initContext will run instead, so don't worry\n  }, [editHistoryMode, editedAtIndex]);\n\n  const [showRefresh, setShowRefresh] = useState(false);\n  useEffect(() => {\n    let interval = setInterval(() => {\n      const now = Date.now();\n      if (\n        lastInitContextTS.current &&\n        now - lastInitContextTS.current >= 60_000\n      ) {\n        setShowRefresh(true);\n      }\n    }, 60_000); // 1 minute\n    return () => {\n      clearInterval(interval);\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    if (!statuses.length) return;\n    console.debug('STATUSES', statuses);\n    const scrollPosition = scrollPositions[id];\n    console.debug('scrollPosition', scrollPosition);\n    if (!!scrollPosition) {\n      console.debug('Case 1', {\n        id,\n        scrollPosition,\n      });\n      scrollableRef.current.scrollTop = scrollPosition;\n    } else if (scrollOffsets.current) {\n      const newScrollOffsets = {\n        offsetTop: heroStatusRef.current?.offsetTop,\n        scrollTop: scrollableRef.current?.scrollTop,\n      };\n      const newScrollTop =\n        newScrollOffsets.offsetTop -\n        scrollOffsets.current.offsetTop +\n        newScrollOffsets.scrollTop;\n      console.debug('Case 2', {\n        scrollOffsets: scrollOffsets.current,\n        newScrollOffsets,\n        newScrollTop,\n        statuses: [...statuses],\n      });\n      scrollableRef.current.scrollTop = newScrollTop;\n    } else if (statuses.length === 1) {\n      console.debug('Case 3', {\n        id,\n      });\n      scrollableRef.current.scrollTop = 0;\n    }\n\n    // RESET\n    scrollOffsets.current = null;\n  }, [statuses]);\n\n  useEffect(() => {\n    if (snapStates.reloadStatusPage <= 0) return;\n    // Delete the cache for the context\n    (async () => {\n      try {\n        const { instanceURL } = getCurrentAccount();\n        const contextURL = `https://${instanceURL}/api/v1/statuses/${id}/context`;\n        console.log('Clear cache', contextURL);\n        const apiCache = await caches.open('api');\n        await apiCache.delete(contextURL, { ignoreVary: true });\n\n        return initContext({\n          reloadHero: true,\n        });\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [snapStates.reloadStatusPage]);\n\n  useEffect(() => {\n    return () => {\n      // RESET\n      scrollPositions = {};\n      states.reloadStatusPage = 0;\n      cachedStatusesMap = {};\n      cachedRepliesToggle = {};\n      statusWeightCache.clear();\n    };\n  }, []);\n\n  const heroStatus = snapStates.statuses[sKey] || snapStates.statuses[id];\n  const heroDisplayName = useMemo(() => {\n    // Remove shortcodes from display name\n    if (!heroStatus) return '';\n    const { account } = heroStatus;\n    const div = document.createElement('div');\n    div.innerHTML = account.displayName;\n    return div.innerText.trim();\n  }, [heroStatus]);\n  const heroContentText = useMemo(() => {\n    if (!heroStatus) return '';\n    let text = statusPeek(heroStatus);\n    if (text.length > 64) {\n      // \"The title should ideally be less than 64 characters in length\"\n      // https://www.w3.org/Provider/Style/TITLE.html\n      text = text.slice(0, 64) + '';\n    }\n    return text;\n  }, [heroStatus]);\n  useTitle(\n    heroDisplayName && heroContentText\n      ? `${heroDisplayName}: \"${heroContentText}\"`\n      : t({\n          id: 'post.title',\n          message: 'Post',\n        }),\n    '/:instance?/s/:id',\n  );\n\n  const postInstance = useMemo(() => {\n    if (!heroStatus) return;\n    const { url } = heroStatus;\n    if (!url) return;\n    return URL.parse(url)?.hostname;\n  }, [heroStatus]);\n  const postSameInstance = useMemo(() => {\n    if (!postInstance) return;\n    return postInstance === instance;\n  }, [postInstance, instance]);\n\n  const [limit, setLimit] = useState(LIMIT);\n  const showMore = useMemo(() => {\n    // return number of statuses to show\n    return statuses.length - limit;\n  }, [statuses.length, limit]);\n\n  const hasDescendants = statuses.some((s) => s.descendant);\n  const ancestors = statuses.filter((s) => s.ancestor);\n\n  const [heroInView, setHeroInView] = useState(true);\n  const heroPointer = useMemo(() => {\n    // get top offset of heroStatus\n    if (!heroStatusRef.current || heroInView) return null;\n    const { top } = heroStatusRef.current.getBoundingClientRect();\n    return top > 0 ? 'down' : 'up';\n  }, [heroInView]);\n\n  useHotkeys(\n    'esc',\n    () => {\n      location.hash = closeLink;\n    },\n    {\n      // If media is open, esc to close media first\n      // Else close the status page\n      enabled: !showMedia,\n      ignoreEventWhen: (e) => {\n        const hasModal = !!document.querySelector('#modal-container > *');\n        return hasModal || e.metaKey || e.ctrlKey || e.altKey || e.shiftKey;\n      },\n      useKey: true,\n    },\n  );\n  // For backspace, will always close both media and status page\n  useHotkeys(\n    'backspace',\n    () => {\n      location.hash = closeLink;\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  useHotkeys(\n    'j',\n    () => {\n      const activeStatus = document.activeElement.closest(\n        '.status-link, .status-focus',\n      );\n      const activeStatusRect = activeStatus?.getBoundingClientRect();\n      const allStatusLinks = Array.from(\n        scrollableRef.current.querySelectorAll(STATUSES_SELECTOR),\n      );\n      console.log({ allStatusLinks });\n      if (\n        activeStatus &&\n        activeStatusRect.top < scrollableRef.current.clientHeight &&\n        activeStatusRect.bottom > 0\n      ) {\n        const activeStatusIndex = allStatusLinks.indexOf(activeStatus);\n        let nextStatus = allStatusLinks[activeStatusIndex + 1];\n        if (nextStatus) {\n          nextStatus.focus();\n          nextStatus.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostStatusLink = allStatusLinks.find((statusLink) => {\n          const statusLinkRect = statusLink.getBoundingClientRect();\n          return statusLinkRect.top >= 44 && statusLinkRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostStatusLink) {\n          topmostStatusLink.focus();\n          topmostStatusLink.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  useHotkeys(\n    'k',\n    () => {\n      const activeStatus = document.activeElement.closest(\n        '.status-link, .status-focus',\n      );\n      const activeStatusRect = activeStatus?.getBoundingClientRect();\n      const allStatusLinks = Array.from(\n        scrollableRef.current.querySelectorAll(STATUSES_SELECTOR),\n      );\n      if (\n        activeStatus &&\n        activeStatusRect.top < scrollableRef.current.clientHeight &&\n        activeStatusRect.bottom > 0\n      ) {\n        const activeStatusIndex = allStatusLinks.indexOf(activeStatus);\n        let prevStatus = allStatusLinks[activeStatusIndex - 1];\n        if (prevStatus) {\n          prevStatus.focus();\n          prevStatus.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostStatusLink = allStatusLinks.find((statusLink) => {\n          const statusLinkRect = statusLink.getBoundingClientRect();\n          return statusLinkRect.top >= 44 && statusLinkRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostStatusLink) {\n          topmostStatusLink.focus();\n          topmostStatusLink.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  // NOTE: I'm not sure if 'x' is the best shortcut for this, might change it later\n  // IDEA: x is for expand\n  useHotkeys(\n    'x',\n    () => {\n      const activeStatus = document.activeElement.closest(\n        '.status-link, .status-focus',\n      );\n      if (activeStatus) {\n        const details = activeStatus.nextElementSibling;\n        if (details && details.tagName.toLowerCase() === 'details') {\n          details.open = !details.open;\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const [reachTopPost, setReachTopPost] = useState(false);\n  // const { nearReachStart } = useScroll({\n  //   scrollableRef,\n  //   distanceFromStartPx: 16,\n  // });\n\n  const initialPageState = useRef(showMedia ? 'media+status' : 'status');\n\n  const handleMediaClick = useCallback(\n    (e, i, media, status) => {\n      e.preventDefault();\n      e.stopPropagation();\n      setSearchParams({\n        media: i + 1,\n        mediaStatusID: status.id,\n      });\n    },\n    [id],\n  );\n\n  const handleStatusLinkClick = useCallback((e, status) => {\n    resetScrollPosition(status.id);\n  }, []);\n\n  useEffect(() => {\n    let timer;\n    if (mediaStatusID && showMedia) {\n      timer = setTimeout(() => {\n        const status = scrollableRef.current?.querySelector(\n          `.status-link[href*=\"/${mediaStatusID}\"]`,\n        );\n        if (status) {\n          status.scrollIntoView(scrollIntoViewOptions);\n        }\n      }, 400); // After CSS transition\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [mediaStatusID, showMedia]);\n\n  const renderStatus = useCallback(\n    (status, i) => {\n      const {\n        id: statusID,\n        ancestor,\n        isThread,\n        descendant,\n        thread,\n        replies,\n        repliesCount,\n        weight,\n        level,\n      } = status;\n      const isHero = statusID === id;\n      const isLinkable = isThread || ancestor;\n\n      return (\n        <li\n          key={statusID}\n          ref={isHero ? heroStatusRef : null}\n          class={`${ancestor ? 'ancestor' : ''} ${\n            descendant ? 'descendant' : ''\n          } ${thread ? 'thread' : ''} ${isHero ? 'hero' : ''}`}\n        >\n          {isHero ? (\n            <>\n              <InView\n                threshold={0.1}\n                onChange={(inView) => {\n                  queueMicrotask(() => {\n                    requestAnimationFrame(() => {\n                      setHeroInView(inView);\n                    });\n                  });\n                }}\n                class=\"status-focus\"\n                tabIndex={0}\n              >\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  withinContext\n                  size=\"l\"\n                  enableTranslate\n                  forceTranslate={translate}\n                />\n              </InView>\n              {uiState !== 'loading' && !authenticated ? (\n                <div class=\"post-status-banner\">\n                  <p>\n                    <Trans>\n                      You're not logged in. Interactions (reply, boost, etc) are\n                      not possible.\n                    </Trans>\n                  </p>\n                  <Link\n                    to={\n                      DEFAULT_INSTANCE\n                        ? `/login?instance=${DEFAULT_INSTANCE}&submit=1`\n                        : '/login'\n                    }\n                    class=\"button\"\n                  >\n                    <Trans>Log in</Trans>\n                  </Link>\n                </div>\n              ) : (\n                !sameInstance && (\n                  <div class=\"post-status-banner\">\n                    <p>\n                      <Trans>\n                        This post is from another instance (<b>{instance}</b>).\n                        Interactions (reply, boost, etc) are not possible.\n                      </Trans>\n                    </p>\n                    <button\n                      type=\"button\"\n                      disabled={uiState === 'loading'}\n                      onClick={() => {\n                        setUIState('loading');\n                        (async () => {\n                          try {\n                            const results = await currentMasto.v2.search.list({\n                              q: heroStatus.url,\n                              type: 'statuses',\n                              resolve: true,\n                              limit: 1,\n                            });\n                            if (results.statuses.length) {\n                              const status = results.statuses[0];\n                              location.hash = currentInstance\n                                ? `/${currentInstance}/s/${status.id}`\n                                : `/s/${status.id}`;\n                            } else {\n                              throw new Error('No results');\n                            }\n                          } catch (e) {\n                            setUIState('default');\n                            alert(t`Error: ${e}`);\n                            console.error(e);\n                          }\n                        })();\n                      }}\n                    >\n                      <Icon icon=\"transfer\" />{' '}\n                      <Trans>\n                        Switch to my instance to enable interactions\n                      </Trans>\n                    </button>\n                  </div>\n                )\n              )}\n            </>\n          ) : (\n            <StatusParent\n              linkable={isLinkable}\n              to={instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`}\n              onClick={() => {\n                resetScrollPosition(statusID);\n              }}\n            >\n              {/* <Link\n              class=\"status-link\"\n              to={instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`}\n              onClick={() => {\n                resetScrollPosition(statusID);\n              }}\n            > */}\n              {i === 0 && ancestor ? (\n                <InView\n                  threshold={0.5}\n                  onChange={(inView) => {\n                    queueMicrotask(() => {\n                      requestAnimationFrame(() => {\n                        setReachTopPost(inView);\n                      });\n                    });\n                  }}\n                >\n                  <Status\n                    statusID={statusID}\n                    instance={instance}\n                    withinContext\n                    size={thread || ancestor ? 'm' : 's'}\n                    enableTranslate\n                    onMediaClick={handleMediaClick}\n                    onStatusLinkClick={handleStatusLinkClick}\n                  />\n                </InView>\n              ) : (\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  withinContext\n                  size={thread || ancestor ? 'm' : 's'}\n                  enableTranslate\n                  onMediaClick={handleMediaClick}\n                  onStatusLinkClick={handleStatusLinkClick}\n                  showActionsBar={!!descendant}\n                />\n              )}\n              {ancestor && repliesCount > 1 && (\n                <div class=\"replies-link\">\n                  <Icon icon=\"comment2\" alt={t`Replies`} />{' '}\n                  <span title={repliesCount}>\n                    {shortenNumber(repliesCount)}\n                  </span>\n                </div>\n              )}{' '}\n              {/* {replies?.length > LIMIT && (\n                        <div class=\"replies-link\">\n                          <Icon icon=\"comment\" />{' '}\n                          <span title={replies.length}>\n                            {shortenNumber(replies.length)}\n                          </span>\n                        </div>\n                      )} */}\n            </StatusParent>\n            // </Link>\n          )}\n          {descendant && replies?.length > 0 && (\n            <SubComments\n              instance={instance}\n              replies={replies}\n              hasParentThread={thread}\n              level={level}\n              accWeight={weight}\n              openAll={totalDescendants.current < SUBCOMMENTS_OPEN_ALL_LIMIT}\n              parentLink={{\n                to: instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`,\n                onClick: () => resetScrollPosition(statusID),\n              }}\n            />\n          )}\n          {uiState === 'loading' &&\n            isHero &&\n            !!heroStatus?.repliesCount &&\n            !hasDescendants && (\n              <div class=\"status-loading\">\n                <Loader abrupt={heroStatus.repliesCount >= 3} />\n              </div>\n            )}\n          {uiState === 'error' &&\n            isHero &&\n            !!heroStatus?.repliesCount &&\n            !hasDescendants && (\n              <div class=\"status-error\">\n                <Trans>Unable to load replies.</Trans>\n                <br />\n                <button\n                  type=\"button\"\n                  class=\"plain\"\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                  }}\n                >\n                  <Trans>Try again</Trans>\n                </button>\n              </div>\n            )}\n        </li>\n      );\n    },\n    [\n      id,\n      instance,\n      uiState,\n      authenticated,\n      sameInstance,\n      translate,\n      handleMediaClick,\n      handleStatusLinkClick,\n      hasDescendants,\n    ],\n  );\n\n  const prevLocationIsStatusPage = useMemo(() => {\n    // Navigation API\n    if ('navigation' in window && navigation?.entries) {\n      const prevEntry = navigation.entries()[navigation.currentEntry.index - 1];\n      if (prevEntry?.url) {\n        return STATUS_URL_REGEX.test(prevEntry.url);\n      }\n    }\n    return STATUS_URL_REGEX.test(states.prevLocation?.pathname);\n  }, [sKey]);\n\n  const moreStatusesKeys = useMemo(() => {\n    if (!showMore) return [];\n    const ids = [];\n    function getIDs(status) {\n      ids.push(status.id);\n      if (status.replies) {\n        status.replies.forEach(getIDs);\n      }\n    }\n    statuses.slice(limit).forEach(getIDs);\n    return ids.map((id) => statusKey(id, instance));\n  }, [showMore, statuses, limit, instance]);\n\n  // Helper function to format time differences between two dates\n  function formatTimeGap(months) {\n    if (months < 12) {\n      return plural(months, {\n        one: '# month later',\n        other: '# months later',\n      });\n    } else {\n      const years = Math.floor(months / 12);\n      return plural(years, {\n        one: '# year later',\n        other: '# years later',\n      });\n    }\n  }\n\n  const statusesList = useMemo(() => {\n    const result = [];\n    const slicedStatuses = statuses.slice(0, limit);\n\n    for (let i = 0; i < slicedStatuses.length; i++) {\n      const status = slicedStatuses[i];\n\n      // Add time gap indicator if needed\n      if (i > 0) {\n        const prevStatus = slicedStatuses[i - 1];\n\n        const { createdAt, descendant, thread, id } = status;\n\n        if (prevStatus?.createdAt && createdAt) {\n          const currentDate = Date.parse(createdAt);\n          if (isFinite(currentDate) && currentDate > MONTH_IN_MS) {\n            const prevDate = Date.parse(prevStatus.createdAt);\n\n            if (prevDate && isFinite(prevDate)) {\n              const { ancestor, id: prevID } = prevStatus;\n              const timeDiff = currentDate - prevDate;\n              const monthsDiff = ~~(timeDiff / MONTH_IN_MS);\n\n              if (monthsDiff > 0) {\n                result.push(\n                  <li\n                    key={`time-gap-${id}-${prevID}`}\n                    style={{\n                      '--time-gap-range': Math.min(12, monthsDiff),\n                    }}\n                    class={`time-gap ${ancestor ? 'ancestor' : ''} ${descendant ? 'descendant' : ''} ${\n                      thread ? 'thread' : ''\n                    }`}\n                  >\n                    {formatTimeGap(monthsDiff)}\n                  </li>,\n                );\n              } else {\n                // NOTE: For testing purposes\n                // result.push(\n                //   <li\n                //     key={`time-gap-${id}`}\n                //     class={`time-gap ${ancestor ? 'ancestor' : ''} ${descendant ? 'descendant' : ''} ${\n                //       thread ? 'thread' : ''\n                //     }`}\n                //   >\n                //     One eternity later\n                //   </li>,\n                // );\n              }\n            }\n          }\n        }\n      }\n\n      result.push(renderStatus(status, i));\n    }\n\n    return result;\n  }, [statuses, limit, renderStatus, editHistoryMode, editedAtIndex]);\n\n  // If there's spoiler in hero status, auto-expand it\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      if (!heroStatusRef.current) return;\n      const spoilerButton = heroStatusRef.current.querySelector(\n        '.spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)',\n      );\n      if (spoilerButton) spoilerButton.click();\n    }, 1000);\n    return () => clearTimeout(timer);\n  }, [id]);\n\n  return (\n    <ThreadCountContext.Provider value={threadsCount}>\n      <div\n        tabIndex=\"-1\"\n        ref={scrollableRef}\n        class={`status-deck deck contained ${\n          statuses.length > 1 ? 'padded-bottom' : ''\n        } ${\n          initialPageState.current === 'status' && !firstLoad.current\n            ? 'slide-in'\n            : ''\n        } ${viewMode ? `deck-view-${viewMode}` : ''} ${\n          editHistoryMode ? 'edit-history-mode' : ''\n        }`}\n        style={\n          editHistoryMode\n            ? {\n                '--edit-history-percentage': `${editedAtIndex / (editHistoryRef.current.length - 1)}`,\n              }\n            : undefined\n        }\n        onAnimationEnd={(e) => {\n          // Fix the bounce effect when switching viewMode\n          // `slide-in` animation kicks in when switching viewMode\n          if (initialPageState.current === 'status') {\n            // e.target.classList.remove('slide-in');\n            initialPageState.current = null;\n          }\n        }}\n      >\n        <header\n          class={`${uiState === 'loading' ? 'loading' : ''}`}\n          onDblClick={(e) => {\n            // reload statuses\n            states.reloadStatusPage++;\n          }}\n        >\n          {/* <div>\n            <Link class=\"button plain deck-close\" href={closeLink}>\n              <Icon icon=\"chevron-left\" size=\"xl\" />\n            </Link>\n          </div> */}\n          <div class=\"header-grid header-grid-2\">\n            <h1>\n              {prevLocationIsStatusPage && (\n                <button\n                  type=\"button\"\n                  class=\"plain deck-back\"\n                  onClick={() => {\n                    history.back();\n                  }}\n                >\n                  <Icon icon=\"chevron-left\" size=\"xl\" alt={t`Back`} />\n                </button>\n              )}\n              {!heroInView && heroStatus && uiState !== 'loading' ? (\n                <>\n                  <span class=\"hero-heading\">\n                    <NameText\n                      account={heroStatus.account}\n                      instance={instance}\n                      showAvatar\n                      short\n                    />{' '}\n                    <span class=\"insignificant\">\n                      &bull;{' '}\n                      <RelativeTime\n                        datetime={heroStatus.createdAt}\n                        format=\"micro\"\n                      />\n                    </span>\n                  </span>{' '}\n                  <button\n                    type=\"button\"\n                    class=\"ancestors-indicator light small\"\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      heroStatusRef.current.scrollIntoView({\n                        behavior: 'smooth',\n                        block: 'start',\n                      });\n                    }}\n                    title={t`Go to main post`}\n                  >\n                    <Icon\n                      icon={heroPointer === 'down' ? 'arrow-down' : 'arrow-up'}\n                    />\n                  </button>\n                </>\n              ) : (\n                <>\n                  <Trans id=\"post.title\">Post</Trans>{' '}\n                  <button\n                    type=\"button\"\n                    class=\"ancestors-indicator light small\"\n                    onClick={(e) => {\n                      // Scroll to top\n                      e.preventDefault();\n                      e.stopPropagation();\n                      scrollableRef.current.scrollTo({\n                        top: 0,\n                        behavior: 'smooth',\n                      });\n                    }}\n                    hidden={!ancestors.length || reachTopPost}\n                    title={t`${ancestors.length} posts above  Go to top`}\n                  >\n                    <Icon icon=\"arrow-up\" />\n                    {ancestors\n                      .filter(\n                        (a, i, arr) =>\n                          arr.findIndex((b) => b.accountID === a.accountID) ===\n                          i,\n                      )\n                      .slice(0, 3)\n                      .map((ancestor) => (\n                        <Avatar\n                          key={ancestor.account.id}\n                          url={\n                            ancestor.account.avatarStatic ||\n                            ancestor.account.avatar\n                          }\n                          alt={ancestor.account.displayName}\n                          squircle={ancestor.account?.bot}\n                        />\n                      ))}\n                    {/* <Icon icon=\"comment\" />{' '} */}\n                    {ancestors.length > 3 && (\n                      <>\n                        {' '}\n                        <span class=\"insignificant\">\n                          {shortenNumber(ancestors.length)}\n                        </span>\n                      </>\n                    )}\n                  </button>\n                </>\n              )}\n            </h1>\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain4 button-switch-view\"\n                style={{\n                  display: viewMode === 'full' ? '' : 'none',\n                }}\n                onClick={() => {\n                  setViewMode(null);\n                  searchParams.delete('media');\n                  searchParams.delete('media-only');\n                  searchParams.delete('view');\n                  setSearchParams(searchParams);\n                }}\n                title={t`Switch to Side Peek view`}\n              >\n                <Icon icon=\"layout4\" size=\"l\" />\n              </button>\n              {showRefresh && (\n                <button\n                  type=\"button\"\n                  class=\"plain button-refresh\"\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                    setShowRefresh(false);\n                  }}\n                >\n                  <Icon icon=\"refresh\" size=\"l\" alt={t`Refresh`} />\n                </button>\n              )}\n              <Menu2\n                align=\"end\"\n                portal={{\n                  // Need this, else the menu click will cause scroll jump\n                  target: scrollableRef.current,\n                }}\n                menuButton={\n                  <button type=\"button\" class=\"button plain4\">\n                    <Icon icon=\"more\" alt={t`More`} size=\"xl\" />\n                  </button>\n                }\n              >\n                <MenuItem\n                  disabled={uiState === 'loading'}\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                  }}\n                >\n                  <Icon icon=\"refresh\" />\n                  <span>\n                    <Trans>Refresh</Trans>\n                  </span>\n                </MenuItem>\n                <MenuItem\n                  className=\"menu-switch-view\"\n                  onClick={() => {\n                    setViewMode(viewMode === 'full' ? null : 'full');\n                    searchParams.delete('media');\n                    searchParams.delete('media-only');\n                    if (viewMode === 'full') {\n                      searchParams.delete('view');\n                    } else {\n                      searchParams.set('view', 'full');\n                    }\n                    setSearchParams(searchParams);\n                  }}\n                >\n                  <Icon\n                    icon={\n                      {\n                        '': 'layout5',\n                        full: 'layout4',\n                      }[viewMode || '']\n                    }\n                  />\n                  <span>\n                    {viewMode === 'full'\n                      ? t`Switch to Side Peek view`\n                      : t`Switch to Full view`}\n                  </span>\n                </MenuItem>\n                <MenuItem\n                  onClick={() => {\n                    // Click all buttons with class .spoiler but not .spoiling\n                    const buttons = Array.from(\n                      scrollableRef.current.querySelectorAll(\n                        '.spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)',\n                      ),\n                    );\n                    buttons.forEach((button) => {\n                      button.click();\n                    });\n                  }}\n                >\n                  <Icon icon=\"eye-open\" />{' '}\n                  <span>\n                    <Trans>Show all sensitive content</Trans>\n                  </span>\n                </MenuItem>\n                <MenuDivider />\n                <MenuHeader className=\"plain\">\n                  <Trans>Experimental</Trans>\n                </MenuHeader>\n                <MenuItem\n                  disabled={!postInstance || postSameInstance}\n                  onClick={() => {\n                    const statusURL = getInstanceStatusURL(heroStatus.url);\n                    if (statusURL) {\n                      location.hash = statusURL;\n                    } else {\n                      alert(t`Unable to switch`);\n                    }\n                  }}\n                >\n                  <Icon icon=\"transfer\" />\n                  <small class=\"menu-double-lines\">\n                    {postInstance\n                      ? t`Switch to post's instance (${punycode.toUnicode(\n                          postInstance,\n                        )})`\n                      : t`Switch to post's instance`}\n                  </small>\n                </MenuItem>\n                <MenuItem\n                  disabled={\n                    !sameInstance ||\n                    uiState === 'loading' ||\n                    !heroStatus?.editedAt ||\n                    !totalDescendants.current\n                  }\n                  onClick={initEditHistory}\n                >\n                  <Icon icon=\"edit\" />\n                  <span>{t`View Edit History Snapshots`}</span>\n                </MenuItem>\n              </Menu2>\n              <Link class=\"button plain deck-close\" to={closeLink}>\n                <Icon icon=\"x\" size=\"xl\" alt={t`Close`} />\n              </Link>\n            </div>\n          </div>\n        </header>\n        <EditHistoryControls />\n        {!!statuses.length && heroStatus ? (\n          <ul\n            class={`timeline flat contextual grow ${\n              uiState === 'loading' ? 'loading' : ''\n            }`}\n          >\n            {statusesList}\n            {showMore > 0 && (\n              <li class=\"descendant descendant-more\">\n                <button\n                  type=\"button\"\n                  class=\"plain block show-more\"\n                  disabled={uiState === 'loading'}\n                  onClick={() => setLimit((l) => l + LIMIT)}\n                  style={{ marginBlockEnd: '6em' }}\n                  data-state-post-ids={moreStatusesKeys.join(' ')}\n                >\n                  <div class=\"ib avatars-bunch\">\n                    {/* show avatars for first 5 statuses */}\n                    {statuses.slice(limit, limit + 5).map((status) => (\n                      <Avatar\n                        key={status.id}\n                        url={status.account.avatarStatic}\n                        // title={`${status.avatar.displayName} (@${status.avatar.acct})`}\n                      />\n                    ))}\n                  </div>{' '}\n                  <div class=\"ib\">\n                    <Trans>Show more</Trans>{' '}\n                    <span class=\"tag\">\n                      {showMore > LIMIT ? `${LIMIT}+` : showMore}\n                    </span>\n                  </div>\n                </button>\n              </li>\n            )}\n          </ul>\n        ) : (\n          <>\n            {uiState === 'loading' && (\n              <ul class=\"timeline flat contextual grow loading\">\n                <li>\n                  <Status skeleton size=\"l\" />\n                </li>\n              </ul>\n            )}\n            {uiState === 'error' && (\n              <p class=\"ui-state\">\n                <Trans>Unable to load post</Trans>\n                <br />\n                <br />\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                  }}\n                >\n                  <Trans>Try again</Trans>\n                </button>\n              </p>\n            )}\n          </>\n        )}\n      </div>\n    </ThreadCountContext.Provider>\n  );\n}\n\nfunction SubComments({\n  replies,\n  instance,\n  hasParentThread,\n  level,\n  accWeight,\n  openAll,\n  parentLink,\n}) {\n  const { t } = useLingui();\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  // Total comments count, including sub-replies\n  const diveDeep = (replies) => {\n    return replies.reduce((acc, reply) => {\n      const { repliesCount, replies } = reply;\n      const count = replies?.length || repliesCount;\n      return acc + count + diveDeep(replies || []);\n    }, 0);\n  };\n  const totalComments = replies.length + diveDeep(replies);\n  const sameCount = replies.length === totalComments;\n\n  // Get the first 3 accounts, unique by id\n  const accounts = replies\n    .map((r) => r.account)\n    .filter((a, i, arr) => arr.findIndex((b) => b.id === a.id) === i)\n    .slice(0, 3);\n\n  const totalWeight = useMemo(() => {\n    return replies?.reduce((acc, reply) => {\n      return acc + reply?.weight;\n    }, accWeight);\n  }, [accWeight, replies?.length]);\n\n  let open = false;\n  if (openAll) {\n    open = true;\n  } else if (totalWeight <= MAX_WEIGHT) {\n    open = true;\n  } else if (!hasParentThread && totalComments === 1) {\n    const shortReply = calcStatusWeight(replies[0]) < 2;\n    if (shortReply) open = true;\n  }\n  const openBefore = cachedRepliesToggle[replies[0].id];\n\n  const handleMediaClick = useCallback((e, i, media, status) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setSearchParams({\n      media: i + 1,\n      mediaStatusID: status.id,\n    });\n  }, []);\n\n  const detailsRef = useRef();\n  useLayoutEffect(() => {\n    function handleScroll(e) {\n      // NOTE: this scrollLeft works for RTL too\n      // Browsers do the magic for us\n      e.target.dataset.scrollLeft = e.target.scrollLeft;\n    }\n    detailsRef.current?.addEventListener('scroll', handleScroll, {\n      passive: true,\n    });\n    return () => {\n      detailsRef.current?.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  // If not open, delay render replies\n  const [renderReplies, setRenderReplies] = useState(openBefore || open);\n  useEffect(() => {\n    let timer;\n    if (!openBefore && !open) {\n      timer = setTimeout(() => setRenderReplies(true), 100);\n    }\n    return () => clearTimeout(timer);\n  }, [openBefore, open]);\n\n  const Container = open ? 'div' : 'details';\n  const isDetails = Container === 'details';\n\n  return (\n    <Container\n      ref={detailsRef}\n      class=\"replies\"\n      open={isDetails ? openBefore || open : undefined}\n      onToggle={\n        isDetails\n          ? (e) => {\n              const { open } = e.target;\n              // use first reply as ID\n              cachedRepliesToggle[replies[0].id] = open;\n            }\n          : undefined\n      }\n      style={{\n        '--comments-level': level,\n      }}\n      data-comments-level={level}\n      data-comments-level-overflow={level > 4}\n    >\n      {!open && (\n        <summary class=\"replies-summary\" hidden={open}>\n          <span class=\"avatars\">\n            {accounts.map((a) => (\n              <Avatar\n                key={a.id}\n                url={a.avatarStatic}\n                title={`${a.displayName} @${a.username}`}\n                squircle={a?.bot}\n              />\n            ))}\n          </span>\n          <span class=\"replies-counts\">\n            <b>\n              <Plural\n                value={replies.length}\n                one=\"# reply\"\n                other={\n                  <Trans>\n                    <span title={replies.length}>\n                      {shortenNumber(replies.length)}\n                    </span>{' '}\n                    replies\n                  </Trans>\n                }\n              />\n            </b>\n            {!sameCount && totalComments > 1 && (\n              <>\n                {' '}\n                &middot;{' '}\n                <span>\n                  <Plural\n                    value={totalComments}\n                    one=\"# comment\"\n                    other={\n                      <Trans>\n                        <span title={totalComments}>\n                          {shortenNumber(totalComments)}\n                        </span>{' '}\n                        comments\n                      </Trans>\n                    }\n                  />\n                </span>\n              </>\n            )}\n          </span>\n          <Icon icon=\"chevron-down\" class=\"replies-summary-chevron\" />\n          {!!parentLink && (\n            <Link\n              class=\"replies-parent-link\"\n              to={parentLink.to}\n              onClick={parentLink.onClick}\n              title={t`View post with its replies`}\n            >\n              &raquo;\n            </Link>\n          )}\n        </summary>\n      )}\n      {renderReplies && (\n        <ul>\n          {replies.map((r) => (\n            <li key={r.id}>\n              {/* <Link\n              class=\"status-link\"\n              to={instance ? `/${instance}/s/${r.id}` : `/s/${r.id}`}\n              onClick={() => {\n                resetScrollPosition(r.id);\n              }}\n            > */}\n              <div class=\"status-focus\" tabIndex={0}>\n                <Status\n                  statusID={r.id}\n                  instance={instance}\n                  withinContext\n                  size=\"s\"\n                  enableTranslate\n                  onMediaClick={handleMediaClick}\n                  showActionsBar\n                />\n                {!r.replies?.length && r.repliesCount > 0 && (\n                  <div class=\"replies-link\">\n                    <Icon icon=\"comment2\" alt={t`Replies`} />{' '}\n                    <span title={r.repliesCount}>\n                      {shortenNumber(r.repliesCount)}\n                    </span>\n                  </div>\n                )}\n              </div>\n              {/* </Link> */}\n              {r.replies?.length && (\n                <SubComments\n                  instance={instance}\n                  replies={r.replies}\n                  level={r.level}\n                  accWeight={!open ? r.weight : totalWeight}\n                  openAll={openAll}\n                  parentLink={{\n                    to: instance ? `/${instance}/s/${r.id}` : `/s/${r.id}`,\n                    onClick: () => {\n                      resetScrollPosition(r.id);\n                    },\n                  }}\n                />\n              )}\n            </li>\n          ))}\n        </ul>\n      )}\n    </Container>\n  );\n}\n\nconst MEDIA_VIRTUAL_LENGTH = 140;\nconst POLL_VIRTUAL_LENGTH = 35;\nconst CARD_VIRTUAL_LENGTH = 70;\nconst WEIGHT_SEGMENT = 140;\nconst statusWeightCache = new Map();\nfunction calcStatusWeight(status) {\n  const cachedWeight = statusWeightCache.get(status.id);\n  if (cachedWeight) return cachedWeight;\n  const { spoilerText, content, mediaAttachments, poll, card } = status;\n  const length = htmlContentLength(spoilerText + content);\n  const mediaLength = mediaAttachments?.length ? MEDIA_VIRTUAL_LENGTH : 0;\n  const pollLength = (poll?.options?.length || 0) * POLL_VIRTUAL_LENGTH;\n  const cardLength =\n    card && (mediaAttachments?.length || poll?.options?.length)\n      ? 0\n      : CARD_VIRTUAL_LENGTH;\n  const totalLength = length + mediaLength + pollLength + cardLength;\n  const weight = totalLength / WEIGHT_SEGMENT;\n  statusWeightCache.set(status.id, weight);\n  return weight;\n}\n\nexport default memo(StatusPage);\n","import { useParams } from 'react-router-dom';\n\nimport Status from './status';\n\nexport default function StatusRoute() {\n  const params = useParams();\n  const { id, instance } = params;\n  return <Status id={id} instance={instance} />;\n}\n","export default \"__VITE_ASSET__BbkKeAoc__\"","export default \"__VITE_ASSET__MUCjVR2Z__\"","export default \"__VITE_ASSET__Pb$jWfr9__\"","export default \"__VITE_ASSET__DJIucEyS__\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e\"","import './welcome.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\n\nimport boostsCarouselUrl from '../assets/features/boosts-carousel.jpg';\nimport catchupUrl from '../assets/features/catch-up.png';\nimport multiColumnUrl from '../assets/features/multi-column.jpg';\nimport multiHashtagTimelineUrl from '../assets/features/multi-hashtag-timeline.jpg';\nimport nestedCommentsThreadUrl from '../assets/features/nested-comments-thread.jpg';\nimport logo from '../assets/logo.svg';\nimport logoText from '../assets/logo-text.svg';\n\nimport LangSelector from '../components/lang-selector';\nimport Link from '../components/link';\nimport states from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst {\n  PHANPY_DEFAULT_INSTANCE: DEFAULT_INSTANCE,\n  PHANPY_WEBSITE: WEBSITE,\n  PHANPY_PRIVACY_POLICY_URL: PRIVACY_POLICY_URL,\n  PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL: DEFAULT_INSTANCE_REGISTRATION_URL,\n} = import.meta.env;\nconst appSite = WEBSITE\n  ? WEBSITE.replace(/https?:\\/\\//g, '').replace(/\\/$/, '')\n  : null;\nconst appVersion = __COMMIT_TIME__\n  ? `${__COMMIT_TIME__.slice(0, 10).replace(/-/g, '.')}${\n      __COMMIT_HASH__ ? `.${__COMMIT_HASH__}` : ''\n    }`\n  : null;\n\nfunction Welcome() {\n  const { t } = useLingui();\n  useTitle(null, ['/', '/welcome']);\n  return (\n    <main id=\"welcome\">\n      <div class=\"hero-container\">\n        <div class=\"hero-content\">\n          <h1>\n            <img\n              src={logo}\n              alt=\"\"\n              width=\"160\"\n              height=\"160\"\n              style={{\n                aspectRatio: '1/1',\n                marginBlockEnd: -16,\n              }}\n            />\n            <img src={logoText} alt=\"Phanpy\" width=\"200\" />\n          </h1>\n          <p class=\"desc\">\n            <Trans>A minimalistic opinionated Mastodon web client.</Trans>\n          </p>\n          <p>\n            <Link\n              to={\n                DEFAULT_INSTANCE\n                  ? `/login?instance=${DEFAULT_INSTANCE}&submit=1`\n                  : '/login'\n              }\n              class=\"button\"\n            >\n              {DEFAULT_INSTANCE ? t`Log in` : t`Log in with Mastodon`}\n            </Link>\n          </p>\n          {DEFAULT_INSTANCE && DEFAULT_INSTANCE_REGISTRATION_URL && (\n            <p>\n              <a href={DEFAULT_INSTANCE_REGISTRATION_URL} class=\"button plain5\">\n                <Trans>Sign up</Trans>\n              </a>\n            </p>\n          )}\n          {!DEFAULT_INSTANCE && (\n            <p class=\"insignificant\">\n              <small>\n                <Trans>\n                  Connect your existing Mastodon/Fediverse account.\n                  <br />\n                  Your credentials are not stored on this server.\n                </Trans>\n              </small>\n            </p>\n          )}\n        </div>\n        {(appSite || appVersion) && (\n          <p class=\"app-site-version\">\n            <small>\n              {appSite} {appVersion}\n            </small>\n          </p>\n        )}\n        <p>\n          <Trans>\n            <a href=\"https://github.com/cheeaun/phanpy\" target=\"_blank\">\n              Built\n            </a>{' '}\n            by{' '}\n            <a\n              href=\"https://mastodon.social/@cheeaun\"\n              target=\"_blank\"\n              onClick={(e) => {\n                e.preventDefault();\n                states.showAccount = 'cheeaun@mastodon.social';\n              }}\n            >\n              @cheeaun\n            </a>\n            .{' '}\n            <a href={PRIVACY_POLICY_URL} target=\"_blank\">\n              Privacy Policy\n            </a>\n            .\n          </Trans>\n        </p>\n        <div>\n          <LangSelector />\n        </div>\n      </div>\n      <div id=\"why-container\">\n        <div class=\"sections\">\n          <section>\n            <img\n              src={boostsCarouselUrl}\n              alt={t`Screenshot of Boosts Carousel`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Boosts Carousel</Trans>\n            </h4>\n            <p>\n              <Trans>\n                Visually separate original posts and re-shared posts (boosted\n                posts).\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={catchupUrl}\n              alt={t`Screenshot of Catch-up`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Catch-up</Trans>\n            </h4>\n            <p>\n              <Trans>\n                A separate timeline for followings. Email-inspired interface to\n                sort and filter posts.\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={nestedCommentsThreadUrl}\n              alt={t`Screenshot of nested comments thread`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Nested comments thread</Trans>\n            </h4>\n            <p>\n              <Trans>\n                Effortlessly follow conversations. Semi-collapsible replies.\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={multiColumnUrl}\n              alt={t`Screenshot of multi-column UI`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Single or multi-column</Trans>\n            </h4>\n            <p>\n              <Trans>\n                By default, single column for zen-mode seekers. Configurable\n                multi-column for power users.\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={multiHashtagTimelineUrl}\n              alt={t`Screenshot of multi-hashtag timeline with a form to add more hashtags`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Multi-hashtag timeline</Trans>\n            </h4>\n            <p>\n              <Trans>Up to 5 hashtags combined into a single timeline.</Trans>\n            </p>\n          </section>\n        </div>\n      </div>\n    </main>\n  );\n}\n\nexport default Welcome;\n","// Replace alert() with toastify-js\nimport Toastify from 'toastify-js';\n\nconst nativeAlert = window.alert;\nif (!window.__nativeAlert) window.__nativeAlert = nativeAlert;\n\nwindow.alert = function (message) {\n  console.debug(\n    'ALERT: This is a custom alert() function. Native alert() is still available as window.__nativeAlert()',\n  );\n  // If Error object, show the message\n  if (message instanceof Error && message?.message) {\n    message = message.message;\n  }\n  // If not string, stringify it\n  if (typeof message !== 'string') {\n    message = JSON.stringify(message);\n  }\n\n  const toast = Toastify({\n    text: message,\n    className: 'alert',\n    gravity: 'top',\n    position: 'center',\n    duration: 10_000,\n    offset: {\n      y: 48,\n    },\n    onClick: () => {\n      toast.hideToast();\n    },\n  });\n  toast.showToast();\n};\n","import './app.css';\n\nimport { useLingui } from '@lingui/react';\nimport debounce from 'just-debounce-it';\nimport { lazy, memo, Suspense } from 'preact/compat';\nimport {\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { matchPath, Route, Routes, useLocation } from 'react-router-dom';\n\nimport 'swiped-events';\n\nimport { subscribe } from 'valtio';\n\nimport BackgroundService from './components/background-service';\nimport ComposeButton from './components/compose-button';\nimport { ICONS } from './components/ICONS';\nimport KeyboardShortcutsHelp from './components/keyboard-shortcuts-help';\nimport Loader from './components/loader';\nimport Modals from './components/modals';\nimport NavigationCommand from './components/navigation-command';\nimport NotificationService from './components/notification-service';\nimport SearchCommand from './components/search-command';\nimport Shortcuts from './components/shortcuts';\nimport NotFound from './pages/404';\nimport AccountStatuses from './pages/account-statuses';\nimport AnnualReport from './pages/annual-report';\nimport Bookmarks from './pages/bookmarks';\nimport Catchup from './pages/catchup';\nimport Favourites from './pages/favourites';\nimport Filters from './pages/filters';\nimport FollowedHashtags from './pages/followed-hashtags';\nimport Following from './pages/following';\nimport Hashtag from './pages/hashtag';\nimport Home from './pages/home';\nimport HttpRoute from './pages/http-route';\nimport List from './pages/list';\nimport Lists from './pages/lists';\nimport Login from './pages/login';\nimport Mentions from './pages/mentions';\nimport Notifications from './pages/notifications';\nimport Public from './pages/public';\nimport ScheduledPosts from './pages/scheduled-posts';\nimport Search from './pages/search';\nimport StatusRoute from './pages/status-route';\nimport Trending from './pages/trending';\nimport Welcome from './pages/welcome';\nimport {\n  api,\n  hasInstance,\n  hasPreferences,\n  initAccount,\n  initClient,\n  initInstance,\n  initPreferences,\n} from './utils/api';\nimport { getAccessToken } from './utils/auth';\nimport focusDeck from './utils/focus-deck';\nimport states, { hideAllModals, initStates, statusKey } from './utils/states';\nimport store from './utils/store';\nimport {\n  getAccount,\n  getCredentialApplication,\n  getCurrentAccount,\n  getVapidKey,\n  setCurrentAccountID,\n} from './utils/store-utils';\n\nimport './utils/toast-alert';\n\n// Lazy load Sandbox component only in development\nconst Sandbox =\n  import.meta.env.DEV || import.meta.env.PHANPY_DEV\n    ? lazy(() => import('./pages/sandbox'))\n    : () => null;\n\n// QR Scan Test component for development\nfunction QrScanTest() {\n  useEffect(() => {\n    states.showQrScannerModal = {\n      onClose: ({ text } = {}) => {\n        hideAllModals();\n        location.hash = text ? `/${text}` : '/';\n      },\n    };\n  }, []);\n\n  return null;\n}\n\nwindow.__STATES__ = states;\nwindow.__STATES_STATS__ = () => {\n  const keys = [\n    'statuses',\n    'accounts',\n    'spoilers',\n    'unfurledLinks',\n    'statusQuotes',\n  ];\n  const counts = {};\n  keys.forEach((key) => {\n    counts[key] = Object.keys(states[key]).length;\n  });\n  console.warn('STATE stats', counts);\n\n  const { statuses } = states;\n  const unmountedPosts = [];\n  for (const key in statuses) {\n    const $post = document.querySelector(\n      `[data-state-post-id~=\"${key}\"], [data-state-post-ids~=\"${key}\"]`,\n    );\n    if (!$post) {\n      unmountedPosts.push(key);\n    }\n  }\n  console.warn('Unmounted posts', unmountedPosts.length, unmountedPosts);\n};\n\n// Experimental \"garbage collection\" for states\n// Every 15 minutes\n// Only posts for now\nsetInterval(\n  () => {\n    if (!window.__IDLE__) return;\n    const { statuses, unfurledLinks, notifications } = states;\n    let keysCount = 0;\n    const { instance } = api();\n    for (const key in statuses) {\n      if (!window.__IDLE__) break;\n      try {\n        const $post = document.querySelector(\n          `[data-state-post-id~=\"${key}\"], [data-state-post-ids~=\"${key}\"]`,\n        );\n        const postInNotifications = notifications.some(\n          (n) => key === statusKey(n.status?.id, instance),\n        );\n        if (!$post && !postInNotifications) {\n          delete states.statuses[key];\n          delete states.statusQuotes[key];\n          for (const link in unfurledLinks) {\n            const unfurled = unfurledLinks[link];\n            const sKey = statusKey(unfurled.id, unfurled.instance);\n            if (sKey === key) {\n              delete states.unfurledLinks[link];\n              break;\n            }\n          }\n          keysCount++;\n        }\n      } catch (e) {}\n    }\n    if (keysCount) {\n      console.info(`GC: Removed ${keysCount} keys`);\n    }\n  },\n  15 * 60 * 1000,\n);\n\n// Preload icons\n// There's probably a better way to do this\n// Related: https://github.com/vitejs/vite/issues/10600\nsetTimeout(() => {\n  for (const icon in ICONS) {\n    setTimeout(() => {\n      if (Array.isArray(ICONS[icon])) {\n        ICONS[icon][0]?.();\n      } else if (typeof ICONS[icon] === 'object') {\n        ICONS[icon].module?.();\n      } else {\n        ICONS[icon]?.();\n      }\n    }, 1);\n  }\n}, 5000);\n\n(() => {\n  window.__IDLE__ = true;\n  const nonIdleEvents = [\n    'mousemove',\n    'mousedown',\n    'resize',\n    'keydown',\n    'touchstart',\n    'pointerdown',\n    'pointermove',\n    'wheel',\n  ];\n  const setIdle = () => {\n    window.__IDLE__ = true;\n  };\n  const IDLE_TIME = 3_000; // 3 seconds\n  const debouncedSetIdle = debounce(setIdle, IDLE_TIME);\n  const onNonIdle = () => {\n    window.__IDLE__ = false;\n    debouncedSetIdle();\n  };\n  nonIdleEvents.forEach((event) => {\n    window.addEventListener(event, onNonIdle, {\n      passive: true,\n      capture: true,\n    });\n  });\n  window.addEventListener('blur', setIdle, {\n    passive: true,\n  });\n  // When cursor leaves the window, set idle\n  document.documentElement.addEventListener(\n    'mouseleave',\n    (e) => {\n      if (!e.relatedTarget && !e.toElement) {\n        setIdle();\n      }\n    },\n    {\n      passive: true,\n    },\n  );\n  // document.addEventListener(\n  //   'visibilitychange',\n  //   () => {\n  //     if (document.visibilityState === 'visible') {\n  //       onNonIdle();\n  //     }\n  //   },\n  //   {\n  //     passive: true,\n  //   },\n  // );\n})();\n\n// Possible fix for iOS PWA theme-color bug\n// It changes when loading web pages in \"webview\"\nconst isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\nif (isIOS) {\n  document.addEventListener('visibilitychange', () => {\n    if (document.visibilityState === 'visible') {\n      // Don't reset theme color if media modal is showing\n      // Media modal will set its own theme color based on the media's color\n      const showingMediaModal =\n        document.getElementsByClassName('media-modal-container').length > 0;\n      if (showingMediaModal) return;\n\n      const theme = store.local.get('theme');\n      let $meta;\n      if (theme) {\n        // Get current meta\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][data-theme-setting=\"manual\"]`,\n        );\n        if ($meta) {\n          const color = $meta.content;\n          const tempColor =\n            theme === 'light'\n              ? $meta.dataset.themeLightColorTemp\n              : $meta.dataset.themeDarkColorTemp;\n          $meta.content = tempColor || '';\n          setTimeout(() => {\n            $meta.content = color;\n          }, 10);\n        }\n      } else {\n        // Get current color scheme\n        const colorScheme = window.matchMedia('(prefers-color-scheme: dark)')\n          .matches\n          ? 'dark'\n          : 'light';\n        // Get current theme-color\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][media*=\"${colorScheme}\"]`,\n        );\n        if ($meta) {\n          const color = $meta.dataset.content;\n          const tempColor = $meta.dataset.contentTemp;\n          $meta.content = tempColor || '';\n          setTimeout(() => {\n            $meta.content = color;\n          }, 10);\n        }\n      }\n    }\n  });\n}\n\n{\n  const theme = store.local.get('theme');\n  // If there's a theme, it's NOT auto\n  if (theme) {\n    // dark | light\n    document.documentElement.classList.add(`is-${theme}`);\n    document\n      .querySelector('meta[name=\"color-scheme\"]')\n      .setAttribute('content', theme || 'light dark');\n\n    // Enable manual theme <meta>\n    const $manualMeta = document.querySelector(\n      'meta[data-theme-setting=\"manual\"]',\n    );\n    if ($manualMeta) {\n      $manualMeta.name = 'theme-color';\n      $manualMeta.content =\n        theme === 'light'\n          ? $manualMeta.dataset.themeLightColor\n          : $manualMeta.dataset.themeDarkColor;\n    }\n    // Disable auto theme <meta>s\n    const $autoMetas = document.querySelectorAll(\n      'meta[data-theme-setting=\"auto\"]',\n    );\n    $autoMetas.forEach((m) => {\n      m.name = '';\n    });\n  }\n  const textSize = store.local.get('textSize');\n  if (textSize) {\n    document.documentElement.style.setProperty('--text-size', `${textSize}px`);\n  }\n}\n\nsubscribe(states, (changes) => {\n  for (const [action, path, value, prevValue] of changes) {\n    // Change #app dataset based on settings.shortcutsViewMode\n    if (path.join('.') === 'settings.shortcutsViewMode') {\n      const $app = document.getElementById('app');\n      if ($app) {\n        $app.dataset.shortcutsViewMode = states.shortcuts?.length ? value : '';\n      }\n    }\n\n    // Add/Remove cloak class to body\n    if (path.join('.') === 'settings.cloakMode') {\n      const $body = document.body;\n      $body.classList.toggle('cloak', value);\n    }\n  }\n});\n\nconst BENCHES = new Map();\nwindow.__BENCH_RESULTS = new Map();\nwindow.__BENCHMARK = {\n  start(name) {\n    if (!import.meta.env.DEV && !import.meta.env.PHANPY_DEV) return;\n    // If already started, ignore\n    if (BENCHES.has(name)) return;\n    const start = performance.now();\n    BENCHES.set(name, start);\n  },\n  end(name) {\n    if (!import.meta.env.DEV && !import.meta.env.PHANPY_DEV) return;\n    const start = BENCHES.get(name);\n    if (start) {\n      const end = performance.now();\n      const duration = end - start;\n      __BENCH_RESULTS.set(name, duration);\n      BENCHES.delete(name);\n    }\n  },\n};\n\nif (import.meta.env.DEV) {\n  // If press shift down, set --time-scale to 10 in root\n  document.addEventListener('keydown', (e) => {\n    if (e.key === 'Shift') {\n      document.documentElement.classList.add('slow-mo');\n    }\n  });\n  document.addEventListener('keyup', (e) => {\n    if (e.key === 'Shift') {\n      document.documentElement.classList.remove('slow-mo');\n    }\n  });\n}\n\n{\n  // Temporary Experiments\n  // May be removed in the future\n  document.body.classList.toggle(\n    'exp-tab-bar-v2',\n    store.local.get('experiments-tabBarV2') ?? false,\n  );\n}\n\n// const isPWA = true; // testing\nconst isPWA =\n  window.matchMedia('(display-mode: standalone)').matches ||\n  window.navigator.standalone === true;\nconst PATH_RESTORE_TIME_LIMIT = 2 * 60 * 60 * 1000; // 2 hours, should be good enough\n\nfunction App() {\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [uiState, setUIState] = useState('loading');\n  __BENCHMARK.start('app-init');\n  __BENCHMARK.start('time-to-following');\n  __BENCHMARK.start('time-to-home');\n  __BENCHMARK.start('time-to-isLoggedIn');\n  useLingui();\n\n  useEffect(() => {\n    const instanceURL = store.local.get('instanceURL');\n    const code = decodeURIComponent(\n      (window.location.search.match(/code=([^&]+)/) || [, ''])[1],\n    );\n\n    if (code) {\n      console.log({ code });\n\n      const isPopup = window.opener && !window.opener.closed;\n\n      if (isPopup) {\n        try {\n          window.opener.postMessage(\n            {\n              type: 'oauth-callback',\n              code: code,\n            },\n            window.location.origin,\n          );\n          setTimeout(() => {\n            window.close();\n          }, 100);\n        } catch (e) {\n          console.error('Failed to send message to parent window:', e);\n          window.close();\n        }\n        return;\n      }\n\n      // Clear the code from the URL\n      window.history.replaceState(\n        {},\n        document.title,\n        window.location.pathname || '/',\n      );\n\n      const {\n        client_id: clientID,\n        client_secret: clientSecret,\n        vapid_key,\n      } = getCredentialApplication(instanceURL) || {};\n      const vapidKey = getVapidKey(instanceURL) || vapid_key;\n      const verifier = store.sessionCookie.get('codeVerifier');\n\n      (async () => {\n        setUIState('loading');\n        const { access_token: accessToken } = await getAccessToken({\n          instanceURL,\n          client_id: clientID,\n          client_secret: clientSecret,\n          code,\n          code_verifier: verifier || undefined,\n        });\n\n        if (accessToken) {\n          const client = initClient({ instance: instanceURL, accessToken });\n          await Promise.allSettled([\n            initPreferences(client),\n            initInstance(client, instanceURL),\n            initAccount(client, instanceURL, accessToken, vapidKey),\n          ]);\n          initStates();\n          window.__IGNORE_GET_ACCOUNT_ERROR__ = true;\n\n          setIsLoggedIn(true);\n          setUIState('default');\n        } else {\n          setUIState('error');\n        }\n        __BENCHMARK.end('app-init');\n      })();\n    } else {\n      window.__IGNORE_GET_ACCOUNT_ERROR__ = true;\n      const searchAccount = decodeURIComponent(\n        (window.location.search.match(/account=([^&]+)/) || [, ''])[1],\n      );\n      let account;\n      if (searchAccount) {\n        account = getAccount(searchAccount);\n        console.log('searchAccount', searchAccount, account);\n        if (account) {\n          setCurrentAccountID(account.info.id);\n          window.history.replaceState(\n            {},\n            document.title,\n            window.location.pathname || '/',\n          );\n        }\n      }\n      if (!account) {\n        account = getCurrentAccount();\n      }\n      if (account) {\n        setCurrentAccountID(account.info.id);\n        const { client } = api({ account });\n        const { instance } = client;\n        // console.log('masto', masto);\n        initStates();\n        setUIState('loading');\n        (async () => {\n          try {\n            if (hasPreferences() && hasInstance(instance)) {\n              // Non-blocking\n              initPreferences(client);\n              initInstance(client, instance);\n            } else {\n              await Promise.allSettled([\n                initPreferences(client),\n                initInstance(client, instance),\n              ]);\n            }\n          } catch (e) {\n          } finally {\n            setIsLoggedIn(true);\n            setUIState('default');\n            __BENCHMARK.end('app-init');\n          }\n        })();\n      } else {\n        setUIState('default');\n        __BENCHMARK.end('app-init');\n      }\n    }\n\n    // Cleanup\n    store.sessionCookie.del('clientID');\n    store.sessionCookie.del('clientSecret');\n    store.sessionCookie.del('codeVerifier');\n  }, []);\n\n  let location = useLocation();\n  states.currentLocation = location.pathname;\n  // useLayoutEffect(() => {\n  //   states.currentLocation = location.pathname;\n  // }, [location.pathname]);\n\n  useEffect(focusDeck, [location, isLoggedIn]);\n\n  // Save last page for PWA restoration\n  const restoredRef = useRef(false);\n  const lastPathKey = 'pwaLastPath';\n  useEffect(() => {\n    if (!restoredRef.current) return;\n    // console.log('location.pathname', location.pathname);\n    if (isPWA && isLoggedIn) {\n      if (isRootPath(location.pathname)) {\n        store.local.del(lastPathKey);\n      } else {\n        store.local.setJSON(lastPathKey, {\n          path: location.pathname + location.search,\n          lastAccessed: Date.now(),\n        });\n      }\n    }\n  }, [location.pathname, location.search, isLoggedIn]);\n\n  // Restore last page on PWA reopen\n  useEffect(() => {\n    if (restoredRef.current) return;\n    const isRootPath = !location.pathname || location.pathname === '/';\n    if (!isRootPath) return;\n    if (isPWA && isLoggedIn && uiState === 'default') {\n      const lastPath = store.local.getJSON(lastPathKey);\n      if (lastPath) {\n        setTimeout(() => {\n          if (lastPath?.path) {\n            const timeSinceLastAccess =\n              Date.now() - (lastPath.lastAccessed || 0);\n            if (timeSinceLastAccess < PATH_RESTORE_TIME_LIMIT) {\n              window.location.hash = lastPath.path;\n            }\n          }\n          store.local.del(lastPathKey);\n        }, 300);\n      }\n      restoredRef.current = true;\n    }\n  }, [uiState, isLoggedIn]);\n\n  if (/\\/https?:/.test(location.pathname)) {\n    return <HttpRoute />;\n  }\n\n  if (uiState === 'loading') {\n    return <Loader id=\"loader-root\" />;\n  }\n\n  return (\n    <>\n      <PrimaryRoutes isLoggedIn={isLoggedIn} />\n      <SecondaryRoutes isLoggedIn={isLoggedIn} />\n      <Routes>\n        <Route path=\"/:instance?/s/:id\" element={<StatusRoute />} />\n      </Routes>\n      {isLoggedIn && <ComposeButton />}\n      {isLoggedIn && <Shortcuts />}\n      <Modals />\n      {isLoggedIn && <NotificationService />}\n      <BackgroundService isLoggedIn={isLoggedIn} />\n      {isLoggedIn && <NavigationCommand />}\n      <SearchCommand onClose={focusDeck} />\n      <KeyboardShortcutsHelp />\n    </>\n  );\n}\n\nfunction Root({ isLoggedIn }) {\n  if (isLoggedIn) {\n    __BENCHMARK.end('time-to-isLoggedIn');\n  }\n  return isLoggedIn ? <Home /> : <Welcome />;\n}\n\nfunction isRootPath(pathname) {\n  return /^\\/(login|welcome|_sandbox|_qr-scan)/i.test(pathname);\n}\n\nconst PrimaryRoutes = memo(({ isLoggedIn }) => {\n  const location = useLocation();\n  const nonRootLocation = useMemo(() => {\n    const { pathname } = location;\n    return !isRootPath(pathname);\n  }, [location]);\n\n  return (\n    <Routes location={nonRootLocation || location}>\n      <Route path=\"/\" element={<Root isLoggedIn={isLoggedIn} />} />\n      <Route path=\"/login\" element={<Login />} />\n      <Route path=\"/welcome\" element={<Welcome />} />\n      {(import.meta.env.DEV || import.meta.env.PHANPY_DEV) && (\n        <>\n          <Route\n            path=\"/_sandbox\"\n            element={\n              <Suspense fallback={<Loader id=\"loader-sandbox\" />}>\n                <Sandbox />\n              </Suspense>\n            }\n          />\n          <Route path=\"/_qr-scan\" element={<QrScanTest />} />\n        </>\n      )}\n    </Routes>\n  );\n});\n\nfunction getPrevLocation() {\n  return states.prevLocation || null;\n}\nfunction SecondaryRoutes({ isLoggedIn }) {\n  // const snapStates = useSnapshot(states);\n  const location = useLocation();\n  // const prevLocation = snapStates.prevLocation;\n  const backgroundLocation = useRef(getPrevLocation());\n\n  const isModalPage = useMemo(() => {\n    return (\n      matchPath('/:instance/s/:id', location.pathname) ||\n      matchPath('/s/:id', location.pathname)\n    );\n  }, [location.pathname, matchPath]);\n  if (isModalPage) {\n    if (!backgroundLocation.current)\n      backgroundLocation.current = getPrevLocation();\n  } else {\n    backgroundLocation.current = null;\n  }\n  console.debug({\n    backgroundLocation: backgroundLocation.current,\n    location,\n  });\n\n  return (\n    <Routes location={backgroundLocation.current || location}>\n      {isLoggedIn && (\n        <>\n          <Route path=\"/notifications\" element={<Notifications />} />\n          <Route path=\"/mentions\" element={<Mentions />} />\n          <Route path=\"/following\" element={<Following />} />\n          <Route path=\"/b\" element={<Bookmarks />} />\n          <Route path=\"/f\" element={<Favourites />} />\n          <Route path=\"/l\">\n            <Route index element={<Lists />} />\n            <Route path=\":id\" element={<List />} />\n          </Route>\n          <Route path=\"/fh\" element={<FollowedHashtags />} />\n          <Route path=\"/sp\" element={<ScheduledPosts />} />\n          <Route path=\"/ft\" element={<Filters />} />\n          <Route path=\"/catchup\" element={<Catchup />} />\n          <Route path=\"/annual_report/:year\" element={<AnnualReport />} />\n        </>\n      )}\n      <Route path=\"/:instance?/t/:hashtag\" element={<Hashtag />} />\n      <Route path=\"/:instance?/a/:id\" element={<AccountStatuses />} />\n      <Route path=\"/:instance?/p\">\n        <Route index element={<Public />} />\n        <Route path=\"l\" element={<Public local />} />\n      </Route>\n      <Route path=\"/:instance?/trending\" element={<Trending />} />\n      <Route path=\"/:instance?/search\" element={<Search />} />\n      {/* <Route path=\"/:anything\" element={<NotFound />} /> */}\n    </Routes>\n  );\n}\n\nexport { App };\n","import './index.css';\nimport './cloak-mode.css';\nimport './polyfills';\n\nimport { i18n } from '@lingui/core';\nimport { I18nProvider } from '@lingui/react';\n// Polyfill needed for Firefox < 122\n// https://bugzilla.mozilla.org/show_bug.cgi?id=1423593\n// import '@formatjs/intl-segmenter/polyfill';\nimport { render } from 'preact';\nimport { HashRouter } from 'react-router-dom';\n\nimport { App } from './app';\nimport { IconSpriteProvider } from './components/icon-sprite-manager';\nimport { initActivateLang } from './utils/lang';\nimport { initPWAViewport } from './utils/pwa-viewport';\n\ninitActivateLang();\ninitPWAViewport();\n\nif (import.meta.env.DEV) {\n  import('preact/debug');\n}\n\nrender(\n  <I18nProvider i18n={i18n}>\n    <HashRouter>\n      <IconSpriteProvider>\n        <App />\n      </IconSpriteProvider>\n    </HashRouter>\n  </I18nProvider>,\n  document.getElementById('app'),\n);\n\n// Storage cleanup\nsetTimeout(() => {\n  try {\n    // Clean up old settings key\n    localStorage.removeItem('settings-groupedNotificationsAlpha');\n  } catch (e) {}\n}, 5000);\n\n// Service worker cache cleanup\nif ('serviceWorker' in navigator && typeof caches !== 'undefined') {\n  const MAX_SW_CACHE_SIZE = 50;\n  const IGNORE_CACHE_KEYS = ['icons'];\n  let clearRanOnce = false;\n  const FAST_INTERVAL = 10_000; // 10 seconds\n  const SLOW_INTERVAL = 60 * 60 * 1000; // 1 hour\n  async function clearCaches() {\n    if (window.__IDLE__) {\n      try {\n        const keys = await caches.keys();\n        for (const key of keys) {\n          if (IGNORE_CACHE_KEYS.includes(key)) continue;\n          const cache = await caches.open(key);\n          const _keys = await cache.keys();\n          if (_keys.length > MAX_SW_CACHE_SIZE) {\n            console.warn('Cleaning cache', key, _keys.length);\n            const deleteKeys = _keys.slice(MAX_SW_CACHE_SIZE);\n            for (const deleteKey of deleteKeys) {\n              await cache.delete(deleteKey);\n            }\n          }\n        }\n        clearRanOnce = true;\n      } catch (e) {} // Silent fail\n    }\n    // Once cleared, clear again at slower interval\n    setTimeout(clearCaches, clearRanOnce ? SLOW_INTERVAL : FAST_INTERVAL);\n  }\n  setTimeout(clearCaches, FAST_INTERVAL);\n}\n\nwindow.__CLOAK__ = () => {\n  document.body.classList.toggle('cloak');\n};\n"],"file":"main-COIelIo0.js"}